<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩‍👧‍👦 🕙 🐾 无线传感器，用于打开和关闭，具有高级功能 🏴 ⏹️ 😑</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="我欢迎Habr的所有读者，尤其是“ DIY或自己动手做”部分的读者！而且，如果我无法提出类似的建议，那我就是一名arduino，我可以...我不涉及管理电梯轿厢的主要主题:)。经过一番思考，出于某种原因，我想制作一个开合传感器。就像我最近做的其他手工艺品一样，该传感器也是基于Nordic Semic...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>无线传感器，用于打开和关闭，具有高级功能</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/490476/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我欢迎Habr的所有读者，尤其是“ DIY或自己动手做”部分的读者！而且，如果我无法提出类似的建议，那我就是一名arduino，我可以...我不涉及管理电梯轿厢的主要主题:)。经过一番思考，出于某种原因，我想制作一个开合传感器。就像我最近做的其他手工艺品一样，该传感器也是基于Nordic Semiconductor的芯片。传感器决定采用两种版本，一种在nRF52840芯片上，另一种在nRF52811芯片上。</font></font><br>
 <br>
<img src="https://habrastorage.org/webt/zu/u9/48/zuu948wn8duosrmce4hvtao1une.jpeg"><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
对于版本nRF52840芯片模块用于E73_2G4M08S1C公司</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EBYTE</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，为verciya芯片模块nRF52811 MC50SFA公司</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MiNEW</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">坦白地说，寻找价格合理的nRF52811芯片仍然是一次冒险。</font><font style="vertical-align: inherit;">但是，由于器件的这种冒险性，MINEW的nRF52811芯片上的模块以及焊接到这些模块的几种版本的芯片形式的面包都是nRF52810和nRF52832。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/cn/yx/4l/cnyx4lcnu6q_isgpvrszxy7c9wy.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
该设备的主要功能是基于舌簧开关检测打开和关闭。</font><font style="vertical-align: inherit;">舌簧开关的电路通过防跳动重新定相。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
电路原理图：</font></font><br>
<img src="https://habrastorage.org/webt/o7/io/x-/o7iox-c4oobmvx6zldll_m1vowu.png"><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Arduino方案:)</font></font></b><div class="spoiler_text"><img src="https://habrastorage.org/webt/j4/au/cy/j4aucyctci1fdwtfdkbiz_exsyi.png"><br>
</div></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
考虑过什么应该适当地稀释这种开合传感器的主要功能，我决定看看市场上有关此的内容。由于几乎没有结果，因此打开和关闭传感器在非洲也是打开和关闭传感器。在</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">REDMOND</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">找到了最“先进”的解决方案</font><font style="vertical-align: inherit;">。在他们的BLE传感器中（顺便说一下，也是在Nordic的一个芯片上），除了磁簧开关之外，TTP223芯片上还安装了一个温度传感器和一个电容式按钮。但是出于某种原因，在我看来这并不是一个很好的解决方案，它不适合用于门或窗附近的温度读数（以及防止其被芯片测量的原因）以及在什么情况下使用悬挂在窗或门上的传感器上的按钮（嗯，也许除了输入:)）。结果，我决定扩展传感器的安全功能。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/fn/7v/y7/fn7vy79b2eivip0yber_90a_zew.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
主要的选择标准是附加传感器的消耗，因为已决定在该传感器中使用CR2032电池。候选人中的获奖者是两个传感器，LIS2DW12加速度计和DRV5032FB磁场传感器。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
LIS2DW12当前可能是最经济的加速度计。在低功耗模式下，该加速度计的功耗为1μA（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据表</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。 DRV5032FB磁场传感器还具有出色的功耗特性。它的功耗约为500nA（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据表</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
加速度计被确定用于震动传感器模式，而磁场传感器则用于其预定用途。如果我对震动传感器的功能感到平静，那么使用磁场传感器仍然是一个实验性的解决方案，但是它比温度传感器要好。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/si/ni/64/sini6468k7gc4btzzjjwcaco8y8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
该项目的软件部分专门用于在Maysensors网络中操作传感器。至少现在（是。在较低级别的北欧芯片（nRF24（+ atmega 328，stm32f1），nRF51和nRF52）上工作的变体中的Meisensors使用Nordic专有协议-Enhanced ShockBurst（ESB），从而确保nRF24和nRF51-52上设备的兼容性。 Maysensors是一个开放的Arduino项目，围绕这个项目，世界上许多国家已经建立了一个相当大的社区。但是，在nRF52芯片上的良好解决方案是不必使用Maysensors（ESB）。由于芯片是多协议的，因此只需替换基于Zigbee或BLE协议的软件就足够了。...关于BLE，我将介绍一下，看看E73_2G4M08S1C模块可以制造出多么出色的Arduino NANO 33 Ble，我的NANO 33的价格是4美元。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ot/8f/vh/ot8fvhkkqsnzw_vhcqy7rubbgg0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
传感器的草图是在Arduino中制作的.IDE中使用了其他库的加速度计LIS2DW12的库，在我的寄存器默认设置中，我做了一些改动，在我的版本中，它可以在最低功耗版本的设置下立即使用（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在我的git上可用</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我将描述程序的逻辑。在主要操作模式下，传感器处于配置状态，只有4个中断处于理想状态。中断有两种配置； configs在程序操作期间根据簧片开关的状态重新配置中断。如果门是打开的，则震动传感器和磁场传感器的中断将被禁用。门一旦关闭，就会激活其中两个传感器的中断。我还遇到一个事实，即在打开过程中，有些情况是在簧片开关之前触发了震动传感器，这是由于打开锁时的振动引起的。仅在配置了加速度计的高灵敏度的情况下记录了此故障。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
为了消除此问题，加速度计被触发时需要等待2秒钟，在此期间，将监控磁簧开关的引脚。如果在等待期间舌簧开关的引脚上发生电平变化，则停止通过加速度计中断来进一步处理事件，并开始处理舌簧开关中的事件。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
传感器具有配置模式。按下维修按钮后，传感器将在中断后唤醒，无线电模块进入监听模式，并等待UD控制器的传入命令。如果收到命令，则传感器将新值写入内存，并立即进入睡眠模式。要发送下一条命令，必须重复激活配置模式。如果在配置模式下传感器在30秒内未收到任何信息，则在此时间之后它也会切换到操作模式并进入睡眠状态。除了配置模式外，还可以从服务按钮开始显示传感器传感器并恢复出厂设置（传感器会忘记已添加传感器的网络，必须在重置后再次进行传感器的注册）。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/jn/1f/j3/jn1fj3ih6xil_iyk_c5abhzmg8q.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/u-/bt/gd/u-btgdierfsy0aqpvt2yhmimjic.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/gk/mr/ml/gkmrmlazpn6iwyxujq_82tk0ipc.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/do/en/m6/doenm6q7xz4ri8cxv57gipihkbq.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/er/x9/wu/erx9wumdn9jpozoie_o20c_kmqe.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
要在Arduino IDE中对传感器进行编程，您需要添加对以下开发板的支持：</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sandeepmistry / arduino-nRF5 </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysensors / ArduinoBoards</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
库：</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mysensor </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LIS2DW12</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
编程器：st-link，j-link。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">素描程序</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-keyword">bool</span> configMode = <span class="hljs-number">0</span>;
<span class="hljs-keyword">int8_t</span> int_status = <span class="hljs-number">0</span>;
<span class="hljs-keyword">bool</span> door_status = <span class="hljs-number">1</span>;
<span class="hljs-keyword">bool</span> check;
<span class="hljs-keyword">bool</span> magnet_status = <span class="hljs-number">1</span>;
<span class="hljs-keyword">bool</span> nosleep = <span class="hljs-number">0</span>;
<span class="hljs-keyword">bool</span> button_flag = <span class="hljs-number">0</span>;
<span class="hljs-keyword">bool</span> onoff = <span class="hljs-number">1</span>;
<span class="hljs-keyword">bool</span> flag_update_transport_param;
<span class="hljs-keyword">bool</span> flag_sendRoute_parent;
<span class="hljs-keyword">bool</span> flag_no_present;
<span class="hljs-keyword">bool</span> flag_nogateway_mode;
<span class="hljs-keyword">bool</span> flag_find_parent_process;
<span class="hljs-keyword">bool</span> flag_fcount;
<span class="hljs-keyword">bool</span> Ack_TL;
<span class="hljs-keyword">bool</span> Ack_FP;
<span class="hljs-keyword">bool</span> PRESENT_ACK;
<span class="hljs-keyword">bool</span> send_a;
<span class="hljs-keyword">bool</span> batt_flag;<font></font>
byte conf_vibro_set = <span class="hljs-number">2</span>;<font></font>
byte err_delivery_beat;<font></font>
byte problem_mode_count;<font></font>
<span class="hljs-keyword">uint8_t</span>  countbatt = <span class="hljs-number">0</span>;
<span class="hljs-keyword">uint8_t</span> batt_cap;
<span class="hljs-keyword">uint8_t</span> old_batt_cap = <span class="hljs-number">100</span>;
<span class="hljs-keyword">uint32_t</span> BATT_TIME;
<span class="hljs-keyword">uint32_t</span> SLEEP_TIME = <span class="hljs-number">10800000</span>;
<span class="hljs-keyword">uint32_t</span> SLEEP_NOGW = <span class="hljs-number">60000</span>;
<span class="hljs-keyword">uint32_t</span> oldmillis;
<span class="hljs-keyword">uint32_t</span> newmillis;
<span class="hljs-keyword">uint32_t</span> previousMillis;
<span class="hljs-keyword">uint32_t</span> lightMillisR;
<span class="hljs-keyword">uint32_t</span> configMillis;
<span class="hljs-keyword">uint32_t</span> interrupt_time;
<span class="hljs-keyword">uint32_t</span> SLEEP_TIME_W;
<span class="hljs-keyword">uint32_t</span> axel_time;
<span class="hljs-keyword">uint32_t</span> axel_time0;
<span class="hljs-keyword">int16_t</span> myid;
<span class="hljs-keyword">int16_t</span> mypar;
<span class="hljs-keyword">int16_t</span> old_mypar = <span class="hljs-number">-1</span>;
<span class="hljs-keyword">bool</span> vibro = <span class="hljs-number">1</span>;
<span class="hljs-keyword">uint32_t</span> PIN_BUTTON_MASK;
<span class="hljs-keyword">uint32_t</span> AXEL_INT_MASK;
<span class="hljs-keyword">uint32_t</span> GERKON_INT_MASK;
<span class="hljs-keyword">uint32_t</span> MAGNET_INT_MASK;
<span class="hljs-keyword">float</span> ODR_1Hz6_LP_ONLY = <span class="hljs-number">1.6f</span>;
<span class="hljs-keyword">float</span> ODR_12Hz5 = <span class="hljs-number">12.5f</span>;
<span class="hljs-keyword">float</span> ODR_25Hz = <span class="hljs-number">25.0f</span>;
<span class="hljs-keyword">float</span> ODR_50Hz = <span class="hljs-number">50.0f</span>;
<span class="hljs-keyword">float</span> ODR_100Hz = <span class="hljs-number">100.0f</span>;
<span class="hljs-keyword">float</span> ODR_200Hz = <span class="hljs-number">200.0f</span>;
<span class="hljs-keyword">volatile</span> byte axelIntStatus = <span class="hljs-number">0</span>;
<span class="hljs-keyword">volatile</span> byte gerkIntStatus = <span class="hljs-number">0</span>;
<span class="hljs-keyword">volatile</span> byte magIntStatus = <span class="hljs-number">0</span>;
<span class="hljs-keyword">volatile</span> byte buttIntStatus = <span class="hljs-number">0</span>;
<span class="hljs-keyword">uint16_t</span> batteryVoltage;
<span class="hljs-keyword">int16_t</span> linkQuality;
<span class="hljs-keyword">int16_t</span> old_linkQuality;<font></font>
<font></font>
<span class="hljs-comment">//#define MY_DEBUG</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">ifndef</span> MY_DEBUG</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MY_DISABLED_SERIAL</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MY_RADIO_NRF5_ESB</span>
<span class="hljs-keyword">int16_t</span> mtwr;
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MY_TRANSPORT_WAIT_READY_MS (mtwr)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MY_NRF5_ESB_PA_LEVEL (NRF5_PA_MAX)</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;MySensors.h&gt;</span></span><font></font>
<font></font>
<span class="hljs-keyword">extern</span> <span class="hljs-string">"C"</span> {
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"app_gpiote.h"</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"nrf_gpio.h"</span></span><font></font>
}<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> APP_GPIOTE_MAX_USERS 1</span>
<span class="hljs-keyword">static</span> <span class="hljs-keyword">app_gpiote_user_id_t</span> m_gpiote_user_id;<font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;LIS2DW12Sensor.h&gt;</span></span><font></font>
LIS2DW12Sensor *lis2;<font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> DWS_CHILD_ID 0</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> V_SENS_CHILD_ID 1</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> M_CHILD_ID 2</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LEVEL_SENSIV_V_SENS_CHILD_ID 230</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SIGNAL_Q_ID 250</span><font></font>
<font></font>
<span class="hljs-function">MyMessage <span class="hljs-title">dwsMsg</span><span class="hljs-params">(DWS_CHILD_ID, V_TRIPPED)</span></span>;
<span class="hljs-function">MyMessage <span class="hljs-title">mMsg</span><span class="hljs-params">(M_CHILD_ID, V_TRIPPED)</span></span>;
<span class="hljs-function">MyMessage <span class="hljs-title">vibroMsg</span><span class="hljs-params">(V_SENS_CHILD_ID, V_TRIPPED)</span></span>;
<span class="hljs-function">MyMessage <span class="hljs-title">conf_vsensMsg</span><span class="hljs-params">(LEVEL_SENSIV_V_SENS_CHILD_ID, V_VAR1)</span></span>;
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SN <span class="hljs-meta-string">"DOOR &amp; WINDOW SENS"</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SV <span class="hljs-meta-string">"1.12"</span></span><font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">before</span><span class="hljs-params">()</span> </span>{<font></font>
  board_Init();<font></font>
  happy_init();<font></font>
  delay(<span class="hljs-number">500</span>);<font></font>
  batteryVoltage = hwCPUVoltage();<font></font>
  digitalWrite(BLUE_LED, LOW);<font></font>
}<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">presentation</span><span class="hljs-params">()</span>
</span>{<font></font>
  NRF_POWER-&gt;DCDCEN = <span class="hljs-number">0</span>;<font></font>
  wait(<span class="hljs-number">10</span>);<font></font>
<font></font>
  check = sendSketchInfo(SN, SV);<font></font>
  wait(<span class="hljs-number">30</span>);
  <span class="hljs-keyword">if</span> (!check) {<font></font>
    _transportSM.failedUplinkTransmissions = <span class="hljs-number">0</span>;<font></font>
    wait(<span class="hljs-number">30</span>);<font></font>
    check = sendSketchInfo(SN, SV);<font></font>
    wait(<span class="hljs-number">30</span>);<font></font>
    _transportSM.failedUplinkTransmissions = <span class="hljs-number">0</span>;<font></font>
  }<font></font>
  <span class="hljs-keyword">if</span> (check) {<font></font>
    blinky(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, BLUE_LED);<font></font>
  } <span class="hljs-keyword">else</span> {<font></font>
    blinky(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, RED_LED);<font></font>
  }<font></font>
<font></font>
  check = present(DWS_CHILD_ID, S_DOOR, <span class="hljs-string">"STATUS RS SENS"</span>);<font></font>
  wait(<span class="hljs-number">40</span>);
  <span class="hljs-keyword">if</span> (!check) {<font></font>
    _transportSM.failedUplinkTransmissions = <span class="hljs-number">0</span>;<font></font>
    wait(<span class="hljs-number">40</span>);<font></font>
    check = present(DWS_CHILD_ID, S_DOOR, <span class="hljs-string">"STATUS RS SENS"</span>);<font></font>
    wait(<span class="hljs-number">40</span>);<font></font>
    _transportSM.failedUplinkTransmissions = <span class="hljs-number">0</span>;<font></font>
  }<font></font>
  <span class="hljs-keyword">if</span> (check) {<font></font>
    blinky(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, BLUE_LED);<font></font>
  } <span class="hljs-keyword">else</span> {<font></font>
    blinky(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, RED_LED);<font></font>
  }<font></font>
<font></font>
  check = present(V_SENS_CHILD_ID, S_VIBRATION, <span class="hljs-string">"STATUS SHOCK SENS"</span>);<font></font>
  wait(<span class="hljs-number">50</span>);
  <span class="hljs-keyword">if</span> (!check) {<font></font>
    _transportSM.failedUplinkTransmissions = <span class="hljs-number">0</span>;<font></font>
    wait(<span class="hljs-number">50</span>);<font></font>
    check = present(V_SENS_CHILD_ID, S_VIBRATION, <span class="hljs-string">"STATUS SHOCK SENS"</span>);<font></font>
    wait(<span class="hljs-number">50</span>);<font></font>
    _transportSM.failedUplinkTransmissions = <span class="hljs-number">0</span>;<font></font>
  }<font></font>
  <span class="hljs-keyword">if</span> (check) {<font></font>
    blinky(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, BLUE_LED);<font></font>
  } <span class="hljs-keyword">else</span> {<font></font>
    blinky(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, RED_LED);<font></font>
  }<font></font>
<font></font>
  check = present(M_CHILD_ID, S_DOOR, <span class="hljs-string">"ANTI-MAGNET ALARM"</span>);<font></font>
  wait(<span class="hljs-number">60</span>);
  <span class="hljs-keyword">if</span> (!check) {<font></font>
    _transportSM.failedUplinkTransmissions = <span class="hljs-number">0</span>;<font></font>
    wait(<span class="hljs-number">60</span>);<font></font>
    check = present(M_CHILD_ID, S_DOOR, <span class="hljs-string">"ANTI-MAGNET ALARM"</span>);<font></font>
    wait(<span class="hljs-number">60</span>);<font></font>
    _transportSM.failedUplinkTransmissions = <span class="hljs-number">0</span>;<font></font>
  }<font></font>
  <span class="hljs-keyword">if</span> (check) {<font></font>
    blinky(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, BLUE_LED);<font></font>
  } <span class="hljs-keyword">else</span> {<font></font>
    blinky(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, RED_LED);<font></font>
  }<font></font>
<font></font>
  check = present(SIGNAL_Q_ID, S_CUSTOM, <span class="hljs-string">"SIGNAL %"</span>);<font></font>
  wait(<span class="hljs-number">70</span>);
  <span class="hljs-keyword">if</span> (!check) {<font></font>
    _transportSM.failedUplinkTransmissions = <span class="hljs-number">0</span>;<font></font>
    wait(<span class="hljs-number">70</span>);<font></font>
    check = present(SIGNAL_Q_ID, S_CUSTOM, <span class="hljs-string">"SIGNAL %"</span>);<font></font>
    wait(<span class="hljs-number">70</span>);<font></font>
    _transportSM.failedUplinkTransmissions = <span class="hljs-number">0</span>;<font></font>
  }<font></font>
  <span class="hljs-keyword">if</span> (check) {<font></font>
    blinky(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, BLUE_LED);<font></font>
  } <span class="hljs-keyword">else</span> {<font></font>
    blinky(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, RED_LED);<font></font>
  }<font></font>
<font></font>
  check = present(LEVEL_SENSIV_V_SENS_CHILD_ID, S_CUSTOM, <span class="hljs-string">"SENS LEVEL VIBRO"</span>);<font></font>
  wait(<span class="hljs-number">80</span>);
  <span class="hljs-keyword">if</span> (!check) {<font></font>
    _transportSM.failedUplinkTransmissions = <span class="hljs-number">0</span>;<font></font>
    wait(<span class="hljs-number">80</span>);<font></font>
    check = present(LEVEL_SENSIV_V_SENS_CHILD_ID, S_CUSTOM, <span class="hljs-string">"SENS LEVEL VIBRO"</span>);<font></font>
    wait(<span class="hljs-number">80</span>);<font></font>
    _transportSM.failedUplinkTransmissions = <span class="hljs-number">0</span>;<font></font>
  }<font></font>
  <span class="hljs-keyword">if</span> (check) {<font></font>
    blinky(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, BLUE_LED);<font></font>
  } <span class="hljs-keyword">else</span> {<font></font>
    blinky(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, RED_LED);<font></font>
  }<font></font>
<font></font>
  check = send(conf_vsensMsg.<span class="hljs-built_in">set</span>(conf_vibro_set));<font></font>
  wait(<span class="hljs-number">90</span>);
  <span class="hljs-keyword">if</span> (!check) {<font></font>
    _transportSM.failedUplinkTransmissions = <span class="hljs-number">0</span>;<font></font>
    wait(<span class="hljs-number">90</span>);<font></font>
    check = send(conf_vsensMsg.<span class="hljs-built_in">set</span>(conf_vibro_set));<font></font>
    wait(<span class="hljs-number">90</span>);<font></font>
    _transportSM.failedUplinkTransmissions = <span class="hljs-number">0</span>;<font></font>
  }<font></font>
  <span class="hljs-keyword">if</span> (check) {<font></font>
    blinky(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, BLUE_LED);<font></font>
  } <span class="hljs-keyword">else</span> {<font></font>
    blinky(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, RED_LED);<font></font>
  }<font></font>
  NRF_POWER-&gt;DCDCEN = <span class="hljs-number">0</span>;<font></font>
  wait(<span class="hljs-number">10</span>);<font></font>
}<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setup</span><span class="hljs-params">()</span> </span>{<font></font>
  digitalWrite(BLUE_LED, HIGH);<font></font>
  config_Happy_node();<font></font>
  sensors_Init();<font></font>
}<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">loop</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-keyword">if</span> (flag_update_transport_param == <span class="hljs-number">1</span>) {<font></font>
    update_Happy_transport();<font></font>
  }<font></font>
  <span class="hljs-keyword">if</span> (flag_sendRoute_parent == <span class="hljs-number">1</span>) {<font></font>
    present_only_parent();<font></font>
  }<font></font>
  <span class="hljs-keyword">if</span> (isTransportReady() == <span class="hljs-literal">true</span>) {
    <span class="hljs-keyword">if</span> (flag_nogateway_mode == <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">if</span> (flag_find_parent_process == <span class="hljs-number">1</span>) {<font></font>
        find_parent_process();<font></font>
      }<font></font>
      <span class="hljs-keyword">if</span> (configMode == <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">if</span> ((axelIntStatus == AXEL_INT) || (buttIntStatus == PIN_BUTTON) || (gerkIntStatus == GERKON_INT) || (magIntStatus == MAGNET_INT)) {<font></font>
          nosleep = <span class="hljs-number">1</span>;<font></font>
          newmillis = millis();<font></font>
          interrupt_time = newmillis - oldmillis;<font></font>
          BATT_TIME = BATT_TIME - interrupt_time;<font></font>
          <span class="hljs-keyword">if</span> (BATT_TIME &lt; <span class="hljs-number">60000</span>) {<font></font>
            BATT_TIME = SLEEP_TIME;<font></font>
            batteryVoltage = hwCPUVoltage();<font></font>
            batt_flag = <span class="hljs-number">1</span>;<font></font>
          }<font></font>
<font></font>
          <span class="hljs-keyword">if</span> (gerkIntStatus == GERKON_INT) {<font></font>
            send_Gerkon();<font></font>
            axel_time = millis();<font></font>
            nosleep = <span class="hljs-number">0</span>;<font></font>
          }<font></font>
<font></font>
          <span class="hljs-keyword">if</span> (magIntStatus == MAGNET_INT) {<font></font>
            send_Magnet();<font></font>
            nosleep = <span class="hljs-number">0</span>;<font></font>
          }<font></font>
<font></font>
          <span class="hljs-keyword">if</span> (axelIntStatus == AXEL_INT) {
            <span class="hljs-keyword">if</span> (millis() - axel_time0 &gt;= <span class="hljs-number">2000</span>) {<font></font>
              send_Axel();<font></font>
              nosleep = <span class="hljs-number">0</span>;<font></font>
            } <span class="hljs-keyword">else</span> {
              <span class="hljs-keyword">if</span> (digitalRead(GERKON_INT) == LOW) {<font></font>
                send_Gerkon();<font></font>
                axel_time = millis();<font></font>
                nosleep = <span class="hljs-number">0</span>;<font></font>
              }<font></font>
            }<font></font>
          }<font></font>
<font></font>
          <span class="hljs-keyword">if</span> (buttIntStatus == PIN_BUTTON) {
            <span class="hljs-keyword">if</span> (digitalRead(PIN_BUTTON) == <span class="hljs-number">0</span> &amp;&amp; button_flag == <span class="hljs-number">0</span>) {<font></font>
              button_flag = <span class="hljs-number">1</span>;<font></font>
              previousMillis = millis();<font></font>
              ledsOff();<font></font>
            }<font></font>
            <span class="hljs-keyword">if</span> (digitalRead(PIN_BUTTON) == <span class="hljs-number">0</span> &amp;&amp; button_flag == <span class="hljs-number">1</span>) {
              <span class="hljs-keyword">if</span> ((millis() - previousMillis &gt; <span class="hljs-number">0</span>) &amp;&amp; (millis() - previousMillis &lt;= <span class="hljs-number">1750</span>)) {
                <span class="hljs-keyword">if</span> (millis() - lightMillisR &gt; <span class="hljs-number">70</span>) {<font></font>
                  lightMillisR = millis();<font></font>
                  onoff = !onoff;<font></font>
                  digitalWrite(BLUE_LED, onoff);<font></font>
                }<font></font>
              }<font></font>
              <span class="hljs-keyword">if</span> ((millis() - previousMillis &gt; <span class="hljs-number">1750</span>) &amp;&amp; (millis() - previousMillis &lt;= <span class="hljs-number">2000</span>)) {<font></font>
                ledsOff();<font></font>
              }<font></font>
              <span class="hljs-keyword">if</span> ((millis() - previousMillis &gt; <span class="hljs-number">2000</span>) &amp;&amp; (millis() - previousMillis &lt;= <span class="hljs-number">3750</span>)) {
                <span class="hljs-keyword">if</span> (millis() - lightMillisR &gt; <span class="hljs-number">50</span>) {<font></font>
                  lightMillisR = millis();<font></font>
                  onoff = !onoff;<font></font>
                  digitalWrite(GREEN_LED, onoff);<font></font>
                }<font></font>
              }<font></font>
              <span class="hljs-keyword">if</span> ((millis() - previousMillis &gt; <span class="hljs-number">3750</span>) &amp;&amp; (millis() - previousMillis &lt;= <span class="hljs-number">4000</span>)) {<font></font>
                ledsOff();<font></font>
              }<font></font>
              <span class="hljs-keyword">if</span> ((millis() - previousMillis &gt; <span class="hljs-number">4000</span>) &amp;&amp; (millis() - previousMillis &lt;= <span class="hljs-number">5750</span>)) {
                <span class="hljs-keyword">if</span> (millis() - lightMillisR &gt; <span class="hljs-number">30</span>) {<font></font>
                  lightMillisR = millis();<font></font>
                  onoff = !onoff;<font></font>
                  digitalWrite(RED_LED, onoff);<font></font>
                }<font></font>
              }<font></font>
              <span class="hljs-keyword">if</span> (millis() - previousMillis &gt; <span class="hljs-number">5750</span>) {<font></font>
                ledsOff();<font></font>
              }<font></font>
            }<font></font>
<font></font>
            <span class="hljs-keyword">if</span> (digitalRead(PIN_BUTTON) == <span class="hljs-number">1</span> &amp;&amp; button_flag == <span class="hljs-number">1</span>) {
              <span class="hljs-keyword">if</span> ((millis() - previousMillis &lt;= <span class="hljs-number">1750</span>) &amp;&amp; (button_flag == <span class="hljs-number">1</span>))<font></font>
              {<font></font>
                ledsOff();<font></font>
                blinky(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>, BLUE_LED);<font></font>
                button_flag = <span class="hljs-number">0</span>;<font></font>
                buttIntStatus = <span class="hljs-number">0</span>;<font></font>
                presentation();<font></font>
                nosleep = <span class="hljs-number">0</span>;<font></font>
              }<font></font>
              <span class="hljs-keyword">if</span> ((millis() - previousMillis &gt; <span class="hljs-number">2000</span>) &amp;&amp; (millis() - previousMillis &lt;= <span class="hljs-number">3750</span>) &amp;&amp; (button_flag == <span class="hljs-number">1</span>))<font></font>
              {<font></font>
                ledsOff();<font></font>
                blinky(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>, GREEN_LED);<font></font>
                configMode = <span class="hljs-number">1</span>;<font></font>
                button_flag = <span class="hljs-number">0</span>;<font></font>
                configMillis = millis();<font></font>
                interrupt_Init(<span class="hljs-number">1</span>);<font></font>
                NRF_POWER-&gt;DCDCEN = <span class="hljs-number">0</span>;<font></font>
                buttIntStatus = <span class="hljs-number">0</span>;<font></font>
                NRF5_ESB_startListening();<font></font>
                wait(<span class="hljs-number">50</span>);<font></font>
              }<font></font>
<font></font>
              <span class="hljs-keyword">if</span> ((millis() - previousMillis &gt; <span class="hljs-number">4000</span>) &amp;&amp; (millis() - previousMillis &lt;= <span class="hljs-number">5750</span>) &amp;&amp; (button_flag == <span class="hljs-number">1</span>))<font></font>
              {<font></font>
                ledsOff();<font></font>
                blinky(<span class="hljs-number">3</span>, <span class="hljs-number">3</span>, RED_LED);
                <span class="hljs-comment">//new_device();</span><font></font>
              }<font></font>
<font></font>
              <span class="hljs-keyword">if</span> ((((millis() - previousMillis &gt; <span class="hljs-number">1750</span>) &amp;&amp; (millis() - previousMillis &lt;= <span class="hljs-number">2000</span>)) || ((millis() - previousMillis &gt; <span class="hljs-number">3750</span>) &amp;&amp; (millis() - previousMillis &lt;= <span class="hljs-number">4000</span>)) || ((millis() - previousMillis &gt; <span class="hljs-number">5750</span>))) &amp;&amp; (button_flag == <span class="hljs-number">1</span>))<font></font>
              {<font></font>
                ledsOff();<font></font>
                nosleep = <span class="hljs-number">0</span>;<font></font>
                button_flag = <span class="hljs-number">0</span>;<font></font>
                buttIntStatus = <span class="hljs-number">0</span>;<font></font>
              }<font></font>
            }<font></font>
          }<font></font>
        } <span class="hljs-keyword">else</span> {<font></font>
          batteryVoltage = hwCPUVoltage();<font></font>
          BATT_TIME = SLEEP_TIME;<font></font>
          sendBatteryStatus(<span class="hljs-number">1</span>);<font></font>
          nosleep = <span class="hljs-number">0</span>;<font></font>
        }<font></font>
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">if</span> (millis() - configMillis &gt; <span class="hljs-number">30000</span>) {<font></font>
          blinky(<span class="hljs-number">3</span>, <span class="hljs-number">3</span>, GREEN_LED);<font></font>
          configMode = <span class="hljs-number">0</span>;<font></font>
          nosleep = <span class="hljs-number">0</span>;<font></font>
          interrupt_Init(<span class="hljs-number">0</span>);<font></font>
          NRF_POWER-&gt;DCDCEN = <span class="hljs-number">1</span>;<font></font>
          wait(<span class="hljs-number">50</span>);<font></font>
        }<font></font>
      }<font></font>
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">if</span> (buttIntStatus == PIN_BUTTON) {
        <span class="hljs-keyword">if</span> (digitalRead(PIN_BUTTON) == <span class="hljs-number">0</span> &amp;&amp; button_flag == <span class="hljs-number">0</span>) {<font></font>
          button_flag = <span class="hljs-number">1</span>;<font></font>
          nosleep = <span class="hljs-number">1</span>;<font></font>
          previousMillis = millis();<font></font>
          ledsOff();<font></font>
        }<font></font>
        <span class="hljs-keyword">if</span> (digitalRead(PIN_BUTTON) == <span class="hljs-number">0</span> &amp;&amp; button_flag == <span class="hljs-number">1</span>) {
          <span class="hljs-keyword">if</span> ((millis() - previousMillis &gt; <span class="hljs-number">0</span>) &amp;&amp; (millis() - previousMillis &lt;= <span class="hljs-number">1750</span>)) {
            <span class="hljs-keyword">if</span> (millis() - lightMillisR &gt; <span class="hljs-number">25</span>) {<font></font>
              lightMillisR = millis();<font></font>
              onoff = !onoff;<font></font>
              digitalWrite(GREEN_LED, onoff);<font></font>
            }<font></font>
          }<font></font>
          <span class="hljs-keyword">if</span> ((millis() - previousMillis &gt; <span class="hljs-number">1750</span>) &amp;&amp; (millis() - previousMillis &lt;= <span class="hljs-number">2000</span>)) {<font></font>
            ledsOff();<font></font>
          }<font></font>
          <span class="hljs-keyword">if</span> ((millis() - previousMillis &gt; <span class="hljs-number">2000</span>) &amp;&amp; (millis() - previousMillis &lt;= <span class="hljs-number">4000</span>)) {
            <span class="hljs-keyword">if</span> (millis() - lightMillisR &gt; <span class="hljs-number">25</span>) {<font></font>
              lightMillisR = millis();<font></font>
              onoff = !onoff;<font></font>
              digitalWrite(RED_LED, onoff);<font></font>
            }<font></font>
          }<font></font>
          <span class="hljs-keyword">if</span> (millis() - previousMillis &gt; <span class="hljs-number">4000</span>) {<font></font>
            ledsOff();<font></font>
          }<font></font>
        }<font></font>
<font></font>
        <span class="hljs-keyword">if</span> (digitalRead(PIN_BUTTON) == <span class="hljs-number">1</span> &amp;&amp; button_flag == <span class="hljs-number">1</span>) {
          <span class="hljs-keyword">if</span> ((millis() - previousMillis &lt;= <span class="hljs-number">1750</span>) &amp;&amp; (button_flag == <span class="hljs-number">1</span>))<font></font>
          {<font></font>
            ledsOff();<font></font>
            blinky(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>, BLUE_LED);<font></font>
            button_flag = <span class="hljs-number">0</span>;<font></font>
            buttIntStatus = <span class="hljs-number">0</span>;<font></font>
            check_parent();<font></font>
            nosleep = <span class="hljs-number">0</span>;<font></font>
          }<font></font>
          <span class="hljs-keyword">if</span> ((millis() - previousMillis &gt; <span class="hljs-number">2000</span>) &amp;&amp; (millis() - previousMillis &lt;= <span class="hljs-number">4000</span>) &amp;&amp; (button_flag == <span class="hljs-number">1</span>))<font></font>
          {<font></font>
            ledsOff();<font></font>
            blinky(<span class="hljs-number">3</span>, <span class="hljs-number">3</span>, RED_LED);
            <span class="hljs-comment">//new_device();</span><font></font>
          }<font></font>
<font></font>
          <span class="hljs-keyword">if</span> ((((millis() - previousMillis &gt; <span class="hljs-number">1750</span>) &amp;&amp; (millis() - previousMillis &lt;= <span class="hljs-number">2000</span>)) || ((millis() - previousMillis &gt; <span class="hljs-number">4000</span>))) &amp;&amp; (button_flag == <span class="hljs-number">1</span>))<font></font>
          {<font></font>
            ledsOff();<font></font>
            nosleep = <span class="hljs-number">0</span>;<font></font>
            button_flag = <span class="hljs-number">0</span>;<font></font>
            buttIntStatus = <span class="hljs-number">0</span>;<font></font>
          }<font></font>
        }<font></font>
      } <span class="hljs-keyword">else</span> {<font></font>
        check_parent();<font></font>
      }<font></font>
    }<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (_transportSM.failureCounter &gt; <span class="hljs-number">0</span>)<font></font>
  {<font></font>
    _transportConfig.parentNodeId = loadState(<span class="hljs-number">101</span>);<font></font>
    _transportConfig.nodeId = myid;<font></font>
    _transportConfig.distanceGW = loadState(<span class="hljs-number">103</span>);<font></font>
    mypar = _transportConfig.parentNodeId;<font></font>
    nosleep = <span class="hljs-number">0</span>;<font></font>
    flag_fcount = <span class="hljs-number">1</span>;<font></font>
    err_delivery_beat = <span class="hljs-number">6</span>;<font></font>
    happy_node_mode();<font></font>
    gateway_fail();<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (nosleep == <span class="hljs-number">0</span>) {<font></font>
    oldmillis = millis();<font></font>
    axelIntStatus = <span class="hljs-number">0</span>;<font></font>
    buttIntStatus = <span class="hljs-number">0</span>;<font></font>
    gerkIntStatus = <span class="hljs-number">0</span>;<font></font>
    magIntStatus = <span class="hljs-number">0</span>;<font></font>
    sleep(SLEEP_TIME_W, <span class="hljs-literal">false</span>);<font></font>
    nosleep = <span class="hljs-number">1</span>;<font></font>
  }<font></font>
}<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">blinky</span><span class="hljs-params">(<span class="hljs-keyword">uint8_t</span> pulses, <span class="hljs-keyword">uint8_t</span> repit, <span class="hljs-keyword">uint8_t</span> ledColor)</span> </span>{
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> x = <span class="hljs-number">0</span>; x &lt; repit; x++) {
    <span class="hljs-keyword">if</span> (x &gt; <span class="hljs-number">0</span>) {<font></font>
      wait(<span class="hljs-number">150</span>);<font></font>
    }<font></font>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; pulses; i++) {
      <span class="hljs-keyword">if</span> (i &gt; <span class="hljs-number">0</span>) {<font></font>
        wait(<span class="hljs-number">40</span>);<font></font>
      }<font></font>
      digitalWrite(ledColor, LOW);<font></font>
      wait(<span class="hljs-number">10</span>);<font></font>
      digitalWrite(ledColor, HIGH);<font></font>
    }<font></font>
  }<font></font>
}<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">board_Init</span><span class="hljs-params">()</span> </span>{<font></font>
  pinMode(PIN_BUTTON, INPUT_PULLUP);<font></font>
  pinMode(MAGNET_INT, INPUT);<font></font>
  pinMode(GERKON_INT, INPUT);<font></font>
  pinMode(AXEL_INT, INPUT);<font></font>
  pinMode(RED_LED, OUTPUT);<font></font>
  pinMode(GREEN_LED, OUTPUT);<font></font>
  pinMode(BLUE_LED, OUTPUT);<font></font>
  ledsOff();<font></font>
  NRF_POWER-&gt;DCDCEN = <span class="hljs-number">1</span>;<font></font>
  wait(<span class="hljs-number">5</span>);
<span class="hljs-meta">#<span class="hljs-meta-keyword">ifndef</span> MY_DEBUG</span>
  NRF_UART0-&gt;ENABLE = <span class="hljs-number">0</span>;<font></font>
  wait(<span class="hljs-number">5</span>);
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span>
  <span class="hljs-comment">//NRF_NFCT-&gt;TASKS_DISABLE = 1;</span>
  <span class="hljs-comment">// NRF_NVMC-&gt;CONFIG = 1;</span>
  <span class="hljs-comment">// NRF_UICR-&gt;NFCPINS = 0;</span>
  <span class="hljs-comment">// NRF_NVMC-&gt;CONFIG = 0;</span>
  <span class="hljs-comment">// NRF_SAADC -&gt;ENABLE = 0;</span>
  <span class="hljs-comment">// NRF_PWM0  -&gt;ENABLE = 0;</span>
  <span class="hljs-comment">// NRF_PWM1  -&gt;ENABLE = 0;</span>
  <span class="hljs-comment">// NRF_PWM2  -&gt;ENABLE = 0;</span>
  <span class="hljs-comment">// NRF_TWIM1 -&gt;ENABLE = 0;</span>
  <span class="hljs-comment">// NRF_TWIS1 -&gt;ENABLE = 0;</span>
  NRF_RADIO-&gt;TXPOWER = <span class="hljs-number">8</span>;<font></font>
  wait(<span class="hljs-number">5</span>);<font></font>
<font></font>
  conf_vibro_set = loadState(<span class="hljs-number">230</span>);
  <span class="hljs-keyword">if</span> ((conf_vibro_set &gt; <span class="hljs-number">5</span>) || (conf_vibro_set == <span class="hljs-number">0</span>)) {<font></font>
    conf_vibro_set = <span class="hljs-number">2</span>;<font></font>
    saveState(<span class="hljs-number">230</span>, conf_vibro_set);<font></font>
  }<font></font>
<font></font>
  blinky(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, BLUE_LED);<font></font>
}<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">ledsOff</span><span class="hljs-params">()</span> </span>{<font></font>
  digitalWrite(RED_LED, HIGH);<font></font>
  digitalWrite(GREEN_LED, HIGH);<font></font>
  digitalWrite(BLUE_LED, HIGH);<font></font>
}<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">happy_init</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-comment">//hwWriteConfig(EEPROM_NODE_ID_ADDRESS, 255); // ******************** checking the node config reset *************************</span><font></font>
<font></font>
  <span class="hljs-keyword">if</span> (hwReadConfig(EEPROM_NODE_ID_ADDRESS) == <span class="hljs-number">0</span>) {<font></font>
    hwWriteConfig(EEPROM_NODE_ID_ADDRESS, <span class="hljs-number">255</span>);<font></font>
  }<font></font>
  <span class="hljs-keyword">if</span> (loadState(<span class="hljs-number">100</span>) == <span class="hljs-number">0</span>) {<font></font>
    saveState(<span class="hljs-number">100</span>, <span class="hljs-number">255</span>);<font></font>
  }<font></font>
  CORE_DEBUG(PSTR(<span class="hljs-string">"EEPROM NODE ID: %d\n"</span>), hwReadConfig(EEPROM_NODE_ID_ADDRESS));<font></font>
  CORE_DEBUG(PSTR(<span class="hljs-string">"USER MEMORY SECTOR NODE ID: %d\n"</span>), loadState(<span class="hljs-number">100</span>));<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (hwReadConfig(EEPROM_NODE_ID_ADDRESS) == <span class="hljs-number">255</span>) {<font></font>
    mtwr = <span class="hljs-number">0</span>;<font></font>
  } <span class="hljs-keyword">else</span> {<font></font>
    mtwr = <span class="hljs-number">11000</span>;<font></font>
    no_present();<font></font>
  }<font></font>
  CORE_DEBUG(PSTR(<span class="hljs-string">"MY_TRANSPORT_WAIT_MS: %d\n"</span>), mtwr);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">no_present</span><span class="hljs-params">()</span> </span>{<font></font>
  _coreConfig.presentationSent = <span class="hljs-literal">true</span>;<font></font>
  _coreConfig.nodeRegistered = <span class="hljs-literal">true</span>;<font></font>
}<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">interrupt_Init</span><span class="hljs-params">(<span class="hljs-keyword">bool</span> start)</span> </span>{
  <span class="hljs-comment">//***</span>
  <span class="hljs-comment">//SET</span>
  <span class="hljs-comment">//NRF_GPIO_PIN_NOPULL</span>
  <span class="hljs-comment">//NRF_GPIO_PIN_PULLUP</span>
  <span class="hljs-comment">//NRF_GPIO_PIN_PULLDOWN</span>
  <span class="hljs-comment">//***</span><font></font>
  nrf_gpio_cfg_input(PIN_BUTTON, NRF_GPIO_PIN_PULLUP);<font></font>
  nrf_gpio_cfg_input(AXEL_INT, NRF_GPIO_PIN_NOPULL);<font></font>
  nrf_gpio_cfg_input(GERKON_INT, NRF_GPIO_PIN_NOPULL);<font></font>
  nrf_gpio_cfg_input(MAGNET_INT, NRF_GPIO_PIN_NOPULL);<font></font>
  APP_GPIOTE_INIT(APP_GPIOTE_MAX_USERS);<font></font>
  PIN_BUTTON_MASK = <span class="hljs-number">1</span> &lt;&lt; PIN_BUTTON;<font></font>
  AXEL_INT_MASK = <span class="hljs-number">1</span> &lt;&lt; AXEL_INT;<font></font>
  GERKON_INT_MASK = <span class="hljs-number">1</span> &lt;&lt; GERKON_INT;<font></font>
  MAGNET_INT_MASK = <span class="hljs-number">1</span> &lt;&lt; MAGNET_INT;
  <span class="hljs-comment">//  app_gpiote_user_register(p_user_id, pins_low_to_high_mask, pins_high_to_low_mask, event_handler)</span>
  <span class="hljs-keyword">if</span> (start == <span class="hljs-number">0</span>) {<font></font>
    app_gpiote_user_register(&amp;m_gpiote_user_id, AXEL_INT_MASK | GERKON_INT_MASK, GERKON_INT_MASK | MAGNET_INT_MASK | PIN_BUTTON_MASK, gpiote_event_handler);<font></font>
    wait(<span class="hljs-number">5</span>);<font></font>
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (start == <span class="hljs-number">1</span>) {<font></font>
    app_gpiote_user_register(&amp;m_gpiote_user_id, GERKON_INT_MASK, GERKON_INT_MASK | MAGNET_INT_MASK | PIN_BUTTON_MASK, gpiote_event_handler);<font></font>
    wait(<span class="hljs-number">5</span>);<font></font>
  }<font></font>
  app_gpiote_user_enable(m_gpiote_user_id);<font></font>
  wait(<span class="hljs-number">5</span>);<font></font>
  axelIntStatus = <span class="hljs-number">0</span>;<font></font>
  buttIntStatus = <span class="hljs-number">0</span>;<font></font>
  gerkIntStatus = <span class="hljs-number">0</span>;<font></font>
  magIntStatus = <span class="hljs-number">0</span>;<font></font>
}<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">gpiote_event_handler</span><span class="hljs-params">(<span class="hljs-keyword">uint32_t</span> event_pins_low_to_high, <span class="hljs-keyword">uint32_t</span> event_pins_high_to_low)</span>
</span>{<font></font>
  MY_HW_RTC-&gt;CC[<span class="hljs-number">0</span>] = (MY_HW_RTC-&gt;COUNTER + <span class="hljs-number">2</span>); <span class="hljs-comment">// Taken from d0016 example code, ends the sleep delay</span><font></font>
<font></font>
  <span class="hljs-keyword">if</span> (PIN_BUTTON_MASK &amp; event_pins_high_to_low) {
    <span class="hljs-keyword">if</span> ((buttIntStatus == <span class="hljs-number">0</span>) &amp;&amp; (axelIntStatus == <span class="hljs-number">0</span>) &amp;&amp; (gerkIntStatus == <span class="hljs-number">0</span>) &amp;&amp; (magIntStatus == <span class="hljs-number">0</span>)) {<font></font>
      buttIntStatus = PIN_BUTTON;<font></font>
    }<font></font>
  }<font></font>
  <span class="hljs-keyword">if</span> (flag_nogateway_mode == <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">if</span> (AXEL_INT_MASK &amp; event_pins_low_to_high) {
      <span class="hljs-keyword">if</span> ((axelIntStatus == <span class="hljs-number">0</span>) &amp;&amp; (buttIntStatus == <span class="hljs-number">0</span>) &amp;&amp; (gerkIntStatus == <span class="hljs-number">0</span>) &amp;&amp; (magIntStatus == <span class="hljs-number">0</span>) &amp;&amp; (door_status == <span class="hljs-number">1</span>)) {<font></font>
        axelIntStatus = AXEL_INT;<font></font>
        axel_time0 = millis();<font></font>
      }<font></font>
    }<font></font>
    <span class="hljs-keyword">if</span> ((GERKON_INT_MASK &amp; event_pins_low_to_high) || (GERKON_INT_MASK &amp; event_pins_high_to_low)) {
      <span class="hljs-keyword">if</span> ((axelIntStatus == <span class="hljs-number">0</span>) &amp;&amp; (buttIntStatus == <span class="hljs-number">0</span>) &amp;&amp; (gerkIntStatus == <span class="hljs-number">0</span>) &amp;&amp; (magIntStatus == <span class="hljs-number">0</span>)) {<font></font>
        gerkIntStatus = GERKON_INT;<font></font>
      }<font></font>
    }<font></font>
    <span class="hljs-keyword">if</span> (MAGNET_INT_MASK &amp; event_pins_high_to_low) {
      <span class="hljs-keyword">if</span> ((axelIntStatus == <span class="hljs-number">0</span>) &amp;&amp; (buttIntStatus == <span class="hljs-number">0</span>) &amp;&amp; (gerkIntStatus == <span class="hljs-number">0</span>) &amp;&amp; (magIntStatus == <span class="hljs-number">0</span>) &amp;&amp; (door_status == <span class="hljs-number">1</span>)) {<font></font>
        magIntStatus = MAGNET_INT;<font></font>
      }<font></font>
    }<font></font>
  }<font></font>
}<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">sensors_Init</span><span class="hljs-params">()</span> </span>{<font></font>
  Wire.begin();<font></font>
  wait(<span class="hljs-number">100</span>);<font></font>
  lis2 = <span class="hljs-keyword">new</span> LIS2DW12Sensor (&amp;Wire);<font></font>
  vibro_Init();<font></font>
  <span class="hljs-keyword">if</span> (flag_nogateway_mode == <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">if</span> (digitalRead(GERKON_INT) == HIGH) {<font></font>
      door_status = <span class="hljs-number">1</span>;<font></font>
      interrupt_Init(<span class="hljs-number">0</span>);<font></font>
    } <span class="hljs-keyword">else</span> {<font></font>
      door_status = <span class="hljs-number">0</span>;<font></font>
      interrupt_Init(<span class="hljs-number">1</span>);<font></font>
    }<font></font>
    send(dwsMsg.<span class="hljs-built_in">set</span>(door_status));<font></font>
    wait(<span class="hljs-number">50</span>);<font></font>
<font></font>
    SLEEP_TIME_W = SLEEP_TIME;<font></font>
    axelIntStatus = <span class="hljs-number">0</span>;<font></font>
    buttIntStatus = <span class="hljs-number">0</span>;<font></font>
    gerkIntStatus = <span class="hljs-number">0</span>;<font></font>
    magIntStatus = <span class="hljs-number">0</span>;<font></font>
    sendBatteryStatus(<span class="hljs-number">0</span>);<font></font>
    wait(<span class="hljs-number">100</span>);<font></font>
    blinky(<span class="hljs-number">2</span>, <span class="hljs-number">1</span>, BLUE_LED);<font></font>
    wait(<span class="hljs-number">100</span>);<font></font>
    blinky(<span class="hljs-number">2</span>, <span class="hljs-number">1</span>, GREEN_LED);<font></font>
    wait(<span class="hljs-number">100</span>);<font></font>
    blinky(<span class="hljs-number">2</span>, <span class="hljs-number">1</span>, RED_LED);<font></font>
    axel_time = millis();<font></font>
  } <span class="hljs-keyword">else</span> {<font></font>
    interrupt_Init(<span class="hljs-number">0</span>);<font></font>
    blinky(<span class="hljs-number">5</span>, <span class="hljs-number">3</span>, RED_LED);<font></font>
  }<font></font>
}<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">config_Happy_node</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-keyword">if</span> (mtwr == <span class="hljs-number">0</span>) {<font></font>
    myid = getNodeId();<font></font>
    saveState(<span class="hljs-number">100</span>, myid);<font></font>
    mypar = _transportConfig.parentNodeId;<font></font>
    old_mypar = mypar;<font></font>
    saveState(<span class="hljs-number">101</span>, mypar);<font></font>
    saveState(<span class="hljs-number">102</span>, _transportConfig.distanceGW);<font></font>
  }<font></font>
  <span class="hljs-keyword">if</span> (mtwr != <span class="hljs-number">0</span>) {<font></font>
    myid = getNodeId();<font></font>
    <span class="hljs-keyword">if</span> (myid != loadState(<span class="hljs-number">100</span>)) {<font></font>
      saveState(<span class="hljs-number">100</span>, myid);<font></font>
    }<font></font>
    <span class="hljs-keyword">if</span> (isTransportReady() == <span class="hljs-literal">true</span>) {<font></font>
      mypar = _transportConfig.parentNodeId;<font></font>
      <span class="hljs-keyword">if</span> (mypar != loadState(<span class="hljs-number">101</span>)) {<font></font>
        saveState(<span class="hljs-number">101</span>, mypar);<font></font>
      }<font></font>
      <span class="hljs-keyword">if</span> (_transportConfig.distanceGW != loadState(<span class="hljs-number">102</span>)) {<font></font>
        saveState(<span class="hljs-number">102</span>, _transportConfig.distanceGW);<font></font>
      }<font></font>
      present_only_parent();<font></font>
    }<font></font>
    <span class="hljs-keyword">if</span> (isTransportReady() == <span class="hljs-literal">false</span>)<font></font>
    {<font></font>
      no_present();<font></font>
      flag_fcount = <span class="hljs-number">1</span>;<font></font>
      err_delivery_beat = <span class="hljs-number">6</span>;<font></font>
      _transportConfig.nodeId = myid;<font></font>
      _transportConfig.parentNodeId = loadState(<span class="hljs-number">101</span>);<font></font>
      _transportConfig.distanceGW = loadState(<span class="hljs-number">102</span>);<font></font>
      mypar = _transportConfig.parentNodeId;<font></font>
      happy_node_mode();<font></font>
      gateway_fail();<font></font>
    }<font></font>
  }<font></font>
}<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">send_Axel</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-keyword">if</span> (millis() - axel_time &gt;= <span class="hljs-number">5000</span>) {<font></font>
    blinky(<span class="hljs-number">2</span>, <span class="hljs-number">1</span>, GREEN_LED);<font></font>
    blinky(<span class="hljs-number">2</span>, <span class="hljs-number">1</span>, RED_LED);<font></font>
    blinky(<span class="hljs-number">2</span>, <span class="hljs-number">1</span>, GREEN_LED);<font></font>
    blinky(<span class="hljs-number">2</span>, <span class="hljs-number">1</span>, RED_LED);<font></font>
    blinky(<span class="hljs-number">2</span>, <span class="hljs-number">1</span>, GREEN_LED);<font></font>
    blinky(<span class="hljs-number">2</span>, <span class="hljs-number">1</span>, RED_LED);<font></font>
<font></font>
    send_a = send(vibroMsg.<span class="hljs-built_in">set</span>(vibro));<font></font>
    wait(<span class="hljs-number">50</span>);
    <span class="hljs-keyword">if</span> (send_a == <span class="hljs-literal">false</span>) {<font></font>
      send_a = send(vibroMsg.<span class="hljs-built_in">set</span>(vibro));<font></font>
      wait(<span class="hljs-number">100</span>);<font></font>
    }<font></font>
    <span class="hljs-keyword">if</span> (send_a == <span class="hljs-literal">true</span>) {<font></font>
      err_delivery_beat = <span class="hljs-number">0</span>;
      <span class="hljs-keyword">if</span> (flag_nogateway_mode == <span class="hljs-number">1</span>) {<font></font>
        flag_nogateway_mode = <span class="hljs-number">0</span>;<font></font>
        CORE_DEBUG(PSTR(<span class="hljs-string">"MyS: NORMAL GATEWAY MODE\n"</span>));<font></font>
        err_delivery_beat = <span class="hljs-number">0</span>;<font></font>
      }<font></font>
    } <span class="hljs-keyword">else</span> {<font></font>
      _transportSM.failedUplinkTransmissions = <span class="hljs-number">0</span>;
      <span class="hljs-keyword">if</span> (err_delivery_beat &lt; <span class="hljs-number">6</span>) {<font></font>
        err_delivery_beat++;<font></font>
      }<font></font>
      <span class="hljs-keyword">if</span> (err_delivery_beat == <span class="hljs-number">5</span>) {
        <span class="hljs-keyword">if</span> (flag_nogateway_mode == <span class="hljs-number">0</span>) {<font></font>
          gateway_fail();<font></font>
          CORE_DEBUG(PSTR(<span class="hljs-string">"MyS: LOST GATEWAY MODE\n"</span>));<font></font>
        }<font></font>
      }<font></font>
    }<font></font>
    axel_time = millis();<font></font>
    axelIntStatus = <span class="hljs-number">0</span>;<font></font>
    nosleep = <span class="hljs-number">0</span>;<font></font>
  } <span class="hljs-keyword">else</span> {<font></font>
    axelIntStatus = <span class="hljs-number">0</span>;<font></font>
    nosleep = <span class="hljs-number">0</span>;<font></font>
  }<font></font>
}<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">send_Gerkon</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-keyword">if</span> (digitalRead(GERKON_INT) == HIGH) {<font></font>
    door_status = <span class="hljs-number">1</span>;<font></font>
    interrupt_Init(<span class="hljs-number">0</span>);<font></font>
  } <span class="hljs-keyword">else</span> {<font></font>
    door_status = <span class="hljs-number">0</span>;<font></font>
    interrupt_Init(<span class="hljs-number">1</span>);<font></font>
  }<font></font>
  <span class="hljs-keyword">if</span> (door_status == <span class="hljs-number">1</span>) {<font></font>
    blinky(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, GREEN_LED);<font></font>
  } <span class="hljs-keyword">else</span> {<font></font>
    blinky(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, RED_LED);<font></font>
  }<font></font>
  send_a = send(dwsMsg.<span class="hljs-built_in">set</span>(door_status));<font></font>
  wait(<span class="hljs-number">50</span>);
  <span class="hljs-keyword">if</span> (send_a == <span class="hljs-literal">false</span>) {<font></font>
    send_a = send(dwsMsg.<span class="hljs-built_in">set</span>(door_status));<font></font>
    wait(<span class="hljs-number">100</span>);
    <span class="hljs-keyword">if</span> (send_a == <span class="hljs-literal">false</span>) {<font></font>
      send_a = send(dwsMsg.<span class="hljs-built_in">set</span>(door_status));<font></font>
      wait(<span class="hljs-number">150</span>);<font></font>
    }<font></font>
  }<font></font>
  <span class="hljs-keyword">if</span> (send_a == <span class="hljs-literal">true</span>) {<font></font>
    err_delivery_beat = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">if</span> (flag_nogateway_mode == <span class="hljs-number">1</span>) {<font></font>
      flag_nogateway_mode = <span class="hljs-number">0</span>;<font></font>
      CORE_DEBUG(PSTR(<span class="hljs-string">"MyS: NORMAL GATEWAY MODE\n"</span>));<font></font>
      err_delivery_beat = <span class="hljs-number">0</span>;<font></font>
    }<font></font>
  } <span class="hljs-keyword">else</span> {<font></font>
    _transportSM.failedUplinkTransmissions = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">if</span> (err_delivery_beat &lt; <span class="hljs-number">6</span>) {<font></font>
      err_delivery_beat++;<font></font>
    }<font></font>
    <span class="hljs-keyword">if</span> (err_delivery_beat == <span class="hljs-number">5</span>) {
      <span class="hljs-keyword">if</span> (flag_nogateway_mode == <span class="hljs-number">0</span>) {<font></font>
        gateway_fail();<font></font>
        CORE_DEBUG(PSTR(<span class="hljs-string">"MyS: LOST GATEWAY MODE\n"</span>));<font></font>
      }<font></font>
    }<font></font>
  }<font></font>
  gerkIntStatus = <span class="hljs-number">0</span>;<font></font>
  nosleep = <span class="hljs-number">0</span>;<font></font>
}<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">send_Magnet</span><span class="hljs-params">()</span> </span>{<font></font>
  blinky(<span class="hljs-number">2</span>, <span class="hljs-number">1</span>, BLUE_LED);<font></font>
  blinky(<span class="hljs-number">2</span>, <span class="hljs-number">1</span>, RED_LED);<font></font>
  blinky(<span class="hljs-number">2</span>, <span class="hljs-number">1</span>, BLUE_LED);<font></font>
  blinky(<span class="hljs-number">2</span>, <span class="hljs-number">1</span>, RED_LED);<font></font>
  blinky(<span class="hljs-number">2</span>, <span class="hljs-number">1</span>, BLUE_LED);<font></font>
  blinky(<span class="hljs-number">2</span>, <span class="hljs-number">1</span>, RED_LED);<font></font>
  send_a = send(mMsg.<span class="hljs-built_in">set</span>(magnet_status));<font></font>
  wait(<span class="hljs-number">50</span>);
  <span class="hljs-keyword">if</span> (send_a == <span class="hljs-literal">false</span>) {<font></font>
    send_a = send(mMsg.<span class="hljs-built_in">set</span>(magnet_status));<font></font>
    wait(<span class="hljs-number">100</span>);<font></font>
  }<font></font>
  <span class="hljs-keyword">if</span> (send_a == <span class="hljs-literal">true</span>) {<font></font>
    err_delivery_beat = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">if</span> (flag_nogateway_mode == <span class="hljs-number">1</span>) {<font></font>
      flag_nogateway_mode = <span class="hljs-number">0</span>;<font></font>
      CORE_DEBUG(PSTR(<span class="hljs-string">"MyS: NORMAL GATEWAY MODE\n"</span>));<font></font>
      err_delivery_beat = <span class="hljs-number">0</span>;<font></font>
    }<font></font>
  } <span class="hljs-keyword">else</span> {<font></font>
    _transportSM.failedUplinkTransmissions = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">if</span> (err_delivery_beat &lt; <span class="hljs-number">6</span>) {<font></font>
      err_delivery_beat++;<font></font>
    }<font></font>
    <span class="hljs-keyword">if</span> (err_delivery_beat == <span class="hljs-number">5</span>) {
      <span class="hljs-keyword">if</span> (flag_nogateway_mode == <span class="hljs-number">0</span>) {<font></font>
        gateway_fail();<font></font>
        CORE_DEBUG(PSTR(<span class="hljs-string">"MyS: LOST GATEWAY MODE\n"</span>));<font></font>
      }<font></font>
    }<font></font>
  }<font></font>
  magIntStatus = <span class="hljs-number">0</span>;<font></font>
  nosleep = <span class="hljs-number">0</span>;<font></font>
}<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">new_device</span><span class="hljs-params">()</span> </span>{<font></font>
  hwWriteConfig(EEPROM_NODE_ID_ADDRESS, <span class="hljs-number">255</span>);<font></font>
  saveState(<span class="hljs-number">100</span>, <span class="hljs-number">255</span>);<font></font>
  wdt_enable(WDTO_15MS);<font></font>
}<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">update_Happy_transport</span><span class="hljs-params">()</span> </span>{<font></font>
  CORE_DEBUG(PSTR(<span class="hljs-string">"MyS: UPDATE TRANSPORT CONFIGURATION\n"</span>));<font></font>
  mypar = _transportConfig.parentNodeId;<font></font>
  <span class="hljs-keyword">if</span> (mypar != loadState(<span class="hljs-number">101</span>))<font></font>
  {<font></font>
    saveState(<span class="hljs-number">101</span>, mypar);<font></font>
  }<font></font>
  <span class="hljs-keyword">if</span> (_transportConfig.distanceGW != loadState(<span class="hljs-number">102</span>))<font></font>
  {<font></font>
    saveState(<span class="hljs-number">102</span>, _transportConfig.distanceGW);<font></font>
  }<font></font>
  present_only_parent();<font></font>
  wait(<span class="hljs-number">50</span>);<font></font>
  nosleep = <span class="hljs-number">0</span>;<font></font>
  flag_update_transport_param = <span class="hljs-number">0</span>;<font></font>
}<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">present_only_parent</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-keyword">if</span> (old_mypar != mypar) {<font></font>
    CORE_DEBUG(PSTR(<span class="hljs-string">"MyS: SEND LITTLE PRESENT:) WITH PARENT ID\n"</span>));
    <span class="hljs-keyword">if</span> (_sendRoute(build(_msgTmp, <span class="hljs-number">0</span>, NODE_SENSOR_ID, C_INTERNAL, <span class="hljs-number">6</span>).<span class="hljs-built_in">set</span>(mypar))) {<font></font>
      flag_sendRoute_parent = <span class="hljs-number">0</span>;<font></font>
      old_mypar = mypar;<font></font>
    } <span class="hljs-keyword">else</span> {<font></font>
      flag_sendRoute_parent = <span class="hljs-number">1</span>;<font></font>
    }<font></font>
  }<font></font>
}<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">happy_node_mode</span><span class="hljs-params">()</span> </span>{<font></font>
  _transportSM.findingParentNode = <span class="hljs-literal">false</span>;<font></font>
  _transportSM.transportActive = <span class="hljs-literal">true</span>;<font></font>
  _transportSM.uplinkOk = <span class="hljs-literal">true</span>;<font></font>
  _transportSM.pingActive = <span class="hljs-literal">false</span>;<font></font>
  _transportSM.failureCounter = <span class="hljs-number">0</span>;<font></font>
  _transportSM.uplinkOk = <span class="hljs-literal">true</span>;<font></font>
  _transportSM.failureCounter = <span class="hljs-number">0u</span>;<font></font>
  _transportSM.failedUplinkTransmissions = <span class="hljs-number">0u</span>;<font></font>
  transportSwitchSM(stReady);<font></font>
  CORE_DEBUG(PSTR(<span class="hljs-string">"TRANSPORT: %d\n"</span>), isTransportReady());<font></font>
}<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">gateway_fail</span><span class="hljs-params">()</span> </span>{<font></font>
  flag_nogateway_mode = <span class="hljs-number">1</span>;<font></font>
  flag_update_transport_param = <span class="hljs-number">0</span>;<font></font>
  SLEEP_TIME_W = SLEEP_NOGW;<font></font>
}<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">check_parent</span><span class="hljs-params">()</span> </span>{<font></font>
  _transportSM.findingParentNode = <span class="hljs-literal">true</span>;<font></font>
  CORE_DEBUG(PSTR(<span class="hljs-string">"MyS: SEND FIND PARENT REQUEST, WAIT RESPONSE\n"</span>));<font></font>
  _sendRoute(build(_msg, <span class="hljs-number">255</span>, NODE_SENSOR_ID, C_INTERNAL, <span class="hljs-number">7</span>).<span class="hljs-built_in">set</span>(<span class="hljs-string">""</span>));<font></font>
  wait(<span class="hljs-number">1500</span>, C_INTERNAL, <span class="hljs-number">8</span>);
  <span class="hljs-keyword">if</span> (_msg.sensor == <span class="hljs-number">255</span>) {
    <span class="hljs-keyword">if</span> (mGetCommand(_msg) == <span class="hljs-number">3</span>) {
      <span class="hljs-keyword">if</span> (_msg.type == <span class="hljs-number">8</span>) {<font></font>
        Ack_FP = <span class="hljs-number">1</span>;<font></font>
        CORE_DEBUG(PSTR(<span class="hljs-string">"MyS: PARENT RESPONSE FOUND\n"</span>));<font></font>
      }<font></font>
    }<font></font>
  }<font></font>
  <span class="hljs-keyword">if</span> (Ack_FP == <span class="hljs-number">1</span>) {<font></font>
    CORE_DEBUG(PSTR(<span class="hljs-string">"MyS: FIND PARENT PROCESS\n"</span>));<font></font>
    Ack_FP = <span class="hljs-number">0</span>;<font></font>
    transportSwitchSM(stParent);<font></font>
    flag_nogateway_mode = <span class="hljs-number">0</span>;<font></font>
    flag_find_parent_process = <span class="hljs-number">1</span>;<font></font>
    problem_mode_count = <span class="hljs-number">0</span>;<font></font>
  } <span class="hljs-keyword">else</span> {<font></font>
    _transportSM.findingParentNode = <span class="hljs-literal">false</span>;<font></font>
    CORE_DEBUG(PSTR(<span class="hljs-string">"MyS: PARENT RESPONSE NOT FOUND\n"</span>));<font></font>
    _transportSM.failedUplinkTransmissions = <span class="hljs-number">0</span>;<font></font>
    CORE_DEBUG(PSTR(<span class="hljs-string">"TRANSPORT: %d\n"</span>), isTransportReady());<font></font>
    nosleep = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">if</span> (problem_mode_count &lt; <span class="hljs-number">9</span>) {<font></font>
      CORE_DEBUG(PSTR(<span class="hljs-string">"PROBLEM MODE COUNTER: %d\n"</span>), problem_mode_count);<font></font>
      problem_mode_count++;<font></font>
      SLEEP_TIME_W = SLEEP_TIME_W + SLEEP_TIME_W;<font></font>
    }<font></font>
  }<font></font>
}<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">find_parent_process</span><span class="hljs-params">()</span> </span>{<font></font>
  flag_update_transport_param = <span class="hljs-number">1</span>;<font></font>
  flag_find_parent_process = <span class="hljs-number">0</span>;<font></font>
  CORE_DEBUG(PSTR(<span class="hljs-string">"MyS: STANDART TRANSPORT MODE IS RESTORED\n"</span>));<font></font>
  err_delivery_beat = <span class="hljs-number">0</span>;<font></font>
  SLEEP_TIME_W = SLEEP_TIME;<font></font>
  nosleep = <span class="hljs-number">0</span>;<font></font>
}<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">sendBatteryStatus</span><span class="hljs-params">(<span class="hljs-keyword">bool</span> start)</span> </span>{<font></font>
  batt_cap = battery_level_in_percent(batteryVoltage);<font></font>
  <span class="hljs-keyword">if</span> (start == <span class="hljs-number">1</span>) {
    <span class="hljs-comment">//if (batt_cap &lt; old_batt_cap) {</span>
    sendBatteryLevel(battery_level_in_percent(batteryVoltage), <span class="hljs-number">1</span>);<font></font>
    wait(<span class="hljs-number">1500</span>, C_INTERNAL, I_BATTERY_LEVEL);<font></font>
    old_batt_cap = batt_cap;<font></font>
    <span class="hljs-comment">// }</span>
  } <span class="hljs-keyword">else</span> {<font></font>
    sendBatteryLevel(battery_level_in_percent(batteryVoltage), <span class="hljs-number">1</span>);<font></font>
    wait(<span class="hljs-number">1500</span>, C_INTERNAL, I_BATTERY_LEVEL);<font></font>
  }<font></font>
<font></font>
  linkQuality = calculationRxQuality();<font></font>
  <span class="hljs-keyword">if</span> (linkQuality != old_linkQuality) {<font></font>
    wait(<span class="hljs-number">10</span>);<font></font>
    sendSignalStrength(linkQuality);<font></font>
    wait(<span class="hljs-number">50</span>);<font></font>
    old_linkQuality = linkQuality;<font></font>
  }<font></font>
}<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">sendSignalStrength</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">int16_t</span> level, <span class="hljs-keyword">const</span> <span class="hljs-keyword">bool</span> ack)</span>
</span>{
  <span class="hljs-keyword">return</span> _sendRoute(build(_msgTmp, GATEWAY_ADDRESS, SIGNAL_Q_ID, C_SET, V_VAR1,<font></font>
                          ack).<span class="hljs-built_in">set</span>(level));<font></font>
}<font></font>
<span class="hljs-function"><span class="hljs-keyword">int16_t</span> <span class="hljs-title">calculationRxQuality</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-keyword">int16_t</span> nRFRSSI_temp = transportGetReceivingRSSI();
  <span class="hljs-keyword">int16_t</span> nRFRSSI = <span class="hljs-built_in">map</span>(nRFRSSI_temp, <span class="hljs-number">-85</span>, <span class="hljs-number">-40</span>, <span class="hljs-number">0</span>, <span class="hljs-number">100</span>);
  <span class="hljs-keyword">if</span> (nRFRSSI &lt; <span class="hljs-number">0</span>) {<font></font>
    nRFRSSI = <span class="hljs-number">0</span>;<font></font>
  }<font></font>
  <span class="hljs-keyword">if</span> (nRFRSSI &gt; <span class="hljs-number">100</span>) {<font></font>
    nRFRSSI = <span class="hljs-number">100</span>;<font></font>
  }<font></font>
  <span class="hljs-keyword">return</span> nRFRSSI;<font></font>
}<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">receive</span><span class="hljs-params">(<span class="hljs-keyword">const</span> MyMessage &amp; message)</span>
</span>{
  <span class="hljs-keyword">if</span> (message.sensor == LEVEL_SENSIV_V_SENS_CHILD_ID) {
    <span class="hljs-keyword">if</span> (message.type == V_VAR1) {<font></font>
      conf_vibro_set = message.getByte();<font></font>
      vibro_Init();<font></font>
      saveState(<span class="hljs-number">230</span>, conf_vibro_set);<font></font>
      wait(<span class="hljs-number">200</span>);<font></font>
      send(conf_vsensMsg.<span class="hljs-built_in">set</span>(conf_vibro_set));<font></font>
      wait(<span class="hljs-number">200</span>);<font></font>
      blinky(<span class="hljs-number">3</span>, <span class="hljs-number">3</span>, GREEN_LED);<font></font>
      configMode = <span class="hljs-number">0</span>;<font></font>
      nosleep = <span class="hljs-number">0</span>;<font></font>
    }<font></font>
  }<font></font>
}<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">vibro_Init</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-keyword">if</span> (conf_vibro_set == <span class="hljs-number">1</span>) {<font></font>
    lis2-&gt;ODRTEMP = ODR_1Hz6_LP_ONLY;<font></font>
  }<font></font>
  <span class="hljs-keyword">if</span> (conf_vibro_set == <span class="hljs-number">2</span>) {<font></font>
    lis2-&gt;ODRTEMP = ODR_12Hz5;<font></font>
  }<font></font>
  <span class="hljs-keyword">if</span> (conf_vibro_set == <span class="hljs-number">3</span>) {<font></font>
    lis2-&gt;ODRTEMP = ODR_25Hz;<font></font>
  }<font></font>
  <span class="hljs-keyword">if</span> (conf_vibro_set == <span class="hljs-number">4</span>) {<font></font>
    lis2-&gt;ODRTEMP = ODR_100Hz;<font></font>
  }<font></font>
  <span class="hljs-keyword">if</span> (conf_vibro_set == <span class="hljs-number">5</span>) {<font></font>
    lis2-&gt;ODRTEMP = ODR_200Hz;<font></font>
  }<font></font>
  lis2-&gt;Enable_X();<font></font>
  wait(<span class="hljs-number">100</span>);<font></font>
  lis2-&gt;Enable_Wake_Up_Detection();<font></font>
  wait(<span class="hljs-number">100</span>);<font></font>
}<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">git</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
上提供了项目文件的完整列表</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
作为UD系统，我已经使用</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Majordomo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">很长时间了</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在本文中，我将描述一个传感器如何通过UD控制器在Maysensors网络中工作的示例。</font><font style="vertical-align: inherit;">在此实施例中，来自传感器的数据通过Maysensors网关发送到UD系统。</font><font style="vertical-align: inherit;">Majordomo </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在单独的模块中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实现了对Mysensors协议的支持</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">UD系统的附加组件市场的“设备”部分中提供了用于下载和安装的模块。</font></font><br>
<img src="https://habrastorage.org/webt/22/ho/ia/22hoiaoqgc-wbzualelk3bhxks8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
目前，Majordomo UD的实施是最完整的，受支持的：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所有Mesensors数据类型，</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与OTA合作，</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在一个模块（多门）中一次处理多个网络， </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SmartSleep设备支持， </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模块启动时向网络中的传感器请求数据， </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">消息传递确认请求， </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持服务请求，例如数据收集，心跳，演示，重启，</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与NodeManager一起工作</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
当然，在系统自然发展的过程中，存在一些缺陷，即以前添加的对串行网关的支持，Majordomo订购的使用寿命很长，目前不受支持。</font><font style="vertical-align: inherit;">我什至没有机会在Majordomo中测试这种类型的门，因为在我发现Mysensors之前，该功能就不可用了。</font><font style="vertical-align: inherit;">模块开发人员承诺将在2019年9月之前再次添加此功能，但是19月的秋天已经过去了，并且仍然不支持该系列网关:(。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
您也可以将Mysensors mqtt网关与Majordomo一起使用，但不能通过Mysensors模块，而是通过MQTT模块。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在我的传感器中，震动传感器和磁场传感器仅在触发时才传输一个单元，事实证明这是一个小问题。 “简单设备”模块不支持这些类型的传感器，当然有一个通用的传感器，但是其自定义设置非常有限。添加传感器时，一个不舒服的问题是，当下一个单元来自传感器时，我必须启动一个反向计时器，以便在计时器指定的时间间隔后，将零写入对象属性。但是，由于一切都通过“状态更新”方法工作，然后写入零，因此接收新状态的meysensors模块将包含此数据的消息发送到网络，并发送到我的设备，该点为零。在我看来，最简单的解决方案是添加一个新方法，该方法将转移从property1到property2的状态，并启动一个计时器，将零写入property2。在简单设备中创建的对象将与property2一起使用，在Maysensors模块中将与property1一起使用。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ne/n0/ui/nen0uibfj0kw4wuupvbxr9z7zoo.png"><br>
<br>
<pre><code class="php hljs"><span class="hljs-keyword">if</span>(<span class="hljs-keyword">$this</span>-&gt;getProperty(<span class="hljs-string">'value2'</span>) == <span class="hljs-string">'1'</span>){
<span class="hljs-keyword">$this</span>-&gt;setProperty(<span class="hljs-string">'status'</span>,<span class="hljs-string">'1'</span>);<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
接下来，在所需对象的状态更新方法中，您需要添加一个计时器启动：</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-keyword">if</span> (gg(<span class="hljs-string">"MysensorsSmoke03.status"</span>) == <span class="hljs-string">"1"</span>) {<font></font>
SetTimeOut(<span class="hljs-string">'AlarmShock'</span>,<span class="hljs-string">'sg("MysensorsSmoke03.status","0");'</span>,<span class="hljs-number">10</span>);<font></font>
}<font></font>
</code></pre><br>
<b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在Majordomo系统和Majordroid应用程序</font><b><font style="vertical-align: inherit;">中具有传感器操作的视频</font></b><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">我建议您尽可能地看一下它，以显示主要功能的操作，当然，对于我的小家庭频道而言，您的喜欢和订阅特别宝贵，但是单击铃铛，您将不会错过带有新传感器的视频;）。</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/OmclWv2vLog" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
设备板是使用DeepTrace程序制成的。</font><font style="vertical-align: inherit;">这款用于电子产品开发的编辑器的开发曾经使我极大地扩展了自己的能力。</font><font style="vertical-align: inherit;">我注意到我不是专业的电子工程师，我在主板家庭开发方面的经验为一年半或两年。</font><font style="vertical-align: inherit;">对于建议在面包板上制作设备的每个人，我建议尝试学习某种编辑器，YouTube上有很多视频手册。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/qh/qn/oc/qhqnocyny82yvitjx84lso-irzo.png"><br>
<br>
<img src="https://habrastorage.org/webt/dw/vi/ez/dwviez3dctkm_yuxfawnlto9lrm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maysensors对nRF5芯片的支持基于Sandeep Mistry库-arduino-nRF5。但是，该库缺少对nRF52840，nRF52810芯片和全新nRF52811芯片的支持。我不得不增加对这些芯片的支持，Nordic SDK进行了移植和改编。由于不需要使用Mysensors，因此不支持软设备，并且不支持nRF52840芯片的Port1。最近，我在这个主题上的研究</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与Maysensors社区</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的另一位</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">成员</font></a><font style="vertical-align: inherit;">的研究</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">相结合，</font></a><font style="vertical-align: inherit;">结果，已经通过port1获得了对nRF52840的支持，销钉成了一片大海。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
传感器的外壳是在SolidWorks程序中开发的，它也是独立于大约一年前在YouTube上的课程而熟练掌握的。案件被打印在ANYCUBIC FOTON SLA打印机上。我对打印质量和准确性感到非常满意。唯一的负面影响是，这类家用打印机无法使用的UV树脂的选择相当差。设备外壳的尺寸：长43毫米，宽26毫米，高12.5毫米。带磁铁的表壳尺寸：长37毫米，宽11毫米，高12.5毫米。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/my/hm/97/myhm97dmggj8d7sdauhlx9oyk5c.png"><br>
<br>
<img src="https://habrastorage.org/webt/wz/9j/cy/wz9jcyajh87x1l7zlncvy_eb1sy.png"><br>
<br>
<img src="https://habrastorage.org/webt/e4/u-/rw/e4u-rwqymkdi701zplhs_b3kn-e.png"><br>
<br>
<img src="https://habrastorage.org/webt/r1/ve/h4/r1veh45ljjnvdwjlappikjgxr_g.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
理想情况下，传感器功耗范围为4μA至7μA，具体取决于所选的芯片。数据传输模式下的功耗为8​​ mA。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
传感器使用CR2032电池。鉴于缺少分析器（由于其相当大的成本），所有测量均由中文“ multifiler”进行：:。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
该设备可以重复使用，使用书面草图或自己编写。</font><font style="vertical-align: inherit;">要重复传感器，您需要的所有内容都放在我的github上（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gerberas，代码，案例模型</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果有人准备协助按照ZIGBEE协议编写软件，我将很乐意合作。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果您对此项目感兴趣，请访问电报组，他们不仅会帮助您</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">熟练</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">掌握</font><b><font style="vertical-align: inherit;">Maysensors</font></b><font style="vertical-align: inherit;">协议</font><font style="vertical-align: inherit;">，而且还</font><font style="vertical-align: inherit;">可以帮助您掌握</font><b><font style="vertical-align: inherit;">nRF5上的</font></b></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zigbee</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BLE</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，他们会迅速为您提供有关Arduino IDE中nRF52编程的所有问题的建议，不仅限于此。</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">购物</font></a></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
车在我住的地方和像我这样的人聊天- </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@ MYSENSORS_RUS</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
对所有人都好！</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN490464/index.html">关于暴力版权或680亿首曲调的成功尝试，不会改变任何事情</a></li>
<li><a href="../zh-CN490466/index.html">机器学习数学学科的路线图，第2部分（概率）</a></li>
<li><a href="../zh-CN490470/index.html">OWASP莫斯科2020/1</a></li>
<li><a href="../zh-CN490472/index.html">当我用PHP编写半分散式加密货币时。（第1部分-馆藏）</a></li>
<li><a href="../zh-CN490474/index.html">STM32第1部分：基础知识</a></li>
<li><a href="../zh-CN490478/index.html">DIY DIY焊接站v2</a></li>
<li><a href="../zh-CN490480/index.html">O Tiling-wm用2个词</a></li>
<li><a href="../zh-CN490484/index.html">使用Google Assistant管理智能家居传感器</a></li>
<li><a href="../zh-CN490490/index.html">周末读物：10种有关声音对健康影响的材料-从“噪音卫生”到良好的睡眠和GTD</a></li>
<li><a href="../zh-CN490492/index.html">仓库机器人学习对非标准物品进行分类</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>