<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🌲 🕣 👩🏽‍🤝‍👨🏾 Código moderno para fazer solicitações HTTP no Swift 5 usando Combine e usá-las no SwiftUI. Parte 1 🌱 🔁 👨🏾‍🔧</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A consulta HTTPé uma das habilidades mais importantes que você precisa obter ao desenvolver iOSaplicativos. Nas versões anteriores Swift(até a versão ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Código moderno para fazer solicitações HTTP no Swift 5 usando Combine e usá-las no SwiftUI. Parte 1</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/488442/"><img src="https://habrastorage.org/webt/uk/tq/y4/uktqy4xvl1cqefjbmvzdzydqj-g.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A consulta </font></font><code>HTTP</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é uma das habilidades mais importantes que você precisa obter ao desenvolver </font></font><code>iOS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aplicativos. Nas versões anteriores </font></font><code>Swift</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(até a versão 5), independentemente de você ter gerado essas solicitações "do zero" ou usando a conhecida estrutura </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alamofire</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , você acabou com um código de </font></font><code>callback </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tipo&nbsp; </font><font style="vertical-align: inherit;">complexo e confuso </font></font><code>completionHandler: @escaping(Result&lt;T, APIError&gt;) -&gt; Void</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A aparência na </font></font><code>Swift 5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nova estrutura da programação reativa funcional </font></font><code>Combine</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">em conjunto com a existente </font></font><code>URLSession</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><code>Codable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fornece a você todas as ferramentas necessárias para a gravação independente de códigos muito compactos para buscar dados da Internet. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Neste artigo, de acordo com o conceito, </font></font><code>Combine</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">criaremos "editores"</font></font><code>Publisher</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para selecionar dados da Internet, nos quais podemos "facilmente assinar" no futuro e usar ao projetar </font></font><code>UI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">com&nbsp; </font></font><code>UIKit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e com ajuda&nbsp; </font></font><code>SwiftUI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como&nbsp; </font></font><code>SwiftUI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">parece mais conciso e mais eficaz, porque a ação dos "editores"&nbsp; </font></font><code>Publisher</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">não se limita apenas aos dados de amostra e se estende até o controle da interface do usuário ( </font></font><code>UI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). O fato é que </font></font><code>SwiftUI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a separação de dados é&nbsp; </font></font><code>View </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">realizada usando </font></font><code>ObservableObject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">classes com </font></font><code>@Published</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">propriedades, cujas alterações são&nbsp; </font></font><code>SwiftUI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">monitoradas AUTOMATICAMENTE e redesenhadas completamente </font></font><code>View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nessas&nbsp; </font></font><code>ObservableObject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">classes, você pode simplesmente colocar uma certa lógica comercial do aplicativo, se alguns deles</font></font><code>@Published</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;propriedades são o resultado de síncronos e / ou assíncronos de transformação outras </font></font><code>@Published </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;propriedades que podem ser alterados directamente tais elementos "activos" da interface de utilizador ( </font></font><code>UI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) como caixas de texto </font></font><code>TextField</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>Picker</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>Stepper</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>Toggle</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">etc.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para deixar claro o que está em jogo, darei exemplos específicos. Agora, muitos serviços, como </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> &nbsp;e </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hacker News,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> oferecem </font><font style="vertical-align: inherit;">agregadores de notícias para&nbsp; </font><font style="vertical-align: inherit;">oferecer aos usuários a escolha de diferentes conjuntos de artigos, dependendo do que lhes interessa. No caso do </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">agregador de</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> notícias&nbsp; </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">NewsAPI.org,</font></a><font style="vertical-align: inherit;"> podem ser as últimas notícias ou notícias de alguma categoria - "esporte", "saúde", "ciência", "tecnologia", "negócios" ou notícias de uma fonte de informação específica "CNN" , Notícias da ABC, Bloomberg, etc. O usuário geralmente "expressa" seus desejos por serviços na forma </font></font><code>Endpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que for necessária </font></font><code>URL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Então, usando a estrutura&nbsp; </font></font><code>Combine</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, você pode</font></font><code>ObservableObject </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">classes usando um código muito compacto (na maioria dos casos, não mais que 10 a 12 linhas) uma vez para formar uma dependência síncrona e / ou assíncrona da lista de artigos&nbsp; </font></font><code>Endpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">na forma de uma "assinatura" de </font></font><code>@Published </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">propriedades </font><font style="vertical-align: inherit;">"passivas" </font><font style="vertical-align: inherit;">para propriedades "ativas" </font></font><code>@Published </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Essa "assinatura" será válida durante todo o "ciclo de vida" da instância da&nbsp; </font></font><code>ObservableObject </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">classe. E então, </font></font><code>SwiftUI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;você dará ao usuário a oportunidade de gerenciar apenas as </font></font><code>@Published </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">propriedades </font><font style="vertical-align: inherit;">"ativas" </font><font style="vertical-align: inherit;">no formulário </font></font><code>Endpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, ou seja, O QUE ele deseja ver: se serão artigos com as últimas notícias ou artigos na seção "saúde". A aparência dos artigos em si, com as últimas notícias ou artigos na seção "saúde", </font></font><code>UI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;será fornecida AUTOMATICAMENTE por essas&nbsp; </font></font><code>ObservableObject </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">classes e suas propriedades @ passivas "publicadas". Em código</font></font><code>SwiftUI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;você nunca precisará solicitar explicitamente uma seleção de artigos, porque as </font></font><code>ObservableObject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">classes que desempenham um papel são </font><font style="vertical-align: inherit;">responsáveis ​​por sua exibição correta e síncrona na tela&nbsp; </font></font><code>View Model</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vou mostrar como isso funciona com o&nbsp; </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> &nbsp;e o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hacker News</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">banco de dados de</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> filmes </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">TMDb</font></a><font style="vertical-align: inherit;"> em uma série de artigos. Nos três casos, aproximadamente o mesmo padrão de uso funcionará&nbsp; </font></font><code>Combine</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, porque em aplicativos desse tipo você sempre deve criar LISTAS de filmes ou artigos, escolha as “FOTOS” (imagens) que os acompanham, PESQUISA nas bases de dados dos filmes ou artigos necessários usando a barra de pesquisa.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ao acessar esses serviços, podem ocorrer erros, por exemplo, devido ao fato de você ter especificado a chave errada </font></font><code>API-key</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou ter excedido o número permitido de solicitações ou outra coisa. Você precisa lidar com esse tipo de erro, caso contrário, corre o risco de deixar o usuário completamente perdido com uma tela em branco. Portanto, você precisa não apenas selecionar </font></font><code>&nbsp;Combine</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;dados da Internet </font><font style="vertical-align: inherit;">usando </font><font style="vertical-align: inherit;">, mas também reportar erros que podem ocorrer durante a amostragem e controlar sua aparência na tela. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Começaremos a desenvolver nossa estratégia, desenvolvendo um aplicativo que interaja com o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">agregador de</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> notícias&nbsp; </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">NewsAPI.org</font></a><font style="vertical-align: inherit;"> . Devo dizer que, neste aplicativo, ele </font></font><code>SwiftUI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">será usado no mínimo, sem frescuras e apenas para mostrar como, </font></font><code>Combine</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">com seus "editores"</font></font><code>Publisher</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e "assinatura" são </font></font><code>Subscription</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">afetados </font></font><code>UI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
É recomendável que você se registre no site </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e receba a chave </font></font><code>API</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">necessária para concluir qualquer solicitação ao serviço </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Você deve colocá-lo no arquivo </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.swift</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> na estrutura </font></font><code>APIConstants</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O código do aplicativo para este artigo está no </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Github</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Modelo de dados de serviço e API do </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.org</font></font></a></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O serviço&nbsp; </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> permite selecionar informações sobre os artigos de notícias atuais </font></font><code> [Article]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e suas fontes&nbsp; </font></font><code>[Source]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Nosso modelo de dados será muito simples, está localizado no arquivo&nbsp; </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Articles.swift</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-keyword">import</span> Foundation<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">NewsResponse</span>: <span class="hljs-title">Codable</span> </span>{
    <span class="hljs-keyword">let</span> status: <span class="hljs-type">String?</span>
    <span class="hljs-keyword">let</span> totalResults: <span class="hljs-type">Int?</span>
    <span class="hljs-keyword">let</span> articles: [<span class="hljs-type">Article</span>]<font></font>
}<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Article</span>: <span class="hljs-title">Codable</span>, <span class="hljs-title">Identifiable</span> </span>{
    <span class="hljs-keyword">let</span> id = <span class="hljs-type">UUID</span>()
    <span class="hljs-keyword">let</span> title: <span class="hljs-type">String</span>
    <span class="hljs-keyword">let</span> description: <span class="hljs-type">String?</span>
    <span class="hljs-keyword">let</span> author: <span class="hljs-type">String?</span>
    <span class="hljs-keyword">let</span> urlToImage: <span class="hljs-type">String?</span>
    <span class="hljs-keyword">let</span> publishedAt: <span class="hljs-type">Date?</span>
    <span class="hljs-keyword">let</span> source: <span class="hljs-type">Source</span><font></font>
}<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">SourcesResponse</span>: <span class="hljs-title">Codable</span> </span>{
    <span class="hljs-keyword">let</span> status: <span class="hljs-type">String</span>
    <span class="hljs-keyword">let</span> sources: [<span class="hljs-type">Source</span>]<font></font>
}<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Source</span>: <span class="hljs-title">Codable</span>,<span class="hljs-title">Identifiable</span> </span>{
    <span class="hljs-keyword">let</span> id: <span class="hljs-type">String?</span>
    <span class="hljs-keyword">let</span> name: <span class="hljs-type">String?</span>
    <span class="hljs-keyword">let</span> description: <span class="hljs-type">String?</span>
    <span class="hljs-keyword">let</span> country: <span class="hljs-type">String?</span>
    <span class="hljs-keyword">let</span> category: <span class="hljs-type">String?</span>
    <span class="hljs-keyword">let</span> url: <span class="hljs-type">String?</span><font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O artigo </font></font><code>Article</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">conterá o identificador </font></font><code>id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, título </font></font><code> title</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, descrição </font></font><code>&nbsp;description</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, autor </font></font><code>author</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, URL da “imagem” </font></font><code>urlToImage</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, data da publicação </font></font><code>publishedAt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e fonte da publicação </font></font><code>source</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Acima dos artigos, </font></font><code>[Article]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">há um complemento </font></font><code>NewsResponse</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no qual estaremos interessados ​​apenas na propriedade </font></font><code>articles</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, que é uma variedade de artigos. A estrutura raiz </font></font><code>NewsResponse</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e a estrutura </font></font><code>&nbsp;Article</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">são </font></font><code>Codable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, o que nos permitirá literalmente duas linhas de código decodificando os </font></font><code>JSON</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dados no Modelo. A estrutura&nbsp; </font></font><code>Article</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;também deve ser </font></font><code>Identifiable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, se queremos tornar mais fácil para nós para exibir uma série de artigos </font></font><code>[Article]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">como uma lista&nbsp; </font></font><code>List</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;em </font></font><code>SwiftUI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Protocolo </font></font><code>Identifiable </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">requer a presença de uma propriedade</font></font><code>id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que forneceremos com um identificador exclusivo artificial </font></font><code>UUID()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A fonte de informações&nbsp; </font></font><code>Source</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">conterá um identificador </font></font><code> id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, nome </font></font><code> name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, descrição&nbsp; </font></font><code>description</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, país </font></font><code> country</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, categoria de fonte de publicação </font></font><code>category</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, URL do site </font></font><code>url</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Acima das fontes de informação,&nbsp; </font></font><code>[Source] </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">há um complemento&nbsp; </font></font><code>SourcesResponse</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no qual estaremos interessados ​​apenas em uma propriedade </font></font><code>sources</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, que é uma matriz de fontes de informação. A estrutura </font></font><code>SourcesResponse</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e a&nbsp; </font><font style="vertical-align: inherit;">estrutura raiz </font></font><code>Source</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">são </font></font><code>Codable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, o que nos permitirá decodificar com muita facilidade os </font></font><code> JSON</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dados em um modelo. A estrutura&nbsp; </font></font><code>Source</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;também deve ser </font></font><code>Identifiable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, se quisermos facilitar a exibição de uma matriz de fontes de informação </font></font><code>&nbsp;[Source]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">na forma de uma lista </font></font><code>&nbsp;List</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;em</font></font><code>SwiftUI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">O protocolo </font></font><code>Identifiable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">requer a presença da propriedade </font></font><code>id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que já possuímos, portanto nenhum esforço adicional será necessário de nós. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora considere o que precisamos&nbsp; </font></font><code>API</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para o serviço&nbsp; </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e coloque-o no arquivo&nbsp; </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.swift</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">A parte central da nossa </font></font><code>API</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;é uma classe </font></font><code>NewsAPI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que apresenta dois métodos para selecionar dados do </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">agregador de</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> notícias&nbsp;&nbsp; </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">NewsAPI.org</font></a><font style="vertical-align: inherit;"> - artigos&nbsp; </font></font><code>[Article]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e fontes de informação </font></font><code>&nbsp;[Source]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<ul>
<li><code>fetchArticles (from endpoint: Endpoint) -&gt; AnyPublisher&lt;[Article], Never&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp; - seleção de artigos com&nbsp; </font></font><code>[Article]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">base no parâmetro </font></font><code>endpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></li>
<li><code>fetchSources (for country: String)&nbsp;-&gt; AnyPublisher&lt;[Source], Never&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Uma seleção de fontes de informação </font></font><code>[Source]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para um país específico </font></font><code> country</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esses métodos retornam não apenas uma variedade de artigos&nbsp; </font></font><code>[Article]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;ou uma variedade de fontes de informações </font></font><code>&nbsp;[Source]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, mas os "publicadores" correspondentes da&nbsp; </font></font><code>Publisher </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nova estrutura </font></font><code>Combine</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Ambos os editores não retornam nenhum erro - </font></font><code>Never</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e se ainda ocorreu um erro de amostragem ou codificação, uma matriz vazia de artigos </font></font><code>[Article]()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;ou fontes de informação é&nbsp; </font><font style="vertical-align: inherit;">retornada&nbsp; </font></font><code>[Source]()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sem nenhuma mensagem sobre por que essas matrizes estavam vazias.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quais artigos ou fontes de informação que queremos selecionar no servidor </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , indicaremos usando a enumeração</font></font><code>enum Endpoint:</code><br>
<br>
<pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">Endpoint</span> </span>{
    <span class="hljs-keyword">case</span> topHeadLines
    <span class="hljs-keyword">case</span> articlesFromCategory(<span class="hljs-number">_</span> category: <span class="hljs-type">String</span>)
    <span class="hljs-keyword">case</span> articlesFromSource(<span class="hljs-number">_</span> source: <span class="hljs-type">String</span>)
    <span class="hljs-keyword">case</span> search (searchFilter: <span class="hljs-type">String</span>)
    <span class="hljs-keyword">case</span> sources (country: <span class="hljs-type">String</span>)<font></font>
    <font></font>
    <span class="hljs-keyword">var</span> baseURL:<span class="hljs-type">URL</span> {<span class="hljs-type">URL</span>(string: <span class="hljs-string">"https://newsapi.org/v2/"</span>)!}<font></font>
    <font></font>
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">path</span><span class="hljs-params">()</span></span> -&gt; <span class="hljs-type">String</span> {
        <span class="hljs-keyword">switch</span> <span class="hljs-keyword">self</span> {
        <span class="hljs-keyword">case</span> .topHeadLines, .articlesFromCategory:
            <span class="hljs-keyword">return</span> <span class="hljs-string">"top-headlines"</span>
        <span class="hljs-keyword">case</span> .search,.articlesFromSource:
            <span class="hljs-keyword">return</span> <span class="hljs-string">"everything"</span>
        <span class="hljs-keyword">case</span> .sources:
            <span class="hljs-keyword">return</span> <span class="hljs-string">"sources"</span><font></font>
        }<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Isto:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">as últimas notícias&nbsp; </font></font><code>.topHeadLines</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">notícias de uma determinada categoria (esportes, saúde, ciência, negócios, tecnologia)&nbsp; </font></font><code>.articlesFromCategory(_ category: String)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">notícias de uma fonte específica de informações (CNN, ABC News, Fox News etc.) </font></font><code>&nbsp;.articlesFromSource(_ source: String)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qualquer notícia&nbsp; </font></font><code>.search (searchFilter: String)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que atenda a uma determinada condição </font></font><code>searchFilter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fontes de informação </font></font><code>.sources (country:String)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para um país em particular </font></font><code>country</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para facilitar a inicialização da opção de que precisamos, adicionamos um </font></font><code>Endpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">inicializador </font></font><code>init?</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">à </font><font style="vertical-align: inherit;">enumeração </font><font style="vertical-align: inherit;">para várias listas de artigos e fontes de informações, dependendo do índice </font></font><code>index&nbsp;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e da string </font></font><code> text</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, que tem significados diferentes para diferentes opções de enumeração:</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-keyword">init</span>? (index: <span class="hljs-type">Int</span>, text: <span class="hljs-type">String</span> = <span class="hljs-string">"sports"</span>) {
        <span class="hljs-keyword">switch</span> index {
        <span class="hljs-keyword">case</span> <span class="hljs-number">0</span>: <span class="hljs-keyword">self</span> = .topHeadLines
        <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>: <span class="hljs-keyword">self</span> = .search(searchFilter: text)
        <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>: <span class="hljs-keyword">self</span> = .articlesFromCategory(text)
        <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>: <span class="hljs-keyword">self</span> = .articlesFromSource(text)
        <span class="hljs-keyword">case</span> <span class="hljs-number">4</span>: <span class="hljs-keyword">self</span> = .sources (country: text)
        <span class="hljs-keyword">default</span>: <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span><font></font>
        }<font></font>
    }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos voltar à classe </font></font><code> NewsAPI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;e considerar mais detalhadamente o primeiro método&nbsp; </font></font><code>fetchArticles (from endpoint: Endpoint)-&gt; AnyPublisher&lt;[Article], Never&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, que seleciona artigos com </font></font><code>[Article]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">base no parâmetro </font></font><code>endpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e não retorna nenhum erro - </font></font><code>Never</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">fetchArticles</span><span class="hljs-params">(from endpoint: Endpoint)</span></span> -&gt; <span class="hljs-type">AnyPublisher</span>&lt;[<span class="hljs-type">Article</span>], <span class="hljs-type">Never</span>&gt; {
        <span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> url = endpoint.absoluteURL <span class="hljs-keyword">else</span> {              <span class="hljs-comment">// 0</span>
                    <span class="hljs-keyword">return</span> <span class="hljs-type">Just</span>([<span class="hljs-type">Article</span>]()).eraseToAnyPublisher()<font></font>
        }<font></font>
           <span class="hljs-keyword">return</span>
            <span class="hljs-type">URLSession</span>.shared.dataTaskPublisher(<span class="hljs-keyword">for</span>:url)        <span class="hljs-comment">// 1</span>
            .<span class="hljs-built_in">map</span>{$<span class="hljs-number">0</span>.data}                                       <span class="hljs-comment">// 2</span>
            .decode(type: <span class="hljs-type">NewsResponse</span>.<span class="hljs-keyword">self</span>,                    <span class="hljs-comment">// 3</span>
                    decoder: <span class="hljs-type">APIConstants</span> .jsonDecoder)<font></font>
            .<span class="hljs-built_in">map</span>{$<span class="hljs-number">0</span>.articles}                                   <span class="hljs-comment">// 4</span>
            .replaceError(with: [])                             <span class="hljs-comment">// 5</span>
            .receive(on: <span class="hljs-type">RunLoop</span>.main)                          <span class="hljs-comment">// 6</span>
            .eraseToAnyPublisher()                              <span class="hljs-comment">// 7</span>
    }</code></pre><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">com base no </font></font><code>endpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;formulário </font></font><code>URL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para a solicitação, a lista desejada de artigos </font></font><code>endpoint.absoluteURL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, se isso não puder ser feito, retorne uma matriz vazia de artigos</font></font><code>[Article]()</code></li>
<li> «» <code>dataTaskPublisher(for:)</code>,     <code>Output </code>  <code>(data: Data, response: URLResponse)</code>, &nbsp; <code>Failure</code>&nbsp;-&nbsp;<code>URLError</code>,</li>
<li>  <code>map { }</code>       <code>(data: Data, response: URLResponse)</code>  &nbsp;<code>data</code>,&nbsp;</li>
<li> <code>JSON </code>&nbsp;<code>data</code>   ,   &nbsp;<code>NewsResponse</code>,    <code>articles:&nbsp;[Atricle]</code></li>
<li>  <code>map { }&nbsp;</code>        -&nbsp;<code>articles</code>,&nbsp;</li>
<li>  -        <code>[ ]</code>,</li>
<li>   <code>main </code>,          <code>UI</code>,</li>
<li>«»  «»   <code>eraseToAnyPublisher()</code>    <code>AnyPublisher</code>.</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A tarefa de selecionar fontes de informação é atribuída ao segundo método - </font></font><code>fetchSources (for country: String)&nbsp;-&gt; AnyPublisher&lt;[Source], Never&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que é uma cópia semântica exata do primeiro método, exceto que, desta vez, em vez de artigos </font></font><code>[Article]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, escolheremos as fontes de informação </font></font><code>[Source]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">fetchSources</span><span class="hljs-params">()</span></span> -&gt; <span class="hljs-type">AnyPublisher</span>&lt;[<span class="hljs-type">Source</span>], <span class="hljs-type">Never</span>&gt; {
        <span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> url = <span class="hljs-type">Endpoint</span>.sources.absoluteURL <span class="hljs-keyword">else</span> {      <span class="hljs-comment">// 0</span>
                       <span class="hljs-keyword">return</span> <span class="hljs-type">Just</span>([<span class="hljs-type">Source</span>]()).eraseToAnyPublisher()<font></font>
           }<font></font>
              <span class="hljs-keyword">return</span>
               <span class="hljs-type">URLSession</span>.shared.dataTaskPublisher(<span class="hljs-keyword">for</span>:url)      <span class="hljs-comment">// 1</span>
               .<span class="hljs-built_in">map</span>{$<span class="hljs-number">0</span>.data}                                     <span class="hljs-comment">// 2</span>
               .decode(type: <span class="hljs-type">SourcesResponse</span>.<span class="hljs-keyword">self</span>,               <span class="hljs-comment">// 3</span>
                       decoder: <span class="hljs-type">APIConstants</span> .jsonDecoder)<font></font>
               .<span class="hljs-built_in">map</span>{$<span class="hljs-number">0</span>.sources}                                  <span class="hljs-comment">// 4</span>
               .replaceError(with: [])                           <span class="hljs-comment">// 5</span>
               .receive(on: <span class="hljs-type">RunLoop</span>.main)                        <span class="hljs-comment">// 6</span>
               .eraseToAnyPublisher()                            <span class="hljs-comment">// 7</span>
    }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ele retorna para nós o "publicador" </font></font><code>AnyPublisher &lt;[Source], Never&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">com um valor na forma de uma matriz de fontes de informação </font></font><code>[Source] </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e a ausência de um erro </font></font><code>&nbsp;Never</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;(no caso de erros, uma matriz vazia de fontes é retornada&nbsp; </font></font><code>[ ]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos destacar a parte comum desses dois métodos, organizá-la como uma </font></font><code>Generic</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">função </font></font><code>fetch(_ url: URL) -&gt; AnyPublisher&lt;T, Error&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que retorna o&nbsp; </font></font><code>Generic</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"editor" com </font></font><code>AnyPublisher&lt;T, Error&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">base em </font></font><code>URL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-comment">//     URL</span>
     <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">fetch</span>&lt;T: Decodable&gt;<span class="hljs-params">(<span class="hljs-number">_</span> url: URL)</span></span> -&gt; <span class="hljs-type">AnyPublisher</span>&lt;<span class="hljs-type">T</span>, <span class="hljs-type">Error</span>&gt; {
                   <span class="hljs-type">URLSession</span>.shared.dataTaskPublisher(<span class="hljs-keyword">for</span>: url)             <span class="hljs-comment">// 1</span>
                    .<span class="hljs-built_in">map</span> { $<span class="hljs-number">0</span>.data}                                          <span class="hljs-comment">// 2</span>
                    .decode(type: <span class="hljs-type">T</span>.<span class="hljs-keyword">self</span>, decoder: <span class="hljs-type">APIConstants</span>.jsonDecoder) <span class="hljs-comment">// 3</span>
                    .receive(on: <span class="hljs-type">RunLoop</span>.main)                               <span class="hljs-comment">// 4</span>
                    .eraseToAnyPublisher()                                   <span class="hljs-comment">// 5</span>
    }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Isso simplificará os dois métodos anteriores:</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-comment">//   </span>
     <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">fetchArticles</span><span class="hljs-params">(from endpoint: Endpoint)</span></span>
                                     -&gt; <span class="hljs-type">AnyPublisher</span>&lt;[<span class="hljs-type">Article</span>], <span class="hljs-type">Never</span>&gt; {
         <span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> url = endpoint.absoluteURL <span class="hljs-keyword">else</span> {
                     <span class="hljs-keyword">return</span> <span class="hljs-type">Just</span>([<span class="hljs-type">Article</span>]()).eraseToAnyPublisher() <span class="hljs-comment">// 0</span><font></font>
         }<font></font>
         <span class="hljs-keyword">return</span> fetch(url)                                          <span class="hljs-comment">// 1</span>
             .<span class="hljs-built_in">map</span> { (response: <span class="hljs-type">NewsResponse</span>) -&gt; [<span class="hljs-type">Article</span>] <span class="hljs-keyword">in</span>        <span class="hljs-comment">// 2</span>
                             <span class="hljs-keyword">return</span> response.articles }<font></font>
                .replaceError(with: [<span class="hljs-type">Article</span>]())                    <span class="hljs-comment">// 3</span>
                .eraseToAnyPublisher()                              <span class="hljs-comment">// 4</span><font></font>
     }<font></font>
    <font></font>
    <span class="hljs-comment">//    </span>
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">fetchSources</span><span class="hljs-params">(<span class="hljs-keyword">for</span> country: String)</span></span>
                                       -&gt; <span class="hljs-type">AnyPublisher</span>&lt;[<span class="hljs-type">Source</span>], <span class="hljs-type">Never</span>&gt; {
        <span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> url = <span class="hljs-type">Endpoint</span>.sources(country: country).absoluteURL
            <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">return</span> <span class="hljs-type">Just</span>([<span class="hljs-type">Source</span>]()).eraseToAnyPublisher() <span class="hljs-comment">// 0</span><font></font>
        }<font></font>
        <span class="hljs-keyword">return</span> fetch(url)                                         <span class="hljs-comment">// 1</span>
            .<span class="hljs-built_in">map</span> { (response: <span class="hljs-type">SourcesResponse</span>) -&gt; [<span class="hljs-type">Source</span>] <span class="hljs-keyword">in</span>     <span class="hljs-comment">// 2</span><font></font>
                            response.sources }<font></font>
               .replaceError(with: [<span class="hljs-type">Source</span>]())                    <span class="hljs-comment">// 3</span>
               .eraseToAnyPublisher()                             <span class="hljs-comment">// 4</span>
    }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os "publicadores" assim obtidos não entregam nada até que alguém os "assine". </font><font style="vertical-align: inherit;">Podemos fazer isso ao projetar </font></font><code>UI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Editores" </font></font><code>Publisher</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">como </font></font><code>View Model </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">em </font></font><code> SwiftUI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Lista de artigos.</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora um pouco sobre a lógica do funcionamento </font></font><code>SwiftUI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A </font></font><code>SwiftUI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;única abstração das "mudanças externas" às quais eles respondem </font></font><code>View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">são os "editores" </font></font><code>Publisher</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. “Alterações externas” podem ser entendidas como um temporizador </font></font><code> Timer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, uma notificação </font></font><code>NotificationCenter </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou seu objeto Modelo, que usando o protocolo </font></font><code>ObservableObject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pode ser transformado em uma única “fonte de verdade” externa (fonte de verdade).&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para "publishers" ordinários tipo </font></font><code>Timer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou </font></font><code>NotificationCenter</code> <code>View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">reage usando o método </font></font><code>onReceive (_: perform:)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Um exemplo do uso do "editor" </font></font><code>Timer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que apresentaremos posteriormente no terceiro artigo sobre a criação de um aplicativo para o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hacker News</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Neste artigo, focaremos em como criar nosso modelo para&nbsp;</font></font><code>SwiftUI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"fonte da verdade" externa (fonte da verdade). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos primeiro ver como os </font></font><code>SwiftUI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"editores" recebidos devem funcionar em um exemplo específico de exibição de vários tipos de artigos: </font></font><br>
<br>
<code>.topHeadLines</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- as últimas notícias,&nbsp; </font></font><code>.articlesFromCategory(_ category: String)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;- notícias para uma categoria específica, </font></font><code>&nbsp;.articlesFromSource(_ source: String)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;- notícias para uma fonte específica de informações, </font></font><code>.search (searchFilter: String)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;- notícias selecionadas por uma determinada condição. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/zr/ua/uv/zruauv9msu2nulm2ksuflhtxusi.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dependendo de qual </font></font><code> Endpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">usuário escolher, precisamos atualizar a lista de artigos </font></font><code>articles</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">selecionados no </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Para fazer isso, criaremos uma classe muito simples </font></font><code>&nbsp;ArticlesViewModel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que implementa um protocolo </font></font><code>ObservableObject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;com três&nbsp; </font></font><code>@Published</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">propriedades:</font></font><br>
&nbsp;<br>
<img src="https://habrastorage.org/webt/ty/xj/cs/tyxjcsfctbxerl9oiyr6ljvda8c.png"><br>
<br>
<ul>
<li><code>@Published var indexEndpoint: Int</code> —   <code>Endpoint</code> (    «»,        <code>View</code>),&nbsp;&nbsp;</li>
<li><code>@Published var searchString: String</code> —  ,             &nbsp;&nbsp;(     «»,        <code>View</code>&nbsp;    <code>TextField</code>),</li>
<li><code>@Published var articles: [Article]</code>&nbsp;-    ( «»,          <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">NewsAPI.org</a>,  «»).</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Assim que definir&nbsp; </font></font><code>@Published</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;propriedades </font></font><code>indexEndpoint&nbsp;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou </font></font><code> searchString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, podemos começar a usá-los tanto como propriedades simples&nbsp; </font></font><code>indexEndpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;e&nbsp; </font></font><code>searchString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, e como "editores"&nbsp; </font></font><code>$indexEndpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e&nbsp; </font></font><code>$searchString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em uma classe&nbsp; </font></font><code>ArticlesViewModel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, você pode não apenas declarar as propriedades de interesse para nós, mas também prescrever a lógica de negócios de sua interação. Para esse propósito, ao inicializar uma instância de uma classe&nbsp; </font></font><code>ArticlesViewModel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;, </font></font><code>init</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">podemos criar uma "assinatura" que atuará durante todo o "ciclo de vida" da instância da classe&nbsp; </font></font><code>ArticlesViewModel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e reproduzirá a dependência da lista de artigos </font></font><code>articles</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no índice&nbsp; </font></font><code>indexEndpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;e na cadeia de pesquisa </font></font><code>searchString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para fazer isso, </font></font><code>Combine</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">estendemos a cadeia de "editores" </font></font><code>$indexEndpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;e </font><font style="vertical-align: inherit;">produzimos </font></font><code>$searchString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"editores"</font></font><code>AnyPublisher&lt;[Article], Never&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cujo valor é uma lista de artigos&nbsp; </font></font><code>articles</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Em seguida, "assinamos" usando o operador </font></font><code>assign&nbsp;(to: \.articles, on: self)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e obtemos a lista de artigos que precisamos </font></font><code>articles </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">como uma </font></font><code>@Published</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;propriedade </font><font style="vertical-align: inherit;">"output"&nbsp; </font><font style="vertical-align: inherit;">que define </font></font><code>UI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nós devemos puxar a cadeia NÃO simplesmente das propriedades&nbsp; </font></font><code>indexEndpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><code>searchString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, principalmente dos "editores" </font></font><code> $indexEndpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><code>$searchString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que participam da criação </font></font><code>UI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">com a ajuda de, </font></font><code>SwiftUI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e nós os alteraremos lá usando os elementos da interface do usuário&nbsp; </font></font><code>Picker</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><code>TextField</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como faremos isso? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Já temos uma função em nosso arsenal </font></font><code>fetchArticles (from: Endpoint)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que está na classe&nbsp; </font></font><code>NewsAPI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e retorna um "editor" </font></font><code>AnyPublisher&lt;[Article], Never&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, dependendo do valor</font></font><code>Endpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, e só podemos usar de alguma forma os valores dos "editores"&nbsp; </font></font><code>$indexEndpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e&nbsp; </font></font><code>$searchString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">transformá-los em um argumento para </font></font><code>endpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">essa função.&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Primeiro, combine os "editores"&nbsp; </font></font><code>$indexEndpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;e&nbsp; </font></font><code>$searchString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Para fazer isso, o </font></font><code>Combine</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">operador existe </font></font><code>Publishers.CombineLatest </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ci/pg/wd/cipgwdfx2fxmlevrmkf8nnkc6u4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para criar um novo "editor" com base nos dados recebidos do "editor" anterior </font></font><code>Combine</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;, o operador é usado&nbsp; </font></font><code>flatMap</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ln/s7/ur/lns7urzc9l64o8mswhliuggsyp4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em seguida, "assinamos" esse "editor" recém-recebido usando um "assinante" muito simples&nbsp; </font></font><code>assign (to: \.articles, on: self)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e atribuímos o recebido de " publisher "à&nbsp; </font></font><code>@Published</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;matriz&nbsp; </font></font><code>articles</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/su/io/xi/suioxibgc3t31oewzgkbfaljina.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
acabamos de criar uma </font></font><code>init( )</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">" editora "ASSÍNCRONA e" assinada "a ela, como resultado de</font></font><code>AnyCancellable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“Assinatura” e é fácil verificar se mantemos nossa “assinatura” constante </font></font><code>let subscription</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/gw/ig/ml/gwigml-zqpprclh76lzfnjhvzda.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
a principal propriedade de uma </font></font><code>AnyCancellable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“assinatura” é que, assim que sai de seu escopo, a memória ocupada por ela é automaticamente liberada. Portanto, assim que for </font></font><code>init( ) </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">concluída, essa "assinatura" será excluída </font></font><code>ARC</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, sem tempo para atribuir as informações assíncronas recebidas com atraso na matriz </font></font><code>articles</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Informações assíncronas simplesmente não têm para onde "pousar", em seu sentido literal, "a Terra se escondeu". </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para salvar essa "assinatura", é necessário criar uma </font></font><code> init() </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">variável </font><font style="vertical-align: inherit;">ALÉM do inicializador </font></font><code>var&nbsp;cancellableSet</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que salvará nossa&nbsp; </font></font><code>AnyCancellable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"assinatura" nessa variável durante todo o "ciclo de vida" da instância da classe&nbsp;  </font></font><code>ArticlesViewMode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Portanto, removemos a constante </font></font><code>let subscription</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e lembramos da nossa </font></font><code>AnyCancellable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"assinatura" na variável&nbsp; </font></font><code>cancellableSet</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">usando o operador </font></font><code>.store ( in: &amp;self.cancellableSet)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/my/gt/xw/mygtxwz7uhcurfyfnblva9irfku.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
"Subscription" para o "editor" ASSÍNCRONO em que criamos </font></font><code>init( )</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">será preservado durante todo o "ciclo de vida" da instância da classe&nbsp; </font></font><code>ArticlesViewModel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Podemos alterar arbitrariamente o significado de "editores"&nbsp; </font></font><code>$indexEndpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e / ou&nbsp; </font></font><code>searchString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, e sempre graças à "assinatura" criada, teremos uma variedade de artigos correspondentes aos valores desses dois editores&nbsp; </font></font><code>articles</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sem nenhum esforço adicional. Essa&nbsp; </font></font><code>ObservableObject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">classe geralmente é chamada&nbsp; </font></font><code>View Model</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para reduzir o número de chamadas ao servidor ao digitar uma string de pesquisa </font></font><code>searchString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, não devemos usar o "editor" da própria string de pesquisa&nbsp;</font></font><code>$searchString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e sua versão modificada </font></font><code>validString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/kh/ir/2z/khir2z1rrmou-hks2rtfuq31bnm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
agora que temos </font></font><code>View Model</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nossos artigos, </font><font style="vertical-align: inherit;">vamos </font><font style="vertical-align: inherit;">começar a criar a interface do usuário ( </font></font><code>UI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). Para </font></font><code>SwiftUI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sincronizar </font></font><code>View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">com o </font></font><code>ObservableObject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;Modelo, </font></font><code>@ObservedObject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é </font><font style="vertical-align: inherit;">usada uma </font><font style="vertical-align: inherit;">variável que se refere a uma instância da classe deste Modelo. É esse par - a&nbsp; </font></font><code>ObservableObject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;classe e a&nbsp; </font></font><code>@ObservedObject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">variável que referencia a instância dessa classe - que controla a alteração na interface do usuário ( </font></font><code>UI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) em&nbsp; </font></font><code>SwiftUI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Adicionamos à estrutura uma </font></font><code>ContentView</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;instância da classe </font></font><code>ArticleViewModel </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">na forma de uma variável </font></font><code>var articleViewModel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e a substituímos </font></font><code>Text ("Hello, World!")</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">por uma lista de artigos </font></font><code>ArticlesList</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">na qual colocamos os artigos&nbsp; </font></font><code>articlesViewModel.articles</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">obtidos de nossa&nbsp;</font></font><code>View Model</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Como resultado, obtemos uma lista de artigos para um índice fixo e padrão&nbsp; </font></font><code>indexEndpoint = 0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, ou seja, para as </font></font><code>.topHeadLines</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;últimas notícias: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/je/_f/j-/je_fj-0m2xews-ih7vptprkdpoy.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Adicione um </font></font><code>UI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">elemento à </font><font style="vertical-align: inherit;">nossa tela&nbsp; </font><font style="vertical-align: inherit;">para controlar qual conjunto de artigos queremos exibir. Usaremos a </font></font><code>Picker</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">alteração </font><font style="vertical-align: inherit;">do&nbsp; </font><font style="vertical-align: inherit;">índice </font></font><code>$articlesViewModel.indexEndpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. A presença de um símbolo é&nbsp; </font></font><code>$</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">obrigatória, pois isso significa uma alteração no valor fornecido pelo&nbsp; </font></font><code>@Published&nbsp;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"editor". A "assinatura" deste "editor" é acionada imediatamente, e iniciámos </font></font><code>init ()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o " </font></font><code>@Published</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">editor" de </font><font style="vertical-align: inherit;">"saída"&nbsp; </font></font><code>&nbsp;articles</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;mudará e veremos uma lista diferente de artigos na tela: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/zx/sd/pp/zxsdppfkp5y0nuk-j99uhovvmu8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dessa forma, podemos receber matrizes de artigos para as três opções - "topHeadLines", "pesquisar "E" da categoria ":</font></font><br>
<br>
<img src="https://habrastorage.org/webt/jm/yc/a_/jmyca_mvm0n2___cswvcamuuqqm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
... mas para uma sequência de pesquisa fixa e padrão </font></font><code>searchString = "sports"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(onde é necessária): no </font></font><br>
<br>
<img src="https://habrastorage.org/webt/zq/pi/tw/zqpitwdhh3fsnciz9p2scvn1sas.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
entanto, para a opção,&nbsp; </font></font><code>"search"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;você deve fornecer ao usuário um campo de texto </font></font><code>SearchView</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para inserir a sequência de pesquisa: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/xk/d1/uu/xkd1uu0tmepthmsjlkzu--wlwse.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como resultado, o usuário pode procurar qualquer notícia pela sequência de pesquisa digitada: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/x4/ch/5a/x4ch5apliuwesqxjzeds58ab1t8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para a opção,&nbsp; </font></font><code>"from category"&nbsp;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é necessário fornecer ao usuário a oportunidade de escolher uma categoria e começamos com categoria </font></font><code>science</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/2i/8e/3v/2i8e3vvly1r_ipfuflxwbtepglq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
como resultado, o usuário pode procurar qualquer notícia sobre a categoria escolhida de notícias - </font></font><code>science</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code> health</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,&nbsp; </font></font><code>business</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>technology</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/p_/pn/li/p_pnli0chxenoalmms3ltch-iwo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
podemos ver como uma forma muito simples&nbsp; </font></font><code>ObservableObject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;modelo que tem duas controladas pelo usuário </font></font><code>@Published </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">recursos - </font></font><code>indexEndpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;e</font></font><code>searchString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- permite selecionar uma ampla variedade de informações no site&nbsp; </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lista de fontes de informação</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos ver como o </font></font><code>SwiftUI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;"editor" de fontes de informações recebidas na classe NewsAPI funcionará </font></font><code>fetchSources (for country: String)&nbsp;-&gt; AnyPublisher&lt;[Source], Never&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Obteremos uma lista de fontes de informações para diferentes países: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hr/oh/le/hrohle3hq8pkyhnjf6frali7yao.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
... e a capacidade de procurá-las por nome: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/kg/ea/ll/kgeallzwaxnkvekct18th7knkyo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
... bem como informações detalhadas sobre a fonte selecionada: nome, categoria, país, descrição resumida e link para o site:&nbsp; </font></font><br>
<br>
<img src="https://habrastorage.org/webt/k_/b7/9w/k_b79wirynz07feigtlhgdeyik4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se você clicar no link, acessaremos o site deste site. fonte de informação. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para que tudo isso funcione, você precisa de um </font></font><code>ObservableObject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Modelo </font><font style="vertical-align: inherit;">extremamente simples&nbsp; </font><font style="vertical-align: inherit;">que possua apenas duas </font></font><code>@Published</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">propriedades </font><font style="vertical-align: inherit;">controladas pelo usuário </font><font style="vertical-align: inherit;">- </font></font><code>searchString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;e&nbsp; </font></font><code>country</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/rs/id/4b/rsid4bb5xmkjdkwuptkmwvhi-yc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E, novamente, usamos o mesmo esquema: ao inicializar uma instância de uma classe de uma </font></font><code>SourcesViewModel </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">classe em</font></font><code> init</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">criamos uma “assinatura” que funcionará durante todo o “ciclo de vida” da instância da classe </font></font><code>&nbsp;SourcesViewModel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e garantimos que a lista de fontes de informações dependa&nbsp; </font></font><code>sources</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">do país&nbsp; </font></font><code>country</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e da string de pesquisa </font></font><code>&nbsp;searchString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Com a ajuda&nbsp; </font></font><code>Combine</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, extraímos a cadeia dos "editores" </font></font><code>$searchString </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font><font style="vertical-align: inherit;">produzimos </font></font><code>$country</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"editores" </font></font><code>AnyPublisher&lt;[Source], Never&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, cujo valor é uma lista de fontes de informação. Nós "assinamos" usando o operador </font></font><code>assign&nbsp;(to: \.sources, on: self)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, obtemos a lista de fontes de informações de que precisamos&nbsp; </font></font><code>sources</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. e lembre-se da </font></font><code>AnyCancellable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"assinatura" </font><font style="vertical-align: inherit;">recebida&nbsp; </font><font style="vertical-align: inherit;">em uma variável&nbsp; </font></font><code>cancellableSet</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">usando o operador </font></font><code>.store ( in: &amp;self.cancellableSet)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora que temos </font></font><code>View Model</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nossas fontes de informação, </font><font style="vertical-align: inherit;">vamos </font><font style="vertical-align: inherit;">começar a criar </font></font><code> UI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. B </font></font><code>SwiftUI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para sincronizar </font></font><code> View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c</font></font><code>ObservableObject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;O modelo usa uma </font></font><code>@ObservedObject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">variável que se refere a uma instância da classe deste modelo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Adicione a </font></font><code>ContentViewSources</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;instância </font><font style="vertical-align: inherit;">da </font><font style="vertical-align: inherit;">classe </font><font style="vertical-align: inherit;">à estrutura&nbsp; </font></font><code>SourcesViewModel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">na forma de uma variável </font></font><code>var sourcesViewModel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, remova&nbsp; </font></font><code>Text ("Hello, World!")</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;e coloque a sua </font></font><code>View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para cada uma das 3&nbsp; </font></font><code>@Published</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">propriedades </font></font><code>&nbsp;sourcesViewModel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;:</font></font><br>
<br>
&nbsp;<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">caixa de texto&nbsp; </font></font><code>SearchView</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para a barra de pesquisa&nbsp; </font></font><code>searchString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></li>
<li>&nbsp;<code>Picker</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;para o país </font></font><code>country</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lista de&nbsp; </font></font><code>SourcesList&nbsp;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fontes de informação</font></font></li>
</ul><br>
<img src="https://habrastorage.org/webt/td/tk/kn/tdtkknev57l3b5avb8y0uheu7fa.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como resultado, obtemos o que precisamos </font></font><code>View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/jw/gg/ly/jwgglycniqr2e-jhpifypfzx4m8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nesta tela, gerenciamos apenas a sequência de pesquisa usando a caixa de texto </font></font><code>SearchView</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e o “país” com&nbsp; </font></font><code>Picker</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, e o resto acontece automaticamente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A lista de fontes de informação </font></font><code>SourcesList</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">contém </font><font style="vertical-align: inherit;">informações </font><font style="vertical-align: inherit;">mínimas sobre cada fonte - o nome </font></font><code>source.name </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e uma breve descrição </font></font><code>source.description</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/sj/zi/1z/sjzi1zh-7leadeujwarkuka_ii8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
... mas permite obter informações mais detalhadas sobre a fonte selecionada usando o link </font></font><code>NavigationLink</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no qual </font></font><code>destination</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">indicamos&nbsp; </font></font><code>DetailSourceView</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">quais dados de fonte são a fonte de informação&nbsp; </font></font><code>source</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e a instância desejada da classe </font></font><code>ArticlesViewModel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, permitindo obtenha uma lista de seus artigos </font></font><code>articles</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ix/j_/uh/ixj_uheqhclwopwidsihztunn5e.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Veja como elegantemente obtemos a lista de artigos para a fonte selecionada de fonte de informações na lista de fontes&nbsp; </font></font><code>SourcesList</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Nosso velho amigo nos ajuda - uma classe&nbsp; </font></font><code>ArticlesViewModel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para a qual devemos definir as duas </font></font><code>@Published</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">propriedades de </font><font style="vertical-align: inherit;">"entrada"&nbsp; </font><font style="vertical-align: inherit;">:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">índice&nbsp; </font></font><code>indexEndpoint = 3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, ou seja, uma opção&nbsp; </font></font><code>.articlesFromSource (_source:String)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">correspondente à seleção de artigos para uma fonte fixa </font></font><code>source</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">string&nbsp; </font></font><code>searchString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;como a própria fonte (ou melhor, seu identificador) </font></font><code>source.id&nbsp;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></li>
</ul><br>
<img src="https://habrastorage.org/webt/ia/xi/lr/iaxilr4rlcyippxuvkbd46kequ4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em geral, se você olhar para todo o aplicativo </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsApp</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , não verá nenhum lugar em que solicitamos explicitamente uma seleção de artigos ou fontes de informação no site&nbsp; </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Nós gerenciamos apenas os&nbsp; </font></font><code>@Published</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;dados, mas </font></font><code>View Model </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fazemos o nosso trabalho: seleciona os artigos e as fontes de informação que precisamos.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Faça o download da imagem </font></font><code>UIImage</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para o artigo </font></font><code>Article</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O modelo do artigo&nbsp; </font></font><code>Article&nbsp;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">contém uma </font></font><code>URL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imagem </font></font><code>urlToImage</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que o </font><font style="vertical-align: inherit;">acompanha&nbsp; </font><font style="vertical-align: inherit;">: com </font></font><br>
<br>
<img src="https://habrastorage.org/webt/om/ny/fv/omnyfvhlcegrhltunqvjvyaq6l4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
base nisso,&nbsp; </font></font><code>URL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no futuro, devemos obter as imagens </font></font><code>UIImage</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;no site&nbsp; </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Já estamos familiarizados com esta tarefa. </font><font style="vertical-align: inherit;">Na classe </font></font><code>ImageLoader</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, usando a função, </font></font><code>fetchImage(for url: URL?) -&gt; AnyPublisher&lt;UIImage?, Never&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">crie um "editor"&nbsp;  </font></font><code>AnyPublisher&lt;UIImage?, Never&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">com o valor da imagem&nbsp; </font></font><code>UIImage?</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;e sem erros&nbsp; </font></font><code>Never</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(na verdade, se ocorrerem erros, a imagem será retornada </font></font><code> nil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font><font style="vertical-align: inherit;">Você pode "assinar" este "editor" para receber imagens&nbsp; </font></font><code>UIImage?</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;ao projetar a interface do usuário ( </font></font><code>UI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font><font style="vertical-align: inherit;">Os dados de origem para a função </font></font><code>fetchImage(for url: URL?)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">são&nbsp; </font></font><code>url</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/do/a-/hg/doa-hg5idk0ukdghj0snu0-nubm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos considerar em detalhes como está acontecendo a formação, com a ajuda do </font></font><code> Combine</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"editor" </font></font><code>AnyPublisher &lt;UIImage?, Never&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, se soubermos </font></font><code>url</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se for </font></font><code>url</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">igual </font></font><code>nil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, retorne </font></font><code>Just(nil)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">com base na </font></font><code>url</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">forma do "editor" </font></font><code>dataTaskPublisher(for:)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, cujo valor de saída </font></font><code>Output</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é uma tupla </font></font><code>(data: Data, response: URLResponse)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e um erro </font></font><code>&nbsp;Failure</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-&nbsp; </font></font><code>URLError</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">coletamos </font><font style="vertical-align: inherit;">apenas dados </font></font><code>map {}</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">da tupla </font></font><code>(data: Data, response: URLResponse)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para processamento&nbsp; </font></font><code>data</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e formulário adicionais </font></font><code>UIImage</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se ocorrer o erro de retorno das etapas anteriores </font></font><code>nil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">entregamos o resultado ao </font></font><code>main</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fluxo, pois assumimos um uso adicional no design </font></font><code>UI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Apague" o TIPO do "editor" e devolva a cópia </font></font><code>AnyPublisher</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Você vê que o código é bastante compacto e bem legível, não há nenhum </font></font><code>callbacks</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos começar a criar&nbsp; </font></font><code>View Model</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;para a imagem </font></font><code>UIImage?</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Esta é uma classe </font></font><code>ImageLoader</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que implementa o protocolo </font></font><code>ObservableObject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, com duas&nbsp; </font></font><code>@Published</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">propriedades:</font></font><br>
<br>
<ul>
<li><code>@Published url: URL?</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;são </font></font><code>URL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imagens</font></font></li>
<li><code>@Published var image: UIImage?</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;é a própria imagem do </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font></li>
</ul><br>
<img src="https://habrastorage.org/webt/li/o6/kr/lio6krhn0v1eyeiwg_cgpwcigia.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E, novamente, ao inicializar uma instância da classe,&nbsp; </font></font><code>ImageLoader</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;precisamos estender a cadeia da entrada "publisher"&nbsp; </font></font><code>$url</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;para a saída "publisher" </font></font><code>AnyPublisher&lt;UIImage?, Never&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, na qual </font><font style="vertical-align: inherit;">&nbsp;assinaremos </font><font style="vertical-align: inherit;">mais tarde e obteremos a imagem de que precisamos </font></font><code>image</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ba/gi/2s/bagi2swivajzz0pkgqzzsswudww.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Usamos o operador </font></font><code>&nbsp;flatMap</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e um "assinante" muito simples&nbsp; </font></font><code>assign (to: \image, on: self)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para atribuí-la ao recebido do "publicador" "Valores para a propriedade </font></font><code>@Published image</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/eq/3k/4-/eq3k4-0pbruhk4qbcu8hmyinfmg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E novamente na variável&nbsp; </font><font style="vertical-align: inherit;">" assinatura "é </font></font><code>cancellableSet </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">armazenada </font></font><code>AnyCancellable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">usando o operador&nbsp; </font></font><code>store(in: &amp;self.cancellableSet)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A lógica desse “downloader de imagens” é que você baixa uma imagem de algo diferente daquele, </font></font><code> nil URL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">desde que não tenha sido pré-carregado, ou seja,</font></font><code>image == nil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Se durante o processo de download for detectado algum erro, a imagem estará ausente, ou seja, </font></font><code>image</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">permanecerá igual </font></font><code>nil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em </font></font><code>SwiftUI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mostramos a imagem com a ajuda </font></font><code>ArticleImage</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que uma instância da </font></font><code>imageLoader</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;classe </font><font style="vertical-align: inherit;">usa para isso </font></font><code>ImageLoader</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Se a imagem dele não for igual </font></font><code>nil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, ela será exibida usando </font></font><code> Image (...)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, mas se for igual </font></font><code>nil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, dependendo do que for igual </font></font><code>url </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, nada será mostrado </font></font><code>EmptyView()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou um retângulo </font></font><code>Rectangle</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">com texto rotativo T será </font><font style="vertical-align: inherit;">exibido </font></font><code>ext("Loading...")</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/mh/nq/yi/mhnqyirurke0w6yibfxm86gap1i.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Essa lógica funciona bem para o caso quando você tiver certeza de que&nbsp; </font></font><code>url</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, além de&nbsp; </font></font><code>nil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">obter uma imagem </font></font><code>image</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, como é o caso do banco de dados de filmes&nbsp;</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TMDb</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Com o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.org, o</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> agregador de notícias&nbsp; </font><font style="vertical-align: inherit;">&nbsp; é diferente. Os artigos de algumas fontes de informação dão uma diferente da&nbsp; </font></font><code>nil&nbsp;URL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imagem, mas o acesso é fechado e obtemos um retângulo </font></font><code>Rectangle</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">com texto rotativo </font></font><code>Text("Loading...")</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que nunca será substituído: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/sh/tq/lp/shtqlpz4wx-iobt19-wv9j2pb7w.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nesta situação, se a </font></font><code>&nbsp;URL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imagem for diferente&nbsp; </font></font><code>nil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, a igualdade da&nbsp; </font></font><code>nil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imagem&nbsp; </font></font><code>image</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pode significar que a imagem está sendo carregada. , e o fato de ocorrer um erro ao carregar e nunca obteremos uma imagem </font></font><code>image</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Para distinguir entre essas duas situações, adicionamos </font><font style="vertical-align: inherit;">mais uma </font></font><code>ImageLoader</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;às duas </font></font><code>@Published</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">propriedades </font><font style="vertical-align: inherit;">existentes </font><font style="vertical-align: inherit;">na classe&nbsp; </font><font style="vertical-align: inherit;">:&nbsp;</font></font><br>
<br>
<code>&nbsp;@Published var noData = false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;- este é um valor booleano com o qual indicaremos a ausência de dados da imagem devido a um erro durante a seleção: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/kp/jc/sq/kpjcsqugrsfzyghmefnge0unscy.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ao criar uma "assinatura", </font></font><code> init</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">capturamos todos os erros </font></font><code> Error</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que ocorrem ao carregar a imagem e acumulamos sua presença na&nbsp; </font></font><code>@Published</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">propriedade </font></font><code>self.noData = true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Se o download foi bem-sucedido, obtemos a imagem </font></font><code>image</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">
Criamos o </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
"Publicador"&nbsp; </font></font><code>AnyPublisher&lt;UIImage?, Error&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;com base na&nbsp; </font></font><code>url</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;função </font></font><code>fetchImageErr (for url: URL?)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/7f/ek/jf/7fekjfrbihaieypuxaovub1-op8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Começamos a criar um método </font></font><code>fetchImageErr</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">inicializando o "publicador"&nbsp; </font></font><code>Future</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, que pode ser usado para obter de forma assíncrona um único valor TYPE </font></font><code>Result</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">usando um fechamento. O fechamento possui um parâmetro - </font></font><code>Promise</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que é uma função do TYPE&nbsp; </font></font><code>(Result&lt;Output, Failure&gt;) → Void</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font><font style="vertical-align: inherit;">Transformaremos o </font></font><br>
<br>
<img src="https://habrastorage.org/webt/iu/ch/_u/iuch_uvhdkz42-mfyuiuq3jiosg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
resultado </font></font><code>Future</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">em</font></font><code>AnyPublisher &lt;UIImage?, Error&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">com a ajuda do operador “Erase TYPE” </font></font><code>eraseToAnyPublisher()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em seguida, vamos realizar os seguintes passos, tendo em conta todos os erros possíveis (não vamos identificar erros, é simplesmente importante para nós saber que há um erro): </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
0. verificação </font></font><code>url</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de </font></font><code>nil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;e&nbsp; </font></font><code>noData</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">em </font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: em caso afirmativo, em seguida, retornar o erro, se não, a transferência de </font></font><code>url</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mais longe, cadeia, </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1. crie um "publicador" </font></font><code>dataTaskPublisher(for:)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cuja entrada seja - </font></font><code>url</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e o valor de saída </font></font><code>Output</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">seja uma tupla </font></font><code>(data: Data, response: URLResponse)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e um erro&nbsp; </font></font><code>URLError</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2. analise usando a </font></font><code> tryMap { }</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;tupla resultante </font></font><code>(data: Data, response: URLResponse)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: se </font></font><code>response.statusCode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">estiver no intervalo </font></font><code>200...299</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, para processamento adicional, coletamos apenas os dados&nbsp; </font></font><code>data</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Caso contrário, "descartamos" um erro (não importa o quê),</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3. vamos </font></font><code>map { }</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">converter os dados </font></font><code>data</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para </font></font><code>UIImage</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4. entregar o resultado para o </font></font><code>main</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fluxo, uma vez que assumimos que vamos usá-lo mais tarde no projeto </font></font><code>UI</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - que “assinar” para o “publisher” recebeu usando </font></font><code>sink</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">seus fechamentos </font></font><code>receiveCompletion</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><code>receiveValue</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - 5. se </font></font><code>receiveCompletion</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;encontrar um erro </font><font style="vertical-align: inherit;">no fechamento&nbsp; </font></font><code>error</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, relatamos usando-o </font></font><code>promise (.failure(error)))</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - 6. no fechamento,&nbsp; </font></font><code>receiveValue </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">informamos sobre o recebimento bem-sucedido de uma variedade de artigos usando </font></font><code> promise (.success($0))</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
7. lembramos a "assinatura" recebida na variável&nbsp; </font></font><code>cancellableSet</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para garantir sua viabilidade durante o "tempo de vida" da instância da classe </font></font><code>ImageLoader</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
8. apagamos "o" editor "TYPE e retorne a instância </font></font><code>AnyPublisher</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Retornamos para </font></font><code>ArticleImage</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">onde usaremos a nova&nbsp; </font></font><code>@Published</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">variável </font></font><code>noData</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Se não houver dados de imagem, não exibiremos nada, ou seja </font></font><code>EmptyView ()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/3k/wr/v_/3kwrv_cecjy2f8jea3rgnnpkzri.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Finalmente, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">reuniremos</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> todas as nossas possibilidades de exibir dados do </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">agregador de</font></a><font style="vertical-align: inherit;"> notícias </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">NewsAPI.org</font></a><font style="vertical-align: inherit;"> em </font></font><code>TabView</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/yq/xb/ra/yqxbraupq1d0tgeygy2lb05o4xo.png"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exibir erros ao buscar e decodificar dados JSON do servidor&nbsp; </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ao acessar o servidor </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ,&nbsp; </font><font style="vertical-align: inherit;">podem ocorrer </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">erros</font></a><font style="vertical-align: inherit;"> , por exemplo, devido ao fato de você ter especificado a chave errada </font></font><code>API-key</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou, por ter uma tarifa de desenvolvedor que não custa nada, exceder o número permitido de solicitações ou outra coisa. Ao mesmo tempo, o servidor&nbsp; </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> &nbsp;fornece o </font></font><code>HTTP</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">código e a mensagem correspondente: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/_f/2n/zv/_f2nzv5bndlu8auo9cygjyk9fta.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
É necessário lidar com esse tipo de erro no servidor. Caso contrário, o usuário do seu aplicativo entrará em uma situação em que, repentinamente, sem motivo, o servidor&nbsp; </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> &nbsp;interromperá o processamento de quaisquer solicitações, deixando o usuário completamente perdido com uma tela em branco. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Até agora, ao selecionar artigos&nbsp; </font></font><code>[Article]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e fontes de informações&nbsp; </font></font><code>[Source]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no servidor&nbsp; </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;ignoramos todos os erros e, no caso de sua aparência, retornamos matrizes vazias </font></font><code>[Article]()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e,&nbsp; </font><font style="vertical-align: inherit;">como resultado&nbsp; </font></font><code>[Source]()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Começando com o tratamento de erros, vamos </font></font><code>fetchArticles (from endpoint: Endpoint) -&gt; AnyPublisher&lt;[Article], Never&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;criar </font></font><code>NewsAPI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;outro método </font><font style="vertical-align: inherit;">na classe com </font><font style="vertical-align: inherit;">base no </font><font style="vertical-align: inherit;">método de </font><font style="vertical-align: inherit;">seleção de artigo&nbsp; </font><font style="vertical-align: inherit;">existente </font></font><code>fetchArticlesErr (from endpoint: Endpoint) -&gt; AnyPublisher&lt;[Article], NewsError&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que retornará não apenas uma matriz de artigos </font></font><code>[Article]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, mas também um possível erro&nbsp; </font></font><code>NewsError</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">fetchArticlesErr</span><span class="hljs-params">(from endpoint: Endpoint)</span></span> -&gt;
                            <span class="hljs-type">AnyPublisher</span>&lt;[<span class="hljs-type">Article</span>], <span class="hljs-type">NewsError</span>&gt; {<font></font>
<font></font>
. . . . . . . .<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esse método, assim como o método </font></font><code>fetchArticles</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, aceita </font></font><code>endpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;e retorna o "publicador" </font><font style="vertical-align: inherit;">na entrada </font><font style="vertical-align: inherit;">com um valor na forma de uma matriz de artigos </font></font><code>[Article]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, mas, em vez da ausência de um erro </font></font><code>Never</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, podemos ter um erro definido pela enumeração </font></font><code>NewsError</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/x9/es/ey/x9eseyq8jbapjkmgdoj7aggc6f0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Começamos a criar um novo método inicializando o "publicador"&nbsp; </font></font><code>Future</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, que use para obter assincronamente um único valor TYPE </font></font><code>Result</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">usando um fechamento. </font><font style="vertical-align: inherit;">O fechamento possui um parâmetro - </font></font><code>Promise</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que é uma função do TYPE&nbsp; </font></font><code>(Result&lt;Output, Failure&gt;) -&gt; Void</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font><font style="vertical-align: inherit;">Transformaremos os </font></font><br>
<br>
<img src="https://habrastorage.org/webt/3w/bw/ct/3wbwctuso0qweiz3a8qk_h1aiom.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
recebidos </font></font><code>Future</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no "editor" necessário,&nbsp; </font></font><code>AnyPublisher &lt;[Article], NewsError&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">usando o operador "TYPE Erase" </font></font><code>eraseToAnyPublisher()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais adiante no novo método, </font></font><code>fetchArticlesErr</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">repetiremos todas as etapas que executamos no método&nbsp;</font></font><code>fetchArticles</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, mas consideraremos todos os erros possíveis:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/pb/xz/i0/pbxzi0rn5-cuandt3rtu74ofj8s.png"><br>
<br>
<ul>
<li>0.   endpoint&nbsp; <code>URL endpoint.absoluteURL </code>    , <code> url </code> <code>nil</code>:  <code>nil</code>,    <code>.urlError</code>,   —  <code>url</code>   ,</li>
<li>1.  «» <code>dataTaskPublisher(for:)</code>,     — <code>url</code>,    <code>Output</code>   <code>(data: Data, response: URLResponse)</code>  &nbsp;<code>URLError</code>,</li>
<li>2.    <code>tryMap { }</code>&nbsp;  <code>(data: Data, response: URLResponse)</code>:  <code>response.statusCode</code>    <code>200...299</code>,       &nbsp;<code>data</code>.    «»  <code>.responseError</code>,  &nbsp;&nbsp;<code>data</code>,    <code>String</code>,    ,</li>
<li>3. <code> JSON</code>    ,   &nbsp;<code>NewsResponse</code>,</li>
<li>4.    <code>main</code> ,         <code>UI</code></li>
<li>«»   «»   <code>sink</code>    <code>receiveCompletion</code>  <code>receiveValue</code>,<br>
 <ul>
<li>5.&nbsp; &nbsp;&nbsp;<code>receiveCompletion</code>&nbsp;  <code>error</code>,       <code>promise (.failure(...)))</code>,</li>
<li> 6.&nbsp;&nbsp;&nbsp;<code>receiveValue</code>         <code>promise (.success($0.articles))</code>,</li>
</ul>&nbsp;</li>
<li>7.&nbsp;  «»  &nbsp;<code>var subscriptions</code>,       « »   <code>NewsAPI</code>,</li>
<li>8. «»  «»    <code>AnyPublisher</code>.</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Deve-se observar que o "publicador"&nbsp; </font></font><code>dataTaskPublisher(for:)</code> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">difere</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de seu protótipo </font></font><code>dataTask</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, pois, no caso de um erro do servidor quando </font></font><code>response.statusCode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;NÃO </font><font style="vertical-align: inherit;">está </font><font style="vertical-align: inherit;">no intervalo </font></font><code>200...299</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, ele ainda fornece o valor bem-sucedido na forma de uma tupla </font></font><code>(data: Data, response: URLResponse)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, e não um erro no formulário </font></font><code>(Error, URLResponse?)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Nesse caso, as informações reais de erro do servidor estão contidas </font></font><code>data</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. O "publicador" </font></font><code>dataTaskPublisher(for:)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;gera um erro&nbsp; </font></font><code>URLError</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se ocorrer um erro no lado do cliente (incapacidade de entrar em contato com o servidor, proibição do sistema de segurança </font></font><code>ATS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">etc.). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se queremos exibir erros </font></font><code>SwiftUI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, precisamos do correspondente </font></font><code>View Model</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, que chamaremos&nbsp; </font></font><code>ArticlesViewModelErr</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/em/1o/qy/em1oqy5ob60o8xzmz_-kpdvzs4a.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na classe </font></font><code>&nbsp;ArticlesViewModelErr</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que implementa o protocolo </font></font><code>ObservableObject </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, desta vez temos QUATRO&nbsp; </font></font><code>@Published</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">propriedades:</font></font><br>
<br>
<ol>
<li><code>@Published var indexEndpoint: Int</code> —   <code>Endpoint</code> (    «»,     <code> View</code>),&nbsp;</li>
<li><code>@Published var searchString: String</code> —   ,    &nbsp;<code>Endpoint</code>:    «» ,       (      «»,        <code>View</code>),&nbsp;</li>
<li>&nbsp;<code>@Published var articles: [Article]</code>&nbsp;-    ( «»,        &nbsp;<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">NewsAPI.org&nbsp;</a>)</li>
<li>&nbsp;&nbsp;<code>@Published var articlesError: NewsError?</code>&nbsp;-  ,      &nbsp;    &nbsp;<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">NewsAPI.org&nbsp;</a>.</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quando você inicializa uma instância de uma classe </font></font><code>ArticlesViewModelErr</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, devemos estender novamente uma cadeia de entrada "editores" </font></font><code>$indexEndpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><code>$searchString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">saída "publisher"&nbsp; </font></font><code>AnyPublisher&lt;[Article],NewsError&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, à qual "assinamos" com o "Assinante" </font></font><code>sink</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e recebemos muitos artigos </font></font><code>articles</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou erros&nbsp; </font></font><code>articlesError</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em nossa classe, </font></font><code>NewsAPI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">já construímos uma função&nbsp; </font></font><code>fetchArticlesErr (from endpoint: Endpoint)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que retorna um "publicador"&nbsp; </font></font><code>AnyPublisher&lt;[Article], NewsError&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, dependendo do valor </font></font><code>endpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, e só precisamos usar de alguma forma os valores dos "publicadores"&nbsp; </font></font><code>$indexEndpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e&nbsp; </font></font><code>$searchString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">transformá-los em argumento para essa função </font></font><code>endpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para começar, combinaremos os "editores"&nbsp; </font></font><code>$indexEndpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;e&nbsp; </font></font><code>$searchString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Para fazer isso, </font></font><code>Combine</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">existe um operador </font></font><code>Publishers.CombineLatest</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/5i/lz/zh/5ilzzh6h5_aity8uvzd6eladg7q.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em seguida, devemos definir o tipo de erro TYPE "publisher" igual ao necessário&nbsp; </font></font><code>NewsError</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/oe/85/tt/oe85tthmperdfzf6yqiy5fmy2b4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em seguida, queremos usar a função&nbsp; </font></font><code>fetchArticlesErr (from endpoint: Endpoint) </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">da nossa classe </font></font><code>NewsAPI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Como de costume, faremos isso com a ajuda de um operador&nbsp; </font></font><code>flatMap</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que cria um novo "editor" com base nos dados recebidos do "editor" anterior: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/bh/bu/kx/bhbukxfbhg2q9otl4rp-ksponec.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
"Assinamos" esse "editor" recém-recebido com a ajuda de um "assinante" </font></font><code>sink</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e usamos seus fechamentos </font></font><code>receiveCompletion</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><code>receiveValue</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para receber do "editor" o valor de uma matriz de artigos&nbsp; </font></font><code>articles</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou erros </font></font><code>articlesError</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/cq/x8/iy/cqx8iyvnwanwmv1vselki10ytv4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Naturalmente, é necessário lembrar a "assinatura" resultante em alguma </font></font><code>init()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">variável </font><font style="vertical-align: inherit;">externa </font></font><code>cancellableSet</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Caso contrário, não conseguiremos obter o valor de forma assíncrona</font></font><code>articles</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou um erro </font></font><code>articlesError </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">após a conclusão </font></font><code>init()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/kh/wh/_a/khwh_ao98y7zy9cdpenc0nzvntq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
para reduzir o número de chamadas para o servidor ao digitar uma sequência de pesquisa </font></font><code>searchString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, não devemos usar o "editor" da própria barra de pesquisa&nbsp; </font></font><code>$searchString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, mas sua versão modificada </font></font><code>validString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/fl/op/ss/flopssp-pjixvbtesqabmpp1h2s.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
"Inscrevendo-se" no "editor" ASSÍNCRONO que criamos </font></font><code>init( )</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">será persistir durante todo o “ciclo de vida” da instância da classe&nbsp; </font></font><code>ArticlesViewModelErr</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/nt/iw/k4/ntiwk4eju6aneam-1wlymjqyu9a.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Procuramos a correção do nosso </font></font><code> UI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para exibir possíveis erros de amostragem de dados nele. Em </font></font><code>SwiftU</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I, na estrutura existente,&nbsp; </font></font><code>ContentVieArticles</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> &nbsp;usamos outra, apenas obtida&nbsp; </font></font><code>View Model</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, apenas adicionando as letras “Err” no nome. Esta é uma instância da classe.&nbsp;&nbsp;</font></font><code>ArticlesViewModelErr</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, que “captura” o erro de selecionar e / ou decodificar os dados do artigo no servidor&nbsp; </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><br>
<br>
<img src="https://habrastorage.org/webt/kw/vy/uv/kwvyuvbthb08tcalkcdpnucqfbq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Além disso, adicionamos a exibição de uma mensagem de emergência&nbsp; </font></font><code>Alert</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;em caso de erro. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por exemplo, se a chave da API errada for:</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">APIConstants</span> </span>{
    <span class="hljs-comment">// News  API key url: https://newsapi.org</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">let</span> apiKey: <span class="hljs-type">String</span> = <span class="hljs-string">"API_KEY"</span> <font></font>
    <font></font>
   .  .  .  .  .  .  .  .  .  .  .  .  .<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
... então receberemos a seguinte mensagem: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/nb/ws/si/nbwssihj8ldlqqtcbti4tjwcv7o.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se o limite de solicitações estiver esgotado, receberemos a seguinte mensagem: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/cz/de/ux/czdeuxquiscc-6qklciy5a0w3jm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voltando ao método de seleção de artigos&nbsp; </font></font><code>[Article] </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">com um possível erro&nbsp; </font></font><code>NewsError</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, podemos simplificar seu código se usarmos o&nbsp; </font></font><code>Generic</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;"editor" </font></font><code>AnyPublisher&lt;T,NewsError&gt;,</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que, com base no conjunto,&nbsp; </font></font><code>url</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">recebe </font></font><code>JSON</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">informações de </font><font style="vertical-align: inherit;">forma assíncrona </font><font style="vertical-align: inherit;">, as coloca diretamente no </font></font><code>Codable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">modelo </font></font><code>T</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;e relata um erro&nbsp; </font></font><code>NewsError</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/lc/v7/m9/lcv7m9fmdbq20ih5phivj7hl1go.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
como sabemos, esse código é muito fácil de usar para obter um "editor" específico se os dados de origem </font></font><code>url</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">forem um </font><font style="vertical-align: inherit;">&nbsp;país ou&nbsp; </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">agregador de</font></a></font><code>Endpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> notícias&nbsp; </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.org</font></font></a><font style="vertical-align: inherit;"></font><code>country</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fonte de informação e a saída requer vários modelos - por exemplo, uma lista de artigos ou fontes de informação:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ig/ff/4q/igff4qjqmxcxloixsshjbc36uxy.png"><br>
<br>
<img src="https://habrastorage.org/webt/bh/o_/7n/bho_7nbyxpl5yxth1ihweasjbec.png"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusão</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aprendemos como é fácil atender a </font></font><code>HTTP</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">solicitações com a ajuda de </font></font><code> Combine</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">seu </font></font><code>URLSession</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"editor" </font></font><code>dataTaskPublisher</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><code>Codable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Se você não precisa rastrear erros, obtém um </font></font><code> Generic</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">código de 5 linhas </font><font style="vertical-align: inherit;">muito simples </font><font style="vertical-align: inherit;">para o "editor" </font></font><code>AnyPublisher&lt;T, Never&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, que recebe </font></font><code>JSON </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">informações de </font><font style="vertical-align: inherit;">forma assíncrona </font><font style="vertical-align: inherit;">e as coloca diretamente no </font></font><code>Codable </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">modelo com </font></font><code>T</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;base no dado&nbsp; </font></font><code>url</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/2i/r_/6w/2ir_6wkuga1u9jcxsmqijle480e.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este código é muito fácil de usar para obter um editor específico, se os dados de origem </font></font><code>url </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">forem, por exemplo </font></font><code>Endpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, e a saída requer vários modelos - por exemplo, um conjunto de artigos ou uma lista de fontes de informação. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se você precisar levar em conta os erros, o código do&nbsp; </font></font><code>Generic</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"editor" será um pouco mais complicado, mas ainda assim será um código muito simples, sem retornos de chamada:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/fi/4d/ep/fi4depxf-hbngki4p5y3ktunbny.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Usando a tecnologia de execução de </font></font><code>HTTP</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">consultas </font></font><code>Combine</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, você pode criar um "editor" </font></font><code>AnyPublisher&lt;UIImage?, Never&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que seleciona dados de forma assíncrona e recebe uma imagem UIImage? baseado em </font></font><code>URL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Os </font></font><code>ImageLoade</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">downloaders de imagem r são armazenados em cache na memória para evitar a recuperação repetida de dados assíncronos.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todos os tipos de "editores" obtidos podem muito facilmente ser "feitos para funcionar" nas classes ObservableObject, que usam suas propriedades @Published para controlar sua interface do usuário projetada usando o SwiftUI. Essas classes geralmente desempenham o papel do modelo de exibição, pois possuem as chamadas propriedades @Published "entrada" que correspondem aos elementos ativos da interface do usuário (caixas de texto TextField, Stepper, Picker, botões de opção Alternar etc.) e propriedades @Published "output" , consistindo principalmente em elementos passivos da interface do usuário (textos, imagens, imagens, formas geométricas em círculo (), retângulo () etc.). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Essa idéia permeia todo o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aplicativo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> agregador de notícias </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">NewsAPI.org</font></a><font style="vertical-align: inherit;"> apresentado neste artigo. bastante universal e foi usado quando</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">desenvolvimento de um aplicativo para o </font></font></a><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">banco de dados de </font></font></a><font style="vertical-align: inherit;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">filmes </font></a><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">TMDb</font></a><font style="vertical-align: inherit;"> e o agregador de notícias&nbsp; </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hacker News</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , que serão discutidos em artigos futuros. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O código do aplicativo para este artigo está no </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Github</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PS </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1. Quero chamar sua atenção para o fato de que, se você usar o simulador para o aplicativo apresentado neste artigo, saiba que </font></font><code>NavigationLink</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o simulador funciona com um erro. Você pode usar</font></font><code>NavigationLink</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no simulador apenas 1 vez. </font><font style="vertical-align: inherit;">Essa. </font><font style="vertical-align: inherit;">você usou o link, voltou, clique no mesmo link - e nada acontece. </font><font style="vertical-align: inherit;">Até você usar outro link, o primeiro não funcionará, mas o segundo ficará inacessível. </font><font style="vertical-align: inherit;">Mas isso é observado apenas no simulador, em um dispositivo real tudo funciona bem. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2. Algumas fontes de informação ainda usam </font></font><code>http</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">em vez </font></font><code>https</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de "imagens" dos seus artigos. </font><font style="vertical-align: inherit;">Se você definitivamente deseja ver essas “imagens”, mas não pode controlar a fonte de sua aparência, é necessário configurar o sistema de segurança </font></font><code>ATS ( App Transport Security)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para receber essas </font></font><code>http</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“imagens”, mas isso, obviamente, não é uma </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">boa ideia</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Você pode usar </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">opções mais seguras</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Referências:</font></font></h4><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">    HTTP   Swift 5   Combine     SwiftUI.  1 .</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Modern Networking in Swift 5 with URLSession, Combine and Codable.</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">URLSession.DataTaskPublisher’s failure type</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Combine: Asynchronous Programming with Swift</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">«SwiftUI &amp; Combine:  »</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Introducing Combine — WWDC 2019 — Videos — Apple Developer. session 722</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">(  722 «  Combine»   )</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Combine in Practice — WWDC 2019 — Videos — Apple Developer. session 721</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">(  721 «  Combine»   )</a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt488428/index.html">Como prever o futuro na pesquisa Yandex: de correções de erros a consultas de descoberta</a></li>
<li><a href="../pt488432/index.html">Snoop Project, uma ferramenta incrível para inteligência na Internet, que os usuários do RuNet estão esperando há tanto tempo - está disponível</a></li>
<li><a href="../pt488436/index.html">Crie rapidamente músicas de chiptune de código aberto</a></li>
<li><a href="../pt488438/index.html">A história dos formatos de áudio para filmes: a resposta alemã para cassetes compactas - como foi o destino do desenvolvimento</a></li>
<li><a href="../pt488440/index.html">Lords of DOOM: como dois caras criaram um atirador de culto e abalaram a indústria de videogames</a></li>
<li><a href="../pt488446/index.html">Instrumentação russa: transformamos seu design nos dedos</a></li>
<li><a href="../pt488448/index.html">Faça um passeio na Universidade ITMO: nossas master classes, workshops, palestras e competições de estudantes</a></li>
<li><a href="../pt488450/index.html">Como funciona uma nova geração de serviços bancários online</a></li>
<li><a href="../pt488456/index.html">Atividades de projeto em universidades e quais benefícios ela oferece</a></li>
<li><a href="../pt488458/index.html">Desafio de back-end Java / Kotlin do FunCode: anunciados os vencedores</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>