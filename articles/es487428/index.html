<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üö£üèæ üö¥üèº üë≤üèæ Bajo el cap√≥ del cliente bot Yandex.Music üõÇ üêä üóíÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introducci√≥n
 Hola Habr! Nuevamente, estoy con el segundo art√≠culo que afecta a la API Yandex.Music. El caso est√° planeado y mencionado en el primer a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Bajo el cap√≥ del cliente bot Yandex.Music</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/487428/"><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Introducci√≥n</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hola Habr! </font><font style="vertical-align: inherit;">Nuevamente, estoy con el segundo art√≠culo que afecta a la API Yandex.Music. </font><font style="vertical-align: inherit;">El caso est√° planeado y mencionado en el </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">primer art√≠culo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Manos extendidas, hechas. </font><font style="vertical-align: inherit;">Hoy hablar√© sobre interesantes, en mi opini√≥n, momentos que est√°n presentes en la base de c√≥digo de mi bot Telegram, que se posiciona como un cliente de m√∫sica completo. </font><font style="vertical-align: inherit;">Tambi√©n tocaremos la API de reconocimiento de m√∫sica Yandex. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Antes de continuar con la historia punto por punto de la implementaci√≥n de una cosa en particular, valdr√≠a la pena tener una idea sobre el bot en s√≠ y sus capacidades funcionales.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Video demo del cliente</font></font></b><div class="spoiler_text"><iframe width="560" height="315" src="https://www.youtube.com/embed/YOw9hs8tFg0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En la parte principal hablar√© sobre lo siguiente:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Inicie sesi√≥n en su cuenta a trav√©s del sitio en las </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p√°ginas de GitHub</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (por qu√© y por qu√©).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El formato de datos, su empaque y su uso en datos de botones.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Actualizaci√≥n de enrutamiento, control de versiones de datos, lanzamiento de contexto en controladores.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Servicios:</font></font><ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Servicio de recarga de pista en Telegram.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El servicio de "suscripciones" para recibir una pista con el env√≠o del estado de la descarga.</font></font></li>
</ul></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La implementaci√≥n de almacenamiento en cach√© de consultas m√°s simple y elegante.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reconocimiento de una pista por mensaje de voz y c√≥mo apareci√≥ generalmente en el bot.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Peque√±as notas</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si est√° interesado en al menos un punto, bienvenido a cat.</font></font><br>
<img src="https://habrastorage.org/webt/uv/4s/a3/uv4sa3pslohuzlmuzrjzteju2dk.png"><a name="habracut"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El bot funciona con usuarios que han iniciado sesi√≥n en su cuenta, pero no. </font><font style="vertical-align: inherit;">Todo gira en torno a cuatro clases principales de servicio: √°lbum, artista, lista de reproducci√≥n y pista. </font><font style="vertical-align: inherit;">Todos los datos de la entidad son compatibles, hay paginaci√≥n con la selecci√≥n de p√°gina. </font><font style="vertical-align: inherit;">Para interactuar con ellos, un usuario autorizado puede usar su men√∫ personal, que incluye: listas de reproducci√≥n inteligentes, la lista de reproducci√≥n "Me gusta" y sus propias listas de reproducci√≥n. </font><font style="vertical-align: inherit;">Para usuarios no autorizados, la b√∫squeda est√° disponible, enviando una consulta de b√∫squeda como un mensaje regular. </font><font style="vertical-align: inherit;">Ahora solo hay una lista seca de qu√© m√°s hay: recibir pistas y otros objetos a trav√©s de un enlace directo, recibir letras, la posibilidad de que les guste / no les guste la pista y el artista, ver pistas similares, reconocer la pista por mensaje de voz y m√°s.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parte principal</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. Inicie sesi√≥n en la cuenta</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Inicialmente, el bot no estaba planeado para funcionar sin autorizaci√≥n, por lo tanto, incluso durante el dise√±o, se decidi√≥ c√≥mo deber√≠a ocurrir la autorizaci√≥n, a trav√©s de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">su sitio web</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Los principales argumentos fueron la seguridad y la transparencia. En ning√∫n caso no quer√≠a aceptar inicios de sesi√≥n de usuario y contrase√±as en mensajes claros. Y la autorizaci√≥n de la computadora del usuario es elemental. Por lo tanto, se escribi√≥ un sitio para autorizaci√≥n en </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">React</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Es una forma de autorizaci√≥n con un redireccionamiento de regreso al bot. Una pieza con autorizaci√≥n y procesamiento de captcha fue tomada de la biblioteca en </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Python</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y reescrita en </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JavaScript</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para la autorizaci√≥n, se utiliza el token OAuth recibido, que se transfiere de vuelta al bot a trav√©s de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">enlaces profundos</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El enlace final para la redirecci√≥n se ve as√≠: </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t.me/music_yandex_bot?start={oauth_token}</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Quer√≠a lo mejor, pero los usuarios no confiaban. Solo cada d√©cimo usuario estaba autorizado (en el momento en que era obligatorio). Por lo tanto, con las siguientes actualizaciones, tuve que explicar por qu√© deber√≠a confiar. Todos los art√≠culos sobre </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HTTPS</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , exclusivamente sobre las solicitudes del lado del cliente y </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">el c√≥digo fuente abierto</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> se publicaron en el sitio para su autorizaci√≥n y se duplicaron en un mensaje de bienvenida en el bot. Mejor√≥. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Adem√°s, entre los factores de baja autorizaci√≥n, la inaccesibilidad de los espejos para t.me en Rusia result√≥ ser y soporte solo para usuarios con una suscripci√≥n (m√°s sobre esto en las notas, p√°rrafo 7).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El primer elemento se resolvi√≥ utilizando el </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">URI</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tg: //</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), y en caso de necesidad, ya hay un enlace al espejo (si la redirecci√≥n autom√°tica no funcion√≥ y el bot√≥n no ayud√≥), y el segundo est√° nuevamente en el elemento 7.</font></font><br>
<img src="https://habrastorage.org/webt/ez/2_/0j/ez2_0japfosbu9k4bjelikl8x-i.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. Formato de datos</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para este bot, decid√≠ por primera vez usar </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NoSQL</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> DB - </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MongoDB</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Entendido: cuando </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">incrustar un</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> documento, cuando no. Me gust√≥ trabajar con mongoengine. Pero realmente no quer√≠a almacenar todos los datos del bot√≥n en casa, y el cliente solo tiene el </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ID de</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> registro en la base de datos. Estaba aterrorizado por la cantidad de datos, pero quer√≠a tomar un servidor Mongo gratuito con un l√≠mite de 512 MB para el almacenamiento de datos. Encontrar una hermosa reutilizaci√≥n de registros si los datos coinciden en varios botones y limpiar los obsoletos es mucho m√°s dif√≠cil que almacenar todo en los propios botones. Despu√©s de analizar el tama√±o de los datos que se almacenar√°n, conclu√≠ que se ajusta f√°cilmente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al principio, solo us√© </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JSON</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, pero lo rechaz√≥ r√°pidamente cuando se top√≥ con un l√≠mite. En Telegram, el contenido de los datos del bot√≥n solo puede tener un m√°ximo de 64 bytes en </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UTF-8</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por lo tanto, con el aviso de un amigo, comenc√© a mirar el </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">paquete</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> desde el m√≥dulo de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">estructura</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . As√≠ nacieron los tipos de consultas, el formato primitivo, el empaquetado y el desempaquetado. Ahora se usa en el bot absolutamente en todas partes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El formato es muy simple. El primer byte es el tipo, el segundo es la versi√≥n. Todo lo dem√°s son datos para un tipo particular. Los tipos se almacenan como Enum, tienen una </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ID</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , que es el primer byte. Adem√°s de la </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ID</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , cada tipo tiene un formato para empacar y desempacar datos. Por ejemplo: escriba </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SHOW_TRACK_MENU</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cuyo formato tiene el valor "s?", donde "s" es el identificador √∫nico de la pista y "?" - ¬øLa pista tiene texto? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En las pistas se usa el tipo de cadena porque: primero, la </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ID</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de la pista puede ser una concatenaci√≥n de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ID</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ID</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de </font><font style="vertical-align: inherit;">√°lbum </font><font style="vertical-align: inherit;">de la pista a trav√©s de los dos puntos, y en segundo lugar, puede ser </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">el UUID</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Pistas con </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UUID</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : pistas autocargadas, disponibles solo para el usuario que las descarg√≥. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dado que los datos no siempre se corresponden con el formato, por ejemplo, la misma </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ID de</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pista puede representarse simplemente por un n√∫mero, antes de empaquetar debe convertirse en un tipo para el formato. En este caso, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Por lo tanto, en la clase hay un m√©todo que normaliza los datos transferidos para el empaquetado, para no hacerlo usted mismo al pasar al constructor. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Las cadenas son autosuficientes y pueden indicar su longitud al empaquetar y tener en cuenta esta longitud al desempacar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No se planific√≥ la compatibilidad con versiones anteriores, por lo que se genera una excepci√≥n si las versiones no coinciden. </font><font style="vertical-align: inherit;">Al procesar actualizaciones, que analizar√© en el pr√≥ximo p√°rrafo, se llama a la l√≥gica necesaria. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como Telegram come exclusivamente </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UTF-8</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , los datos empaquetados se codifican en </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">base85</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">S√≠, estoy perdiendo velocidad aqu√≠ y guardando el tama√±o m√°s peque√±o sin usar </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">base64</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , pero dados los peque√±os datos, considero que usar </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">base85 es</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> apropiado.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fuente. </font><font style="vertical-align: inherit;">Archivo callback_data.py</font></font></b><div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword">import</span> struct
<span class="hljs-keyword">import</span> base64<font></font>
<font></font>
<span class="hljs-keyword">from</span> ext.query_types <span class="hljs-keyword">import</span> QueryType<font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BadDataVersion</span>(<span class="hljs-params">Exception</span>):</span>
    <span class="hljs-keyword">pass</span><font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CallbackData</span>:</span>
    ACTUAL_VERSION = <span class="hljs-number">7</span>
    BASE_FORMAT = <span class="hljs-string">'&lt;BB'</span><font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, type_: QueryType, data=None, version=None</span>):</span><font></font>
        self.type = type_<font></font>
        self.version = version <span class="hljs-keyword">or</span> CallbackData.ACTUAL_VERSION<font></font>
        self.data = data<font></font>
<font></font>
        <span class="hljs-keyword">if</span> self.data <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> isinstance(self.data, list):<font></font>
            self.data = [self.data]<font></font>
<font></font>
        <span class="hljs-keyword">if</span> self.data <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<font></font>
            self.data = self._normalize_data_to_format(self.data)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__repr__</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">f'&lt;CallbackData&gt; Type: <span class="hljs-subst">{self.type}</span> Version: <span class="hljs-subst">{self.version}</span> Data: <span class="hljs-subst">{self.data}</span>'</span><font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">_normalize_data_to_format</span>(<span class="hljs-params">self, data, bytes_object=False</span>):</span><font></font>
        normalized_data = data.copy()<font></font>
        <span class="hljs-keyword">for</span> i, c <span class="hljs-keyword">in</span> enumerate(self.type.format):<font></font>
            cast = str<font></font>
            <span class="hljs-keyword">if</span> c.lower() <span class="hljs-keyword">in</span> <span class="hljs-string">'bhilqn'</span>:<font></font>
                cast = int<font></font>
            <span class="hljs-keyword">elif</span> c <span class="hljs-keyword">in</span> <span class="hljs-string">'efd'</span>:<font></font>
                cast = float<font></font>
            <span class="hljs-keyword">elif</span> c == <span class="hljs-string">'?'</span>:<font></font>
                cast = bool<font></font>
<font></font>
            casted = cast(data[i])<font></font>
            <span class="hljs-keyword">if</span> bytes_object <span class="hljs-keyword">and</span> cast == str:<font></font>
                casted = casted.encode(<span class="hljs-string">'utf-8'</span>)<font></font>
            normalized_data[i] = casted<font></font>
<font></font>
        <span class="hljs-keyword">return</span> normalized_data<font></font>
<font></font>
<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">decode_type</span>(<span class="hljs-params">callback_data</span>):</span>
        decoded = base64.b85decode(callback_data.encode(<span class="hljs-string">'utf-8'</span>))<font></font>
        type_, version = struct.unpack(CallbackData.BASE_FORMAT, decoded[:<span class="hljs-number">2</span>])<font></font>
<font></font>
        <span class="hljs-keyword">if</span> CallbackData.ACTUAL_VERSION != version:
            <span class="hljs-keyword">raise</span> BadDataVersion()<font></font>
<font></font>
        <span class="hljs-keyword">return</span> QueryType(type_), version, decoded<font></font>
<font></font>
<span class="hljs-meta">    @classmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">decode</span>(<span class="hljs-params">cls, type_, version, decoded</span>):</span>
        start, data = <span class="hljs-number">2</span>, []<font></font>
<font></font>
        <span class="hljs-keyword">if</span> start &lt; len(decoded):<font></font>
            format_iter = iter(type_.format)<font></font>
<font></font>
            <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
                <span class="hljs-keyword">if</span> start &gt;= len(decoded):
                    <span class="hljs-keyword">break</span><font></font>
<font></font>
                format_ = next(format_iter, type_.format[<span class="hljs-number">-1</span>])<font></font>
<font></font>
                decode_str = format_ <span class="hljs-keyword">in</span> <span class="hljs-string">'ps'</span>
                <span class="hljs-keyword">if</span> decode_str:
                    <span class="hljs-comment"># struct.calcsize('b') = 1</span>
                    length = list(struct.unpack(<span class="hljs-string">'b'</span>, decoded[start: start + <span class="hljs-number">1</span>]))[<span class="hljs-number">0</span>]<font></font>
                    start += <span class="hljs-number">1</span><font></font>
<font></font>
                    format_ = <span class="hljs-string">f'<span class="hljs-subst">{length}</span><span class="hljs-subst">{format_}</span>'</span><font></font>
<font></font>
                step = struct.calcsize(format_)<font></font>
<font></font>
                unpacked = list(struct.unpack(<span class="hljs-string">f'<span class="hljs-subst">{format_}</span>'</span>, decoded[start: start + step]))
                <span class="hljs-keyword">if</span> decode_str:<font></font>
                    unpacked[<span class="hljs-number">0</span>] = unpacked[<span class="hljs-number">0</span>].decode(<span class="hljs-string">'UTF-8'</span>)<font></font>
<font></font>
                data += unpacked<font></font>
                start += step<font></font>
<font></font>
        <span class="hljs-keyword">return</span> cls(type_, data <span class="hljs-keyword">if</span> data <span class="hljs-keyword">else</span> <span class="hljs-literal">None</span>, version)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">encode</span>(<span class="hljs-params">self</span>):</span><font></font>
        encode = struct.pack(self.BASE_FORMAT, self.type.value, self.version)<font></font>
<font></font>
        <span class="hljs-keyword">if</span> self.data <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<font></font>
            format_iter = iter(self.type.format)<font></font>
            normalized_data = self._normalize_data_to_format(self.data, bytes_object=<span class="hljs-literal">True</span>)<font></font>
<font></font>
            <span class="hljs-keyword">for</span> data <span class="hljs-keyword">in</span> normalized_data:<font></font>
                format_ = next(format_iter, self.type.format[<span class="hljs-number">-1</span>])<font></font>
<font></font>
                <span class="hljs-keyword">if</span> format_ <span class="hljs-keyword">in</span> <span class="hljs-string">'ps'</span>:
                    <span class="hljs-comment">#        .  'b'  </span>
                    <span class="hljs-comment"># -      ,    &gt; 36 </span>
                    encode += struct.pack(<span class="hljs-string">'b'</span>, len(data))<font></font>
                    encode += struct.pack(<span class="hljs-string">f'<span class="hljs-subst">{len(data)}</span><span class="hljs-subst">{format_}</span>'</span>, data)
                <span class="hljs-keyword">else</span>:<font></font>
                    encode += struct.pack(<span class="hljs-string">f'<span class="hljs-subst">{format_}</span>'</span>, data)<font></font>
<font></font>
        <span class="hljs-keyword">return</span> base64.b85encode(encode).decode(<span class="hljs-string">'utf-8'</span>)<font></font>
<font></font>
</code></pre><br>
</div></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. Actualizaciones de enrutamiento y contexto</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El proyecto utiliza la biblioteca </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">python-telegram-bot</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para trabajar con la </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API de Telegram Bot</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Ya tiene un sistema para registrar controladores para ciertos tipos de actualizaciones que han llegado, filtros para expresiones regulares, comandos, etc. </font><font style="vertical-align: inherit;">Pero, dado mi propio formato de datos y mis tipos, tuve que heredar de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TelegramHandler</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e implementar mi </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">controlador</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La actualizaci√≥n y el contexto se pasan a cada controlador a trav√©s de argumentos. </font><font style="vertical-align: inherit;">En este caso, tengo mi propio contexto y est√° en </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Handler'e</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se est√° formando, y esto es: recibir y / o agregar un usuario a la base de datos, verificar la relevancia del token para obtener acceso a la m√∫sica, inicializar el cliente Yandex.Music, dependiendo del estado de autorizaci√≥n y la disponibilidad de una suscripci√≥n. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
M√°s all√° de mi </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Handler'a hay</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> controladores m√°s espec√≠ficos, por ejemplo, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CallbackQueryHandler</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Con √©l, se registra un controlador para un cierto tipo de actualizaci√≥n (mi tipo, con un formato de datos). Para verificar si esta actualizaci√≥n es adecuada para el controlador actual, no se desempaquetan todos los datos, sino solo los primeros dos bytes. En esta etapa, se verifica la necesidad de iniciar una devoluci√≥n de llamada. Solo si es necesario iniciar la devoluci√≥n de llamada, los datos se desempaquetan por completo y se transfieren como </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kwargs</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">al manejador final. </font><font style="vertical-align: inherit;">Inmediatamente hay un env√≠o de datos anal√≠ticos a </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ChatBase</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El registro se realiza secuencialmente, y la prioridad es mayor para qui√©n se registrar√° antes (de hecho, como en el </font><font style="vertical-align: inherit;">enrutamiento de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Django</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y en otros proyectos). </font><font style="vertical-align: inherit;">Por lo tanto, registrar un controlador para una versi√≥n obsoleta es el primero entre los controladores </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CallBackQuery</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La l√≥gica de procesar la versi√≥n desactualizada es simple: informar al usuario sobre esto y enviar datos actualizados, si es posible.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4. Servicios</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todos los servicios se inicializan cuando el bot se inicia en una clase de control, que luego se usa universalmente en cualquier parte del bot ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DJ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cada servicio tiene su propio </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ThreadPoolExecutor</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> con un cierto n√∫mero de trabajadores en los que se env√≠an las tareas.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Recargar una pista en Telegram</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por el momento, este servicio no se ha reescrito en </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">User Bot</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para omitir el l√≠mite del tama√±o del archivo descargado en Telegram. Al final result√≥ que, en Yandex.Music hay archivos de m√°s de 50 mb - podcasts. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El servicio verifica el tama√±o del archivo y, en caso de exceso, lanza una alerta al usuario. Gracias al sistema de almacenamiento en cach√© descrito en el p√°rrafo 5, esto verifica la disponibilidad y recepci√≥n de la letra. Las pistas tambi√©n se almacenan en cach√©. El hash del archivo se almacena en la base de datos. Si hay uno, se est√° enviando audio con un cach√© conocido. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En ausencia de un archivo en la base de datos, se recibe un enlace directo de Yandex.Music. Aunque en este momento, los usuarios no tienen la capacidad de cambiar la configuraci√≥n de calidad, pero todos est√°n configurados con valores est√°ndar. El archivo se busca por bitrate y c√≥dec desde la configuraci√≥n del usuario.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El archivo y su portada se descargan como </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tempfile.TemporaryFile ()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , luego de lo cual se cargan en Telegram. </font><font style="vertical-align: inherit;">Vale la pena se√±alar que TG no siempre reconoce correctamente la duraci√≥n de la pista, pero en general no digo nada sobre el artista y el t√≠tulo. </font><font style="vertical-align: inherit;">Por lo tanto, estos datos se toman de Yandex, afortunadamente, es posible transmitirlos al carrito. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cuando este servicio env√≠a un archivo de audio, se llama a </font><font style="vertical-align: inherit;">complete_callback </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , se√±alando el servicio por suscripci√≥n sobre el final de la descarga.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Servicio de suscripci√≥n para recibir pistas y enviar el estado de descarga</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Las pistas no se cargan al instante. Es posible que varios usuarios hayan solicitado la misma pista. En este caso, el usuario que solicit√≥ la pista primero es el iniciador y el propietario de la pista. Al recargar m√°s de un segundo, comienza el estado de descarga: "El usuario env√≠a un mensaje de voz". Otros usuarios que solicitaron la misma pista son suscriptores habituales. A ellos, como al propietario, se les env√≠a el estado de descarga una vez cada ~ 4 segundos para que el mensaje no se interrumpa (el estado se cuelga durante 5 segundos). Tan pronto como se complete la descarga de la pista para el propietario, se llama a complete_callback </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> desde el servicio anterior. Despu√©s de eso, todos los suscriptores se eliminan de la lista de estado y reciben la pista descargada.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En la soluci√≥n arquitect√≥nica, el propietario de la pista tambi√©n es suscriptor, pero con una cierta marca, ya que las formas de enviar la pista son diferentes.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5. Cach√© de consultas</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como recordamos de mi √∫ltimo art√≠culo, las solicitudes a la API Yandex.Music son muy pesadas. La lista de pistas puede ser de 3 o 5 mb. Adem√°s, solo hay muchas solicitudes. Con cada proceso de actualizaci√≥n, se env√≠an al menos 2 solicitudes a Yandex: para inicializar el cliente y para una acci√≥n espec√≠fica. En algunos lugares, para recopilar suficiente informaci√≥n (por ejemplo, para una lista de reproducci√≥n), debe solicitar una lista de reproducci√≥n, para recibir sus pistas, para obtener informaci√≥n de la p√°gina de destino (si se trata de una lista de reproducci√≥n inteligente) y no se olvide de la inicializaci√≥n del cliente. En general, horror silencioso en cuanto a la cantidad de solicitudes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quer√≠a algo muy universal, y no hacer ning√∫n tipo de almacenamiento para ciertos objetos, los mismos clientes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dado que la biblioteca le permite especificar su propia instancia para la ejecuci√≥n de consultas, adem√°s de las </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">solicitudes</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Entonces aprovech√© esto. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El punto es simple. La clase de cach√© en s√≠ es un singleton. Tiene solo dos par√°metros: duraci√≥n de cach√©, tama√±o. Cuando se ejecuta la solicitud, se llama al reiniciador. El es anulado. La comprobaci√≥n de la memoria cach√© se produce por hash de args y cuartos de gal√≥n congelados. El cach√© tiene tiempo para agregar. Cuando se verifica la necesidad de actualizar los datos, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se obtienen</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> datos de </font><i><font style="vertical-align: inherit;">LimitedSizeDict</font></i><font style="vertical-align: inherit;"> o se realiza una solicitud real y se agrega al cach√©. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Algunas solicitudes no se pueden almacenar en cach√©, por ejemplo, establecer un Me gusta / No me gusta. Si el usuario presiona la siguiente secuencia: like, dislike, like, al final no se entregar√° like. Para tales casos, al enviar una solicitud, debe pasar el argumento </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">use_cache</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> con un valor igual a </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">False</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">En realidad, este es el √∫nico lugar donde no se usa el cach√©. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gracias a esto, hago las solicitudes m√°s audaces para que se almacenen en cach√©. </font><font style="vertical-align: inherit;">No estoy tratando de dividirlo en peque√±os y solo lo necesito para la p√°gina actual. </font><font style="vertical-align: inherit;">Tomo todo de una vez, y cuando cambio de p√°gina tengo una velocidad de cambio enorme (en comparaci√≥n con el enfoque anterior). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En cuanto a m√≠, la clase de solicitud en cach√© result√≥ muy bien y simplemente se integr√≥.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fuente</font></font></b><div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword">import</span> copy
<span class="hljs-keyword">import</span> time<font></font>
<font></font>
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> Union
<span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> OrderedDict<font></font>
<font></font>
<span class="hljs-keyword">import</span> requests<font></font>
<font></font>
<span class="hljs-keyword">from</span> yandex_music.utils.request <span class="hljs-keyword">import</span> Request <span class="hljs-keyword">as</span> YandexMusicRequest<font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LimitedSizeDict</span>(<span class="hljs-params">OrderedDict</span>):</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, *args, **kwargs</span>):</span>
        self.size_limit = kwargs.pop(<span class="hljs-string">"size_limit"</span>, <span class="hljs-literal">None</span>)<font></font>
        OrderedDict.__init__(self, *args, **kwargs)<font></font>
        self._check_size_limit()<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__setitem__</span>(<span class="hljs-params">self, key, value</span>):</span><font></font>
        OrderedDict.__setitem__(self, key, value)<font></font>
        self._check_size_limit()<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">_check_size_limit</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-keyword">if</span> self.size_limit <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:
            <span class="hljs-keyword">while</span> len(self) &gt; self.size_limit:<font></font>
                self.popitem(last=<span class="hljs-literal">False</span>)<font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CachedItem</span>:</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, response: requests.Response</span>):</span><font></font>
        self.timestamp = time.time()<font></font>
        self.response = response<font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Cache</span>:</span>
    __singleton: <span class="hljs-string">'Cache'</span> = <span class="hljs-literal">None</span><font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, lifetime: Union[str, int], size: Union[str, int]</span>):</span><font></font>
        Cache.__singleton = self<font></font>
<font></font>
        self.lifetime = int(lifetime) * <span class="hljs-number">60</span><font></font>
        self.size = int(size)<font></font>
<font></font>
        self.storage: LimitedSizeDict = LimitedSizeDict(size_limit=int(size))<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get</span>(<span class="hljs-params">self, *args, **kwargs</span>):</span><font></font>
        hash_ = Cache.get_hash(*args, **kwargs)<font></font>
<font></font>
        <span class="hljs-keyword">return</span> self.storage[hash_].response<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">update</span>(<span class="hljs-params">self, response: requests.Response, *args, **kwargs</span>):</span><font></font>
        hash_ = Cache.get_hash(*args, **kwargs)<font></font>
        self.storage.update({hash_: CachedItem(response)})<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">need_to_fetch</span>(<span class="hljs-params">self, *args, **kwargs</span>):</span><font></font>
        hash_ = Cache.get_hash(*args, **kwargs)<font></font>
        cached_item = self.storage.get(hash_)<font></font>
<font></font>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> cached_item:
            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><font></font>
<font></font>
        <span class="hljs-keyword">if</span> time.time() - cached_item.timestamp &gt; self.lifetime:
            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><font></font>
<font></font>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><font></font>
<font></font>
<span class="hljs-meta">    @classmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_instance</span>(<span class="hljs-params">cls</span>) -&gt; 'Cache':</span>
        <span class="hljs-keyword">if</span> cls.__singleton <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:
            <span class="hljs-keyword">return</span> cls.__singleton
        <span class="hljs-keyword">else</span>:
            <span class="hljs-keyword">raise</span> RuntimeError(<span class="hljs-string">f'<span class="hljs-subst">{cls.__name__}</span> not initialized'</span>)<font></font>
<font></font>
<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">freeze_dict</span>(<span class="hljs-params">d: dict</span>) -&gt; Union[frozenset, tuple, dict]:</span>
        <span class="hljs-keyword">if</span> isinstance(d, dict):
            <span class="hljs-keyword">return</span> frozenset((key, Cache.freeze_dict(value)) <span class="hljs-keyword">for</span> key, value <span class="hljs-keyword">in</span> d.items())
        <span class="hljs-keyword">elif</span> isinstance(d, list):
            <span class="hljs-keyword">return</span> tuple(Cache.freeze_dict(value) <span class="hljs-keyword">for</span> value <span class="hljs-keyword">in</span> d)<font></font>
<font></font>
        <span class="hljs-keyword">return</span> d<font></font>
<font></font>
<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_hash</span>(<span class="hljs-params">*args, **kwargs</span>):</span>
        <span class="hljs-keyword">return</span> hash((args, Cache.freeze_dict(kwargs)))<font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Request</span>(<span class="hljs-params">YandexMusicRequest</span>):</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">_request_wrapper</span>(<span class="hljs-params">self, *args, **kwargs</span>):</span>
        use_cache = kwargs.get(<span class="hljs-string">'use_cache'</span>, <span class="hljs-literal">True</span>)<font></font>
<font></font>
        <span class="hljs-keyword">if</span> <span class="hljs-string">'use_cache'</span> <span class="hljs-keyword">in</span> kwargs:<font></font>
            kwargs.pop(<span class="hljs-string">'use_cache'</span>)<font></font>
<font></font>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> use_cache:<font></font>
            response = super()._request_wrapper(*args, **copy.deepcopy(kwargs))<font></font>
        <span class="hljs-keyword">elif</span> use_cache <span class="hljs-keyword">and</span> Cache.get_instance().need_to_fetch(*args, **kwargs):<font></font>
            response = super()._request_wrapper(*args, **copy.deepcopy(kwargs))<font></font>
            Cache.get_instance().update(response, *args, **kwargs)<font></font>
        <span class="hljs-keyword">else</span>:<font></font>
            response = Cache.get_instance().get(*args, **kwargs)<font></font>
<font></font>
        <span class="hljs-keyword">return</span> response<font></font>
<font></font>
</code></pre><br>
</div></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6. Seguimiento de reconocimiento por mensaje de voz</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al principio, no se pensaba agregar esto al bot, pero ocurri√≥ una situaci√≥n interesante. El bot tiene un chat (se indica en la descripci√≥n del bot). Despu√©s de un tiempo, not√© que la gente entra y env√≠a mensajes de voz con m√∫sica. Al principio, pens√© que era un nuevo tipo de correo no deseado, de modo que alguien brome√≥ y estaba bromeando. Pero, cuando ya hab√≠a 10 de esas personas y todos estaban haciendo lo mismo, mi amigo (el mismo sugerido por </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">struct</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) sugiri√≥ que los usuarios manejaran Yandex.Music en busca de un bot oficial para reconocer la m√∫sica de Yandex, ¬°ven una sala de chat all√≠ y le env√≠an mensajes de voz con toda seriedad! Era solo una suposici√≥n brillante y verdadera. Luego, bromeando, dije que era hora de hacer un reconocimiento y agregar un bot al chat. Por diversi√≥n ... ¬°Despu√©s de un tiempo, esto se hizo!</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora sobre la </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Recientemente, Yandex ha utilizado cada vez m√°s los sockets web. Conoc√≠ su uso en la gesti√≥n de un i.module y un i.station. El servicio de reconocimiento de m√∫sica tambi√©n funciona en √©l. Lanc√© la soluci√≥n de trabajo m√≠nima en mi bot, pero no agregu√© la implementaci√≥n a la biblioteca. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WS</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> se encuentra en la siguiente direcci√≥n: </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wss: //voiceservices.yandex.net/uni.ws</font></font></i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Necesitamos solo dos mensajes: autorizaci√≥n y una solicitud de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">reconocimiento</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Yandex, en su aplicaci√≥n oficial, env√≠a archivos cortos en un segundo o tres. En respuesta, puede tener la necesidad de enviar m√°s datos o el resultado, encontrado o no. Si se encuentra el resultado, se devolver√° la identificaci√≥n de la pista. </font><i><font style="vertical-align: inherit;">Los</font></i><font style="vertical-align: inherit;"> archivos </font><i><font style="vertical-align: inherit;">Ogg</font></i><font style="vertical-align: inherit;"> se </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
env√≠an </font><font style="vertical-align: inherit;">con</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CODIFICADOR = SpeechKit Mobile SDK v3.28.0</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">No verifiqu√© c√≥mo funciona con otros codificadores, simplemente lo cambi√© en el archivo grabado por Telegram. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cuando se invierte con un socket web, a veces ocurre magia. </font><font style="vertical-align: inherit;">A veces no pod√≠a encontrar la pista, pero cuando cambi√© el idioma del mensaje con la solicitud de reconocimiento, lo hice. </font><font style="vertical-align: inherit;">O al principio lo encontr√≥, y luego se detuvo, aunque el archivo es el mismo. </font><font style="vertical-align: inherit;">Pens√© que el idioma de la pista lo establece su </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SpeechKit</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> en el cliente. </font><font style="vertical-align: inherit;">Al no tener la oportunidad de hacerlo yo mismo, hago una b√∫squeda de fuerza bruta.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mi implementaci√≥n de reconocimiento de voz hecha por la rodilla por mensajes de voz de Telegram</font></font></b><div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword">import</span> uuid<font></font>
<font></font>
<span class="hljs-keyword">import</span> lomond<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_auth_data</span>():</span>
    <span class="hljs-keyword">return</span> {
        <span class="hljs-string">"event"</span>: {
            <span class="hljs-string">"header"</span>: {
                <span class="hljs-string">"messageId"</span>: str(uuid.uuid4()),
                <span class="hljs-string">"name"</span>: <span class="hljs-string">"SynchronizeState"</span>,
                <span class="hljs-string">"namespace"</span>: <span class="hljs-string">"System"</span><font></font>
            },<font></font>
            <span class="hljs-string">"payload"</span>: {
                <span class="hljs-string">"accept_invalid_auth"</span>: <span class="hljs-literal">True</span>,
                <span class="hljs-string">"auth_token"</span>: <span class="hljs-string">"5983ba91-339e-443c-8452-390fe7d9d308"</span>,
                <span class="hljs-string">"uuid"</span>: str(uuid.uuid4()).replace(<span class="hljs-string">'-'</span>, <span class="hljs-string">''</span>),<font></font>
            }<font></font>
        }<font></font>
    }<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_asr_data</span>():</span>
    <span class="hljs-keyword">return</span> {
        <span class="hljs-string">"event"</span>: {
            <span class="hljs-string">"header"</span>: {
                <span class="hljs-string">"messageId"</span>: str(uuid.uuid4()),
                <span class="hljs-string">"name"</span>: <span class="hljs-string">"Recognize"</span>,
                <span class="hljs-string">"namespace"</span>: <span class="hljs-string">"ASR"</span>,
                <span class="hljs-string">"streamId"</span>: <span class="hljs-number">1</span><font></font>
            },<font></font>
            <span class="hljs-string">"payload"</span>: {
                <span class="hljs-string">"advancedASROptions"</span>: {
                    <span class="hljs-string">"manual_punctuation"</span>: <span class="hljs-literal">False</span>,
                    <span class="hljs-string">"partial_results"</span>: <span class="hljs-literal">False</span><font></font>
                },<font></font>
                <span class="hljs-string">"disableAntimatNormalizer"</span>: <span class="hljs-literal">False</span>,
                <span class="hljs-string">"format"</span>: <span class="hljs-string">"audio/opus"</span>,
                <span class="hljs-string">"music_request2"</span>: {
                    <span class="hljs-string">"headers"</span>: {
                        <span class="hljs-string">"Content-Type"</span>: <span class="hljs-string">"audio/opus"</span><font></font>
                    }<font></font>
                },<font></font>
                <span class="hljs-string">"punctuation"</span>: <span class="hljs-literal">False</span>,
                <span class="hljs-string">"tags"</span>: <span class="hljs-string">"PASS_AUDIO;"</span>,
                <span class="hljs-string">"topic"</span>: <span class="hljs-string">"queries"</span><font></font>
            }<font></font>
        }<font></font>
    }<font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Recognition</span>:</span>
    URI = <span class="hljs-string">'wss://voiceservices.yandex.net/uni.ws'</span>
    LANGS = [<span class="hljs-string">''</span>, <span class="hljs-string">'ru-RU'</span>, <span class="hljs-string">'en-US'</span>]<font></font>
    POLL_DELAY = <span class="hljs-number">0.3</span><font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, binary_data, status_msg</span>):</span><font></font>
        self.status_msg = status_msg<font></font>
        self.websocket = lomond.WebSocket(self.URI)<font></font>
        self.chunks = self.get_chunks_and_replace_encoder(binary_data)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_track_id</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-keyword">for</span> lang <span class="hljs-keyword">in</span> Recognition.LANGS:<font></font>
            asr_data = get_asr_data()<font></font>
            <span class="hljs-keyword">if</span> lang:<font></font>
                asr_data[<span class="hljs-string">'event'</span>][<span class="hljs-string">'payload'</span>].update({<span class="hljs-string">'lang'</span>: lang})<font></font>
                self.status_msg.edit_text(<span class="hljs-string">f'     <span class="hljs-subst">{lang}</span>...'</span>)
            <span class="hljs-keyword">else</span>:<font></font>
                self.status_msg.edit_text(<span class="hljs-string">f'      ...'</span>)<font></font>
<font></font>
            <span class="hljs-keyword">for</span> msg <span class="hljs-keyword">in</span> self.websocket.connect(poll=self.POLL_DELAY):
                <span class="hljs-keyword">if</span> msg.name == <span class="hljs-string">'ready'</span>:<font></font>
                    self.websocket.send_json(get_auth_data())<font></font>
                    self.websocket.send_json(asr_data)<font></font>
<font></font>
                    <span class="hljs-keyword">for</span> chunk <span class="hljs-keyword">in</span> self.chunks:<font></font>
                        self.websocket.send_binary(chunk)<font></font>
<font></font>
                <span class="hljs-keyword">if</span> msg.name == <span class="hljs-string">'text'</span>:<font></font>
                    response = msg.json.get(<span class="hljs-string">'directive'</span>)<font></font>
<font></font>
                    <span class="hljs-keyword">if</span> self.is_valid_response(response):<font></font>
                        self.websocket.close()<font></font>
<font></font>
                        <span class="hljs-keyword">return</span> self.parse_track_id(response)
                    <span class="hljs-keyword">elif</span> self.is_fatal_error(response):<font></font>
                        self.websocket.close()<font></font>
<font></font>
                        <span class="hljs-keyword">break</span><font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">is_valid_response</span>(<span class="hljs-params">self, response</span>):</span>
        <span class="hljs-keyword">if</span> response.get(<span class="hljs-string">'header'</span>, {}).get(<span class="hljs-string">'name'</span>) == <span class="hljs-string">'MusicResult'</span> <span class="hljs-keyword">and</span> \<font></font>
                response.get(<span class="hljs-string">'payload'</span>, {}).get(<span class="hljs-string">'result'</span>) == <span class="hljs-string">'success'</span>:<font></font>
            self.status_msg.edit_text(<span class="hljs-string">f' ,  !'</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><font></font>
<font></font>
<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">is_fatal_error</span>(<span class="hljs-params">response</span>):</span>
        <span class="hljs-keyword">if</span> response.get(<span class="hljs-string">'header'</span>, {}).get(<span class="hljs-string">'name'</span>) == <span class="hljs-string">'MusicResult'</span> <span class="hljs-keyword">and</span> \<font></font>
                response.get(<span class="hljs-string">'payload'</span>, {}).get(<span class="hljs-string">'result'</span>) == <span class="hljs-string">'music'</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><font></font>
<font></font>
<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">parse_track_id</span>(<span class="hljs-params">response</span>):</span>
        <span class="hljs-keyword">return</span> response[<span class="hljs-string">'payload'</span>][<span class="hljs-string">'data'</span>][<span class="hljs-string">'match'</span>][<span class="hljs-string">'id'</span>]<font></font>
<font></font>
<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_chunks_and_replace_encoder</span>(<span class="hljs-params">binary_data</span>):</span><font></font>
        chunks = []<font></font>
<font></font>
        <span class="hljs-keyword">for</span> chunk <span class="hljs-keyword">in</span> binary_data.split(<span class="hljs-string">b'OggS'</span>)[<span class="hljs-number">1</span>:]:
            <span class="hljs-keyword">if</span> <span class="hljs-string">b'OpusTags'</span> <span class="hljs-keyword">in</span> chunk:<font></font>
                pos = chunk.index(<span class="hljs-string">b'OpusTags'</span>) + <span class="hljs-number">12</span><font></font>
                size = len(chunk)<font></font>
                chunk = chunk[:pos] + <span class="hljs-string">b'#\x00\x00\x00\x00ENCODER=SpeechKit Mobile SDK v3.28.0'</span>
                chunk += <span class="hljs-string">b"\x00"</span> * (size - len(chunk))<font></font>
<font></font>
            chunks.append(<span class="hljs-string">b'\x00\x00\x00\x01OggS'</span> + chunk)<font></font>
<font></font>
        <span class="hljs-keyword">return</span> chunks<font></font>
<font></font>
</code></pre><br>
     ,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"> </a>.<br>
</div></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7. Peque√±as notas</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Inicialmente, solo los usuarios con una suscripci√≥n pod√≠an usar el bot debido al hecho de que el servicio se puede usar en un n√∫mero limitado de pa√≠ses (sin suscripci√≥n), y el servidor con el bot est√° ubicado en Europa. El problema se resuelve utilizando un proxy para ejecutar solicitudes de usuarios sin una suscripci√≥n. El servidor proxy se encuentra en Mosc√∫. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hay una variedad de p√°ginas, pero est√° limitado a 100 (no se pueden agregar m√°s botones, restricci√≥n de Telegram). Algunas solicitudes de p√°gina comunes tienen muchas m√°s p√°ginas.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En la b√∫squeda de Yandex, el n√∫mero de elementos en la p√°gina est√° codificado. Cu√°ntas pistas, cu√°ntas listas de reproducci√≥n. A veces esto ni siquiera corresponde a la cantidad de datos que se muestran en el frente. Hay un cambio de p√°gina, el n√∫mero de elementos es flotante. Por lo tanto, en el bot tambi√©n salta, lo que no es muy hermoso. Y combinar su paginador con el suyo, algo as√≠. En otros lugares donde es posible solicitar un cierto n√∫mero de elementos por p√°gina, todo es perfecto. El mensaje de voz despu√©s de implementar la b√∫squeda en el bot es </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t.me/MarshalC/416</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cuando se reenv√≠a el audio en Telegram, el autor se pierde y se le asigna al que realiz√≥ el reenv√≠o. Por lo tanto, todas las pistas se env√≠an con la firma del nombre de usuario del bot. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mensaje de voz con todo lo que conoc√≠ despu√©s de la implementaci√≥n de la radio en la biblioteca - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t.me/MarshalC/422</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(sobre la cadena de pistas, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">revis√°ndola</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> enviando un mont√≥n de comentarios, </font><i><font style="vertical-align: inherit;">batch_id</font></i><font style="vertical-align: inherit;"> ).</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusi√≥n</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A pesar de que este es otro art√≠culo sobre el bot de Telegram, lo ley√≥ hasta aqu√≠, probablemente porque estaba interesado en uno de los elementos del corte y esto es maravilloso, ¬° </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">muchas gracias</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Desafortunadamente, no abr√≠ el c√≥digo fuente del bot por completo (porque en algunos lugares necesito refactorizar). </font><font style="vertical-align: inherit;">Mucho se ha descrito en este art√≠culo, pero algunos aspectos, por ejemplo, con los teclados virtuales y su generaci√≥n no se ven afectados. </font><font style="vertical-align: inherit;">En su mayor parte, lo que no est√° en el art√≠culo es solo trabajar con mi biblioteca, nada interesante.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Las clases en torno a las cuales gira todo, las mostr√© en la forma en que est√°n ahora. Admito que hay errores, pero todo funciona durante mucho tiempo. En algunos lugares me gusta mi c√≥digo, en otros no, y esto es normal. No olvide que trabajar con WS para el reconocimiento es una soluci√≥n sobre la rodilla. Listo para leer cr√≠ticas razonadas en los comentarios. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aunque el bot se plane√≥ incluso cuando comenc√© a escribir la biblioteca, rechac√© esta idea, pero, al parecer, regres√© (era aburrido). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Yandex.Music Bot: un proyecto que demuestra la idoneidad del uso de la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">biblioteca para trabajar con la API</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> en proyectos.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Muchas gracias a mam√°, Yana, Sana'a, Glory. </font><font style="vertical-align: inherit;">Alguien por corregir errores, algunos por pistas, sin los cuales algunos puntos en este art√≠culo podr√≠an no haber existido, y algunos simplemente por evaluar el art√≠culo antes de su publicaci√≥n. </font><font style="vertical-align: inherit;">Arthur por picci para el art√≠culo, Lyod por el logo. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PD:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ahora tengo un problema agudo con la distribuci√≥n despu√©s del estudio. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si est√° listo para hacerme una llamada, d√≠game a d√≥nde enviar el CV, entr√©gueme, por favor. </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Todos mis contactos est√°n en el perfil. </font><font style="vertical-align: inherit;">El tiempo est√° ardiendo, espero por ti. </font><font style="vertical-align: inherit;">Seg√∫n la ley, solo puedo entrenar en la Rep√∫blica de Bielorrusia. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PPS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Este fue el segundo art√≠culo de tres, pero sin la m√°s m√≠nima idea tendr√© tiempo para hacer otro proyecto sobre este tema y si es necesario. </font><font style="vertical-align: inherit;">Revelar√© p√∫blicamente su tema: el cliente multiplataforma Yandex.Music.</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es487428/">https://habr.com/ru/post/es487428/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es487418/index.html">¬øQu√© es el SAP?</a></li>
<li><a href="../es487420/index.html">Sound War Z. Prueba de altavoces y auriculares MusicDealer</a></li>
<li><a href="../es487422/index.html">Responsabilidades del administrador de Salesforce: qu√© se debe hacer y cu√°ndo</a></li>
<li><a href="../es487424/index.html">C√≥mo escalar de 1 a 100,000 usuarios</a></li>
<li><a href="../es487426/index.html">La flexibilidad determina el √©xito.</a></li>
<li><a href="../es487430/index.html">¬øQu√© habilidades se necesitan para crear una aplicaci√≥n de iOS? Informe Yandex</a></li>
<li><a href="../es487432/index.html">Siga los pasos de DevConf y CfgMgmtCamp o lo que puede aprender yendo al orador en 2 conferencias internacionales en 2 semanas</a></li>
<li><a href="../es487438/index.html">¬øC√≥mo crear una empresa de TI desde cero, sin experiencia en este campo y habilidades de programaci√≥n?</a></li>
<li><a href="../es487444/index.html">‚ÄúMientras tomaba caf√©, facturaba y recib√≠a un impulso de pago‚Äù: innovaciones que le permiten realizar negocios las 24 horas, los 7 d√≠as de la semana</a></li>
<li><a href="../es487446/index.html">¬øPuede una empresa "poseer" el color?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>