<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§¥üèª üßëüèΩ‚Äçü§ù‚ÄçüßëüèΩ üåû Soudain, un syst√®me de collecte des ordures √† lui seul ne suffit pas üéóÔ∏è üöÖ üòõ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Voici une courte histoire sur les myst√©rieuses pannes de serveur que j'ai d√ª d√©boguer il y a un an (article dat√© du 05 d√©cembre 2018, environ). Les se...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Soudain, un syst√®me de collecte des ordures √† lui seul ne suffit pas</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/487038/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Voici une courte histoire sur les myst√©rieuses pannes de serveur que j'ai d√ª d√©boguer il y a un an (article dat√© du 05 d√©cembre 2018, environ). </font><font style="vertical-align: inherit;">Les serveurs ont bien fonctionn√© pendant un certain temps, puis √† un moment donn√©, ils ont commenc√© √† planter. </font><font style="vertical-align: inherit;">Apr√®s cela, les tentatives d'ex√©cution de presque tous les programmes qui se trouvaient sur les serveurs ont √©chou√© avec les erreurs ¬´Il n'y a pas d'espace sur le p√©riph√©rique¬ª, bien que le syst√®me de fichiers n'ait signal√© que quelques gigaoctets occup√©s sur ~ 20 Go de disques.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il s'est av√©r√© que le probl√®me √©tait d√ª au syst√®me de journalisation. Il s'agissait d'une application Ruby qui prend les fichiers journaux, envoie des donn√©es √† un serveur distant et supprime les anciens fichiers. L'erreur √©tait que les fichiers journaux ouverts n'√©taient pas explicitement ferm√©s. Au lieu de cela, l'application a permis au garbage collector automatique de Ruby de nettoyer les objets File. Le probl√®me est que les objets Fichier n'utilisent pas beaucoup de m√©moire, donc le syst√®me de journalisation pourrait th√©oriquement garder des millions de journaux ouverts avant que la collecte des ordures ne soit requise.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
* Les syst√®mes de fichiers Nix s√©parent les noms de fichiers et les donn√©es dans les fichiers. Les donn√©es sur un disque peuvent avoir plusieurs noms de fichiers pointant vers elles (c'est-√†-dire des liens durs), et les donn√©es sont supprim√©es uniquement lorsque le dernier lien est supprim√©. Un descripteur de fichier ouvert est consid√©r√© comme un lien, donc si le fichier est supprim√© pendant la lecture du programme, le nom du fichier dispara√Æt du r√©pertoire, mais les donn√©es du fichier restent actives jusqu'√† ce que le programme le ferme. C'est ce qui est arriv√© √† l'enregistreur. La commande du (¬´utilisation du disque¬ª) recherche les fichiers √† l'aide d'une liste de r√©pertoires, elle n'a donc pas vu les gigaoctets de donn√©es de fichier pour les milliers de fichiers journaux qui √©taient encore ouverts. Ces fichiers n'ont √©t√© d√©couverts qu'apr√®s avoir ex√©cut√© lsof ("list open files").</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bien s√ªr, une erreur similaire se produit dans d'autres cas similaires. Il y a quelques mois, j'ai d√ª rencontrer une application Java qui est tomb√©e en panne apr√®s quelques jours en raison d'une fuite dans les connexions r√©seau. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'√©crivais la plupart de mon code en C, puis en C ++. √Ä cette √©poque, je pensais que la gestion manuelle des ressources √©tait suffisante. C'√©tait compliqu√©? Chaque malloc () a besoin de la fonction free (), et chaque open () a besoin de close (). Simplement. Sauf que tous les programmes ne sont pas simples, la gestion manuelle des ressources au fil du temps est devenue une camisole de force. Puis un jour, j'ai d√©couvert le comptage de liens et la collecte des ordures. J'ai pens√© que cela r√©sout tous mes probl√®mes et j'ai compl√®tement cess√© de me soucier de la gestion des ressources. Encore une fois, pour les programmes simples, c'√©tait normal, mais tous les programmes ne sont pas simples.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous ne pouvez pas compter sur la r√©cup√©ration de place, car elle ne r√©sout que le probl√®me de la gestion de la m√©moire, et les programmes complexes doivent traiter bien plus que de la m√©moire. Il y a un m√®me populaire qui r√©pond √† cela avec le fait que la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m√©moire est √† 95% des probl√®mes de ressources</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Vous pourriez m√™me dire que toutes les ressources repr√©sentent 0% de vos probl√®mes - jusqu'√† ce que vous en manquiez. Ensuite, cette ressource devient 100% de vos probl√®mes.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais une telle pens√©e per√ßoit toujours les ressources comme un cas particulier. Un probl√®me plus profond est que, √† mesure que les programmes deviennent plus complexes, tout tend √† devenir une ressource. Par exemple, prenez un programme de calendrier. Un programme de calendrier sophistiqu√© permet √† plusieurs utilisateurs de g√©rer plusieurs calendriers partag√©s et avec des √©v√©nements qui peuvent √™tre partag√©s sur plusieurs calendriers. Toute partie des donn√©es affectera finalement plusieurs parties du programme et devrait √™tre pertinente et correcte. Par cons√©quent, pour toutes les donn√©es dynamiques, vous avez besoin d'un propri√©taire, et pas seulement pour la gestion de la m√©moire. √Ä mesure que de nouvelles fonctionnalit√©s sont ajout√©es, de plus en plus de parties du programme devront √™tre mises √† jour. Si vous √™tes sain d'esprit, vous ne pourrez autoriser la mise √† jour des donn√©es que d'une partie du programme √† la fois,de sorte que le droit et la responsabilit√© de mettre √† jour les donn√©es deviennent en soi une ressource limit√©e. La mod√©lisation de donn√©es mut√©es √† l'aide de structures immuables n'entra√Æne pas la disparition de ces probl√®mes, mais les traduit seulement dans un autre paradigme.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La planification de la propri√©t√© et de la dur√©e de vie des ressources est une partie in√©vitable de la conception de logiciels complexes. C'est plus facile si vous utilisez des mod√®les courants. L'un des mod√®les est les ressources interchangeables. Un exemple est la cha√Æne immuable "foo", qui est s√©mantiquement la m√™me que tout autre "foo" immuable. Ce type de ressource n'a pas besoin d'une dur√©e de vie ou d'une possession pr√©d√©termin√©e. En fait, afin de rendre le syst√®me aussi simple que possible, il est pr√©f√©rable de ne pas avoir une dur√©e de vie ou une propri√©t√© pr√©d√©termin√©e (hi Rust, environ par personne). Un autre mod√®le est celui des ressources qui ne sont pas interchangeables, mais qui ont une dur√©e de vie d√©termin√©e. Cela inclut les connexions r√©seau, ainsi que des concepts plus abstraits, tels que le droit de contr√¥ler une partie des donn√©es.La chose la plus raisonnable est de garantir explicitement la dur√©e de vie de ces choses lors de l'encodage.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Notez que le garbage collection automatique est vraiment bon pour impl√©menter le premier mod√®le, mais pas le second, tandis que les techniques de gestion manuelle des ressources (telles que RAII) sont excellentes pour impl√©menter le deuxi√®me mod√®le, mais terribles pour le premier. </font><font style="vertical-align: inherit;">Ces deux approches deviennent compl√©mentaires dans des programmes complexes.</font></font></div>
      
    </div><p class="reference-to-source js-reference-to-source">Source: https://habr.com/ru/post/undefined/</p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr487012/index.html">Sergey Zaichenko: "Si vous ne savez pas o√π obtenir les donn√©es, obtenez-les de l'OSM"</a></li>
<li><a href="../fr487014/index.html">Nothing At Stake: compromis avec la conscience</a></li>
<li><a href="../fr487020/index.html">Ok Google, merci pour la nouvelle voiture</a></li>
<li><a href="../fr487028/index.html">Notre exemple: comment recycler l'√©lectronique. Reportage photo</a></li>
<li><a href="../fr487032/index.html">Chercheur le laisse trouver</a></li>
<li><a href="../fr487040/index.html">Firefox Preview Nightly pour Android prend en charge uBlock Origin</a></li>
<li><a href="../fr487042/index.html">Le Ryzen Threadripper 3990X √† 64 c≈ìurs a battu tous les processeurs Intel lors des tests, dont 20 000 $ Xeon</a></li>
<li><a href="../fr487044/index.html">Intimit√©? Non pas entendu</a></li>
<li><a href="../fr487046/index.html">Comment cr√©er une biblioth√®que native pour Android</a></li>
<li><a href="../fr487052/index.html">Kaboom: un sapeur insolite</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>