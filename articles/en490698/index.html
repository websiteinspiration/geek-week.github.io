<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧙🏿 🤚🏻 👩🏻‍🤝‍👨🏾 Features of the assembly and delivery of iOS applications 🎚️ 👩‍❤️‍💋‍👨 👌🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article, Maxim Shestakov, DevOps Engineer at Plarium Krasnodar studio, shares his experience in building and delivering iOS applications to us...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Features of the assembly and delivery of iOS applications</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/plarium/blog/490698/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In this article, Maxim Shestakov, DevOps Engineer at Plarium Krasnodar studio, shares his experience in building and delivering iOS applications to users that accumulated during CI / CD debugging.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ls/eq/j8/lseqj8pl9g9h1yrdm-h-ekpzuno.jpeg"><a name="habracut"></a><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Training</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Everyone connected with developing applications for Apple devices has already managed to appreciate the controversial usability of the infrastructure. </font><font style="vertical-align: inherit;">Difficulties are everywhere: from the developer profile menu to the debugging and assembly tools. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There are plenty of articles on the basics on the net, so we’ll try to highlight the main thing. </font><font style="vertical-align: inherit;">Here is what you need to successfully build the application:</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Developer account</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">macOS-based device acting as a build server;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the generated </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">developer certificate</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , which will then be used to sign the application;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">created application with a unique </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ID</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (the importance of the Bundle Identifier should be noted, because the use of wildcard ID makes it impossible to use many functions of the application, for example: Associated Domains, Push Notifications, Apple Sign In and others);</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">application signature </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;">profile</font></a><font style="vertical-align: inherit;"> .</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The developer certificate should be generated through Keychain on any macOS device. </font><font style="vertical-align: inherit;">The type of certificate is very important. </font><font style="vertical-align: inherit;">Depending on the application environment (Dev, QA, Staging, Production), it will differ (Development or Distribution), as well as the type of application signature profile. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The main types of profiles:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Development - designed to sign the application of the development team, using the Development-certificate (name of the form iPhone Developer: XXXXX);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ad Hoc - intended for signing a test application and internal verification by the QA department, using the Distribution certificate of the developer (name of the iPhone Distribution type: XXXXX);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">App Store - release build for external testing through TestFlight and uploading to the App Store, using the Distribution certificate of the developer.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When generating Development and Ad Hoc profiles, a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">list of devices</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> on which you can install the build is </font><font style="vertical-align: inherit;">also indicated </font><font style="vertical-align: inherit;">, which allows you to further restrict access for users. </font><font style="vertical-align: inherit;">The App Store profile does not have a list of devices, since TestFlight is responsible for access control during closed beta testing, which will be discussed later. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For clarity, you can present the developer profile in the form of a tablet below. </font><font style="vertical-align: inherit;">It’s easier to understand what parameters for the assembly we need and where to get them.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/qd/dt/u9/qddtu9hfklorm9kmotcctpr-hoc.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Assembly</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To make it easier to separate assemblies by project and environment, we use the names of the view profiles </font></font><code>${ProjectName}_${Instance}</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, that is, the project name + instance (depends on the application environment: Dev, QA, GD, Staging, Live, and so on). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When importing to a build server, the profile changes its name to a unique ID and moves to the folder </font></font><code>/Users/$Username/Library/MobileDevice/Provisioning Profiles</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(where it </font></font><code>$Username</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">corresponds to the build server user account name). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There are two ways to build the * .ipa file - obsolete (PackageApplication) and modern (through XcAchive creation and export). </font><font style="vertical-align: inherit;">The first method is considered obsolete, since from version 8.3 the app file packaging module has been removed from the Xcode distribution. </font><font style="vertical-align: inherit;">To use it, you need to copy the module from the old Xcode (version 8.2 and earlier) to the folder: </font></font><br>
<code>/Applications/Xcode.app/Contents/Developer/Platforms/iPhoneOS.platform/Developer/usr/bin/ </code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And then run the command:</font></font><br>
<br>
<pre><code class="bash hljs">chmod +x /Applications/Xcode.app/Contents/Developer/Platforms/iPhoneOS.platform/Developer/usr/bin/*</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Next, you need to collect the * .app-file of the application:</font></font><br>
<br>
<pre><code class="bash hljs">xcodebuild \<font></font>
-workspace <span class="hljs-variable">$ProjectDir</span>/<span class="hljs-variable">$ProjectName</span>.xcworkspace \<font></font>
-scheme <span class="hljs-variable">$SchemeName</span> \<font></font>
-sdk iphoneos \<font></font>
build \<font></font>
-configuration Release \<font></font>
-derivedDataPath build \<font></font>
CODE_SIGN_IDENTITY=”<span class="hljs-variable">$DevAccName</span>”\<font></font>
PROVISIONING_PROFILE=”<span class="hljs-variable">$ProfileId</span>”<font></font>
DEPLOYMENT_POSTPROCESSING=YES \<font></font>
SKIP_INSTALL=YES \<font></font>
ENABLE_BITCODE=NO<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Where: </font></font><br>
<br>
<code>-workspace</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- path to the project file. </font></font><br>
<br>
<code>-scheme</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- used circuit specified in the project. </font></font><br>
<br>
<code>-derivedDataPath</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- the path to unload the assembled application (* .app). </font></font><br>
<br>
<code>CODE_SIGN_IDENTITY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- the name of the developer account that can be verified in Keychain (iPhone Developer: XXXX XXXXXXX, without TeamID in brackets). </font></font><br>
<br>
<img src="https://habrastorage.org/webt/pm/lk/fe/pmlkfeglfyjjkdndrmzvtzr8bsu.jpeg"><br>
<br>
<code>PROVISIONING_PROFILE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- The profile ID for signing the application, which can be obtained with the command:</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-built_in">cd</span> <span class="hljs-string">"/Users/<span class="hljs-variable">$Username</span>/Library/MobileDevice/Provisioning Profiles/"</span> &amp;&amp; find *.mobileprovision -<span class="hljs-built_in">type</span> f | xargs grep -li <span class="hljs-string">"&gt;<span class="hljs-variable">${ProjectName}</span>_<span class="hljs-variable">${Instance}</span>&lt;"</span> | sed -e <span class="hljs-string">'s/.mobileprovision//'</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If the application uses an additional profile (for example, for Push Notifications), then instead </font></font><code>PROVISIONING_PROFILE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">indicate:</font></font><br>
<br>
<pre><code class="bash hljs">APP_PROFILE=”<span class="hljs-variable">$AppProfile</span>” \<font></font>
EXTENSION_PROFILE=”<span class="hljs-variable">$ExtProfile</span>” \</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Next, the resulting * .app file should be packaged in * .ipa. </font><font style="vertical-align: inherit;">To do this, you can use a command of the form:</font></font><br>
<br>
<pre><code class="bash hljs">/usr/bin/xcrun --sdk iphoneos PackageApplication \<font></font>
-v $(find <span class="hljs-string">"<span class="hljs-variable">$ProjectDir</span>/build/Build/Products/Release-iphoneos"</span> -name <span class="hljs-string">"*.app"</span>) \<font></font>
-o <span class="hljs-string">"<span class="hljs-variable">$ProjectDir</span>/<span class="hljs-variable">$ProjectName_</span><span class="hljs-variable">$Instance</span>.ipa"</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
However, this method is considered obsolete from the point of view of Apple. </font><font style="vertical-align: inherit;">It is relevant to obtain * .ipa by exporting from the application archive. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
First you need to collect the archive with the command:</font></font><br>
<br>
<pre><code class="bash hljs">xcodebuild \<font></font>
-workspace <span class="hljs-variable">$ProjectDir</span>/<span class="hljs-variable">$ProjectName</span>.xcworkspace \<font></font>
-scheme <span class="hljs-variable">$SchemeName</span> \<font></font>
-sdk iphoneos \<font></font>
-configuration Release \<font></font>
archive \<font></font>
-archivePath <span class="hljs-variable">$ProjectDir</span>/build/<span class="hljs-variable">$ProjectName</span>.xcarchive \<font></font>
CODE_SIGN_IDENTITY=”<span class="hljs-variable">$DevAccName</span>” \<font></font>
PROVISIONING_PROFILE=”<span class="hljs-variable">$ProfileId</span>”<font></font>
ENABLE_BITCODE=NO \<font></font>
SYNCHRONOUS_SYMBOL_PROCESSING=FALSE</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The differences are in the assembly method and the option </font></font><code>SYNCHRONOUS_SYMBOL_PROCESSING</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">that disables the unloading of characters during assembly. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Next, we need to generate a file with export settings:</font></font><br>
<br>
<pre><code class="bash hljs">ExportSettings=<span class="hljs-string">"<span class="hljs-variable">$ProjectDir</span>/exportOptions.plist"</span><font></font>
<font></font>
cat &lt;&lt; EOF &gt; <span class="hljs-variable">$ExportSettings</span>
&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"UTF-8"</span>?&gt;<font></font>
&lt;!DOCTYPE plist PUBLIC <span class="hljs-string">"-//Apple//DTD PLIST 1.0//EN"</span> <span class="hljs-string">"http://www.apple.com/DTDs/PropertyList-1.0.dtd"</span>&gt;<font></font>
&lt;plist version=<span class="hljs-string">"1.0"</span>&gt;<font></font>
&lt;dict&gt;<font></font>
&lt;key&gt;compileBitcode&lt;/key&gt;<font></font>
&lt;<span class="hljs-literal">false</span>/&gt;<font></font>
&lt;key&gt;uploadBitcode&lt;/key&gt;<font></font>
&lt;<span class="hljs-literal">false</span>/&gt;<font></font>
&lt;key&gt;uploadSymbols&lt;/key&gt;<font></font>
&lt;<span class="hljs-literal">false</span>/&gt;<font></font>
&lt;key&gt;method&lt;/key&gt;<font></font>
&lt;string&gt;<span class="hljs-variable">$Method</span>&lt;/string&gt;<font></font>
&lt;key&gt;provisioningProfiles&lt;/key&gt;<font></font>
&lt;dict&gt;<font></font>
&lt;key&gt;<span class="hljs-variable">$BundleID</span>&lt;/key&gt;<font></font>
&lt;string&gt;<span class="hljs-variable">$ProfileId</span>&lt;/string&gt;<font></font>
&lt;/dict&gt;<font></font>
&lt;key&gt;signingCertificate&lt;/key&gt;<font></font>
&lt;string&gt;<span class="hljs-variable">$DevAccName</span>&lt;/string&gt;<font></font>
&lt;key&gt;signingStyle&lt;/key&gt;<font></font>
&lt;string&gt;manual&lt;/string&gt;<font></font>
&lt;key&gt;stripSwiftSymbols&lt;/key&gt;<font></font>
&lt;<span class="hljs-literal">true</span>/&gt;<font></font>
&lt;key&gt;teamID&lt;/key&gt;<font></font>
&lt;string&gt;<span class="hljs-variable">$TeamID</span>&lt;/string&gt;<font></font>
&lt;key&gt;thinning&lt;/key&gt;<font></font>
&lt;string&gt;&lt;none&gt;&lt;/string&gt;<font></font>
&lt;/dict&gt;<font></font>
&lt;/plist&gt;<font></font>
EOF<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Where: </font></font><br>
<br>
<code>$Method</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- the delivery method corresponds to the type of application signature profile, that is, for Development the value will be development, for Ad Hoc - ad-hoc, and for the App Store - app-store. </font></font><br>
<br>
<code>$BundleID</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- The application ID that is specified in the application settings. </font><font style="vertical-align: inherit;">You can check with the command:</font></font><br>
<br>
<pre><code class="bash hljs">defaults <span class="hljs-built_in">read</span> <span class="hljs-variable">$ProjectDir</span>/Info CFBundleIdentifier</code></pre><br>
<code>$DevAccName  $ProfileId</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- settings for the developer name and signature profile ID that were used earlier and must match the values ​​in the export settings. </font></font><br>
<br>
<code>$TeamID</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- ten-digit ID in brackets after the name of the developer, example: iPhone Developer: ....... (XXXXXXXXXX); </font><font style="vertical-align: inherit;">can check in Keychain. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Next, using the export command, we get the necessary * .ipa file:</font></font><br>
<br>
<pre><code class="bash hljs">xcodebuild \<font></font>
-exportArchive \<font></font>
-archivePath <span class="hljs-variable">$ProjectDir</span>/build/<span class="hljs-variable">$ProjectName</span>.xcarchive \<font></font>
-exportPath <span class="hljs-variable">$ProjectDir</span> \<font></font>
-exportOptionsPlist <span class="hljs-variable">$ExportSettings</span></code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Delivery</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now the assembled file must be delivered to the end user, that is, installed on the device. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For the distribution of Development and Ad Hoc builds, there are many services like HockeyApp, AppBlade and others, but in this article we will talk about a stand-alone server for distributing applications. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Installing the application for iOS takes place in 2 stages:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Obtaining the application installation manifest through the Items Service.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Installing the * .ipa file according to the information specified in the manifest via HTTPS.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Thus, for starters, we need to generate the installation manifest (file type * .plist) with the command:</font></font><br>
<br>
<pre><code class="bash hljs">cat &lt;&lt; EOF &gt; <span class="hljs-variable">$manifest</span>
&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"UTF-8"</span>?&gt;<font></font>
&lt;!DOCTYPE plist PUBLIC <span class="hljs-string">"-//Apple//DTD PLIST 1.0//EN"</span> <span class="hljs-string">"http://www.apple.com/DTDs/PropertyList-1.0.dtd"</span>&gt;<font></font>
&lt;plist version=<span class="hljs-string">"1.0"</span>&gt;<font></font>
&lt;dict&gt;<font></font>
&lt;key&gt;items&lt;/key&gt;<font></font>
&lt;array&gt;<font></font>
&lt;dict&gt;<font></font>
&lt;key&gt;assets&lt;/key&gt;<font></font>
&lt;array&gt;<font></font>
&lt;dict&gt;<font></font>
&lt;key&gt;kind&lt;/key&gt;<font></font>
&lt;string&gt;software-package&lt;/string&gt;<font></font>
&lt;key&gt;url&lt;/key&gt;<font></font>
&lt;string&gt;<span class="hljs-variable">$ipaUrl</span>&lt;/string&gt;<font></font>
&lt;/dict&gt;<font></font>
&lt;/array&gt;<font></font>
&lt;key&gt;metadata&lt;/key&gt;<font></font>
&lt;dict&gt;<font></font>
&lt;key&gt;bundle-identifier&lt;/key&gt;<font></font>
&lt;string&gt;<span class="hljs-variable">$BundleID</span>&lt;/string&gt;<font></font>
&lt;key&gt;bundle-version&lt;/key&gt;<font></font>
&lt;string&gt;<span class="hljs-variable">$AppVersion</span>&lt;/string&gt;<font></font>
&lt;key&gt;kind&lt;/key&gt;<font></font>
&lt;string&gt;software&lt;/string&gt;<font></font>
&lt;key&gt;title&lt;/key&gt;<font></font>
&lt;string&gt;<span class="hljs-variable">$ProjectName_</span><span class="hljs-variable">$Instance</span>&lt;/string&gt;<font></font>
&lt;key&gt;subtitle&lt;/key&gt;<font></font>
&lt;string&gt;<span class="hljs-variable">$Instance</span>&lt;/string&gt;<font></font>
&lt;/dict&gt;<font></font>
&lt;/dict&gt;<font></font>
&lt;/array&gt;<font></font>
&lt;/dict&gt;<font></font>
&lt;/plist&gt;<font></font>
EOF</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As you can see, the manifest contains almost all the parameters involved in the assembly of the application. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Application version ( </font></font><code>$AppVersion</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) can be checked with the command:</font></font><br>
<br>
<pre><code class="bash hljs">defaults <span class="hljs-built_in">read</span> <span class="hljs-variable">$ProjectDir</span>/Info CFBundleVersion</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The parameter </font></font><code>$ipaUrl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">contains a direct link to download the * .ipa file. </font><font style="vertical-align: inherit;">From the seventh version of iOS, the application must be installed via HTTPS. </font><font style="vertical-align: inherit;">In the eighth version, the manifest format has changed slightly: blocks with settings for application icons of the form have been removed</font></font><br>
<br>
<pre><code class="bash hljs">&lt;images&gt;<font></font>
   &lt;image&gt;...&lt;/image&gt;<font></font>
&lt;/images&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Thus, to install the application, a simple html page with a link of the form is enough:</font></font><br>
<br>
<pre><code class="bash hljs">itms-services://?action=download-manifest&amp;url=https://<span class="hljs-variable">$ServerUrl</span>/<span class="hljs-variable">$ProjectName</span>/<span class="hljs-variable">$Instance</span>/iOS/<span class="hljs-variable">$AppVersion</span>/manifest.plist</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For the needs of development and testing departments, Plarium has created its build installation application, which gives us:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">autonomy and independence,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">centralized access control and secure installation of applications through "temporary", dynamically created links,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">extensible functionality (that is, the development team, if necessary, can integrate the missing functions into an existing application).</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Testing</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now we will talk about pre-release application testing using </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TestFlight</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Prerequisites for downloading are the App Store signature profile type and the presence of generated API keys. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There are several ways to download the application:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">via Xcode (Organizer),</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">through altool,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">via Application Loader for older versions of Xcode (now Transporter).</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For automatic loading, altool is used, which also has two authorization methods:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">App-Specific Password,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API Key</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It is preferable to download the application using the API Key. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To get the API Key, follow the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">link</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and generate the key. </font><font style="vertical-align: inherit;">In addition to the key itself in * .p8 format, we will need two parameters: IssuerID and KeyID. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/7j/el/tr/7jeltrm88wb-m74uokirbdw59xs.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Next, we import the downloaded key to the build server:</font></font><br>
<br>
<pre><code class="bash hljs">mkdir -p ~/.appstoreconnect/private_keys<font></font>
mv ~/Downloads/AuthKey_<span class="hljs-variable">${KeyID}</span>.p8 ~/.appstoreconnect/private_keys/</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Before loading the application into TestFlight, you need to validate the application, do this with the command:</font></font><br>
<br>
<pre><code class="bash hljs">xcrun altool \<font></font>
--validate-app \<font></font>
-t ios \<font></font>
-f $(find <span class="hljs-string">"<span class="hljs-variable">$ProjectDir</span>"</span> -name <span class="hljs-string">"*.ipa"</span>) \<font></font>
--apiKey “<span class="hljs-variable">$KeyID</span>” \<font></font>
--apiIssuer “<span class="hljs-variable">$IssuerID</span>” </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Where </font></font><code>apiKey</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font><code>apiIssuer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">have field values ​​from the API key generation page. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Then, upon successful validation, we load the application with a command </font></font><code>--upload-app</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">with the same parameters. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The application will be tested by Apple within one to two days and after that it will be available to external testers: they will be sent e-mail links for installation. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Another way to download the application through altool is to use the App-Specific Password. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To get the App-Specific Password you need to follow the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">link</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and generate it in the Security section. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/k6/3k/lk/k63klknhpg0dtwoukakdzmn02om.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Next, create a build server record in Keychain with this password. </font><font style="vertical-align: inherit;">From version 11 of Xcode, this can be done with the command:</font></font><br>
<br>
<pre><code class="bash hljs">xcrun altool --store-password-in-keychain-item <span class="hljs-string">"Altool"</span> -u <span class="hljs-string">"<span class="hljs-variable">$DeveloperName</span>"</span> -p <span class="hljs-variable">$AppPswd</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Where: </font></font><br>
<br>
<code>$DeveloperName</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">is the name of the iOS developer account used to login to Apple services. </font></font><br>
<br>
<code>$AppPswd</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- generated App-Specific Password. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Next, we get the value of the asc-provider parameter and verify the success of importing the password with the command:</font></font><br>
<br>
<pre><code class="bash hljs">xcrun altool --list-providers -u <span class="hljs-string">"<span class="hljs-variable">$DeveloperName</span>"</span> -p <span class="hljs-string">"@keychain:Altool"</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We get the conclusion:</font></font><br>
<br>
<pre><code class="bash hljs">Provider listing:<font></font>
- Long Name - - Short Name -<font></font>
XXXXXXX        XXXXXXXXX</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As you can see, the desired Short Name (asc-provider) value matches the $ TeamID parameter that we used when building the application. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To validate and load the application in TestFlight, use the command:</font></font><br>
<br>
<pre><code class="bash hljs">xcrun altool \<font></font>
--(validate|upload)-app \  <font></font>
-f $(find <span class="hljs-string">"<span class="hljs-variable">$ProjectDir</span>"</span> -name <span class="hljs-string">"*.ipa"</span>) \<font></font>
-u <span class="hljs-string">"<span class="hljs-variable">$DeveloperName</span>"</span> \<font></font>
-p <span class="hljs-string">"@keychain:Altool"</span> \</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As a parameter value, </font></font><code>-p</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">you can take the value </font></font><code>$AppPswd</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in unencrypted (explicit) form. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
However, as already mentioned, from the point of view of operability, it is better to select the API Key for authorization altool, as various problems are encountered in different versions of Xcode (it doesn’t see Keychain, authorization errors during unloading, etc.). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
That, in fact, is all. </font><font style="vertical-align: inherit;">I wish all involved in successful builds and trouble-free releases on the App Store.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en490684/index.html">Cable selection for structured cabling</a></li>
<li><a href="../en490686/index.html">News from the world of OpenStreetMap No. 500 (11.02.2020-17.02.2020)</a></li>
<li><a href="../en490690/index.html">We create the WEB address directory of PHP + LDAP</a></li>
<li><a href="../en490694/index.html">Top comments in source code</a></li>
<li><a href="../en490696/index.html">How Mail for Business Works - Online Stores and Major Senders</a></li>
<li><a href="../en490700/index.html">Natural Language Processing Course</a></li>
<li><a href="../en490704/index.html">Japanese and California Kano models</a></li>
<li><a href="../en490708/index.html">Finnish airlines Finnair: how the crew trains and a little about the insides of the kitchen</a></li>
<li><a href="../en490714/index.html">How to get 100 thousand per code. Complete Beginner's Guide</a></li>
<li><a href="../en490716/index.html">How to ensure high-quality operation of the local network of a small enterprise?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>