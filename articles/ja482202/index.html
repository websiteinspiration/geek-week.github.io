<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🎮 🕉️ 🌸 チェック・ポイント機器の暗号をGOST 2012に更新する方法 😨 🧑🏾‍🤝‍🧑🏾 ➰</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ロシア連邦保安局の要件に従い、2018年12月31日以降に電子署名を生成するためのGOST R 34.10-2001署名方式の使用は許可されていません。ただし、新しいアルゴリズムをサポートする暗号化CryptoProを備えたチェックポイントに対応するパッチは2018年にリリースされませんでした。レギ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>チェック・ポイント機器の暗号をGOST 2012に更新する方法</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/gaz-is/blog/482202/"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ロシア連邦保安局の要件に従い、2018年12月31日以降に電子署名を生成するためのGOST R 34.10-2001署名方式の使用は許可されていません。ただし、新しいアルゴリズムをサポートする暗号化CryptoProを備えたチェックポイントに対応するパッチは2018年にリリースされませんでした。レギュレータの要件を満たし、安全な通信チャネルなしで突然放置されないようにするために、GOST暗号化をサポートするCheck Point機器を使用する多くの企業は、新しいパッチを待たずに、GOST R 34.10 / 11-2001アルゴリズムに従ってゲートウェイの証明書を発行しました。</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このパブリケーションでは、Check Pointファイアウォール（ME）がバージョンR77.30にすでに更新されており、Check Point SPLAT / GAiA用のCryptoPro CSP 3.9配布キットがインストールされている状況について説明します。この場合、GOST R 34.10 / 11-2012アルゴリズムを使用してリリースされたノードの証明書を保存できます。これにより、Check Point ME（分散型/スタンドアロンフルHAデプロイメント）のクラスターインストールを使用すると、通信を中断することなく機器の暗号を更新できます。実際には、地理的に離れた多くのサイトが中央クラスターを使用してVPNトンネルを構築するときに、状況が発生することがよくあります。したがって、一度に多数のサイトを更新しないようにするために、新しいパッチでは、機器でGOST R 34.10 / 11-2001アルゴリズムと新しいGOST R 34.10 / 11-2012アルゴリズムの両方を使用できます。</font></font><br>
<a name="habracut"></a><br>
<b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">新しい暗号に切り替える</font><b><font style="vertical-align: inherit;">ベンダー推奨の</font></b><font style="vertical-align: inherit;">方法は次のとおりです。</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SMSサーバーデータベースの移行（エクスポート）。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SMSサーバーの新規インストール。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CryptoPro CSP 4.0のインストール。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更新されたSMSサーバーへのデータベースの移行（インポート）。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SMSで管理されるフレッシュインストールGW。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">すべてのGWにCryptoPro CSP 4.0をインストールします。</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この方法では、GOST R 34.10 / 11-2001に従って発行されたゲートウェイ証明書を保存することはできません。さらに、より多くの時間が必要です。</font><font style="vertical-align: inherit;">多数の機器で作成し</font><b><font style="vertical-align: inherit;">た代替の更新スキーム</font></b><font style="vertical-align: inherit;">を</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
検討</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">し</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。その実装のために、小さなスタンドが組み立てられました：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/f9/u1/nd/f9u1nd1kye4mmr2ytht0zjtfxua.jpeg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SMS-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">チェックポイント</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ゲートウェイ</font><font style="vertical-align: inherit;">管理サーバー（プライマリ管理サーバー）</font><font style="vertical-align: inherit;">制御ゲートウェイ：FW1-Node-1、FW1-Node-2 </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GW1-2-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">チェックポイントゲートウェイ（セキュリティゲートウェイ）、</font><b><font style="vertical-align: inherit;">GW</font></b><font style="vertical-align: inherit;">クラスターのメンバークラスター、クラスター操作モード：ClusterXL高可用性</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SMS-GW</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -Check Pointゲートウェイサーバー（プライマリ管理サーバー）、Check Pointゲートウェイ（セキュリティゲートウェイ）、スタンドアロン展開</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HOST1-2</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-ゲートウェイ間のトラフィックフローのチェックに使用されるマシン</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ホームステーションのリソースが限られているため、スタンドアロンフルHA展開の更新オプションはこのスタンドには表示されませんが、スタンドアロンデプロイメントの更新と同じですが、セカンダリスタンドアロンに対してアクションのシーケンスを繰り返す必要があるという点のみが異なります。ゲートウェイ。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
更新スキームは2つのステップで構成されています。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スタンドアロンゲートウェイの暗号化更新。 </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SMSおよびGWクラスターの更新。 </font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらのステップをより詳細に検討してみましょう。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.スタンドアロンゲートウェイ（SMS + GW）で暗号を更新します。</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
証明書が現在インストールされていることを確認します（暗号化の更新後も証明書が同じままであることを確認するには）：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/p7/ov/fy/p7ovfyrotsho8zpgci_el4o364i.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1.最初に行うことは、CryptoPro 3.9を削除することです。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
削除するコマンド（コマンドシェル/ bin / bash（エキスパート）で実行）：</font></font><br>
<br>
<pre><code class="plaintext hljs">/opt/CPUninstall/R77.30_GOST/UnixUninstallScript</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その後、次の警告が表示されます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/od/sa/-4/odsa-4emgigpyem2dtwuex7m0ka.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
スクリプトが機能し終わったら、ゲートウェイを再起動する必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
再起動後、次のコマンドを実行して、残っている可能性があるライブラリを削除する必要があります。</font></font><br>
<br>
<pre><code class="plaintext hljs">/opt/CPUninstall/GOST/gost_cpro_uninstall.sh</code></pre><br>
<img src="https://habrastorage.org/webt/pn/lm/n8/pnlmn85ge11y3uushxwmrr3-zyu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに、CryptoPro 3.9インストールファイルがゲートウェイに残っている場合は、ディレクトリの名前を/ var / gost_installから/ var / gost_install_39に変更するか、その内容を削除する必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2.次に、新しいGOSTパッチをインストールするために必要なファイルを/ var / gost_installディレクトリにコピーする必要があります。</font><font style="vertical-align: inherit;">パス/ var / gost_installに沿って暗号ライブラリ（rpmおよびkisディレクトリを含む）を含むアーカイブをコピーして解凍し、パス/ var / gost_install / hfに沿ってパッチをコピーして解凍することをお勧めします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3. Crypto PRO 4.0のインストールを開始します。</font></font><br>
<br>
<pre><code class="plaintext hljs">/var/gost_install/hf/UnixInstallScript</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
スクリプトの実行が終了すると、次のメッセージが表示されます。その後、ゲートウェイを再起動する必要があります</font></font><br>
<br>
<img src="https://habrastorage.org/webt/il/-v/cu/il-vcu-ikehooeuy4gpxy2fkjt0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
。4.次に、CryptoProライセンスをインストールする必要があります。</font></font><br>
<br>
<pre><code class="plaintext hljs">/opt/cprocsp/sbin/ia32/cpconfig -license –set &lt;license_key&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、CryptoProをインストールするための配布パッケージの一部であるコンソールを使用して接続し、ポリシーをインストールする必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
再起動直後、GOST R 34.10 / 11-2001に従って発行された証明書に基づいてトンネルが構築されます。</font><font style="vertical-align: inherit;">これを行うには、インストールされている証明書を確認し、IKE SAとIPsec SAをリセットし（vpn tuコマンドによって呼び出されるTunnelUtilユーティリティを使用）、トンネルが再構築されていることを確認し</font></font><br>
<br>
<img src="https://habrastorage.org/webt/tx/dq/yu/txdqyuovgoexhpqrsmvsa5ytaa0.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/tk/2n/ax/tk2naxrdyjpjtcb04-m97nf28ws.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/eh/ze/ie/ehzeiex9t1qlrqeb6eqxezetdli.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ます</font><font style="vertical-align: inherit;">：</font><font style="vertical-align: inherit;">ご覧のとおり、トンネルが再構築され、SmartView Trackerでどのような種類のレコードが表示されるかを確認します：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/lu/wf/q-/luwfq-u0lri3ta9z4hrpcunhzyc.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ご覧のとおり、データの暗号化方法は、ゲートウェイでのCryptoProの更新前と同じです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
5.次に、更新されたノードでGOST 2012アルゴリズムを使用するには、CryptoPro 4.0をインストールするための配布パッケージのREADME_GOST_2012_SIG_USAGE.txtに含まれているコマンドを実行する必要があります。</font></font><br>
<br>
<pre><code class="plaintext hljs">ckp_regedit -a SOFTWARE\\CheckPoint\\VPN1 USE_2012_GOST_ALGS 1<font></font>
ckp_regedit -a SOFTWARE\\CheckPoint\\VPN1 GOST_USE_PSK 1</code></pre><br>
<img src="https://habrastorage.org/webt/qb/_a/l3/qb_al3pjsfg8hwc2s1tzhkwnwou.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
6.同じReadMeには、次のものがあります。</font></font><br>
<br>
<pre><code class="plaintext hljs">Though site key was needed only for clusters in previous GOST versions now you should also use site key for non-clustered GWs</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
つまり、新しいバージョンのパッチでは、スタンドアロンゲートウェイにもSiteKeyのインストール（および後で更新）が必要です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
サイトキーを生成するには、次のコマンドを実行します</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
。/opt/cprocsp/bin/ia32/cp-genpsk.sh &lt;Cluster_Name&gt; Net 6：</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SiteKeyはパート0とパート1の組み合わせです：</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
HM25MEKFK9HTLPU0V0THZPPEXBXZ </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SmartView Trackerにインストールすると、次のエントリが表示されます：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/04/-w/2q/04-w2qjqnwvozb1qzo8v9atne2c.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
7その後、GOST 2012証明書を発行するだけで残ります（以前に新しいGOSTに従ってCAのルート証明書がインストールされています）、手順は以前のGOSTに対して証明書が発行される方法と同じなので、ここでは考慮しません。</font><font style="vertical-align: inherit;">両方の証明書がホストにインストールされていることを確認します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/5z/ra/gj/5zragjc3abpvquv8puub2xloui4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この時点で、ゲートウェイスタンドアロンのアップグレードは完了です。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. SMSおよびGWクラスターの更新</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SMSおよびクラスターノードで暗号を更新する手順は、段落1に示した手順と同じなので、ここでは更新結果のみを示します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
シーケンス：</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CryptoPro 3.9の削除。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">古いインストールファイルを削除し、GW1-2ゲートウェイとSMSインストールファイルCryptoPro 4.0にコピーします。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CryptoPro 4.0のインストール。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CryptoProライセンスのインストール。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アルゴリズム2012 GOSTの組み込み。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SiteKeyの生成とインストール。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">新しいアルゴリズムに従って発行された証明書の発行とインストール。</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
スクリーンショットでは、クラスターのゲートウェイの1つに2つの証明書がインストールされていることがわかります</font></font><br>
<br>
<img src="https://habrastorage.org/webt/sn/8u/gi/sn8ugiebx5xft6zrag4tjreaena.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
。GOSTR 34.10 / 11-2001およびGOST R 34.10 / 11-2012に従って発行された証明書がゲートウェイにインストールされているため、マッチングはインストールされません。リモートゲートウェイまたはGOST R 34.10 / 11-2001に従って発行された証明書の基準は削除されません-トンネルは古い証明書に基づいて構築されます。したがって、まだ有効な古い証明書を削除しないようにするために、一致基準を設定します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/md/ca/m1/mdcam1ipfhycjc2fetpwro3zjgy.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その後、SmartView Trackerで、新しい証明書を使用してトンネルが構築されていることがわかります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/zc/u3/6f/zcu36fdkzjci1zfbdzmoltn7tuc.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これにより、暗号化の更新は完了したと見なされます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
提案された方法により、ファイアウォールで暗号を更新するプロセスを最適化し、通信を中断することなく実装することができます。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Artem Chernyshev、</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Gazinformserviceシニアエンジニア</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja482190/index.html">中国のソーシャルネットワークでデュレックスのコンテンツはどのように見えますか</a></li>
<li><a href="../ja482194/index.html">Nornirによるネットワークデバイス構成要素の自動生成と入力</a></li>
<li><a href="../ja482196/index.html">生産モデリングとは何ですか、なぜそれが必要なのですか？</a></li>
<li><a href="../ja482198/index.html">クラスターのオートスケーラーを作成する方法</a></li>
<li><a href="../ja482200/index.html">サイバーセキュリティのブロックチェーン：期待と現実</a></li>
<li><a href="../ja482206/index.html">航空機用部品の3D生産をより経済的にする方法</a></li>
<li><a href="../ja482208/index.html">新年を逃すギフト</a></li>
<li><a href="../ja482210/index.html">テトリスおよびリバースエンジニアリングアニメーション用のボット。第2回プログラミングチャンピオンシップのモバイルトラックの分析</a></li>
<li><a href="../ja482212/index.html">...チーズについて話しますか？</a></li>
<li><a href="../ja482216/index.html">専門の精神科医マキシムマリヤビン（dpmmax）からうつ病への23の応答</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>