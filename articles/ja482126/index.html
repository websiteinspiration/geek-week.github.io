<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>âœ‰ï¸ ğŸ” ğŸ¥‘ TensorFlowã®Kerasãƒ¬ãƒ“ãƒ¥ãƒ¼ ğŸ¦ƒ ğŸ§ ğŸ‘©ğŸ»â€ğŸ¤â€ğŸ‘¨ğŸ½</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Tensorflow.orgã®æ¦‚è¦ã‚¬ã‚¤ãƒ‰ã®ç¿»è¨³ã€‚ã“ã®ã‚¬ã‚¤ãƒ‰ã§ã¯ã€Kerasã‚’ä½¿ã„å§‹ã‚ã‚‹ãŸã‚ã®åŸºæœ¬ã‚’èª¬æ˜ã—ã¾ã™ã€‚èª­æ›¸ã«ã¯10åˆ†ã‹ã‹ã‚Šã¾ã™ã€‚
 
 tf.kerasã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹
 tf.kerasKeras APIä»•æ§˜ã®TensorFlowå®Ÿè£…ã§ã™ã€‚ã“ã‚Œã¯ã€ç†±å¿ƒãªå®Ÿè¡Œã€ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³tf.dataã€æ¨...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>TensorFlowã®Kerasãƒ¬ãƒ“ãƒ¥ãƒ¼</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/482126/"><img src="https://habrastorage.org/webt/wz/o5/gm/wzo5gmjyybfdr1ea_lwtrhsjzvw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tensorflow.orgã®æ¦‚è¦ã‚¬ã‚¤ãƒ‰ã®ç¿»è¨³ã€‚</font><font style="vertical-align: inherit;">ã“ã®ã‚¬ã‚¤ãƒ‰ã§ã¯ã€Kerasã‚’ä½¿ã„å§‹ã‚ã‚‹ãŸã‚ã®åŸºæœ¬ã‚’èª¬æ˜ã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">èª­æ›¸ã«ã¯10åˆ†ã‹ã‹ã‚Šã¾ã™ã€‚</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tf.kerasã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹</font></font></h2><br>
<code>tf.keras</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Keras APIä»•æ§˜ã®TensorFlowå®Ÿè£…ã§ã™ã€‚</font><font style="vertical-align: inherit;">ã“ã‚Œã¯ã€</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç†±å¿ƒãªå®Ÿè¡Œ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³</font></font><code>tf.data</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¨å®šå™¨</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãªã©ã®TensorFlowå›ºæœ‰ã®æ©Ÿèƒ½ã«å¯¾ã™ã‚‹ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆã‚¯ãƒ©ã‚¹ã®ã‚µãƒãƒ¼ãƒˆã‚’å«ã‚€ã€ãƒ¢ãƒ‡ãƒ«ã‚’æ§‹ç¯‰ãŠã‚ˆã³ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã™ã‚‹ãŸã‚ã®é«˜ãƒ¬ãƒ™ãƒ«APIã§ã™</font><font style="vertical-align: inherit;">ã€‚</font></font><code>tf.keras</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æŸ”è»Ÿæ€§ã¨ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’çŠ ç‰²ã«ã™ã‚‹ã“ã¨ãªãTensorFlowã‚’ä½¿ã„ã‚„ã™ãã—ã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã¯ã˜ã‚ã«ã€</font></font><code>tf.keras</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TensorFlowã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã®ä¸€éƒ¨ã¨ã—ã¦</font><font style="vertical-align: inherit;">ã‚¤ãƒ³ãƒãƒ¼ãƒˆ</font><font style="vertical-align: inherit;">ã—ã¾ã™ã€‚</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">from</span> __future__ <span class="hljs-keyword">import</span> absolute_import, division, print_function, unicode_literals<font></font>
<font></font>
<span class="hljs-keyword">import</span> tensorflow <span class="hljs-keyword">as</span> tf<font></font>
<font></font>
<span class="hljs-keyword">from</span> tensorflow <span class="hljs-keyword">import</span> keras</code></pre><br>
<code>tf.keras</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Kerasäº’æ›ã®ã‚³ãƒ¼ãƒ‰ã§ã‚ã‚Œã°ã©ã‚Œã§ã‚‚å®Ÿè¡Œã§ãã¾ã™ãŒã€æ¬¡ã®ç‚¹ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒãƒ¼ã‚¸ãƒ§ãƒ³</font></font><code>tf.keras</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ€æ–°TensorFlowã®ãƒªãƒªãƒ¼ã‚¹ã§ã¯ã€æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¨ç•°ãªã‚‹å ´åˆãŒã‚ã‚Š</font></font><code>keras</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¯ã€PyPIã‚¤ãƒ³ãƒ </font><font style="vertical-align: inherit;">ã”è¦§ãã ã•ã„</font></font><code>tf.keras.__version__</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ¢ãƒ‡ãƒ«ã®é‡ã¿ã‚’ä¿å­˜ã™ã‚‹ã¨</font></font><code>tf.keras</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆå½¢å¼ã§</font><font style="vertical-align: inherit;">ä¿å­˜</font><font style="vertical-align: inherit;">ã•ã‚Œã¾ã™ã€‚</font></font><code>save_format='h5'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HDF5ã‚’ä½¿ç”¨ã™ã‚‹</font><font style="vertical-align: inherit;">ãŸã‚ã«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼</font><font style="vertical-align: inherit;">ã‚’</font><font style="vertical-align: inherit;">æ¸¡ã—</font><font style="vertical-align: inherit;">ã¾ã™ï¼ˆã¾ãŸã¯ãƒ•ã‚¡ã‚¤ãƒ«åã«æ‹¡å¼µå­ã‚’è¿½åŠ ã—ã¾ã™</font></font><code>.h5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼‰ã€‚</font></font></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å˜ç´”ãªãƒ¢ãƒ‡ãƒ«ã‚’ä½œæˆã™ã‚‹</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é †æ¬¡ãƒ¢ãƒ‡ãƒ«</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kerasã§ã¯ã€</font><i><font style="vertical-align: inherit;">ãƒ¢ãƒ‡ãƒ«</font></i><font style="vertical-align: inherit;">ã‚’æ§‹ç¯‰</font><font style="vertical-align: inherit;">ã™ã‚‹ãŸã‚ã®</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ¬ã‚¤ãƒ¤ãƒ¼</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚’</font><font style="vertical-align: inherit;">åé›†ã—</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¾ã™</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ãƒ¢ãƒ‡ãƒ«ã¯ï¼ˆé€šå¸¸ã¯ï¼‰å±¤ã‚°ãƒ©ãƒ•ã§ã™ã€‚</font><font style="vertical-align: inherit;">æœ€ã‚‚ä¸€èˆ¬çš„ãªãƒ¢ãƒ‡ãƒ«ã®ã‚¿ã‚¤ãƒ—ã¯ã€ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚¹ã‚¿ãƒƒã‚¯ã®ãƒ¢ãƒ‡ãƒ«</font></font><code>tf.keras.Sequential</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã§ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å˜ç´”ãªå®Œå…¨ã«æ¥ç¶šã•ã‚ŒãŸãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ï¼ˆã¤ã¾ã‚Šã€å¤šå±¤ãƒ‘ãƒ¼ã‚»ãƒ—ãƒˆãƒ­ãƒ³ï¼‰ã‚’æ§‹ç¯‰ã—ã¾ã™ã€‚</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">from</span> tensorflow.keras <span class="hljs-keyword">import</span> layers<font></font>
<font></font>
model = tf.keras.Sequential()<font></font>
<span class="hljs-comment">#       64 :</span>
model.add(layers.Dense(<span class="hljs-number">64</span>, activation=<span class="hljs-string">'relu'</span>))
<span class="hljs-comment">#   :</span>
model.add(layers.Dense(<span class="hljs-number">64</span>, activation=<span class="hljs-string">'relu'</span>))
<span class="hljs-comment">#   softmax  10 :</span>
model.add(layers.Dense(<span class="hljs-number">10</span>, activation=<span class="hljs-string">'softmax'</span>))</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã™ã‚‹</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¤šãã®ç¨®é¡ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒåˆ©ç”¨å¯èƒ½ã§ã™</font></font><code>tf.keras.layers</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ãã‚Œã‚‰ã®ã»ã¨ã‚“ã©ã¯ã€å…±é€šã®å¼•æ•°ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚</font></font><br>
<br>
<ul>
<li><code>activation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ™ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ã‚’è¨­å®šã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã“ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã¯ã€çµ„ã¿è¾¼ã¿é–¢æ•°ã¾ãŸã¯å‘¼ã³å‡ºã•ã‚Œã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®åå‰ã‚’æŒ‡å®šã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</font></font></li>
<li><code>kernel_initializer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãŠã‚ˆã³</font></font><code>bias_initializer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šãƒ¬ã‚¤ãƒ¤ãƒ¼ã®é‡ã¿ã‚’ä½œæˆã™ã‚‹åˆæœŸåŒ–ã‚¹ã‚­ãƒ¼ãƒ ï¼ˆã‚³ã‚¢ã¨ã‚·ãƒ•ãƒˆï¼‰ã€‚</font><font style="vertical-align: inherit;">ã“ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã¯ã€åå‰ã¾ãŸã¯å‘¼ã³å‡ºã•ã‚Œã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚</font><font style="vertical-align: inherit;">ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ã€åˆæœŸåŒ–å­ãŒä½¿ç”¨ã•ã‚Œ</font></font><code>"Glorot uniform"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¾ã™ã€‚</font></font></li>
<li><code>kernel_regularizer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãŠã‚ˆã³</font></font><code>bias_regularizer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šL1ã¾ãŸã¯L2ã®æ­£å‰‡åŒ–ãªã©ã€å±¤ã®é‡ã¿ï¼ˆã‚³ã‚¢ã¨ã›ã‚“æ–­ï¼‰ã«è¿½åŠ ã•ã‚ŒãŸæ­£å‰‡åŒ–ã‚¹ã‚­ãƒ¼ãƒ ã€‚</font><font style="vertical-align: inherit;">ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ã€æ­£å‰‡åŒ–ã¯è¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ¬¡ã® `tf.keras.layers.Dense`ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ä¾‹ã§ã¯ã€ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ãƒ¼å¼•æ•°ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment">#    :</span>
layers.Dense(<span class="hljs-number">64</span>, activation=<span class="hljs-string">'sigmoid'</span>)
<span class="hljs-comment"># :</span>
layers.Dense(<span class="hljs-number">64</span>, activation=tf.keras.activations.sigmoid)<font></font>
<font></font>
<span class="hljs-comment">#     L1   0.01    :</span>
layers.Dense(<span class="hljs-number">64</span>, kernel_regularizer=tf.keras.regularizers.l1(<span class="hljs-number">0.01</span>))<font></font>
<font></font>
<span class="hljs-comment">#     L2   0.01    :</span>
layers.Dense(<span class="hljs-number">64</span>, bias_regularizer=tf.keras.regularizers.l2(<span class="hljs-number">0.01</span>))<font></font>
<font></font>
<span class="hljs-comment">#        :</span>
layers.Dense(<span class="hljs-number">64</span>, kernel_initializer=<span class="hljs-string">'orthogonal'</span>)<font></font>
<font></font>
<span class="hljs-comment">#        2.0:</span>
layers.Dense(<span class="hljs-number">64</span>, bias_initializer=tf.keras.initializers.Constant(<span class="hljs-number">2.0</span>))</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã¨è©•ä¾¡</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°è¨­å®š</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãƒ¢ãƒ‡ãƒ«ãŒæ§‹ç¯‰ã•ã‚ŒãŸã‚‰ã€ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã—ã¦ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã®ãƒ—ãƒ­ã‚»ã‚¹ã‚’æ§‹æˆã—ã¾ã™</font></font><code>compile</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br>
<pre><code class="python hljs">model = tf.keras.Sequential([
<span class="hljs-comment">#     64   :</span>
layers.Dense(<span class="hljs-number">64</span>, activation=<span class="hljs-string">'relu'</span>, input_shape=(<span class="hljs-number">32</span>,)),
<span class="hljs-comment">#  :</span>
layers.Dense(<span class="hljs-number">64</span>, activation=<span class="hljs-string">'relu'</span>),
<span class="hljs-comment">#   softmax  10 :</span>
layers.Dense(<span class="hljs-number">10</span>, activation=<span class="hljs-string">'softmax'</span>)])<font></font>
<font></font>
model.compile(optimizer=tf.keras.optimizers.Adam(<span class="hljs-number">0.01</span>),<font></font>
              loss=<span class="hljs-string">'categorical_crossentropy'</span>,<font></font>
              metrics=[<span class="hljs-string">'accuracy'</span>])</code></pre><br>
<code>tf.keras.Model.compile</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 3ã¤ã®é‡è¦ãªå¼•æ•°ã‚’å–ã‚Šã¾ã™ã€‚</font></font><br>
<br>
<ul>
<li><code>optimizer</code>:     .        <code>tf.keras.optimizers</code>,   <code>tf.keras.optimizers.Adam</code>  <code>tf.keras.optimizers.SGD</code>.        ,       ,   <code>'adam'</code>  <code>'sgd'</code>.</li>
<li><code>loss</code>:       .      (<code>mse</code>), <code>categorical_crossentropy</code>, <code>binary_crossentropy</code>.            <code>tf.keras.losses</code>.</li>
<li><code>metrics</code>:    .         <code>tf.keras.metrics</code>.</li>
<li> ,   ,      eagerly,       <code>run_eagerly=True</code></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ¬¡ã«ã€ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ç”¨ã®ãƒ¢ãƒ‡ãƒ«ã®æ§‹æˆä¾‹ã‚’ã„ãã¤ã‹ç¤ºã—ã¾ã™ã€‚</font></font><br>
 <br>
<pre><code class="python hljs"><span class="hljs-comment">#       .</span>
model.compile(optimizer=tf.keras.optimizers.Adam(<span class="hljs-number">0.01</span>),<font></font>
              loss=<span class="hljs-string">'mse'</span>,       <span class="hljs-comment"># mean squared error</span>
              metrics=[<span class="hljs-string">'mae'</span>])  <span class="hljs-comment"># mean absolute error</span><font></font>
<font></font>
<span class="hljs-comment">#     .</span>
model.compile(optimizer=tf.keras.optimizers.RMSprop(<span class="hljs-number">0.01</span>),<font></font>
              loss=tf.keras.losses.CategoricalCrossentropy(),<font></font>
              metrics=[tf.keras.metrics.CategoricalAccuracy()])</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NumPyãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ã®å­¦ç¿’</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å°ã•ã„ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã®å ´åˆã¯ã€NumPyã®ãƒ¡ãƒ¢ãƒªé…åˆ—ã‚’ä½¿ç”¨ã—ã¦ãƒ¢ãƒ‡ãƒ«ã‚’ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ãŠã‚ˆã³è©•ä¾¡ã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ãƒ¢ãƒ‡ãƒ«ã¯ã€ `fit`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã—ã¦ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ‡ãƒ¼ã‚¿ã§ã€Œãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã€ã•ã‚Œã¾ã™ã€‚</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<font></font>
<font></font>
data = np.random.random((<span class="hljs-number">1000</span>, <span class="hljs-number">32</span>))<font></font>
labels = np.random.random((<span class="hljs-number">1000</span>, <span class="hljs-number">10</span>))<font></font>
<font></font>
model.fit(data, labels, epochs=<span class="hljs-number">10</span>, batch_size=<span class="hljs-number">32</span>)</code></pre><br>
<code>tf.keras.Model.fit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 3ã¤ã®é‡è¦ãªå¼•æ•°ã‚’å–ã‚Šã¾ã™ã€‚</font></font><br>
<br>
<ul>
<li><code>epochs</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šå­¦ç¿’ã¯*æ™‚ä»£*ã«åˆ†ã‘ã‚‰ã‚Œã¾ã™ã€‚</font><font style="vertical-align: inherit;">æ™‚ä»£ã¯ã™ã¹ã¦ã®å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ã®1å›ã®åå¾©ã§ã™ï¼ˆã“ã‚Œã¯å°ã•ãªãƒãƒƒãƒã§è¡Œã‚ã‚Œã¾ã™ï¼‰ã€‚</font></font></li>
<li><code>batch_size</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šNumPyãƒ‡ãƒ¼ã‚¿ã‚’é€ä¿¡ã™ã‚‹å ´åˆã€ãƒ¢ãƒ‡ãƒ«ã¯ãƒ‡ãƒ¼ã‚¿ã‚’å°ã•ãªãƒ–ãƒ­ãƒƒã‚¯ï¼ˆãƒãƒƒãƒï¼‰ã«åˆ†å‰²ã—ã€ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ä¸­ã«ã“ã‚Œã‚‰ã®ãƒ–ãƒ­ãƒƒã‚¯ã‚’åå¾©ã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã“ã®æ•°å€¤ã¯ã€å„ãƒ‡ãƒ¼ã‚¿ãƒ–ãƒ­ãƒƒã‚¯ã®ã‚µã‚¤ã‚ºã‚’ç¤ºã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ãƒ¬ã‚³ãƒ¼ãƒ‰ã®ç·æ•°ãŒãƒãƒƒãƒã‚µã‚¤ã‚ºã§é™¤ç®—ã•ã‚Œãªã„å ´åˆã€æœ€å¾Œã®ãƒ–ãƒ­ãƒƒã‚¯ãŒå°ã•ããªã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚</font></font></li>
<li><code>validation_data</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šãƒ¢ãƒ‡ãƒ«ã®ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ã‚’ä½œæˆã™ã‚‹ã¨ãã€æ¤œè¨¼ãƒ‡ãƒ¼ã‚¿ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’ç°¡å˜ã«è¿½è·¡ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã“ã®å¼•æ•°ã¨ã¨ã‚‚ã«å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ã¨ãƒ©ãƒ™ãƒ«ã®ã‚¿ãƒ—ãƒ«ã‚’æ¸¡ã™ã¨ã€ãƒ¢ãƒ‡ãƒ«ã¯å„æ™‚ä»£ã®çµ‚ã‚ã‚Šã«é€ä¿¡ã•ã‚Œã‚‹ãƒ‡ãƒ¼ã‚¿ã®å‡ºåŠ›ãƒ¢ãƒ¼ãƒ‰ã§æå¤±é–¢æ•°ã¨ãƒ¡ãƒˆãƒªãƒƒã‚¯ã®å€¤ã‚’è¡¨ç¤ºã§ãã¾ã™ã€‚</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ¬¡ã«ä½¿ç”¨ä¾‹ã‚’ç¤ºã—</font></font><code>validation_data</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¾ã™ã€‚</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<font></font>
<font></font>
data = np.random.random((<span class="hljs-number">1000</span>, <span class="hljs-number">32</span>))<font></font>
labels = np.random.random((<span class="hljs-number">1000</span>, <span class="hljs-number">10</span>))<font></font>
<font></font>
val_data = np.random.random((<span class="hljs-number">100</span>, <span class="hljs-number">32</span>))<font></font>
val_labels = np.random.random((<span class="hljs-number">100</span>, <span class="hljs-number">10</span>))<font></font>
<font></font>
model.fit(data, labels, epochs=<span class="hljs-number">10</span>, batch_size=<span class="hljs-number">32</span>,<font></font>
          validation_data=(val_data, val_labels))</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tf.dataãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã‚’ä½¿ç”¨ã—ãŸãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Datasets APIã‚’ä½¿ç”¨ã—ã¦ã€å¤§è¦æ¨¡ãªãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã—ãŸã‚Šã€è¤‡æ•°ã®ãƒ‡ãƒã‚¤ã‚¹ã«ã‚ãŸã£ã¦ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã—ãŸã‚Šã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">`tf.data.Dataset`ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ãƒ¡ã‚½ãƒƒãƒ‰ã«æ¸¡ã—ã¾ã™</font></font><code>fit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment">#    :</span><font></font>
dataset = tf.data.Dataset.from_tensor_slices((data, labels))<font></font>
dataset = dataset.batch(<span class="hljs-number">32</span>)<font></font>
<font></font>
model.fit(dataset, epochs=<span class="hljs-number">10</span>)</code></pre><br><font style="vertical-align: inherit;"></font><code>Dataset</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ‡ãƒ¼ã‚¿ã‚’ãƒãƒƒãƒ</font><font style="vertical-align: inherit;">
ã§</font><font style="vertical-align: inherit;">å‡ºåŠ›ã™ã‚‹</font><font style="vertical-align: inherit;">ãŸã‚</font><font style="vertical-align: inherit;">ã€ã“ã®ã‚³ãƒ¼ãƒ‰ã¯å¼•æ•°ã‚’å¿…è¦ã¨ã—ã¾ã›ã‚“</font></font><code>batch_size</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã¯ã€ä»¥ä¸‹ã®æ¤œè¨¼ã«ã‚‚ä½¿ç”¨ã§ãã¾ã™ã€‚</font></font><br>
<br>
<pre><code class="python hljs">dataset = tf.data.Dataset.from_tensor_slices((data, labels))<font></font>
dataset = dataset.batch(<span class="hljs-number">32</span>)<font></font>
<font></font>
val_dataset = tf.data.Dataset.from_tensor_slices((val_data, val_labels))<font></font>
val_dataset = val_dataset.batch(<span class="hljs-number">32</span>)<font></font>
<font></font>
model.fit(dataset, epochs=<span class="hljs-number">10</span>,<font></font>
          validation_data=val_dataset)</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è©•ä¾¡ã¨äºˆæ¸¬</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãƒ¡ã‚½ãƒƒãƒ‰</font></font><code>tf.keras.Model.evaluate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¨</font></font><code>tf.keras.Model.predict</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NumPy </font><font style="vertical-align: inherit;">ãŠã‚ˆã³</font><font style="vertical-align: inherit;">ã‚’ä½¿ç”¨ã§ãã¾ã™</font></font><code>tf.data.Dataset</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã“ã‚Œã¯</font><font style="vertical-align: inherit;">ã€å‡ºåŠ›ãƒ¢ãƒ¼ãƒ‰ã§</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã®</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æå¤±ã¨æä¾›ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã®ãƒ¡ãƒˆãƒªãƒƒã‚¯ã‚’</font><i><font style="vertical-align: inherit;">è©•ä¾¡ã™ã‚‹</font></i><font style="vertical-align: inherit;">æ–¹æ³•ã§ã™</font><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment">#   Numpy</span>
data = np.random.random((<span class="hljs-number">1000</span>, <span class="hljs-number">32</span>))<font></font>
labels = np.random.random((<span class="hljs-number">1000</span>, <span class="hljs-number">10</span>))<font></font>
<font></font>
model.evaluate(data, labels, batch_size=<span class="hljs-number">32</span>)<font></font>
<font></font>
<span class="hljs-comment">#  </span><font></font>
dataset = tf.data.Dataset.from_tensor_slices((data, labels))<font></font>
dataset = dataset.batch(<span class="hljs-number">32</span>)<font></font>
<font></font>
model.evaluate(dataset)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãã—ã¦ã€ã“ã“</font><font style="vertical-align: inherit;">ã§ã€æä¾›ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã®å‡ºåŠ›ãƒ¢ãƒ¼ãƒ‰ã§æœ€å¾Œã®ãƒ¬ãƒ™ãƒ«ã®å‡ºåŠ›ã‚’NumPyé…åˆ—ã¨ã—ã¦</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">äºˆæ¸¬ã™ã‚‹</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ–¹æ³•ã‚’ç¤ºã—</font><font style="vertical-align: inherit;">ã¾ã™ã€‚</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¤‡é›‘ãªãƒ¢ãƒ‡ãƒ«ã®æ§‹ç¯‰</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ©Ÿèƒ½API</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãƒ¢ãƒ‡ãƒ«</font></font><code>tf.keras.Sequential</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¯ã€ä»»æ„ã®ãƒ¢ãƒ‡ãƒ«ã‚’æƒ³åƒã§ããªã„å˜ç´”ãªãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚¹ã‚¿ãƒƒã‚¯ã§ã™ã€‚</font><font style="vertical-align: inherit;">Kerasæ©Ÿèƒ½APIã‚’ä½¿ç”¨ã—ã¦ã€æ¬¡ã®ã‚ˆã†ãªè¤‡é›‘ãªãƒ¢ãƒ‡ãƒ«ãƒˆãƒãƒ­ã‚¸ã‚’æ§‹ç¯‰ã—ã¾ã™ã€‚</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¤‡æ•°ã®å…¥åŠ›ãƒ¢ãƒ‡ãƒ«</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¤‡æ•°ã®å‡ºåŠ›ã‚’æŒã¤ãƒ¢ãƒ‡ãƒ«ã€</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å…±é€šã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’æŒã¤ãƒ¢ãƒ‡ãƒ«ï¼ˆåŒã˜ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒè¤‡æ•°å›å‘¼ã³å‡ºã•ã‚Œã¾ã™ï¼‰ã€</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸€è²«æ€§ã®ãªã„ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆãƒªãƒ¼ãƒ ï¼ˆæ®‹å·®é–¢ä¿‚ãªã©ï¼‰ã‚’æŒã¤ãƒ¢ãƒ‡ãƒ«ã€‚</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é–¢æ•°å‹APIã‚’ä½¿ç”¨ã—ãŸãƒ¢ãƒ‡ãƒ«ã®æ§‹ç¯‰ã¯ã€æ¬¡ã®ã‚ˆã†ã«æ©Ÿèƒ½ã—ã¾ã™ã€‚</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¯å‘¼ã³å‡ºã—å¯èƒ½ã§ã€ãƒ†ãƒ³ã‚½ãƒ«ã‚’è¿”ã—ã¾ã™ã€‚</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å…¥åŠ›ã¨å‡ºåŠ›ã®ãƒ†ãƒ³ã‚½ãƒ«ã‚’ä½¿ç”¨ã—ã¦ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’æ±ºå®šã—ã¾ã™ã€‚ </font></font><code>tf.keras.Model</code></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã“ã®ãƒ¢ãƒ‡ãƒ«ã¯ã€ã€Œé †æ¬¡ã€ãƒ¢ãƒ‡ãƒ«ã¨åŒã˜ã‚ˆã†ã«ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã•ã‚Œã¾ã™ã€‚</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ¬¡ã®ä¾‹ã§ã¯ã€æ©Ÿèƒ½APIã‚’ä½¿ç”¨ã—ã¦ã€å®Œå…¨ã«æ¥ç¶šã•ã‚ŒãŸã‚·ãƒ³ãƒ—ãƒ«ãªãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’æ§‹ç¯‰ã—ã¦ã„ã¾ã™ã€‚</font></font><br>
<br>
<pre><code class="python hljs">inputs = tf.keras.Input(shape=(<span class="hljs-number">32</span>,))  <span class="hljs-comment">#   </span><font></font>
<font></font>
<span class="hljs-comment">#        .</span>
x = layers.Dense(<span class="hljs-number">64</span>, activation=<span class="hljs-string">'relu'</span>)(inputs)<font></font>
x = layers.Dense(<span class="hljs-number">64</span>, activation=<span class="hljs-string">'relu'</span>)(x)<font></font>
predictions = layers.Dense(<span class="hljs-number">10</span>, activation=<span class="hljs-string">'softmax'</span>)(x)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã“ã‚Œã‚‰ã®å…¥åŠ›ã¨å‡ºåŠ›ã‚’ä½¿ç”¨ã—ã¦ãƒ¢ãƒ‡ãƒ«ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆã—ã¾ã™ã€‚</font></font><br>
<br>
<pre><code class="python hljs">model = tf.keras.Model(inputs=inputs, outputs=predictions)<font></font>
<font></font>
<span class="hljs-comment">#     .</span>
model.compile(optimizer=tf.keras.optimizers.RMSprop(<span class="hljs-number">0.001</span>),<font></font>
              loss=<span class="hljs-string">'categorical_crossentropy'</span>,<font></font>
              metrics=[<span class="hljs-string">'accuracy'</span>])<font></font>
<font></font>
<span class="hljs-comment">#    5 </span>
model.fit(data, labels, batch_size=<span class="hljs-number">32</span>, epochs=<span class="hljs-number">5</span>)</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ¢ãƒ‡ãƒ«ã®ã‚µãƒ–ã‚¯ãƒ©ã‚¹åŒ–</font></font></h3><br><font style="vertical-align: inherit;"></font><code>tf.keras.Model</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç‹¬è‡ªã®ç›´æ¥åˆ†å¸ƒ</font><font style="vertical-align: inherit;">
ã‚’ã‚µãƒ–ã‚¯ãƒ©ã‚¹åŒ–</font><font style="vertical-align: inherit;">ãŠã‚ˆã³å®šç¾©ã—ã¦</font><font style="vertical-align: inherit;">ã€å®Œå…¨ã«ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºå¯èƒ½ãªãƒ¢ãƒ‡ãƒ«ã‚’ä½œæˆã—ã¾ã™</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ãƒ¡ã‚½ãƒƒãƒ‰å†…ã«ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ä½œæˆã—ã€</font></font><code>__init__</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãã‚Œã‚‰ã‚’ã‚¯ãƒ©ã‚¹ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®å±æ€§ã¨ã—ã¦è¨­å®šã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ãƒ¡ã‚½ãƒƒãƒ‰ã§ç›´æ¥åˆ†å¸ƒã‚’å®šç¾©ã—</font></font><code>call</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãƒ¢ãƒ‡ãƒ«ã‚’ã‚µãƒ–ã‚¯ãƒ©ã‚¹åŒ–ã™ã‚‹ã¨ã€æ„æ¬²çš„ãªå®Ÿè¡ŒãŒæœ‰åŠ¹ã«ãªã£ã¦ã„ã‚‹å ´åˆã«ç‰¹ã«å½¹ç«‹ã¡ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ç›´æ¥åˆ†æ•£ã‚’å‘½ä»¤çš„ã«è¨˜è¿°ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã‹ã‚‰ã§ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ³¨ï¼šãƒ¢ãƒ‡ãƒ«ã‚’</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¸¸ã«</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¿…é ˆã«ã™ã‚‹</font></font><code>dynamic=True</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å ´åˆã¯ã€ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ãƒ¼ã‚’å‘¼ã³å‡ºã™ã¨ãã«</font><font style="vertical-align: inherit;">è¨­å®šã§ã</font><font style="vertical-align: inherit;">ã¾ã™</font></font><code>super</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é‡è¦ãªãƒã‚¤ãƒ³ãƒˆï¼šæ­£ã—ã„APIã‚’ä½¿ç”¨ã—ã¦å‹•ä½œã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ãƒ¢ãƒ‡ãƒ«ã‚’ã‚µãƒ–ã‚¯ãƒ©ã‚¹åŒ–ã™ã‚‹ã¨æŸ”è»Ÿæ€§ãŒå¾—ã‚‰ã‚Œã¾ã™ãŒã€è¤‡é›‘ã§ã‚«ã‚¹ã‚¿ãƒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹å¯èƒ½æ€§ãŒé«˜ã„ãŸã‚ã€ãã®ä»£å„Ÿã‚’æ‰•ã†å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</font><font style="vertical-align: inherit;">å¯èƒ½ã§ã‚ã‚Œã°ã€æ©Ÿèƒ½APIã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¬¡ã®ä¾‹ã¯ã€</font></font><code>tf.keras.Model</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚«ã‚¹ã‚¿ãƒ ã®ç›´æ¥é…å¸ƒã‚’ä½¿ç”¨ã—</font><font style="vertical-align: inherit;">ãŸã‚µãƒ–ã‚¯ãƒ©ã‚¹åŒ–ã•ã‚ŒãŸãƒ¢ãƒ‡ãƒ«</font><font style="vertical-align: inherit;">ã‚’</font><font style="vertical-align: inherit;">ç¤ºã—ã¦ã„ã¾ã™ãŒã€</font><font style="vertical-align: inherit;">å¿…é ˆã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyModel</span>(<span class="hljs-params">tf.keras.Model</span>):</span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, num_classes=<span class="hljs-number">10</span></span>):</span>
    super(MyModel, self).__init__(name=<span class="hljs-string">'my_model'</span>)<font></font>
    self.num_classes = num_classes<font></font>
    <span class="hljs-comment">#    .</span>
    self.dense_1 = layers.Dense(<span class="hljs-number">32</span>, activation=<span class="hljs-string">'relu'</span>)<font></font>
    self.dense_2 = layers.Dense(num_classes, activation=<span class="hljs-string">'sigmoid'</span>)<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">call</span>(<span class="hljs-params">self, inputs</span>):</span>
    <span class="hljs-comment">#     ,</span>
    <span class="hljs-comment">#      ( `__init__`).</span><font></font>
    x = self.dense_1(inputs)<font></font>
    <span class="hljs-keyword">return</span> self.dense_2(x)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ–°ã—ã„ãƒ¢ãƒ‡ãƒ«ã‚¯ãƒ©ã‚¹ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆã—ã¾ã™ã€‚</font></font><br>
<br>
<pre><code class="python hljs">model = MyModel(num_classes=<span class="hljs-number">10</span>)<font></font>
<font></font>
<span class="hljs-comment">#     .</span>
model.compile(optimizer=tf.keras.optimizers.RMSprop(<span class="hljs-number">0.001</span>),<font></font>
              loss=<span class="hljs-string">'categorical_crossentropy'</span>,<font></font>
              metrics=[<span class="hljs-string">'accuracy'</span>])<font></font>
<font></font>
<span class="hljs-comment">#   5 .</span>
model.fit(data, labels, batch_size=<span class="hljs-number">32</span>, epochs=<span class="hljs-number">5</span>)</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚«ã‚¹ã‚¿ãƒ ãƒ¬ã‚¤ãƒ¤ãƒ¼</font></font></h3><br><font style="vertical-align: inherit;"></font><code>tf.keras.layers.Layer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¬¡ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’</font><font style="vertical-align: inherit;">
ã‚µãƒ–ã‚¯ãƒ©ã‚¹åŒ–</font><font style="vertical-align: inherit;">ã—ã¦å®Ÿè£…ã™ã‚‹ã“ã¨</font><font style="vertical-align: inherit;">ã«ã‚ˆã‚Šã€ã‚«ã‚¹ã‚¿ãƒ ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ä½œæˆã—ã¾ã™</font><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br>
<ul>
<li><code>__init__</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ã€ã“ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ã§ä½¿ç”¨ã™ã‚‹ã‚µãƒ–ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’æŒ‡å®šã—ã¾ã™ã€‚</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* </font></font><code>build</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šãƒ¬ã‚¤ãƒ¤ãƒ¼ã®é‡ã¿ã‚’ä½œæˆã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã—ã¦é‡ã¿ã‚’è¿½åŠ ã™ã‚‹</font></font><code>add_weight</code></li>
<li><code>call</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šç›´æ¥é…å¸ƒã‚’å®šç¾©ã—ã¾ã™ã€‚</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ã€ãƒ¡ã‚½ãƒƒãƒ‰</font></font><code>get_config</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¨ã‚¯ãƒ©ã‚¹ãƒ¡ã‚½ãƒƒãƒ‰ã‚’</font><font style="vertical-align: inherit;">å®Ÿè£…ã™ã‚‹ã“ã¨ã«ã‚ˆã‚Šã€ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ã‚·ãƒªã‚¢ãƒ«åŒ–ã§ãã¾ã™</font></font><code>from_config</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä»¥ä¸‹ã¯ã€</font></font><code>matmul</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å…¥åŠ›ã«é©ç”¨ã•ã‚ŒãŸ</font><font style="vertical-align: inherit;">è¡Œåˆ—ï¼ˆ</font><font style="vertical-align: inherit;">ï¼‰ã¨ã‚«ãƒ¼ãƒãƒ«è¡Œåˆ—</font><font style="vertical-align: inherit;">ã‚’ä¹—ç®—ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼å±¤ã®ä¾‹ã§ã™</font><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyLayer</span>(<span class="hljs-params">layers.Layer</span>):</span><font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, output_dim, **kwargs</span>):</span><font></font>
    self.output_dim = output_dim<font></font>
    super(MyLayer, self).__init__(**kwargs)<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">build</span>(<span class="hljs-params">self, input_shape</span>):</span>
    <span class="hljs-comment">#       .</span>
    self.kernel = self.add_weight(name=<span class="hljs-string">'kernel'</span>,<font></font>
                                  shape=(input_shape[<span class="hljs-number">1</span>], self.output_dim),<font></font>
                                  initializer=<span class="hljs-string">'uniform'</span>,<font></font>
                                  trainable=<span class="hljs-literal">True</span>)<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">call</span>(<span class="hljs-params">self, inputs</span>):</span>
    <span class="hljs-keyword">return</span> tf.matmul(inputs, self.kernel)<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_config</span>(<span class="hljs-params">self</span>):</span><font></font>
    base_config = super(MyLayer, self).get_config()<font></font>
    base_config[<span class="hljs-string">'output_dim'</span>] = self.output_dim
    <span class="hljs-keyword">return</span> base_config<font></font>
<font></font>
<span class="hljs-meta">  @classmethod</span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">from_config</span>(<span class="hljs-params">cls, config</span>):</span>
    <span class="hljs-keyword">return</span> cls(**config)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã‚«ã‚¹ã‚¿ãƒ ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ä½¿ç”¨ã—ã¦ãƒ¢ãƒ‡ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚</font></font><br>
<br>
<pre><code class="python hljs">model = tf.keras.Sequential([<font></font>
    MyLayer(<span class="hljs-number">10</span>),<font></font>
    layers.Activation(<span class="hljs-string">'softmax'</span>)])<font></font>
<font></font>
<span class="hljs-comment">#     </span>
model.compile(optimizer=tf.keras.optimizers.RMSprop(<span class="hljs-number">0.001</span>),<font></font>
              loss=<span class="hljs-string">'categorical_crossentropy'</span>,<font></font>
              metrics=[<span class="hljs-string">'accuracy'</span>])<font></font>
<font></font>
<span class="hljs-comment">#   5 .</span>
model.fit(data, labels, batch_size=<span class="hljs-number">32</span>, epochs=<span class="hljs-number">5</span>)</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚³ãƒ«ãƒ™ã‚­</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kolbekã¯ã€ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ä¸­ã«ãã®å‹•ä½œã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºãŠã‚ˆã³æ‹¡å¼µã™ã‚‹ãŸã‚ã«ãƒ¢ãƒ‡ãƒ«ã«è»¢é€ã•ã‚Œã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§ã™ã€‚</font><font style="vertical-align: inherit;">ç‹¬è‡ªã®ã‚«ã‚¹ã‚¿ãƒ ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’ä½œæˆã™ã‚‹ã‹ã€ã¾ãŸã¯çµ„ã¿è¾¼ã¿ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯</font></font><code>tf.keras.callbacks</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚’</font><font style="vertical-align: inherit;">ä½¿ç”¨ã§ã</font></font><br>
<br>
<code>tf.keras.callbacks.ModelCheckpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¾ã™ã€‚</font></font><br>
<code>tf.keras.callbacks.LearningRateScheduler</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šå­¦ç¿’ã‚¹ãƒ†ãƒƒãƒ—ã®å‹•çš„ãªå¤‰åŒ–ã€‚</font></font><br>
<code>tf.keras.callbacks.EarlyStopping</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šæ¤œè¨¼ã®çµæœãŒæ”¹å–„ã—ãªããªã£ãŸã¨ãã«ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã‚’åœæ­¢ã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">
TensorBoard </font><font style="vertical-align: inherit;">
ã‚’ä½¿ç”¨ã—ã¦</font></font><br>
<code>tf.keras.callbacks.TensorBoard:</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ¢ãƒ‡ãƒ«ã®å‹•ä½œã‚’ç›£è¦–</font><font style="vertical-align: inherit;">ã™ã‚‹ã‚’ä½¿ç”¨ã™ã‚‹ã«ã¯</font><font style="vertical-align: inherit;">ã€ãã‚Œã‚’ãƒ¢ãƒ‡ãƒ«ãƒ¡ã‚½ãƒƒãƒ‰ã«æ¸¡ã—ã¾ã™</font><font style="vertical-align: inherit;">ã€‚</font></font><br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><code>tf.keras.callbacks.Callback</code><font style="vertical-align: inherit;"></font><code>fit</code><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="python hljs">callbacks = [
  <span class="hljs-comment">#    `val_loss`     2 </span>
  tf.keras.callbacks.EarlyStopping(patience=<span class="hljs-number">2</span>, monitor=<span class="hljs-string">'val_loss'</span>),
  <span class="hljs-comment">#   TensorBoard   `./logs` directory</span>
  tf.keras.callbacks.TensorBoard(log_dir=<span class="hljs-string">'./logs'</span>)<font></font>
]<font></font>
model.fit(data, labels, batch_size=<span class="hljs-number">32</span>, epochs=<span class="hljs-number">5</span>, callbacks=callbacks,<font></font>
          validation_data=(val_data, val_labels))</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¿å­˜ã¨å¾©å…ƒ</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é‡é‡å€¤ã®ã¿ã‚’ä¿å­˜ã™ã‚‹</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä»¥ä¸‹ã‚’ä½¿ç”¨ã—ã¦ãƒ¢ãƒ‡ãƒ«ã®é‡ã¿ã‚’ä¿å­˜ãŠã‚ˆã³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™</font></font><code>tf.keras.Model.save_weights</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br>
<pre><code class="python hljs">model = tf.keras.Sequential([<font></font>
layers.Dense(<span class="hljs-number">64</span>, activation=<span class="hljs-string">'relu'</span>, input_shape=(<span class="hljs-number">32</span>,)),<font></font>
layers.Dense(<span class="hljs-number">10</span>, activation=<span class="hljs-string">'softmax'</span>)])<font></font>
<font></font>
model.compile(optimizer=tf.keras.optimizers.Adam(<span class="hljs-number">0.001</span>),<font></font>
              loss=<span class="hljs-string">'categorical_crossentropy'</span>,<font></font>
              metrics=[<span class="hljs-string">'accuracy'</span>])</code></pre><br>
<pre><code class="python hljs"><span class="hljs-comment">#     TensorFlow Checkpoint</span>
model.save_weights(<span class="hljs-string">'./weights/my_model'</span>)<font></font>
<font></font>
<span class="hljs-comment">#   </span>
<span class="hljs-comment">#        .     </span>
model.load_weights(<span class="hljs-string">'./weights/my_model'</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ã€ãƒ¢ãƒ‡ãƒ«ã®é‡ã¿ã¯TensorFlowãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆå½¢å¼ã§ä¿å­˜ã•ã‚Œã¾ã™ã€‚</font><font style="vertical-align: inherit;">é‡ã¿ã¯ã€Keras HDF5å½¢å¼ï¼ˆKerasãƒ¦ãƒ‹ãƒãƒ¼ã‚µãƒ«å®Ÿè£…ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ï¼‰ã§ä¿å­˜ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment">#     HDF5</span>
model.save_weights(<span class="hljs-string">'my_model.h5'</span>, save_format=<span class="hljs-string">'h5'</span>)<font></font>
<font></font>
<span class="hljs-comment">#   </span>
model.load_weights(<span class="hljs-string">'my_model.h5'</span>)</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ¢ãƒ‡ãƒ«æ§‹æˆã®ã¿ã‚’ä¿å­˜ã—ã¦ã„ã¾ã™</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãƒ¢ãƒ‡ãƒ«ã®æ§‹æˆã‚’ä¿å­˜ã§ãã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€é‡ã¿ãªã—ã§ãƒ¢ãƒ‡ãƒ«ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãŒã‚·ãƒªã‚¢ãƒ«åŒ–ã•ã‚Œã¾ã™ã€‚</font><font style="vertical-align: inherit;">ä¿å­˜ã•ã‚ŒãŸæ§‹æˆã¯ã€å…ƒã®ãƒ¢ãƒ‡ãƒ«ã‚’å®šç¾©ã™ã‚‹ã‚³ãƒ¼ãƒ‰ãŒãªãã¦ã‚‚ã€åŒã˜ãƒ¢ãƒ‡ãƒ«ã‚’å¾©å…ƒã—ã¦åˆæœŸåŒ–ã§ãã¾ã™ã€‚</font><font style="vertical-align: inherit;">Kerasã¯JSONãŠã‚ˆã³YAMLã‚·ãƒªã‚¢ãƒ«åŒ–ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™ï¼š</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment">#     JSON</span><font></font>
json_string = model.to_json()<font></font>
json_string</code></pre><br>
<pre><code class="python hljs"><span class="hljs-keyword">import</span> json
<span class="hljs-keyword">import</span> pprint<font></font>
pprint.pprint(json.loads(json_string))</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
JSONã‹ã‚‰ï¼ˆå†åˆæœŸåŒ–ã•ã‚ŒãŸï¼‰ãƒ¢ãƒ‡ãƒ«ã‚’å¾©å…ƒã™ã‚‹ï¼š</font></font><br>
<br>
<pre><code class="python hljs">fresh_model = tf.keras.models.model_from_json(json_string)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãƒ¢ãƒ‡ãƒ«ã‚’YAMLã«ã‚·ãƒªã‚¢ãƒ«åŒ–</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã™ã‚‹ã«</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¯ã€TensorFlow </font><i><font style="vertical-align: inherit;">ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹å‰</font></i><font style="vertical-align: inherit;">ã«ã€Œpyyamlã€ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™</font><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br>
<pre><code class="python hljs">yaml_string = model.to_yaml()<font></font>
print(yaml_string)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
YAMLã‹ã‚‰ãƒ¢ãƒ‡ãƒ«ã‚’å¾©å…ƒã™ã‚‹ï¼š</font></font><br>
<br>
<pre><code class="python hljs">fresh_model = tf.keras.models.model_from_yaml(yaml_string)</code></pre><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ³¨ï¼šã‚µãƒ–ã‚¯ãƒ©ã‚¹åŒ–ã•ã‚ŒãŸãƒ¢ãƒ‡ãƒ«ã¯ã€ `call`ãƒ¡ã‚½ãƒƒãƒ‰ã®æœ¬ä½“ã®Pythonã‚³ãƒ¼ãƒ‰ã«ã‚ˆã£ã¦å®šç¾©ã•ã‚Œã‚‹ãŸã‚ã€ã‚·ãƒªã‚¢ãƒ«åŒ–ã§ãã¾ã›ã‚“ã€‚</font></font></blockquote><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ¢ãƒ‡ãƒ«å…¨ä½“ã‚’1ã¤ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã™ã‚‹</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãƒ¢ãƒ‡ãƒ«å…¨ä½“ã¯ã€é‡ã¿ã®å€¤ã€ãƒ¢ãƒ‡ãƒ«ã®æ§‹æˆã€ã•ã‚‰ã«ã¯ã‚ªãƒ—ãƒ†ã‚£ãƒã‚¤ã‚¶ãƒ¼ã®æ§‹æˆã‚’å«ã‚€ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã§ãã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã“ã‚Œã«ã‚ˆã‚Šã€ãƒ¢ãƒ‡ãƒ«ã®ãƒ–ãƒ¬ãƒ¼ã‚¯ãƒã‚¤ãƒ³ãƒˆã‚’è¨­å®šã—ã€ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãªãã¦ã‚‚ã€ã¾ã£ãŸãåŒã˜ä½ç½®ã‹ã‚‰å¾Œã§ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã‚’ç¶šã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚</font></font><br>
<br>
<pre><code class="plaintext hljs">#   <font></font>
model = tf.keras.Sequential([<font></font>
  layers.Dense(10, activation='softmax', input_shape=(32,)),<font></font>
  layers.Dense(10, activation='softmax')<font></font>
])<font></font>
model.compile(optimizer='rmsprop',<font></font>
              loss='categorical_crossentropy',<font></font>
              metrics=['accuracy'])<font></font>
model.fit(data, labels, batch_size=32, epochs=5)<font></font>
<font></font>
#      HDF5<font></font>
model.save('my_model.h5')<font></font>
<font></font>
#         .<font></font>
model = tf.keras.models.load_model('my_model.h5')</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç†±å¿ƒãªå®Ÿè¡Œ</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç†±å¿ƒãªå®Ÿè¡Œã¯ã€æ“ä½œã‚’ã™ãã«å®Ÿè¡Œã™ã‚‹å¿…é ˆã®ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ç’°å¢ƒã§ã™ã€‚</font><font style="vertical-align: inherit;">ã“ã‚Œã¯Kerasã«ã¯å¿…è¦ã‚ã‚Šã¾ã›ã‚“ãŒã€ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦</font></font><code>tf.keras</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãŠã‚Šã€ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®ãƒã‚§ãƒƒã‚¯ã¨ãƒ‡ãƒãƒƒã‚°ã«å½¹ç«‹ã¡ã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
`tf.keras` APIã®ã™ã¹ã¦ã®æ§‹ç¯‰ãƒ¢ãƒ‡ãƒ«ã¯ã€ç†±å¿ƒãªå®Ÿè¡Œã¨äº’æ›æ€§ãŒã‚ã‚Šã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã€Œé †æ¬¡ã€APIã¨é–¢æ•°å‹APIã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ãŒã€ç†±å¿ƒãªå®Ÿè¡Œã¯</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€ãƒ¢ãƒ‡ãƒ«</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚’</font><i><font style="vertical-align: inherit;">ã‚µãƒ–ã‚¯ãƒ©ã‚¹åŒ–ã—ã¦</font></i></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚«ã‚¹ã‚¿ãƒ ãƒ¬ã‚¤ãƒ¤ãƒ¼</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚’æ§‹ç¯‰</font><i><font style="vertical-align: inherit;">ã™ã‚‹</font></i><font style="vertical-align: inherit;">ã¨ãã«ç‰¹ã«å½¹ç«‹ã¡</font><font style="vertical-align: inherit;">ã¾ã™ã€‚ã“ã‚Œã‚‰ã®APIã§ã¯ã€ï¼ˆæ—¢å­˜ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’çµ„ã¿ç«‹ã¦ã¦ãƒ¢ãƒ‡ãƒ«ã‚’ä½œæˆã™ã‚‹APIã®ä»£ã‚ã‚Šã«ï¼‰ã‚³ãƒ¼ãƒ‰ã®å½¢å¼ã§ç›´æ¥é…å¸ƒã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åˆ†å¸ƒ</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¤‡æ•°ã®GPU</font></font></h3><br>
<code>tf.keras</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ¢ãƒ‡ãƒ«ã¯ã€ã‚’ä½¿ç”¨ã—ã¦è¤‡æ•°ã®GPUã§å®Ÿè¡Œã§ãã¾ã™</font></font><code>tf.distribute.Strategy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ã“ã®APIã¯ã€æ—¢å­˜ã®ã‚³ãƒ¼ãƒ‰ã‚’ã»ã¨ã‚“ã©ã¾ãŸã¯ã¾ã£ãŸãå¤‰æ›´ã›ãšã«ã€è¤‡æ•°ã®GPUã«åˆ†æ•£å­¦ç¿’ã‚’æä¾›ã—ã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç¾åœ¨ã€</font></font><code>tf.distribute.MirroredStrategy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦</font><font style="vertical-align: inherit;">ã„ã‚‹</font><font style="vertical-align: inherit;">å”¯ä¸€ã®é…å¸ƒæˆ¦ç•¥ã€‚</font><font style="vertical-align: inherit;">
åŒã˜ãƒã‚·ãƒ³ä¸Šã§all-reduceã‚’ä½¿ç”¨</font></font><code>MirroredStrategy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã—ã¦</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åŒæœŸå­¦ç¿’ã‚’</font><font style="vertical-align: inherit;">è¡Œã†ã‚°ãƒ©ãƒ•ã§ãƒ¬ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã—ã¾ã™</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">` </font></font><code>distribute.Strategy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">` </font><font style="vertical-align: inherit;">ã‚’ä½¿ç”¨ã™ã‚‹ã«</font><font style="vertical-align: inherit;">ã¯ã€ã‚ªãƒ—ãƒ†ã‚£ãƒã‚¤ã‚¶ã®ã‚¤ãƒ³ã‚¹â€‹â€‹ãƒˆãƒ¼ãƒ«ã‚’ãƒã‚¹ãƒˆã—ã€ ` </font></font><code>Strategy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">` ` </font></font><code>.scope()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">`ã§</font><font style="vertical-align: inherit;">ãƒ¢ãƒ‡ãƒ«ã‚’æ§‹ç¯‰ãŠã‚ˆã³ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã—ã¦ã‹ã‚‰ã€ãƒ¢ãƒ‡ãƒ«ã‚’</font><font style="vertical-align: inherit;">ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã—ã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ¬¡ã®ä¾‹</font></font><code>tf.keras.Model</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¯ã€åŒã˜ãƒã‚·ãƒ³ä¸Šã®è¤‡æ•°ã®GPUé–“ã§åˆ†æ•£ã—ã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æœ€åˆã«ã€åˆ†æ•£æˆ¦ç•¥ã®é ˜åŸŸå†…ã§ãƒ¢ãƒ‡ãƒ«ã‚’å®šç¾©ã—ã¾ã™ã€‚</font></font><br>
<br>
<pre><code class="python hljs">strategy = tf.distribute.MirroredStrategy()<font></font>
<font></font>
<span class="hljs-keyword">with</span> strategy.scope():<font></font>
  model = tf.keras.Sequential()<font></font>
  model.add(layers.Dense(<span class="hljs-number">16</span>, activation=<span class="hljs-string">'relu'</span>, input_shape=(<span class="hljs-number">10</span>,)))<font></font>
  model.add(layers.Dense(<span class="hljs-number">1</span>, activation=<span class="hljs-string">'sigmoid'</span>))<font></font>
<font></font>
  optimizer = tf.keras.optimizers.SGD(<span class="hljs-number">0.2</span>)<font></font>
<font></font>
  model.compile(loss=<span class="hljs-string">'binary_crossentropy'</span>, optimizer=optimizer)<font></font>
<font></font>
model.summary()</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ¬¡ã«ã€é€šå¸¸ã©ãŠã‚Šãƒ‡ãƒ¼ã‚¿ã§ãƒ¢ãƒ‡ãƒ«ã‚’ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã—ã¾ã™ã€‚</font></font><br>
<br>
<pre><code class="python hljs">x = np.random.random((<span class="hljs-number">1024</span>, <span class="hljs-number">10</span>))<font></font>
y = np.random.randint(<span class="hljs-number">2</span>, size=(<span class="hljs-number">1024</span>, <span class="hljs-number">1</span>))<font></font>
x = tf.cast(x, tf.float32)<font></font>
dataset = tf.data.Dataset.from_tensor_slices((x, y))<font></font>
dataset = dataset.shuffle(buffer_size=<span class="hljs-number">1024</span>).batch(<span class="hljs-number">32</span>)<font></font>
<font></font>
model.fit(dataset, epochs=<span class="hljs-number">1</span>)</code></pre><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¤œè¨¼å¾Œã€ç¿»è¨³ã¯Tensorflow.orgã«ã‚‚è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</font><font style="vertical-align: inherit;">Tensorflow.orgã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ãƒ­ã‚·ã‚¢èªã¸ã®ç¿»è¨³ã«å‚åŠ ã—ãŸã„å ´åˆã¯ã€å€‹äººã¾ãŸã¯ã‚³ãƒ¡ãƒ³ãƒˆã§ã”é€£çµ¡ãã ã•ã„ã€‚</font><font style="vertical-align: inherit;">ä¿®æ­£ã‚„ã‚³ãƒ¡ãƒ³ãƒˆã¯ã‚ã‚ŠãŒãŸã„ã§ã™ã€‚</font></font></i></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja482106/index.html">Habr Freelance 2019ï¼šä»Šå¹´ã®çµæœ</a></li>
<li><a href="../ja482108/index.html">é™ã‹ãªçŸ¥æ€§ã€‚æ½œåœ¨çš„ãªWEBè„†å¼±æ€§ã‚’ç‰¹å®šã™ã‚‹æ–¹æ³•</a></li>
<li><a href="../ja482110/index.html">Linuxã¯ç§ã®ååˆºã§å‹•ä½œã—ã¾ã™</a></li>
<li><a href="../ja482114/index.html">Djangoã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‹ã‚‰asyncioã¨aiohttpã‚’ä½¿ç”¨ã—ã¦ãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡ã™ã‚‹</a></li>
<li><a href="../ja482118/index.html">Docker API + Portainer API =åˆ©ç›Š</a></li>
<li><a href="../ja482128/index.html">gReebokãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸã€‚çš®è†šç§‘åŒ»è‡ªèº«</a></li>
<li><a href="../ja482130/index.html">ç•°ãªã‚‹ãƒ•ã‚©ãƒ¬ã‚¹ãƒˆã®ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ã®æ¨©åˆ©ã®å¤§è¦æ¨¡ãªå‰²ã‚Šå½“ã¦</a></li>
<li><a href="../ja482134/index.html">ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ã®æ¯”è¼ƒã€ã¾ãŸã¯ãƒ«ãƒ¼ãƒãƒ‹ã‚¢èªMezeãƒ˜ãƒƒãƒ‰ãƒ•ã‚©ãƒ³ã®æ‰€æœ‰è€…ã«84 990ãƒ«ãƒ¼ãƒ–ãƒ«ã¨239 990ãƒ«ãƒ¼ãƒ–ãƒ«ã®æœŸå¾…å€¤</a></li>
<li><a href="../ja482136/index.html">ãƒ¢ãƒãƒ–ãƒ©ãƒ³ãƒ‰ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ã€ã‚¢ã‚°ãƒªã‚²ãƒ¼ã‚¿ãƒ¼ã¨æ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³ã®å†…éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ã‚’å€’ã™ã“ã¨ã«ã‚ˆã£ã¦ã€ã©ã®ã‚ˆã†ã«ã—ã¦TOPã«å…¥ã‚‹ã“ã¨ãŒã§ãã¾ã™ã‹</a></li>
<li><a href="../ja482140/index.html">4ã€œ10æ­³ã®è‹¥ã„ãƒ—ãƒ­ã‚°ãƒ©ãƒãƒ¼å‘ã‘ã®ãƒœãƒ¼ãƒ‰ã‚²ãƒ¼ãƒ ã€‚2019å¹´æœ«ã«å¸‚å ´ã§è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã‚‹ã‚‚ã®</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>