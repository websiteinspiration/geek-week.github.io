<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>⌚️ 🧗🏿 👍🏼 CMake：プロジェクトがそのコードの品質を容認できない場合 💶 🕴️ 🙀</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="CMakeは、プロジェクトを構築するためのクロスプラットフォーム自動化システムです。このシステムはPVS-Studio静的コードアナライザーよりもはるかに古く、まだコードに適用してエラーを確認しようとした人はいません。間違いが多いことがわかります。CMakeの聴衆は巨大です。その上で、新しいプロジェ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>CMake：プロジェクトがそのコードの品質を容認できない場合</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/464147/"><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c40/4a5/994/c404a599454444ac3e9021195c5b3c3c.png" alt="写真1"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CMakeは、プロジェクトを構築するためのクロスプラットフォーム自動化システムです。</font><font style="vertical-align: inherit;">このシステムはPVS-Studio静的コードアナライザーよりもはるかに古く、まだコードに適用してエラーを確認しようとした人はいません。</font><font style="vertical-align: inherit;">間違いが多いことがわかります。</font><font style="vertical-align: inherit;">CMakeの聴衆は巨大です。</font><font style="vertical-align: inherit;">その上で、新しいプロジェクトが始まり、古いプロジェクトが転送されます。</font><font style="vertical-align: inherit;">このエラーまたはそのエラーが発生する可能性があるプログラマーの数を想像するのは怖いです。</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前書き</font></font></h2><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CMake</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（英語のクロスプラットフォームmakeによる）は、ソースコードからソフトウェアを構築するためのクロスプラットフォーム自動化システムです。</font><font style="vertical-align: inherit;">CMakeは直接ビルドせず、CMakeLists.txtファイルからアセンブリ制御ファイルを生成するだけです。</font><font style="vertical-align: inherit;">プログラムの最初のリリースは2000年に行われました。</font><font style="vertical-align: inherit;">比較のため、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スタティックアナライザー</font><font style="vertical-align: inherit;">は2008年にのみ登場しました。</font><font style="vertical-align: inherit;">次に、32ビットシステムから64ビットシステムにプログラムを移植するときにエラーを見つけることに焦点が当てられ、2010年に最初の汎用診断セット（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V501</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V545</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）が登場しました。</font><font style="vertical-align: inherit;">ちなみに、CMakeコードのこの最初のセットからいくつかの警告があります。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">許されない間違い</font></font></h2><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V1040</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">事前定義されたマクロ名のスペルのタイプミスの可能性があります。</font><font style="vertical-align: inherit;">「__MINGW32_」マクロは「__MINGW32__」に似ています。</font><font style="vertical-align: inherit;">winapi.h 4112</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">/* from winternl.h */</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> !defined(__UNICODE_STRING_DEFINED) &amp;&amp; defined(__MINGW32_)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> __UNICODE_STRING_DEFINED</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span></code></pre><br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V1040</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
診断</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">は</font></a><font style="vertical-align: inherit;">、最近実装されました。</font><font style="vertical-align: inherit;">この記事の公開時点では、おそらくリリースはありませんが、この診断の助けを借りて、困難な間違いを発見することができました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここで、彼らは</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">__MINGW32_</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">という名前のタイプミスをしました</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">最後に、1つのアンダースコアが欠落しています。</font><font style="vertical-align: inherit;">この名前のコードで検索すると、プロジェクトで実際に両側に2つの下線が付いたバージョンが使用されていることを確認できます。</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ed5/ad7/425/ed5ad7425145902765d728287ab5f2fa.png" alt="写真3"></div><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V531</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sizeof（）演算子がsizeof（）で乗算されるのは奇妙です。</font><font style="vertical-align: inherit;">cmGlobalVisualStudioGenerator.cxx 558</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">IsVisualStudioMacrosFileRegistered</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&amp; macrosFile,
                                        <span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&amp; regKeyBase,
                                        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&amp; nextAvailableSubKeyName)</span>
</span>{<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> (ERROR_SUCCESS == result) {
    <span class="hljs-keyword">wchar_t</span> subkeyname[<span class="hljs-number">256</span>];                                           <span class="hljs-comment">// &lt;=</span>
    DWORD cch_subkeyname = <span class="hljs-keyword">sizeof</span>(subkeyname) * <span class="hljs-keyword">sizeof</span>(subkeyname[<span class="hljs-number">0</span>]); <span class="hljs-comment">// &lt;=</span>
    <span class="hljs-keyword">wchar_t</span> keyclass[<span class="hljs-number">256</span>];<font></font>
    DWORD cch_keyclass = <span class="hljs-keyword">sizeof</span>(keyclass) * <span class="hljs-keyword">sizeof</span>(keyclass[<span class="hljs-number">0</span>]);<font></font>
    FILETIME lastWriteTime;<font></font>
    lastWriteTime.dwHighDateTime = <span class="hljs-number">0</span>;<font></font>
    lastWriteTime.dwLowDateTime = <span class="hljs-number">0</span>;<font></font>
<font></font>
    <span class="hljs-keyword">while</span> (ERROR_SUCCESS ==<font></font>
           RegEnumKeyExW(hkey, index, subkeyname, &amp;cch_subkeyname, <span class="hljs-number">0</span>, keyclass,<font></font>
                         &amp;cch_keyclass, &amp;lastWriteTime)) {<font></font>
    ....<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
配列が静的に宣言されると、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sizeof</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">演算子は</font><font style="vertical-align: inherit;">、要素の数と要素のサイズの両方を考慮して、バイト単位でサイズ</font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">計算します。変数</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cch_subkeynameの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">値を計算するとき</font><i><font style="vertical-align: inherit;">、</font></i><font style="vertical-align: inherit;">プログラマーはこれを考慮せず、計画の4倍の値を受け取りました。 「4回」はどこにあるのか説明しよう。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
配列とその不正なサイズが</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RegEnumKeyExW</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">関数に渡されます</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function">LSTATUS <span class="hljs-title">RegEnumKeyExW</span><span class="hljs-params">(
  HKEY      hKey,
  DWORD     dwIndex,
  LPWSTR    lpName,    <span class="hljs-comment">// &lt;= subkeyname</span>
  LPDWORD   lpcchName, <span class="hljs-comment">// &lt;= cch_subkeyname</span>
  LPDWORD   lpReserved,
  LPWSTR    lpClass,
  LPDWORD   lpcchClass,
  PFILETIME lpftLastWriteTime
)</span></span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ポインター</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lpcchName</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、文字で指定されたバッファーのサイズを含む変数を</font><font style="vertical-align: inherit;">指す</font><font style="vertical-align: inherit;">必要があります：「</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lpClass</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パラメーターで</font><font style="vertical-align: inherit;">指定されたバッファーのサイズを文字で指定した変数へのポインター</font><font style="vertical-align: inherit;">」。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サブキー名</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">配列のサイズ</font><font style="vertical-align: inherit;">は512バイトで、タイプ</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wchar_tの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 256文字を格納できます</font><font style="vertical-align: inherit;">（Windowsのwchar_tでは2バイトです）。この値は256であり、関数に渡す必要があります。代わりに、512に2を掛けると、1024 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
になります。エラーを修正する方法は今や明らかです。乗算の代わりに、除算を使用します。</font></font><br>
<br>
<pre><code class="cpp hljs">DWORD cch_subkeyname = <span class="hljs-keyword">sizeof</span>(subkeyname) / <span class="hljs-keyword">sizeof</span>(subkeyname[<span class="hljs-number">0</span>]);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ちなみに、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cch_keyclass</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">変数の値を計算すると、まったく同じエラーが発生します</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
説明されているエラーは、バッファオーバーフローを引き起こす可能性があります。</font><font style="vertical-align: inherit;">そのような場所をすべて修正する必要があります：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V531 sizeof（）演算子がsizeof（）で乗算されるのは奇妙です。</font><font style="vertical-align: inherit;">cmGlobalVisualStudioGenerator.cxx 556</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V531 sizeof（）演算子がsizeof（）で乗算されるのは奇妙です。</font><font style="vertical-align: inherit;">cmGlobalVisualStudioGenerator.cxx 572</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V531 sizeof（）演算子がsizeof（）で乗算されるのは奇妙です。</font><font style="vertical-align: inherit;">cmGlobalVisualStudioGenerator.cxx 621</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V531 sizeof（）演算子がsizeof（）で乗算されるのは奇妙です。</font><font style="vertical-align: inherit;">cmGlobalVisualStudioGenerator.cxx 622</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V531 sizeof（）演算子がsizeof（）で乗算されるのは奇妙です。</font><font style="vertical-align: inherit;">cmGlobalVisualStudioGenerator.cxx 649</font></font></li>
</ul><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V595</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 'this-&gt; BuildFileStream'ポインターは、nullptrに対して検証される前に使用されていました。</font><font style="vertical-align: inherit;">チェック行：133、134。cmMakefileTargetGenerator.cxx 133</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">cmMakefileTargetGenerator::CreateRuleFile</span><span class="hljs-params">()</span>
</span>{<font></font>
  ....<font></font>
  <span class="hljs-keyword">this</span>-&gt;BuildFileStream-&gt;SetCopyIfDifferent(<span class="hljs-literal">true</span>);
  <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>-&gt;BuildFileStream) {
    <span class="hljs-keyword">return</span>;<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">this-&gt; BuildFileStreamポインタがされた</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">だけで検証チェック前に間接参照します。</font><font style="vertical-align: inherit;">これは本当に問題を引き起こしていましたか？</font><font style="vertical-align: inherit;">以下は、そのような場所の別の例です。</font><font style="vertical-align: inherit;">カーボン紙の直下に作られています。</font><font style="vertical-align: inherit;">しかし実際</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">V595の</font></a><font style="vertical-align: inherit;">警告が</font><font style="vertical-align: inherit;">たくさんあり、それらのほとんどはそれほど明白ではありません。</font><font style="vertical-align: inherit;">経験上、この診断の警告を修正するのが最も長いと言えます。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V595 nullptrに対して検証される前に、「this-&gt; FlagFileStream」ポインタが使用されました。</font><font style="vertical-align: inherit;">チェック行：303、304。cmMakefileTargetGenerator.cxx 303</font></font></li>
</ul><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V614未</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">初期化ポインター 'str'が使用されています。</font><font style="vertical-align: inherit;">cmVSSetupHelper.h 80</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SmartBSTR</span>
{</span>
<span class="hljs-keyword">public</span>:<font></font>
  SmartBSTR() { str = <span class="hljs-literal">NULL</span>; }<font></font>
  SmartBSTR(<span class="hljs-keyword">const</span> SmartBSTR&amp; src)<font></font>
  {<font></font>
    <span class="hljs-keyword">if</span> (src.str != <span class="hljs-literal">NULL</span>) {<font></font>
      str = ::SysAllocStringByteLen((<span class="hljs-keyword">char</span>*)str, ::SysStringByteLen(str));<font></font>
    } <span class="hljs-keyword">else</span> {<font></font>
      str = ::SysAllocStringByteLen(<span class="hljs-literal">NULL</span>, <span class="hljs-number">0</span>);<font></font>
    }<font></font>
  }<font></font>
  ....<font></font>
<span class="hljs-keyword">private</span>:<font></font>
  BSTR str;<font></font>
};</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アナライザーは、初期化されていないポインター</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用を検出しました</font><font style="vertical-align: inherit;">。そして、これは通常のタイプミスのために起こりました。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SysAllocStringByteLen</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">関数を呼び出すとき</font><font style="vertical-align: inherit;">は、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">src.str</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ポインタを使用する必要がありました</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V557</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アレイのオーバーランが発生する可能性があります。 「lensymbol」インデックスの値は28に達する可能性があります。archive_read_support_format_rar.c2749</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">int64_t</span>
<span class="hljs-title">expand</span><span class="hljs-params">(struct archive_read *a, <span class="hljs-keyword">int64_t</span> end)</span>
</span>{<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> ((lensymbol = read_next_symbol(a, &amp;rar-&gt;lengthcode)) &lt; <span class="hljs-number">0</span>)
    <span class="hljs-keyword">goto</span> bad_data;
  <span class="hljs-keyword">if</span> (lensymbol &gt; (<span class="hljs-keyword">int</span>)(<span class="hljs-keyword">sizeof</span>(lengthbases)/<span class="hljs-keyword">sizeof</span>(lengthbases[<span class="hljs-number">0</span>])))
    <span class="hljs-keyword">goto</span> bad_data;
  <span class="hljs-keyword">if</span> (lensymbol &gt; (<span class="hljs-keyword">int</span>)(<span class="hljs-keyword">sizeof</span>(lengthbits)/<span class="hljs-keyword">sizeof</span>(lengthbits[<span class="hljs-number">0</span>])))
    <span class="hljs-keyword">goto</span> bad_data;<font></font>
  len = lengthbases[lensymbol] + <span class="hljs-number">2</span>;
  <span class="hljs-keyword">if</span> (lengthbits[lensymbol] &gt; <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">if</span> (!rar_br_read_ahead(a, br, lengthbits[lensymbol]))
      <span class="hljs-keyword">goto</span> truncated_data;<font></font>
    len += rar_br_bits(br, lengthbits[lensymbol]);<font></font>
    rar_br_consume(br, lengthbits[lensymbol]);<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このコードにいくつかの問題が見つかりました。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lengthbases</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lengthbitsの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">配列にアクセスするとき、配列の</font><font style="vertical-align: inherit;">境界を超える</font><i><font style="vertical-align: inherit;">こと</font></i><font style="vertical-align: inherit;">ができ</font><i><font style="vertical-align: inherit;">ます。これ</font></i><font style="vertical-align: inherit;">は、コードの上で、開発者が演算子&gt;&gt;の代わりに&gt;&gt;を記述したためです。</font><font style="vertical-align: inherit;">そのようなチェックは、1つの無効な値をスキップし始めました。</font><font style="vertical-align: inherit;">私たちは、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">オフ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バイワンエラーと呼ばれる古典的なエラーパターンに直面しています</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
無効なインデックスで配列にアクセスする場所のリスト全体：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V557アレイのオーバーランが発生する可能性があります。</font><font style="vertical-align: inherit;">「lensymbol」インデックスの値は28に達する可能性があります。archive_read_support_format_rar.c2750</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V557アレイのオーバーランが発生する可能性があります。</font><font style="vertical-align: inherit;">「lensymbol」インデックスの値は28に達する可能性があります。archive_read_support_format_rar.c2751</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V557アレイのオーバーランが発生する可能性があります。</font><font style="vertical-align: inherit;">「lensymbol」インデックスの値は28に達する可能性があります。archive_read_support_format_rar.c2753</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V557アレイのオーバーランが発生する可能性があります。</font><font style="vertical-align: inherit;">「lensymbol」インデックスの値は28に達する可能性があります。archive_read_support_format_rar.c2754</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V557アレイのオーバーランが発生する可能性があります。</font><font style="vertical-align: inherit;">「offssymbol」インデックスの値は60に達する可能性があります。archive_read_support_format_rar.c2797</font></font></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メモリーリーク</font></font></h2><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V773</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">関数は 'testRun'ポインターを解放せずに終了しました。</font><font style="vertical-align: inherit;">メモリリークの可能性があります。</font><font style="vertical-align: inherit;">cmCTestMultiProcessHandler.cxx 193</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">cmCTestMultiProcessHandler::FinishTestProcess</span><span class="hljs-params">(cmCTestRunTest* runner,
                                                   <span class="hljs-keyword">bool</span> started)</span>
</span>{<font></font>
  ....<font></font>
  <span class="hljs-keyword">delete</span> runner;
  <span class="hljs-keyword">if</span> (started) {
    <span class="hljs-keyword">this</span>-&gt;StartNextTests();<font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">cmCTestMultiProcessHandler::StartTestProcess</span><span class="hljs-params">(<span class="hljs-keyword">int</span> test)</span>
</span>{<font></font>
  ....<font></font>
  cmCTestRunTest* testRun = <span class="hljs-keyword">new</span> cmCTestRunTest(*<span class="hljs-keyword">this</span>);    <span class="hljs-comment">// &lt;=</span><font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> (testRun-&gt;StartTest(<span class="hljs-keyword">this</span>-&gt;Completed, <span class="hljs-keyword">this</span>-&gt;Total)) {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;                                          <span class="hljs-comment">// &lt;=</span><font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">this</span>-&gt;FinishTestProcess(testRun, <span class="hljs-literal">false</span>);                <span class="hljs-comment">// &lt;=</span>
  <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アナライザがメモリリークを検出しました。</font><font style="vertical-align: inherit;">関数</font><i><font style="vertical-align: inherit;">testRun-&gt; StartTest</font></i><font style="vertical-align: inherit;">が</font><i><font style="vertical-align: inherit;">trueを</font></i><font style="vertical-align: inherit;">返す</font><font style="vertical-align: inherit;">場合</font><font style="vertical-align: inherit;">、ポインタ</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">testRun</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">によるメモリ</font><font style="vertical-align: inherit;">は解放されません</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">コードの別のブランチが実行されると、ポインター</font><i><font style="vertical-align: inherit;">testRun</font></i><font style="vertical-align: inherit;">によるメモリ</font><font style="vertical-align: inherit;">が関数</font><i><font style="vertical-align: inherit;">this-&gt; FinishTestProcessで</font></i><font style="vertical-align: inherit;">解放され</font><font style="vertical-align: inherit;">ます。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リソースリーク</font></font></h2><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V773</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">関数は、 'fd'ハンドルによって参照されるファイルを閉じずに終了しました。</font><font style="vertical-align: inherit;">リソースリークの可能性があります。</font><font style="vertical-align: inherit;">rhash.c 450</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function">RHASH_API <span class="hljs-keyword">int</span> <span class="hljs-title">rhash_file</span><span class="hljs-params">(....)</span>
</span>{<font></font>
  FILE* fd;<font></font>
  rhash ctx;<font></font>
  <span class="hljs-keyword">int</span> res;<font></font>
<font></font>
  hash_id &amp;= RHASH_ALL_HASHES;<font></font>
  <span class="hljs-keyword">if</span> (hash_id == <span class="hljs-number">0</span>) {<font></font>
    errno = EINVAL;<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">if</span> ((fd = fopen(filepath, <span class="hljs-string">"rb"</span>)) == <span class="hljs-literal">NULL</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<font></font>
<font></font>
  <span class="hljs-keyword">if</span> ((ctx = rhash_init(hash_id)) == <span class="hljs-literal">NULL</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;  <span class="hljs-comment">// &lt;= fclose(fd); ???</span><font></font>
<font></font>
  res = rhash_file_update(ctx, fd);<font></font>
  fclose(fd);<font></font>
<font></font>
  rhash_final(ctx, result);<font></font>
  rhash_free(ctx);<font></font>
  <span class="hljs-keyword">return</span> res;<font></font>
}</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条件の奇妙な論理</font></font></h2><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V590</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> '* s！=' \ 0 '&amp;&amp; * s ==' ''式の検査を検討してください。</font><font style="vertical-align: inherit;">表現が過剰であるか、誤植が含まれています。</font><font style="vertical-align: inherit;">archive_cmdline.c 76</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">ssize_t</span>
<span class="hljs-title">get_argument</span><span class="hljs-params">(struct archive_string *as, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *p)</span>
</span>{
  <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *s = p;<font></font>
<font></font>
  archive_string_empty(as);<font></font>
<font></font>
  <span class="hljs-comment">/* Skip beginning space characters. */</span>
  <span class="hljs-keyword">while</span> (*s != <span class="hljs-string">'\0'</span> &amp;&amp; *s == <span class="hljs-string">' '</span>)<font></font>
    s++;<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* s</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
文字</font><font style="vertical-align: inherit;">を終端ゼロ</font><font style="vertical-align: inherit;">と比較すること</font><font style="vertical-align: inherit;">は不必要です。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">whileループ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の条件は、</font><font style="vertical-align: inherit;">文字がスペースに等しいかどうかにのみ依存</font><i><font style="vertical-align: inherit;">します</font></i><font style="vertical-align: inherit;">。これは間違いではありませんが、コードがさらに複雑になります。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V592</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">式が括弧で2回囲まれました：（（式））。 1組の括弧が不要であるか、誤植が存在します。 cmCTestTestHandler.cxx 899</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">cmCTestTestHandler::ComputeTestListForRerunFailed</span><span class="hljs-params">()</span>
</span>{
  <span class="hljs-keyword">this</span>-&gt;ExpandTestsToRunInformationForRerunFailed();<font></font>
<font></font>
  ListOfTests finalList;<font></font>
  <span class="hljs-keyword">int</span> cnt = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">for</span> (cmCTestTestProperties&amp; tp : <span class="hljs-keyword">this</span>-&gt;TestList) {<font></font>
    cnt++;<font></font>
<font></font>
    <span class="hljs-comment">// if this test is not in our list of tests to run, then skip it.</span>
    <span class="hljs-keyword">if</span> ((!<span class="hljs-keyword">this</span>-&gt;TestsToRun.empty() &amp;&amp;
         <span class="hljs-built_in">std</span>::find(<span class="hljs-keyword">this</span>-&gt;TestsToRun.begin(), <span class="hljs-keyword">this</span>-&gt;TestsToRun.end(), cnt) ==
           <span class="hljs-keyword">this</span>-&gt;TestsToRun.end())) {
      <span class="hljs-keyword">continue</span>;<font></font>
    }<font></font>
<font></font>
    tp.Index = cnt;<font></font>
    finalList.push_back(tp);<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アナライザは、おそらく否定は括弧から外すべきだと警告します。</font><font style="vertical-align: inherit;">ここではそのような間違いはないようです-余分な二重括弧だけです。</font><font style="vertical-align: inherit;">しかし、ほとんどの場合、この状態には論理エラーがあります。</font><font style="vertical-align: inherit;">テストのリスト</font><i><font style="vertical-align: inherit;">this-&gt; TestsToRunが</font></i><font style="vertical-align: inherit;">空でなく、</font><i><font style="vertical-align: inherit;">cnt</font></i><font style="vertical-align: inherit;">が存在し</font><font style="vertical-align: inherit;">ない</font><font style="vertical-align: inherit;">場合、</font><i><font style="vertical-align: inherit;">continue</font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ステートメント</font><font style="vertical-align: inherit;">が実行さ</font><font style="vertical-align: inherit;">れます。</font><font style="vertical-align: inherit;">テストリストが空の場合、同じアクションを実行する必要があると想定するのは当然です。</font><font style="vertical-align: inherit;">ほとんどの場合、状態は次のようになります。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>-&gt;TestsToRun.empty() ||
    <span class="hljs-built_in">std</span>::find(<span class="hljs-keyword">this</span>-&gt;TestsToRun.begin(), <span class="hljs-keyword">this</span>-&gt;TestsToRun.end(), cnt) ==
      <span class="hljs-keyword">this</span>-&gt;TestsToRun.end()) {
  <span class="hljs-keyword">continue</span>;<font></font>
}</code></pre><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V592</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">式が括弧で2回囲まれました：（（式））。</font><font style="vertical-align: inherit;">1組の括弧が不要であるか、誤植が存在します。</font><font style="vertical-align: inherit;">cmMessageCommand.cxx 73</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">cmMessageCommand::InitialPass</span><span class="hljs-params">(<span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&gt; <span class="hljs-keyword">const</span>&amp; args,
                                   cmExecutionStatus&amp;)</span>
</span>{<font></font>
  ....<font></font>
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (*i == <span class="hljs-string">"DEPRECATION"</span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>-&gt;Makefile-&gt;IsOn(<span class="hljs-string">"CMAKE_ERROR_DEPRECATED"</span>)) {<font></font>
      fatal = <span class="hljs-literal">true</span>;<font></font>
      type = MessageType::DEPRECATION_ERROR;<font></font>
      level = cmake::LogLevel::LOG_ERROR;<font></font>
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((!<span class="hljs-keyword">this</span>-&gt;Makefile-&gt;IsSet(<span class="hljs-string">"CMAKE_WARN_DEPRECATED"</span>) ||
                <span class="hljs-keyword">this</span>-&gt;Makefile-&gt;IsOn(<span class="hljs-string">"CMAKE_WARN_DEPRECATED"</span>))) {<font></font>
      type = MessageType::DEPRECATION_WARNING;<font></font>
      level = cmake::LogLevel::LOG_WARNING;<font></font>
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
    }<font></font>
    ++i;<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
同様の例ですが、ここではエラーの存在に自信があります。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IsSet</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">関数</font><i><font style="vertical-align: inherit;">（ "CMAKE_WARN_DEPRECATED"）</font></i><font style="vertical-align: inherit;">は、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CMAKE_WARN_DEPRECATED</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">値</font><font style="vertical-align: inherit;">がグローバルに設定されている</font><font style="vertical-align: inherit;">ことを確認し、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IsOn</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">関数</font><i><font style="vertical-align: inherit;">（ "CMAKE_WARN_DEPRECATED"）</font></i><font style="vertical-align: inherit;">は、値がプロジェクト構成で指定されていることを確認します。</font><font style="vertical-align: inherit;">ほとんどの場合、否定演算子は不必要です。</font><font style="vertical-align: inherit;">どちらの場合も、同じ</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">タイプ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">レベルの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">値を設定するのが適切です</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V728</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">過剰チェックを簡略化できます。</font><font style="vertical-align: inherit;">'（A &amp;&amp;！B）|| </font><font style="vertical-align: inherit;">（！A &amp;&amp; B） '式は、' bool（A）！= Bool（B） '式と同等です。</font><font style="vertical-align: inherit;">cmCTestRunTest.cxx 151</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">cmCTestRunTest::EndTest</span><span class="hljs-params">(<span class="hljs-keyword">size_t</span> completed, <span class="hljs-keyword">size_t</span> total, <span class="hljs-keyword">bool</span> started)</span>
</span>{<font></font>
  ....<font></font>
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((success &amp;&amp; !<span class="hljs-keyword">this</span>-&gt;TestProperties-&gt;WillFail) ||<font></font>
             (!success &amp;&amp; <span class="hljs-keyword">this</span>-&gt;TestProperties-&gt;WillFail)) {
    <span class="hljs-keyword">this</span>-&gt;TestResult.Status = cmCTestTestHandler::COMPLETED;<font></font>
    outputStream &lt;&lt; <span class="hljs-string">"   Passed  "</span>;<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このようなコードは、条件式を次のように書き換えることで大幅に簡略化できます。</font></font><br>
<br>
<pre><code class="cpp hljs">} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (success != <span class="hljs-keyword">this</span>-&gt;TestProperties-&gt;WillFail)<font></font>
{<font></font>
    <span class="hljs-keyword">this</span>-&gt;TestResult.Status = cmCTestTestHandler::COMPLETED;<font></font>
    outputStream &lt;&lt; <span class="hljs-string">"   Passed  "</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
簡略化できる場所がさらにいくつかあります。</font></font><br>
<br>
<ul>
<li>V728 An excessive check can be simplified. The '(A &amp;&amp; B) || (!A &amp;&amp; !B)' expression is equivalent to the 'bool(A) == bool(B)' expression. cmCTestTestHandler.cxx 702</li>
<li>V728 An excessive check can be simplified. The '(A &amp;&amp; !B) || (!A &amp;&amp; B)' expression is equivalent to the 'bool(A) != bool(B)' expression. digest_sspi.c 443</li>
<li>V728 An excessive check can be simplified. The '(A &amp;&amp; !B) || (!A &amp;&amp; B)' expression is equivalent to the 'bool(A) != bool(B)' expression. tcp.c 1295</li>
<li>V728 An excessive check can be simplified. The '(A &amp;&amp; !B) || (!A &amp;&amp; B)' expression is equivalent to the 'bool(A) != bool(B)' expression. testDynamicLoader.cxx 58</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V728過剰チェックを簡略化できます。</font><font style="vertical-align: inherit;">'（A &amp;&amp;！B）|| </font><font style="vertical-align: inherit;">（！A &amp;&amp; B） '式は、' bool（A）！= Bool（B） '式と同等です。</font><font style="vertical-align: inherit;">testDynamicLoader.cxx 65</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V728過剰チェックを簡略化できます。</font><font style="vertical-align: inherit;">'（A &amp;&amp;！B）|| </font><font style="vertical-align: inherit;">（！A &amp;&amp; B） '式は、' bool（A）！= Bool（B） '式と同等です。</font><font style="vertical-align: inherit;">testDynamicLoader.cxx 72</font></font></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">その他の警告</font></font></h2><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V523</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 'then'ステートメントは、後続のコードフラグメントと同等です。</font><font style="vertical-align: inherit;">archive_read_support_format_ar.c 415</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span><font></font>
_ar_read_header(struct archive_read *a, struct archive_entry *entry,<font></font>
  struct ar *ar, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *h, <span class="hljs-keyword">size_t</span> *unconsumed)<font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-comment">/*
   * "__.SYMDEF" is a BSD archive symbol table.
   */</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-built_in">strcmp</span>(filename, <span class="hljs-string">"__.SYMDEF"</span>) == <span class="hljs-number">0</span>) {<font></font>
    archive_entry_copy_pathname(entry, filename);<font></font>
    <span class="hljs-comment">/* Parse the time, owner, mode, size fields. */</span>
    <span class="hljs-keyword">return</span> (ar_parse_common_header(ar, entry, h));<font></font>
  }<font></font>
<font></font>
  <span class="hljs-comment">/*
   * Otherwise, this is a standard entry.  The filename
   * has already been trimmed as much as possible, based
   * on our current knowledge of the format.
   */</span><font></font>
  archive_entry_copy_pathname(entry, filename);<font></font>
  <span class="hljs-keyword">return</span> (ar_parse_common_header(ar, entry, h));<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最後の条件の式は、関数の最後の2行と同じです。</font><font style="vertical-align: inherit;">このコードは、条件を削除することで簡略化できます。または、コードにエラーがあり、修正する必要があります。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V535</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">変数 'i'は、このループおよび外部ループで使用されています。</font><font style="vertical-align: inherit;">チェック行：2220、2241。multi.c 2241</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">static</span> CURLMcode <span class="hljs-title">singlesocket</span><span class="hljs-params">(struct Curl_multi *multi,
                              struct Curl_easy *data)</span>
</span>{<font></font>
  ....<font></font>
  <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; (i&lt; MAX_SOCKSPEREASYHANDLE) &amp;&amp;                           <span class="hljs-comment">// &lt;=</span><font></font>
        (curraction &amp; (GETSOCK_READSOCK(i) | GETSOCK_WRITESOCK(i)));<font></font>
      i++) {<font></font>
    <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> action = CURL_POLL_NONE;
    <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> prevaction = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> comboaction;
    <span class="hljs-keyword">bool</span> sincebefore = FALSE;<font></font>
<font></font>
    s = socks[i];<font></font>
<font></font>
    <span class="hljs-comment">/* get it from the hash */</span><font></font>
    entry = sh_getentry(&amp;multi-&gt;sockhash, s);<font></font>
<font></font>
    <span class="hljs-keyword">if</span>(curraction &amp; GETSOCK_READSOCK(i))<font></font>
      action |= CURL_POLL_IN;<font></font>
    <span class="hljs-keyword">if</span>(curraction &amp; GETSOCK_WRITESOCK(i))<font></font>
      action |= CURL_POLL_OUT;<font></font>
<font></font>
    actions[i] = action;<font></font>
    <span class="hljs-keyword">if</span>(entry) {
      <span class="hljs-comment">/* check if new for this transfer */</span>
      <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i&lt; data-&gt;numsocks; i++) {                            <span class="hljs-comment">// &lt;=</span>
        <span class="hljs-keyword">if</span>(s == data-&gt;sockets[i]) {<font></font>
          prevaction = data-&gt;actions[i];<font></font>
          sincebefore = TRUE;<font></font>
          <span class="hljs-keyword">break</span>;<font></font>
        }<font></font>
      }<font></font>
    }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
変数</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iは</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、外側のループとネストされたループでループカウンターとして使用されます。</font><font style="vertical-align: inherit;">この場合、カウンタ値は、囲まれたもののゼロから再びカウントを開始します。</font><font style="vertical-align: inherit;">これはここでは間違いではないかもしれませんが、コードは疑わしいものです。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V519</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「tagString」変数には、2回続けて値が割り当てられます。</font><font style="vertical-align: inherit;">おそらくこれは間違いです。</font><font style="vertical-align: inherit;">チェック行：84、86。cmCPackLog.cxx 86</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function">oid <span class="hljs-title">cmCPackLog::Log</span><span class="hljs-params">(<span class="hljs-keyword">int</span> tag, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* file, <span class="hljs-keyword">int</span> line, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* msg,
                     <span class="hljs-keyword">size_t</span> length)</span>
</span>{<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> (tag &amp; LOG_OUTPUT) {<font></font>
    output = <span class="hljs-literal">true</span>;<font></font>
    display = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">if</span> (needTagString) {
      <span class="hljs-keyword">if</span> (!tagString.empty()) {<font></font>
        tagString += <span class="hljs-string">","</span>;<font></font>
      }<font></font>
      tagString = <span class="hljs-string">"VERBOSE"</span>;<font></font>
    }<font></font>
  }<font></font>
  <span class="hljs-keyword">if</span> (tag &amp; LOG_WARNING) {<font></font>
    warning = <span class="hljs-literal">true</span>;<font></font>
    display = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">if</span> (needTagString) {
      <span class="hljs-keyword">if</span> (!tagString.empty()) {<font></font>
        tagString += <span class="hljs-string">","</span>;<font></font>
      }<font></font>
      tagString = <span class="hljs-string">"WARNING"</span>;<font></font>
    }<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tagString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
変数は</font><font style="vertical-align: inherit;">、すべての場所で新しい値</font><i><font style="vertical-align: inherit;">によって損なわれ</font></i><font style="vertical-align: inherit;">ます</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">間違いの内容や理由を説明するのは困難です。</font><font style="vertical-align: inherit;">おそらく演算子 '='と '+ ='は混同されていました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そのような場所の全リスト：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V519「tagString」変数には、2回続けて値が割り当てられます。</font><font style="vertical-align: inherit;">おそらくこれは間違いです。</font><font style="vertical-align: inherit;">チェック行：94、96。cmCPackLog.cxx 96</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V519「tagString」変数には、2回続けて値が割り当てられます。</font><font style="vertical-align: inherit;">おそらくこれは間違いです。</font><font style="vertical-align: inherit;">チェック行：104、106。cmCPackLog.cxx 106</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V519「tagString」変数には、2回続けて値が割り当てられます。</font><font style="vertical-align: inherit;">おそらくこれは間違いです。</font><font style="vertical-align: inherit;">チェック行：114、116。cmCPackLog.cxx 116</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V519「tagString」変数には、2回続けて値が割り当てられます。</font><font style="vertical-align: inherit;">おそらくこれは間違いです。</font><font style="vertical-align: inherit;">チェック行：125、127。cmCPackLog.cxx 127</font></font></li>
</ul><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V519</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ' </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">aes-</font></a><font style="vertical-align: inherit;"> &gt; aes_set'変数には、2回続けて値が割り当てられます。</font><font style="vertical-align: inherit;">おそらくこれは間違いです。</font><font style="vertical-align: inherit;">チェック行：4052、4054。archive_string.c 4054</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int</span>
<span class="hljs-title">archive_mstring_copy_utf8</span><span class="hljs-params">(struct archive_mstring *aes, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *utf8)</span>
</span>{
  <span class="hljs-keyword">if</span> (utf8 == <span class="hljs-literal">NULL</span>) {<font></font>
    aes-&gt;aes_set = <span class="hljs-number">0</span>;            <span class="hljs-comment">// &lt;=</span><font></font>
  }<font></font>
  aes-&gt;aes_set = AES_SET_UTF8;   <span class="hljs-comment">// &lt;=</span><font></font>
  ....<font></font>
  <span class="hljs-keyword">return</span> (<span class="hljs-keyword">int</span>)<span class="hljs-built_in">strlen</span>(utf8);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
強制値</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AES_SET_UTF8</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は疑わしく見えます。</font><font style="vertical-align: inherit;">そのようなコードは、この場所の洗練に直面している開発者を誤解させると思います。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このコードは、もう1つの場所にコピーされました。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V519 'aes-&gt; aes_set'変数には、2回続けて値が割り当てられます。</font><font style="vertical-align: inherit;">おそらくこれは間違いです。</font><font style="vertical-align: inherit;">チェック行：4066、4068。archive_string.c 4068</font></font></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CMakeでプロジェクトのエラーを見つける方法</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このセクションでは、PVS-Studioを使用してCMakeでプロジェクトを簡単かつ簡単にチェックする方法について少し説明します。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows / Visual Studio Visual Studioの</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
場合、CMake GUIまたは次のコマンドを使用してプロジェクトファイルを生成できます。</font></font><br>
<br>
<pre><code class="cpp hljs">cmake -G <span class="hljs-string">"Visual Studio 15 2017 Win64"</span> ..</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、.slnファイルを開き、</font><font style="vertical-align: inherit;">Visual Studioの</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プラグイン</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を使用してプロジェクトをテストできます</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Linux / macOS</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
これらのシステムでは、プロジェクトの検証にcompile_commands.jsonファイルが使用されます。</font><font style="vertical-align: inherit;">ちなみに、それは別のアセンブリシステムで生成できます。</font><font style="vertical-align: inherit;">CMakeでは、これは次のように行われます。</font></font><br>
<br>
<pre><code class="cpp hljs">cmake -DCMAKE_EXPORT_COMPILE_COMMANDS=On ..</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
.jsonファイルがあるディレクトリでアナライザを実行するために残ります。</font></font><br>
<br>
<pre><code class="cpp hljs">pvs-studio-analyzer analyze -l /path/to/PVS-Studio.lic<font></font>
  -o /path/to/project.<span class="hljs-built_in">log</span> -e /path/to/exclude-path -j&lt;N&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CMakeプロジェクトのモジュールも開発しました。</font><font style="vertical-align: inherit;">一部の人々はそれを使いたいです。</font><font style="vertical-align: inherit;">CMakeモジュールとその使用例は、GitHubのリポジトリ</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pvs-studio-cmake-examplesにあり</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結論</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CMakeユーザーの大勢のオーディエンスはプロジェクトの優れたテスターですが、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">などの静的コード分析ツールを使用すると、リリース前に多くの問題を防ぐことができませんでした</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アナライザーの結果は気に入ったが、プロジェクトがCおよびC ++で書かれていない場合は、アナライザーがC＃およびJavaでのプロジェクトの分析もサポートしていることを思い出してください。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">この</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ページに移動</font><font style="vertical-align: inherit;">して、プロジェクトでアナライザーを試すことができ</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/c78/30f/70c/c7830f70c5577c3d6704f254d7cad6a3.png" align="left"></a></p><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この記事を英語を話す視聴者と共有したい場合は、翻訳へのリンクを使用してください：Svyatoslav Razmyslov。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CMake：プロジェクトの品質が許されない場合</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja464131/index.html">JavaScriptの革新：Google I / O 2019の結果。パート2</a></li>
<li><a href="../ja464133/index.html">パフォーマンスは単なるCPUではありません：Python用の独自のプロファイラーを作成する</a></li>
<li><a href="../ja464137/index.html">テクニカルサポートMiran：仕組み</a></li>
<li><a href="../ja464141/index.html">Cでのメタクラスのファンタジー＃</a></li>
<li><a href="../ja464143/index.html">個人的ながんの治療法。患者の遺伝子が治療の成功に与える影響</a></li>
<li><a href="../ja464149/index.html">モノリスの物語</a></li>
<li><a href="../ja464151/index.html">Victor Vyalichkin：「自由、平等、友愛はOpenStreetMapだけにあり、すべてが常に見えています」</a></li>
<li><a href="../ja464155/index.html">AIはアフリカで動物の研究を支援</a></li>
<li><a href="../ja464161/index.html">SPAMとGDRP-「そこに」メールを送信する方法</a></li>
<li><a href="../ja464163/index.html">JavaScriptのこのキーワード。完全*マニュアル</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>