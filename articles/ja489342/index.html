<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤰🏻 🧝🏻 ✂️ フォールトトレラントITインフラストラクチャの作成。パート4.ゲートウェイルーティング用のCisco 3850スイッチの導入 🧑🏾‍🤝‍🧑🏽 🔮 😽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="この記事は、既存のネットワークインフラストラクチャに第3レベルのスイッチを導入するプロセスを理解していただくことを目的としており、主にネットワーク管理者とエンジニアを対象としています。2つのCisco 3850スイッチのスタックを構成し、それらを使用して内部ネットワーク間のトラフィックのより効率的で...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>フォールトトレラントITインフラストラクチャの作成。パート4.ゲートウェイルーティング用のCisco 3850スイッチの導入</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/lenvendo/blog/489342/"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">この記事は、既存のネットワークインフラストラクチャに第3レベルのスイッチを導入するプロセスを理解していただくことを目的としており、主にネットワーク管理者とエンジニアを対象としています。</font><font style="vertical-align: inherit;">2つのCisco 3850スイッチのスタックを構成し、それらを使用して内部ネットワーク間のトラフィックのより効率的でフォールトトレラントなルーティングを構成する方法について説明します。</font></font></p><br>
<p><img src="https://habrastorage.org/webt/pq/gf/gb/pqgfgb5li_b-ioomr8wxids3zoi.jpeg"></p><a name="habracut"></a><br>
<h3 id="vvodnaya-chast"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前書き</font></font></h3><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VyOS仮想ルーターを使用した内部ルーティングと外部ルーティングの構成を扱っ</font><font style="vertical-align: inherit;">た</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3番目の記事の</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">公開後、</font><font style="vertical-align: inherit;">上記の</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ネットワークダイアグラムは</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、大量のトラフィックのフローに対応できないため、またすでに何であるかについても</font><font style="vertical-align: inherit;">コメント</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">が</font></a><font style="vertical-align: inherit;">誤って</font><font style="vertical-align: inherit;">いると述べられて</font><font style="vertical-align: inherit;">いましたL3を他の機器に転送するための作業インフラストラクチャには問題がある可能性があります。</font></font></p><br>
<p>  ,         –             ,    ,      ,                . </p><br>
<p>  ,        ,           ,   "" ,  ,  ,        , , ,     .  ,     ,     ,    ,          .</p><br>
<p>   ,        .<br>
     VyOS  2 vCPU  1 Gb vRAM,      20 ()  ,     220  .<br>
  : </p><br>
<ul>
<li>   5  ;</li>
<li>    500 /;</li>
<li>  200 /,       .</li>
</ul><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">BGP full view</a>      ,         VyOS,       «». </p><br>
<p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a>,    - ,         VyOS  40-50%,          ,    -        . </p><br>
<p>  ,     :</p><br>
<ul>
<li>    10  20;</li>
<li>    ~120  ~220;</li>
<li>       .</li>
</ul><br>
<p>    ,           ,  <u></u>         ,       -     .  ,        ,       :</p><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><img src="https://habrastorage.org/webt/5q/y1/mg/5qy1mg7cb4neayh7xipa7jp82zo.jpeg"></a></p><br>
<p>        ,  -         ,  /  - .      ,       ,     ,       -       , -       .</p><br>
<p>                 –        ,     ,    .</p><br>
<p>           :</p><br>
<ul>
<li>  Cisco 2960RX;</li>
<li>    ~20-30 ;</li>
<li>  ,     ;</li>
<li>      .</li>
</ul><br>
<p>   ,            VyOS,            .    ,      , ,               ,      ,          . </p><br>
<p>  ,         VyOS   ,     ,     -   .  ,    VyOS       –   vCPU  vRAM,         ,     . </p><br>
<p>  ,   (   -     –   )       Cisco 3850,  -    -    .  ,      ,          ,          .</p><br>
<p> ,      –                   vCPU.     -   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Cisco 3850</a>     –    .  ,           1 /  10 /   Cisco 3850      ,        480 /,  10 / ,      .</p><br>
<p> ,     ,     ,   ,          Cisco 3850. ,           ,           . </p><br>
<p>     ,    L3,            ,      –      .      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">  </a>,       .</p><br>
<p>  ,     ,     ,    :</p><br>
<ul>
<li>      Cisco 3850</li>
<li> </li>
<li>     Cisco 3850</li>
<li>   Cisco 2960R   Cisco 3850</li>
<li>       </li>
<li>         PBR</li>
<li>     VyOS'   Cisco 3850</li>
<li>         OSPF</li>
</ul><br>
<h3 id="shema-seti-s-mezhsetevoy-marshrutizaciey-na-cisco-3850">      Cisco 3850</h3><br>
<p><strong> 1</strong><br>
    <strong>source-based</strong>    PBR</p><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><img src="https://habrastorage.org/webt/ph/fe/fy/phfefyvc_q2aoulxqbsbbtwb2rk.jpeg"></a></p><br>
<p>            –      L3,     VLAN34  VLAN35,        ,       – 172.16.3.0/24.</p><br>
<p>       :</p><br>
<ul>
<li><strong>VLAN17</strong> –  172.20.1.0/24,       (IPMI, management)</li>
<li><strong>VLAN30</strong> –  172.16.1.0/24, «» ,   <strong>VyOS1</strong>, <strong>VyOS2</strong>  <strong>Provider-1</strong></li>
<li><strong>VLAN31</strong> –  172.16.2.0/24, «» ,   <strong>VyOS2</strong>, <strong>VyOS1</strong>  <strong>Provider-2</strong></li>
<li><strong>VLAN32</strong> –  172.20.32.0/23,       – PROD</li>
<li><strong>VLAN34</strong> –  172.20.34.0/24,       – DEV</li>
<li><strong>VLAN35</strong> –  172.20.35.0/24,       – DMZ</li>
<li><strong>VLAN36</strong> –  172.16.10.8/30, «» P2P ,    <strong>Provider-1</strong>  <strong>Provider-3</strong></li>
<li><strong>VLAN37</strong> –  172.16.10.12/30, «» P2P ,    <strong>Provider-2</strong>  <strong>Provider-3</strong></li>
<li><strong>VLAN38</strong> –  172.16.3.0/24, «»    ,  </li>
<li><strong>VLAN40</strong> –  172.20.40.0/23,       – TEST</li>
</ul><br>
<p><strong> 2</strong><br>
    <strong>destination-based</strong>     OSPF</p><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><img src="https://habrastorage.org/webt/fm/0j/z7/fm0jz7e8iy8fnkrpoyyelbvzk4w.jpeg"><br>
</a></p><br>
<p>      L3,     VLAN34  VLAN35  ,    VLAN33     VyOS    L3.       ,       – 172.16.3.0/24.</p><br>
<p>       :</p><br>
<ul>
<li><strong>VLAN17</strong> –  172.20.1.0/24,       (IPMI, management)</li>
<li><strong>VLAN30</strong> –  172.16.1.0/24, «» ,   <strong>VyOS1</strong>, <strong>VyOS2</strong>  <strong>Provider-1</strong></li>
<li><strong>VLAN31</strong> –  172.16.2.0/24, «» ,   <strong>VyOS2</strong>, <strong>VyOS1</strong>  <strong>Provider-2</strong></li>
<li><strong>VLAN32</strong> –  172.20.32.0/23,       – PROD</li>
<li><strong>VLAN33</strong> –  172.20.133.0/24,      <strong>VyOS2</strong>, <strong>VyOS1</strong>  <strong>3850</strong></li>
<li><strong>VLAN34</strong> –  172.20.34.0/24,       – DEV</li>
<li><strong>VLAN35</strong> –  172.20.35.0/24,       – DMZ</li>
<li><strong>VLAN36</strong> –  172.16.10.8/30, «» P2P ,    <strong>Provider-1</strong>  <strong>Provider-3</strong></li>
<li><strong>VLAN37</strong> –  172.16.10.12/30, «» P2P ,    <strong>Provider-2</strong>  <strong>Provider-3</strong></li>
<li><strong>VLAN38</strong> –  172.16.3.0/24, «»    ,  </li>
<li><strong>VLAN40</strong> –  172.20.40.0/23,       – TEST- </li>
</ul><br>
<h3 id="podgotovitelnye-raboty"> </h3><br>
<p>   ,   oVirt       – VLAN33, VLAN34, VLAN35,      CentOS 7 x86/64 1810 Minimal (  ):</p><br>
<ol>
<li><strong>test-IM34</strong> – 1 Gb RAM, 1 CPU, 10 Gb HDD<br>
<ul>
<li>VLAN34, IP – 172.20.34.239/24, Gateway – 172.20.34.1</li>
</ul></li>
<li><strong>test-IM35</strong> – 1 Gb RAM, 1 CPU, 10 Gb HDD<br>
<ul>
<li>VLAN35, IP – 172.20.35.239/24, Gateway – 172.20.35.1</li>
</ul></li>
</ol><br>
<p>        ,    ,   IP   .</p><br>
<p>  VyOS          VLAN34  VLAN35,    vrrp  HAIP    .</p><br>
<div class="spoiler"><b class="spoiler_title"> VyOS1</b><div class="spoiler_text"><pre><code class="plaintext hljs">set interfaces ethernet eth5 address '172.20.34.253/24'<font></font>
set interfaces ethernet eth5 description 'VLAN34'<font></font>
<font></font>
set interfaces ethernet eth6 address '172.20.35.253/24'<font></font>
set interfaces ethernet eth6 description 'VLAN35'<font></font>
<font></font>
set high-availability vrrp group haip-4 vrid 40<font></font>
set high-availability vrrp group haip-4 interface eth5<font></font>
set high-availability vrrp group haip-4 virtual-address 172.20.34.1/24<font></font>
set high-availability vrrp group haip-4 priority '200'<font></font>
set high-availability vrrp group haip-4 authentication type 'plaintext-password'<font></font>
set high-availability vrrp group haip-4 authentication password 'b65495f9'<font></font>
set high-availability vrrp group haip-4 preempt 2<font></font>
set high-availability vrrp group haip-4 advertise-interval '1'<font></font>
<font></font>
set high-availability vrrp group haip-5 vrid 40<font></font>
set high-availability vrrp group haip-5 interface eth6<font></font>
set high-availability vrrp group haip-5 virtual-address 172.20.35.1/24<font></font>
set high-availability vrrp group haip-5 priority '200'<font></font>
set high-availability vrrp group haip-5 authentication type 'plaintext-password'<font></font>
set high-availability vrrp group haip-5 authentication password 'b65495f9'<font></font>
set high-availability vrrp group haip-5 preempt 2<font></font>
set high-availability vrrp group haip-5 advertise-interval '1'<font></font>
<font></font>
commit</code></pre></div></div><br>
<div class="spoiler"><b class="spoiler_title"> VyOS2</b><div class="spoiler_text"><pre><code class="plaintext hljs">set interfaces ethernet eth5 address '172.20.34.254/24'<font></font>
set interfaces ethernet eth5 description 'VLAN34'<font></font>
<font></font>
set interfaces ethernet eth6 address '172.20.35.254/24'<font></font>
set interfaces ethernet eth6 description 'VLAN35'<font></font>
<font></font>
set high-availability vrrp group haip-4 vrid 40<font></font>
set high-availability vrrp group haip-4 interface eth5<font></font>
set high-availability vrrp group haip-4 virtual-address 172.20.34.1/24<font></font>
set high-availability vrrp group haip-4 priority '199'<font></font>
set high-availability vrrp group haip-4 authentication type 'plaintext-password'<font></font>
set high-availability vrrp group haip-4 authentication password 'b65495f9'<font></font>
set high-availability vrrp group haip-4 preempt 2<font></font>
set high-availability vrrp group haip-4 advertise-interval '1'<font></font>
<font></font>
set high-availability vrrp group haip-5 vrid 40<font></font>
set high-availability vrrp group haip-5 interface eth6<font></font>
set high-availability vrrp group haip-5 virtual-address 172.20.35.1/24<font></font>
set high-availability vrrp group haip-5 priority '199'<font></font>
set high-availability vrrp group haip-5 authentication type 'plaintext-password'<font></font>
set high-availability vrrp group haip-5 authentication password 'b65495f9'<font></font>
set high-availability vrrp group haip-5 preempt 2<font></font>
set high-availability vrrp group haip-5 advertise-interval '1'<font></font>
<font></font>
commit</code></pre></div></div><br>
<h3 id="ustanovka-i-nastroyka-steka-kommutatorov-cisco-3850">     Cisco 3850</h3><br>
<p>    ,    Cisco 3850,    ,      – <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">WS-C3850-24T-E, 24 x 1 GE, 350 W no PoE, 4 x 1 GE, 2 x 10 GE</a>, :</p><br>
<ul>
<li>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">STACK-T1-50CM=</a>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><strong>StackWise</strong></a>,       480 /, </li>
<li>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">CAB-SPWR-30CM=</a>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><strong>StackPower</strong></a>,                   ,       ,   .</li>
</ul><br>
<p><strong>         Cisco 3850</strong></p><br>
<p><strong>1)</strong> <u>   ,      </u>.</p><br>
<p>    ,               <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><strong>StackWise</strong></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><strong>StackPower</strong></a>,        – <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Catalyst 3850 Switch Getting Started Guide</a>. </p><br>
<p> ,       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><strong>StackWise</strong></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><strong>StackPower</strong></a>   ,    :</p><br>
<ul>
<li> ()     ;</li>
<li>       .</li>
</ul><br>
<p>  ,         L3,     .      PBR (policy based routing),           <strong>IP Services</strong>.</p><br>
<div class="spoiler"><b class="spoiler_title">  ,     </b><div class="spoiler_text"><ul>
<li><strong>LAN Base</strong><br>
   ;<br>
 ;<br>
   :  ACL, 802.1x, DHCP snooping, DAI, IPSG;<br>
   : Ingress policing, AutoQoS, Trust Boundary, DSCP mapping.</li>
<li><strong>IP Base</strong><br>
    ;<br>
 ;<br>
   ;<br>
   ;<br>
Mobility controller  Flexible NetFlow (  3650/3850);<br>
StackPower  EEM.</li>
<li><strong>IP Services</strong><br>
    ;<br>
    (PBR, EIGRP, OSPF, BGP, VRF-lite  ..);<br>
   ;<br>
   ;<br>
Mobility controller  Flexible NetFlow (  3650/3850);<br>
StackPower, EEM, IPSLA.</li>
</ul></div></div><br>
<p><strong>2)</strong> <u>   3850       .</u></p><br>
<p>      ,    ,     :</p><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Software Configuration Guide, Cisco IOS XE Everest 16.6.x (Catalyst 3850 Switches)</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Command Reference, Cisco IOS XE Everest 16.6.x (Catalyst 3850 Switches)</a></li>
<li>   ,    – <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Command References</a></li>
</ul><br>
<p>        USB  RJ-45 ,        : <em>9600 baud</em>, <em>8 data bits</em>, <em>no parity</em>, <em>1 stop bit</em>, <em>no flow control</em>.<br>
     Windows,       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Putty</a>,   Linux,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">minicom</a>.</p><br>
<p>     ,     :</p><br>
<div class="spoiler"><b class="spoiler_title">   ,         </b><div class="spoiler_text"><pre><code class="plaintext hljs">sh ver | beg Switch Ports Model<font></font>
Switch  Ports   Model               SW Version          SW Image                    Mode<font></font>
------  -----           -----               ----------                  ----------                  ----<font></font>
*    1  32      WS-C3850-24T        16.6.7              CAT3K_CAA-UNIVERSALK9   INSTALL<font></font>
     2  32      WS-C3850-24T        16.6.7              CAT3K_CAA-UNIVERSALK9   INSTALL<font></font>
<font></font>
sh license right-to-use<font></font>
Slot#       License Name          Type   Period left<font></font>
----------------------------------------------------<font></font>
    1         ipservices     Permanent      Lifetime<font></font>
----------------------------------------------------<font></font>
License Level on Reboot: ipservices<font></font>
<font></font>
Slot#       License Name          Type   Period left<font></font>
----------------------------------------------------<font></font>
    2         ipservices     Permanent      Lifetime<font></font>
----------------------------------------------------<font></font>
License Level on Reboot: ipservices</code></pre></div></div><br>
<div class="spoiler"><b class="spoiler_title">    </b><div class="spoiler_text"><pre><code class="plaintext hljs">enable  <font></font>
 switch 1 priority 15<font></font>
 switch 2 priority 14<font></font>
<font></font>
conf t <font></font>
 hostname 3850-stack<font></font>
 no ip domain-lookup<font></font>
 no service pad<font></font>
 service timestamps debug datetime msec<font></font>
 service timestamps log datetime localtime show-timezone msec<font></font>
 no service password-encryption<font></font>
 service sequence-numbers<font></font>
 logging buffered 16384<font></font>
<font></font>
 stack-mac persistent timer 0<font></font>
 stack-power stack Powerstack-1<font></font>
 mode redundant<font></font>
<font></font>
 clock timezone MSK 3<font></font>
 vtp mode transparent<font></font>
 ip subnet-zero<font></font>
<font></font>
 spanning-tree mode rapid-pvst<font></font>
 spanning-tree etherchannel guard misconfig<font></font>
 spanning-tree extend system-id<font></font>
 spanning-tree vlan 1,17,30-40 root primary<font></font>
 spanning-tree loopguard default<font></font>
 port-channel load-balance src-dst-ip<font></font>
 errdisable recovery cause bpduguard<font></font>
 errdisable recovery cause loopback<font></font>
 errdisable recovery interval 60<font></font>
<font></font>
line con 0<font></font>
 session-timeout 60<font></font>
 exec-timeout 60 0<font></font>
 logging synchronous<font></font>
line vty 5 15<font></font>
 session-timeout 60<font></font>
 exec-timeout 60 0<font></font>
 logging synchronous<font></font>
<font></font>
 ip http server<font></font>
 ip http secure-server<font></font>
 exit<font></font>
<font></font>
wr mem<font></font>
reload</code></pre></div></div><br>
<div class="spoiler"><b class="spoiler_title">  ,   </b><div class="spoiler_text"><pre><code class="plaintext hljs">3850-stack&gt;enable<font></font>
3850-stack#show switch detail<font></font>
Switch/Stack Mac Address : b090.7ebd. - Local Mac Address<font></font>
Mac persistency wait time: Indefinite<font></font>
                                             H/W   Current<font></font>
Switch#   Role    Mac Address     Priority Version  State<font></font>
-------------------------------------------------------------------------------------<font></font>
*1       Active   b090.7ebd. 15     V02     Ready<font></font>
 2       Standby  b090.7ef3. 14     V02     Ready<font></font>
<font></font>
         Stack Port Status             Neighbors<font></font>
Switch#  Port 1     Port 2           Port 1   Port 2<font></font>
--------------------------------------------------------<font></font>
  1         OK         OK               2        2<font></font>
  2         OK         OK               1        1<font></font>
<font></font>
3850-stack#show switch stack-ring speed<font></font>
Stack Ring Speed        : 480G<font></font>
Stack Ring Configuration: Full<font></font>
Stack Ring Protocol     : StackWise<font></font>
<font></font>
3850-stack#show switch stack-ports<font></font>
Switch#   Port1     Port2<font></font>
----------------------------<font></font>
1         OK        OK<font></font>
2         OK        OK<font></font>
<font></font>
3850-stack#show switch neighbors<font></font>
  Switch #    Port 1       Port 2<font></font>
  --------    ------       ------<font></font>
      1         2             2<font></font>
      2         1             1<font></font>
<font></font>
3850-stack#show stack-power<font></font>
Power Stack           Stack   Stack    Total   Rsvd    Alloc   Sw_Avail   Num  Num<font></font>
Name                  Mode    Topolgy  Pwr(W)  Pwr(W)  Pwr(W)   Pwr(W)    SW   PS<font></font>
--------------------  ------  -------  ------  ------  ------  ------  ----- ----<font></font>
Powerstack-1          SP-R    Ring     1400    380     460     560       2    4<font></font>
<font></font>
3850-stack#show stack-power detail<font></font>
Power Stack           Stack   Stack    Total   Rsvd    Alloc   Sw_Avail   Num  Num<font></font>
Name                  Mode    Topolgy  Pwr(W)  Pwr(W)  Pwr(W)   Pwr(W)    SW   PS<font></font>
--------------------  ------  -------  ------  ------  ------  ------  ----- ----<font></font>
Powerstack-1          SP-R    Ring     1400    380     460     560       2    4<font></font>
<font></font>
Power stack name: Powerstack-1<font></font>
    Stack mode: Redundant<font></font>
    Stack topology: Ring<font></font>
    Switch 1:<font></font>
        Power budget: 230<font></font>
        Power allocated: 230<font></font>
        Low port priority value: 21<font></font>
        High port priority value: 12<font></font>
        Switch priority value: 3<font></font>
        Port 1 status: Connected<font></font>
        Port 2 status: Connected<font></font>
        Neighbor on port 1: Switch 2 - b090.7ef3.<font></font>
        Neighbor on port 2: Switch 2 - b090.7ef3.<font></font>
    Switch 2:<font></font>
        Power budget: 230<font></font>
        Power allocated: 230<font></font>
        Low port priority value: 22<font></font>
        High port priority value: 13<font></font>
        Switch priority value: 4<font></font>
        Port 1 status: Connected<font></font>
        Port 2 status: Connected<font></font>
        Neighbor on port 1: Switch 1 - b090.7ebd.<font></font>
        Neighbor on port 2: Switch 1 - b090.7ebd.<font></font>
<font></font>
3850-stack#show stack-power neighbors<font></font>
Power Stack           Stack   Stack    Total   Rsvd    Alloc   Sw_Avail   Num  Num<font></font>
Name                  Mode    Topolgy  Pwr(W)  Pwr(W)  Pwr(W)   Pwr(W)    SW   PS<font></font>
--------------------  ------  -------  ------  ------  ------  ------  ----- ----<font></font>
Powerstack-1          SP-R    Ring     1400    380     460     560       2    4<font></font>
    Power Stack           Port 1  Port 1             Port 2  Port 2<font></font>
SW  Name                  Status  Neighbor SW:MAC    Status  Neighbor SW:MAC<font></font>
--  --------------------  ------  ----------------   ------  ----------------<font></font>
1   Powerstack-1          Conn    2:b090.7ef3. Conn    2:b090.7ef3.<font></font>
2   Powerstack-1          Conn    1:b090.7ebd. Conn    1:b090.7ebd.<font></font>
<font></font>
3850-stack#sh env all<font></font>
Switch 1 FAN 1 is OK<font></font>
Switch 1 FAN 2 is OK<font></font>
Switch 1 FAN 3 is OK<font></font>
FAN PS-1 is OK<font></font>
FAN PS-2 is OK<font></font>
Switch 2 FAN 1 is OK<font></font>
Switch 2 FAN 2 is OK<font></font>
Switch 2 FAN 3 is OK<font></font>
FAN PS-1 is OK<font></font>
FAN PS-2 is OK<font></font>
Switch 1: SYSTEM TEMPERATURE is OK<font></font>
Inlet Temperature Value: 20 Degree Celsius<font></font>
Temperature State: GREEN<font></font>
Yellow Threshold : 46 Degree Celsius<font></font>
Red Threshold    : 56 Degree Celsius<font></font>
<font></font>
Hotspot Temperature Value: 39 Degree Celsius<font></font>
Temperature State: GREEN<font></font>
Yellow Threshold : 105 Degree Celsius<font></font>
Red Threshold    : 125 Degree Celsius<font></font>
Switch 2: SYSTEM TEMPERATURE is OK<font></font>
Inlet Temperature Value: 20 Degree Celsius<font></font>
Temperature State: GREEN<font></font>
Yellow Threshold : 46 Degree Celsius<font></font>
Red Threshold    : 56 Degree Celsius<font></font>
<font></font>
Hotspot Temperature Value: 38 Degree Celsius<font></font>
Temperature State: GREEN<font></font>
Yellow Threshold : 105 Degree Celsius<font></font>
Red Threshold    : 125 Degree Celsius<font></font>
SW  PID                            Serial#          Status         Sys Pwr      PoE Pwr     Watts<font></font>
--  ------------------             ----------        ----------     -------     -------     -----<font></font>
1A  PWR-C1-350WAC       ART2244F8  OK              Good       Good        350<font></font>
1B  PWR-C1-350WAC       ART2248FL  OK              Good       Good        350<font></font>
2A  PWR-C1-350WAC       ART2244F9  OK              Good       Good        350<font></font>
2B  PWR-C1-350WAC       ART2248FL  OK              Good       Good        350</code></pre></div></div><br>
<div class="spoiler"><b class="spoiler_title">   ,     -   VLAN',  ssh,  IP    ,  ..</b><div class="spoiler_text"><pre><code class="plaintext hljs">enable<font></font>
conf t<font></font>
vlan 17<font></font>
 name 172.20.1.0/24<font></font>
vlan 32<font></font>
 name 172.20.32.0/23<font></font>
vlan 33<font></font>
vlan 34<font></font>
 name 172.20.34.0/24<font></font>
vlan 35<font></font>
 name 172.20.35.0/24<font></font>
vlan 36<font></font>
vlan 37<font></font>
vlan 38<font></font>
vlan 39<font></font>
vlan 40<font></font>
 name 172.20.40.0/23<font></font>
<font></font>
interface Vlan1<font></font>
 no ip address<font></font>
 shutdown<font></font>
 exit<font></font>
<font></font>
interface vlan 17<font></font>
 ip address 172.20.1.2 255.255.255.0<font></font>
<font></font>
crypto key generate rsa<font></font>
<font></font>
ip ssh version 2<font></font>
ip ssh time-out 90<font></font>
<font></font>
line vty 0 4<font></font>
 session-timeout 60<font></font>
 exec-timeout 60 0<font></font>
 privilege level 15<font></font>
 logging synchronous<font></font>
 transport input ssh<font></font>
<font></font>
line vty 5 15<font></font>
 session-timeout 60<font></font>
 exec-timeout 60 0<font></font>
 privilege level 15<font></font>
 logging synchronous<font></font>
 transport input ssh<font></font>
snmp-server community Public RO<font></font>
snmp-server location Moscow, Russia<font></font>
<font></font>
aaa new-model<font></font>
aaa authentication login default local <font></font>
username cisco privilege 15 secret mysecretpassword<font></font>
<font></font>
enable secret myenablepassword<font></font>
service password-encryption<font></font>
<font></font>
ntp server 85.21.78.8 prefer<font></font>
ntp server 89.221.207.113<font></font>
ntp server 185.22.60.71<font></font>
ntp server 192.36.143.130<font></font>
ntp server 185.209.85.222<font></font>
<font></font>
exit<font></font>
wr mem</code></pre></div></div><br>
<p>     Cisco 3850     .</p><br>
<h3 id="podklyuchenie-steka-kommutatorov-cisco-2960rh-k-steku-cisco-3850">   Cisco 2960R   Cisco 3850</h3><br>
<p>     L2    Cisco 2960R   Cisco 3850,      -  ,    Etherchannel:</p><br>
<p><strong>2960X</strong> Gi1/0/42 &lt;-&gt; <strong>3850-stack</strong> Gi1/0/21<br>
<strong>2960X</strong> Gi2/0/42 &lt;-&gt; <strong>3850-stack</strong> Gi1/0/23<br>
<strong>2960X</strong> Gi1/0/44 &lt;-&gt; <strong>3850-stack</strong> Gi2/0/21<br>
<strong>2960X</strong> Gi2/0/44 &lt;-&gt; <strong>3850-stack</strong> Gi2/0/23</p><br>
<div class="spoiler"><b class="spoiler_title">  Etherchannel    Cisco 2960R</b><div class="spoiler_text"><pre><code class="plaintext hljs">enable<font></font>
conf t<font></font>
<font></font>
interface Port-channel 9<font></font>
 description Channel-&gt;3850-stack<font></font>
 switchport trunk allowed vlan 1,17,30-40<font></font>
 switchport mode trunk<font></font>
 spanning-tree link-type point-to-point<font></font>
<font></font>
interface GigabitEthernet1/0/44<font></font>
 shut<font></font>
 description Channel -&gt; 3850-stack Gi1/0/21<font></font>
 switchport trunk allowed vlan 1,17,30-40<font></font>
 switchport mode trunk<font></font>
 spanning-tree link-type point-to-point<font></font>
 channel-group 9 mode active<font></font>
<font></font>
interface GigabitEthernet1/0/48<font></font>
 shut<font></font>
 description Channel -&gt; 3850-stack Gi2/0/21<font></font>
 switchport trunk allowed vlan 1,17,30-40<font></font>
 switchport mode trunk<font></font>
 spanning-tree link-type point-to-point<font></font>
 channel-group 9 mode active<font></font>
<font></font>
interface GigabitEthernet2/0/44<font></font>
 shut<font></font>
 description Channel -&gt; 3850-stack Gi1/0/23<font></font>
 switchport trunk allowed vlan 1,17,30-40<font></font>
 switchport mode trunk<font></font>
 spanning-tree link-type point-to-point<font></font>
 channel-group 9 mode active<font></font>
<font></font>
interface GigabitEthernet2/0/48<font></font>
 shut<font></font>
 description Channel -&gt; 3850-stack Gi2/0/23<font></font>
 switchport trunk allowed vlan 1,17,30-40<font></font>
 switchport mode trunk<font></font>
 spanning-tree link-type point-to-point<font></font>
 channel-group 9 mode active<font></font>
<font></font>
exit<font></font>
wr mem</code></pre></div></div><br>
<div class="spoiler"><b class="spoiler_title">  Etherchannel    Cisco 3850</b><div class="spoiler_text"><pre><code class="plaintext hljs">enable<font></font>
conf t<font></font>
<font></font>
interface Port-channel 2<font></font>
 description Channel -&gt; 2960X-stack1<font></font>
 switchport trunk allowed vlan 1,17,30-40<font></font>
 switchport mode trunk<font></font>
 spanning-tree link-type point-to-point<font></font>
<font></font>
interface GigabitEthernet1/0/21<font></font>
 description Channel -&gt; 2960X-stack1 Gi1/0/44 <font></font>
 switchport trunk allowed vlan 1,17,30-40<font></font>
 switchport mode trunk<font></font>
 channel-group 2 mode active<font></font>
 no shut<font></font>
<font></font>
interface GigabitEthernet1/0/23<font></font>
 description Channel -&gt; 2960X-stack1 Gi2/0/44<font></font>
 switchport trunk allowed vlan 1,17,30-40<font></font>
 switchport mode trunk<font></font>
 channel-group 2 mode active<font></font>
 no shut<font></font>
<font></font>
interface GigabitEthernet2/0/21<font></font>
 description Channel -&gt; 2960X-stack1 Gi1/0/48<font></font>
 switchport trunk allowed vlan 1,17,30-40<font></font>
 switchport mode trunk<font></font>
 channel-group 2 mode active<font></font>
 no shut<font></font>
<font></font>
interface GigabitEthernet2/0/23<font></font>
 description Channel -&gt; 2960X-stack1 Gi2/0/48<font></font>
 switchport trunk allowed vlan 1,17,30-40<font></font>
 switchport mode trunk<font></font>
 channel-group 2 mode active<font></font>
 no shut<font></font>
<font></font>
exit<font></font>
wr mem</code></pre></div></div><br>
<div class="spoiler"><b class="spoiler_title">,   Etherchannel   2960  3850-stack</b><div class="spoiler_text"><pre><code class="plaintext hljs">3850-stack#sh etherchannel summary | beg Po2<font></font>
Flags:  D - down        P - bundled in port-channel<font></font>
        I - stand-alone s - suspended<font></font>
        H - Hot-standby (LACP only)<font></font>
        R - Layer3      S - Layer2<font></font>
        U - in use      f - failed to allocate aggregator<font></font>
        M - not in use, minimum links not met<font></font>
        u - unsuitable for bundling<font></font>
        w - waiting to be aggregated<font></font>
        d - default port<font></font>
        A - formed by Auto LAG<font></font>
2      Po2(SU)         LACP      Gi1/0/21(P) Gi1/0/23(P) Gi2/0/21(P)<font></font>
                                 Gi2/0/23(P)<font></font>
<font></font>
3850-stack#show lacp internal | beg Channel group 2<font></font>
Flags:  S - Device is requesting Slow LACPDUs<font></font>
        F - Device is requesting Fast LACPDUs<font></font>
        A - Device is in Active mode       P - Device is in Passive mode<font></font>
Channel group 2<font></font>
                            LACP port     Admin     Oper    Port        Port<font></font>
Port      Flags   State     Priority      Key       Key     Number      State<font></font>
Gi1/0/21  SA      bndl      32768         0x2       0x2     0x116       0x3D<font></font>
Gi1/0/23  SA      bndl      32768         0x2       0x2     0x118       0x3D<font></font>
Gi2/0/21  SA      bndl      32768         0x2       0x2     0x216       0x3D<font></font>
Gi2/0/23  SA      bndl      32768         0x2       0x2     0x218       0x3D</code></pre></div></div><br>
<p>  - ,       :</p><br>
<pre><code class="plaintext hljs">sh logging</code></pre><br>
<p> ,   Etherchanel  ,  Cisco 3850   , ,    VyOS  IP  172.20.1.2  <strong>ssh</strong>.</p><br>
<h3 id="principy-nastroyki-marshrutizacii-mezhdu-vnutrennimi-i-vneshnimi-setyami">       </h3><br>
<p>       ,       .</p><br>
<p><strong> 1</strong></p><br>
<p>   <u>destination-based</u> , ..   ,    ,          3- .      (   )       ,     .</p><br>
<p>         VyOS:</p><br>
<ul>
<li>    ,</li>
<li>   VyOS   ,      ,        Cisco 3850. </li>
</ul><br>
<p>       ,       ,   .       ,           -   VyOS.</p><br>
<p><strong> 2</strong></p><br>
<p>    <u>source-based</u> , ..   ,    ,          ,      ,     .   VyOS     ,         Cisco 3850   <strong>PBR</strong> (policy based routing).    ,        Cisco 3850,            VyOS.</p><br>
<h3 id="organizaciya-marshrutizacii-mezhdu-vnutrennimi-i-vneshnimi-setyami-s-ispolzovaniem-pbr-policy-based-routing">         PBR (policy based routing)</h3><br>
<p>   :</p><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Chapter: Configuring IP Unicast Routing </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Protocol-Independent Features</a> </li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Policy-Based Routing</a> </li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">IP Routing: Protocol-Independent Configuration Guide, Cisco IOS XE Everest 16.5</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Chapter: Policy-Based Routing</a></li>
</ul><br>
<div class="spoiler"><b class="spoiler_title">    VLAN'   Cisco 3850,    SVI (Switch Virtual Interface)</b><div class="spoiler_text"><pre><code class="plaintext hljs">enable<font></font>
conf t<font></font>
<font></font>
ip routing<font></font>
<font></font>
interface Vlan17<font></font>
 ip address 172.20.1.2 255.255.255.0<font></font>
<font></font>
interface Vlan32<font></font>
 ip address 172.20.32.2 255.255.254.0<font></font>
<font></font>
interface Vlan34<font></font>
 ip address 172.20.34.2 255.255.255.0<font></font>
<font></font>
interface Vlan35<font></font>
 ip address 172.20.35.2 255.255.255.0<font></font>
<font></font>
interface Vlan40<font></font>
 ip address 172.20.40.2 255.255.254.0<font></font>
<font></font>
exit<font></font>
wr mem</code></pre></div></div><br>
<p>       ,        SVI,          .               ,        PBR (policy-based routing). </p><br>
<div class="spoiler"><b class="spoiler_title">Disclaimer</b><div class="spoiler_text"><p>PBR    ,    ,          ,          3850  .         ,  ,    3850,    ,     PBR,  :</p><br>
<ul>
<li>       3850,      VyOS   ;</li>
<li>     3850          VyOS,      HAIP   vrrp.</li>
</ul><br>
<p> :</p><br>
<ul>
<li>        ,          PBR   ;</li>
<li>    ,      , - overhead'                 .</li>
<li>  ,                ,      ;</li>
<li>-  ,      ,    .</li>
</ul><br>
<p><u>      ,    </u></p></div></div><br>
<p>    disclaimer'   ,           ,    PBR   3850.   ,      ,  ,          OSPF.</p><br>
<div class="spoiler"><b class="spoiler_title"> PBR  Cisco 3850,      </b><div class="spoiler_text"><pre><code class="plaintext hljs">enable<font></font>
conf t<font></font>
<font></font>
ip access-list extended Access_to_External<font></font>
 permit ip any 0.0.0.0 127.255.255.255<font></font>
 permit ip any 128.0.0.0 31.255.255.255<font></font>
 permit ip any 160.0.0.0 7.255.255.255<font></font>
 permit ip any 168.0.0.0 3.255.255.255<font></font>
 permit ip any 172.0.0.0 0.15.255.255<font></font>
 permit ip any 172.16.0.0 0.3.255.255<font></font>
 permit ip any 172.20.0.0 0.0.0.255<font></font>
 permit ip any 172.20.2.0 0.0.1.255<font></font>
 permit ip any 172.20.4.0 0.0.3.255<font></font>
 permit ip any 172.20.8.0 0.0.7.255<font></font>
 permit ip any 172.20.16.0 0.0.15.255<font></font>
 permit ip any 172.20.36.0 0.0.3.255<font></font>
 permit ip any 172.20.42.0 0.0.1.255<font></font>
 permit ip any 172.20.44.0 0.0.3.255<font></font>
 permit ip any 172.20.48.0 0.0.15.255<font></font>
 permit ip any 172.20.64.0 0.0.63.255<font></font>
 permit ip any 172.20.128.0 0.0.127.255<font></font>
 permit ip any 172.21.0.0 0.0.255.255<font></font>
 permit ip any 172.22.0.0 0.1.255.255<font></font>
 permit ip any 172.24.0.0 0.7.255.255<font></font>
 permit ip any 172.32.0.0 0.31.255.255<font></font>
 permit ip any 172.64.0.0 0.63.255.255<font></font>
 permit ip any 172.128.0.0 0.127.255.255<font></font>
 permit ip any 173.0.0.0 0.255.255.255<font></font>
 permit ip any 174.0.0.0 1.255.255.255<font></font>
 permit ip any 176.0.0.0 15.255.255.255<font></font>
 permit ip any 192.0.0.0 31.255.255.255<font></font>
<font></font>
route-map VLAN17PBR permit 10<font></font>
 match ip address Access_to_External<font></font>
 set ip next-hop 172.20.1.1<font></font>
<font></font>
route-map VLAN32PBR permit 10<font></font>
 match ip address Access_to_External<font></font>
 set ip next-hop 172.20.32.1<font></font>
<font></font>
route-map VLAN34PBR permit 10<font></font>
 match ip address Access_to_External<font></font>
 set ip next-hop 172.20.34.1<font></font>
<font></font>
route-map VLAN35PBR permit 10<font></font>
 match ip address Access_to_External<font></font>
 set ip next-hop 172.20.35.1<font></font>
<font></font>
route-map VLAN40PBR permit 10<font></font>
 match ip address Access_to_External<font></font>
 set ip next-hop 172.20.40.1<font></font>
<font></font>
interface Vlan17<font></font>
 ip policy route-map VLAN17PBR<font></font>
 ip route-cache policy<font></font>
<font></font>
interface Vlan32<font></font>
 ip policy route-map VLAN32PBR<font></font>
 ip route-cache policy<font></font>
<font></font>
interface Vlan34<font></font>
 ip policy route-map VLAN34PBR<font></font>
 ip route-cache policy<font></font>
<font></font>
interface Vlan35<font></font>
 ip policy route-map VLAN35PBR<font></font>
 ip route-cache policy<font></font>
<font></font>
interface Vlan40<font></font>
 ip policy route-map VLAN40PBR<font></font>
 ip route-cache policy<font></font>
<font></font>
exit<font></font>
wr mem</code></pre></div></div><br>
<p> ,    <strong>Access_to_External</strong>,    :</p><br>
<pre><code class="plaintext hljs">172.20.1.0/24<font></font>
172.20.32.0/23 <font></font>
172.20.34.0/24 <font></font>
172.20.35.0/24 <font></font>
172.20.40.0/23</code></pre><br>
<p>,            SVI,          ,                . </p><br>
<p> ,       ,      ,            SVI  Cisco 3850,        ,     .</p><br>
<p> ,       Cisco 3850,       ,     ,          ACL, PBR, QoS  .,      :</p><br>
<pre><code class="plaintext hljs">3850-stack#show platform hardware fed switch active fwd-asic resource tcam utilization<font></font>
CAM Utilization for ASIC  [0]<font></font>
 Table                                              Max Values        Used Values<font></font>
 --------------------------------------------------------------------------------<font></font>
 Unicast MAC addresses                              32768/512         429/22<font></font>
 L3 Multicast entries                               4096/512           0/7<font></font>
 L2 Multicast entries                               4096/512           0/9<font></font>
 Directly or indirectly connected routes            16384/7168        477/23<font></font>
 QoS Access Control Entries                         2560                86<font></font>
 Security Access Control Entries                    3072               133<font></font>
 Netflow ACEs                                        768                15<font></font>
 Policy Based Routing ACEs                          1024               134<font></font>
 Flow SPAN ACEs                                      512                 5<font></font>
 Output Flow SPAN ACEs                               512                 8<font></font>
 Control Plane Entries                               512               208<font></font>
 Tunnels                                             256                17<font></font>
 Lisp Instance Mapping Entries                       256                 3<font></font>
 Input Security Associations                         256                 4<font></font>
 Output Security Associations and Policies           256                 5<font></font>
 SGT_DGT                                            4096/512           0/1<font></font>
 CLIENT_LE                                          4096/256           0/0<font></font>
 INPUT_GROUP_LE                                     6144                 0<font></font>
 OUTPUT_GROUP_LE                                    6144                 0<font></font>
 Macsec SPD                                          256                 2</code></pre><br>
<p>           L3, ..         ACL   SVI (),    PBR,    SVI.  ,     :</p><br>
<pre><code class="plaintext hljs">sh processes | inc CPU<font></font>
sh processes cpu sort | exclude 0.00<font></font>
sh processes cpu history<font></font>
sh ip route summary<font></font>
sh memory summary<font></font>
sh route-map  (       ,   )</code></pre><br>
<p>     ,   , ,       ,        – <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Troubleshooting TechNotes</a>.</p><br>
<p>    ,       Cisco 3850,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Zabbix</a>.          .</p><br>
<h3 id="perevod-vnutrenney-mezhsetevoy-marshrutizacii-s-vyosov-na-stek-cisco-3850">     VyOS'   Cisco 3850</h3><br>
<p> ,      ,      ,      ,             172.20..1   172.20..2 –    ,            .</p><br>
<p>        ,   ,         , , , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Ansible</a>,           <strong>ssh</strong>.</p><br>
<p>     ,   IP   SVI  isco 3850  HAIP ,       VyOS.</p><br>
<p>      isco 3850,        ,     IP    VLAN 17, 32, 34, 35, 40 ( 172.20.1.1, 172.20.32.1, 172.20.34.1, 172.20.35.1, 172.20.40.1)   VyOS  isco 3850.<br>
,  172.20.1.2, 172.20.32.2, 172.20.34.2, 172.20.35.2, 172.20.40.2  isco 3850      VyOS.</p><br>
<p>  ,       – 172.20.1.0/24,  VLAN 17,           .</p><br>
<p>,   IP   172.20.1.1  VyOS  isco 3850,  VLAN17.</p><br>
<div class="spoiler"><b class="spoiler_title">  3850</b><div class="spoiler_text"><pre><code class="plaintext hljs">en <font></font>
conf t<font></font>
interface Vlan17<font></font>
 no ip address 172.20.1.2 255.255.255.0<font></font>
 no ip route-cache policy<font></font>
 no ip policy route-map VLAN17PBR<font></font>
 shut<font></font>
 exit<font></font>
<font></font>
 no route-map VLAN17PBR</code></pre></div></div><br>
<div class="spoiler"><b class="spoiler_title">  VyOS1/2</b><div class="spoiler_text"><pre><code class="plaintext hljs">configure<font></font>
 delete high-availability vrrp group haip-1 virtual-address '172.20.1.1/24'<font></font>
 set high-availability vrrp group haip-1 virtual-address '172.20.1.2/24'<font></font>
 commit </code></pre></div></div><br>
<div class="spoiler"><b class="spoiler_title">  3850</b><div class="spoiler_text"><pre><code class="plaintext hljs">route-map VLAN17PBR permit 10<font></font>
 match ip address Access_to_External<font></font>
 set ip next-hop 172.20.1.2<font></font>
<font></font>
interface Vlan17<font></font>
 ip address 172.20.1.1 255.255.255.0<font></font>
 ip route-cache policy<font></font>
 ip policy route-map VLAN17PBR<font></font>
 no shut<font></font>
 exit<font></font>
wr mem</code></pre></div></div><br>
<p>  ,      ,    10-15      VLAN 17,     172.20.1.1,      isco 3850.</p><br>
<p>       – 172.20.32.2, 172.20.34.2, 172.20.35.2  172.20.40.2  isco 3850,   VyOS.  ,    ,       ,     – isco 3850.  ,   ,          –   isco 3850,   VyOS   ,          .        ,  - ,   ,   .</p><br>
<p>          isco 3850   ,  ,     ,         VyOS,       ,       172.20.1.0/24  VLAN 17:</p><br>
<div class="spoiler"><b class="spoiler_title"> VyOS1/2</b><div class="spoiler_text"><pre><code class="plaintext hljs">configure<font></font>
 delete high-availability vrrp group haip-1 virtual-address '172.20.1.2/24'<font></font>
 set high-availability vrrp group haip-1 virtual-address '172.20.1.1/24'<font></font>
 commit </code></pre></div></div><br>
<p> ,         VyOS,      ,          isco 3850.</p><br>
<h3 id="zaklyuchenie"></h3><br>
<p>          ,   –           ,     -  .            . ,      - , ,   ,  ,    ,       ,      . </p><br>
<p>,        4  ( )  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Vmware vSphere Enterprise Plus</a>,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Vcenter Server Standard</a>,  4  ( )        – <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Veeam B&amp;R Enterprise</a>.    ,      , ,     ,         ,    44.000 USD  VMware  10.000 USD  Veeam (       ). </p><br>
<p>  ,              ,   , ,            (   ,      ). </p><br>
<p>,      ,      IT      –            ,     .   ,       ,      ,      . </p><br>
<p>        IT ,      oVirt,             :</p><br>
<ul>
<li> –           ,   ,              ;</li>
<li>    <strong><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">DevOps</a></strong>,   <strong>Iaa</strong> (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Infrastructure as a Code</a>) –       ,       ,   Docker Swarm, -,    ,   ..,          .</li>
</ul><br>
<p>          ,    ,      ,                    . <strong>Iaa</strong>        ,        ,     .</p><br>
<p>oVirt/RHEV     <strong>Iaa</strong>,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">  Terraform</a>,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">  Ansible</a>.<br>
         , ,      <strong>Terraform</strong>  <strong>Ansible</strong>,    <strong><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Cobbler</a></strong>,      .</p><br>
<p>           IT , , ,    -  ,       ..</p><br>
<p> , ,          <strong>DevOps</strong>,    <strong>Iaa</strong>,          oVirt / VMware vSphere.</p><br>
<p><strong>P.S.</strong><br>
  - ,     ,     .</p><br>
<p><strong></strong></p><br>
<p>    ,  ,  <u>  /  </u>  PBR  Cisco 3850      (.. <strong>source-based</strong> ),   ""   ,   <strong>destination-based</strong> . </p><br>
<p>      ,    ,     ,      :</p><br>
<ul>
<li>       VyOS   ;</li>
<li>   Cisco 3850      ,     PBR.</li>
</ul><br>
<h3 id="organizaciya-marshrutizacii-mezhdu-vnutrennimi-i-vneshnimi-setyami-s-ispolzovaniem-ospf">         OSPF</h3><br>
<div class="spoiler"><b class="spoiler_title">  </b><div class="spoiler_text"><p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><img src="https://habrastorage.org/webt/fm/0j/z7/fm0jz7e8iy8fnkrpoyyelbvzk4w.jpeg"><br>
</a></p></div></div><br>
<p><u> Cisco 3850</u></p><br>
<p>  – <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Chapter: Configuring IP Unicast Routing</a></p><br>
<p>         PBR, :</p><br>
<ul>
<li>  route-map'  : <strong>VLAN17</strong>, <strong>VLAN32</strong>, <strong>VLAN34</strong>, <strong>VLAN35</strong>, <strong>VLAN40</strong></li>
<li> route-map': <strong>VLAN17PBR</strong>, <strong>VLAN32PBR</strong>, <strong>VLAN34PBR</strong>, <strong>VLAN35PBR</strong>, <strong>VLAN40PBR</strong></li>
<li> access-list <strong>Access_to_External</strong></li>
<li>    VyOS   OSPF,    <strong>VLAN33</strong>,       .</li>
</ul><br>
<div class="spoiler"><b class="spoiler_title"> Cisco 3850</b><div class="spoiler_text"><pre><code class="plaintext hljs">interface Vlan33<font></font>
 ip address 172.20.133.1 255.255.255.0<font></font>
 ip ospf dead-interval 4<font></font>
 ip ospf hello-interval 1<font></font>
 ip ospf priority 100<font></font>
<font></font>
interface Loopback0<font></font>
 ip address 10.1.1.3 255.255.255.255<font></font>
<font></font>
router ospf 1<font></font>
 router-id 10.1.1.3<font></font>
 network 10.1.1.3 255.255.255.255 area 0.0.0.0<font></font>
 network 172.20.133.0 0.0.0.255 area 0.0.0.0<font></font>
 network 172.20.1.0 0.0.0.255 area 0.0.0.0<font></font>
 network 172.20.32.0 0.0.1.255 area 0.0.0.0<font></font>
 network 172.20.34.0 0.0.0.255 area 0.0.0.0<font></font>
 network 172.20.35.0 0.0.0.255 area 0.0.0.0<font></font>
 network 172.20.40.0 0.0.1.255 area 0.0.0.0<font></font>
 log-adjacency-changes<font></font>
 passive-interface default<font></font>
 no passive-interface Vlan33</code></pre></div></div><br>
<p><u>  VyOS</u></p><br>
<p>  — <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> OSPF  VyOS</a></p><br>
<p>          Cisco 3850     PBR, :</p><br>
<ul>
<li>  vrrp   ;</li>
<li>      ,    <strong>VLAN32</strong>, <strong>VLAN34</strong>, <strong>VLAN35</strong>, <strong>VLAN40</strong>;</li>
<li>   : <strong>VLAN17</strong>, <strong>VLAN32</strong>, <strong>VLAN34</strong>, <strong>VLAN35</strong>, <strong>VLAN40</strong>;</li>
<li>          oVirt;</li>
<li>   Cisco 3850   OSPF,   <strong>eth0</strong>,      <strong>VLAN33</strong>,       .</li>
</ul><br>
<div class="spoiler"><b class="spoiler_title"> VyOS1</b><div class="spoiler_text"><pre><code class="plaintext hljs">set interfaces loopback lo address '10.1.1.1/32'<font></font>
<font></font>
set interfaces ethernet eth0 address '172.20.133.253/24'<font></font>
set interfaces ethernet eth0 description 'VLAN33'<font></font>
set interfaces ethernet eth0 ip ospf dead-interval '4'<font></font>
set interfaces ethernet eth0 ip ospf hello-interval '1'<font></font>
set interfaces ethernet eth0 ip ospf priority '1'<font></font>
set interfaces ethernet eth0 ip ospf retransmit-interval '5'<font></font>
set interfaces ethernet eth0 ip ospf transmit-delay '1'<font></font>
<font></font>
set protocols ospf area 0.0.0.0 network '172.20.133.0/24'<font></font>
set protocols ospf area 0.0.0.0 network '10.1.1.1/32'<font></font>
set protocols ospf default-information originate metric '10'<font></font>
set protocols ospf default-information originate metric-type '2'<font></font>
set protocols ospf log-adjacency-changes<font></font>
set protocols ospf neighbor 172.20.133.1 poll-interval '5'<font></font>
set protocols ospf neighbor 172.20.133.1 priority '1'<font></font>
set protocols ospf parameters abr-type 'cisco'<font></font>
set protocols ospf parameters router-id '10.1.1.1'<font></font>
set protocols ospf passive-interface 'default'<font></font>
set protocols ospf passive-interface-exclude 'eth0'<font></font>
set protocols ospf redistribute static metric '5'<font></font>
set protocols ospf redistribute static metric-type '2'</code></pre></div></div><br>
<div class="spoiler"><b class="spoiler_title"> VyOS2</b><div class="spoiler_text"><pre><code class="plaintext hljs">set interfaces loopback lo address '10.1.1.2/32'<font></font>
<font></font>
set interfaces ethernet eth0 address '172.20.133.254/24'<font></font>
set interfaces ethernet eth0 description 'VLAN33'<font></font>
set interfaces ethernet eth0 ip ospf dead-interval '4'<font></font>
set interfaces ethernet eth0 ip ospf hello-interval '1'<font></font>
set interfaces ethernet eth0 ip ospf priority '1'<font></font>
set interfaces ethernet eth0 ip ospf retransmit-interval '5'<font></font>
set interfaces ethernet eth0 ip ospf transmit-delay '1'<font></font>
<font></font>
set protocols ospf area 0.0.0.0 network '172.20.133.0/24'<font></font>
set protocols ospf area 0.0.0.0 network '10.1.1.2/32'<font></font>
set protocols ospf default-information originate metric '20'<font></font>
set protocols ospf default-information originate metric-type '2'<font></font>
set protocols ospf log-adjacency-changes<font></font>
set protocols ospf neighbor 172.20.133.1 poll-interval '5'<font></font>
set protocols ospf neighbor 172.20.133.1 priority '1'<font></font>
set protocols ospf parameters abr-type 'cisco'<font></font>
set protocols ospf parameters router-id '10.1.1.2'<font></font>
set protocols ospf passive-interface 'default'<font></font>
set protocols ospf passive-interface-exclude 'eth0'<font></font>
set protocols ospf redistribute static metric '10'<font></font>
set protocols ospf redistribute static metric-type '1'</code></pre></div></div><br>
<p>     OSPF,    :</p><br>
<pre><code class="plaintext hljs">sh ip ospf interface<font></font>
sh ip ospf neighbor<font></font>
show ip ospf<font></font>
show ip route<font></font>
show ip route ospf</code></pre></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja489326/index.html">効果的なエンタープライズテストに関する考察</a></li>
<li><a href="../ja489328/index.html">Nullスニーク：Javaを使用したScalaオプションの破壊</a></li>
<li><a href="../ja489332/index.html">世界で最も効果的なインテリジェンスサービスのインテリジェンスに欠かせないアシスタント（パート3）</a></li>
<li><a href="../ja489336/index.html">インターフェイスバイク有毒な祖父。「学び、学び、そして再び学びなさい」（s1 e3）</a></li>
<li><a href="../ja489340/index.html">インターネット上で情報を送信する最大単位が1500バイトになったため</a></li>
<li><a href="../ja489344/index.html">跡を残さない</a></li>
<li><a href="../ja489352/index.html">ドメイン駆動設計について10分で何を学ぶことができますか？</a></li>
<li><a href="../ja489354/index.html">IdentityServer4。基本概念。OpenID Connect、OAuth 2.0、JWT</a></li>
<li><a href="../ja489356/index.html">AWS、Azure、GitlabのCI / CD。OTUSからの新しいコース</a></li>
<li><a href="../ja489360/index.html">最新のプログラミング言語でのメモリ管理について</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>