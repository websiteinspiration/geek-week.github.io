<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§±üèΩ üö∂üèø üë®‚Äç‚öñÔ∏è IDA Pro und Reverse Engineering-Techniken üìê üêØ ‚úä</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="0x00 starten
 

; {EN} entry point, do nothing, just run _main {EN}
 

Ein Artikel f√ºr Anf√§nger von ‚ÄûKriegern der Dunkelheit‚Äú, die in die dunkle Seite...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>IDA Pro und Reverse Engineering-Techniken</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/inforion/blog/493416/"><h2 id="0x00-start"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x00 starten</font></font></h2><br>
<p><code>; {EN} entry point, do nothing, just run _main {EN}</code></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ein Artikel f√ºr Anf√§nger von ‚ÄûKriegern der Dunkelheit‚Äú, die in die dunkle Seite der Macht eintauchen wollen: Reverse Engineering. </font><font style="vertical-align: inherit;">Auf unserem ‚ÄûOperationstisch‚Äú befindet sich ein kleiner handwerklicher Server, der √ºber TCP / IP ausgef√ºhrt wird. </font><font style="vertical-align: inherit;">Bei der Analyse des Datenaustauschprotokolls wird uns der De-facto-Standard im Bereich Reverse-IDA Pro helfen.</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es wurden bereits viele Artikel √ºber Reverse Engineering und IDA Pro geschrieben (obwohl nicht so sehr wie √ºber PHP), aber da der Reverse-Prozess Forschung ist, ist die Idee, wie man die Reverse-Entwicklungsaufgabe von der ‚Äûanderen Seite‚Äú aus angeht, f√ºr Anf√§nger n√ºtzlich. </font><font style="vertical-align: inherit;">Zumindest als Autor lie√ü ich mich von der Idee leiten, allen Praktikanten und den ersten Paaren des Reverse Engineering-Kurses an der Universit√§t die grundlegenden Praktiken und Techniken zu erl√§utern, √ºber die ich in den fr√ºhen Tagen gesprochen habe.</font></font></p><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Was wird nicht in dem Artikel sein?</font></font></b><div class="spoiler_text"><p>      Google Chrome  Apple iPhone‚Ä¶           CVE  , ,      - . </p></div></div><br>
<p><img src="https://habrastorage.org/webt/6t/km/_2/6tkm_2r_gulckeqjxzls8ah3g-w.jpeg"><br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Sobald du den dunklen Pfad entlang gehst, wird er f√ºr immer dein Schicksal dominieren."</font></font></em></p><a name="habracut"></a><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Betreff: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">crackme</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font><strong><font style="vertical-align: inherit;">keine Bin√§rdateien auf dem </font></strong><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">Hauptsystem </font></a></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ausf√ºhren, dies ist besser auf einer virtuellen Maschine!</font></font></strong></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Systemanforderungen: Virtuelle Maschine mit installiertem Windows 7 / 0xA</font></font></p><br>
<h3 id="0x01-mov-eax-ds__stack_chk_guard"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x01 mov eax, ds: __ stack_chk_guard</font></font></h3><br>
<p><code>; {EN} Disclaimer {EN}</code></p><br>
<p>      , ,  x86,    ,   (),   ..        .     ,      .</p><br>
<p><img src="https://habrastorage.org/webt/pr/lw/bo/prlwbor_myuddgm_4d249est5q0.jpeg"></p><br>
<h2 id="0x10-chto-nam-nuzhno-chtoby-ponyat-o-chyom-poydet-rech">0x10   ,      ?</h2><br>
<p><code>; {EN} Setups prerequisites for the consequent execution {EN}</code></p><br>
<p>     , ,   :</p><br>
<ul>
<li>  C  C++;</li>
<li>   x86;</li>
<li>     (PE, ELF);</li>
<li>   ,  ‚Äî ;</li>
<li>   ;</li>
<li><del> </del>;</li>
<li><del>  </del>.</li>
</ul><br>
<p> <strong></strong>,    ‚Äî  IDA Pro   Hex-Rays (  ,  ‚Äú ‚Äù   ‚Äú‚Äù,  ,       ‚Äú  ‚Äù,       ).       ,    -,      ,  :    (  IDA ‚Äî  )     x86.</p><br>
<p><strong></strong>,    ‚Äî .     (  ,      *.exe  Windows),    ,    .     ,  ,      x86  (        x64 ‚Äî    ).</p><br>
<p><strong></strong> ‚Äî  ,       x86 (assembler language).</p><br>
<p><img src="https://habrastorage.org/webt/gr/k6/jk/grk6jk1e6xopgtwpvfjly_sugim.jpeg"></p><br>
<p>       ,      x86:  (<strong>mov</strong>, <strong>lea</strong>, <strong>push</strong>/<strong>pop</strong>, <strong>call</strong>, <strong>jmp</strong>,    ),     .    ,      , :</p><br>
<ul>
<li>,  : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">.  2011</a> (  ,    90-);</li>
<li>  ,  : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Guide to x86 Assembly</a>;</li>
<li>,      ,  : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">A Guide To x86 Assembly</a>.</li>
</ul><br>
<p> ,    .       10 ,    .      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="></a>         ().</p><br>
<p><strong><em> .</em></strong> <em> ,       ,  ,     regexp ( ) ‚Äî    ,     .    ,        .</em></p><br>
<p><strong></strong> ‚Äî 30   (,  , 30 )   .</p><br>
<h2 id="0x20-minutka-filosofii-ili-chto-takoe-ida-pro-i-pochemu">0x20      IDA Pro  ?</h2><br>
<p><code>; {EN} Whatta hell? {EN}</code></p><br>
<p><img src="https://habrastorage.org/webt/ln/2x/ls/ln2xlsujoswxw2kkvd8chq_mjg0.jpeg"></p><br>
<blockquote>- (  ) ‚Äî ‚Äú     ,  -   ‚Ä¶ , - ‚Äî  ( ),    ,    ,     ,  - ‚Äù ‚Äî Reversing: Secrets of Reverse Engineering, Eldad Eilam.</blockquote><p>      ?   ,      . ,     IDA? IDA ‚Äî ,    ‚Äú ‚Äú.         ‚Äú‚Äù.  ,           ,  -,      ,       ,      ‚Äú  ‚Äù,       .          IDE ‚Äî     ,   ,  ‚Äî   ..     ‚Äî                 .   IDA Pro      ,          .</p><br>
<p>   ,          <del>    </del>,           . -       ,     ‚Äî radare2 (     r2,   Cutter   ,   IDA Pro).  , IDA Pro           Python  API  .</p><br>
<p> -,       ,   ,      100%            . ,    - ,    IDA Pro!      .</p><br>
<p><img src="https://habrastorage.org/webt/dh/u4/64/dhu4649l7k5lo8m3xgklfy9gcao.jpeg"></p><br>
<h2 id="0x30-smotrim-na-ida-pro-i-poznaem-osnovy-eyo-interfeysa">0x30   IDA Pro     </h2><br>
<pre><code class="plaintext hljs">; {EN}<font></font>
; This function is too complex.<font></font>
; Perhaps it interacts with user.<font></font>
; But currently I am not sure about it.<font></font>
; A lot of calls to Qt-framework.<font></font>
; {EN}</code></pre><br>
<h3 id="0x31-zagruzka-binarnika-v-ida-pro">0x31    IDA Pro</h3><br>
<p> IDA Pro.       (    ),    . ,   , ‚Äî     .        ‚Äú‚Äù.</p><br>
<p><img src="https://habrastorage.org/webt/we/ah/ie/weahierpwadwc3adccph1oxnxzs.png"><br>
<em>  IDA Pro   </em></p><br>
<p>   (     exe-  IDA,    )     , IDA Pro      (PE, portable execute),            , , ,    .</p><br>
<p>-    ,  , .         ,      -,  ,    ,     .</p><br>
<p>    ,              .     ‚Äî  ,   .</p><br>
<p>    ,            ‚Äú‚Äù (   -    ).          .    ,    .</p><br>
<div class="spoiler"><b class="spoiler_title">  </b><div class="spoiler_text"><p>,      (. ).      ‚Äú‚Äù ,             - .</p><br>
<p><img src="https://habrastorage.org/webt/fe/f3/up/fef3upsfi7vt9kqnjhdb3bpjvcy.png"><br>
<em>     </em></p></div></div><br>
<h3 id="0x32-chto-nam-ida-pro-pokazala">0x32   IDA Pro ?</h3><br>
<p>   IDA Pro     :  ,  ,  ‚Äî ,       .     IDA Pro (    ).     IDA Pro (      Python  C++).    IDA    Meta PC ‚Äî  x86/x64,   ,       Intel  AMD.        ,      ,     IDA,      Portable Executable.         ,      ,    ,      (   ).  ,             (   loader-  IDA,   ¬´¬ª     ,     IDA    ).</p><br>
<p>      ,        :</p><br>
<ul>
<li>       (analyze);</li>
<li>       (emulate ‚Äî    , , ,  QEMU);</li>
<li>     .</li>
</ul><br>
<p>      ‚Äú‚Äù   IDA      ,    ‚Äú‚Äù     .   ,           (          ), IDA     .</p><br>
<p> ,      ,     .     ,    ,    ,   IDA.</p><br>
<p>   ,  IDA Pro   .       ‚Äú‚Äù   (, ,    ). IDA            (,    MongoDB)   .        .idb ( .i64).</p><br>
<p>     ,   ,  ,    .  ,       ,    .        <strong>AU: Idle</strong>     IDA Pro.</p><br>
<div class="spoiler"><b class="spoiler_title">UX/UI IDA Pro</b><div class="spoiler_text"><p>GUI IDA Pro   Qt, ,   -   ,   Qt,      :</p><br>
<ul>
<li> drag&amp;drop ;</li>
<li>    ,      .          ,    .</li>
</ul></div></div><br>
<p><img src="https://habrastorage.org/webt/cl/al/0o/clal0o6ags5zcvanu7grv5os6v0.png"><br>
<em>    <strong>main</strong></em></p><br>
<p>   ,     IDA Pro.</p><br>
<ul>
<li>   ‚Äî    ( ,    -  ).     ,      .       .              (  ‚Äî  ,  ‚Äî  ).      ,        .</li>
</ul><br>
<div class="spoiler"><b class="spoiler_title">Proximity View</b><div class="spoiler_text"><p>    ,   Proximity View.        .</p></div></div><br>
<p><em> .   ,      ,       .</em></p><br>
<ul>
<li>  ‚Äî ,    ,    .    ,        (  ).         ( gcc   <strong>-s</strong>)       <strong>-g</strong>,           ,   .  IDA Pro     <strong>sub_&lt;_ _&gt;</strong>;</li>
<li>  (<strong>Strings</strong>) ‚Äî  ,   ,   <strong>SHIFT+F12</strong>.      IDA Pro ‚Äî     ,    .      ,     .</li>
</ul><br>
<h3 id="0x33-trogaem-lapoy-ida-pro">0x33  ‚Äú‚Äù IDA Pro</h3><br>
<p>-    ,    .          ?         , IDA Pro?  ‚Äî   <del></del>  .      - ,               .</p><br>
<p><img src="https://habrastorage.org/webt/-g/fg/48/-gfg48wnj1tqk02smxzu0kbbyjk.png"></p><br>
<p>     IDA Pro       (-, cheatsheet)   .     -.    -     IDA Pro ‚Äî Hexrays.  -   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="></a>,     , ,   ,      ,    - .</p><br>
<p><img src="https://habrastorage.org/webt/3g/wm/lb/3gwmlbsn8obbaqndh6xxt-z3cgm.png"></p><br>
<div class="spoiler"><b class="spoiler_title"> CTRL+S  CTRL+Z?</b><div class="spoiler_text"><p>   ,         .  ‚Äî      (CTRL+W,      ),  ‚Äî undo.  ,   undo ‚Äî  .  -  ,     CTRL+Z.  ,   undo     7.3 ( ‚Äî 7.0),      undo ‚Äî    .   ,  -     IDA,  ,       . ,   (make code)       .</p></div></div><br>
<p> ,      ,         IDA Pro.     ,   -    " ",      .     ,  IDA Pro       .</p><br>
<p>       IDA Pro.</p><br>
<h4 id="0x33a-navigaciya-po-grafu-i-listingu">0x33a     </h4><br>
<p> ‚Äî       , ,     IDA Pro,    :</p><br>
<ul>
<li>      ;</li>
<li>        ,     <strong>ESC</strong>      <strong>CTRL+ENTER</strong> (  - ‚Äî  );</li>
<li>     ‚Äî <strong>SPACE</strong>,        ();</li>
<li>   :       (  )   <strong>X</strong>.        ,      (     );</li>
<li>      (<strong>g</strong>):            (  0x)     IDA Pro ‚Äî       (),    .</li>
</ul><br>
<h4 id="0x33b-imenovanie-i-zametki-na-polyah">0x33b     </h4><br>
<p>   ()      :</p><br>
<ul>
<li>  (          <strong>N</strong>): ,  (  ),   .  ,   ,   .</li>
<li>   .    :  ,     ,   <code>;</code>.</li>
</ul><br>
<h4 id="0x33c-predstavlenie-dannyh-data-representation">0x33c   (data representation)</h4><br>
<p>         : </p><br>
<ul>
<li> (<strong>byte</strong>);</li>
<li> (<strong>word</strong>);</li>
<li>  (<strong>dword</strong>);</li>
<li> (<strong>offset</strong>);</li>
<li> (<strong>undefined</strong>);</li>
<li>  (<strong>code</strong>).</li>
</ul><br>
<p> ,       ,   ‚Äî  ,    (,   ..).  ,      (    ),    IDA Pro  <strong>undefined</strong>.  ,          ,       . ,        (   ),    ,   IDA Pro.</p><br>
<h4 id="0x33d-otlichie-koda-ot-funkcii">0x33d    </h4><br>
<p>     : </p><br>
<ul>
<li>   (   IDA Pro    );</li>
<li> (    ,   <strong>P</strong>).<br>
        IDA Pro  ,    .  ?   ,         (<strong>call</strong>),     ,  ,      , ‚Äî   . </li>
</ul><br>
<div class="spoiler"><b class="spoiler_title">  ,     </b><div class="spoiler_text"><p>            - ,     IDA Pro    ,     , IDA Pro       .    ,     <strong>call</strong>,     ,   "" <strong>call</strong>      .  , - ,    ,   ,    ‚Äî  .</p></div></div><br>
<h4 id="0x33e-predstavlenie-argumentov-instrukciy">0x33e   </h4><br>
<p>         ,        . ,       <code>mov eax, 0xFFFFFFFF</code>     ,    ,   <code>mov eax, -1</code>.  ,      ,       ,  IDA Pro    . </p><br>
<h4 id="0x33f-vspomogatelnye-okna-ida-pro">0x33f   IDA Pro</h4><br>
<p>       <strong>Strings</strong>, <strong>Names</strong>, <strong>Functions</strong>, <strong>Hex Dump</strong>.          <code>View-&gt;Open Subviews</code>.</p><br>
<h2 id="0x40-vsego-tak-mnogo-i-kak-s-etim-rabotat">0x40        ?</h2><br>
<pre><code class="plaintext hljs">; {EN}<font></font>
; I think I found actual protocol parsing in function sub_401D3C<font></font>
;<font></font>
; But this function just chases bytes from corner to corner<font></font>
; before actual parsing... we need to go deeper<font></font>
; {EN}</code></pre><br>
<h3 id="0x41-chto-zhe-my-budem-delat">0x41     ?</h3><br>
<p>,             " "  IDA Pro,           ,         .</p><br>
<p>       ,  ,  IDA      76 ,      .   ,   ,      .       ¬´¬ª      100% (         ).      :</p><br>
<ul>
<li>   .       ,     ;</li>
<li>   , , ,   API;</li>
<li>       (,     );</li>
<li>- ...</li>
</ul><br>
<p> ,  ,    , ‚Äî     .  ,       ,      .   ,       ,    .</p><br>
<h3 id="0x42-igolka-v-stoge-bayt">0x42    </h3><br>
<pre><code class="plaintext hljs">; {RU}<font></font>
;     ;<font></font>
;    ;<font></font>
;   ,     ( .1-3);<font></font>
; {RU}</code></pre><br>
<p>      ?   ,    ,      API  OpenSource-,        "doxygen":          API  .</p><br>
<div class="spoiler"><b class="spoiler_title">    doxygen?</b><div class="spoiler_text"><p>   doxygen ‚Äî  . ,    ,            .  , ,  , ‚Äî  HTML        ( ).</p></div></div><br>
<p>  ,   TCP/IP-,  ,    ‚Äú‚Äù    <strong>recv</strong>,         . , <strong>recvfrom</strong>,  API    ‚Äî   ( Linux ‚Äî <strong>read</strong>).</p><br>
<p><em><strong></strong>:   /      ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Socket programming in c using TCP/IP</a>.</em></p><br>
<p><img src="https://habrastorage.org/webt/ud/r5/8u/udr58uxngkb0ntarrlf9hrawoy4.png"></p><br>
<p>    IDA Pro?     <strong></strong>  (   ,       ).      SHIFT+F4.       (Names).</p><br>
<p>      ,   (  ,            ).  ,   , ,     ,    CTRL+F.        (   ).       ,     (     recv),  ,       ,       (   ).</p><br>
<p>      .             ( ENTER).</p><br>
<p><em><strong></strong>:         ESC.</em></p><br>
<p><img src="https://habrastorage.org/webt/8n/xq/uf/8nxqufiule2e6aphjdiiosshshi.png"><br>
<em>   </em></p><br>
<p>      .      recv (,  recv    ‚Äî  ,       ).</p><br>
<p>       ,      recv.      IDA Pro        (    )   .   ,   ,      ( ),       ,    <strong>X</strong>.     ,    .        .    type   :</p><br>
<ul>
<li><strong>p</strong>[rocedure] ‚Äî   ‚Äú ‚Äù,    ()    <strong>call</strong>;</li>
<li><strong>r</strong>[ead] ‚Äî    ;          ();</li>
<li><strong>w</strong>[rite] ‚Äî    ;          ().</li>
</ul><br>
<p>     : </p><br>
<ol>
<li>   <strong>recv</strong>   ( <strong>r</strong>), </li>
<li>  <strong>recv</strong> ( <strong>p</strong>).<br>
 ,       recv    .     :</li>
</ol><br>
<pre><code class="plaintext hljs">push    0<font></font>
push    1000h   ; len<font></font>
push    ebx     ; buf<font></font>
push    edi     ; s<font></font>
call    esi     ; recv   &lt;----   recv </code></pre><br>
<p>    ,  <strong>call</strong>       <strong>esi</strong>.     IDA ,       <strong>esi</strong>,   ,    <strong>call</strong>   <strong>esi</strong>    <strong>recv</strong>.   IDA     <strong>recv</strong>   .</p><br>
<p><img src="https://habrastorage.org/webt/6d/1w/37/6d1w370mx79d5zmogje5t5tazrk.png"><br>
<em>   <strong>recv</strong></em></p><br>
<p>      <strong>p</strong>,  IDA     ( ),     <strong>recv</strong>.    ‚Äî  IDA.    ,  <strong>recv</strong>: <strong>sub_401D3C</strong>.</p><br>
<p>? .   .     ,    ,   <strong>recv</strong>   ,      -   ,      (    ‚Äî  ).</p><br>
<h3 id="0x43-delaem-zametki-na-polyah-sub_401d3c">0x43  ‚Äú  ‚Äù: sub_401D3C</h3><br>
<p><code>; {EN} x_vserv_protocol {EN}</code></p><br>
<div class="spoiler"><b class="spoiler_title">  x_?</b><div class="spoiler_text"><p>      <strong>x_</strong>    (  eXecutable),         IDA Pro.<br>
<strong>ax_</strong> ‚Äî     (IDAPython);<br>
<strong>v_</strong> ‚Äî    (  Variable);<br>
<strong>av_</strong> ‚Äî ,    (IDAPython).</p></div></div><br>
<p> <strong>sub_401D3C</strong>    <strong>recv</strong>    .   ,      ¬´¬ª.</p><br>
<p><em><strong></strong>:         :    .  ,         (  ),  ‚Äî      .</em></p><br>
<p>          (. ¬´debug¬ª ‚Äî )      ,    . , -,       : --         . -,   -    ,   ,     </p><br>
<p> ,    ,     ,  ,    ,          .     ,    ,  ,      ,   ,    ,    ,   .</p><br>
<p><img src="https://habrastorage.org/webt/zg/zi/qk/zgziqkawpljptoqlgi2du93vaii.png"><br>
<em>   <strong>recv</strong></em></p><br>
<p>  ‚Äú  ‚Äù.     <strong>sub_401D3C</strong>,    ,          : <strong>sub_401CF0</strong>  <strong>sub_401BFD</strong>.  ,      puts ‚Äî     libc.        (stdout).   -   , ,    ,     - !</p><br>
<p><img src="https://habrastorage.org/webt/uj/uk/7t/ujuk7td6k0bfdtiisxf_lnenfx8.png"></p><br>
<p><em><strong></strong>:            recv.  ‚Äú ‚Äù  .        Strings (<strong>SHIFT+F12</strong>)       ,             ,    -      -.       ,    .</em></p><br>
<p>     ,   ,     puts.     <em>0x00401D64</em> (    ,    <strong>g</strong>      )    ‚ÄúReceived failed",     <em>0x00401D7A</em> ‚Äî "Client disconnected",    <em>0x00401D9C</em> ‚Äî ‚ÄúVSERV protocol error‚Ä¶‚Äù.       ,       VSERV (       ).        :</p><br>
<ul>
<li><em>0x00401D76</em>  RECV_SUCCESS;</li>
<li><em>0x00401D8C</em>  CLIENT_NOT_DISCONNECTED.</li>
</ul><br>
<p><em><strong></strong>:       -.             ,    , ‚Äî  .  ,      ,    ,   ,      ,   -    .          .        : ‚Äú ‚Äù, ,   .</em></p><br>
<p><img src="https://habrastorage.org/webt/a3/sm/ji/a3smji-z1irduackgnndpluxdm4.png"></p><br>
<p> ,   <em>0x00401D54</em> ‚Äî  ,     ‚Äú‚Äù     .     ‚ÄúRECV_LOOP‚Äù.   IDA Pro      :      ( )   ( )  .</p><br>
<p>       <em>0x00401D3C</em>,    , , , <strong>x_vserv_protocol</strong>. ,        ,      ‚Äî       ,    (    TCP  ‚Äú‚Äù).  ,     <strong>x_vserv_protocol</strong>,    ,      <strong>sub_401CF0</strong>  <strong>sub_401BFD</strong>,               (    ESC).</p><br>
<p><img src="https://habrastorage.org/webt/jz/ty/aw/jztyawfpvn1ydci0xp5jemcbsay.png"><br>
<em>      </em></p><br>
<h3 id="0x44-delaem-zametki-na-polyah-sub_401cf0">0x44  ‚Äú  ‚Äù: sub_401CF0</h3><br>
<pre><code class="plaintext hljs">; {EN} x_vserv_parse_header {EN}</code></pre><br>
<p>, ,  <strong>sub_401CF0</strong>,        .    ,      ,          <strong>sub_401CF0</strong>.        .       (    ),    ,   :</p><br>
<ul>
<li>      (,  ,    <strong>recv</strong>   TCP-);</li>
<li>       (<strong>if-else</strong>);</li>
<li>    <strong>memcmp</strong>  <strong>atoi</strong>;</li>
<li>     <em>0xFFFFFFFF</em> (-1)   ;</li>
<li>    .</li>
</ul><br>
<p><img src="https://habrastorage.org/webt/vm/x8/r-/vmx8r-chhl9nhifxb371kn2hon0.png"><br>
_  <strong>sub_401CF0</strong>   <strong>x_vserv_parse_header</strong>_</p><br>
<p>  ,   .</p><br>
<h4 id="0x44a-odin-argument-i-ego-naznachenie-v-funkcii-sub_401cf0">0x44a        sub_401CF0</h4><br>
<p> IDA    (  ,     ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">calling convention</a> (  )    ,   ).     ,     ( x86     <strong>cdecl</strong>,    ,   ),      IDA Pro     <strong>arg_</strong>.</p><br>
<p><em><strong></strong>:                  (calling convention).    ,       (   ,      ). ,     , ‚Äî x86-    (   <strong>push</strong>),      <strong>eax</strong> (,      <strong>return</strong>).</em></p><br>
<p> .       <strong>packet_buffer</strong>?    ,    ,    ,      .          <strong>x_vserv_protocol</strong>.        <strong>ebx</strong>.    <strong>ebx</strong> , IDA    ,          .      <strong>recv</strong> (,   )   (,             ¬´ ¬ª).</p><br>
<p><img src="https://habrastorage.org/webt/gi/ld/gz/gildgz52x_djy8xuynbgj--0xpa.png"><br>
_  <strong>x_vserv_parse_header</strong>_</p><br>
<p>  ( ,     <strong>recv</strong>)    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">  recv</a>.    ,    ‚Äî  ,   <strong>recv</strong>   . ,  ,     <strong>sub_401CF0</strong>        TCP- .</p><br>
<h4 id="0x44b-funkciya-sub_401cf0-ne-imeet-ciklov-i-soderzhit-odno-vetvlenie">0x44b  sub_401CF0       </h4><br>
<p>,   IDA Pro  ,        (     ).      <strong>sub_401CF0</strong>   ,   <strong>sub_401CF0</strong>  .</p><br>
<p>,   ,         IDA Pro ,       <strong>if-else</strong>   .    :</p><br>
<ul>
<li> ‚Äî   ,    ;</li>
<li> ‚Äî  .</li>
</ul><br>
<p> ,   ,    .    <strong>sub_401CF0</strong>    ,     ,      .</p><br>
<p><strong></strong>:   <strong>if-else</strong>       ( ):</p><br>
<ol>
<li>  (    );</li>
<li>     .</li>
</ol><br>
<h4 id="0x44c-funkciya-sub_401cf0-vyzyvaet-dve-bibliotechnye-memcmp-i-atoi">0x44c  sub_401CF0    memcmp  atoi</h4><br>
<p>         ,   ,       ,    .   API-         ,       ,    ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">,     memcmp</a>.</p><br>
<p><em> :  ‚Äúfear ‚Ä¶ leads to suffering‚Äù, -,    ,    ,       ,     reboot.   ,        ,      ,   .        .       reboot,   : ¬´or enables/disables the reboot keystroke¬ª.  ¬´¬ª    F8,    reboot,  ,    ,   ‚Ä¶ RTFM!</em></p><br>
<p>   ,  <strong>memcmp</strong>               ,   ¬´¬ª .     ,         ,       . ,  0 ‚Äî  ,  1 ‚Äî  .         0,    ,   &gt; 0,  &lt; 0.</p><br>
<p> API- <strong>atoi</strong>  ,   ascii-,  integer. ,      ,    ‚Äî  .</p><br>
<h4 id="0x44d-sobiraem-vsyo-vmeste-i-otvechaem-na-dva-ostavshihsya-voprosa">0x44d         </h4><br>
<p>         API-   ?</p><br>
<p>-, <strong>memcmp</strong>    (  ,  ¬´¬ª,       ).       ,    <strong>memcmp</strong>       (   ),   "VMES"   4 (  <strong>VMES</strong>).  ,    ,     ,    <strong>eax</strong>   <em>0xFFFFFFFF</em> (-1),     <strong>atoi</strong>.</p><br>
<p>     <strong>memcmp</strong>,   <strong>strcmp</strong>,     , - ,      , 4 .  <strong>strcmp</strong>         <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">-</a>.    "VMES" -  ,  ,    ‚Äî -    . - ,         , <strong>strcmp</strong>     .</p><br>
<p>-, <strong>atoi</strong>,  ,   - (          ).     ,  <strong>atoi</strong>       ‚Äî     <strong>VMES</strong> (  ,        <em>0x00401D19</em>) ‚Äî     .   atoi   eax.  ,  <strong>eax</strong>       ,    ,  -1.  ,       x86       <strong>eax</strong>,        ,       ‚Äî  -1,            .    ,      ? ,   :</p><br>
<pre><code class="cpp hljs"><span class="hljs-keyword">char</span> tmp[<span class="hljs-number">5</span>] = { <span class="hljs-number">0</span> };
<span class="hljs-keyword">if</span> (<span class="hljs-built_in">memcmp</span>(&amp;buf[<span class="hljs-number">0</span>], <span class="hljs-string">"VMES"</span>, <span class="hljs-number">4</span>) != <span class="hljs-number">0</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<font></font>
*(<span class="hljs-keyword">int</span>*) tmp = *(<span class="hljs-keyword">int</span>*)(&amp;buf[<span class="hljs-number">4</span>]);
<span class="hljs-keyword">return</span> atoi(tmp);</code></pre><br>
<p>     .    , :    5 ?    ?      <strong>atoi(buf + 4)</strong>?             <strong>atoi</strong>,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">  strtol</a> (    <strong>atoi</strong>,     <strong>strtol</strong>     10).   ,   ,     ,       .  ,  10-         0  9.      ,  ,  <em></em>     ,        ,      - .    (  )   .  :      -      ascii-. </p><br>
<p>   5   ,      (      ):       <strong>buffer_length</strong>   <strong>var_D</strong> (       ).    0    ,       .  <strong>var_D</strong>   -. </p><br>
<p>        <strong>x_vserv_parse_header</strong> (    ).</p><br>
<h3 id="0x45-delaem-zametki-na-polyah-sub_401bfd">0x45  ‚Äú  ‚Äù: sub_401BFD</h3><br>
<pre><code class="plaintext hljs">; {EN} x_vserv_parse_body {EN}</code></pre><br>
<h4 id="0x45a-nemnogo-o-steke-i-ego-kadre">0x45a      </h4><br>
<p>,      ,    ¬´¬ª   ,     .      ,     .     <strong>x_vserv_protocol</strong>,      <strong>PARSE_BODY</strong> ( ,  ,   <strong>g</strong>,       <strong>ENTER</strong>).        push, , ,       <strong>sub_401BFD</strong> (      <strong>x_vserv_protocol_body</strong>).      ,  . </p><br>
<p><img src="https://habrastorage.org/webt/-3/68/su/-368su8_4xhsb5wod7jfyxayesi.png"><br>
_  <strong>body_buffer</strong>?_</p><br>
<p>    (    <strong>lea</strong>)   (   <strong>body_buffer</strong>).   ‚Äî ,      <strong>x_vserv_protocol_header</strong> (   eax    <strong>push</strong>  ).       ‚Äî   <strong>atoi</strong>-,     .</p><br>
<p> ,   <strong>body_buffer</strong>,      :</p><br>
<ul>
<li>     ,    <strong>recv</strong>;</li>
<li>   <strong>x_vserv_protocol</strong>.</li>
</ul><br>
<p>  ,   <strong>recv</strong>,   .      <strong>recv</strong> , ,      <strong>ebx</strong>    <strong>recv</strong> (.  <strong>RECV_LOOP</strong>).    <strong>ebx</strong>  ,       ,  ,     <strong>esp</strong>.  <strong>esp</strong>    (   ) ,        ,  ,    <strong>push</strong>/<strong>pop</strong>.      <strong>esp</strong>    ,      :</p><br>
<p><code>char buffer[0x1000];</code></p><br>
<p><em><strong></strong>:  ?  ,    ,    ,     ,     .  ,              ,           .      Wikipedia.</em></p><br>
<p>   (  )  <strong>x_vserv_protocol</strong>.      IDA Pro         ,    (  ‚Äî ¬´¬ª     ).     ,    .</p><br>
<p><img src="https://habrastorage.org/webt/ye/_q/bp/ye_qbpsfafr80erlvdrogs38yge.png"><br>
<em>  </em></p><br>
<p>   ,      <strong>recv</strong>      (  esp   ).       (  ‚Äî  <strong>N</strong>)   <strong>vmes_sign</strong> (      "VMES").</p><br>
<p>   ‚Äî  ,    <strong>atoi</strong>   <strong>x_vserv_parse_header</strong>.      ,         <strong>x_vserv_parse_header</strong> ( <em>0x00401D19</em>).  <strong>mov</strong>      <strong>[ebx+4]</strong>   <strong>eax</strong>     <strong>atoi</strong>.   ,     ,    <strong>vmes_body_len</strong>.</p><br>
<p>  ,          TCP-.    - ,  ,     ‚Äî  ,    (),  ,   ,    <strong>x_vserv_parse_header</strong>. ,           <strong>x_vserv_parse_body</strong>.</p><br>
<h4 id="0x45b-razbiraem-funkciyu-razbora-tela-paketa">0x45b     </h4><br>
<p>     ( <strong>ESC</strong>)    .     <strong>sub_401BFD</strong> (<strong>x_vserv_protocol_body</strong> ‚Äî   ) ‚Äî  , ,   TCP-   <strong>recv</strong>,     (  ,   ‚Äî  ).   ‚Äì ,    +4    (,   )  ¬´¬ª  <strong>atoi</strong>,     .</p><br>
<p><em><strong></strong>:  -   Stack BOF (  Stack Buffer Overflow,      )   ,            .     ,    .      ,   .</em></p><br>
<p>      <strong>x_vserv_protocol_body</strong>,      .</p><br>
<p><img src="https://habrastorage.org/webt/hu/ya/ak/huyaaknpousidzdxvrlwnpcmbgm.png"><br>
_  <strong>x_vserv_protocol_body</strong>_</p><br>
<p>     -     ¬´¬ª     ,        <strong>if-else-if-else-if-else</strong> (,   <strong>switch</strong>).  ,     ,   ,               ‚ÄúHEXDUMP‚Äù, ‚ÄúTALK2ME‚Äù, ‚ÄúB64DECO‚Äù, ‚ÄúDISCONN‚Äù, ‚ÄúSTOP!!!‚Äù.      ,      ¬´Unknown command¬ª.  , ,     ‚Äî  .          .     : <strong>x_vserv_hexdump</strong>, <strong>x_vserv_talk2me</strong>, <strong>x_vserv_b64deco</strong>, <strong>x_vserv_disconn</strong>, <strong>x_vserv_stop</strong>.      .</p><br>
<h4 id="0x45c-poschupaem-nekotorye-obrabotchiki-komand-vserv">0x45c     vserv</h4><br>
<p> ,  ,    ,       ,        .  ,      ,    ,         15  (      ).  - ,   ,   <strong>len</strong>,   ,    ,      <strong>x_vserv_hexdump</strong>.        .</p><br>
<p><img src="https://habrastorage.org/webt/2s/bd/7s/2sbd7shspnys599lncmtu8r_9ea.png"><br>
_  <strong>x_vserv_hexdump</strong>_</p><br>
<p>   ,      ,    ebp (,      ,  ebp     ).     ,   ,     ,  ,      ,      .</p><br>
<h3 id="0x45d-zakruglyaemsya-na-segodnya">0x45d   </h3><br>
<p><img src="https://habrastorage.org/webt/pd/4k/6m/pd4k6m-ucpwhyizp5gfvngk32em.png"></p><br>
<h2 id="0x50-is-this-the-end">0x50 Is this the end?</h2><br>
<pre><code class="plaintext hljs">; {EN} x_vserv_parse_body {EN}</code></pre><br>
<p>   ,       -,             . ,     ,    ,          ,     IDA Pro.</p><br>
<p>      9-   -,       <strong>VSERV</strong>  IDA Pro,            RCE (      )   .</p><br>
<p><img src="https://habrastorage.org/webt/0o/wi/35/0owi35rcyborkmvkyhuhkqbmlco.png"></p></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de493402/index.html">Rostelecom Werbebanner und wie man damit umgeht</a></li>
<li><a href="../de493404/index.html">Wie man einen K√ºnstler findet, um eine Site zu entwickeln</a></li>
<li><a href="../de493406/index.html">Funktionsweise des Festplattensubsystems in OpenNebula</a></li>
<li><a href="../de493408/index.html">DJI Mavic Mini Copter fiel wie eine Brechstange</a></li>
<li><a href="../de493412/index.html">Spiele mit Wifi auf ESP32</a></li>
<li><a href="../de493418/index.html">Warum maschinelles Lernen ‚Äûsynthetische‚Äú Daten verwendet</a></li>
<li><a href="../de493420/index.html">Mein Weg, Sch√ºler der Mittelstufe in Python einzuf√ºhren</a></li>
<li><a href="../de493424/index.html">Wir implementieren Python-Code-Konvertierungen</a></li>
<li><a href="../de493426/index.html">Organisation von Code in Microservices und mein Ansatz zur Verwendung von hexagonaler Architektur und DDD</a></li>
<li><a href="../de493428/index.html">"Wir werden keine Verschw√∂rungstheorien hervorbringen." Sprechen Sie √ºber ML-Konferenzen mit Menschen aus Wissenschafts- und IT-Unternehmen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>