<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üêã üéóÔ∏è üåµ Wie funktioniert das Prometheus-Histogramm? üö§ üíÖ üôÜüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Vor Beginn des Kurses ‚Äû√úberwachung und Protokollierung: Zabbix, Prometheus, ELK‚Äú wurde eine √úbersetzung des Artikels erstellt .
 
 
 
 Fr√ºher haben wi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Wie funktioniert das Prometheus-Histogramm?</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/501978/"><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vor Beginn des Kurses </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚Äû√úberwachung und Protokollierung: Zabbix, Prometheus, ELK‚Äú wurde</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> eine √úbersetzung des Artikels erstellt </font><font style="vertical-align: inherit;">.</font></font></b></i><br>
<br>
<img src="https://habrastorage.org/webt/bb/b2/rl/bbb2rlroxgbryy_noc1mg9urkos.png"><br>
<hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fr√ºher haben wir uns </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">einen Z√§hler</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ein Messger√§t</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">eine Zusammenfassung angesehen</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Lassen Sie uns nun dar√ºber sprechen, wie das Histogramm in Prometheus funktioniert.</font></font><a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Histogramm weist einige √Ñhnlichkeiten mit der Zusammenfassung auf. </font><font style="vertical-align: inherit;">Ein Histogramm ist eine Kombination verschiedener Z√§hler. </font><font style="vertical-align: inherit;">Wie zusammenfassende Metriken werden Histogrammmetriken verwendet, um dimensionale Ma√üe von Ereignissen, h√§ufig deren Dauer, mithilfe der Methode zu verfolgen </font></font><code>observe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Zeitnehmungswerkzeuge sind normalerweise dieselben wie Bulletins. </font><font style="vertical-align: inherit;">Sie unterscheiden sich in der Verarbeitung von Quantilen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das folgende Beispiel zeigt </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ein</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Prometheus-Etikettenformat </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">f√ºr die Belichtung</font></a></font><code>handler</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="xml hljs"># HELP prometheus_http_request_duration_seconds Histogram of latencies for HTTP requests.<font></font>
# TYPE prometheus_http_request_duration_seconds histogram<font></font>
prometheus_http_request_duration_seconds_bucket{handler="/",le="0.1"} 25547<font></font>
prometheus_http_request_duration_seconds_bucket{handler="/",le="0.2"} 26688<font></font>
prometheus_http_request_duration_seconds_bucket{handler="/",le="0.4"} 27760<font></font>
prometheus_http_request_duration_seconds_bucket{handler="/",le="1"} 28641<font></font>
prometheus_http_request_duration_seconds_bucket{handler="/",le="3"} 28782<font></font>
prometheus_http_request_duration_seconds_bucket{handler="/",le="8"} 28844<font></font>
prometheus_http_request_duration_seconds_bucket{handler="/",le="20"} 28855<font></font>
prometheus_http_request_duration_seconds_bucket{handler="/",le="60"} 28860<font></font>
prometheus_http_request_duration_seconds_bucket{handler="/",le="120"} 28860<font></font>
prometheus_http_request_duration_seconds_bucket{handler="/",le="+Inf"} 28860<font></font>
prometheus_http_request_duration_seconds_sum{handler="/"} 1863.80491025699<font></font>
prometheus_http_request_duration_seconds_count{handler="/"} 28860</code></pre><br>
<code>_sum</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und sie </font></font><code>_count</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">funktionieren genauso wie f√ºr die Zusammenfassung und k√∂nnen verwendet werden, um die durchschnittliche Ausf√ºhrungszeit in den letzten f√ºnf Minuten zu ermitteln:</font></font><br>
<br>
<pre><code class="xml hljs"> rate(prometheus_http_request_duration_seconds_sum[5m]<font></font>
/<font></font>
  rate(prometheus_http_request_duration_seconds_count[5m])</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es gibt jedoch sehr seltene F√§lle, in denen es </font></font><code>_sum</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">beispielsweise in einigen Metriken des MySQLd-Exporters fehlt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ein bemerkenswerter Teil des Histogramms sind die Zeitreihen </font></font><code>_bucket</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, die eigentlich der Histogrammteil der Metrik sind. Insbesondere sind dies Z√§hler, die ein kumulatives Histogramm bilden. </font></font><code>le</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bezeichnen weniger als oder gleich. Somit dauerten 26688 Anfragen weniger als oder gleich 200 ms, 27760 Anfragen dauerten weniger als oder gleich 400 ms und es gab insgesamt 28860 Anfragen. Die Werte im Bucket werden monoton nicht abnehmen, und der </font></font><code>+Inf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bucket hat den gr√∂√üten Wert. </font></font><code>+Inf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Eimer muss immer vorhanden sein und mit dem Wert √ºbereinstimmen </font></font><code>_count</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um beispielsweise ein Quantil von 0,9 (das 90. Perzentil) zu berechnen, sollten Sie Folgendes verwenden:</font></font><br>
<br>
<pre><code class="xml hljs">histogram_quantile(0.9, <font></font>
  rate(prometheus_http_request_duration_seconds_bucket[5m])<font></font>
)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ein gro√üer Vorteil von Histogrammen gegen√ºber Zusammenfassungen besteht darin, dass Sie Buckets aggregieren k√∂nnen, bevor Sie ein Quantil berechnen. Achten Sie dabei darauf, dass Sie das Etikett nicht verlieren </font></font><code>le</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="xml hljs">histogram_quantile(0.9, <font></font>
  sum without (handler)(<font></font>
    rate(prometheus_http_request_duration_seconds_bucket[5m])<font></font>
  )<font></font>
)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zus√§tzlich zur Aggregation sind Histogramme auf dem Client billiger, da die Z√§hler schnell inkrementiert werden. </font><font style="vertical-align: inherit;">Warum also nicht immer Histogramme verwenden? </font><font style="vertical-align: inherit;">Es gibt eine </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lange Antwort</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Kurzversion ist jedoch, dass Sie mit den Histogrammen zuerst Ihren Bucket ausw√§hlen m√ºssen und die Kosten aufgrund der Anzahl der Bucket-Elemente vom Client auf Prometheus selbst √ºbertragen werden. Standardm√§√üig decken zehn Buckets einen typischen Webdienst mit einer Verz√∂gerung von Millisekunden bis zu einer Sekunde ab. In einigen F√§llen m√ºssen Sie dies m√∂glicherweise √§ndern. Hier wurden sie beispielsweise neu definiert, um PromQL-Abfragen besser zu verfolgen, die standardm√§√üig eine Zeit√ºberschreitung von zwei Minuten haben. Wenn Sie mehr als ein Dutzend Eimer haben, erhalten Sie genauere Ergebnisse, k√∂nnen aber auch viele Zeitreihen erstellen. Besonders in Kombination mit anderen Tags.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bei Verwendung eines Echtzeit√ºberwachungssystems wie Prometheus sollte das Ziel darin bestehen, einen analytischen Wert bereitzustellen, der ausreicht, um darauf basierende technische Entscheidungen zu treffen. Zum Beispiel ist es wichtiger zu wissen, dass die Verz√∂gerung des 90. Perzentils um 50 ms zugenommen hat, als zu wissen, ob sie jetzt 562 ms oder 563 ms betr√§gt, und normalerweise reichen zehn Bucket-s daf√ºr aus. Wenn Sie eine genaue Antwort ben√∂tigen, k√∂nnen Sie diese sp√§ter jederzeit aus Ihren Protokollen berechnen. Wenn zu viele Buckets vorhanden sind, k√∂nnen diese w√§hrend der Datenverarbeitung verworfen werden, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wie bereits gezeigt wurde</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . In extremeren F√§llen k√∂nnen Sie die Reihe von </font></font><code>_bucket</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s </font><font style="vertical-align: inherit;">vollst√§ndig ignorieren </font><font style="vertical-align: inherit;">und sich auf den Durchschnitt von </font></font><code>_sum</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und verlassen </font></font><code>_count</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zusammenfassend l√§sst sich sagen, dass Histogramme die aggregierte Berechnung von Quantilen erm√∂glichen, obwohl die Anzahl der Elemente ber√ºcksichtigt werden muss. </font><font style="vertical-align: inherit;">Denken Sie daran, dass eine Zusammenfassung ohne Quantile eine billigere Option ist, wenn Sie kein Histogramm ben√∂tigen.</font></font><br>
<br>
<hr><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mehr zum Kurs</font></font></a><br>
<br>
<hr></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de501960/index.html">Suchskalierung. Elasticsearch Seine Vorteile und Grundvoraussetzungen f√ºr die Installation</a></li>
<li><a href="../de501964/index.html">Wof√ºr sind Industriecomputer?</a></li>
<li><a href="../de501968/index.html">MVI-Architekturvorlage in Kotlin Multiplattform, Teil 1</a></li>
<li><a href="../de501970/index.html">Was brauchst du, um einen guten Dungeon in RPG zu erstellen?</a></li>
<li><a href="../de501976/index.html">So lernen Sie, Software zu testen</a></li>
<li><a href="../de501980/index.html">Die Geschichte eines Projekts oder wie ich 7 Jahre PBX basierend auf Asterisk und Php erstellt habe</a></li>
<li><a href="../de501982/index.html">So √ºbertragen Sie einen Shader von einer Spiel-Engine auf Substance Painter</a></li>
<li><a href="../de501984/index.html">Was gibt es in Quarant√§ne zu sehen? Eine Auswahl von Materialien aus Technostream (Teil 4)</a></li>
<li><a href="../de501986/index.html">Geheimnisse des unglaublichen Erfolgs von Apple AirPods</a></li>
<li><a href="../de501988/index.html">Wie wird der VK-Nachrichtenbildschirm gerendert?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>