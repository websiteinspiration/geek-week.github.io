<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🔒 👧🏾 ⛹🏾 Spring: mencari konteks 🤾🏼 🌟 👇🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Beberapa bulan yang lalu, sebuah pos terperinci tentang memuat kelas di JVM diterbitkan di profil saya . Setelah ceramah ini, kolega saya mengajukan p...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Spring: mencari konteks</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/489236/"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beberapa bulan yang lalu, sebuah pos terperinci </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tentang memuat kelas di JVM</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> diterbitkan di profil saya </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Setelah ceramah ini, kolega saya mengajukan pertanyaan yang bagus: mekanisme apa yang digunakan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> untuk mengurai konfigurasi dan bagaimana cara memuat kelas dari konteks?</font></font></p><br>
<img src="https://habrastorage.org/webt/vz/-z/00/vz-z001zifi89ni-1_rxixaxr00.jpeg"><a name="habracut"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah berjam-jam debug sumber, kolega saya secara eksperimental sampai pada kebenaran yang sangat sederhana dan dapat dimengerti.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sedikit teori</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Segera tentukan bahwa </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ApplicationContext</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adalah antarmuka utama dalam aplikasi Spring yang menyediakan informasi konfigurasi aplikasi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sebelum melanjutkan langsung ke demonstrasi, mari kita lihat langkah-langkah yang terlibat dalam membuat </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ApplicationContext</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vo/co/_d/voco_dc-kmx1qqd04ctg9zpssre.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam posting ini kami akan menganalisis langkah pertama, karena kami tertarik membaca konfigurasi dan membuat BeanDefinition. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
BeanDefinition adalah antarmuka yang menggambarkan kacang, propertinya, argumen konstruktor, dan informasi meta lainnya. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mengenai konfigurasi kacang itu sendiri, Spring memiliki 4 metode konfigurasi:</font></font><br>
<br>
<ol>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Konfigurasi Xml</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - ClassPathXmlApplicationContext ("context.xml");</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Konfigurasi Groovy</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - GenericGroovyApplicationContext ("context.groovy");</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Konfigurasi melalui anotasi yang menunjukkan paket untuk pemindaian</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - AnnotationConfigApplicationContext ("package.name");</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JavaConfig</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - konfigurasi melalui anotasi yang menunjukkan kelas (atau array kelas) yang ditandai dengan @Configuration - AnnotationConfigApplicationContext (JavaConfig.class).</font></font></li>
</ol><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Konfigurasi xml</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami mengambil sebagai proyek sederhana:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SpringContextTest</span></span>{
   <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> String classFilter = <span class="hljs-string">"film."</span>;<font></font>
   <font></font>
   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span></span>{<font></font>
        <font></font>
         printLoadedClasses(classFilter);<font></font>
         <span class="hljs-comment">/* Classloader: sun.misc.Launcher$AppClassLoader@18b4aac2
            All - 5 : 0 - Filtered      /*
        doSomething(MainCharacter.num); doSomething(FilmMaker.class);
        printLoadedClasses(classFilter);
        /* Classloader: sun.misc.Launcher$AppClassLoader@18b4aac2
               class film.MainCharacter
               class film.FilmMaker
            All - 7 : 2 - Filtered     /*</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di sini Anda harus menjelaskan sedikit metode apa dan apa yang digunakan:</font></font><br>
<br>
<ul>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">printLoadedClasses (Filter ... filter)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - metode ini mencetak ke konsol nama loader dan memuat kelas JVM dari paket yang diteruskan sebagai parameter. </font><font style="vertical-align: inherit;">Selain itu, ada informasi tentang jumlah semua kelas yang dimuat;</font></font></li>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">doSomething (Obyek o)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adalah metode yang melakukan pekerjaan primitif, tetapi tidak memungkinkan untuk mengecualikan kelas yang disebutkan selama optimasi selama kompilasi.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami terhubung ke proyek Pegas (selanjutnya, Pegas 4 bertindak sebagai subjek uji):</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-number">11</span> <span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SpringContextTest</span></span>{
<span class="hljs-number">12</span>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> String calssFilter = <span class="hljs-string">"film."</span>;
<span class="hljs-number">13</span>    
<span class="hljs-number">14</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span></span>{
<span class="hljs-number">15</span>        
<span class="hljs-number">16</span>        printLoadedClasses(classFilter);
<span class="hljs-number">17</span>       <span class="hljs-comment">/* Classloader: sun.misc.Launcher$AppClassLoader@18b4aac2
18           All - 5 : 0 - Filtered      /*
19        doSomething(MainCharacter.num); doSomething(FilmMaker.class);
20        printLoadedClasses(classFilter);
21        /* Classloader: sun.misc.Launcher$AppClassLoader@18b4aac2
22               class film.MainCharacter
23               class film.FilmMaker
24               All - 7 : 2 - Filtered   /*
25        ApplicationContext context = new ClassPathXmlApplicationContext(
26                  configLocation: "applicationContext.xml");
27        printLoadedClasses(classFilter);</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Baris 25 adalah deklarasi dan inisialisasi ApplicationContext melalui konfigurasi </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Xml</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
File konfigurasi xml adalah sebagai berikut:</font></font><br>
<br>
<pre><code class="xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span> = <span class="hljs-string">"http://www.spingframework.org/schema/beans"</span> <span class="hljs-attr">xmlns:xsi</span> = <span class="hljs-string">"http..."</span>
        &lt;<span class="hljs-attr">bean</span> <span class="hljs-attr">id</span> = <span class="hljs-string">"villain"</span> <span class="hljs-attr">class</span> = <span class="hljs-string">"film.Villain"</span> <span class="hljs-attr">lazy-init</span>= <span class="hljs-string">"true"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span> = <span class="hljs-string">"name"</span> <span class="hljs-attr">value</span> = <span class="hljs-string">"Vasily"</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span> </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saat mengonfigurasi kacang, kami menentukan kelas yang benar-benar ada. </font><font style="vertical-align: inherit;">Perhatikan properti yang ditentukan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lazy-init = ”true”</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : dalam hal ini, nampan akan dibuat hanya setelah memintanya dari konteks. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami melihat bagaimana Spring, ketika meningkatkan konteks, akan menjernihkan situasi dengan kelas yang dideklarasikan dalam file konfigurasi:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SpringContextTest</span> </span>{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> String classFilter = <span class="hljs-string">"film."</span>;<font></font>
    <font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>{<font></font>
        <font></font>
           printLoadedClasses(classFilter);<font></font>
        <span class="hljs-comment">/* Classloader: sun.misc.Launcher$AppClassLoader@18b4aac2
           All - 5 : 0 - Filtered      /*
        doSomething(MainCharacther.num); doSomething(FilmMaker.class);
        printLoadedClasses(classFilter);
        /* Classloader: sun.misc.Launcher$AppClassLoader@18b4aac2
               class film.MainCharacter
               class film.FilmMaker
            All - 7 : 2 - Filtered     /*
        ApplicationContext context = new ClassPathXmlApplicationContext(
                  configLocation: "applicationContext.xml");
        printLoadedClasses(classFilter);
        /* Classloader: sun.misc.Launcher$AppClassLoader@18b4aac2
               class film.MainCharacter
               class film.FilmMaker
               class film.Villain

            All - 343 : 3- Filtered     /*</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mari kita periksa detail konfigurasi Xml: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - Membaca file konfigurasi telah kelas </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XmlBeanDefinitionReader</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , yang mengimplementasikan antarmuka </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BeanDefinitionReader</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XmlBeanDefinitionReader</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pada input menerima InputStream dan memuat </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dokumen</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> melalui </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DefaultDocumentLoader</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="java hljs">Document doc = doLoadDocument(inputSource, resource);
<span class="hljs-keyword">return</span> registerBeanDefinitions(doc, resource);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - Setelah itu, setiap elemen dokumen ini diproses dan, jika itu adalah sebuah bin, BeanDefinition dibuat berdasarkan data yang diisi (id, nama, kelas, alias, metode init, metode-destr, dll.):</font></font><br>
<br>
<pre><code class="java hljs">} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (delegate.nodeNameEquals(ele, <span class="hljs-string">"bean"</span>)) {
    <span class="hljs-keyword">this</span>.processBeanDefinition(ele, delegate);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - Setiap BeanDefinition ditempatkan di Peta, yang disimpan di kelas DefaultListableBeanFactory:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">this</span>.beanDefinitionMap.put(beanName, beanDefinition);
<span class="hljs-keyword">this</span>.beanDefinitionNames.add(beanName);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam kode tersebut, Peta terlihat seperti ini:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-comment">/** Map of bean definition objects, keyed by bean name */</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Map&lt;String, BeanDefinition&gt; beanDefinitionMap = <span class="hljs-keyword">new</span> ConcurrentHashMap&lt;String, BeanDefinition&gt;(<span class="hljs-number">64</span>);
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang di file konfigurasi yang sama, tambahkan deklarasi bean lain dengan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">film.BadVillain</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> class </font><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span> = <span class="hljs-string">"http://www.spingframework.org/schema/beans"</span> <span class="hljs-attr">xmlns:xsi</span> = <span class="hljs-string">"http..."</span>
        &lt;<span class="hljs-attr">bean</span> <span class="hljs-attr">id</span> = <span class="hljs-string">"goodVillain"</span> <span class="hljs-attr">class</span> = <span class="hljs-string">"film.Villain"</span> <span class="hljs-attr">lazy-init</span>= <span class="hljs-string">"true"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span> = <span class="hljs-string">"name"</span> <span class="hljs-attr">value</span> = <span class="hljs-string">"Good Vasily"</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span> = <span class="hljs-string">"badVillain"</span> <span class="hljs-attr">class</span> = <span class="hljs-string">"film.BadVillain"</span> <span class="hljs-attr">lazy-init</span>= <span class="hljs-string">"true"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span> = <span class="hljs-string">"name"</span> <span class="hljs-attr">value</span> = <span class="hljs-string">"Bad Vasily"</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">akan melihat</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> apa yang terjadi jika Anda mencetak daftar </font><i><font style="vertical-align: inherit;">BeanDefenitionNames</font></i><font style="vertical-align: inherit;"> dan kelas yang dimuat:</font></font><br>
<br>
<pre><code class="java hljs">ApplicationContext context = <span class="hljs-keyword">new</span> ClassPathXmlApplicationContext(<font></font>
        configLocation: <span class="hljs-string">"applicationContext.xml"</span>);<font></font>
System.out.println(Arrays.asList(context.getBeanDefinitionNames()));<font></font>
        <font></font>
printLoadedClasses(calssFilter);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Terlepas dari kenyataan bahwa kelas </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">film.BadVillain yang</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ditentukan dalam file konfigurasi tidak ada, Spring berfungsi tanpa kesalahan:</font></font><br>
<br>
<pre><code class="java hljs">ApplicationContext context = <span class="hljs-keyword">new</span> ClassPathXmlApplicationContext(<font></font>
        configLocation: <span class="hljs-string">"applicationContext.xml"</span>);<font></font>
System.out.println(Arrays.asList(context.getBeanDefinitionNames()));<font></font>
<span class="hljs-comment">//  [goodVillain, badVillain]</span><font></font>
printLoadedClasses(calssFilter);<font></font>
<span class="hljs-comment">/* Classloader: sun.misc.Launcher$AppClassLoader@18b4aac2
               class film.MainCharacter
               class film.FilmMaker
               class film.Villain
    All - 343 : 3- Filtered   /*</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Daftar </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BeanDefenitionNames</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> berisi 2 elemen; yaitu, 2 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
BeanDefinition yang dikonfigurasi dalam file kami dibuat. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Konfigurasi kedua nampan pada dasarnya sama. Tapi, sementara kelas yang ada dimuat, tidak ada masalah yang muncul. Dari mana kita dapat menyimpulkan bahwa ada juga upaya untuk memuat kelas yang tidak ada, tetapi upaya yang gagal tidak merusak apa pun. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mari kita coba mendapatkan kacang sendiri dengan nama mereka:</font></font><br>
<br>
<pre><code class="java hljs">ApplicationContext context = <span class="hljs-keyword">new</span> ClassPathXmlApplicationContext(<font></font>
        configLocation: <span class="hljs-string">"applicationContext.xml"</span>);<font></font>
System.out.println(Arrays.asList(context.getBeanDefinitionNames()));<font></font>
<span class="hljs-comment">//  [goodVillain, badVillain]</span>
System.out.println(context.getBean( name: <span class="hljs-string">"goodVillain"</span>));<font></font>
<font></font>
System.out.println(context.getBean( name: <span class="hljs-string">"badVillain"</span>));
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami mendapatkan yang berikut: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/s9/ot/wk/s9otwkgtbjbiwazcku5ferzpobm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika dalam kasus pertama bean yang valid diterima, maka dalam kasus kedua pengecualian tiba. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Perhatikan jejak stack: pemuatan kelas ditangguhkan bekerja. Semua pemuat kelas dirayapi dalam upaya untuk menemukan kelas yang mereka cari di antara yang dimuat sebelumnya. Dan setelah kelas yang diinginkan tidak ditemukan, dengan memanggil metode </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Utils.forName</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , upaya dilakukan untuk menemukan kelas yang tidak ada dengan nama, yang menyebabkan kesalahan alami. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saat meningkatkan konteks, hanya satu kelas yang dimuat, sementara upaya untuk memuat file yang tidak ada tidak mengarah ke kesalahan. Kenapa ini terjadi? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Itu karena kami mendaftar </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lazy-init: true</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dan melarang Spring untuk membuat instance kacang, tempat pengecualian yang diterima sebelumnya dihasilkan. </font><font style="vertical-align: inherit;">Jika Anda menghapus properti ini dari konfigurasi atau mengubah nilainya </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lazy-init: false</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , maka kesalahan yang dijelaskan di atas juga akan macet, tetapi aplikasi tidak akan diabaikan. </font><font style="vertical-align: inherit;">Dalam kasus kami, konteksnya diinisialisasi, tetapi kami tidak dapat membuat instance kacang, karena </font><font style="vertical-align: inherit;">Kelas yang ditentukan tidak ditemukan.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Konfigurasi asyik</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saat mengonfigurasi konteks menggunakan file Groovy, Anda perlu membuat </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GenericGroovyApplicationContext</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , yang menerima string dengan konfigurasi konteks sebagai input. </font><font style="vertical-align: inherit;">Dalam hal ini, kelas </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GroovyBeanDefinitionReader</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> terlibat dalam membaca konteks </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Konfigurasi ini pada dasarnya berfungsi sama dengan Xml, hanya dengan file Groovy. </font><font style="vertical-align: inherit;">Selain itu, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GroovyApplicationContext</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> berfungsi dengan baik dengan file Xml. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Contoh file konfigurasi Groovy sederhana:</font></font><br>
<br>
<pre><code class="xml hljs">beans {<font></font>
    goodOperator(film.Operator){bean - &gt;<font></font>
            bean.lazyInit = 'true' &gt;<font></font>
            name = 'Good Oleg' <font></font>
         }<font></font>
    badOperator(film.BadOperator){bean - &gt;<font></font>
            bean.lazyInit = 'true' &gt;<font></font>
            name = 'Bad Oleg' / &gt;<font></font>
        }<font></font>
  }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami mencoba melakukan hal yang sama dengan Xml: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ng/qp/zd/ngqpzdgjzxhy_naj3tar3vhtbbs.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kesalahan langsung crash: Groovy, seperti Xml, membuat BeanDefenitions, tetapi dalam hal ini postprocessor segera memberikan kesalahan.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Konfigurasi melalui anotasi yang mengindikasikan paket untuk pemindaian atau JavaConfig</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Konfigurasi ini berbeda dari dua sebelumnya. </font><font style="vertical-align: inherit;">Konfigurasi melalui anotasi menggunakan 2 opsi: JavaConfig dan anotasi atas kelas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Konteks yang sama digunakan di sini: </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AnnotationConfigApplicationContext ("package" /JavaConfig.class)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Ini bekerja tergantung pada apa yang diteruskan ke konstruktor. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam konteks </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AnnotationConfigApplicationContext</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ada 2 bidang pribadi:</font></font><br>
<br>
<ul>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pembaca AnnotatedBeanDefinitionReader akhir pribadi</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (berfungsi dengan JavaConfig);</font></font></li>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">private final ClassPathBeanDefinitionScanner scanne</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> r (memindai paket).</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kekhasan </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AnnotatedBeanDefinitionReader</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adalah ia bekerja dalam beberapa tahap:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pendaftaran semua </font><font style="vertical-align: inherit;">file </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">konfigurasi</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> untuk parsing lebih lanjut;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Daftarkan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BeanFactoryPostProcesso</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> r </font><font style="vertical-align: inherit;">khusus </font><font style="vertical-align: inherit;">, yaitu </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BeanDefinitionRegistryPostProcessor</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , yang menggunakan kelas </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ConfigurationClassParser</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font><font style="vertical-align: inherit;">mem-parsing JavaConfig dan membuat </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BeanDefinition</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pertimbangkan contoh sederhana:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">JavaConfig</span> </span>{<font></font>
    <font></font>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-meta">@Lazy</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> MainCharacter <span class="hljs-title">mainCharacter</span><span class="hljs-params">()</span></span>{<font></font>
        MainCharacter mainCharacter = <span class="hljs-keyword">new</span> MainCharacter();<font></font>
        mainCharacter.name = <span class="hljs-string">"Patric"</span>;
        <span class="hljs-keyword">return</span> mainCharacter;        <font></font>
   }<font></font>
}</code></pre><br>
<pre><code class="java hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>{<font></font>
<font></font>
     ApplicationContext javaConfigContext = <font></font>
               <span class="hljs-keyword">new</span> AnnotationConfigApplicationContext(JavaConfig.class);
     <span class="hljs-keyword">for</span> (String str : javaConfigContext.getBeanDefinitionNames()){<font></font>
          System.out.println(str);<font></font>
     }<font></font>
     printLoadedClasses(classFilter);<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami membuat file konfigurasi dengan nampan sesederhana mungkin. </font><font style="vertical-align: inherit;">Kami melihat apa yang akan dimuat: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/dh/ja/lc/dhjalckod1_f10h-vb_scdcali4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika dalam kasus Xml dan Groovy, sebanyak BeanDefinition dimuat seperti yang diumumkan, maka dalam kasus ini, baik BeanDefinition yang dideklarasikan maupun tambahan dimuat dalam proses meningkatkan konteks. </font><font style="vertical-align: inherit;">Dalam hal implementasi melalui JavaConfig, semua kelas dimuat dengan segera, termasuk kelas JavaConfig itu sendiri, karena itu sendiri merupakan sebuah kacang. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Poin lain: dalam hal konfigurasi Xml dan Groovy, 343 file diunggah, di sini terjadi 631 file tambahan yang lebih “berat”. </font><b><font style="vertical-align: inherit;">Langkah-langkah</font></b></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
kerja </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ClassPathBeanDefinitionScanner</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Paket yang ditentukan menentukan daftar file untuk pemindaian. </font><font style="vertical-align: inherit;">Semua file masuk ke direktori;</font></font></li>
<li>    ,  InputStream      <i>org.springframework.asm.ClassReader.class</i>;</li>
<li> 3-   ,        <i>org.springframework.core.type.filter.AnnotationTypeFilter</i>.   Spring  ,    <i>Component</i>    ,     <i>Component</i>;</li>
<li>   ,     BeanDefinition.</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Semua "keajaiban" bekerja dengan anotasi, seperti halnya dengan Xml dan Groovy, tepatnya terletak pada kelas </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ClassReader.class</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dari paket </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">springframework.asm</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Kekhasan pembaca ini adalah ia dapat bekerja dengan bytecode. </font><font style="vertical-align: inherit;">Artinya, pembaca mengambil InputStream dari bytecode, memindai dan mencari anotasi di sana. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pertimbangkan pemindai menggunakan contoh sederhana. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Buat anotasi Anda sendiri untuk mencari kelas yang sesuai:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">import</span> org.springframework.stereotype.Component
<span class="hljs-keyword">import</span> java.lang.annotation.*;
<span class="hljs-meta">@Target({ElementType.TYPE})</span>
<span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span>
<span class="hljs-meta">@Documented</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> MyBeanLoader{
       <span class="hljs-function">String <span class="hljs-title">value</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> ""</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami membuat 2 kelas: satu dengan anotasi </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Komponen</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> standar </font><font style="vertical-align: inherit;">, yang kedua dengan anotasi khusus:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-meta">@Component</span> 
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MainCharacter</span> </span>{
      <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> num = <span class="hljs-number">1</span>;
      <span class="hljs-meta">@Value("Silence")</span>
      <span class="hljs-keyword">public</span> String name;
      <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">MainCharacter</span><span class="hljs-params">()</span> </span>{ }</code></pre><br>
<pre><code class="java hljs">MyBeanLoader(<span class="hljs-string">"makerFilm"</span>)
<span class="hljs-meta">@Lazy</span> 
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FilmMaker</span> </span>{
      <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> staticInt = <span class="hljs-number">1</span>;
      <span class="hljs-meta">@Value("Silence")</span>
      <span class="hljs-keyword">public</span> String filmName;
      <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">FilmMaker</span><span class="hljs-params">()</span></span>{}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sebagai hasilnya, kami mendapatkan BeanDefinition yang dihasilkan untuk kelas-kelas ini dan berhasil memuat kelas-kelas.</font></font><br>
<br>
<pre><code class="java hljs">ApplicationContext annotationConfigContext =
       <span class="hljs-keyword">new</span> AnnotationConfigApplicationContext(...basePackages: <span class="hljs-string">"film"</span>);
<span class="hljs-keyword">for</span> (String str : annotationConfigContext.getBeanDefinitionNames()){<font></font>
     System.out.println(str);<font></font>
}<font></font>
printLoadedClasses(classFilter);</code></pre><br>
<img src="https://habrastorage.org/webt/k4/zz/kf/k4zzkfqlqqz5sprw3i49w59zjdu.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kesimpulan</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dari hal tersebut di atas, pertanyaan yang diajukan dapat dijawab sebagai berikut:</font></font><br>
<br>
<ol>
<li>   Spring   ?<br>
<br>
     ,     .    BeanDefinition,     :      ,     BeanDefinition’    .       BeanDefinition,      ..</li>
<li> Spring    ?<br>
<br>
     Java:            , ,      ,    .</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PS Saya berharap bahwa dalam posting ini saya bisa "membuka tabir kerahasiaan" dan menunjukkan secara rinci bagaimana pembentukan konteks pegas terjadi pada tahap pertama. </font><font style="vertical-align: inherit;">Ternyata tidak semuanya begitu "menakutkan". </font><font style="vertical-align: inherit;">Tetapi ini hanya sebagian kecil dari kerangka besar, yang berarti masih banyak hal baru dan menarik di masa depan.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id489218/index.html">Itu naif. Super: kode dan arsitektur gim sederhana</a></li>
<li><a href="../id489226/index.html">Metode untuk mengoptimalkan kueri LINQ di C # .NET</a></li>
<li><a href="../id489230/index.html">Apa itu kinerja aplikasi web?</a></li>
<li><a href="../id489232/index.html">Kembali ke Masa Depan Ponsel II</a></li>
<li><a href="../id489234/index.html">Bagaimana agar berhasil melewati segala pentest (saran buruk)</a></li>
<li><a href="../id489240/index.html">Fitur konferensi regional. Mengapa seorang pembicara harus meninggalkan MKAD?</a></li>
<li><a href="../id489242/index.html">"Lihat, ini sesuatu": replikasi DNA buatan sendiri</a></li>
<li><a href="../id489244/index.html">Pengembangan plugin untuk Zabbix Agent 2</a></li>
<li><a href="../id489246/index.html">Saya berumur 14 dan saya memutuskan untuk mengembangkan game</a></li>
<li><a href="../id489252/index.html">Sejarah Telegram: dari ide ke mata uang kripto sendiri</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>