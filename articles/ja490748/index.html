<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👖 🤲🏻 👩🏿‍🤝‍👩🏼 開発者の仕事、またはベンダーなしでハンドスキャナーをスキャンする方法 🚍 👨‍👨‍👧 👨🏽‍🤝‍👨🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="みなさん、こんにちは。
 
 今日は、Victor AntipovとIlya Aleshinが、Python PyUSBを介したUSBデバイスの使用経験と、リバースエンジニアリングについて少し説明します。
 
 
 
 バックグラウンド
 2019年、ロシア連邦政令第224号「識別によるタバコ製品の...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>開発者の仕事、またはベンダーなしでハンドスキャナーをスキャンする方法</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/X5RetailGroup/blog/490748/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">みなさん、こんにちは。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
今日は、Victor AntipovとIlya Aleshinが、Python PyUSBを介したUSBデバイスの使用経験と、リバースエンジニアリングについて少し説明します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/j4/ux/va/j4uxvafzrna4qe-37a6miqsyg1u.jpeg"><br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バックグラウンド</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2019年、ロシア連邦政令第224号「識別によるタバコ製品のラベル付けの規則と、タバコ製品に関連する識別による強制ラベル付けの対象となる商品の流通を監視するための州情報システムの導入の詳細について」が発効しました。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この文書では、2019年7月1日以降、メーカーはタバコの各パックにラベルを付ける必要があると説明しています。また、直接販売業者は、ユニバーサルトランスファードキュメント（UPD）のデザインを含むこれらの製品を受け取る必要があります。次に、ショップは、レジを介してラベル付き製品の販売を登録する必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、2020年7月1日以降、マークのないタバコ製品は禁止されています。つまり、タバコのすべてのパックには、特別なDatamatrixバーコードでラベルを付ける必要があります。そして-重要なポイント-Datamatrixは普通ではなく、逆になることがわかりました。つまり、白地に黒のコードではなく、その逆です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
スキャナーをテストしたところ、スキャナーのほとんどを再フラッシュ/再トレーニングする必要があることが判明しました。そうでない場合、スキャナーはこのバーコードでは正常に機能しません。私たちの会社には広大な地域に点在している多くの店舗があるため、この一連の出来事は私たちに深刻な頭痛をもたらしました。数万のキャッシュデスク-非常に短い時間。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
何をすべきか </font><font style="vertical-align: inherit;">2つのオプションがあります。</font><font style="vertical-align: inherit;">まず、施設のエンジニアが手動でスキャナーを再フラッシュして調整します。</font><font style="vertical-align: inherit;">第二に、リモートで作業します。できれば、一度に多くのスキャナーを一度にカバーします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初のオプションは明らかに、私たちには適していませんでした。エンジニアのフィールドトリップにお金を費やす必要があり、この場合、プロセスを制御および調整することは困難です。</font><font style="vertical-align: inherit;">しかし、最も重要なことは、人々が働くことです。つまり、潜在的に私たちは多くのミスを犯し、そしておそらく、締め切りに間に合わないでしょう。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2番目のオプションは、1つではなくても、すべての人に適しています。</font><font style="vertical-align: inherit;">一部のベンダーには、必要なすべてのオペレーティングシステムに必要なリモートフラッシュツールがありませんでした。</font><font style="vertical-align: inherit;">そして締め切りが迫っていたので、自分の頭で考えなくてはなりませんでした。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、Debian 9.x OS用のハンドヘルドスキャナー用のツールを開発した方法について説明します（すべてDebianのボックスオフィスがあります）。</font></font><br>
<br>
<h3> :   </h3><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ビクター・アンティポフは言う。</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ベンダーが提供する公式ユーティリティはWindowsで動作し、IEでのみ動作します。ユーティリティはスキャナーをフラッシュして設定できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ターゲットシステムがDebianであるため、Debianサーバーにusb-redirectorサーバーをインストールし、Windowsにusb-redirectorクライアントをインストールしました。 usb-redirectorユーティリティを使用して、スキャナーはLinuxマシンからWindowsマシンに転送されました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Windowsベンダーのユーティリティがスキャナーを確認し、通常どおりフラッシュしました。したがって、最初の結論が出されました。OSに依存するものは何もありません。問題は点滅プロトコルにあります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
OK。フラッシュがWindowsマシンで起動され、ダンプがLinuxマシンで削除されました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
彼らはダンプをWireSharkに詰め、そして...悲しかった（私はダンプの詳細の一部を省略します、彼らは興味がありません）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ダンプが示したもの：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/5c/ut/sa/5cutsausebu86kbucq6rfksz7wu.png"><br>
<br>
<img src="https://habrastorage.org/webt/9z/ex/jo/9zexjowdglq6cjc88ln5r6tlkcs.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wiresharkが判断するアドレス0000-0030は、USBサービス情報です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
パーツ0040-0070に興味がありました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MOCFT文字を除いて、1つの伝送フレームからは何も明らかではありませんでした。これらのシンボルは、ファームウェアファイルからのシンボルであり、フレームの終わりまでの残りのシンボルであることが判明しました（ファームウェアファイルが強調表示されています）</font></font><br>
<br>
<img src="https://habrastorage.org/webt/yb/ls/mf/yblsmf2htqk4n-lsa3u702yy5vm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次のフレームを見ました（サービス情報はここで削除され、ファームウェアファイルが強調表示されています）：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/r3/sr/ut/r3srutakf1ioytxspf1zurv9pww.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
何が明らかになりましたか？最初の2バイトがなんらかの定数であること。後続のすべてのブロックでこれが確認されましたが、送信ブロックが終了する前に：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/j7/t6/ux/j7t6uxe8auhqxaxp5azeolv5jwm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
定数が変更（強調表示）されたので、このフレームも気絶するようになり、不思議なことに、ファイルの一部がありました。ファイルの送信バイトのサイズは、1024バイトが転送されたことを示しています。残りのバイトの意味-私は再び知りませんでした。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まず、古いBBSニックネームのように、標準の転送プロトコルを改訂しました。 1024バイト、プロトコルは渡されません。彼は資材を研究し始め、1K Xmodemプロトコルに出くわしました。それは1024を送信することを許可しましたが、ニュアンスがあります。最初は128のみで、エラーがない場合にのみ、プロトコルは送信されるバイト数を増やしました。すぐに1024バイトの転送がありました。私は伝送プロトコル、特にXモデムを研究することにしました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
モデムには2つのバリエーションがありました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まず、CRC8をサポートするXMODEMパッケージのフォーマット（元のXMODEM）：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/wu/dq/7w/wudq7w7yg59duxo2ok3rcng5bga.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、CRC16をサポートするXMODEMパケット形式（XmodemCRC）：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/i2/cz/j3/i2czj3nd212vhlbms9uqrysd5xa.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SOH、パケット番号、CRC、およびパケットの長さを除いて、同じように見えます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私は2番目の送信ブロックの先頭を見ました（そして、ファームウェアファイルを見ましたが、1024バイトのインデントが付いています）：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/5v/lk/nb/5vlknbhbecr2d3d7uigb19dh_cg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
おなじみのヘッダーfd 3e 02を見ましたが、次の2バイトはすでに変更されています。それは01 feで、02 fdになりました。次に、2番目のブロックに02と番号が付けられていることに気づきました。つまり、私の前には送信ブロックの番号が付けられています。最初の1024回の送信は01、2回目は02、3回目は03と続きます（ただし、もちろん16進数）。しかし、feからfdへの変更はどういう意味ですか？目は1の減少を見ました。脳はプログラマが1ではなく0から数えることを思い出させました。この質問に対する答えは見つかりませんでした。しかし、私は2番目のブロックがどのように考慮されるかを理解しました。 2番目のブロックはFFに過ぎません-（マイナス）最初のブロックの数。したがって、2番目のブロックは= 02（FF-02）= 02 FDと指定されました。その後のダンプの読み取りは私の直感を裏付けました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その後、プログラムの以下の絵が出現し始めた：</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プログラムの先頭</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
fd 3e 02-Start </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
01 FE-送信カウンター</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
送信（34ブロック、1024バイトが送信</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
されます</font><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">fd 3e 1024バイトのデータ（30バイトのブロックに分割）。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
送信の終了</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
fd 25 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1024バイトに揃えるためのデータの残り。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ブロック転送終了フレームは次のようになります</font></font><br>
<br>
<img src="https://habrastorage.org/webt/dm/ee/t9/dmeet9sttaokhdirciuxag4p9y4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
。fd 25-ブロック転送の終了を知らせる信号。次の2f 52-1024バイトまでのファイルの残り。 2f 52は、プロトコルで判断すると、16ビットのCRCチェックサムです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
古いメモリに基づいて、ファイルから1024バイトを取り出して16ビットCRCを読み取るプログラムをCで作成しました。</font><font style="vertical-align: inherit;">プログラムの立ち上げにより、これは16ビットCRCではないことがわかりました。</font><font style="vertical-align: inherit;">再び昏迷-約3日間。</font><font style="vertical-align: inherit;">これまでずっと、チェックサムでないとしたらどうなるかを理解しようとしました。</font><font style="vertical-align: inherit;">英語のサイトを調べたところ、Xモデムは独自のチェックサム計算-CRC-CCITT（XModem）を使用していることがわかりました。</font><font style="vertical-align: inherit;">この計算のためのCの実装は見つかりませんでしたが、このチェックサムをオンラインで読むサイトを見つけました。</font><font style="vertical-align: inherit;">私のファイルの1024バイトをWebページにアップロードすることにより、サイトはファイルのチェックサムと完全に一致するチェックサムを表示しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
やったー！</font><font style="vertical-align: inherit;">最後のなぞなぞが解かれました。今度は自分でファームウェアを作成する必要がありました。</font><font style="vertical-align: inherit;">それから私は私の知識を（そしてそれらは私の頭にだけ残っていた）強力なツール-Pythonに精通しているIlyaに転送しました。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プログラム作成</font></font></h3><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ilya Aleshinによるナレーション。</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
適切な指示を受けて、私はとても「幸せ」でした。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
どこから始めますか？</font><font style="vertical-align: inherit;">そう、最初から。</font><font style="vertical-align: inherit;">a USBポートからのダンプ。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
USB-pcap </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://desowin.org/usbpcap/tour.htmlを</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">実行します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
デバイスが接続されているポートと、ダンプを保存するファイルを選択します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ga/ax/xp/gaaxxp3qdqajous7didfd7gwkg8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Windows用のネイティブEZConfigScanningソフトウェアがインストールされているマシンにスキャナーを接続します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ol/oo/le/olooleeirgestw3q0gzvhqvzr58.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その中に、デバイスにコマンドを送信するポイントがあります。</font><font style="vertical-align: inherit;">しかし、チームはどうですか？</font><font style="vertical-align: inherit;">どこで入手できますか？</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プログラムが開始すると、機器に自動的に問い合わせが行われます（これについては後で説明します）。</font><font style="vertical-align: inherit;">そして、公式の装備文書からのトレーニングバーコードがありました。</font><font style="vertical-align: inherit;">DEFALT。</font><font style="vertical-align: inherit;">これが私たちのチームです。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/8v/dv/gf/8vdvgfiuthogftttgzdsxym22_4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
必要なデータを受け取ります。</font><font style="vertical-align: inherit;">ワイヤーシャークからdump.pcapを開きます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
起動時にEZConfigScanningをブロックします。赤い点は注目すべき場所です。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/wp/ju/0x/wpju0xwxz9_hgex0jnnyttjxqpa.png"><br>
<br>
<img src="https://habrastorage.org/webt/nw/6s/so/nw6ssotdpggn37qvn9kvayxhxde.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらすべてを初めて見たとき、私は失望しました。さらに掘り下げるべき場所は不明です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ちょっとしたブレーンストーミングと、そしてそして…そして、ああ！ダンプでは、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">out</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">out</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
URB_INTERRUPTとは何かをGoogleで検索しました。これはデータ転送方式であることがわかりました。そして、そのような4つの方法があります：制御、割り込み、アイソクロナス、バルク。それらについては個別に読むことができます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、USBデバイスインターフェイスのエンドポイントアドレスは、「lsusb –v」コマンドまたはpyusbを使用して取得できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、このVIDを持つすべてのデバイスを見つける必要があります。 VID：PIDで具体的に検索できます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/fn/xp/i_/fnxpi_m69b43p6yzpeoh3atps0q.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次のようになります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/g0/h4/td/g0h4tdpscytduyzmj4xqe31r5s4.png"><br>
<br>
<img src="https://habrastorage.org/webt/d4/wf/5k/d4wf5k6asqr5nvofve-ntd5sm4g.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
だから、私たちは必要な情報を持っています：P_INFOコマンド。またはDEFALT、コマンドエンドポイント= 03を書き込む場所、および応答エンドポイント= 86を取得する場所をアドレス指定します。コマンドを16進数に変換するだけです。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/io/wf/ui/iowfuid0hhvl6q6zpb9kfds3tny.png"><br>
<br>
<img src="https://habrastorage.org/webt/0p/gr/2j/0pgr2jw1u6tj5vqetitjg3g6chw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すでにデバイスを見つけたので、それをカーネルから切断します... </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ji/xy/84/jixy849fy7l81g9tenjxpf7uymo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
...アドレス0x03のエンドポイントに書き込み、</font></font><br>
<br>
<img src="https://habrastorage.org/webt/qx/v0/nt/qxv0nttjmnddvekfmbnfq9vebfi.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
...アドレス0x86のエンドポイントからの応答を読み取ります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/kj/xn/e2/kjxne2x9ab6spmxnk2ac3bnroc4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
構造化された答え：</font></font><br>
<br>
<pre><code class="plaintext hljs">P_INFOfmt: 1<font></font>
mode: app<font></font>
app-present: 1<font></font>
boot-present: 1<font></font>
hw-sn: 18072B44CA<font></font>
hw-rev: 0x20<font></font>
cbl: 4<font></font>
app-sw-rev: CP000116BBA<font></font>
boot-sw-rev: CP000014BAD<font></font>
flash: 3<font></font>
app-m_name: Voyager 1450g<font></font>
boot-m_name: Voyager 1450g<font></font>
app-p_name: 1450g<font></font>
boot-p_name: 1450g<font></font>
boot-time: 16:56:02<font></font>
boot-date: Oct 16 2014<font></font>
app-time: 08:49:30<font></font>
app-date: Mar 25 2019<font></font>
app-compat: 289<font></font>
boot-compat: 288<font></font>
csum: 0x6986</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このデータは、dump.pcapにあります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/cr/z5/2y/crz52y_j0alhcohhokmry0bx7t8.png"><br>
<br>
<img src="https://habrastorage.org/webt/-s/np/cv/-snpcv4opok9jdsrj8thkshno_4.png"><br>
<br>
<img src="https://habrastorage.org/webt/qj/dq/zl/qjdqzlcwogon9yts12p5awr32ha.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
いいね！システムバーコードを16進数に変換します。すべて、トレーニング機能は準備ができています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ファームウェアをどうするかすべて同じように見えますが、ニュアンスがあります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
点滅しているプロセスの完全なダンプを削除したので、私たちは何を扱っていたかを大まかに理解しました。一般的な用語ではありますが、この通信がどのように行われるかを理解するのに実際に役立ったXMODEMに関する記事を次に示します。http：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">//microsin.net/adminstuff/others/xmodem-protocol-overview.html</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">読むこと</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">を</font></a><font style="vertical-align: inherit;">お勧めします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ダンプを見ると、フレームサイズが1024であり、URBデータのサイズが64 </font></font><br>
<br>
<img src="https://habrastorage.org/webt/wi/o6/uj/wio6ujyvlj_bnltlngxf24k9evk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
であることがわかります。したがって、1024/ </font><font style="vertical-align: inherit;">64の場合</font><font style="vertical-align: inherit;">、ブロック内に16行あり、ファームウェアファイルを1文字ずつ読み取り、ブロックを形成します。ブロックの1行に特殊文字fd3e02 +ブロック番号を追加します。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次の14行にはfd25 +が追加され、XMODEM.calc_crc（）を使用してブロック全体のチェックサムを計算し（「FF-1」はCSUMであることを理解するのに時間がかかりました）、最後の16行にはfd3eが追加されています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべて、ファームウェアファイルの読み取り、ブロックのヒット、スキャナーのカーネルからの切断、デバイスへの送信のようです。</font><font style="vertical-align: inherit;">しかし、それほど単純ではありません。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
NEWAPP = '\\ xfd \\ x0a \\ x16 \\ x4e \\ x2c \\ x4e \\ x45 \\ x57 \\ x41 \\ x50 \\ x50 \\ x0d'を送信して</font><font style="vertical-align: inherit;">、スキャナーをファームウェアモードにする必要があります</font><font style="vertical-align: inherit;">。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このコマンドはどこから来たのですか？</font><font style="vertical-align: inherit;">ダンプから。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/au/sd/nd/ausdnd16ikur6ajzdiyk9-ntklw.png"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、64の制限により、ブロック全体をスキャナーに送信することはできません。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/db/k6/qg/dbk6qgrapgsxiwdo9jyxqd0svwu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まあ、NEWAPPフラッシュモードのスキャナーは16進数も受け入れません。</font><font style="vertical-align: inherit;">したがって、各行を変換する必要がありますbytes_array</font></font><br>
<br>
<pre><code class="plaintext hljs">[253, 10, 22, 78, 44, 78, 69, 87, 65, 80, 80, 13, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、すでにこのデータをスキャナーに送信します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちは答えを得ます：</font></font><br>
<br>
<pre><code class="plaintext hljs">[2, 1, 0, 0, 0, 6, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
XMODEMに関する記事を確認すると、データが受け入れられていることが明らかになります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/po/fd/gj/pofdgjvcgns7oxdeonuldkqbptg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべてのブロックが転送された後、END_TRANSFER = '\ xfd \ x01 \ x04'の転送を完了します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まあ、これらのブロックは一般の人には何の情報も伝えないので、デフォルトではファームウェアを隠しモードにします。</font><font style="vertical-align: inherit;">そして念のために、tqdmを通じて進行状況バーを整理します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/da/18/g1/da18g1axnll2zps9qpx2s7opkha.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実際、残りは小さいです。</font><font style="vertical-align: inherit;">ボックスオフィスでの作業プロセスの速度を落とさず、ログを追加しないように、明確に定義された時間に大量複製用のスクリプトでソリューションをラップするだけです。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">合計</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
多くの時間とエネルギー</font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と頭の髪</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を費やして</font><font style="vertical-align: inherit;">、私たちは必要なソリューションを開発することができました。さらに、締め切りに間に合いました。</font><font style="vertical-align: inherit;">同時に、スキャナーが一斉に再フラッシュおよび再トレーニングされ、プロセス全体を明確に制御します。</font><font style="vertical-align: inherit;">同社は時間とお金を節約し、この種の機器のリバースエンジニアリングで非常に貴重な経験を積むことができました。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja490736/index.html">英語のボキャブラリーを学び、刺激するための9つの明確なツール</a></li>
<li><a href="../ja490738/index.html">Liskの置換原理</a></li>
<li><a href="../ja490740/index.html">*** sの欠陥は単なるランダム化ではありません</a></li>
<li><a href="../ja490742/index.html">ロボット工学の新時代が始まりました</a></li>
<li><a href="../ja490746/index.html">Yandex.Taxiでの評価：深刻なトピックに関する短い投稿</a></li>
<li><a href="../ja490750/index.html">ミハイル・サロシン。Golang Meetup。Watch +アプリケーションのバックエンドでGoを使用する</a></li>
<li><a href="../ja490754/index.html">Visual Studioコードコードエディター。初心者向けプラグインのセットアップとインストールに関する最も詳細なガイド</a></li>
<li><a href="../ja490756/index.html">Jenkinsをコードとしてデプロイする</a></li>
<li><a href="../ja490758/index.html">数学者は乱流の普遍的な法則を証明しました</a></li>
<li><a href="../ja490760/index.html">レイキャスティングビジュアルサーチ（RCVS）。ジオメトリが似ている3Dモデルを見つけるためのシンプルで高速なアルゴリズム</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>