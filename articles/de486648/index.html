<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚öôÔ∏è ‚ô®Ô∏è üëÇüèΩ AWS Lambda in Aktion in Java 11. Serverlos in die Produktion gehen üó®Ô∏è ü§úüèø üß•</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dieser Artikel enth√§lt anhand eines einfachen Beispiels eine Anleitung, wie Sie AWS Lambda schnell und problemlos verwenden k√∂nnen. Geeignet sowohl f√º...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>AWS Lambda in Aktion in Java 11. Serverlos in die Produktion gehen</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dins/blog/486648/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dieser Artikel enth√§lt anhand eines einfachen Beispiels eine Anleitung, wie Sie AWS Lambda schnell und problemlos verwenden k√∂nnen. </font><font style="vertical-align: inherit;">Geeignet sowohl f√ºr Entwickler, die √ºberhaupt nicht mit Lambda zusammengearbeitet haben, als auch f√ºr Entwickler, die Cloud kennen, um eine andere Vision f√ºr die Entwicklung serverloser Anwendungen zu evaluieren.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/bd/y8/lu/bdy8luzeox9qq09msokx8yzoba4.jpeg" alt="Bild"><br>
<a name="habracut"></a><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Einf√ºhrung</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hallo alle zusammen. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mein Name ist Alexander Gruzdev, ich bin Java Team Lead bei DINS. Seit mehr als zwei Jahren arbeite ich eng mit der AWS-Infrastruktur zusammen und habe Erfahrung sowohl beim Schreiben von Anwendungen f√ºr AWS als auch beim Bereitstellen dieser Anwendungen. Bei meiner Arbeit musste ich ElasticBeanstalk, ECS, Fargate, EKS und nat√ºrlich AWS Lambda verwenden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jeder dieser Dienste ist auf seine Weise gut, und im Rahmen dieses Artikels werde ich nicht dringend darauf dr√§ngen, nur AWS Lambda als Ersatz f√ºr alle anderen Optionen zu verwenden. Ich m√∂chte nur zeigen, wie einfach es ist, Lambda zu verwenden, und in welchen F√§llen Sie die Vorteile der Verwendung von Lambda erhalten.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jeder, vom Entwickler bis zum Manager, m√∂chte einen klaren Prozess f√ºr die Bereitstellung von √Ñnderungen f√ºr Kunden. </font><font style="vertical-align: inherit;">Je transparenter dieser Weg und je weniger Aufwand erforderlich ist, desto rentabler. </font><font style="vertical-align: inherit;">In den meisten F√§llen m√∂chten Entwickler und Tester nicht wissen, wo die Anwendung bereitgestellt wird, welche Hardware ausgew√§hlt werden soll, in welcher Region Sie Replikate ablegen m√∂chten usw. </font><font style="vertical-align: inherit;">In der folgenden Abbildung sehen Sie die Serviceklasse ‚ÄûaaS‚Äú (als Service), wobei AWS Lambda die FaaS-Kategorie darstellt.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/z8/nj/wl/z8njwlqjrgatljwptthtqe9ealu.png" alt="Bild"><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FaaS auf den Punkt gebracht</font></font></b>
                        <div class="spoiler_text">FaaS ,            .     ,  , CRUD   C, R, U, D     Create   Read.      ,   ‚Äî  .<br>
</div>
                    </div><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Idee</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um zu demonstrieren, was die Entwicklung einer serverlosen L√∂sung ist, habe ich mich f√ºr ein eher banales Beispiel entschieden. </font><font style="vertical-align: inherit;">Ich denke, Sie haben auf vielen Websites ein Kontaktformular f√ºr Kontakte gesehen, auf dem Sie Ihre E-Mails oder Ihr Telefon hinterlassen und eine Frage stellen k√∂nnen, die sp√§ter beantwortet werden soll. </font><font style="vertical-align: inherit;">Der Bildschirm unten, das Formular ist nicht super, aber das Thema dieses Artikels ist nicht Materialdesign. </font></font><br>
<img src="https://habrastorage.org/webt/gv/5g/iv/gv5givju7glj8vftkb1cdhupdiw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie dieses Formular ausf√ºllen, wartet ein potenzieller Kunde auf einen Anruf oder einen Brief von Ihnen. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Von der technischen Seite ben√∂tigen Sie:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Daten aus dem Formular in der Datenbank speichern;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Senden Sie einen Brief an einen Agenten, der die Frage beantwortet.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Schreiben Sie m√∂glicherweise einen anderen Dienst, bei dem der Agent die auf der Grundlage derselben Datenbank geleistete Arbeit markiert (nicht im Umfang des Artikels enthalten).</font></font></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Umsetzung der Idee ist auf </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitHub</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> verf√ºgbar </font><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Architektur</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das erste, was uns bei der Implementierung einf√§llt, ist das, was wir brauchen:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Maschine unter hinten, vorne, Bilder usw.,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Auto mit Basis</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Maschine mit E-Mail-Service.</font></font></li>
</ul><br>
<br>
<img src="https://habrastorage.org/webt/9a/7h/83/9a7h83iyieeicpht4-bcwy8l-ja.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die R√ºckseite und die Basis m√ºssen auf eine gute Weise repliziert werden, aber nehmen wir an, wir tun dies f√ºr unseren Mini-Store und die Belastung dieses Formulars ist minimal. </font><font style="vertical-align: inherit;">Daher k√∂nnen alle diese Maschinen zu einer zusammengefasst und in einem einzigen Satz bereitgestellt werden. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Da wir jedoch Serverless in Betracht ziehen, bauen wir die Architektur vollst√§ndig auf serverlosen Komponenten auf. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Egal wie vielversprechend Serverless auch klingen mag, wir alle verstehen, dass die Server immer noch hier sind, sie sind einfach aus Ihrem Sichtfeld verschwunden. </font><font style="vertical-align: inherit;">Und jetzt, wo die Cloud funktioniert, k√∂nnen Sie die Aufgaben erledigen, die Sie selbst erledigen k√∂nnen. </font><font style="vertical-align: inherit;">Versuchen wir jedoch, nur solche serverlosen Komponenten zu verwenden: </font></font><br>
<img src="https://habrastorage.org/webt/mf/iw/6i/mfiw6if-6nlss4pl-brkgxenxuc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Diagramm zeigt eine sehr klare Trennung der Funktionalit√§t jeder Komponente.</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AWS Lambda ist die Hauptkomponente, die Code / Logik enth√§lt.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">S3 ist f√ºr das Speichern statischer Ressourcen und JS-Skripte verantwortlich.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CloudFront - f√ºr Caching-Mechanismen und multiregionale Unterst√ºtzung,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SES - E-Mail-Service,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DynamoDB - die Basis zum Speichern von Daten aus dem Formular (von wem, welcher Frage, wohin die Antwort gesendet werden soll),</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gateway API - HTTP API f√ºr unser Lambda,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Route53 - wird ben√∂tigt, wenn Sie einen sch√∂nen Domainnamen hinzuf√ºgen m√∂chten.</font></font></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nicht alle dieser Komponenten werden in unserer n√§chsten Anleitung verwendet, um den Artikel nicht zu dehnen. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Route53 und CloudFront sind ziemlich einfache Komponenten, √ºber die Sie separat lesen k√∂nnen. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ein kleiner Spoiler, der uns eine solche L√∂sung gibt:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir entfernen uns von der Unterst√ºtzung von EC2-Maschinen, kein Debuggen √ºber ssh,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Einfache Konfiguration: Konfigurieren Sie Drosselung / Caching / Zugriffe mit einem Klick.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unterst√ºtzt Zugriffsrichtlinien: Rechte einschr√§nken und Zugriff gew√§hren,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Protokollierung / √úberwachung ab Werk,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zahlen Sie nur f√ºr verbrauchte Ressourcen / Anfragen.</font></font></li>
</ul><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Demo</font></font></h1><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ausbildung</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um mit der Entwicklung unserer Serverless-L√∂sung beginnen zu k√∂nnen, m√ºssen Sie die folgenden Anforderungen erf√ºllen:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aktives AWS-Konto</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aws-cli</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sam-Cli</font></font></a></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jdk 11</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gradle</font></font></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nach der Installation aller oben genannten Tools m√ºssen Sie Ihre aws-cli f√ºr den Remotezugriff auf AWS konfigurieren. </font><font style="vertical-align: inherit;">Folgen Sie den </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anweisungen</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Dazu muss ein neuer Benutzer erstellt und sein Zugriffsschl√ºssel und sein geheimer Schl√ºssel entladen werden.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Projektmontage</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. Erstellen Sie ein Projekt aus einer Vorlage</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√ñffnen Sie das Verzeichnis f√ºr das zuk√ºnftige Projekt und starten Sie von dort aus die SAM CLI. </font><font style="vertical-align: inherit;">Befolgen Sie die Anweisungen: </font></font><br>
<img src="https://habrastorage.org/webt/kn/gu/7f/kngu7fr3q_h_7t7bq-ygr7baccs.png"><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hinweis: Abh√§ngig von der SAM-CLI-Version k√∂nnen die Befehle geringf√ºgig abweichen, sie bleiben jedoch alle intuitiv. </font><font style="vertical-align: inherit;">W√§hlen Sie einfach diejenigen aus, die den oben verwendeten am √§hnlichsten sind. </font><font style="vertical-align: inherit;">Sie k√∂nnen auch ein anderes Build-Tool ausw√§hlen, wenn Gradle nicht f√ºr Sie geeignet ist. </font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Projekt "Hallo Welt!" </font><font style="vertical-align: inherit;">bereit. </font><font style="vertical-align: inherit;">Jetzt k√∂nnen Sie den Namen des Projekts und der Pakete, Abh√§ngigkeiten und den Quellcode bearbeiten.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. Besch√§ftigen wir uns mit Sucht</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
F√ºgen Sie build.gradle die folgenden Abh√§ngigkeiten hinzu:</font></font><br>
<pre><code class="javascript hljs">dependencies {
    <span class="hljs-comment">// AWS</span>
    implementation group: <span class="hljs-string">'com.amazonaws.serverless'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'aws-serverless-java-container-core'</span>, <span class="hljs-attr">version</span>: <span class="hljs-string">'1.4'</span>
    implementation group: <span class="hljs-string">'com.amazonaws'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'aws-lambda-java-core'</span>, <span class="hljs-attr">version</span>: <span class="hljs-string">'1.2.0'</span>
    implementation group: <span class="hljs-string">'com.amazonaws'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'aws-java-sdk-ses'</span>, <span class="hljs-attr">version</span>: <span class="hljs-string">'1.11.670'</span>
    implementation group: <span class="hljs-string">'com.amazonaws'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'aws-java-sdk-dynamodb'</span>, <span class="hljs-attr">version</span>: <span class="hljs-string">'1.11.670'</span>
    implementation group: <span class="hljs-string">'com.amazonaws'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'aws-lambda-java-log4j2'</span>, <span class="hljs-attr">version</span>: <span class="hljs-string">'1.1.0'</span><font></font>
<font></font>
    <span class="hljs-comment">// Utils</span>
    implementation group: <span class="hljs-string">'com.fasterxml.jackson.core'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'jackson-core'</span>, <span class="hljs-attr">version</span>: <span class="hljs-string">'2.10.0'</span>
    implementation group: <span class="hljs-string">'commons-io'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'commons-io'</span>, <span class="hljs-attr">version</span>: <span class="hljs-string">'2.6'</span><font></font>
<font></font>
    <span class="hljs-comment">// Test</span>
    testImplementation group: <span class="hljs-string">'org.mockito'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'mockito-core'</span>, <span class="hljs-attr">version</span>: <span class="hljs-string">'3.1.0'</span>
    testImplementation group: <span class="hljs-string">'org.powermock'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'powermock-api-mockito2'</span>, <span class="hljs-attr">version</span>: <span class="hljs-string">'2.0.4'</span>
    testImplementation group: <span class="hljs-string">'org.powermock'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'powermock-module-junit4'</span>, <span class="hljs-attr">version</span>: <span class="hljs-string">'2.0.4'</span>
    testImplementation group: <span class="hljs-string">'junit'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'junit'</span>, <span class="hljs-attr">version</span>: <span class="hljs-string">'4.12'</span><font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die wichtigsten sind das AWS SDK. </font><font style="vertical-align: inherit;">Mit ihnen k√∂nnen Sie mit bestimmten Diensten wie SES, DynamoDB usw. arbeiten.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. Wir schreiben ein Lambda</font></font></h3><br>
<ul>
<li><div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir √§ndern die Vorlagenanforderungs- und Antwortklassen f√ºr RequestHandler in AwsProxyRequest und ContactUsProxyResponse.</font></font></b>
                        <div class="spoiler_text"><pre><code class="java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">App</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">RequestHandler</span>&lt;<span class="hljs-title">AwsProxyRequest</span>, <span class="hljs-title">ContactUsProxyResponse</span>&gt;
...
<span class="hljs-title">public</span> <span class="hljs-title">ContactUsProxyResponse</span> <span class="hljs-title">handleRequest</span>(<span class="hljs-title">AwsProxyRequest</span> <span class="hljs-title">request</span>, <span class="hljs-title">Context</span> <span class="hljs-title">context</span>) </span></code></pre><br>
</div>
                    </div></li>
<li><div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">  AwsClientFactory   AWS SDK-.</b>
                        <div class="spoiler_text"><pre><code class="java hljs"><span class="hljs-comment">/**
 * Just an util class for an eager initialization of sdk clients.
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AwsClientFactory</span> </span>{<font></font>
<font></font>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Logger LOG = LogManager.getLogger(AwsClientFactory.class);<font></font>
<font></font>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> AmazonSimpleEmailService sesClient;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> DynamoDB dynamoDB;<font></font>
<font></font>
    /**<font></font>
     * AWS regions should be env variables <span class="hljs-keyword">if</span> you want to generalize the solution.<font></font>
     */<font></font>
    AwsClientFactory() {<font></font>
        LOG.debug("AWS clients factory initialization.");<font></font>
        sesClient = AmazonSimpleEmailServiceClient.builder().withRegion(Regions.EU_WEST_1).build();<font></font>
        AmazonDynamoDB dynamoDBClient = AmazonDynamoDBClientBuilder.standard().withRegion(Regions.EU_WEST_1).build();<font></font>
        dynamoDB = <span class="hljs-keyword">new</span> DynamoDB(dynamoDBClient);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function">DynamoDB <span class="hljs-title">getDynamoDB</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> dynamoDB;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function">AmazonSimpleEmailService <span class="hljs-title">getSesClient</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> sesClient;<font></font>
    }<font></font>
<font></font>
}<font></font>
</code></pre><br>
</div>
                    </div></li>
<li><div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">    ObjectMapper   .</b>
                        <div class="spoiler_text"><pre><code class="java hljs">
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> ObjectMapper OBJECT_MAPPER = <span class="hljs-keyword">new</span> ObjectMapper();
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> AwsClientFactory AWS_CLIENT_FACTORY = <span class="hljs-keyword">new</span> AwsClientFactory();
</code></pre><br>
</div>
                    </div></li>
<li><div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">         .</b>
                        <div class="spoiler_text"><pre><code class="java hljs">
 <span class="hljs-function"><span class="hljs-keyword">private</span> SendEmailResult <span class="hljs-title">sendEmail</span><span class="hljs-params">(ContactUsRequest contactUsRequest)</span> </span>{<font></font>
        String emailTemplate = getEmailTemplate();<font></font>
        String email = fillTemplate(emailTemplate, contactUsRequest);<font></font>
<font></font>
        SendEmailRequest sendEmailRequest =<font></font>
                <span class="hljs-keyword">new</span> SendEmailRequest(<font></font>
                        System.getenv(<span class="hljs-string">"SENDER_EMAIL"</span>),
                        <span class="hljs-keyword">new</span> Destination(List.of(System.getenv(<span class="hljs-string">"RECIPIENT_EMAIL"</span>))),
                        <span class="hljs-keyword">new</span> Message()<font></font>
                                .withSubject(<font></font>
                                        <span class="hljs-keyword">new</span> Content()<font></font>
                                                .withCharset(UTF_8.name())<font></font>
                                                .withData(contactUsRequest.getSubject()))<font></font>
                                .withBody(<span class="hljs-keyword">new</span> Body()<font></font>
                                        .withHtml(<span class="hljs-keyword">new</span> Content()<font></font>
                                                .withCharset(UTF_8.name())<font></font>
                                                .withData(email))));<font></font>
        LOG.info(<span class="hljs-string">"Email template is ready"</span>);
        <span class="hljs-keyword">return</span> AWS_CLIENT_FACTORY.getSesClient().sendEmail(sendEmailRequest);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">private</span> String <span class="hljs-title">fillTemplate</span><span class="hljs-params">(String emailTemplate, ContactUsRequest contactUsRequest)</span> </span>{
        <span class="hljs-keyword">return</span> String.format(<font></font>
                emailTemplate,<font></font>
                contactUsRequest.getUsername(),<font></font>
                contactUsRequest.getEmail(),<font></font>
                contactUsRequest.getPhone(),<font></font>
                contactUsRequest.getQuestion());<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">private</span> String <span class="hljs-title">getEmailTemplate</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">return</span> IOUtils.toString(<font></font>
                    Objects.requireNonNull(<span class="hljs-keyword">this</span>.getClass().getClassLoader()<font></font>
                                               .getResourceAsStream(<span class="hljs-string">"email_template.html"</span>)),<font></font>
                    UTF_8);<font></font>
        } <span class="hljs-keyword">catch</span> (IOException e) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(<span class="hljs-string">"Loading an email template failed."</span>, e);<font></font>
        }<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addEmailDetailsToDb</span><span class="hljs-params">(ContactUsRequest contactUsRequest, SendEmailResult sendEmailResult)</span> </span>{<font></font>
        AWS_CLIENT_FACTORY.getDynamoDB().getTable(<span class="hljs-string">"ContactUsTable"</span>)<font></font>
                          .putItem(<span class="hljs-keyword">new</span> Item()<font></font>
                                  .withPrimaryKey(<span class="hljs-string">"Id"</span>, sendEmailResult.getMessageId())<font></font>
                                  .withString(<span class="hljs-string">"Subject"</span>, contactUsRequest.getSubject())<font></font>
                                  .withString(<span class="hljs-string">"Username"</span>, contactUsRequest.getUsername())<font></font>
                                  .withString(<span class="hljs-string">"Phone"</span>, contactUsRequest.getPhone())<font></font>
                                  .withString(<span class="hljs-string">"Email"</span>, contactUsRequest.getEmail())<font></font>
                                  .withString(<span class="hljs-string">"Question"</span>, contactUsRequest.getQuestion()));<font></font>
}<font></font>
</code></pre><br>
</div>
                    </div></li>
<li><div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">         .</b>
                        <div class="spoiler_text"><pre><code class="java hljs">
<span class="hljs-function"><span class="hljs-keyword">private</span> ContactUsProxyResponse <span class="hljs-title">buildResponse</span><span class="hljs-params">(<span class="hljs-keyword">int</span> statusCode, String body)</span> </span>{<font></font>
        ContactUsProxyResponse awsProxyResponse =<font></font>
                <span class="hljs-keyword">new</span> ContactUsProxyResponse();<font></font>
        awsProxyResponse.setStatusCode(statusCode);<font></font>
        awsProxyResponse.setBody(getBodyAsString(body));<font></font>
        awsProxyResponse.addHeader(CONTENT_TYPE, ContentType.APPLICATION_JSON.toString());<font></font>
        awsProxyResponse.addHeader(<span class="hljs-string">"Access-Control-Allow-Origin"</span>, <span class="hljs-string">"*"</span>);
        <span class="hljs-keyword">return</span> awsProxyResponse;<font></font>
}<font></font>
<font></font>
 <span class="hljs-function"><span class="hljs-keyword">private</span> String <span class="hljs-title">getBodyAsString</span><span class="hljs-params">(String body)</span> </span>{
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">return</span> OBJECT_MAPPER.writeValueAsString(<span class="hljs-keyword">new</span> ContactUsResponseBody(body));<font></font>
        } <span class="hljs-keyword">catch</span> (JsonProcessingException e) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(<span class="hljs-string">"Writing ContactUsResponseBody as string failed."</span>, e);<font></font>
        }<font></font>
}<font></font>
</code></pre><br>
</div>
                    </div></li>
<li><div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">    .      ¬´// WARMING UP¬ª.</b>
                        <div class="spoiler_text"><pre><code class="java hljs">
<span class="hljs-keyword">if</span> (Optional.ofNullable(request.getMultiValueHeaders()).map(headers -&gt; headers.containsKey(<span class="hljs-string">"X-WARM-UP"</span>)).orElse(FALSE)) {<font></font>
            LOG.info(<span class="hljs-string">"Lambda was warmed up"</span>);
            <span class="hljs-keyword">return</span> buildResponse(<span class="hljs-number">201</span>, <span class="hljs-string">"Lambda was warmed up. V1"</span>);<font></font>
}<font></font>
</code></pre><br>
</div>
                    </div></li>
<li><div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">         handleRequest()</b>
                        <div class="spoiler_text"><pre><code class="java hljs">
<span class="hljs-meta">@Override</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> ContactUsProxyResponse <span class="hljs-title">handleRequest</span><span class="hljs-params">(AwsProxyRequest request, Context context)</span> </span>{<font></font>
        LOG.info(<span class="hljs-string">"Request was received"</span>);<font></font>
        LOG.debug(getAsPrettyString(request));<font></font>
<font></font>
        <span class="hljs-keyword">if</span> (Optional.ofNullable(request.getMultiValueHeaders()).map(headers -&gt; headers.containsKey(<span class="hljs-string">"X-WARM-UP"</span>)).orElse(FALSE)) {<font></font>
            LOG.info(<span class="hljs-string">"Lambda was warmed up"</span>);
            <span class="hljs-keyword">return</span> buildResponse(<span class="hljs-number">201</span>, <span class="hljs-string">"Lambda was warmed up. V1"</span>);<font></font>
        }<font></font>
<font></font>
        ContactUsRequest contactUsRequest = getContactUsRequest(request);<font></font>
<font></font>
        SendEmailResult sendEmailResult = sendEmail(contactUsRequest);<font></font>
        LOG.info(<span class="hljs-string">"Email was sent"</span>);<font></font>
<font></font>
        addEmailDetailsToDb(contactUsRequest, sendEmailResult);<font></font>
        LOG.info(<span class="hljs-string">"DB is updated"</span>);<font></font>
<font></font>
        <span class="hljs-keyword">return</span> buildResponse(<span class="hljs-number">200</span>,<font></font>
                String.format(<span class="hljs-string">"Message %s has been sent successfully."</span>, sendEmailResult.getMessageId()));<font></font>
}<font></font>
</code></pre><br>
</div>
                    </div></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die grundlegende Logik ist recht einfach, daher denke ich nicht, dass es sich lohnt, sie im Detail zu beschreiben. Es gibt einige Punkte, die es wert sind, beachtet zu werden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der erste ist die Protokollierung. Eines der Argumente der Context-Lambda-Methode enth√§lt viele Zusatzinformationen sowie einen Logger. Daher k√∂nnen Sie keinen separaten Logger erstellen, sondern den bereitgestellten Lambda-Kontext verwenden. Dazu reicht es aus, vor der Verwendung aufzurufen:</font></font><br>
<blockquote><code>LambdaLogger logger = context.getLogger(); </code></blockquote><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der zweite Punkt ist das Aufw√§rmen. Da das Erstellen einer ausf√ºhrbaren Umgebung f√ºr ein Lambda verz√∂gert ist, dauert das Starten der JVM, das Laden des Klassenpfads und das Ausf√ºhren des Codes einige Zeit. Der erste Aufruf kann einige Sekunden dauern, was nicht gut ist, wenn Sie verschiedene synchrone APIs schreiben. In solchen F√§llen k√∂nnen Sie AWS selbst mitteilen, dass Sie mehrere Lambda-Instanzen in Alarmbereitschaft halten m√ºssen. Dies erfordert jedoch, dass jemand ein Lambda anruft. Wenn wir dies mit der Basisversion des Codes tun, senden wir tats√§chlich einen Brief und schreiben einige ungenaue Daten in die Datenbank.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um dies zu vermeiden, k√∂nnen wir eine Art Anforderungsverarbeitung hinzuf√ºgen, um die tats√§chliche Anforderung von der Aufw√§rmanforderung zu unterscheiden. Zum Beispiel k√∂nnen wir der Anfrage einen speziellen Header hinzuf√ºgen. In unserem Fall wird der Header "X-WARM-UP" mit einem beliebigen Wert verwendet - um zu verstehen, dass dies eine Aufw√§rmanforderung ist und wir nur eine Antwort zur√ºckgeben m√ºssen, ohne die Gesch√§ftslogik auszuf√ºhren.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Letzte, worauf ich aufmerksam machen m√∂chte, ist die Verwendung statischer Variablen. </font><font style="vertical-align: inherit;">Dies macht in unserem Fall nicht die Stateful-Lambda-Instanz, sondern erm√∂glicht lediglich die Wiederverwendung vorhandener und initialisierter Objekte. </font><font style="vertical-align: inherit;">Wenn sich die Objekte, die Sie statisch initialisieren m√∂chten, w√§hrend der Ausf√ºhrung des Codes √§ndern, versuchen Sie erneut zu √ºberlegen, ob dies den Betrieb nachfolgender Aufrufe des Lambda beeintr√§chtigt. </font><font style="vertical-align: inherit;">Wenn diese Objekte w√§hrend der Initialisierung Umgebungsvariablen verwenden, sollten Sie sie nicht statisch machen.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4. Wir schreiben Tests</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lambda-Code kann durch dieselben Testarten abgedeckt werden, die Sie in den meisten F√§llen verwenden. </font><font style="vertical-align: inherit;">Um zu verhindern, dass der Artikel noch weiter w√§chst, werde ich im n√§chsten Artikel √ºber das Testen von AWS Lambda und die lokale Entwicklung das Testen von Anwendungen ohne Server behandeln. </font><font style="vertical-align: inherit;">Obwohl Unit-Tests bereits im </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Repository</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> verf√ºgbar sind </font><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5. Wir schreiben eine Vorlage f√ºr SAM-Ressourcen</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nachdem wir unser Lambda lokal geschrieben und getestet haben, m√ºssen wir eine SAM-Vorlage schreiben, um alle diese Ressourcen in AWS bereitzustellen.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ein bisschen √ºber SAM</font></font></b>
                        <div class="spoiler_text">Serverless Application Model ‚Äì     serverless .  ,      CloudFormation DSL,     ‚Äì   Lambda, Gateway, DynamoDB  . . <br>
SAM, CloudFormation, Terraform ‚Äì   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">IaC-</a>. SAM     Serverless-,   Terraform        . <br>
 Terraform   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">    DINS</a>.<br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Schauen wir uns an, welche Ressourcen wir in der </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SAM-Vorlage</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> deklarieren m√ºssen </font><font style="vertical-align: inherit;">. </font></font><br>
<br>
<i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AWS :: Serverless :: Function</font></font></b></i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Die Hauptfunktionen sind f√ºr uns bereits ausgef√ºllt, wenn wir SAM init zum Erstellen des Projekts verwendet haben. </font><font style="vertical-align: inherit;">Aber so sehen sie in meinem Beispiel aus:</font></font><br>
<pre><code class="plaintext hljs">CodeUri: contact-us-function<font></font>
Handler: com.gralll.sam.App::handleRequest<font></font>
Runtime: java8<font></font>
MemorySize: 256<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hier denke ich, dass alles klar genug ist. </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CodeUri</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ist das Verzeichnis mit unserem </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Handler-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Lambda </font><font style="vertical-align: inherit;">- der vollst√§ndige Pfad zur </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Runtime-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Methode </font><font style="vertical-align: inherit;">- auf dem das </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MemorySize-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Lambda geschrieben ist </font><font style="vertical-align: inherit;">- spricht f√ºr sich. </font></font><br>
<br>
<i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apropos Speicher</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : Im Lambda stehen bis zu 3 GB RAM zur Verf√ºgung, was einer Ressource von 2 CPUs entspricht. Das hei√üt, Sie k√∂nnen die CPU nicht separat einstellen, sondern nur die Speichermenge erh√∂hen / verringern.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Der n√§chste Block wird ben√∂tigt, um die Bereitstellungsmethode auszuw√§hlen.</font></font><br>
<pre><code class="plaintext hljs">AutoPublishAlias: live<font></font>
DeploymentPreference:<font></font>
  Type: Canary10Percent10Minutes<font></font>
</code></pre><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AutoPublishAlias</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Erm√∂glicht das </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hinzuf√ºgen eines Alias</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> zu jeder neu bereitgestellten Version </font><font style="vertical-align: inherit;">. Dies ist erforderlich, um die kanarische Bereitstellung zu implementieren. </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Canary10Percent10Minutes</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - eine Art der Bereitstellung, mit der Sie zwei Versionen des Lambda gleichzeitig </font><i><font style="vertical-align: inherit;">speichern k√∂nnen</font></i><font style="vertical-align: inherit;"> : die alte und die neue, aber nur 10% des Datenverkehrs auf die neue umleiten. Wenn in zehn Minuten keine Probleme auftreten, wird auch der Rest des Datenverkehrs auf die neue Version umgeleitet. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Weitere Informationen zur Verwendung erweiterter Funktionen finden Sie </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">auf der SAM-Seite</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Als n√§chstes folgen die Umgebungsvariablen, die aus dem Code verwendet werden. Danach ein weiterer Block f√ºr Lambda:</font></font><br>
<pre><code class="plaintext hljs">Events:<font></font>
  ContactUs:<font></font>
    Type: Api<font></font>
    Properties:<font></font>
      Path: /contact<font></font>
      Method: post<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Darin m√ºssen wir die Ausl√∂ser f√ºr das Aufrufen eines Lambda beschreiben. In unserem Fall handelt es sich um </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API-Gateway-Anforderungen</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dies ist eine ziemlich vereinfachte Form der Beschreibung der API, aber es reicht aus, wenn die neu erstellte Gateway-API alle </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">POST- / Kontaktanforderungen</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> an unser Lambda </font><font style="vertical-align: inherit;">umleitet </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nat√ºrlich m√ºssen wir die Sicherheitsaspekte beschreiben. Das erstellte Lambda hat standardm√§√üig keinen Zugriff auf die Datenbank oder den E-Mail-Dienst. Wir m√ºssen also explizit vorschreiben, was erlaubt ist. Es gibt </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">verschiedene M√∂glichkeiten</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , innerhalb von AWS Zugriff zu gew√§hren. Wir werden ressourcenbasierte Richtlinien verwenden:</font></font><br>
<pre><code class="plaintext hljs">Policies:<font></font>
  - AWSLambdaExecute<font></font>
  - Version: '2012-10-17'<font></font>
    Statement:<font></font>
      - Effect: Allow<font></font>
        Action:<font></font>
          - ses:SendEmail<font></font>
          - ses:SendRawEmail<font></font>
        Resource: 'arn:aws:ses:eu-west-1:548476639829:identity/aleksandrgruzdev11@gmail.com'<font></font>
      - Effect: Allow<font></font>
        Action:<font></font>
          - dynamodb:List*<font></font>
        Resource: '*'<font></font>
      - Effect: Allow<font></font>
        Action:<font></font>
          - dynamodb:Get*<font></font>
          - dynamodb:PutItem<font></font>
          - dynamodb:DescribeTable<font></font>
        Resource: 'arn:aws:dynamodb:*:*:table/ContactUsTable'<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bitte beachten Sie, dass wir f√ºr die Datenbanktabelle einen bestimmten Namen angegeben haben. Daher m√ºssen wir eine Tabelle mit demselben Namen erstellen. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In Bezug auf SES: Sie sehen meine E-Mail-Adresse. In Ihrem Fall muss es Ihre eigene best√§tigte Adresse sein. Wie das geht, erfahren Sie </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hier</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gleich danach k√∂nnen Sie den Identit√§ts-ARN dieser Ressource finden, indem Sie auf die erstellte Adresse klicken und diese im obigen Beispiel durch die E-Mail ersetzen. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sie haben das Lambda irgendwie herausgefunden. Fahren wir nun mit der Datenbank fort. </font></font><br>
<br>
<b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AWS :: Serverless :: SimpleTable</font></font></i></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
F√ºr unsere Aufgaben erstellen wir nur eine </font><b><i><font style="vertical-align: inherit;">ContactUsTable-</font></i></b><font style="vertical-align: inherit;"> Tabelle:</font></font><br>
<pre><code class="plaintext hljs">ContactUsTable:<font></font>
  Type: AWS::Serverless::SimpleTable<font></font>
  Properties:<font></font>
    PrimaryKey:<font></font>
      Name: Id<font></font>
      Type: String<font></font>
    TableName: ContactUsTable<font></font>
    ProvisionedThroughput:<font></font>
      ReadCapacityUnits: 2<font></font>
      WriteCapacityUnits: 2<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Von den erforderlichen Feldern - nur ID und au√üerdem ReadCapacityUnits und WriteCapacityUnits. </font><font style="vertical-align: inherit;">Wir werden nicht im Detail darauf eingehen, welche Werte zu w√§hlen sind, da dies auch ein ziemlich umfangreiches Thema ist. </font><font style="vertical-align: inherit;">Sie k√∂nnen es </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hier</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> lesen </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">F√ºr eine Testanwendung sind auch kleine Werte in der Gr√∂√üenordnung von 1-2 ausreichend. </font></font><br>
<br>
<b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Globale</font></font></i></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Allgemeine Parameter k√∂nnen in diesem Block entfernt werden, wenn Sie beispielsweise mehrere Ressourcen vom Typ Funktion oder API deklarieren.</font></font><br>
<pre><code class="plaintext hljs">Globals:<font></font>
  Function:<font></font>
    Timeout: 15<font></font>
  Api:<font></font>
    Cors:<font></font>
      AllowOrigin: "'*'"<font></font>
      AllowHeaders: "'Content-Type,X-WARM-UP,X-Amz-Date,Authorization,X-Api-Key'"<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich habe damit ein Zeitlimit f√ºr die Funktion und einige Cors-Einstellungen festgelegt, um die Gateway-API sp√§ter von meiner statischen Seite mit dem ContactUs-Formular aufzurufen. </font></font><br>
<br>
<b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ausgaben Mit</font></font></i></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
diesem Block k√∂nnen Sie einige Variablen im globalen AWS CloudFormation-Kontext dynamisch definieren.</font></font><br>
<pre><code class="plaintext hljs">Outputs:<font></font>
  ContactUsApi:<font></font>
    Description: "API Gateway endpoint URL for Prod stage for ContactUs function"<font></font>
    Value: !Sub "https://${ServerlessRestApi}.execute-api.${AWS::Region}.amazonaws.com/Prod/contact/"<font></font>
  ContactUsFunction:<font></font>
    Description: "ContactUs Lambda Function ARN"<font></font>
    Value: !GetAtt ContactUsFunction.Arn<font></font>
  ContactUsFunctionIamRole:<font></font>
    Description: "Implicit IAM Role created for ContactUs function"<font></font>
    Value: !GetAtt ContactUsFunctionRole.Arn<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beispielsweise haben wir eine ContactUsApi-Variable deklariert, die auf einen Wert als √∂ffentliche Adresse unseres erstellten API-Endpunkts festgelegt wird. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Da wir </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ {ServerlessRestApi} verwenden</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , f√ºgt AWS die eindeutige Kennung unserer neuen Gateway-API in die Zeichenfolge ein. Infolgedessen kann jede Anwendung, die Zugriff auf CloudFormation hat, diese Adresse erhalten. Dadurch k√∂nnen Sie die URL Ihrer Dienste nicht fest codieren. Ein weiteres Plus ist, dass es sehr praktisch ist, die Liste der Ausgaben anzuzeigen - einige Metainformationen zu Ihrem Stapel. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eine vollst√§ndige Liste der Funktionen und welche Parameter Sie verwenden k√∂nnen, finden Sie </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hier</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parameter</font></font></i></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Zus√§tzlich zu allen oben genannten Funktionen k√∂nnen Sie einen </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">Parameterblock</font></a><font style="vertical-align: inherit;"> hinzuf√ºgen</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Diese Optionen tragen dazu bei, die Vorlage vielseitiger zu gestalten. </font><font style="vertical-align: inherit;">In jedem anderen Block der Vorlage k√∂nnen Sie auf diese Parameter verweisen und dabei einige Werte nicht fest codieren. </font><font style="vertical-align: inherit;">In meiner Vorlage k√∂nnen es beispielsweise E-Mails, SES ARN, Speicherplatz usw. sein. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das ist die ganze Vorlage. </font><font style="vertical-align: inherit;">Niemand verbietet das Hinzuf√ºgen weiterer Ressourcen in der N√§he, z. B. eines S3-Buckets, einer anderen CloudFormation-Ressource oder einer </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">benutzerdefinierten Ressource</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> im Allgemeinen </font><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6. Wir fahren mit der Bereitstellung fort</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um unser Projekt zusammenzustellen, werden wir nicht Gradle, sondern SAM verwenden.</font></font><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Versammlung</font></font></b>
                        <div class="spoiler_text"><pre><code class="bash hljs">F:\aws\projects\contact-us-sam-app&gt;sam build<font></font>
Building resource <span class="hljs-string">'ContactUsFunction'</span><font></font>
Running JavaGradleWorkflow:GradleBuild<font></font>
Running JavaGradleWorkflow:CopyArtifacts<font></font>
<font></font>
Build Succeeded<font></font>
<font></font>
Built Artifacts  : .aws-sam\build<font></font>
Built Template   : .aws-sam\build\template.yaml<font></font>
<font></font>
Commands you can use next<font></font>
=========================<font></font>
[*] Invoke Function: sam <span class="hljs-built_in">local</span> invoke<font></font>
[*] Deploy: sam deploy ‚Äìguided<font></font>
</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie den </font><font style="vertical-align: inherit;">Befehl </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sam build</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> im Stammverzeichnis des Projekts </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ausf√ºhren,</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> werden automatisch </font><font style="vertical-align: inherit;">alle erforderlichen Dateien </font><font style="vertical-align: inherit;">im </font><font style="vertical-align: inherit;">Ordner </font><i><font style="vertical-align: inherit;">.aws-sam gesammelt</font></i><font style="vertical-align: inherit;"> : Klassen, Abh√§ngigkeiten, SAM-Vorlage. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Als N√§chstes m√ºssen Sie einen S3-Bucket erstellen, in den SAM anschlie√üend alle gesammelten Artefakte hochl√§dt. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dies kann entweder √ºber die browserbasierte AWS-Konsole oder mit dem Befehl erfolgen</font></font><br>
<blockquote><code>aws s3 mb s3://bucket-name</code></blockquote><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hinweis: Alle Buckets werden in einem globalen Kontext erstellt und zwischen allen Konten durchsucht. </font><font style="vertical-align: inherit;">Sie k√∂nnen also keinen Bucket erstellen, wenn jemand ihn bereits in Ihrem Konto erstellt hat. </font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn der Bucket bereit ist, f√ºhren Sie den folgenden Befehl aus:</font></font><br>
<blockquote><code>sam package --output-template-file packaged.yaml --s3-bucket &lt;YOUR_BACKET&gt;</code></blockquote><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Paketergebnis</font></font></b>
                        <div class="spoiler_text"><pre><code class="bash hljs">F:\aws\projects\contact-us-sam-app&gt;sam package --output-template-file packaged.yaml --s3-bucket contact-us-sam-app<font></font>
Uploading to ea0c122c06a50d9676fbf9000a80a3bf  9212768 / 9212768.0  (100.00%)<font></font>
<font></font>
Successfully packaged artifacts and wrote output template to file packaged.yaml.<font></font>
Execute the following <span class="hljs-built_in">command</span> to deploy the packaged template<font></font>
sam deploy --template-file F:\aws\projects\contact-us-sam-app\packaged.yaml --stack-name &lt;YOUR STACK NAME&gt;<font></font>
</code></pre></div>
                    </div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich zeigte auf meinen Kontakt-uns-Sam-App-Bucket und SAM lud alle Ressourcen an den angegebenen Speicherort hoch. </font><font style="vertical-align: inherit;">Als N√§chstes weist SAM Sie bereits an, einen Stapel mit Ressourcen zu erstellen und damit Ihre Entscheidung einzubetten. </font><font style="vertical-align: inherit;">Wir f√ºhren den Befehl aus, nachdem wir ein wenig abgeschlossen haben:</font></font><br>
<blockquote><code>sam deploy --template-file packaged.yaml --region eu-west-1 --capabilities CAPABILITY_IAM --stack-name contact-us-sam-app </code></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie Sie sehen k√∂nnen, habe ich </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--capabilities CAPABILITY_IAM</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> hinzugef√ºgt </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Dadurch kann CloudFormation IAM-Ressourcen erstellen. </font><font style="vertical-align: inherit;">Andernfalls erhalten Sie beim Erstellen einen InsufficientCapabilities-Fehler. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Folgende ist das Protokoll der Arbeit dieses Befehls (das Bild ist anklickbar). </font><font style="vertical-align: inherit;">Details wie der Status jeder Ressource und die Werte der Ausgaben wurden nur in einer der neuesten Versionen von SAM CLI verf√ºgbar.</font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><img src="https://habrastorage.org/webt/nv/7p/4z/nv7p4zreqati1wd8c8vy3ubuzcm.png"></a><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7. √úberpr√ºfen Sie den Status von CloudFormation</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir k√∂nnen warten, bis die Bereitstellung in der Konsole abgeschlossen ist, bis eine Meldung angezeigt wird, dass der Stapel bereitgestellt wurde (die Bereitstellungsbefehlsprotokolle im vorherigen Absatz):</font></font><br>
<blockquote><code>Successfully created/updated stack - contact-us-sam-app in eu-west-1</code></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In unserem Fall wird diese Meldung aufgrund des kanarischen Bereitstellungsmodus jedoch erst nach zehn Minuten angezeigt. Daher ist es einfacher, eine Browserkonsole zu √∂ffnen und den Stapel dort anzusehen. </font></font><br>
<img src="https://habrastorage.org/webt/97/ki/k8/97kik8apukwxsvqwyvsd_wtmaqo.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nach einiger Zeit √§ndert sich der Status in </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE_COMPLETE</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , was einen erfolgreichen Abschluss bedeutet. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Auf der Registerkarte </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ereignisse</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> k√∂nnen Sie den Status aller Ressourcen anzeigen. Wenn Ihr Stack floppt, finden Sie hier detaillierte Fehlermeldungen. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beispiel: </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UPDATE_FAILED</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Wenn Sie die Gateway-API in der Vorlage falsch konfiguriert haben.</font></font><br>
<img src="https://habrastorage.org/webt/ce/mh/aq/cemhaqtl6uvdmlvnr0bsvrbokok.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Auf der Registerkarte Ressourcen finden Sie alle erstellten Ressourcen. </font><font style="vertical-align: inherit;">Seien Sie nicht √ºberrascht √ºber ihre Menge. </font><font style="vertical-align: inherit;">Obwohl wir in der SAM-Vorlage nur eine Funktion und eine Datenbanktabelle deklariert haben, hat CloudFormation viele andere Ressourcen f√ºr uns erstellt. </font><font style="vertical-align: inherit;">Wenn Sie sich ihren Typ ansehen, k√∂nnen Sie verstehen, zu welchem ‚Äã‚ÄãDienst sie geh√∂ren. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
F√ºr Api Gateway wurde implizit Folgendes erstellt:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ServerlessRestApi</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ServerlessRestApiDeployment</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ServerlessRestApiProdStage</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Auch f√ºr Lambda wurden mehrere zus√§tzliche Objekte erstellt. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√ñffnen Sie nun </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Outputs</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und suchen Sie die URL unserer API. </font><font style="vertical-align: inherit;">Kopieren Sie es, es wird bald n√ºtzlich sein.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8. HTML ContactUs-Formular</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie Sie sich erinnern, habe ich beschlossen, ein ContactUs-Formular zu erstellen, und jetzt m√ºssen wir es irgendwie nicht nur auf dem lokalen Computer verf√ºgbar machen. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Konfiguration</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
F√ºr das Formular selbst habe ich mich beispielsweise f√ºr das einfachste HTML-Formular entschieden und Gateway-API-Aufrufe √ºber Ajax hinzugef√ºgt. </font></font><br>
<img src="https://habrastorage.org/webt/ps/e-/4h/pse-4hta3mojfuamij0dhj3bmyg.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zus√§tzlich zum Formular selbst habe ich einige Schaltfl√§chen zum Debuggen und Vereinfachen des Ausf√ºllens hinzugef√ºgt: </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Standard festlegen</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Ersetzt erwartungsgem√§√ü die in HTML angegebenen Standardparameter.</font></font><br>
<pre><code class="javascript hljs">$(<span class="hljs-string">"#url-input"</span>).val(<span class="hljs-string">"https://4ykskscuq0.execute-api.eu-west-1.amazonaws.com/Prod/contact"</span>);<font></font>
$(<span class="hljs-string">"#name-input"</span>).val(<span class="hljs-string">"Mike"</span>);<font></font>
$(<span class="hljs-string">"#email-input"</span>).val(<span class="hljs-string">"Mike@somemail.com"</span>);<font></font>
$(<span class="hljs-string">"#phone-input"</span>).val(<span class="hljs-string">"+79999999999"</span>);<font></font>
$(<span class="hljs-string">"#description-input"</span>).val(<span class="hljs-string">"How much does it cost?"</span>);
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie diese Funktionalit√§t verwenden m√∂chten, √§ndern Sie die URL-Eingabe in den Pfad zu Ihrer Gateway-API, den Sie aus den </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ausgaben</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> kopiert haben </font><font style="vertical-align: inherit;">. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hosting</font></font></b><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erstellen Sie einen neuen S3-Bucket.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir laden die HTML-Datei in den Bucket, indem wir die Option ausw√§hlen, die Datei √∂ffentlich zu machen.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir gehen in den Eimer, in den wir die Datei hochgeladen haben.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gehen Sie zu Eigenschaften, aktivieren Sie das Hosting der statischen Website und sehen Sie Ihren neuen √∂ffentlich verf√ºgbaren Endpunkt.</font></font></li>
</ul><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9. Gesundheitscheck</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Standardanforderung</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Jetzt k√∂nnen Sie dem Link zu Ihrem Formular folgen, auf Standard festlegen und Senden klicken. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Auf diese Weise stellen Sie eine Anfrage, die √ºber die Gateway-API an AWS Lambda gesendet wird. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie nach einer Weile alles richtig konfiguriert haben, erhalten Sie eine Nachricht wie:</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erfolgreich: Die Nachricht 0102016f28b06243-ae897a1e-b805-406b-9987-019f21547682-000000 wurde erfolgreich gesendet.</font></font><br>
</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dies bedeutet, dass die Nachricht erfolgreich zugestellt wurde. √úberpr√ºfen Sie Ihr Postfach, das Sie in der SAM-Vorlage angegeben haben. Wenn Sie die Vorlage nicht ge√§ndert haben, hat der Brief das folgende Format: </font></font><br>
<img src="https://habrastorage.org/webt/0z/wy/sv/0zwysv5ytv3uzn9fb9az7bsa6lg.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sie k√∂nnen auch DynamoDB √∂ffnen und sicherstellen, dass ein neuer Eintrag angezeigt wurde. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Merkmale eines Kaltstarts</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Ich denke, Sie haben bemerkt, dass die Nachricht √ºber das erfolgreiche Senden nach ziemlich langer Zeit kam. Dies liegt an der Tatsache, dass der AWS Lambda-Dienst, nachdem er eine Anforderung zur Verarbeitung erhalten hat, die Instanz Ihrer Java-Anwendung </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ausgel√∂st hat.</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Dazu geh√∂rt das Aufheben des Containers mit dem Betriebssystem und der JRE, das Laden des Klassenpfads, das Initialisieren aller Variablen und erst danach der Start von </font><i><font style="vertical-align: inherit;">handleRequest ( )</font></i><font style="vertical-align: inherit;"> . Dies wird als Kaltstart bezeichnet.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Versuchen Sie erneut, das Formular auszuf√ºllen und einzureichen. Diesmal kam die Antwort fast sofort, oder? Wenn zwischen der ersten und der zweiten Anforderung mehr als 20 bis 30 Minuten vergangen sind, kann das Ergebnis variieren. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Was ist der Grund daf√ºr? Und mit der Tatsache, dass AWS Lambda-Caches bereits Container mit Lambdas f√ºr ihre Wiederverwendung verwendet haben. Dies reduziert die Initialisierungszeit des gesamten Kontexts zum Starten der Methode. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es gibt keine eindeutige Korrelation daf√ºr, wie lange Lambdas je nach Art zwischengespeichert werden, aber einige Leute haben experimentell festgestellt, dass dies </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">direkt vom gew√§hlten RAM-Wert abh√§ngt</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Das hei√üt, ein Lambda mit 128 MB Speicher ist l√§nger verf√ºgbar als mit 3 GB. M√∂glicherweise gibt es andere Parameter, z. B. die durchschnittliche Belastung der Region, in der Ihre Lambdas ausgef√ºhrt werden, aber dies ist ungenau. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Experimentieren Sie daher selbst und planen Sie die Caching-Zeit, wenn Sie synchrone Anforderungen verwenden. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aufw√§rmen</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Als zus√§tzliche Option k√∂nnen Sie die Lambda-Heizung verwenden. Im Code habe ich eine </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">X-WAMP-UP-Header-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Pr√ºfung hinzugef√ºgt </font><font style="vertical-align: inherit;">. Wenn es eine gibt, gibt das Lambda einfach eine Antwort zur√ºck, ohne eine Gesch√§ftslogik auszuf√ºhren, aber der Container ist f√ºr nachfolgende Aufrufe bereit. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sie k√∂nnen Ihr Lambda beispielsweise selbst √ºber den Kronen-Timer mit CloudWatch aufrufen. Dies ist hilfreich, wenn Sie nicht m√∂chten, dass Ihre Kunden Cold Start beitreten.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im HTML-Formular finden Sie die Schaltfl√§che WarmUp-Modus, mit der der Anforderung dieser spezielle Header hinzugef√ºgt wird. </font><font style="vertical-align: inherit;">Sie k√∂nnen √ºberpr√ºfen, ob weder ein Brief gesendet noch in die Datenbank geschrieben wird, aber die Antwort vom Lambda eintrifft und der nachfolgende Aufruf der tats√§chlichen Anfrage nicht viel Zeit in Anspruch nimmt.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zusammenfassen</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
W√§hrend des Artikels haben wir alle Hauptphasen vom Anwendungsdesign bis zur Ver√∂ffentlichung in der </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sogenannten Produktion</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> durchlaufen </font><font style="vertical-align: inherit;">. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich hoffe, dass diejenigen Personen, die bereits von Serverless und AWS Lambda geh√∂rt haben, aber keine praktische Erfahrung haben, diesen Leitfaden verwenden k√∂nnen und das Gef√ºhl haben, dass dies erhebliche Vorteile f√ºr die Geschwindigkeit der Bereitstellung einiger Softwarel√∂sungen bietet und nicht nur das. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vorteile</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
F√ºr mich habe ich die wertvollsten Vorteile identifiziert:</font></font><br>
<ul>
<li>     Free Tier      ,     ,       .</li>
<li>           1-2 .        /.</li>
<li>  ,          ,         .</li>
<li>  Serverless      .   ,  ‚Äî  .   SAM          AWS. AWS    ,         ,   .</li>
<li>      Lambda ,     .</li>
<li>   Serverless    , , .          ELK/Promethes/Grafana      .</li>
<li>   ,             API.          API Key,   IAM ,                      .</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nun, wahrscheinlich ist das Grundlegendste Serverlos. </font><font style="vertical-align: inherit;">Sie m√ºssen nicht dar√ºber nachdenken, f√ºr welche EC2-Instanz Sie bezahlen m√ºssen, wie Sie den Zugriff darauf konfigurieren, wie Sie Warnungen im Falle eines Anwendungsabsturzes konfigurieren, die automatische Skalierung konfigurieren usw.</font></font></li>
</ul><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nachteile</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Leider bedeutet dies nicht, dass Sie diese L√∂sung jetzt als Teil eines Unternehmenssystems anstelle Ihrer bevorzugten Microservices im Cuber verwenden k√∂nnen. </font><font style="vertical-align: inherit;">Sehr oft m√ºssen Sie tiefer graben, um in einem bestimmten Fall eine geeignetere L√∂sung zu finden. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und ich habe auch Kommentare, auf die Sie bei der Auswahl von Lambda achten sollten:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kaltstart. </font><font style="vertical-align: inherit;">Besonders wichtig bei Verwendung synchroner Abfragen und Sprachen wie Java oder C #. </font><font style="vertical-align: inherit;">Das Problem wird durch Aufw√§rmen m√§√üig gel√∂st, aber es ist besser, im Voraus √ºber eine solche L√∂sung nachzudenken und die Kosten und m√∂glichen Vorteile zu vergleichen</font></font></li>
<li>    .       3GB  ,    2   ,    ,     - Fargate,       ,     .</li>
<li>          API,       ,           .</li>
<li>    /   1-2     Serverless,                .</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn Sie bereits √ºber die Infrastruktur f√ºr die Entwicklung von Microservices und CI / CD in Coober verf√ºgen, ist es erneut problematisch, (insbesondere f√ºr Manager) die Notwendigkeit zu argumentieren, einen anderen CI / CD-Prozess zu unterst√ºtzen.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nun, wo ohne zu testen. </font><font style="vertical-align: inherit;">Und das Lambda auf Durchsatz zu testen ist ziemlich schwierig, da es sich immer noch von den √ºblichen Leistungstests unterscheidet und viele Faktoren ber√ºcksichtigt werden m√ºssen.</font></font></li>
</ul><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Verwendung</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Im Allgemeinen passt die Verwendung von AWS Lambda und anderen serverlosen Diensten sehr gut zu den Prinzipien der asynchronen und ereignisgesteuerten Entwicklung. </font><font style="vertical-align: inherit;">Durch die Verwendung der asynchronen Verarbeitung k√∂nnen optimale Ergebnisse sowohl hinsichtlich der Leistung als auch der Kosten erzielt werden. </font><font style="vertical-align: inherit;">Hier ist eine Liste von L√∂sungen, bei denen Serveress-L√∂sungen eine wichtige Rolle spielen werden:</font></font><br>
<img src="https://habrastorage.org/webt/i6/ov/y6/i6ovy6ha2pszsiui5jvyewbf-dk.png"><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Da sich der Artikel als ziemlich umfangreich herausstellte und ich ihn nicht noch mehr aufblasen m√∂chte, werde ich h√∂chstwahrscheinlich eine Fortsetzung vorbereiten, in der ich zeigen werde, wie die Entwicklung mit allen Funktionen der AWS-Konsole, des SAM-Frameworks und sogar von IntelljIDEA effizienter durchgef√ºhrt werden kann. </font><font style="vertical-align: inherit;">Da ich den Testteil weggelassen habe, werde ich versuchen, diesen Aspekt der Entwicklung genauer zu beschreiben. </font><font style="vertical-align: inherit;">Wenn Sie W√ºnsche haben, was Sie zum n√§chsten Artikel oder zu Fragen hinzuf√ºgen m√∂chten, k√∂nnen Sie diese gerne in die Kommentare oder in private Nachrichten schreiben. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hinzugef√ºgt: </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AWS Lambda in Aktion. </font><font style="vertical-align: inherit;">Teil 2</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Einige wichtige und n√ºtzliche Links aus dem Artikel:</font></font><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitHub-Projekt</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Laden Sie AWS-CLI herunter</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Laden Sie SAM-CLI herunter</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AWS-CLI-Konfiguration</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Infrastruktur als Code</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erfahrung mit Terraform</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beschreibung der SAM-Ressourcen</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AWS Lambda-Funktions-Aliase</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erweiterte Lambda-Bereitstellung</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SAM Api-Ressourcenkonfiguration</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">AWS IAM   </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">       SES</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="> Read/Write capacity  DynamoDB </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">SAM/CloudFormation  </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="> Parameters   </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">  CloudFormation </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">      </a></li>
</ul></div>
      
    </div><p class="reference-to-source js-reference-to-source">Source: https://habr.com/ru/post/undefined/</p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de486634/index.html">MSVC-Backend-Updates in Visual Studio 2019, Version 16.3 und 16.4</a></li>
<li><a href="../de486638/index.html">Blazor WebAssembly 3.2.0 Preview 1 ist jetzt verf√ºgbar</a></li>
<li><a href="../de486640/index.html">Die Zusammenfassung interessanter Materialien f√ºr den mobilen Entwickler # 331 (27. Januar - 2. Februar)</a></li>
<li><a href="../de486644/index.html">DIY Antenne in 5 Minuten</a></li>
<li><a href="../de486646/index.html">Geh weg von jQuery nach Svelte, ohne Schmerzen</a></li>
<li><a href="../de486650/index.html">Dynamischer Speicher in harten Echtzeitsystemen</a></li>
<li><a href="../de486652/index.html">"Kritik der reinen Vernunft" f√ºr Programmierer</a></li>
<li><a href="../de486654/index.html">Bewegungssensor und Alarm- und Videoregistrierungsverbindung im Home Assistant auf Raspberry pi</a></li>
<li><a href="../de486656/index.html">So f√ºgen Sie Unicode neue Charaktere hinzu: die Erfahrung des Laien</a></li>
<li><a href="../de486658/index.html">Moxy Strategie Plugin</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>