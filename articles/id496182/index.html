<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèΩ‚Äçüè´ üö∫ ‚ûó Apache Kafka untuk Dummies üïì üë®üèΩ‚Äç‚öñÔ∏è üõéÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Artikel ini akan berguna bagi mereka yang baru mulai berkenalan dengan arsitektur layanan mikro dan dengan layanan Apache Kafka. Materi tersebut tidak...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Apache Kafka untuk Dummies</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/496182/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Artikel ini akan berguna bagi mereka yang baru mulai berkenalan dengan arsitektur layanan mikro dan dengan layanan Apache Kafka. </font><font style="vertical-align: inherit;">Materi tersebut tidak mengklaim sebagai tutorial terperinci, tetapi akan membantu Anda dengan cepat memulai dengan teknologi ini. </font><font style="vertical-align: inherit;">Saya akan berbicara tentang cara menginstal dan mengkonfigurasi Kafka di Windows 10. Kami juga akan membuat proyek menggunakan Intellij IDEA dan Spring Boot.</font></font><a name="habracut"></a><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Untuk apa?</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kesulitan dalam memahami berbagai alat sering dikaitkan dengan fakta bahwa pengembang tidak pernah mengalami situasi di mana alat ini mungkin diperlukan. Dengan Kafka, ini persis sama. Kami menggambarkan situasi di mana teknologi ini akan berguna. Jika Anda memiliki arsitektur aplikasi monolitik, maka tentu saja Anda tidak memerlukan Kafka. Semuanya berubah dengan transisi ke layanan microser. Faktanya, setiap microservice adalah program terpisah yang melakukan satu atau beberapa fungsi lainnya, dan yang dapat diluncurkan secara independen dari layanan microser lainnya. Layanan microser dapat dibandingkan dengan karyawan di kantor, yang duduk di meja terpisah dan secara mandiri menyelesaikan masalah mereka. Pekerjaan tim terdistribusi seperti itu tidak terpikirkan tanpa koordinasi pusat.Karyawan harus dapat saling bertukar pesan dan hasil pekerjaan mereka satu sama lain. Apache Kafka untuk layanan microser dirancang untuk memecahkan masalah ini.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apache Kafka adalah broker pesan. Dengannya, layanan microser dapat berinteraksi satu sama lain, mengirim dan menerima informasi penting. Pertanyaannya adalah, mengapa tidak menggunakan POST biasa - diperlukan untuk keperluan ini, di mana Anda dapat mentransfer data yang diperlukan dan mendapatkan jawabannya dengan cara yang sama? Pendekatan ini memiliki sejumlah kelemahan yang jelas. Misalnya, produsen (layanan yang mengirim pesan) hanya dapat mengirim data dalam bentuk respons sebagai tanggapan atas permintaan dari konsumen (layanan yang menerima data). Misalkan konsumen mengirimkan permintaan POST dan produsen menjawabnya. Pada saat ini, karena suatu alasan, konsumen tidak dapat menerima jawabannya. Apa yang akan terjadi pada data? Mereka akan hilang. Konsumen sekali lagi harus mengirim permintaan dan berharap bahwa data yang dia ingin terima tidak berubah selama ini,dan produsen masih siap menerima permintaan.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apache Kafka memecahkan ini dan banyak masalah lain yang muncul saat bertukar pesan antara layanan microser. </font><font style="vertical-align: inherit;">Tidak akan salah untuk mengingat bahwa pertukaran data yang tidak terganggu dan nyaman adalah salah satu masalah utama yang harus dipecahkan untuk memastikan operasi yang stabil dari arsitektur layanan-mikro.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Instal dan konfigurasikan ZooKeeper dan Apache Kafka di Windows 10</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hal pertama yang perlu Anda ketahui untuk memulai adalah bahwa Apache Kafka berjalan di atas layanan ZooKeeper. ZooKeeper adalah layanan konfigurasi dan sinkronisasi yang terdistribusi, dan hanya itu yang perlu kita ketahui tentang hal ini dalam konteks ini. Kita harus mengunduh, mengkonfigurasi, dan menjalankannya sebelum memulai dengan Kafka. Sebelum Anda mulai bekerja dengan ZooKeeper, pastikan Anda telah menginstal dan mengkonfigurasi JRE. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anda dapat mengunduh ZooKeeper versi terbaru dari situs web resmi</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami mengekstrak file dari arsip ZooKeeper yang diunduh ke folder pada disk. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di folder zookeeper dengan nomor versi, kami menemukan folder conf dan di dalamnya file "zoo_sample.cfg".</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ho/ke/pz/hokepzidcuiupzigc3i3wtlxi6s.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Salin dan ubah nama salinan menjadi "zoo.cfg". Buka file salin dan temukan baris dataDir = / tmp / zookeeper di dalamnya. Pada baris ini kita menulis path lengkap ke folder zookeeper-x.x.x kita. Kelihatannya seperti ini untuk saya: dataDir = C: \\ ZooKeeper \\ zookeeper-3.6.0 </font></font><br>
<img src="https://habrastorage.org/webt/ri/sk/2h/risk2h-3u771fpod5vvxodydrhy.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang kita menambahkan variabel lingkungan sistem: ZOOKEEPER_HOME = C: \ ZooKeeper \ zookeeper-3.4.9 dan pada akhir variabel sistem Path menambahkan entri:;% ZOOKEEPER_HOME % \ tempat sampah; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jalankan baris perintah dan tulis perintah:</font></font><br>
<br>
<pre><code class="cs hljs">zkserver</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Jika semuanya dilakukan dengan benar, Anda akan melihat sesuatu seperti yang berikut ini. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/b-/rs/i6/b-rsi6uqc40e77tchqnimmhsgo8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ini berarti bahwa ZooKeeper memulai secara normal. Kami langsung melanjutkan ke instalasi dan konfigurasi server Apache Kafka. Unduh versi terbaru dari situs resmi dan ekstrak konten arsip: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kafka.apache.org/downloads</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Dalam folder dengan Kafka kita menemukan folder konfigurasi, di dalamnya kita menemukan file server.properties dan membukanya. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/px/o5/m0/pxo5m032s0lvvmjqbhmfaazfnog.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami menemukan baris log.dirs = / tmp / kafka-log dan menunjukkan di dalamnya jalur di mana Kafka akan menyimpan log: log.dirs = c: / kafka / kafka-logs. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/gh/bi/mg/ghbimgkxct-2ox1a8s8klpackco.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di folder yang sama, edit file properti zookeeper.prop. Kami mengubah baris dataDir = / tmp / zookeeper ke dataDir = c: / kafka / zookeeper-data, tanpa lupa menunjukkan jalur ke folder Kafka Anda setelah nama disk. Jika Anda melakukan semuanya dengan benar, Anda dapat menjalankan ZooKeeper dan Kafka.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/yd/nd/mr/ydndmrfkovlk4z75mc99lbs3clk.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bagi sebagian orang, mungkin merupakan kejutan yang tidak menyenangkan bahwa tidak ada GUI untuk mengendalikan Kafka. </font><font style="vertical-align: inherit;">Mungkin ini karena layanan ini dirancang untuk nerd keras yang bekerja secara eksklusif dengan konsol. </font><font style="vertical-align: inherit;">Dengan satu atau lain cara, untuk menjalankan Kafka kita perlu baris perintah. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pertama, Anda perlu memulai ZooKeeper. </font><font style="vertical-align: inherit;">Dalam folder dengan kafka kita menemukan folder bin / windows, di dalamnya kita menemukan file untuk meluncurkan layanan zookeeper-server-start.bat, klik di atasnya. </font><font style="vertical-align: inherit;">Tidak ada yang terjadi? </font><font style="vertical-align: inherit;">Seharusnya begitu. </font><font style="vertical-align: inherit;">Buka konsol di folder ini dan tulis:</font></font><br>
<br>
<pre><code class="cs hljs"> start zookeeper-server-start.bat</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Tidak bekerja lagi </font><font style="vertical-align: inherit;">Ini adalah norma. </font><font style="vertical-align: inherit;">Itu karena zookeeper-server-start.bat membutuhkan parameter yang ditentukan dalam file properti zookeeper.prop, yang, seperti yang kita ingat, terletak di folder konfigurasi untuk pekerjaannya. </font><font style="vertical-align: inherit;">Kami menulis ke konsol:</font></font><br>
<br>
<pre><code class="cs hljs">start zookeeper-server-start.bat c:\kafka\config\zookeeper.properties </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang semuanya harus dimulai dengan normal. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/wn/q1/hr/wnq1hrvtfit6o_mgsqkdkrzcjiw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekali lagi, buka konsol di folder ini (jangan tutup ZooKeeper!) Dan jalankan kafka:</font></font><br>
<br>
<pre><code class="cs hljs">start kafka-server-start.bat c:\kafka\config\server.properties</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agar tidak menulis perintah setiap kali pada baris perintah, Anda dapat menggunakan metode yang sudah terbukti dan membuat file batch dengan konten berikut:</font></font><br>
<br>
<pre><code class="cs hljs">start C:\kafka\bin\windows\zookeeper-server-start.bat C:\kafka\config\zookeeper.properties<font></font>
timeout <span class="hljs-number">10</span>
start C:\kafka\bin\windows\kafka-server-start.bat C:\kafka\config\server.properties</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Timeout 10 line diperlukan untuk mengatur jeda antara mulai zookeeper dan kafka. </font><font style="vertical-align: inherit;">Jika Anda melakukan segalanya dengan benar, ketika Anda mengklik file batch, dua konsol akan terbuka dengan zookeeper dan kafka berjalan. Sekarang kita dapat membuat penghasil pesan dan konsumen dengan parameter yang diperlukan langsung dari baris perintah. </font><font style="vertical-align: inherit;">Tetapi, dalam praktiknya, itu mungkin diperlukan kecuali untuk menguji layanan. </font><font style="vertical-align: inherit;">Kami akan jauh lebih tertarik dengan cara bekerja dengan kafka dari IDEA.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bekerja dengan kafka dari IDEA</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami akan menulis aplikasi sesederhana mungkin, yang sekaligus akan menjadi penghasil dan konsumen pesan, dan kemudian menambahkan fitur-fitur yang bermanfaat untuknya. </font><font style="vertical-align: inherit;">Buat proyek pegas baru. </font><font style="vertical-align: inherit;">Ini paling mudah dilakukan menggunakan inisialisasi pegas. </font><font style="vertical-align: inherit;">Tambahkan dependensi org.springframework.kafka dan spring-boot-starter-web </font></font><br>
<br>
<img src="https://habrastorage.org/webt/n8/tv/vd/n8tvvda_h1eedp1j7iodblqnv3u.png"><br>
<br>
<img src="https://habrastorage.org/webt/so/kb/pw/sokbpw-hvkzn8ihnzsokhqn0-yo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Akibatnya, file pom.xml akan terlihat seperti ini: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/gw/oc/ub/gwocubssaaqvggzlya-mgdwso24.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk mengirim pesan, kita memerlukan objek KafkaTemplate &lt;K, V&gt;. </font><font style="vertical-align: inherit;">Seperti yang kita lihat objek diketik. </font><font style="vertical-align: inherit;">Parameter pertama adalah jenis kunci, yang kedua adalah pesan itu sendiri. </font><font style="vertical-align: inherit;">Untuk saat ini, kami akan menunjukkan kedua parameter sebagai String. </font><font style="vertical-align: inherit;">Kami akan membuat objek di kelas-controller. </font><font style="vertical-align: inherit;">Nyatakan KafkaTemplate dan minta Spring untuk menginisialisasi dengan anotasi</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Autowired</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-meta">@Autowired</span>
<span class="hljs-keyword">private</span> KafkaTemplate&lt;String, String&gt; kafkaTemplate;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pada prinsipnya, produsen kami siap. Yang masih harus dilakukan adalah memanggil metode send () di atasnya. Ada beberapa versi berlebihan dari metode ini. Kami menggunakan dalam proyek kami opsi dengan 3 parameter - kirim (topik String, kunci K, data V). Karena KafkaTemplate diketik oleh String, kunci dan data dalam metode kirim akan berupa string. Parameter pertama menunjukkan topik, yaitu topik ke mana pesan akan dikirim, dan konsumen mana yang dapat berlangganan untuk menerimanya. Jika topik yang ditentukan dalam metode pengiriman tidak ada, itu akan dibuat secara otomatis. Teks kelas penuh terlihat seperti ini.</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping("msg")</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MsgController</span> </span>{<font></font>
<font></font>
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> KafkaTemplate&lt;String, String&gt; kafkaTemplate;<font></font>
<font></font>
    <span class="hljs-meta">@PostMapping</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">sendOrder</span><span class="hljs-params">(String msgId, String msg)</span></span>{<font></font>
        kafkaTemplate.send(<span class="hljs-string">"msg"</span>, msgId, msg);<font></font>
    }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pengontrol memetakan ke </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">localhost</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : 8080 / msg, kunci dan pesan itu sendiri ditransmisikan dalam tubuh permintaan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pengirim pesan sudah siap, sekarang buat pendengar. </font><font style="vertical-align: inherit;">Musim semi juga memungkinkan Anda melakukan ini tanpa banyak usaha. </font><font style="vertical-align: inherit;">Cukup membuat metode dan menandainya dengan penjelasan @KafkaListener, pada parameter yang Anda hanya dapat menentukan topik yang akan didengarkan. </font><font style="vertical-align: inherit;">Dalam kasus kami, sepertinya ini.</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-meta">@KafkaListener(topics="msg")</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Metode itu sendiri, ditandai dengan anotasi, dapat menentukan satu parameter yang diterima, yang memiliki jenis pesan yang dikirimkan oleh produsen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kelas di mana konsumen akan dibuat harus ditandai dengan penjelasan @EnableKafka.</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-meta">@EnableKafka</span>
<span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SimpleKafkaExampleApplication</span> </span>{<font></font>
<font></font>
    <span class="hljs-meta">@KafkaListener(topics="msg")</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">msgListener</span><span class="hljs-params">(String msg)</span></span>{<font></font>
        System.out.println(msg);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>{<font></font>
        SpringApplication.run(SimpleKafkaExampleApplication.class, args);<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Juga, dalam file pengaturan application.property, Anda harus menentukan parameter parameter concierge-id. </font><font style="vertical-align: inherit;">Jika ini tidak dilakukan, aplikasi tidak akan memulai. </font><font style="vertical-align: inherit;">Parameternya adalah tipe String dan bisa apa saja.</font></font><br>
<br>
<pre><code class="cs hljs">spring.kafka.consumer.<span class="hljs-keyword">group</span>-id=app<span class="hljs-number">.1</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Proyek kafka kami yang paling sederhana sudah siap. </font><font style="vertical-align: inherit;">Kami memiliki pengirim dan penerima pesan. </font><font style="vertical-align: inherit;">Tetap hanya berjalan. </font><font style="vertical-align: inherit;">Pertama, luncurkan ZooKeeper dan Kafka menggunakan file batch yang kami tulis sebelumnya, kemudian luncurkan aplikasi kami. </font><font style="vertical-align: inherit;">Paling mudah mengirim permintaan menggunakan tukang pos. </font><font style="vertical-align: inherit;">Dalam isi permintaan, jangan lupa untuk menentukan parameter msgId dan msg. </font></font><br>
<img src="https://habrastorage.org/webt/_o/og/jt/_oogjtlzajgbbnpsf8sjg8k0num.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika kita melihat gambar seperti itu di IDEA, maka semuanya berfungsi: produser mengirim pesan, konsumen menerimanya dan menampilkannya di konsol.</font></font><br>
<img src="https://habrastorage.org/webt/kg/zq/j3/kgzqj38qw5q67mmr0fa2ijucflw.png"><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kami menyulitkan proyek</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Proyek nyata menggunakan Kafka tentu lebih rumit daripada yang kami buat. Sekarang kami telah mengetahui fungsi dasar layanan, pertimbangkan fitur tambahan apa yang disediakannya. Untuk memulainya, kami akan meningkatkan produser. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika Anda membuka metode send (), Anda mungkin memperhatikan bahwa semua variannya memiliki nilai balik dari ListenableFuture &lt;SendResult &lt;K, V &gt;&gt;. Sekarang kami tidak akan mempertimbangkan secara terperinci kemampuan antarmuka ini. Di sini akan cukup untuk mengatakan bahwa perlu untuk melihat hasil pengiriman pesan.</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-meta">@PostMapping</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">sendMsg</span><span class="hljs-params">(String msgId, String msg)</span></span>{<font></font>
    ListenableFuture&lt;SendResult&lt;String, String&gt;&gt; future = kafkaTemplate.send(<span class="hljs-string">"msg"</span>, msgId, msg);<font></font>
    future.addCallback(System.out::println, System.err::println);<font></font>
    kafkaTemplate.flush();<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Metode addCallback () menerima dua parameter - SuccessCallback dan FailureCallback. </font><font style="vertical-align: inherit;">Keduanya adalah antarmuka fungsional. </font><font style="vertical-align: inherit;">Dari namanya, Anda dapat memahami bahwa metode yang pertama akan dipanggil sebagai hasil dari pengiriman pesan yang berhasil, yang kedua - sebagai akibat dari kesalahan. Sekarang, jika kita menjalankan proyek, kita akan melihat sesuatu seperti yang berikut di konsol:</font></font><br>
<br>
<pre><code class="cs hljs">SendResult [producerRecord=ProducerRecord(topic=msg, partition=<span class="hljs-literal">null</span>, headers=RecordHeaders(headers = [], isReadOnly = <span class="hljs-literal">true</span>), key=<span class="hljs-number">1</span>, <span class="hljs-keyword">value</span>=Hello, world!, timestamp=<span class="hljs-literal">null</span>), recordMetadata=msg<span class="hljs-number">-0</span>@<span class="hljs-number">6</span>]</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mari kita teliti lagi produsen kita. </font><font style="vertical-align: inherit;">Menariknya, apa yang terjadi jika kuncinya bukan String, tetapi, katakanlah, Long, tetapi sebagai pesan yang dikirimkan, bahkan lebih buruk lagi - semacam DTO yang rumit? </font><font style="vertical-align: inherit;">Pertama, </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hl/3m/81/hl3m81wnp81kngs_abmdx9wemlm.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mari kita </font><font style="vertical-align: inherit;">coba untuk mengubah kunci ke nilai numerik ... </font><font style="vertical-align: inherit;">Jika kita menetapkan Long sebagai kunci di produser, aplikasi akan mulai secara normal, tetapi ketika Anda mencoba mengirim pesan, ClassCastException akan dilempar dan akan dilaporkan bahwa kelas Long tidak dapat dilemparkan ke kelas String.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/fe/ti/tz/fetitzsqvkjsetoigt8lwodxcbk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika kita mencoba membuat objek KafkaTemplate secara manual, kita akan melihat bahwa objek antarmuka ProducerFactory &lt;K, V&gt;, misalnya, DefaultKafkaProducerFactory &lt;&gt;, diteruskan ke konstruktor sebagai parameter. Untuk membuat DefaultKafkaProducerFactory, kita perlu meneruskan Peta yang berisi pengaturan produsennya ke konstruktornya. Semua kode untuk konfigurasi dan pembuatan produser akan ditempatkan di kelas yang terpisah. Untuk melakukan ini, buat paket config dan di dalamnya kelas KafkaProducerConfig.</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">KafkaProducerConfig</span> </span>{<font></font>
<font></font>
    <span class="hljs-keyword">private</span> String kafkaServer=<span class="hljs-string">"localhost:9092"</span>;<font></font>
<font></font>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Map&lt;String, Object&gt; <span class="hljs-title">producerConfigs</span><span class="hljs-params">()</span> </span>{<font></font>
        Map&lt;String, Object&gt; props = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();<font></font>
        props.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG,<font></font>
                kafkaServer);<font></font>
        props.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG,<font></font>
                LongSerializer.class);<font></font>
        props.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG,<font></font>
                StringSerializer.class);<font></font>
        <span class="hljs-keyword">return</span> props;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> ProducerFactory&lt;Long, String&gt; <span class="hljs-title">producerFactory</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> DefaultKafkaProducerFactory&lt;&gt;(producerConfigs());<font></font>
    }<font></font>
<font></font>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> KafkaTemplate&lt;Long, String&gt; <span class="hljs-title">kafkaTemplate</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> KafkaTemplate&lt;&gt;(producerFactory());<font></font>
    }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam metode producerConfigs (), buat peta dengan konfigurasi dan tentukan LongSerializer.class sebagai serializer untuk kunci tersebut. </font><font style="vertical-align: inherit;">Kami mulai, mengirim permintaan dari Postman dan melihat bahwa sekarang semuanya berfungsi sebagaimana mestinya: produsen mengirim pesan, dan konsumen menerimanya. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang mari kita ubah jenis nilai yang dikirimkan. </font><font style="vertical-align: inherit;">Bagaimana jika kita tidak memiliki kelas standar dari perpustakaan Java, tetapi semacam DTO kustom. </font><font style="vertical-align: inherit;">Katakan ini.</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-meta">@Data</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserDto</span> </span>{
    <span class="hljs-keyword">private</span> Long age;
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> Address address;<font></font>
}<font></font>
<font></font>
<span class="hljs-meta">@Data</span>
<span class="hljs-meta">@AllArgsConstructor</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Address</span> </span>{
    <span class="hljs-keyword">private</span> String country;
    <span class="hljs-keyword">private</span> String city;
    <span class="hljs-keyword">private</span> String street;
    <span class="hljs-keyword">private</span> Long homeNumber;
    <span class="hljs-keyword">private</span> Long flatNumber;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk mengirim DTO sebagai pesan, Anda perlu membuat beberapa perubahan pada konfigurasi produsen. </font><font style="vertical-align: inherit;">Tentukan JsonSerializer.class sebagai serializer dari nilai pesan dan jangan lupa untuk mengubah tipe String ke UserDto di mana-mana.</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">KafkaProducerConfig</span> </span>{<font></font>
<font></font>
    <span class="hljs-keyword">private</span> String kafkaServer=<span class="hljs-string">"localhost:9092"</span>;<font></font>
<font></font>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Map&lt;String, Object&gt; <span class="hljs-title">producerConfigs</span><span class="hljs-params">()</span> </span>{<font></font>
        Map&lt;String, Object&gt; props = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();<font></font>
        props.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG,<font></font>
                kafkaServer);<font></font>
        props.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG,<font></font>
                LongSerializer.class);<font></font>
        props.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG,<font></font>
                JsonSerializer.class);<font></font>
        <span class="hljs-keyword">return</span> props;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> ProducerFactory&lt;Long, UserDto&gt; <span class="hljs-title">producerFactory</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> DefaultKafkaProducerFactory&lt;&gt;(producerConfigs());<font></font>
    }<font></font>
<font></font>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> KafkaTemplate&lt;Long, UserDto&gt; <span class="hljs-title">kafkaTemplate</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> KafkaTemplate&lt;&gt;(producerFactory());<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kirim pesan. Baris berikut akan ditampilkan di konsol: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/e8/2f/xu/e82fxufwzg_yai2rs5vx5athbts.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang kita akan menyulitkan konsumen. Sebelum ini, metode kami public void msgListener (String msg), ditandai dengan anotasi @KafkaListener (topik = "msg") mengambil String sebagai parameter dan menampilkannya di konsol. Bagaimana jika kita ingin mendapatkan parameter lain dari pesan yang dikirimkan, misalnya, kunci atau partisi? Dalam hal ini, jenis nilai yang dikirimkan harus diubah.</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-meta">@KafkaListener(topics="msg")</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">orderListener</span><span class="hljs-params">(ConsumerRecord&lt;Long, UserDto&gt; record)</span></span>{<font></font>
    System.out.println(record.partition());<font></font>
    System.out.println(record.key());<font></font>
    System.out.println(record.value());<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dari objek ConsumerRecord kita bisa mendapatkan semua parameter yang kita minati. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/zq/ml/pw/zqmlpw7o5xzb0fxxzq7rez5qjpa.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami melihat bahwa alih-alih tombol pada konsol, beberapa jenis krakozyabry ditampilkan. Ini karena StringDeserializer digunakan secara default untuk deserialize kunci, dan jika kita ingin kunci dalam format integer ditampilkan dengan benar, kita harus mengubahnya ke LongDeserializer. Untuk mengkonfigurasi konsumen dalam paket konfigurasi, buat kelas KafkaConsumerConfig.</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">KafkaConsumerConfig</span> </span>{<font></font>
<font></font>
    <span class="hljs-meta">@Value("${spring.kafka.bootstrap-servers}")</span>
    <span class="hljs-keyword">private</span> String kafkaServer;<font></font>
<font></font>
    <span class="hljs-meta">@Value("${spring.kafka.consumer.group-id}")</span>
    <span class="hljs-keyword">private</span> String kafkaGroupId;<font></font>
<font></font>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Map&lt;String, Object&gt; <span class="hljs-title">consumerConfigs</span><span class="hljs-params">()</span> </span>{<font></font>
        Map&lt;String, Object&gt; props = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();<font></font>
        props.put(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, kafkaServer);<font></font>
        props.put(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG, LongDeserializer.class);<font></font>
        props.put(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class);<font></font>
        props.put(ConsumerConfig.GROUP_ID_CONFIG, kafkaGroupId);<font></font>
        <span class="hljs-keyword">return</span> props;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> KafkaListenerContainerFactory&lt;?&gt; kafkaListenerContainerFactory() {<font></font>
        ConcurrentKafkaListenerContainerFactory&lt;Long, UserDto&gt; factory =<font></font>
                <span class="hljs-keyword">new</span> ConcurrentKafkaListenerContainerFactory&lt;&gt;();<font></font>
        factory.setConsumerFactory(consumerFactory());<font></font>
        <span class="hljs-keyword">return</span> factory;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> ConsumerFactory&lt;Long, UserDto&gt; <span class="hljs-title">consumerFactory</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> DefaultKafkaConsumerFactory&lt;&gt;(consumerConfigs());<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kelas KafkaConsumerConfig sangat mirip dengan KafkaProducerConfig yang kami buat sebelumnya. Ada juga Peta yang berisi konfigurasi yang diperlukan, misalnya, seperti deserializer untuk kunci dan nilai. Peta yang dibuat digunakan untuk membuat ConsumerFactory &lt;&gt;, yang, pada gilirannya, diperlukan untuk membuat KafkaListenerContainerFactory &lt;?&gt;. Detail penting: metode mengembalikan KafkaListenerContainerFactory &lt;?&gt; Harus disebut kafkaListenerContainerFactory (), jika tidak, Spring tidak akan dapat menemukan kacang yang diinginkan dan proyek tidak akan dikompilasi. Kami mulai.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/6x/mb/t9/6xmbt9zj5i6uzdx95a7ck4hjjxk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kita melihat bahwa sekarang kunci ditampilkan sebagaimana mestinya, yang berarti semuanya berfungsi. </font><font style="vertical-align: inherit;">Tentu saja, kemampuan Apache Kafka jauh melampaui yang dijelaskan dalam artikel ini, namun, saya berharap bahwa setelah membacanya Anda akan mendapatkan ide tentang layanan ini dan, yang paling penting, Anda dapat mulai bekerja dengannya. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cuci tangan Anda lebih sering, pakai masker, jangan keluar tanpa perlu, dan sehatlah.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id496170/index.html">Kita ditakdirkan # 1 // Udalenka dalam krisis dan kematian orisinalitas</a></li>
<li><a href="../id496174/index.html">Meningkatnya permintaan akan analitik, tim produk, Amazon, Israel, Singapura, pekerjaan jarak jauh, dll. - banyak dibahas.</a></li>
<li><a href="../id496176/index.html">Konferensi virtual besar: Pengalaman dunia nyata dalam melindungi data dari perusahaan digital modern</a></li>
<li><a href="../id496178/index.html">Cepat 5.2. Ikhtisar semua perubahan</a></li>
<li><a href="../id496180/index.html">Jaga bayangan dari masa muda</a></li>
<li><a href="../id496184/index.html">Teknologi Tampilan LED: Mikro-LED vs. Mini LED</a></li>
<li><a href="../id496188/index.html">Bagaimana menghentikan pesta menonton acara TV dan mulai hidup</a></li>
<li><a href="../id496190/index.html">Tentang Phrasal Verbs-2</a></li>
<li><a href="../id496192/index.html">Panggil fungsi Rust dari Go</a></li>
<li><a href="../id496194/index.html">Pada binarisasi gambar tomografi struktur halus</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>