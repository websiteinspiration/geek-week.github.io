<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üö¶ üë¶üèø ü•ê Code de ligne unique ou validation Nethermind √† l'aide de PVS-Studio C # pour Linux üö£üèæ üë®üèª‚Äçüé® üë®üèº‚Äçüè≠</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Cet article est d√©di√© au lancement du test b√™ta PVS-Studio C # pour Linux, ainsi que du plug-in pour Rider. Pour une si merveilleuse raison, en utilis...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Code de ligne unique ou validation Nethermind √† l'aide de PVS-Studio C # pour Linux</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/504320/"><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b64/5fc/72d/b645fc72ddcded21612bdc5e9fac2c78.png" alt="Image 1"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cet article est d√©di√© au lancement du test b√™ta PVS-Studio C # pour Linux, ainsi que du plug-in pour Rider. </font><font style="vertical-align: inherit;">Pour une si merveilleuse raison, en utilisant ces outils, nous avons v√©rifi√© le code source du produit Nethermind et dans cet article, nous examinerons des erreurs int√©ressantes et parfois dr√¥les.</font></font><br>
<a name="habracut"></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nethermind</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est un client rapide pour .NET Core Ethereum pour Linux, Windows, MacOs. </font><font style="vertical-align: inherit;">Il peut √™tre utilis√© dans des projets lors de la configuration de r√©seaux priv√©s Ethereum ou dApps. </font><font style="vertical-align: inherit;">Nethermind est </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">une source ouverte</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> situ√©e sur GitHub. </font><font style="vertical-align: inherit;">Le projet a √©t√© fond√© en 2017 et √©volue constamment.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">introduction</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aimez-vous le travail manuel? Par exemple, comme trouver des erreurs dans le code du programme. D'accord, il est plut√¥t fastidieux de lire et d'analyser le site que vous avez √©crit ou l'ensemble du projet √† la recherche d'un bug d√©licat. Eh bien, si le projet est petit, disons 5000 lignes, mais si sa taille a d√©j√† d√©pass√© cent mille ou un million de lignes? De plus, il a √©t√© √©crit par diff√©rents programmeurs et parfois pas sous une forme tr√®s digeste. Que faire dans ce cas? Devez-vous vraiment dormir quelque part, quelque part sous-estim√© et 100% de votre temps pour r√©aliser toutes ces lignes sans fin afin de comprendre o√π est cette m√©chante erreur? Je doute que vous aimeriez faire cela. Alors, que faire, peut-√™tre existe-t-il des moyens modernes pour automatiser cela en quelque sorte?</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/34f/9eb/338/34f9eb3387d61eb4ebfa67f0dbccbef7.png" alt="figure 3"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et puis un outil comme un analyseur de code statique entre en jeu. </font><font style="vertical-align: inherit;">L'analyseur statique est un outil pour d√©tecter les d√©fauts dans le code source des programmes. </font><font style="vertical-align: inherit;">L'avantage de cet outil sur la v√©rification manuelle est le suivant:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ne passe presque pas votre temps √† chercher l'emplacement de l'erreur (au moins c'est d√©finitivement plus rapide que de chercher le copier-coller √©chou√© avec vos yeux);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ne se fatigue pas, contrairement √† une personne qui, apr√®s un certain temps de recherche, aura besoin de repos;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">conna√Æt de nombreux sch√©mas d'erreur dont une personne peut m√™me ne pas √™tre au courant; </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">utilise des technologies telles que: analyse du flux de donn√©es, ex√©cution symbolique, correspondance de mod√®les et autres;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vous permet d'analyser r√©guli√®rement et √† tout moment;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">etc.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bien s√ªr, l'utilisation d'un analyseur de code statique ne remplace ni n'annule les r√©visions de code. </font><font style="vertical-align: inherit;">Mais les revues de code deviennent plus productives et utiles. </font><font style="vertical-align: inherit;">Vous pouvez vous concentrer sur la recherche d'erreurs de haut niveau, sur le transfert de connaissances, plut√¥t que de vous fatiguer √† lire le code √† la recherche de fautes de frappe. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous √™tes int√©ress√© √† en lire plus √† ce sujet, je sugg√®re l' </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">article suivant</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , ainsi qu'un article sur les </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">technologies</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> utilis√©es dans PVS-Studio.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio C # pour Linux / macOS</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour le moment, nous portons notre analyseur C # sur .NET Core, et nous d√©veloppons √©galement activement un plug-in pour IDE Rider. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous √™tes int√©ress√©, vous pouvez vous inscrire √† un test b√™ta en remplissant le formulaire </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sur cette page</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Les instructions d'installation vous seront envoy√©es par e-mail (ne vous inqui√©tez pas, c'est tr√®s simple), ainsi qu'une licence pour utiliser l'analyseur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici √† quoi ressemble Rider avec le plugin PVS-Studio:</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/rp/p6/f_/rpp6f_9oohudg2ov2jt-hdu0yg0.png" alt="Image 4"></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un peu d'indignation</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je tiens √† dire qu'√† certains endroits, il √©tait tr√®s difficile de lire le code source de Nethermind, car des lignes de 300 √† 500 caract√®res sont tout √† fait normales. </font><font style="vertical-align: inherit;">Oui, c'est tout le code sans mise en forme sur 1 ligne. </font><font style="vertical-align: inherit;">Et ces lignes, par exemple, contiennent plusieurs op√©rateurs ternaires et op√©rateurs logiques, et il n'y a rien l√†-bas. </font><font style="vertical-align: inherit;">En g√©n√©ral, jouissance d√®s la derni√®re saison du jeu des tr√¥nes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je vais vous expliquer un peu pour comprendre la port√©e. </font><font style="vertical-align: inherit;">J'ai un moniteur UltraWide d'une longueur d'environ 82 centim√®tres. </font><font style="vertical-align: inherit;">Si vous ouvrez l'IDE dessus en plein √©cran, il contiendra environ 340 caract√®res. </font><font style="vertical-align: inherit;">Autrement dit, les lignes dont je parle ne correspondent m√™me pas. </font><font style="vertical-align: inherit;">Si vous voulez voir √† quoi √ßa ressemble, j'ai laiss√© des liens vers des fichiers sur GitHub: </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exemple 1</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">LogBlockAuthorNicely</span>(<span class="hljs-params">Block block, ISyncPeer syncPeer</span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">string</span> authorString = (block.Author == <span class="hljs-literal">null</span> ? <span class="hljs-literal">null</span> : <span class="hljs-string">"sealed by "</span> +<font></font>
(KnownAddresses.GoerliValidators.ContainsKey(block.Author) ?<font></font>
KnownAddresses.GoerliValidators[block.Author] : block.Author?.ToString())) ??<font></font>
(block.Beneficiary == <span class="hljs-literal">null</span> ? <span class="hljs-keyword">string</span>.Empty : <span class="hljs-string">"mined by "</span> +<font></font>
(KnownAddresses.KnownMiners.ContainsKey(block.Beneficiary) ?<font></font>
KnownAddresses.KnownMiners[block.Beneficiary] : block.Beneficiary?.ToString()));<font></font>
    <span class="hljs-keyword">if</span> (_logger.IsInfo)<font></font>
    {<font></font>
        <span class="hljs-keyword">if</span> (_logger.IsInfo) _logger.Info(<span class="hljs-string">$"Discovered a new block
<span class="hljs-subst">{<span class="hljs-keyword">string</span>.Empty.PadLeft(<span class="hljs-number">9</span> - block.Number.ToString().Length, <span class="hljs-string">'
'</span>)}</span><span class="hljs-subst">{block.ToString(Block.Format.HashNumberAndTx)}</span> <span class="hljs-subst">{authorString}</span>, sent by
<span class="hljs-subst">{syncPeer:s}</span>"</span>);<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
‚Üí </font><b><font style="vertical-align: inherit;">Exemple de </font></b></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lien de fichier </font></font></a><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">BuildTransitions</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    ...<font></font>
    releaseSpec.IsEip1283Enabled = (_chainSpec.Parameters.Eip1283Transition ??<font></font>
<span class="hljs-keyword">long</span>.MaxValue) &lt;= releaseStartBlock &amp;&amp;<font></font>
((_chainSpec.Parameters.Eip1283DisableTransition ?? <span class="hljs-keyword">long</span>.MaxValue) <font></font>
&gt; releaseStartBlock || (_chainSpec.Parameters.Eip1283ReenableTransition ??<font></font>
<span class="hljs-keyword">long</span>.MaxValue) &lt;= releaseStartBlock);           <font></font>
    ...<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
‚Üí </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lien vers le fichier</font></font></a><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> 
<span class="hljs-title">Will_not_reject_block_with_bad_total_diff_but_will_reset_diff_to_null</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    ...<font></font>
    _syncServer = <span class="hljs-keyword">new</span> SyncServer(<span class="hljs-keyword">new</span> StateDb(), <span class="hljs-keyword">new</span> StateDb(), localBlockTree,<font></font>
NullReceiptStorage.Instance, <span class="hljs-keyword">new</span> BlockValidator(Always.Valid, <span class="hljs-keyword">new</span><font></font>
HeaderValidator(localBlockTree, Always.Valid, MainnetSpecProvider.Instance,<font></font>
LimboLogs.Instance), Always.Valid, MainnetSpecProvider.Instance, <font></font>
LimboLogs.Instance), Always.Valid, _peerPool, StaticSelector.Full, <font></font>
<span class="hljs-keyword">new</span> SyncConfig(), LimboLogs.Instance);<font></font>
    ...     <font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
‚Üí </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lien vers le fichier</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Imaginez maintenant qu'une erreur se produit dans une telle section, sera-t-il agr√©able de la chercher? </font><font style="vertical-align: inherit;">Je suis s√ªr que ce n'est pas le cas, et tout le monde comprend qu'il est impossible d'√©crire comme √ßa. </font><font style="vertical-align: inherit;">Et au fait, il y a un endroit similaire avec une erreur dans ce projet.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R√©sultats de validation</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conditions qui n'aiment pas 0</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Condition 1</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> ReceiptsMessage <span class="hljs-title">Deserialize</span>(<span class="hljs-params"><span class="hljs-keyword">byte</span>[] bytes</span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">if</span> (bytes.Length == <span class="hljs-number">0</span> &amp;&amp; bytes[<span class="hljs-number">0</span>] == Rlp.OfEmptySequence[<span class="hljs-number">0</span>])
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ReceiptsMessage(<span class="hljs-literal">null</span>);<font></font>
    ...<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Avertissement PVS-Studio: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3106 L'</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> index est peut-√™tre hors limite. </font><font style="vertical-align: inherit;">L'index '0' pointe au-del√† de la limite des 'octets'. </font><font style="vertical-align: inherit;">Nethermind.Network ReceiptsMessageSerializer.cs 50 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour remarquer une erreur, consid√©rez le cas o√π le nombre d'√©l√©ments dans le tableau est 0. Ensuite, la condition </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bytes.Length == 0</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sera vraie et une </font><i><font style="vertical-align: inherit;">exception indexOutOfRangeException de type 0</font></i><font style="vertical-align: inherit;"> sera </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lev√©e</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> lors de l'acc√®s √† l'√©l√©ment du tableau </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ils voulaient quitter cette m√©thode imm√©diatement si le tableau est vide ou si l'√©l√©ment 0 est √©gal √† une certaine valeur, mais il semble qu'ils aient accidentellement m√©lang√© "||" </font><font style="vertical-align: inherit;">avec "&amp;&amp;". </font><font style="vertical-align: inherit;">Je propose de r√©soudre ce probl√®me comme suit:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> ReceiptsMessage <span class="hljs-title">Deserialize</span>(<span class="hljs-params"><span class="hljs-keyword">byte</span>[] bytes</span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">if</span> (bytes.Length == <span class="hljs-number">0</span> || bytes[<span class="hljs-number">0</span>] == Rlp.OfEmptySequence[<span class="hljs-number">0</span>])
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ReceiptsMessage(<span class="hljs-literal">null</span>);<font></font>
    ...<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Condition 2</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">DiscoverAll</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    ...<font></font>
    Type? GetStepType(Type[] typesInGroup)<font></font>
    {<font></font>
        Type? GetStepTypeRecursive(Type? contextType)<font></font>
        {<font></font>
            ...<font></font>
        }<font></font>
        ...<font></font>
        <span class="hljs-keyword">return</span> typesInGroup.Length == <span class="hljs-number">0</span> ? typesInGroup[<span class="hljs-number">0</span>] :<font></font>
               GetStepTypeRecursive(_context.GetType());<font></font>
    }<font></font>
    ...<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Avertissement PVS-Studio: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3106 L'</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> index est peut-√™tre hors limite. </font><font style="vertical-align: inherit;">L'index ¬´0¬ª pointe au-del√† de la limite ¬´typesInGroup¬ª. </font><font style="vertical-align: inherit;">Nethermind.Runner EthereumStepsManager.cs 70 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une situation similaire √† celle d√©crite ci-dessus se produit. </font><font style="vertical-align: inherit;">Si le nombre d'√©l√©ments dans </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">typesInGroup</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est √©gal √† 0, alors lors de l'acc√®s √† l'√©l√©ment 0, une exception de type </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IndexOutOfRangeException</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sera </font><i><font style="vertical-align: inherit;">lev√©e</font></i><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seulement dans ce cas, je ne comprends pas ce que voulait le d√©veloppeur. </font><font style="vertical-align: inherit;">Tr√®s probablement, au lieu de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">typesInGroup [0],</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> vous devez √©crire </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erreur ou optimisation inachev√©e?</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">DeleteBlocks</span>(<span class="hljs-params">Keccak deletePointer</span>)</span><font></font>
{<font></font>
   ...<font></font>
   <span class="hljs-keyword">if</span> (currentLevel.BlockInfos.Length == <span class="hljs-number">1</span>)<font></font>
   {<font></font>
      shouldRemoveLevel = <span class="hljs-literal">true</span>;<font></font>
   }<font></font>
   <span class="hljs-keyword">else</span><font></font>
   {<font></font>
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; currentLevel.BlockInfos.Length; i++)<font></font>
      {<font></font>
         <span class="hljs-keyword">if</span> (currentLevel.BlockInfos[<span class="hljs-number">0</span>].BlockHash == currentHash) <span class="hljs-comment">// &lt;=</span><font></font>
         {<font></font>
            currentLevel.BlockInfos = currentLevel.BlockInfos<font></font>
                                      .Where(bi =&gt; bi.BlockHash != currentHash)<font></font>
                                      .ToArray();<font></font>
            <span class="hljs-keyword">break</span>;<font></font>
         }<font></font>
      }<font></font>
   }<font></font>
   ...<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio Warning: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3102</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Acc√®s suspect √† l'√©l√©ment de l'objet 'currentLevel.BlockInfos' par un index constant √† l'int√©rieur d'une boucle. Nethermind.Blockchain BlockTree.cs 895 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√Ä premi√®re vue, l'erreur est √©vidente - la boucle vise √† </font><font style="vertical-align: inherit;">it√©rer sur les </font><font style="vertical-align: inherit;">√©l√©ments </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">currentLevel.BlockInfos</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , mais lors de l'acc√®s √† </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">currentLevel.BlockInfos [i], ils ont</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √©crit </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">currentLevel.BlockInfos [0]</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Nous fixons 0 sur </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et la mission est termin√©e. Mais ne vous pr√©cipitez pas, essayons de comprendre. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, nous </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Longueur</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> acc√®s au </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BlockHash de l'</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √©l√©ment nul. S'il est √©gal √† </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">currentHash</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , alors nous prenons de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">currentLevel.BlockInfos</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tous les √©l√©ments qui ne sont pas √©gaux</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">currentHash</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , √©crivez dessus et quittez la boucle. </font><font style="vertical-align: inherit;">Il s'av√®re que le cycle est superflu. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je pense que plus t√¥t il y avait un algorithme qu'ils ont d√©cid√© de changer / optimiser en utilisant </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">linq</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , mais quelque chose s'est mal pass√©. </font><font style="vertical-align: inherit;">Maintenant, dans le cas o√π la condition est fausse, nous obtenons des it√©rations sans signification. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Soit dit en passant, si le d√©veloppeur qui a √©crit cela utilisait le mode d' </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">analyse incr√©mentielle</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , il s'est imm√©diatement rendu compte que quelque chose n'allait pas et aurait tout corrig√© rapidement. </font><font style="vertical-align: inherit;">Pour le moment, je r√©√©crirais le code comme ceci:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">DeleteBlocks</span>(<span class="hljs-params">Keccak deletePointer</span>)</span><font></font>
{<font></font>
    ...<font></font>
    <span class="hljs-keyword">if</span> (currentLevel.BlockInfos.Length == <span class="hljs-number">1</span>)<font></font>
    {<font></font>
        shouldRemoveLevel = <span class="hljs-literal">true</span>;<font></font>
    }<font></font>
    <span class="hljs-keyword">else</span><font></font>
    {<font></font>
        currentLevel.BlockInfos = currentLevel.BlockInfos<font></font>
                                  .Where(bi =&gt; bi.BlockHash != currentHash)<font></font>
                                  .ToArray();<font></font>
    }<font></font>
    ...<font></font>
}</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D√©r√©f√©rencer la r√©f√©rence nulle</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D√©r√©f√©rencement 1</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Sign</span>(<span class="hljs-params">Transaction tx, <span class="hljs-keyword">int</span> chainId</span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">if</span> (_logger.IsDebug)<font></font>
        _logger?.Debug(<span class="hljs-string">$"Signing transaction: <span class="hljs-subst">{tx.Value}</span> to <span class="hljs-subst">{tx.To}</span>"</span>);<font></font>
    IBasicWallet.Sign(<span class="hljs-keyword">this</span>, tx, chainId);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio Warning: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3095</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> L'objet '_logger' a √©t√© utilis√© avant d'√™tre v√©rifi√© par rapport √† null. V√©rifiez les lignes: 118, 118. Nethermind.Wallet DevKeyStoreWallet.cs 118 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Erreur dans la mauvaise s√©quence. Il y a d'abord un appel √† </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_logger.IsDebug</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et ce n'est qu'apr√®s que </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_logger</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est </font><i><font style="vertical-align: inherit;">v√©rifi√©</font></i><font style="vertical-align: inherit;"> pour </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Par cons√©quent, dans le cas o√π </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_logger</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nul</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , nous obtenons une exception de type </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NullReferenceException</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D√©r√©f√©rencement 2</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">BuildNodeInfo</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    _nodeInfo = <span class="hljs-keyword">new</span> NodeInfo();<font></font>
    _nodeInfo.Name = ClientVersion.Description;<font></font>
    _nodeInfo.Enode = _enode.Info;                           <span class="hljs-comment">// &lt;=</span>
    <span class="hljs-keyword">byte</span>[] publicKeyBytes = _enode?.PublicKey?.Bytes;        <span class="hljs-comment">// &lt;=</span>
    _nodeInfo.Id = (publicKeyBytes == <span class="hljs-literal">null</span> ? Keccak.Zero :<font></font>
                   Keccak.Compute(publicKeyBytes)).ToString(<span class="hljs-literal">false</span>);<font></font>
    _nodeInfo.Ip = _enode?.HostIp?.ToString();<font></font>
    _nodeInfo.ListenAddress = <span class="hljs-string">$"<span class="hljs-subst">{_enode.HostIp}</span>:<span class="hljs-subst">{_enode.Port}</span>"</span>;<font></font>
    _nodeInfo.Ports.Discovery = _networkConfig.DiscoveryPort;<font></font>
    _nodeInfo.Ports.Listener = _networkConfig.P2PPort;<font></font>
    UpdateEthProtocolInfo();<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio Warning: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3095</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> L'objet '_enode' a √©t√© utilis√© avant d'√™tre v√©rifi√© par rapport √† null. </font><font style="vertical-align: inherit;">V√©rifiez les lignes: 55, 56. Nethermind.JsonRpc AdminModule.cs 55 L' </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
erreur est compl√®tement la m√™me que celle d√©crite ci-dessus, mais cette fois, le coupable est </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_enode</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je veux ajouter que si vous avez oubli√© de v√©rifier la valeur null, ne vous en souvenez que lorsque votre programme se bloque. </font><font style="vertical-align: inherit;">L'analyseur vous le rappellera et tout ira bien.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Notre copier-coller pr√©f√©r√©</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cas 1</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">Equals</span>(<span class="hljs-params"><span class="hljs-keyword">ref</span> UInt256 a, <span class="hljs-keyword">ref</span> UInt256 b</span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">return</span> a.s0 == b.s0 &amp;&amp; a.s1 == b.s1 &amp;&amp; a.s2 == b.s2 &amp;&amp; a.s2 == b.s2;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Avertissement PVS-Studio: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3001</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Il existe des sous-expressions identiques 'a.s2 == b.s2' √† gauche et √† droite de l'op√©rateur '&amp;&amp;'. </font><font style="vertical-align: inherit;">Nethermind.Dirichlet.Numerics UInt256.cs 1154 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ici, la m√™me condition est v√©rifi√©e 2 fois:</font></font><br>
<br>
<pre><code class="cs hljs">a.s2 == b.s2</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Puisque les param√®tres </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">b</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ont un champ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s3</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , je suppose que lors de la copie, nous avons simplement oubli√© de changer </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s2</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> en </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s3</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il s'av√®re que les param√®tres seront √©gaux plus souvent que pr√©vu par l'auteur du code. Dans le m√™me temps, certains d√©veloppeurs pensent qu'ils ne le font pas et commencent √† chercher une erreur dans un endroit compl√®tement diff√©rent, d√©pensant beaucoup d'√©nergie et de nerfs. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Soit dit en passant, les erreurs dans les fonctions de comparaison sont g√©n√©ralement un classique. Apparemment, les programmeurs, consid√©rant ces fonctions comme simples, se rapportent √† leur √©criture de mani√®re tr√®s d√©sinvolte et distraite. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Preuve</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Sachant cela, maintenant soyez prudent :)! </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cas 2</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task&lt;ApiResponse&gt; 
<span class="hljs-title">PublishBlockAsync</span>(<span class="hljs-params">SignedBeaconBlock signedBlock,
                  CancellationToken cancellationToken</span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">bool</span> acceptedLocally = <span class="hljs-literal">false</span>;<font></font>
    ...<font></font>
    <span class="hljs-keyword">if</span> (acceptedLocally)<font></font>
    {<font></font>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ApiResponse(StatusCode.Success);<font></font>
    }<font></font>
    <span class="hljs-keyword">else</span><font></font>
    {<font></font>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ApiResponse(StatusCode.Success);<font></font>
    }<font></font>
    ...<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio Warning: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3004</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> L' </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">instruction</font></a><font style="vertical-align: inherit;"> 'then' est √©quivalente √† l'instruction 'else'. Nethermind.BeaconNode BeaconNodeFacade.cs 177 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour toute valeur de la </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">acceptedLocally</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> variable, la </font><font style="vertical-align: inherit;">m√©thode renvoie la m√™me. Il est difficile de dire s'il s'agit d'une erreur ou non. Supposons qu'un programmeur ait copi√© une ligne et oubli√© de changer </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">StatusCode.Success</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √† autre chose, alors c'est une vraie erreur. De plus, le </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">StatusCode</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> a une </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InternalError</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InvalidRequest</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Mais la refactorisation du code est probablement √† bl√¢mer et nous ne nous soucions pas de la valeur </font><i><font style="vertical-align: inherit;">accept√©e</font></i><font style="vertical-align: inherit;"> localement de toute fa√ßon</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, dans ce cas, la condition devient le lieu qui vous fait asseoir et penser si c'est une erreur ou non. </font><font style="vertical-align: inherit;">Donc en tout cas, ce cas est extr√™mement d√©sagr√©able. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cas 3</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">TearDown</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    ...<font></font>
    <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> testResult <span class="hljs-keyword">in</span> _results)<font></font>
    {<font></font>
         <span class="hljs-keyword">string</span> message = <span class="hljs-string">$"<span class="hljs-subst">{testResult.Order}</span>. <span class="hljs-subst">{testResult.Name}</span> has "</span> 
               + <span class="hljs-string">$"<span class="hljs-subst">{(testResult.Passed ? <span class="hljs-string">"passed [+]"</span> : <span class="hljs-string">"failed [-]"</span>)}</span>"</span>;
         <span class="hljs-keyword">if</span> (testResult.Passed)<font></font>
         {<font></font>
               TestContext.WriteLine(message);<font></font>
         }<font></font>
         <span class="hljs-keyword">else</span><font></font>
         {<font></font>
               TestContext.WriteLine(message);<font></font>
         }<font></font>
     }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio Warning: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3004</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> L' </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">instruction</font></a><font style="vertical-align: inherit;"> 'then' est √©quivalente √† l'instruction 'else'. </font><font style="vertical-align: inherit;">Nethermind.Overseer.Test TestBuilder.cs 46 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et encore une fois, nous ne nous soucions pas de la v√©rification, car √† la fin, nous obtenons la m√™me chose. </font><font style="vertical-align: inherit;">Et encore une fois, nous nous asseyons et souffrons, pensant, mais quel √©tait le d√©veloppeur qui voulait √©crire ici. </font><font style="vertical-align: inherit;">Une perte de temps qui aurait pu √™tre √©vit√©e en utilisant l'analyse statique et en corrigeant imm√©diatement ce code ambigu. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cas 4</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Setup</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">if</span> (_decoderBuffer.ReadableBytes &gt; <span class="hljs-number">0</span>)<font></font>
    {<font></font>
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Exception(<span class="hljs-string">"decoder buffer"</span>);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (_decoderBuffer.ReadableBytes &gt; <span class="hljs-number">0</span>)<font></font>
    {<font></font>
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Exception(<span class="hljs-string">"decoder buffer"</span>);<font></font>
    }<font></font>
    ...<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio Warning: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3021</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Il existe deux instructions 'if' avec des expressions conditionnelles identiques. La premi√®re instruction ¬´if¬ª contient la m√©thode return. Cela signifie que le second ¬´ si ¬ª d√©claration est InFlowBenchmarks.cs insens√©e Nethermind.Network.Benchmark 55 Il </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
suffit de </font><font style="vertical-align: inherit;">frapper </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ctrl + V</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √† nouveau </font><font style="vertical-align: inherit;">. Nous supprimons l'exc√©dent de ch√®que et tout va bien. Je suis s√ªr que si une autre condition importante √©tait ici, alors tout le </font><font style="vertical-align: inherit;">monde √©crirait dans un </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">si</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> par l'op√©rateur logique I. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cas 5</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">LogBlockAuthorNicely</span>(<span class="hljs-params">Block block, ISyncPeer syncPeer</span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">if</span> (_logger.IsInfo)<font></font>
    {<font></font>
        <span class="hljs-keyword">if</span> (_logger.IsInfo)<font></font>
        {<font></font>
            ...<font></font>
        }<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Avertissement PVS-Studio: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">v√©rification</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> r√©currente </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">V3030</font></a><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">La condition '_logger.IsInfo' a d√©j√† √©t√© v√©rifi√©e √† la ligne 242. Nethermind.Synchronization SyncServer.cs 244 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De la m√™me mani√®re que dans le quatri√®me cas, une v√©rification suppl√©mentaire est effectu√©e. </font><font style="vertical-align: inherit;">Cependant, la diff√©rence est que </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_logger</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> a non seulement une propri√©t√©, mais aussi, par exemple, ' </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bool IsError {get; </font><font style="vertical-align: inherit;">}</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> '. </font><font style="vertical-align: inherit;">Par cons√©quent, le code devrait probablement ressembler √† ceci:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">LogBlockAuthorNicely</span>(<span class="hljs-params">Block block, ISyncPeer syncPeer</span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">if</span> (_logger.IsInfo)<font></font>
    {<font></font>
        <span class="hljs-keyword">if</span> (!_logger.IsError) <span class="hljs-comment">// &lt;=</span><font></font>
        {<font></font>
            ...<font></font>
        }<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eh bien, ou tout le d√©faut du refactoring de code et une seule v√©rification n'est plus n√©cessaire. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cas 6</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">if</span> (missingParamsCount != <span class="hljs-number">0</span>)<font></font>
{<font></font>
    <span class="hljs-keyword">bool</span> incorrectParametersCount = missingParamsCount != <span class="hljs-number">0</span>; <span class="hljs-comment">// &lt;=</span>
    <span class="hljs-keyword">if</span> (missingParamsCount &gt; <span class="hljs-number">0</span>)<font></font>
    {<font></font>
        ...<font></font>
    }<font></font>
    ...<font></font>
}</code></pre><br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avertissement</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
PVS-Studio: l' </font><font style="vertical-align: inherit;">expression </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">V3022</font></a><font style="vertical-align: inherit;"> 'missingParamsCount! = 0' est toujours vraie. </font><font style="vertical-align: inherit;">Nethermind.JsonRpc JsonRpcService.cs 127 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
V√©rifiez la condition (missingParamsCount! = 0) et si elle est vraie, nous la calculons √† nouveau et affectons le r√©sultat √† une variable. </font><font style="vertical-align: inherit;">Convenez que c'est une fa√ßon assez originale d'√©crire vrai.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ch√®que d√©routant</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task&lt;<span class="hljs-keyword">long</span>&gt; 
<span class="hljs-title">DownloadHeaders</span>(<span class="hljs-params">PeerInfo bestPeer, 
                BlocksRequest blocksRequest, 
                CancellationToken cancellation</span>)</span><font></font>
{<font></font>
  ...<font></font>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt; headers.Length; i++)<font></font>
  {<font></font>
    ...<font></font>
    BlockHeader currentHeader = headers[i];<font></font>
    ...<font></font>
    <span class="hljs-keyword">bool</span> isValid = i &gt; <span class="hljs-number">1</span> ? <font></font>
        _blockValidator.ValidateHeader(currentHeader, headers[i - <span class="hljs-number">1</span>], <span class="hljs-literal">false</span>):<font></font>
        _blockValidator.ValidateHeader(currentHeader, <span class="hljs-literal">false</span>);<font></font>
    ...<font></font>
    <span class="hljs-keyword">if</span> (HandleAddResult(bestPeer, <font></font>
                        currentHeader, <font></font>
                        i == <span class="hljs-number">0</span>,                              <span class="hljs-comment">// &lt;=</span><font></font>
                        _blockTree.Insert(currentHeader))) <font></font>
    {<font></font>
       headersSynced++;<font></font>
    }<font></font>
<font></font>
    ...<font></font>
  }<font></font>
  ...<font></font>
}</code></pre><br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avertissement</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
PVS-Studio: l' </font><font style="vertical-align: inherit;">expression </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">V3022</font></a><font style="vertical-align: inherit;"> 'i == 0' est toujours fausse. </font><font style="vertical-align: inherit;">Nethermind.Synchronization BlockDownloader.cs 192 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Commen√ßons dans l'ordre. </font><font style="vertical-align: inherit;">Lors de l'initialisation, la variable </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i se voit</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> attribuer la valeur 1. Ensuite, la variable est uniquement incr√©ment√©e, par cons√©quent, la valeur sera toujours transmise √† la fonction </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">false</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voyons maintenant </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HandleAddResult</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">HandleAddResult</span>(<span class="hljs-params">PeerInfo peerInfo, 
                             BlockHeader block,
                             <span class="hljs-keyword">bool</span> isFirstInBatch, 
                             AddBlockResult addResult</span>)</span><font></font>
{<font></font>
    ...<font></font>
    <span class="hljs-keyword">if</span> (isFirstInBatch)<font></font>
    {<font></font>
        ...<font></font>
    }<font></font>
    <span class="hljs-keyword">else</span><font></font>
    {<font></font>
        ...<font></font>
    }<font></font>
    ...<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ici, nous sommes int√©ress√©s par </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">isFirstInBatch</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">A en juger par le nom de ce param√®tre, il est responsable de savoir si quelque chose est le premier dans le parti. </font><font style="vertical-align: inherit;">Hm, d'abord. </font><font style="vertical-align: inherit;">Regardons √† nouveau ci-dessus et voyons qu'il y a 2 appels en utilisant </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="cs hljs">BlockHeader currentHeader = headers[i];<font></font>
_blockValidator.ValidateHeader(currentHeader, headers[i - <span class="hljs-number">1</span>], <span class="hljs-literal">false</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N'oubliez pas que le compte √† rebours dans ce cas passe de 1. Il s'av√®re que nous avons 2 options: soit le ¬´premier¬ª signifie un √©l√©ment sous l'index 1, soit sous l'index 0. Mais dans tous les cas, ce </font><font style="vertical-align: inherit;">sera √©gal √† </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il s'av√®re que l'appel de fonction devrait ressembler √† ceci:</font></font><br>
<br>
<pre><code class="cs hljs">HandleAddResult(bestPeer, currentHeader, <font></font>
                i == <span class="hljs-number">1</span>, _blockTree.Insert(currentHeader))</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ou comme √ßa:</font></font><br>
<br>
<pre><code class="cs hljs">HandleAddResult(bestPeer, currentHeader, <font></font>
                i - <span class="hljs-number">1</span> == <span class="hljs-number">0</span>, _blockTree.Insert(currentHeader))</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et encore une fois, si le d√©veloppeur utilisait constamment un analyseur statique, il √©crirait ce code et verrait un avertissement, le corrigerait rapidement et profiterait de la vie. </font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Une priorit√© ??</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Situation 1</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> MemorySize<font></font>
{<font></font>
  <span class="hljs-keyword">get</span><font></font>
  {<font></font>
    <span class="hljs-keyword">int</span> unaligned = (Keccak == <span class="hljs-literal">null</span> ? MemorySizes.RefSize : <font></font>
        MemorySizes.RefSize + Keccak.MemorySize) <font></font>
        + (MemorySizes.RefSize + FullRlp?.Length <font></font>
                                 ?? MemorySizes.ArrayOverhead)   <span class="hljs-comment">// &lt;=</span><font></font>
        + (MemorySizes.RefSize + _rlpStream?.MemorySize <font></font>
                                 ?? MemorySizes.RefSize)         <span class="hljs-comment">// &lt;=</span><font></font>
        + MemorySizes.RefSize + (MemorySizes.ArrayOverhead + _data?.Length <font></font>
        * MemorySizes.RefSize ?? MemorySizes.ArrayOverhead) <font></font>
        + MemorySizes.SmallObjectOverhead + (Key?.MemorySize ?? <span class="hljs-number">0</span>);
    <span class="hljs-keyword">return</span> MemorySizes.Align(unaligned);<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Avertissements de PVS-Studio: </font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3123 Peut-√™tre le '??' </font><font style="vertical-align: inherit;">L'op√©rateur fonctionne d'une mani√®re diff√©rente de celle attendue. </font><font style="vertical-align: inherit;">Sa priorit√© est inf√©rieure √† la priorit√© des autres op√©rateurs dans sa partie gauche. </font><font style="vertical-align: inherit;">Nethermind.Trie TrieNode.cs 43</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3123 Peut-√™tre le '??' </font><font style="vertical-align: inherit;">L'op√©rateur fonctionne d'une mani√®re diff√©rente de celle attendue. </font><font style="vertical-align: inherit;">Sa priorit√© est inf√©rieure √† la priorit√© des autres op√©rateurs dans sa partie gauche. </font><font style="vertical-align: inherit;">Nethermind.Trie TrieNode.cs 44</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'analyseur vous conseille de v√©rifier comment nous utilisons les op√©rateurs "??", et pour comprendre quel est le probl√®me, je propose de consid√©rer la situation suivante. </font><font style="vertical-align: inherit;">Nous regardons cette ligne ici:</font></font><br>
<br>
<pre><code class="cs hljs">(MemorySizes.RefSize + FullRlp?.Length ?? MemorySizes.ArrayOverhead)</code></pre><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MemorySizes.RefSize</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MemorySizes.ArrayOverhead</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sont des constantes:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">MemorySizes</span><font></font>
{<font></font>
    ...<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> RefSize = <span class="hljs-number">8</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> ArrayOverhead = <span class="hljs-number">20</span>;<font></font>
    ...<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par cons√©quent, pour plus de clart√©, je propose de r√©√©crire la cha√Æne, en rempla√ßant leurs valeurs:</font></font><br>
<br>
<pre><code class="cs hljs">(<span class="hljs-number">8</span> + FullRlp?.Length ?? <span class="hljs-number">20</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Supposons maintenant que </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FullRlp</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> soit </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nul.</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Alors </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(8 + null)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sera nul </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ensuite, nous obtenons l'expression ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null ?? 20</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), qui retournera 20. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il s'av√®re que, √† condition que </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FullRlp</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> soit </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , la valeur de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MemorySizes.ArrayOverhead</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sera toujours renvoy√©e, </font><font style="vertical-align: inherit;">ind√©pendamment de ce qui est stock√© dans </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MemorySizes.RefSize.</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Le fragment sur la ligne ci-dessous est similaire. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais la question est, le d√©veloppeur voulait-il ce comportement? Regardons la ligne suivante:</font></font><br>
<br>
<pre><code class="cs hljs">MemorySizes.RefSize + (MemorySizes.ArrayOverhead <font></font>
    + _data?.Length * MemorySizes.RefSize ?? MemorySizes.ArrayOverhead) </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ici, comme dans les sections ci-dessus, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MemorySizes.RefSize est</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ajout√© √† l'expression, mais </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
notez qu'apr√®s le premier op√©rateur ¬´+¬ª, il y a un crochet. </font><font style="vertical-align: inherit;">Il s'av√®re que </font><font style="vertical-align: inherit;">nous devons ajouter une expression </font><font style="vertical-align: inherit;">√† </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MemorySizes.RefSize</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , et si elle est </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nulle</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , nous en ajouterons une autre. </font><font style="vertical-align: inherit;">Le code devrait donc ressembler √† ceci:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> MemorySize<font></font>
{<font></font>
  <span class="hljs-keyword">get</span><font></font>
  {<font></font>
    <span class="hljs-keyword">int</span> unaligned = (Keccak == <span class="hljs-literal">null</span> ? MemorySizes.RefSize : <font></font>
       MemorySizes.RefSize + Keccak.MemorySize) <font></font>
       + (MemorySizes.RefSize + (FullRlp?.Length <font></font>
                                 ?? MemorySizes.ArrayOverhead))    <span class="hljs-comment">// &lt;=</span><font></font>
       + (MemorySizes.RefSize + (_rlpStream?.MemorySize <font></font>
                                 ?? MemorySizes.RefSize))          <span class="hljs-comment">// &lt;=</span><font></font>
       + MemorySizes.RefSize + (MemorySizes.ArrayOverhead + _data?.Length <font></font>
       * MemorySizes.RefSize ?? MemorySizes.ArrayOverhead) <font></font>
       + MemorySizes.SmallObjectOverhead + (Key?.MemorySize ?? <span class="hljs-number">0</span>);
    <span class="hljs-keyword">return</span> MemorySizes.Align(unaligned);<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Encore une fois, ce n'est qu'une hypoth√®se, cependant, si le d√©veloppeur souhaite un comportement diff√©rent, vous devez l'indiquer explicitement:</font></font><br>
<br>
<pre><code class="cs hljs">((MemorySizes.RefSize + FullRlp?.Length) ?? MemorySizes.ArrayOverhead)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et puis, celui qui lit ce code n'aurait pas √† se plonger longtemps dans ce qui se passe ici et ce que le programmeur voulait. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Situation 2</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> Task&lt;JsonRpcResponse&gt; 
<span class="hljs-title">ExecuteAsync</span>(<span class="hljs-params">JsonRpcRequest request, 
             <span class="hljs-keyword">string</span> methodName,
             (MethodInfo Info, <span class="hljs-keyword">bool</span> ReadOnly</span>) method)</span><font></font>
{<font></font>
    <span class="hljs-keyword">var</span> expectedParameters = method.Info.GetParameters();
    <span class="hljs-keyword">var</span> providedParameters = request.Params;<font></font>
    ...<font></font>
    <span class="hljs-keyword">int</span> missingParamsCount = expectedParameters.Length <font></font>
            - (providedParameters?.Length ?? <span class="hljs-number">0</span>) <font></font>
            + providedParameters?.Count(<span class="hljs-keyword">string</span>.IsNullOrWhiteSpace) ?? <span class="hljs-number">0</span>; <span class="hljs-comment">// &lt;=</span>
    <span class="hljs-keyword">if</span> (missingParamsCount != <span class="hljs-number">0</span>)<font></font>
    {<font></font>
        ...<font></font>
    }<font></font>
    ...<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Avertissement PVS-Studio: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3123</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Peut-√™tre le '??' </font><font style="vertical-align: inherit;">L'op√©rateur fonctionne d'une mani√®re diff√©rente de celle attendue. </font><font style="vertical-align: inherit;">Sa priorit√© est inf√©rieure √† la priorit√© des autres op√©rateurs dans sa partie gauche. </font><font style="vertical-align: inherit;">Nethermind.JsonRpc JsonRpcService.cs 123 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et encore une fois, la priorit√© de l'op√©ration est "??", par cons√©quent, comme la derni√®re fois, nous consid√©rons la situation. </font><font style="vertical-align: inherit;">Nous regardons cette ligne ici:</font></font><br>
<br>
<pre><code class="cs hljs">expectedParameters.Length <font></font>
            - (providedParameters?.Length ?? <span class="hljs-number">0</span>) <font></font>
            + providedParameters?.Count(<span class="hljs-keyword">string</span>.IsNullOrWhiteSpace) ?? <span class="hljs-number">0</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Supposons que </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">providedParameters</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , puis pour plus de clart√©, remplacez imm√©diatement tout ce qui est li√© √† </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">providedParameters</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> par </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null,</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font><font style="vertical-align: inherit;">remplacez une valeur al√©atoire </font><font style="vertical-align: inherit;">au lieu de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">expectParameters.Length</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-number">100</span> - (<span class="hljs-literal">null</span> ?? <span class="hljs-number">0</span>) + <span class="hljs-literal">null</span> ?? <span class="hljs-number">0</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, on remarque imm√©diatement qu'il y a deux contr√¥les similaires, seulement dans un cas il y a des crochets, et dans l'autre l√†. Ex√©cutons cet exemple. D'abord, nous obtenons que ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null ?? 0</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) renverra 0, puis soustrayez 0 de 100 et obtenez 100:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-number">100</span> + <span class="hljs-literal">null</span> ?? <span class="hljs-number">0</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, au lieu d'ex√©cuter d'abord " </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null ?? 0</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " et d'obtenir finalement ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">100 + 0</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), nous obtenons compl√®tement diff√©rent. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
D'abord, il s'ex√©cutera ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">100 + null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) et nous obtiendrons </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Ensuite, il v√©rifie ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null ?? 0</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), ce qui conduit au fait que la valeur de la variable missingParamsCount sera 0. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme la condition suivante est que le </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">missingParamsCount</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est </font><i><font style="vertical-align: inherit;">√©gal √†</font></i><font style="vertical-align: inherit;"> z√©ro, nous pouvons supposer que c'est le comportement recherch√© par le d√©veloppeur. Et je dirai, pourquoi ne pas mettre des parenth√®ses et exprimer mes pens√©es de mani√®re explicite? En g√©n√©ral, il est possible que cette v√©rification soit due √† une mauvaise compr√©hension de la raison pour laquelle 0 est parfois retourn√©, et ce n'est rien de plus qu'une b√©quille.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et encore une fois, nous perdons du temps, bien que nous ne l'ayons peut-√™tre pas fait; utilisez le mode d' </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">analyse incr√©mentielle</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> lors de l'√©criture de code </font><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En conclusion, j'esp√®re avoir pu vous transmettre que l'analyseur statique est votre ami, et non un mauvais surveillant qui n'attend que vous pour faire une erreur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il convient √©galement de noter qu'en utilisant l'analyseur une fois ou en l'utilisant rarement, vous trouverez bien s√ªr des erreurs et certaines d'entre elles seront m√™me rapidement corrig√©es, mais il y en aura aussi dont vous devrez vous casser la t√™te. </font><font style="vertical-align: inherit;">Par cons√©quent, vous devez constamment utiliser un analyseur statique. </font><font style="vertical-align: inherit;">Ensuite, vous trouverez de nombreuses autres erreurs et les corrigerez au moment o√π le code du programme est √©crit et vous comprendrez exactement ce que vous essayez de faire.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La simple v√©rit√© est que tout le monde fait des erreurs et c'est normal. </font><font style="vertical-align: inherit;">Nous apprenons tous des erreurs, mais seulement de celles qui ont pu le remarquer et le comprendre. </font><font style="vertical-align: inherit;">Par cons√©quent, utilisez des outils modernes pour rechercher ces m√™mes erreurs, par exemple - PVS-Studio. </font><font style="vertical-align: inherit;">Merci pour l'attention.</font></font><br>
<br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="></a></p><div style="text-align:center;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/eb2/f9c/3bb/eb2f9c3bb5f32f39239298d36431961c.png"></a></div><p></p><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous souhaitez partager cet article avec un public anglophone, veuillez utiliser le lien vers la traduction: Nikolay Mironov. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Code sur une seule ligne ou v√©rification de Nethermind √† l'aide de PVS-Studio C # pour Linux</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr504296/index.html">G√©n√©ration de branches al√©atoires en Python</a></li>
<li><a href="../fr504306/index.html">Comment le mat√©riel russe est-il con√ßu pour le stockage Aerodisk Vostok sur Elbrus</a></li>
<li><a href="../fr504310/index.html">Dichotomie des donn√©es: repenser la relation avec les donn√©es et les services</a></li>
<li><a href="../fr504312/index.html">Registre unifi√© des programmes russes et de la GPL. Mes cinq cents</a></li>
<li><a href="../fr504314/index.html">Impl√©mentation des commandes Docker Pull et Docker Push sans client Docker via des requ√™tes HTTP</a></li>
<li><a href="../fr504326/index.html">Evgeny Dikiy: ¬´Localement, l'Antarctique a √©t√© le moins sali, mais la pollution mondiale est tr√®s visible ici¬ª</a></li>
<li><a href="../fr504328/index.html">Cours de vote √©lectronique √† la Douma de Moscou 2019</a></li>
<li><a href="../fr504334/index.html">–ù–∞—Å–∫–æ–ª—å–∫–æ —Ö–æ—Ä–æ—à–æ –≤—ã –∑–Ω–∞–µ—Ç–µ JavaScript?</a></li>
<li><a href="../fr504344/index.html">Authentification - CUSTOM SETUP / AWS Amplify + React Native</a></li>
<li><a href="../fr504348/index.html">Monowheel: ce qui se passe pendant l'entra√Ænement et comment acc√©l√©rer ce processus</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>