<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🐶 💽 🧑🏻 Hyper-VでArch Linuxゲストの拡張セッションモードを有効にする 🙍🏻 🙋🏿 🍔</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hyper-VでLinux仮想マシンをそのまま使用することは、Windowsゲストマシンよりも少し快適ではありません。これは、Hyper-Vが元々デスクトップでの使用を意図していないためです。VirtualBoxで発生するように、ゲストアドオンのパッケージを取得してインストールし、実用的なグラフィッ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Hyper-VでArch Linuxゲストの拡張セッションモードを有効にする</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/482372/"><p><img src="https://habrastorage.org/webt/hh/1y/sx/hh1ysx-anppdkwei9z4fe0olfsg.png" alt="KDPV"></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hyper-VでLinux仮想マシンをそのまま使用することは、Windowsゲストマシンよりも少し快適ではありません。</font><font style="vertical-align: inherit;">これは、Hyper-Vが元々デスクトップでの使用を意図していないためです。</font><font style="vertical-align: inherit;">VirtualBoxで発生するように、ゲストアドオンのパッケージを取得してインストールし、実用的なグラフィックアクセラレーション、クリップボード、共有ディレクトリ、その他の楽しみを手に入れることはできません。</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hyper-V自体は</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">いくつかの統合サービスを</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提供します。</font><font style="vertical-align: inherit;">たとえば、ゲストはホストのシャドウコピーサービス（VSS）を使用でき、ゲストはシャットダウン信号を送信でき、ゲストはシステム時間を仮想化ホストと同期でき、ホストは仮想マシンとファイルを交換できます（</font></font><code>Copy-VMFile</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PowerShellで）。もちろん、Windowsを含む一部のゲストオペレーティングシステムでは、仮想マシン接続（</font></font><code>vmconnect.exe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">アプリケーション</font><font style="vertical-align: inherit;">が拡張セッションモードを提供します。これは、RDPプロトコルを介して機能し、ディスクデバイスとプリンターを仮想マシンに転送したり、共通のクリップボードを使用したりできるようにします。</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">拡張セッションモードは、インストール後すぐにHyper-VのWindowsで実行されます。</font><font style="vertical-align: inherit;">Linux上のゲストでは、vsock（ハイパーバイザーと通信するように設計されたLinuxの特別な仮想ネットワークアドレス空間）をサポートするRDPサーバーをインストールする必要があります。</font><font style="vertical-align: inherit;">WindowsのデスクトップエディションのHyper-Vに付属するVMCreateアプリケーションのUbuntuの場合、vsockで動作するXRDP RDPサーバー</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">すでにプリインストールされて</font><font style="vertical-align: inherit;">いる特別な準備済み仮想マシンテンプレートがあり、</font><font style="vertical-align: inherit;">他のディストリビューションではすべてが</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">次第に不明確になり</font></a><font style="vertical-align: inherit;">ます</font><font style="vertical-align: inherit;">-したがって、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">この投稿の</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">著者</font><font style="vertical-align: inherit;">FedoraにESMを含めることが判明しました。</font><font style="vertical-align: inherit;">ここでは、Arch Linuxで仮想マシンの拡張セッションモードをアクティブ化します。</font></font><a name="habracut"></a></p><br>
<h4 id="ustanovka-servisov-integracii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Integration Servicesをインストールする</font></font></h4><br>
<p>     ,     <code>hyperv</code>   community:</p><br>
<pre><code class="plaintext hljs">% sudo pacman -S hyperv</code></pre><br>
<p>  VSS,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"></a>  :</p><br>
<pre><code class="plaintext hljs">% for i in {vss,fcopy,kvp}; do sudo systemctl enable hv_${i}_daemon.service; done</code></pre><br>
<h4 id="ustanovka-xrdp"> XRDP</h4><br>
<p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">linux-vm-tools</a>  GitHub  ,      XRDP,  Arch Linux  Ubuntu.  Git,     ,         ,    :</p><br>
<pre><code class="plaintext hljs">% sudo pacman -S git base-devel<font></font>
% git clone https://github.com/microsoft/linux-vm-tools.git<font></font>
% cd linux-vm-tools/arch</code></pre><br>
<p>        XRDP,    <code>makepkg.sh</code>,   ,  0.9.11, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">   </a> <code>vsock://</code>-,    XRDP  Git   Xorg    AUR .   XRDP,   AUR,   ,    PKGBUILD   .</p><br>
<p>   PKGBUILD-  AUR (         <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">yay</a>,         ):</p><br>
<pre><code class="plaintext hljs">% git clone https://aur.archlinux.org/xrdp-devel-git.git<font></font>
% git clone https://aur.archlinux.org/xorgxrdp-devel-git.git</code></pre><br>
<p>   XRDP.   <code>PKGBUILD</code>   .</p><br>
<p>  . PKGBUILD   XRDP  Git    vsock  ,    :</p><br>
<pre><code class="diff hljs"> build() {<font></font>
   cd $pkgname<font></font>
   ./configure --prefix=/usr \<font></font>
               --sysconfdir=/etc \<font></font>
               --localstatedir=/var \<font></font>
               --sbindir=/usr/bin \<font></font>
               --with-systemdsystemdunitdir=/usr/lib/systemd/system \<font></font>
               --enable-jpeg \<font></font>
               --enable-tjpeg \<font></font>
               --enable-fuse \<font></font>
               --enable-opus \<font></font>
               --enable-rfxcodec \<font></font>
               --enable-mp3lame \<font></font>
<span class="hljs-deletion">-              --enable-pixman</span>
<span class="hljs-addition">+              --enable-pixman \</span>
<span class="hljs-addition">+              --enable-vsock</span><font></font>
   make V=0<font></font>
 }</code></pre><br>
<p>  <code>arch-config.diff</code>,      XRDP    ,   Arch Linux,        <code>instfiles/xrdp.sh</code>,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"> </a>   XRDP,      (<strong>  15-03-2020</strong>:  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"></a>,     ):</p><br>
<pre><code class="diff hljs">  [Install]<font></font>
  WantedBy=multi-user.target<font></font>
<span class="hljs-deletion">-diff -up src/xrdp-devel-git/instfiles/xrdp.sh.orig src/xrdp-devel-git/instfiles/xrdp.sh</span>
<span class="hljs-comment">---- src/xrdp-devel-git/instfiles/xrdp.sh.orig  2017-08-30 00:27:28.000000000 -0600</span>
<span class="hljs-deletion">-+++ src/xrdp-devel-git/instfiles/xrdp.sh   2017-08-30 00:28:00.000000000 -0600</span>
<span class="hljs-deletion">-@@ -17,7 +17,7 @@</span>
<span class="hljs-deletion">- # Description: starts xrdp</span>
<span class="hljs-deletion">- ### END INIT INFO</span>
<span class="hljs-deletion">- </span>
<span class="hljs-deletion">--SBINDIR=/usr/local/sbin</span>
<span class="hljs-deletion">-+SBINDIR=/usr/bin</span>
<span class="hljs-deletion">- LOG=/dev/null</span>
<span class="hljs-deletion">- CFGDIR=/etc/xrdp</span>
<span class="hljs-deletion">- </span><font></font>
 diff -up src/xrdp-devel-git/sesman/startwm.sh.orig src/xrdp-devel-git/sesman/startwm.sh<font></font>
 --- src/xrdp-devel-git/sesman/startwm.sh.orig  2017-08-30 00:27:30.000000000 -0600</code></pre><br>
<p>     <code>% makepkg --skipchecksums -si</code> ( <code>--skipchecksums</code>        ,     ).</p><br>
<p>   <code>xorgxrdp-devel-git</code>,       <code>% makepkg -si</code>.</p><br>
<p>   <code>linux-vm-tools/arch</code>    <code>install-config.sh</code>,   XRDP, PolicyKit  PAM:</p><br>
<pre><code class="plaintext hljs">% sudo ./install-config.sh</code></pre><br>
<p>    <code>use_vsock</code>,     0.9.11,     <code>/etc/xrdp/xrdp.ini</code>  (<strong>  15-03-2020</strong>:  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"></a>,     ):</p><br>
<pre><code class="diff hljs"> ;   port=vsock://&lt;cid&gt;:&lt;port&gt;
<span class="hljs-deletion">-port=3389</span>
<span class="hljs-addition">+port=vsock://-1:3389</span><font></font>
<font></font>
 ; 'port' above should be connected to with vsock instead of tcp<font></font>
 ; use this only with number alone in port above<font></font>
 ; prefer use vsock://&lt;cid&gt;:&lt;port&gt; above<font></font>
<span class="hljs-deletion">-use_vsock=true</span>
<span class="hljs-addition">+;use_vsock=true</span><font></font>
<font></font>
 ; regulate if the listening socket use socket option tcp_nodelay</code></pre><br>
<p>   <code>~/.xinitrc</code>      /   ,      X-:</p><br>
<pre><code class="plaintext hljs">% echo "exec i3" &gt; ~/.xinitrc</code></pre><br>
<p>  .   vsock   ,     PowerShell  :</p><br>
<pre><code class="plaintext hljs">PS Admin &gt; Set-VM -VMName _ -EnhancedSessionTransportType HvSocket</code></pre><br>
<p>   .</p><br>
<h4 id="podklyuchenie"></h4><br>
<p>       XRDP,  vmconnect         <em>View</em> -&gt; <em>Enhanced Session</em>.         ,    <em>Local Resources</em>      ,   RDP-.</p><br>
<p><img src="https://habrastorage.org/webt/wg/z4/_p/wgz4_pvkaixpif7p0oaybxtemdg.png" alt="画面解像度ダイアログ"><br>
<img src="https://habrastorage.org/webt/mk/ke/ji/mkkejiat9lmfh68z0bynnyti7fg.png" alt="ローカルリソース選択ダイアログ"></p><br>
<p>.    XRDP:</p><br>
<p><img src="https://habrastorage.org/webt/zy/ek/4o/zyek4ob6kerkxk9cah8k5cvwx18.png" alt="XRDPログインウィンドウ"></p><br>
<p>     .</p><br>
<h4 id="ispolzovanie"></h4><br>
<p>    :  RDP   ,        Enhanced Session.   VM  RDP     <code>${HOME}/shared-drives</code>:</p><br>
<p><img src="https://habrastorage.org/webt/om/-h/lx/om-hlxtslyx9nwmso7_yftyqnng.png" alt="VM内でスローされたCドライブの内容"></p><br>
<p>   .    ,     ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">  </a>.    ,      .  ,      Alt+Tab,   vmconnect   .</p><br>
<p>  -       vmconnect   Windows RDP- , ,       ,       <code>/etc/xrdp/xrdp.ini</code> <code>port</code>  <code>tcp://:3389</code>.      Default Switch      DHCP,          <code>_.mshome.net</code>.   TTY     vmconnect,  Enhanced Mode.</p><br>
<p><strong> </strong>:</p><br>
<ol>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">Hyper-V — Arch Wiki</a></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitHubの上Bagreport：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></a></li>
</ol></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja482360/index.html">Habra探偵：彼らはUFOの友達です</a></li>
<li><a href="../ja482362/index.html">ほぼ無政府状態：Fidonetの簡単な歴史、インターネット経由での勝利を気にしないプロジェクト</a></li>
<li><a href="../ja482364/index.html">あなたが[たぶん] Javaについて知らなかったこと</a></li>
<li><a href="../ja482366/index.html">ロボットカーの専門家はテスラオートパイロットについてどう思いますか</a></li>
<li><a href="../ja482370/index.html">nodejs：プロセスマネージャーとES6モジュール</a></li>
<li><a href="../ja482374/index.html">Entity Component Systemテンプレートを使用して、LibGDXでゲームを開発します</a></li>
<li><a href="../ja482378/index.html">ワコムの簡単な歴史：グラフィックタブレットテクノロジーが電子リーダーにどのように登場したか</a></li>
<li><a href="../ja482382/index.html">翻訳の4つの原則、またはどのようにして男性は機械翻訳者に屈服しないでしょうか？</a></li>
<li><a href="../ja482384/index.html">私の未実現プロジェクト。200 MikroTikルーターのネットワーク</a></li>
<li><a href="../ja482390/index.html">Ember.jsチュートリアルのチュートリアル。スーパーレンタルアプリ。パート1.2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>