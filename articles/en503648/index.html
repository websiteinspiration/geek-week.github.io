<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🕵🏼 👨🏼‍🔧 🧙🏾 What does the output of "ss -s" mean 🕝 🐋 👨🏻‍🎨</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The netstat utility has been replaced by the ss utility, and very often the output of aggregated (summary) information “ ss -s ” (or “ ss --summary ”)...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>What does the output of "ss -s" mean</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/503648/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">netstat</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> utility has been replaced by the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ss</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> utility, </font><font style="vertical-align: inherit;">and very often the output of aggregated (summary) information “ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ss -s</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ” (or “ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ss --summary</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”) is used for monitoring needs. </font><font style="vertical-align: inherit;">However, what does each of the displayed fields mean?</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-comment"># ss -s</span><font></font>
Total: 15046 (kernel 16739)<font></font>
TCP:   39306 (estab 11458, closed 25092, orphaned 110, synrecv 0, timewait 24929/0), ports 0<font></font>
<font></font>
Transport Total     IP        IPv6<font></font>
*	  16739     -         -        <font></font>
RAW	  0         0         0        <font></font>
UDP	  15        5         10       <font></font>
TCP	  14214     1214      13000    <font></font>
INET	  14229     1219      13010    <font></font>
FRAG	  0         0         0        <font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As it turned out, there are subtleties.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The source of truth is the source code. </font><font style="vertical-align: inherit;">The source code of the utility «ss» found in </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iproute2 / the misc / ss.c</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">The output of "ss -s" is done in the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print_summary</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> function </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Prior to version 4.17.0, the output of “ss -s” is displayed above. </font><font style="vertical-align: inherit;">After </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">committing 90ee99d,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> it began to look like this:</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-comment"># ss -s</span><font></font>
Total: 15046<font></font>
TCP:   39306 (estab 11458, closed 25092, orphaned 110, timewait 24929)<font></font>
<font></font>
Transport Total     IP        IPv6<font></font>
RAW	  0         0         0        <font></font>
UDP	  15        5         10       <font></font>
TCP	  14214     1214      13000    <font></font>
INET	  14229     1219      13010    <font></font>
FRAG	  0         0         0        <font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As you can see, the "kernel" field has been removed from the "Total" line. </font><font style="vertical-align: inherit;">In the line “TCP”, the field “synrecv” was deleted, one (first) number “timewait” remained, the field “ports” was deleted. </font><font style="vertical-align: inherit;">In the table "Transport" the row "*" was deleted. </font><font style="vertical-align: inherit;">The general meaning of the commit can be translated as: " </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We have removed from the output what has long been broken</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ."</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What was broken?</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print_summary</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> version 4.16.0 is used structure </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">slabstat</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , filled by calling </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">get_slabstat</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">If we try to translate the get_slabstat call into shell commands, we get the following:</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-comment"># egrep '^(sock|tcp_bind_bucket|tcp_tw_bucket|tcp_open_request|skbuff_head_cache)' /proc/slabinfo | awk '{ print $1, $2; }'</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Where the keys from "/ proc / slabinfo" correspond to the fields of the "slabstat" structure:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">slabstat</span> {</span>
	<span class="hljs-keyword">int</span> socks;       <span class="hljs-comment">// sock, net/core/sock.c:sk_init,   2.6.12</span>
	<span class="hljs-keyword">int</span> tcp_ports;   <span class="hljs-comment">// tcp_bind_bucket, net/ipv4/tcp.c:tcp_init</span>
	<span class="hljs-keyword">int</span> tcp_tws;     <span class="hljs-comment">// tcp_tw_bucket, net/ipv4/tcp.c:tcp_init,   2.6.14</span>
	<span class="hljs-keyword">int</span> tcp_syns;    <span class="hljs-comment">// tcp_open_request, net/ipv4/tcp.c:tcp_init,   2.6.13</span>
	<span class="hljs-keyword">int</span> skbs;        <span class="hljs-comment">// skbuff_head_cache, net/core/skbuff:skb_init,  </span><font></font>
};<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In other words, of all the values ​​obtained from "/ proc / slabinfo" today, only the value "tcp_bind_bucket" can be obtained, which is displayed in the "ports" field. </font><font style="vertical-align: inherit;">I will give his description from the book “TCP / IP Architecture, Design, and Implementation in Linux. </font><font style="vertical-align: inherit;">By S. Seth and MA Venkatesulu 2008 the IEEE Computer Society ":</font></font><br>
<blockquote>This structure keeps information about the port number usage by sockets and the way the port number is being used. The information is useful enough to tell the new binding socket whether it can bind itself to a particular port number that is already in use. The data structure also keeps track of all the socket’s that are associated with this port number.</blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Now again the same thing, but in the form of a picture (the artist from me is so-so): </font></font><br>
<br>
<img src="https://habrastorage.org/webt/nh/do/ym/nhdoym9qq9nhakjcq0qs8pubpuu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Do you notice anything strange? </font><font style="vertical-align: inherit;">Slab “sock” (deleted in 2.6.12) has a nonzero value. </font><font style="vertical-align: inherit;">The explanation is very simple - due to the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">peculiarities of string comparison,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> any number whose key begins with "sock" will get into the field value. </font><font style="vertical-align: inherit;">In my case, this is “sock_inode_cache” from “net / socket.c: init_inodecache” related to “sockfs” - a list of “inodes” containing “socket struct” (maybe this is not quite what the author of the utility intended):</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-comment"># egrep '^sock' /proc/slabinfo | awk '{ print $1, $2; }'</span><font></font>
sock_inode_cache 16739<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Well, “tcp_bind_bucket” is missing just because of the kernel build options (and, accordingly, the “ports” field always has the value “0”).</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Output Description “ss -s”</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Before diving into the intricacies of field calculations, it makes sense to refresh the state of sockets in memory (ESTABLISHED, CLOSE-WAIT, TIME-WAIT, etc.). </font><font style="vertical-align: inherit;">For those who have forgotten, help wiki: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RU</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EN</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The output of the utility is based on the values ​​obtained from the files:</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-comment"># cat /proc/net/sockstat</span><font></font>
sockets: used 15046<font></font>
TCP: inuse 1205 orphan 111 tw 24952 alloc 14368 mem 5890<font></font>
UDP: inuse 5 mem 86<font></font>
UDPLITE: inuse 0<font></font>
RAW: inuse 0<font></font>
FRAG: inuse 0 memory 0<font></font>
<font></font>
<span class="hljs-comment"># cat /proc/net/sockstat6</span><font></font>
TCP6: inuse 13000<font></font>
UDP6: inuse 10<font></font>
UDPLITE6: inuse 0<font></font>
RAW6: inuse 0<font></font>
FRAG6: inuse 0 memory 0<font></font>
<font></font>
<span class="hljs-comment"># egrep '^Tcp:' /proc/net/snmp</span><font></font>
Tcp: RtoAlgorithm RtoMin RtoMax ... AttemptFails EstabResets CurrEstab ...<font></font>
Tcp: 1 200 120000 ... 1348218 4095008 11458 ...<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Values ​​calculated from the contents of "net / sockstat" (to simplify the perception in the pictures):</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ll/y9/r_/lly9r_hmfcfhkf1-tyu0opkbyg8.png"><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Total</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - the total number of sockets in the system (including unix sockets) in any state except TIME_WAIT;</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TCP:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - the total number of TCP sockets (including IPv6) in any state, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tw</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sockets are separated from </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">alloc</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sockets due to the so-called. </font><font style="vertical-align: inherit;">" </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Death row</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " - they can not be used until the transition to the CLOSED state.</font></font><br>
 <ul>
<li><b>orphaned</b> —   «» TCP  (,       );</li>
<li><b>timewait</b> —   TCP    TIME_WAIT;</li>
<li><b>inuse TCP, UDP, RAW</b> —   <b>v4</b>         CLOSED  TIME_WAIT;</li>
<li><b>inuse FRAG</b> (bool) —   , <b>memory</b> —       (   <b>mem</b>,    ).</li>
</ul></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Values ​​calculated by the contents of "net / sockstat6": </font></font><br>
<br>
<img src="https://habrastorage.org/webt/oq/i7/ja/oqi7jaqtagey4sy-kkgkejirudw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Everything seems to be simple here - " </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Transport / Total</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " is the sum-of-total sum of the " </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " and " </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IPv6</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " </font><font style="vertical-align: inherit;">values </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Values ​​calculated from the contents of "net / snmp". </font><font style="vertical-align: inherit;">According to </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RFC-4022</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , “ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tcpCurrEstab</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ” is “The number of TCP connections for which the current state is either ESTABLISHED or CLOSE-WAIT”. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qo/2x/as/qo2xascklqre17kvzw9yxktyo-o.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And the last “ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">closed</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ” </font><font style="vertical-align: inherit;">field </font><font style="vertical-align: inherit;">is the sum of allocated sockets and sockets in TIME_WAIT state minus the sum of TCPv4 and TCPv6 sockets in any of the unclosed states: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/1_/sp/oa/1_spoafqh2_qydt6jxtrsszmf_s.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PS And do not forget to sign the axes on the graphs.</font></font><br></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en503632/index.html">1000 and 1 post: happy birthday, Habr ❤</a></li>
<li><a href="../en503634/index.html">5 interesting JavaScript finds made in Vue source code</a></li>
<li><a href="../en503636/index.html">What kind of load on the servers create network mechanisms?</a></li>
<li><a href="../en503638/index.html">6 useful habits that, surprisingly, only a few programmers have</a></li>
<li><a href="../en503642/index.html">How to get on LinkedIn, Facebook, Google in Silicon Valley</a></li>
<li><a href="../en503650/index.html">VKCup 2020 Stage I. A Long Way</a></li>
<li><a href="../en503652/index.html">Digital events in Moscow from May 25 to May 31</a></li>
<li><a href="../en503654/index.html">Web service that allows users to independently maintain a culture of communication online</a></li>
<li><a href="../en503656/index.html">The band suppression algorithm in the image as a tool for improving the quality of tomographic reconstruction</a></li>
<li><a href="../en503660/index.html">Test projects without pain. Yandex Report</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>