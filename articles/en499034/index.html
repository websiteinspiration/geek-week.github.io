<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üìà üî¢ üìØ How to roll out dangerous refactoring to prod with a million users? üë∏üèΩ üêí üîõ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The film "Airplane", 1980. 
 
 That's how I felt when I poured another refactoring on the prod. Even if you cover the entire code with metrics and log...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>How to roll out dangerous refactoring to prod with a million users?</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/manychat/blog/499034/"><img src="https://habrastorage.org/webt/xi/ny/b7/xinyb7sar_jz5ueywnjobp8rfrs.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The film "Airplane", 1980. </font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
That's how I felt when I poured another refactoring on the prod. </font><font style="vertical-align: inherit;">Even if you cover the entire code with metrics and logs, test the functionality on all environments - this will not save 100% from the fakaps after the deployment.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">First Fakap</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Somehow we refactored our processing of integration with Google Sheets. For users, this is a very valuable feature, because they use many tools at the same time that need to be linked together - send contacts to a table, upload answers to questions, export users, etc. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The integration code did not refactor from the first version and it became increasingly difficult to maintain. This started affecting our users - old bugs were revealed that we were afraid to edit due to the complexity of the code. It's time to do something about it. No logical changes were supposed - just write tests, move classes and comb names. Of course, we tested the functionality on the dev environment and went to deploy.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After 20 minutes, users wrote that the integration did not work. </font><font style="vertical-align: inherit;">The functionality of sending data to Google Sheet fell off - it turned out that for debug we send data in different formats for sales and local environments. </font><font style="vertical-align: inherit;">When refactoring, we hit the format for selling. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We fixed the integration, but nevertheless, the sediment from the merry Friday evening (and you thought!) Remained. </font><font style="vertical-align: inherit;">In retrospect (meeting the team to complete the sprint), we began to think about how to prevent such situations in the future - we need to improve the practice of manual testing, auto-testing, working with metrics and alarms, and besides this, we got the idea to use feature flags to test refactoring on prode, in fact, this will be discussed.</font></font><br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Implementation</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The scheme is simple: if the user has the flag enabled, go to the code with the new version, if not, to the code with the old version:</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-keyword">if</span> ($user-&gt;hasFeature(UserFeatures::FEATURE_1)) {
  <span class="hljs-comment">// new version</span>
} <span class="hljs-keyword">else</span> {
  <span class="hljs-comment">// old version</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
With this approach, we have the opportunity to test refactoring on prod first on ourselves and then pour it on users. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Almost from the very start of the project, we had a primitive implementation of the flags feature. </font><font style="vertical-align: inherit;">In the database for two basic entities, user and account, features fields were added, which were a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bit mask</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">In the code, we registered new constants for features, which we then added to the mask if a specific feature becomes available to the user.</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">const</span> ALLOW_FEATURE_1 = <span class="hljs-number">0b0000001</span>;
<span class="hljs-keyword">public</span> <span class="hljs-keyword">const</span> ALLOW_FEATURE_2 = <span class="hljs-number">0b0000010</span>;
<span class="hljs-keyword">public</span> <span class="hljs-keyword">const</span> ALLOW_FEATURE_3 = <span class="hljs-number">0b0000100</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The use in the code looked like this:</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-keyword">If</span> ($user-&gt;hasFeature(UserFeatures::ALLOW_FEATURE_1)) {
  <span class="hljs-comment">// feature 1 logic</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When refactoring, we usually first open the flag to the team for testing, then to several users who actively use the feature, and finally open to all, but sometimes more complex schemes appear, more about them below.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Overloaded place refactoring</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
One of our systems accepts Facebook webhooks and processes them through the queue. Queue processing ceased to cope and users began to receive certain messages with a delay, which could critically affect the experience of bot subscribers. We began to refactor this place by transferring processing to a more complex queue scheme. The place is critical - it is dangerous to pour new logic on all servers, so we closed the new logic under the flag and were able to test it on the prod. But what happens when we open this flag at all? How will our infrastructure behave? This time we deployed the opening of the flag on the servers and followed the metrics.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
All critical data processing we have divided into clusters. </font><font style="vertical-align: inherit;">Each cluster has an id. </font><font style="vertical-align: inherit;">We decided to simplify testing of such complex refactoring by opening the flag feature only on certain servers, the check in the code looks like this:</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-keyword">If</span> ($user-&gt;hasFeature(UserFeatures::CGT_REFACTORING) ||<font></font>
    \in_array($cluster, Configurator::get(<span class="hljs-string">'cgt_refactoring_cluster_ids'</span>))) {
  <span class="hljs-comment">// new version</span>
} <span class="hljs-keyword">else</span> {
  <span class="hljs-comment">// old version</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
First, we poured refactoring and opened the flags to the team. </font><font style="vertical-align: inherit;">Then we found several users who actively used the cgt feature, opened flags to them and looked to see if everything worked for them. </font><font style="vertical-align: inherit;">And finally, they began to open flags on the servers and follow the metrics. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The cgt_refactoring_cluster_ids flag can be changed through the admin panel. </font><font style="vertical-align: inherit;">Initially, we assign the value cgt_refactoring_cluster_ids to an empty array, then add one cluster at a time - [1], look at the metrics for a while and add another cluster - [1, 2] until we test the entire system.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configurator implementation</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I‚Äôll talk a bit about what Configurator is and how it is implemented. </font><font style="vertical-align: inherit;">It was written to be able to change the logic without deployment, for example, as in the case above, when we need to sharply roll back the logic. </font><font style="vertical-align: inherit;">We also use it for dynamic configs, for example, when you need to test different caching times, you can take it out for quick testing. </font><font style="vertical-align: inherit;">For the developer, this looks like a list of fields with admin values ‚Äã‚Äãthat can be changed. </font><font style="vertical-align: inherit;">We store all this in a DB, we cache in Redis and in a statics for our workers.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Refactoring outdated locations</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the next quarter, we refactored the registration logic, preparing it for the transition to the possibility of registration through several services. </font><font style="vertical-align: inherit;">In our conditions, it is impossible to cluster the registration logic so that a certain user is tied to a certain logic, and we did not come up with anything better than testing the logic, rolling out a percentage of all registration requests. </font><font style="vertical-align: inherit;">This is easy to do in a similar way with flags:</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-keyword">If</span> (Configurator::get(<span class="hljs-string">'auth_refactoring_percentage'</span>) &gt; \random_int(<span class="hljs-number">0</span>, <span class="hljs-number">99</span>)) {
  <span class="hljs-comment">// new version</span>
} <span class="hljs-keyword">else</span> {
  <span class="hljs-comment">// old version</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Accordingly, we set the value of auth_refactoring_percentage in the admin panel from 0 to 100. Of course, we ‚Äúsmeared‚Äù the entire authorization logic with metrics to understand that we did not reduce the conversion in the end.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Metrics</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To tell how we follow metrics in the process of opening flags, we will consider another case in more detail. </font><font style="vertical-align: inherit;">ManyChat accepts Facebook hooks from Facebook when a subscriber sends a message to Facebook Messenger. </font><font style="vertical-align: inherit;">We must process each message in accordance with business logic. </font><font style="vertical-align: inherit;">For the cgt feature, we need to determine whether the subscriber started the conversation through a comment on Facebook in order to send him a relevant message in response. </font><font style="vertical-align: inherit;">In the code, it looks like determining the context of the current subscriber, if we can determine the widgetId, then we determine the response message from it.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">More about feature</font></font></b>
                        <div class="spoiler_text"> Facebook                api.      ‚Äî    .        Widget,   :<br>
<br>
  ‚Äî&gt;     ‚Äî&gt;     ‚Äî&gt;         Facebook:<br>
<br>
<img src="https://habrastorage.org/webt/a7/n8/jx/a7n8jxdxulwxquozeje_kzabv_y.gif"><br>
<br>
     : <br>
  ‚Äî&gt;    ‚Äî&gt;  <br>
<br>
<img src="https://habrastorage.org/webt/y0/i7/1l/y0i71lh-zttfdvcs3n1bny56w8e.gif"><br>
<br>
     ‚Äú , !‚Äù   ,        .   ,     ‚Äú  !‚Äù   id       ,     ‚Äî   ,     id.<br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Previously, we defined the context in 3 ways, it looked something like this:</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getWidgetIdContext</span>(<span class="hljs-params">User $user, WatchService $watcher</span>): <span class="hljs-title">int</span>?
</span>{
  <span class="hljs-comment">//      </span>
  <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> !== $user-&gt;gt_widget_id_context) {<font></font>
    $watcher-&gt;logTick(<span class="hljs-string">'cgt_match_processor_matched_via_context'</span>);<font></font>
<font></font>
    <span class="hljs-keyword">return</span> $user-&gt;gt_widget_id_context;<font></font>
  }<font></font>
<font></font>
  <span class="hljs-comment">//      </span>
  <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> !== $user-&gt;name) {<font></font>
    $widgetId = <span class="hljs-keyword">$this</span>-&gt;cgtMatchByThread($user);
    <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> !== $widgetId) {<font></font>
      $watcher-&gt;logTick(<span class="hljs-string">'cgt_match_processor_matched_via_thread'</span>);<font></font>
<font></font>
      <span class="hljs-keyword">return</span> $widgetId;<font></font>
    }<font></font>
<font></font>
    $widgetId = <span class="hljs-keyword">$this</span>-&gt;cgtMatchByConversation($user);
    <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> !== $widgetId) {<font></font>
      $watcher-&gt;logTick(<span class="hljs-string">'cgt_match_processor_matched_via_conversation'</span>);<font></font>
<font></font>
      <span class="hljs-keyword">return</span> $widgetId;<font></font>
    }<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The watcher service sends analytics at the time of the match, respectively, we had metrics for all three cases: The </font></font><br>
<br>
<img src="https://habrastorage.org/webt/bh/x5/gy/bhx5gygff9kthgcyd_zcri1fkyu.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">number of</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> times the </font><i><font style="vertical-align: inherit;">context was found by different methods of linking in time.</font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Next, we found another match method that should replace all the old options. </font><font style="vertical-align: inherit;">To test this, we got another metric:</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getWidgetIdContext</span>(<span class="hljs-params">User $user, WatchService $watcher</span>): <span class="hljs-title">int</span>?
</span>{
  <span class="hljs-comment">//    </span>
  $widgetId = <span class="hljs-keyword">$this</span>-&gt;cgtMatchByEcho($user);<font></font>
  <font></font>
  <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> !== $widgetId) {<font></font>
      $watcher-&gt;logTick(<span class="hljs-string">'cgt_match_processor_matched_via_echo_message'</span>);<font></font>
  }<font></font>
<font></font>
  <span class="hljs-comment">//    </span>
  <span class="hljs-comment">// ...</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
At this stage, we want to make sure that the number of new hits is equal to the sum of the old hits, so just write the metric without returning $ widgetId: The </font></font><br>
<br>
<img src="https://habrastorage.org/webt/wa/kw/wp/wakwwppphodtzn7huuj_vhajdb4.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">number of contexts found by the new method completely covers the sum of bindings by the old methods</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
But this does not guarantee us the correct match logic on all cases. </font><font style="vertical-align: inherit;">The next step is gradual testing through the opening of flags:</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getWidgetIdContext</span>(<span class="hljs-params">User $user, WatchService $watcher</span>): <span class="hljs-title">int</span>?
</span>{
  <span class="hljs-comment">//    </span>
  $widgetId = <span class="hljs-keyword">$this</span>-&gt;cgtMatchByEcho($user);<font></font>
  <font></font>
  <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> !== $widgetId) {<font></font>
    $watcher-&gt;logTick(<span class="hljs-string">'cgt_match_processor_matched_by_echo_message'</span>);<font></font>
  <font></font>
    <span class="hljs-comment">//    ,   </span>
    <span class="hljs-keyword">If</span> (<span class="hljs-keyword">$this</span>-&gt;allowMatchingByEcho($user)) {
      <span class="hljs-keyword">return</span> $widgetId;<font></font>
    }<font></font>
  }<font></font>
<font></font>
  <span class="hljs-comment">// ...</span><font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">allowMatchingByEcho</span>(<span class="hljs-params">User $user</span>): <span class="hljs-title">bool</span>
</span>{
  <span class="hljs-comment">//    </span>
  <span class="hljs-keyword">If</span> ($user-&gt;hasFeature(UserFeatures::ALLOW_CGT_MATCHING_BY_ECHO)) {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
  }<font></font>
  <span class="hljs-comment">//     </span>
  <span class="hljs-keyword">If</span> (\in_array(<span class="hljs-keyword">$this</span>-&gt;clusterId, Configurator::get(<span class="hljs-string">'cgt_matching_by_echo_cluster_ids'</span>))) {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Then the testing process began: at first we tested the new functionality on our own on all environments and on random users who often use matching by opening the flag UserFeatures :: ALLOW_CGT_MATCHING_BY_ECHO. </font><font style="vertical-align: inherit;">At this stage, we caught a few cases when the match worked incorrectly and repaired them. </font><font style="vertical-align: inherit;">Then they started rolling out to servers: on average, we rolled out one server in 1 day during the week. </font><font style="vertical-align: inherit;">Before testing, we warn support that they look closely at the tickets related to the functionality and write to us about any oddities. </font><font style="vertical-align: inherit;">Thanks to support and users, several corner cases were fixed. </font><font style="vertical-align: inherit;">And finally, the last step is the discovery on all unconditionally:</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getWidgetIdContext</span>(<span class="hljs-params">User $user, WatchService $watcher</span>): <span class="hljs-title">int</span>?
</span>{<font></font>
  $widgetId = <span class="hljs-keyword">$this</span>-&gt;cgtMatchByEcho($user);<font></font>
  <font></font>
  <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> !== $widgetId) {<font></font>
    $watcher-&gt;logTick(<span class="hljs-string">'cgt_match_processor_matched_by_echo_message'</span>);<font></font>
  <font></font>
    <span class="hljs-keyword">return</span> $widgetId;<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<font></font>
}</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">New flag feature implementation</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The implementation of the flag feature described at the beginning of the article served us for about 3 years, but with the growth of teams it became uncomfortable - we had to deploy when creating each flag and do not forget to clear the value of the flags (we reused constant values ‚Äã‚Äãfor different features). </font><font style="vertical-align: inherit;">Recently, the component has been rewritten and now we can flexibly manage flags through the admin panel. </font><font style="vertical-align: inherit;">Flags were untied from the bitmask and stored in a separate table - this makes it easy to create new flags. </font><font style="vertical-align: inherit;">Each entry also has a description and owner, flag management has become more transparent.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cons of such approaches</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This approach has a big minus - there are two versions of the code and they need to be supported at the same time. </font><font style="vertical-align: inherit;">When testing, you have to consider that there are two branches of logic, and you need to check them all, and this is very painful. </font><font style="vertical-align: inherit;">During the development, there were situations when we introduced a fix into one logic, but forgot about another, and at some point it shot. </font><font style="vertical-align: inherit;">Therefore, we apply this approach only in critical places and try to get rid of the old version of the code as quickly as possible. </font><font style="vertical-align: inherit;">We try to do the rest of the refactoring in small iterations.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Total</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The current process looks like this - first we close the logic under the condition of the flags, then deploy and begin to gradually open the flags. When expanding flags, we closely monitor errors and metrics, as soon as something goes wrong - immediately roll back the flag and deal with the problem. The plus is that opening / closing the flag is very fast - it is just a change in the value in the admin panel. After some time, we cut out the old version of the code, this should be the minimum time to prevent changes in both versions of the code. It is important to warn colleagues about such refactoring. We do a review through github and use </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">code owners</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> during such refactoring so that the changes do not get into the code without the knowledge of the author of the refactoring.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Most recently, I rolled out a new version of the Facebook Graph API. </font><font style="vertical-align: inherit;">In a second, we make more than 3000 requests to the API and any error is expensive for us. </font><font style="vertical-align: inherit;">Therefore, I rolled out the change under the flag with minimal impact - it turned out to catch one unpleasant bug, test the new version and eventually switch to it completely without worries.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en499016/index.html">Integration with ESIA for .Net: easier than it sounds</a></li>
<li><a href="../en499018/index.html">6 home sports apps</a></li>
<li><a href="../en499020/index.html">A study of one vague behavior</a></li>
<li><a href="../en499030/index.html">Monitoring MySQL performance for Grafana on isic in 20 minutes</a></li>
<li><a href="../en499032/index.html">How to use Prometheus to detect anomalies in GitLab</a></li>
<li><a href="../en499036/index.html">Provider's work: a selection of materials on protocols, IT and network infrastructure</a></li>
<li><a href="../en499038/index.html">My experience using a vertical monitor</a></li>
<li><a href="../en499040/index.html">Read on the weekend: a selection of materials on the history of DNS, IT regulation and hardware 1cloud.ru</a></li>
<li><a href="../en499044/index.html">News from the world of OpenStreetMap No. 508 (04/07/2020/13/04/2020)</a></li>
<li><a href="../en499046/index.html">Cybercalmar neuroevolution</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>