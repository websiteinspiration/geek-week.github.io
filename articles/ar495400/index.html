<!doctype html>
<html class="no-js" lang="ar">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏽‍🎓 🍮 🛠️ العمل مع بطاقة SD عبر واجهة SPI. تنفيذ VHDL ☝🏻 🌳 💘</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="مرحباً هبر! بمجرد العمل ، حصلت على مهمة تقييم إمكانية تنفيذ تخزين البيانات على بطاقة SD عند توصيلها بـ FPGA. تم افتراض استخدام SPI كواجهة تفاعل ، لأنه...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>العمل مع بطاقة SD عبر واجهة SPI. تنفيذ VHDL</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/495400/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">مرحباً هبر! </font><font style="vertical-align: inherit;">بمجرد العمل ، حصلت على مهمة تقييم إمكانية تنفيذ تخزين البيانات على بطاقة SD عند توصيلها بـ FPGA. </font><font style="vertical-align: inherit;">تم افتراض استخدام SPI كواجهة تفاعل ، لأنه أسهل في التنفيذ. </font><font style="vertical-align: inherit;">أود أن أشارك الخبرة المكتسبة.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ga/qw/p6/gaqwp6tekmw-myhnjrsmwo5cam8.png"><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
نظرًا لأن المساحة الموجودة على لوحة الدوائر المطبوعة محدودة دائمًا ، فسيتم النظر في بطاقات SD على سبيل المثال في البطاقات في عامل شكل microSD.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">المحتوى</font></font></h2><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. مواصفات القراءة </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.1 معلومات عامة </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.2 التهيئة </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.3 مسح المعلومات </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.4 </font></font></a><font style="vertical-align: inherit;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;">معلومات </font></a><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;">القراءة </font></a></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.4.1 قراءة كتلة بيانات واحدة </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.4.2 قراءة العديد من كتل البيانات </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.5 معلومات </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">الكتابة 1.5.1 كتابة كتلة بيانات واحدة </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.5.2 كتابة العديد من كتل البيانات </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. تنفيذ الخوارزمية في الأجهزة </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.1 مكون الطبقة المادية </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.2 مكون مستوى الأمر </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.3 مكون الاتصال بالعالم الخارجي </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. التحقق في الأجهزة </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4. النتائج</font></font></a><br>
<br>
<a name="SpecRead"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. مواصفات القراءة</font></font></h2><br>
<a name="GeneralInformation"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.1 عام</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
تخبرنا القراءة السريعة للمواصفات عن خيارات بطاقة SD التالية:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">يتم نقل البيانات إلى بطاقة SD على خط واحد ؛ </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">يتم قراءة البيانات من بطاقة SD على سطر واحد ؛ </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">في وضع SPI ، يمكن أن تكون الطاقة + 3.3V فقط ؛ </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">تردد الساعة في وضع التهيئة في نطاق 100-400 كيلو هرتز ؛</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">تردد الساعة بعد التهيئة - 25 ميجاهرتز.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
وهذا يعني على الفور النقطة في عرض النطاق الترددي الذروة النظري: 25 ميجاهرتز * 1 بت = 25 ميجابت / ثانية ، وهو </font><font style="vertical-align: inherit;">صغير </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">إلى حد ما</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">الثاني ناقص استخدام بطاقات SD ، الطاقة + 3.3V. </font><font style="vertical-align: inherit;">على لوحة الدوائر المطبوعة التي تم التخطيط لها لتثبيت بطاقة SD ، لا يوجد مثل هذا الجهد. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
يمكن تقسيم بطاقات عامل MicroSD إلى 3 فئات حسب السعة:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SDSC </font><font style="vertical-align: inherit;">سعة البطاقة حتى 2 جيجا بايت شاملة. </font><font style="vertical-align: inherit;">العنوان داخل البطاقة بايت.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SDHC. </font><font style="vertical-align: inherit;">سعة البطاقة أكثر من 2 جيجا بايت وتصل إلى 32 جيجا بايت شاملة. </font><font style="vertical-align: inherit;">يشير العنوان الموجود داخل البطاقة إلى كتلة 512 بايت.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SDXC. </font><font style="vertical-align: inherit;">تبلغ سعة البطاقة أكثر من 32 جيجا بايت وتصل إلى 128 تيرابايت. </font><font style="vertical-align: inherit;">يشير العنوان الموجود داخل البطاقة إلى كتلة 512 بايت.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
يظهر الشكل العام للخريطة في الشكل أدناه. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/wp/qo/4d/wpqo4dulzwlonas-3evcspttvra.png"><br>
<div class="scrollable-table"><table>
<tbody><tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">رقم الاتصال</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">اسم</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">نوع</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">وصف</font></font></th>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RSV</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">غير مستعمل</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CS</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">إدخال</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">اختيار رقاقة</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DI</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">إدخال</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">خط البيانات من الجهاز الرئيسي (MOSI)</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vdd</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">التغذية</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">مصدر التيار</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SCLK</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">إدخال</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">إشارة الساعة</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vss</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">التغذية</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">أرض</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">فعل</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">انتاج |</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">خط البيانات إلى الجهاز الرئيسي (MISO)</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RSV</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">غير مستعمل</font></font></td>
</tr>
</tbody></table></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
يتم التوصيل وفقًا للرسم البياني أدناه: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ey/jl/xj/eyjlxjhgg_iucbvd0ms-gzmjinu.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">يجب أن يكون تصنيف المقاوم 50 كيلو أوم ،</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
وبعد تشغيل الطاقة ، تكون بطاقة SD في وضع SDIO. </font><font style="vertical-align: inherit;">للتبديل إلى وضع SPI ، يجب إجراء التهيئة. </font><font style="vertical-align: inherit;">يتضمن بروتوكول العمل مع البطاقة استخدام مخطط تحكم للنقل الصحيح للبيانات والأوامر في شكل خوارزمية CRC. </font><font style="vertical-align: inherit;">عند العمل في وضع SPI ، يتم تعطيل التحقق CRC بشكل افتراضي. </font><font style="vertical-align: inherit;">وبالتالي ، يجب أن يحتوي الأمر الأول الذي تم إرساله إلى البطاقة لتحويل البطاقة إلى وضع SPI على قيمة CRC الصحيحة. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
يبلغ حجم الأوامر المرسلة عبر واجهة SPI 48 بت. </font><font style="vertical-align: inherit;">تنسيق الأمر:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">تحتوي البتة 47 (أقصى اليسار) دائمًا على القيمة 0. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">تحتوي البتة 46 دائمًا على القيمة 1.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> تحتوي البتات 45..40 على فهرس الأوامر.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">تحتوي البتات 39..8 على وسيطات الأمر. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">تحتوي البتات 7..1 على CRC من البتات السابقة. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">يحتوي البت 0 دائمًا على القيمة 1.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
يمنح البتان 47 و 46 البطاقة القدرة على تتبع بداية المعاملة بشكل لا لبس فيه ، لأن حافلة MOSI في حالة الراحة تساوي واحدة. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/dd/ap/8n/ddap8nsdyqcbqezjudom42bzfx8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ستتلقى الأوامر المستخدمة عند العمل مع بطاقة SD إجابات مثل R1 و R3 و R7. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/bt/xq/ce/btxqcevcwggh9qgt6pxznanb0pc.png"><br>
<sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">إجابة من نوع R1 ، حجم 8 بت. </font></font></sub><font style="vertical-align: inherit;"><sub><font style="vertical-align: inherit;">نوع الإجابة R3 ، الحجم 40 بت. </font></sub><sub><font style="vertical-align: inherit;">نوع الإجابة R7 ، حجم 40 بت. </font></sub><font style="vertical-align: inherit;">
جميع الأوامر وإجاباتها مفصلة في </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">المواصفات المادية للطبقة المبسطة.</font></a></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow"><img src="https://habrastorage.org/webt/mu/dg/yb/mudgybpndrbrqpsz5icwgkb1prk.png"></a><br>
<sub><font style="vertical-align: inherit;"></font></sub><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow"><img src="https://habrastorage.org/webt/s-/vq/a8/s-vqa83la-g6k3bwgvvmmfoawms.png"></a><br>
<sub><font style="vertical-align: inherit;"></font></sub><br>
<br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><br>
<br>
<a name="Init"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.2 التهيئة</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
خوارزمية التهيئة:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">بعد تشغيل الطاقة ، انتظر 1 مللي ثانية على الأقل.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">توليد ما لا يقل عن 74 ساعة تبديل للبطاقة. </font><font style="vertical-align: inherit;">يجب أن تكون خطوط CS و MOSI في حالة الوحدة المنطقية.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">إنشاء أمر CMD0. </font><font style="vertical-align: inherit;">يقوم الأمر CMD0 بإعادة تعيين بطاقة SD.</font></font></li>
<li>    CMD0.     R1.  ,   R1    16   ,    3.   R1   ,     0x01 (     ),    3,     5. </li>
<li>  CMD8.            . </li>
<li>    CMD8.     R7.  ,     ,    ,    7, ,           ,    17,    13. </li>
<li>  CMD55.  CMD55  ,     . </li>
<li>    CMD55.     R1.     0x01 (    ),    7,    9. </li>
<li>  ACMD41.  ACMD41  ,    SDSC ( 0x00000000)    . </li>
<li>    ACMD41.     R1.      ,    ,    11. ,    0x00 ( )    14,       7.</li>
<li>  CMD1.  CMD1   ACMD41.</li>
<li>    CMD1.     R1.       ,    ,    13, ,    0x00 ( ),    14,       11.</li>
<li> .   ,   .      . </li>
<li>  CMD16.          ,  512 . </li>
<li>    CMD16.     R1.  ,    0x00 (  )    16,    13. </li>
<li>   .       .   . </li>
<li>  CMD55.  CMD55  ,     . </li>
<li>    CMD55.     R1.     0x01 (    ),    17,    19. </li>
<li>  ACMD41.   ACMD41.  ACMD41  ,    SDHC ( 0x40000000)    .</li>
<li>    ACMD41.     R1.      ,    ,    13. ,    0x00 ( )    21,       17. </li>
<li>  CMD58.    . </li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">في انتظار رد على أمر CMD58. </font><font style="vertical-align: inherit;">الإجابة هي نوع الاستجابة R3. </font><font style="vertical-align: inherit;">إذا تم تعيين بت في الرد بأن البطاقة تعمل مع عناوين كتلة 512 بايت ، فانتقل إلى الخطوة 16 ، وإلا إلى الخطوة 14.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
بعد اكتمال التهيئة ، يمكن تشغيل البطاقة في كتل 512 بايت بتردد ساعة 25 ميجاهرتز. </font><font style="vertical-align: inherit;">هذه هي النسخة الكاملة من خوارزمية التهيئة ، والتي تغطي جميع أنواع البطاقات. </font><font style="vertical-align: inherit;">في حالتي ، عند استخدام بطاقة 16 جيجا بايت ، تتكون خوارزمية التهيئة من الخطوات 1-6 ، 17-22 ، 16.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">خوارزمية الجرافيك</font></font></b>
                        <div class="spoiler_text"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow"><img src="https://habrastorage.org/webt/vp/di/pw/vpdipwdy4umv4iahsea1g2snruu.png"></a></div>
                    </div><br>
<a name="Erase"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.3 مسح المعلومات</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
تدعم بطاقات عامل الشكل Micro SD أوامر المسح. </font><font style="vertical-align: inherit;">بعد أمر المسح ، سيتم ملء قيمة عناوين المسح المحددة بالقيمة 0xFF أو 0x00 ، اعتمادًا على البطاقة. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
خوارزمية محو المعلومات</font></font><br>
<br>
<ol>
<li>  CMD32.        .</li>
<li>    CMD32.     R1.       0x00 ( -    ),    3,    4.</li>
<li> .   ,     . </li>
<li>  CMD33.        .        ,        CMD32. </li>
<li>    CMD33.     R1.       0x00 ( -    ),    3,    6 </li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">إرسال أمر CMD38. </font><font style="vertical-align: inherit;">الأمر الخاص بمسح المعلومات من الكتل المحددة. </font><font style="vertical-align: inherit;">يجب إرسال أي 4 بايت كوسيطة ، باستثناء القيم 0x00000001 ، 0x00000002.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">في انتظار رد على أمر CMD38. </font><font style="vertical-align: inherit;">الجواب هو استجابة من النوع R1b. </font><font style="vertical-align: inherit;">هذه نسخة موسعة من الإجابة عندما تولد البطاقة استجابة R1 ، ثم ترسم خط MISO إلى الصفر ، مما يشير إلى أن الشريحة مشغولة. </font><font style="vertical-align: inherit;">من الضروري الانتظار حتى تظهر قيمة الوحدة على خط MISO. </font><font style="vertical-align: inherit;">إذا لم تكن الإجابة 0x00 (حدث خطأ أثناء تنفيذ الأمر) ، فانتقل إلى الخطوة 3 ، وإلا إلى الخطوة 8</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">استكمال خوارزمية المحو. </font></font></li>
</ol><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">خوارزمية الجرافيك</font></font></b>
                        <div class="spoiler_text"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow"><img src="https://habrastorage.org/webt/hm/qs/cq/hmqscqj62emd9yp30prqqasyjjm.png"></a></div>
                    </div><br>
<a name="Read"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.4 معلومات القراءة</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
يمكن قراءة المعلومات من بطاقة SD عبر SPI بطريقتين.</font></font><br>
<br>
<a name="ReadOne"></a><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.4.1 قراءة كتلة بيانات واحدة</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
عند قراءة كتلة بيانات واحدة ، ينشئ الجهاز الرئيسي أمرًا لبطاقة SD لقراءة كتلة بيانات واحدة ، وينتظر ردًا على أن الأمر قد تمت معالجته وينتظر حزمة تحتوي على بيانات من البطاقة. </font><font style="vertical-align: inherit;">بعد استلام حزمة تحتوي على بيانات من البطاقة ، تنتهي معاملة القراءة. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/g_/oe/q_/g_oeq_mpttrajxmeltmmb5hpl28.png"><br>
<sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">نظرة عامة على عملية قراءة كتلة واحدة من البيانات. </font></font></sub><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
في البداية ، تم تنفيذ مثل هذا الخيار ، ولكن السرعة الناتجة كانت منزعجة للغاية (ستكون مقارنات السرعة أقل).</font></font><br>
<br>
<a name="ReadMore"></a><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.4.2 قراءة كتل بيانات متعددة</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
عند قراءة كتل بيانات متعددة ، ينشئ الجهاز الرئيسي أمرًا لبطاقة SD لقراءة كتل بيانات متعددة ، وينتظر ردًا على معالجة الأمر ، ويتوقع حزمة بيانات من البطاقة. </font><font style="vertical-align: inherit;">بعد إرسال حزمة بيانات ، ترسل البطاقة حزمة البيانات التالية. </font><font style="vertical-align: inherit;">سيستمر هذا حتى يتم تلقي أمر من الجهاز الرئيسي لإكمال القراءة. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ai/ed/tz/aiedtzc1nfh__byzfhuozjnstjc.png"><br>
<sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">نظرة عامة على معاملة قراءة العديد من كتل البيانات. </font></font></sub><br>
<br>
<img src="https://habrastorage.org/webt/i8/ko/9l/i8ko9lasfzqwjehte6q6yg8bs1w.png"><br>
<sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">بنية حزمة البيانات</font></font></sub><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
حيث:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">رمز البيانات </font><font style="vertical-align: inherit;">يستخدم الأمر read القيمة 0xFE.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">كتلة البيانات. </font><font style="vertical-align: inherit;">يحتوي على بيانات مقروءة من البطاقة.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">اتفاقية حقوق الطفل </font><font style="vertical-align: inherit;">تحتوي على المجموع الاختباري من الحقول السابقة.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
إذا حدث خطأ أثناء القراءة ، فإن البطاقة بدلاً من Data Token تُرجع رمز Error. </font><font style="vertical-align: inherit;">حجم رمز الخطأ هو 1 بايت. </font><font style="vertical-align: inherit;">تحتوي البتات 7..5 على قيمة صفر ، بتات 4..0 ترميز نوع الخطأ. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
خوارزمية لقراءة كتل البيانات المتعددة:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">إرسال أمر CMD18. </font><font style="vertical-align: inherit;">يخبر الأمر البطاقة أنه سيتم قراءة كتل متعددة.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">في انتظار رد على أمر CMD18. </font><font style="vertical-align: inherit;">الجواب هو استجابة من نوع R1. </font><font style="vertical-align: inherit;">إذا لم تكن الإجابة 0x00 (حدث خطأ أثناء تنفيذ الأمر) ، فانتقل إلى الخطوة 3 ، وإلا إلى الخطوة 4.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">حالة الخطأ. </font><font style="vertical-align: inherit;">فشلت القراءة ، فخرجت من خوارزمية القراءة.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">في انتظار رمز مميز من البطاقة. </font><font style="vertical-align: inherit;">إذا تم استلام رمز خطأ من البطاقة ، فانتقل إلى الخطوة 3 ، أو انتقل إلى الخطوة 5.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">تلقي من حجم بطاقة كتلة بيانات 512 بايت. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">استقبال من حجم حقل CRC للبطاقة 2 بايت. </font></font></li>
<li>    .     ,    8,    4. </li>
<li>  CMD12.       .  ,       Data Packet,   . </li>
<li>     CMD12.     R1b.     R1,         MISO  ,   .      MISO  ,      .       0x00 ( -    ),    3,    10.</li>
<li>  . </li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
هناك فارق بسيط طفيف في خوارزمية القراءة. </font><font style="vertical-align: inherit;">يجب تعيين إشارة تحديد الشريحة (CS) على المنطق صفر قبل إنشاء الأمر CMD18 وتعيينها إلى المنطق بعد تلقي استجابة للأمر CMD12.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">خوارزمية الجرافيك</font></font></b>
                        <div class="spoiler_text"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow"><img src="https://habrastorage.org/webt/ht/8f/uf/ht8fufwcf9qq-bdrif-4chjd5cg.png"></a></div>
                    </div><br>
<a name="Write"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.5 معلومات التسجيل</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
يمكن كتابة المعلومات إلى بطاقة SD عبر واجهة SPI في نسختين.</font></font><br>
<br>
<a name="WriteOne"></a><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.5.1 كتابة كتلة بيانات واحدة</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
عند تسجيل كتلة بيانات واحدة ، ينشئ الجهاز الرئيسي أمرًا لبطاقة SD لكتابة كتلة بيانات واحدة ، وينتظر استجابة من البطاقة التي تمت معالجة الأمر بها ، وينقل حزمة مع بيانات للتسجيل على البطاقة ، ويتوقع استجابة من البطاقة بأن البيانات مكتوبة ، وتكمل المعاملة. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/u1/j5/7f/u1j57f-xmwqesdk1yzw_fenwvmi.png"><br>
<sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">نظرة عامة على معاملة الكتابة لكتلة بيانات واحدة. </font></font></sub><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
كما هو الحال مع القراءة ، تم تنفيذ سجل كتلة بيانات واحدة في الأصل. </font><font style="vertical-align: inherit;">كانت نتائج السرعة غير مرضية.</font></font><br>
<br>
<a name="WriteMore"></a><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.5.2 كتابة كتل بيانات متعددة</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
عند تسجيل كتل بيانات متعددة ، يقوم الجهاز الرئيسي بإنشاء أمر لتسجيل كتل بيانات متعددة ، وينتظر استجابة من البطاقة التي تمت معالجة الأمر بها ، وينقل حزمة مع بيانات للتسجيل على البطاقة ، ويتوقع استجابة من البطاقة التي يتم تسجيل البيانات فيها. </font><font style="vertical-align: inherit;">بعد تلقي استجابة رئيسية ، يرسل الجهاز حزمة بالبيانات التالية للتسجيل على البطاقة. </font><font style="vertical-align: inherit;">سيستمر هذا حتى يرسل الجهاز الرئيسي رمز إيقاف البيانات. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/-p/l7/fz/-pl7fz2rfyuv5akb7ksrcwdipsy.png"><br>
<sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">نظرة عامة على معاملة الكتابة لعدة كتل بيانات. </font></font></sub><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
تشبه بنية رزمة البيانات بنية رزمة البيانات عند قراءة البيانات. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
شكل:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">رمز البيانات </font><font style="vertical-align: inherit;">بالنسبة للأمر write ، يتم استخدام القيمة 0xFC.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">كتلة البيانات. </font><font style="vertical-align: inherit;">يحتوي على بيانات مكتوبة على البطاقة.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">اتفاقية حقوق الطفل </font><font style="vertical-align: inherit;">تحتوي على المجموع الاختباري من الحقول السابقة.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
حجم Stop Tran Token المستخدم لإكمال أمر الكتابة هو 1 بايت في الحجم ويساوي 0xFD. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
بعد دفع الجزء الأخير من Data Packet في البطاقة ، تستجيب البطاقة للساعة التالية بحالة سجل البيانات - Data Response. </font><font style="vertical-align: inherit;">يبلغ حجم استجابة البيانات 1 بايت ، ويمكن أن تكون البتات 7..5 أيًا ، والبت 4 دائمًا صفر ، والبت 0 دائمًا يساوي واحدًا ، والبتات 3..1 ترميز حالة سجل البيانات. </font><font style="vertical-align: inherit;">بعد إعادة البطاقة Data Packet ، تقوم البطاقة بسحب خط MISO إلى الصفر ، مما يشير إلى أن البطاقة مشغولة. </font><font style="vertical-align: inherit;">بعد أن يكون مستوى الوحدة المنطقية على خط MISO ، يمكنك نقل حزمة البيانات التالية إلى البطاقة. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
خوارزمية تسجيل كتل البيانات المتعددة:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">إرسال أمر CMD25. </font><font style="vertical-align: inherit;">يخبر الأمر البطاقة أنه ستتم كتابة كتل متعددة.</font></font></li>
<li>    CMD25.     R1.       0x00 ( -    ),    3,    4.</li>
<li> .   ,   . </li>
<li>   . </li>
<li>   512   . </li>
<li>    CRC  2 . </li>
<li> Data Response  .       ,    3,    8. </li>
<li>   .     ,    9,    4. </li>
<li> Stop Tran Token.   ,     . </li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">في انتظار رد من البطاقة. </font><font style="vertical-align: inherit;">توجه البطاقة على Stop Tran Token خط MISO إلى الصفر ، مما يشير إلى أن البطاقة مشغولة. </font><font style="vertical-align: inherit;">من الضروري الانتظار على سطر MISO لقيمة الوحدة ، والتي ستشير إلى نهاية الأمر</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">الانتهاء من خوارزمية التسجيل. </font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
هناك أيضًا فارق بسيط في خوارزمية التسجيل. </font><font style="vertical-align: inherit;">يجب تعيين إشارة تحديد الشريحة (CS) على المنطق صفر قبل إنشاء الأمر CMD25 وتعيينها إلى المنطق بعد تلقي استجابة إلى Stop Tran Token</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">خوارزمية الجرافيك</font></font></b>
                        <div class="spoiler_text"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow"><img src="https://habrastorage.org/webt/_9/kt/ts/_9kttsrffln_gmvgw-l4ch0ekva.png"></a></div>
                    </div><br>
<a name="Hardware"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. تنفيذ الخوارزمية في الأجهزة</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
نتيجة لقراءة المواصفات ، نحصل على بعض خصائص الخوارزمية التي يجب تنفيذها في الأجهزة. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
أوضاع التشغيل الممكنة:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">تشكيل التردد الأولي. </font><font style="vertical-align: inherit;">يجب أن تكون خطوط CS و MOSI في حالة الوحدة المنطقية.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">نقل البيانات إلى بطاقة SD. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">استقبال البيانات من بطاقة SD. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">في انتظار الانتهاء من الفريق. </font><font style="vertical-align: inherit;">يتم استخدامه عندما تقوم بطاقة SD ، بعد إنشاء استجابة ، برسم خط MISO إلى الصفر من أجل انتظار ظهور الوحدة.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">اقرأ الرد عند كتابة البيانات. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">في انتظار رمز مميز أثناء قراءة البيانات. </font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
أوضاع الساعة الممكنة:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">إشارة الساعة لتهيئة. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">إشارة الساعة للعمل. </font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
من وجهة نظري ، يتم تنفيذ الخوارزمية على النحو الأمثل باستخدام ثلاثة مكونات:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">مكون الطبقة المادية ، التي ترتبط مباشرة ببطاقة SD ، يولد إشارات SCLK و CS و DI ويقرأ مع DO. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">مكون على مستوى الأمر يعد كل البيانات لمكون في الطبقة المادية. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">مكون للتواصل مع العالم الخارجي يخفي الجهاز الداخلي بالكامل ويوفر واجهة للأوامر (القراءة والكتابة والمحو) والبيانات.</font></font></li>
</ul><br>
<a name="HwPhy"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.1 مكون الطبقة المادية</font></font></h3><br>
<pre><code class="vhdl hljs"><span class="hljs-keyword">entity</span> SDPhy <span class="hljs-keyword">is</span>
	<span class="hljs-keyword">generic</span>	(	gTCQ		: <span class="hljs-built_in">time</span> := <span class="hljs-number">2</span> ns );
	<span class="hljs-keyword">port</span>	(	<span class="hljs-comment">-- Control bus</span>
			iPhyTxData	: <span class="hljs-keyword">in</span>	<span class="hljs-built_in">std_logic_vector</span>( <span class="hljs-number">9</span> <span class="hljs-keyword">downto</span> <span class="hljs-number">0</span>);<font></font>
			iPhyMode	: <span class="hljs-keyword">in</span>	<span class="hljs-built_in">std_logic_vector</span>( <span class="hljs-number">4</span> <span class="hljs-keyword">downto</span> <span class="hljs-number">0</span>);<font></font>
			iPhyTxWrite	: <span class="hljs-keyword">in</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			oPhyTxReady	: <span class="hljs-keyword">out</span>	<span class="hljs-built_in">std_logic</span>; 
			<span class="hljs-comment">-- Out Data</span>
			oPhyRxData	: <span class="hljs-keyword">out</span>	<span class="hljs-built_in">std_logic_vector</span>( <span class="hljs-number">7</span> <span class="hljs-keyword">downto</span> <span class="hljs-number">0</span>); <font></font>
			oPhyRxWrite	: <span class="hljs-keyword">out</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			oPhyCmdEnd	: <span class="hljs-keyword">out</span>	<span class="hljs-built_in">std_logic</span>;
			<span class="hljs-comment">-- Spi</span>
			oSdCS		: <span class="hljs-keyword">out</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			oSdClk		: <span class="hljs-keyword">out</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			oSdMosi		: <span class="hljs-keyword">out</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			oSdMosiT	: <span class="hljs-keyword">out</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			iSdMiso		: <span class="hljs-keyword">in</span>	<span class="hljs-built_in">std_logic</span>;
			<span class="hljs-comment">-- system</span>
			sclk		: <span class="hljs-keyword">in</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			pclk		: <span class="hljs-keyword">in</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			rst		: <span class="hljs-keyword">in</span>	<span class="hljs-built_in">std_logic</span> ); 
<span class="hljs-keyword">end</span> SDPhy;
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
أين:</font></font><br>
<br>
<ul>
<li> iPhyTxData    ,  iPhyMode  ,    . </li>
<li>iPhyTxWrite ,    iPhyTxData  iPhyMode . </li>
<li>oPhyTxReady ,      .     FULL FIFO,    .</li>
<li>oPhyRxData   ,   SD-.</li>
<li>oPhyRxWrite ,     oPhyRxData . </li>
<li>oPhyCmdEnd ,     .</li>
<li>oSdCS    (CS)  SD-. </li>
<li>oSdClk    SD-.</li>
<li>oSdMosi     SD-.</li>
<li>oSdMosiT        SD-.</li>
<li>iSdMiso     SD-. </li>
<li>sclk      SD- (50 ).</li>
<li>pclk  ,     .</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">إعادة تعيين إشارة ، المستوى النشط الأول.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
في FPGAs ، هناك وحدات خاصة للعمل مع إشارة ساعة (PLL ، MMCM) ، ومع ذلك ، فإن تلقي إشارة ساعة أقل من 5 ميجا هرتز من خرجها يمثل مشكلة. </font><font style="vertical-align: inherit;">ونتيجة لذلك ، تعمل الطبقة المادية بتردد 50 ميجا هرتز. </font><font style="vertical-align: inherit;">جنبًا إلى جنب مع كل بيانات في إشارة iPhyMode ، يتم تلقي القليل الذي يشير إلى أي تردد يجب نقل هذه البيانات إلى بطاقة SD (أو استلامها منها). </font><font style="vertical-align: inherit;">اعتمادًا على بت السرعة ، يتم إنشاء إشارات تمكين الساعة. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
يتم تنفيذ آليتين في مكون الطبقة المادية ، لنقل البيانات إلى بطاقة SD وتلقي البيانات منها. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
رمز الجهاز لنقل البيانات: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">جيثب</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">توفر حالة SDummy تشكيل التردد الأولي ، 128 التبديل. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">توفر حالة STxBits نقل البيانات إلى بطاقة SD. </font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
رمز الجهاز لاستقبال البيانات: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">جيثب</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">توفر حالة sRxBits استقبال البيانات من بطاقة SD. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">تضمن حالة sBusy أن تكون بطاقة SD جاهزة (تقوم البطاقة بتحرير خط MISO إلى مستوى الوحدة). </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">تطبق حالة sResp قراءة الاستجابة عند كتابة البيانات. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">تنفذ حالة sToken انتظارًا مميزًا أثناء قراءة البيانات. </font></font></li>
</ul><br>
<a name="HwCmd"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.2 مكون على مستوى القيادة</font></font></h3><br>
<pre><code class="vhdl hljs"><span class="hljs-keyword">entity</span> SdCommand <span class="hljs-keyword">is</span>
	<span class="hljs-keyword">generic</span>	(	gTCQ		: <span class="hljs-built_in">time</span> := <span class="hljs-number">2</span> ns );
	<span class="hljs-keyword">port</span>	(	<span class="hljs-comment">-- Command from host</span>
			oSdInitComp	: <span class="hljs-keyword">out</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			oSdInitFail	: <span class="hljs-keyword">out</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			iSdAddress	: <span class="hljs-keyword">in</span>	<span class="hljs-built_in">std_logic_vector</span>(<span class="hljs-number">31</span> <span class="hljs-keyword">downto</span> <span class="hljs-number">0</span>);<font></font>
			iSdStartErase	: <span class="hljs-keyword">in</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			iSdStartRead	: <span class="hljs-keyword">in</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			iSdStartWrite	: <span class="hljs-keyword">in</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			oSdCmdFinish	: <span class="hljs-keyword">out</span>	<span class="hljs-built_in">std_logic_vector</span>( <span class="hljs-number">1</span> <span class="hljs-keyword">downto</span> <span class="hljs-number">0</span>);<font></font>
			oSdhcPresent	: <span class="hljs-keyword">out</span>	<span class="hljs-built_in">std_logic</span>;
			<span class="hljs-comment">-- Data</span>
			oSdReadData	: <span class="hljs-keyword">out</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			iSdDataR	: <span class="hljs-keyword">in</span>	<span class="hljs-built_in">std_logic_vector</span>(<span class="hljs-number">31</span> <span class="hljs-keyword">downto</span> <span class="hljs-number">0</span>);<font></font>
			oSdWriteData	: <span class="hljs-keyword">out</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			oSdDataW	: <span class="hljs-keyword">out</span>	<span class="hljs-built_in">std_logic_vector</span>(<span class="hljs-number">32</span> <span class="hljs-keyword">downto</span> <span class="hljs-number">0</span>);
			<span class="hljs-comment">-- Spi</span>
			oSdCS		: <span class="hljs-keyword">out</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			oSdClk		: <span class="hljs-keyword">out</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			oSdMosi		: <span class="hljs-keyword">out</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			oSdMosiT	: <span class="hljs-keyword">out</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			iSdMiso		: <span class="hljs-keyword">in</span>	<span class="hljs-built_in">std_logic</span>;
			<span class="hljs-comment">-- system</span>
			pclk		: <span class="hljs-keyword">in</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			sclk		: <span class="hljs-keyword">in</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			rst		: <span class="hljs-keyword">in</span>	<span class="hljs-built_in">std_logic</span> );
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
أين:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">oSdInitComp تسجيل الانتهاء من تهيئة بطاقة SD. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">علامة oSdInitFail من فشل التهيئة. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">عنوان iSdAddress في بطاقة SD لتنفيذ الأمر. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">بدء iSdStartErase محو تنفيذ الأمر. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">بدء iSdStartRead قراءة تنفيذ الأمر. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iSdStartWrite بدء تنفيذ أمر الكتابة. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">حالة إكمال فريق oSdCmdFinish. </font><font style="vertical-align: inherit;">بت صفر يساوي واحد ، اكتمل الأمر بنجاح. </font><font style="vertical-align: inherit;">البت الأول هو واحد ، اكتمل الأمر بخطأ.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">oSdhcPresent علامة الكشف عن بطاقة SDHC / SDXC. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">oSdReadData قراءة البيانات للكتابة على بطاقة SD. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">بيانات iSdDataR للكتابة على بطاقة SD. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">علامة oSdWriteData لكتابة البيانات المقروءة من بطاقة SD. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">قراءة بيانات oSdDataW من بطاقة SD.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
تتزامن الإشارات المتبقية مع إشارات الطبقة المادية. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
يحتوي المكون على 5 آلات أوتوماتيكية.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">smSdInit ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) - تهيئة بطاقة SD.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">؛ smSdErase ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) - محو البيانات من بطاقة SD.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">smSdRead ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) - قراءة البيانات من بطاقة SD.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">؛ smSdWrite ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) - كتابة البيانات على بطاقة SD.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">smSdCommand ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) - على أساس الميزات التي تم إنشاؤها تعد البيانات للطبقة المادية من جميع الأجهزة السابقة.</font></font></li>
</ul><br>
<a name="HwHost"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.3 مكون التواصل مع العالم الخارجي</font></font></h3><br>
<pre><code class="vhdl hljs"><span class="hljs-keyword">entity</span> SdHost <span class="hljs-keyword">is</span>
	<span class="hljs-keyword">generic</span>	(	gTCQ		: <span class="hljs-built_in">time</span> := <span class="hljs-number">2</span> ns );
	<span class="hljs-keyword">port</span>	(	<span class="hljs-comment">-- Sd Host command</span>
			iSdCommand	: <span class="hljs-keyword">in</span>	<span class="hljs-built_in">std_logic_vector</span>( <span class="hljs-number">2</span> <span class="hljs-keyword">downto</span> <span class="hljs-number">0</span>);<font></font>
			iSdAddress	: <span class="hljs-keyword">in</span>	<span class="hljs-built_in">std_logic_vector</span>(<span class="hljs-number">31</span> <span class="hljs-keyword">downto</span> <span class="hljs-number">0</span>);<font></font>
			iSdStart	: <span class="hljs-keyword">in</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			oSdStatus	: <span class="hljs-keyword">out</span>	<span class="hljs-built_in">std_logic_vector</span>( <span class="hljs-number">1</span> <span class="hljs-keyword">downto</span> <span class="hljs-number">0</span>);<font></font>
			oSdInitFail	: <span class="hljs-keyword">out</span>	<span class="hljs-built_in">std_logic</span>;
			<span class="hljs-comment">-- Write data to card</span>
			iSdTxData	: <span class="hljs-keyword">in</span>	<span class="hljs-built_in">std_logic_vector</span>(<span class="hljs-number">31</span> <span class="hljs-keyword">downto</span> <span class="hljs-number">0</span>);<font></font>
			iSdTxValid	: <span class="hljs-keyword">in</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			iSdTxLast	: <span class="hljs-keyword">in</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			oSdTxReady	: <span class="hljs-keyword">out</span>	<span class="hljs-built_in">std_logic</span>;
			<span class="hljs-comment">-- Read data from card</span>
			oSdRxData	: <span class="hljs-keyword">out</span>	<span class="hljs-built_in">std_logic_vector</span>(<span class="hljs-number">31</span> <span class="hljs-keyword">downto</span> <span class="hljs-number">0</span>);<font></font>
			oSdRxValid	: <span class="hljs-keyword">out</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			oSdRxLast	: <span class="hljs-keyword">out</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			iSdRxReady	: <span class="hljs-keyword">in</span>	<span class="hljs-built_in">std_logic</span>;
			<span class="hljs-comment">-- Spi</span>
			oSdCS		: <span class="hljs-keyword">out</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			oSdClk		: <span class="hljs-keyword">out</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			oSdMosi		: <span class="hljs-keyword">out</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			oSdMosiT	: <span class="hljs-keyword">out</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			iSdMiso		: <span class="hljs-keyword">in</span>	<span class="hljs-built_in">std_logic</span>;
			<span class="hljs-comment">-- system</span>
			pclk		: <span class="hljs-keyword">in</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			sclk		: <span class="hljs-keyword">in</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			rst		: <span class="hljs-keyword">in</span>	<span class="hljs-built_in">std_logic</span> );
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
أين:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">رمز الأمر iSdCommand للتنفيذ. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iSdAddress هو عنوان تنفيذ الأمر. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">بدء تنفيذ الأمر iSdStart. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">حالة استكمال فريق oSdStatus. </font><font style="vertical-align: inherit;">بت صفر يساوي واحد - اكتمال الأمر. </font><font style="vertical-align: inherit;">البت الأول هو واحد - اكتمل الأمر بخطأ.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">علامة oSdInitFail من فشل التهيئة. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iSdTxData. </font><font style="vertical-align: inherit;">واجهة Axi-Stream لكتابة البيانات على بطاقة SD. </font><font style="vertical-align: inherit;">منفذ مع البيانات.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iSdTxValid. </font><font style="vertical-align: inherit;">واجهة Axi-Stream لكتابة البيانات على بطاقة SD. </font><font style="vertical-align: inherit;">منفذ بإشارة كتابة.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iSdTxLast. </font><font style="vertical-align: inherit;">واجهة Axi-Stream لكتابة البيانات على بطاقة SD. </font><font style="vertical-align: inherit;">ميناء مع علامة dw الأخير في البيانات.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">oSdTxReady. </font><font style="vertical-align: inherit;">واجهة Axi-Stream لكتابة البيانات على بطاقة SD. </font><font style="vertical-align: inherit;">منفذ مع علامة الاستعداد لتلقي البيانات.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">oSdRxData. </font><font style="vertical-align: inherit;">واجهة Axi-Stream لقراءة البيانات من بطاقة SD. </font><font style="vertical-align: inherit;">منفذ مع البيانات.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">oSdRxValid. </font><font style="vertical-align: inherit;">واجهة Axi-Stream لقراءة البيانات من بطاقة SD. </font><font style="vertical-align: inherit;">منفذ بإشارة كتابة.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">oSdRxLast. </font><font style="vertical-align: inherit;">واجهة Axi-Stream لقراءة البيانات من بطاقة SD. </font><font style="vertical-align: inherit;">ميناء مع علامة dw الأخير في البيانات.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iSdRxReady. </font><font style="vertical-align: inherit;">واجهة Axi-Stream لقراءة البيانات من بطاقة SD. </font><font style="vertical-align: inherit;">منفذ مع علامة الاستعداد لتلقي البيانات.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
تتزامن الإشارات المتبقية مع إشارات الطبقة المادية. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ينفذ المكون جهاز smSdControl ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">جيثب</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) واحد.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">الدولة المنفردة. </font><font style="vertical-align: inherit;">في انتظار التهيئة والأمر لإكمال.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">حالة sWaitCmd. </font><font style="vertical-align: inherit;">التحقق من نوع الأمر.</font></font></li>
<li>sReadCmd.    FIFO,   ,     SD-      . </li>
<li>sWriteCmd. ,   FIFO      SD-,      . </li>
<li>sEraseCmd.     . </li>
<li>sWaitEnd.       . </li>
<li>sFinish.   ,  . </li>
</ul><br>
<a name="RealTest"></a><h2>3.   </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
تمت كتابة الخوارزمية والتحقق منها في المحاكي. </font><font style="vertical-align: inherit;">من الضروري فحص الحديد الآن. </font><font style="vertical-align: inherit;">من ما كان متاحًا ، </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ظهرت</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> لوحة </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">Zybo من Digilent</font></a><font style="vertical-align: inherit;"> 
، وتحتوي على محطات FPGA مجانية في بنك بجهد + 3.3 فولت ، يمكنك بسهولة توصيل جهاز خارجي. </font><font style="vertical-align: inherit;">نعم ، ونوع FPGA المستخدم هو Zynq-7000 ، مما يعني وجود نواة للمعالج. </font><font style="vertical-align: inherit;">يمكنك كتابة اختبار في لغة C ، مما يبسط مهمة الاختبار. </font><font style="vertical-align: inherit;">
لذا ، نقوم بتوصيل الخوارزمية التي تم تنفيذها بنواة المعالج عبر منفذ GP (يمكن تشغيل 4 بايت ، على غرار </font><abbr title="Programmed input/output"><font style="vertical-align: inherit;">PIO</font></abbr><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">لن ننزعج من الانقطاعات ؛ ننفذ استطلاع مؤقت. </font><font style="vertical-align: inherit;">
عند العمل على وحدة المعالج ، ستكون خوارزمية تسجيل البيانات كما يلي:</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow"><img src="https://habrastorage.org/webt/oe/oy/nj/oeoynjbbxwco9wrihj-f3unb3cs.png"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><abbr title="الإدخال / الإخراج المبرمج"><font style="vertical-align: inherit;"></font></abbr><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ضع العنوان في بطاقة SD. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">تعيين رمز الأمر 2. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">كتابة البيانات في المخزن المؤقت الموجود في منطق برمجة. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">قم بتشغيل الأمر. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">انتظر حتى يكتمل الأمر. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">إعادة تعيين حالة إكمال الفريق.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
الاختبار المنفذ:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">for</span> (SectorAddress = <span class="hljs-number">0</span>; SectorAddress &lt; <span class="hljs-number">1048576</span>; SectorAddress ++)<font></font>
{<font></font>
	<span class="hljs-keyword">if</span> ((SectorAddress % <span class="hljs-number">1024</span>) == <span class="hljs-number">0</span>)<font></font>
	{<font></font>
		xil_printf(<span class="hljs-string">"Data write to %d sector \n\r"</span>, SectorAddress);<font></font>
	}<font></font>
<font></font>
	<span class="hljs-comment">/** Set address */</span>
	Xil_Out32(<span class="hljs-number">0x43c00008</span>, SectorAddress);<font></font>
<font></font>
	<span class="hljs-comment">/** Set command */</span>
	Xil_Out32(<span class="hljs-number">0x43c00004</span>, <span class="hljs-number">2</span>);<font></font>
<font></font>
	<span class="hljs-comment">/** Write data to PL */</span>
	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int32_t</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1024</span>; i++)<font></font>
	{<font></font>
		Xil_Out32(<span class="hljs-number">0x43c00014</span>, cntrData);<font></font>
		cntrData++;<font></font>
	}<font></font>
<font></font>
	<span class="hljs-comment">/** Start */</span>
	Xil_Out32(<span class="hljs-number">0x43c00000</span>, <span class="hljs-number">1</span>);<font></font>
<font></font>
	<span class="hljs-comment">/** Wait end of operation */</span>
	<span class="hljs-keyword">for</span> (;;)<font></font>
	{<font></font>
		status = Xil_In32(<span class="hljs-number">0x43c0000c</span>);
		<span class="hljs-keyword">if</span> (status == <span class="hljs-number">0x01</span> || status == <span class="hljs-number">0x03</span>)<font></font>
		{<font></font>
			<span class="hljs-keyword">if</span> (status == <span class="hljs-number">0x03</span>)<font></font>
			{<font></font>
				xil_printf(<span class="hljs-string">"Error in write \n\r"</span>);<font></font>
			}<font></font>
			<span class="hljs-keyword">break</span>;<font></font>
		}<font></font>
		<span class="hljs-keyword">else</span><font></font>
		{<font></font>
			cntrDuration++;<font></font>
			usleep(<span class="hljs-number">100</span>);<font></font>
		}<font></font>
	}<font></font>
<font></font>
	<span class="hljs-comment">/** Duration operation */</span><font></font>
	durationWrite += cntrDuration;<font></font>
<font></font>
	<span class="hljs-keyword">if</span> (cntrDuration &gt; MaxWrite )<font></font>
	{<font></font>
		MaxWrite = cntrDuration;<font></font>
	}<font></font>
<font></font>
	cntrDuration = <span class="hljs-number">0x00</span>;<font></font>
<font></font>
	<span class="hljs-comment">/** Clear start */</span>
	Xil_Out32(<span class="hljs-number">0x43c00000</span>, <span class="hljs-number">0</span>);<font></font>
<font></font>
	SectorAddress += <span class="hljs-number">7</span>;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
إلى السؤال حول سبب استخدام الحد الخارجي من 1024 في الحلقة.تعين </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">الخوارزمية عدد الكتل يساوي 8.</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> حجم كتلة واحدة هو 512 بايت. </font><font style="vertical-align: inherit;">الحجم الكلي لـ 8 كتل بيانات هو 8 * 512 بايت = 4096 بايت. </font><font style="vertical-align: inherit;">حجم الحافلة بين وحدة المعالج والمنطق القابل للبرمجة هو 4 بايت. </font><font style="vertical-align: inherit;">اتضح أنه لإرسال 4096 بايت من 4 بايت من وحدة المعالج إلى المنطق القابل للبرمجة ، من الضروري إجراء عمليات كتابة 4096/4 = 1024. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
عند العمل على وحدة المعالج ، ستكون خوارزمية قراءة البيانات كما يلي:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ضع العنوان في بطاقة SD. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">تعيين رمز الأمر 1. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">قم بتشغيل الأمر. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">انتظر حتى يكتمل الأمر. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">إعادة تعيين حالة إكمال الفريق.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">قراءة البيانات من المخزن المؤقت في منطق برمجة. </font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
الاختبار المنفذ:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">for</span> (SectorAddress = <span class="hljs-number">0</span>; SectorAddress &lt; <span class="hljs-number">1048576</span>; SectorAddress++)<font></font>
{<font></font>
	<span class="hljs-keyword">if</span> ((SectorAddress % <span class="hljs-number">1024</span>) == <span class="hljs-number">0</span>)<font></font>
	{<font></font>
		xil_printf(<span class="hljs-string">"Data read from %d sector \n\r"</span>, SectorAddress);<font></font>
	}<font></font>
<font></font>
	<span class="hljs-comment">/** Set address */</span>
	Xil_Out32(<span class="hljs-number">0x43c00008</span>, SectorAddress);<font></font>
<font></font>
	<span class="hljs-comment">/** Set command */</span>
	Xil_Out32(<span class="hljs-number">0x43c00004</span>, <span class="hljs-number">1</span>);<font></font>
<font></font>
	<span class="hljs-comment">/** Start */</span>
	Xil_Out32(<span class="hljs-number">0x43c00000</span>, <span class="hljs-number">1</span>);<font></font>
<font></font>
	<span class="hljs-comment">/** Wait end of operation */</span>
	<span class="hljs-keyword">for</span> (;;)<font></font>
	{<font></font>
		status = Xil_In32(<span class="hljs-number">0x43c0000c</span>);
		<span class="hljs-keyword">if</span> (status == <span class="hljs-number">0x01</span> || status == <span class="hljs-number">0x03</span>)<font></font>
		{<font></font>
			 <span class="hljs-keyword">if</span> (status == <span class="hljs-number">0x03</span>)<font></font>
			{<font></font>
				xil_printf(<span class="hljs-string">"Error in read \n\r"</span>);<font></font>
			}<font></font>
			<span class="hljs-keyword">break</span>;<font></font>
		}<font></font>
		<span class="hljs-keyword">else</span><font></font>
		{<font></font>
			cntrDuration++;<font></font>
			usleep(<span class="hljs-number">100</span>);<font></font>
		}<font></font>
	}<font></font>
<font></font>
	 <span class="hljs-comment">/** Duration operation */</span><font></font>
	 durationRead += cntrDuration;<font></font>
<font></font>
	 <span class="hljs-keyword">if</span> (cntrDuration &gt; MaxRead )<font></font>
	 {<font></font>
		 MaxRead = cntrDuration;<font></font>
	 }<font></font>
<font></font>
	cntrDuration = <span class="hljs-number">0x00</span>;<font></font>
<font></font>
	<span class="hljs-comment">/** Clear start */</span>
	Xil_Out32(<span class="hljs-number">0x43c00000</span>, <span class="hljs-number">0</span>);<font></font>
<font></font>
	<span class="hljs-comment">/** Read data from PL */</span>
	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int32_t</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1024</span>; i++)<font></font>
	{<font></font>
		DataR = Xil_In32(<span class="hljs-number">0x43c0001c</span>);
		<span class="hljs-keyword">if</span> (DataR != cntrData)<font></font>
		{<font></font>
			xil_printf(<span class="hljs-string">"Data corrupt! \n\r"</span>);<font></font>
		}<font></font>
		DataR = Xil_In32(<span class="hljs-number">0x43c00020</span>);<font></font>
		cntrData++;<font></font>
	}<font></font>
<font></font>
	SectorAddress += <span class="hljs-number">7</span>;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
عند العمل على وحدة المعالج ، ستكون خوارزمية محو البيانات كما يلي:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ضع العنوان في بطاقة SD. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">تعيين كود الأمر 4. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">قم بتشغيل الأمر. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">انتظر حتى يكتمل الأمر. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">إعادة تعيين حالة إكمال الفريق.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
الاختبار المنفذ:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">for</span> (SectorAddress = <span class="hljs-number">0</span>; SectorAddress &lt; <span class="hljs-number">1048576</span>; SectorAddress++)<font></font>
{<font></font>
	<span class="hljs-keyword">if</span> ((SectorAddress % <span class="hljs-number">1024</span>) == <span class="hljs-number">0</span>)<font></font>
	{<font></font>
		xil_printf(<span class="hljs-string">"Data erase from %d sector \n\r"</span>, SectorAddress);<font></font>
	}<font></font>
<font></font>
	<span class="hljs-comment">/** Set address */</span>
	Xil_Out32(<span class="hljs-number">0x43c00008</span>, SectorAddress);<font></font>
<font></font>
	<span class="hljs-comment">/** Set command */</span>
	Xil_Out32(<span class="hljs-number">0x43c00004</span>, <span class="hljs-number">4</span>);<font></font>
<font></font>
	<span class="hljs-comment">/** Start */</span>
	Xil_Out32(<span class="hljs-number">0x43c00000</span>, <span class="hljs-number">1</span>);<font></font>
<font></font>
	<span class="hljs-comment">/** Wait end of operation */</span>
	<span class="hljs-keyword">for</span> (;;)<font></font>
	{<font></font>
		status = Xil_In32(<span class="hljs-number">0x43c0000c</span>);
		<span class="hljs-keyword">if</span> (status == <span class="hljs-number">0x01</span> || status == <span class="hljs-number">0x03</span>)<font></font>
		{<font></font>
			<span class="hljs-keyword">if</span> (status == <span class="hljs-number">0x03</span>)<font></font>
			{<font></font>
				xil_printf(<span class="hljs-string">"Error in write! \n\r"</span>);<font></font>
			}<font></font>
			<span class="hljs-keyword">break</span>;<font></font>
		}<font></font>
		<span class="hljs-keyword">else</span><font></font>
		{<font></font>
			cntrDuration++;<font></font>
			usleep(<span class="hljs-number">100</span>);<font></font>
		}<font></font>
	}<font></font>
<font></font>
	<span class="hljs-comment">/** Duration operation */</span><font></font>
	durationErase += cntrDuration;<font></font>
<font></font>
	<span class="hljs-keyword">if</span> (cntrDuration &gt; MaxErase )<font></font>
	{<font></font>
		MaxErase = cntrDuration;<font></font>
	}<font></font>
<font></font>
	cntrDuration = <span class="hljs-number">0x00</span>;<font></font>
<font></font>
	<span class="hljs-comment">/** Clear start */</span>
	Xil_Out32(<span class="hljs-number">0x43c00000</span>, <span class="hljs-number">0</span>);<font></font>
<font></font>
	SectorAddress += <span class="hljs-number">7</span>;<font></font>
}<font></font>
</code></pre><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">اختبار تماما على جيثب.</font></font></a><br>
<br>
<a name="Results"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4. النتائج</font></font></h2><br>
<div class="scrollable-table"><table>
<tbody><tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">كمية البيانات</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">قراءة </font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">سجل</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">محو </font></font></th>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">كتلة واحدة (512 بايت)</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.7 ميجابت في الثانية</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.36 ميجابت في الثانية</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.58 ميجابت في الثانية</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8 كتل (4096 بايت)</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.4 ميجابت في الثانية</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.38 ميجابت في الثانية</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.66 ميجابت في الثانية</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16 كتلة (8192 بايت)</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">18.82 ميجابت في الثانية</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11.26 ميجابت في الثانية</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.79 ميجابت في الثانية</font></font></td>
</tr>
</tbody></table></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
تم استخدام بطاقة 16 جيجا بايت. </font><font style="vertical-align: inherit;">أثناء الاختبار ، تم تسجيل 2 غيغابايت من البيانات ، وتم قراءة 2 غيغابايت من البيانات ، وتم مسح 2 غيغابايت من البيانات. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
الاستنتاجات مخيبة للآمال. </font><font style="vertical-align: inherit;">عند استخدام FPGA ، لا معنى لاستخدام بطاقة SD في وضع SPI ، باستثناء الحالة عندما يكون من الضروري جدًا تخزين كميات كبيرة من البيانات دون تقديم متطلبات السرعة.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar495388/index.html">برنامج تلفزيوني من السبعينيات أصبح سلفًا للرياضات الإلكترونية</a></li>
<li><a href="../ar495390/index.html">STM32CubeMonitor يستحق المحاولة</a></li>
<li><a href="../ar495392/index.html">كيفية البحث عن الأخطاء في الواجهة الأمامية: 4 مراحل رئيسية</a></li>
<li><a href="../ar495396/index.html">الانطباع الأول عن المفاهيم</a></li>
<li><a href="../ar495398/index.html">Ro.Ri.Re</a></li>
<li><a href="../ar495402/index.html">في العام الماضي ، صورنا أخيراً ثقبًا أسود. ماذا الآن؟</a></li>
<li><a href="../ar495404/index.html">هل الأسهم المتدلية واعدة؟ دعونا نحلل مع الثعبان</a></li>
<li><a href="../ar495408/index.html"># 02 - والبايت كله لا يكفي ... | صليب التغييرات</a></li>
<li><a href="../ar495412/index.html">نوربرت وينر. شخص مثير للاهتمام. الزملاء والأعداء يكافحون من أجل الاستقلال</a></li>
<li><a href="../ar495414/index.html">عواقب الخوف</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>