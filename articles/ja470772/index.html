<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🐫 🛌🏿 👂🏼 TON：推奨事項とベストプラクティス 🎦 🙇🏼 ✋</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="この記事は、TONブロックチェーンページsmc-guidelines.txtで公開されているドキュメントの翻訳です。おそらくこれは、誰かがこのブロックチェーンの開発に向けて一歩を踏み出すのに役立つでしょう。また、最後に短い要約を作成しました。
 内部メッセージ
 

スマートコントラクトは、いわゆる...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>TON：推奨事項とベストプラクティス</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/470772/"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">この記事は、TONブロックチェーンページ</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">smc-guidelines.txtで</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">公開されているドキュメントの翻訳です</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">おそらくこれは、誰かがこのブロックチェーンの開発に向けて一歩を踏み出すのに役立つでしょう。</font><font style="vertical-align: inherit;">また、最後に短い要約を作成しました。</font></font></p><a name="habracut"></a><br>
<h2 id="vnutrennie-soobscheniya"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内部メッセージ</font></font></h2><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スマートコントラクトは、いわゆる内部メッセージを送信することによって相互に対話します。内部メッセージが指定された宛先に到達すると、宛先アカウントの名前で通常のトランザクションが作成され、内部メッセージは指定されたコードとこのアカウントの定数データ（スマートコントラクト）に従って処理されます。特に、処理トランザクションは1つまたは複数の内部メッセージを作成する場合があり、その一部は処理中の内部メッセージの送信元アドレスに送信されます。これを使用して、要求が内部メッセージに埋め込まれ（カプセル化され）、要求を処理して応答を再び内部メッセージとして送信する別のスマートコントラクトに送信されると、単純な「クライアント/サーバーアプリケーション」を作成できます。</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">このアプローチでは、「リクエスト」と「レスポンス」の内部メッセージを（「クエリ」または「レスポンス」として）区別したり、追加の処理（単純な送金など）を必要としたりする必要がなくなります。</font><font style="vertical-align: inherit;">さらに、回答が届いたときに、それがどの要求に関連しているかを理解する方法がなければなりません。</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">この目標を達成するには、次の内部メッセージテンプレートを使用することをお勧めします（この場合、TONブロックチェーンはメッセージ本文に制限を課さないことに注意してください。つまり、これらは単なる推奨事項です）。</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0）メッセージの本文はメッセージ自体に埋め込むことも、図のTL-Bフラグメントに示されているようにメッセージ内で参照される別のセル（セル*）に格納することもできます（英語の方がわかりやすい：別のセルに格納） TL-Bスキームフラグメントで示されるように、メッセージから参照されるセル）：</font></font></p><br>
<pre><code class="plaintext hljs">message$_ {X:Type} ... body:(Either X ^X) = Message X;</code></pre><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://core.telegram.org/mtproto-TL-schemes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">についてここで読むことができます）</font></font></p><br>
<p> -            (     ,   — whenever they fit into the cell containing the message —   ,   ,    ).         ( "right"  <code>(Either X ^X)</code>),            .   ,   (valid)             .</p><br>
<p>1)       :</p><br>
<ul>
<li><em>op</em> — 32-bit (big-endian) unsigned integer,    ,   -  .</li>
<li><em>query_id</em> — 64-bit (big-endian) unsigned integer,       -,       (<em>query_id</em>    <em>query_id</em>  ).  <em>op</em> —    "-" (  ,     ),  <em>query_id</em>   .</li>
<li>          <em>op</em></li>
</ul><br>
<p>2)  <em>op</em>  ,   —      .       ( <em>query_id</em>  ,     5-  (:  <em>query_id</em> ,   4    <em>op</em>)).       0xff,   —    (If it does not begin with the byte 0xff, the comment is a text one;);        " " (       (invalid and control characters)      UTF-8 ). ,                .   ,      0xff,   —  " ",         (  hex dump  ).    , , —       ,         .</p><br>
<p> -            "   ".  ,  <em>op</em>  ,  -      (  <code>recv_internal()</code>)      0,    (,   0,   -     ).    ,       ,  ,  -  .</p><br>
<p>3) "    "    (   <em>op</em>).        .  ,       ,    .</p><br>
<p>4)  ,   <em>op</em> -     ("high-order bit",   ,    ,      ) ,         <code>1 .. 2^31-1</code>,      (high-order)     1,       <code>2^31 .. 2^32-1</code>.      ,   (    <em>query_id</em>),      <em>op</em>  ,   -: <code>1 .. 2^31 - 1</code>.</p><br>
<p>5)   "" -,   <em>op</em>  0xffffffff  0xffffffffe.     <em>op</em>  0xfffffff0  0xffffffff     .</p><br>
<ul>
<li><em>op = 0xffffffff</em>  "  ".    64- <em>query_id</em>,    ,  32- <em>op</em>  . ,    -,    ,       <em>op</em>   1… 2^31-1.</li>
<li><em>op = 0xfffffffe</em>  "  ".    64- <em>query_id</em>  ,   32- <em>op</em>,    .</li>
</ul><br>
<p> ,   "" ( <em>op</em>   2^31… 2^32-1)   ( ,          <em>op</em>  0xffffffff),      (bounced)- (   "bounced").</p><br>
<h2 id="oplata-za-obrabotku-zaprosov-i-otpravlenie-otvetov">      </h2><br>
<p> ,  -     -,          - (   : message forwarding fees),        (  : gas fees)    ,    (   : message forwarding fees).</p><br>
<p>          gram (, 1 gram) (     )      "bounce" (. .   (bounceable)  );         (      ).      SENDRAWMSG  mode=64 (.     TON VM).</p><br>
<p>              (, -    ),    "" ("bounced")  ,    "bounce"      "bounced".   (bounced)    ,     ;     "bounced"       <em>op</em>  -     (     ,  ,    ,         ).   "bounced" ,    ,     (,   <em>op</em>  <em>query_id</em>   )    .   -       (    ,    "bounced").</p><br>
<p>  ,        ,    <em>op</em>        .    <em>op</em>  0xffffffff        ,  SENDRAWMSG  mode=64,   .</p><br>
<p>          ? ? ( , ,     "")    ,    . , - " " (validator elections)             .      , ,       [] (    value,     - ,     "").    (,       - ),    (    )          (,   SENDRAWMSG  mode=64,   ).             (         ;  mode=1 of SENDRAWMSG).</p><br>
<h2 id="ispolzovanie-nevozvratnyh-non-bounceable-soobscheniy">  (non-bounceable) </h2><br>
<p>   ,   -,    (   "",    ,    ), . .    "bounce" . ,   -  ,          ,   "" ,     (value) (        ).        ,     "bounce"    "bounced".   -    "bounced"         (     ),     ,  ,     . ,     ,    .</p><br>
<p>      (non-bounceable)  . ,              ,  .      StateInit      -,          .</p><br>
<p>  ,     (, )   ,    (,   ), ,   ,  ,     .     ,    -,     -.</p><br>
<h2 id="vneshnie-soobscheniya"> </h2><br>
<p>     -,    TON,      . , -     ,   (orders) (,  ,     - ),   ;      - ,    ,    (  TVM ACCEPT),      .</p><br>
<p> ,    ,       (replay attacks).           (  );                ( ,          ,      ).   ,       ,   ,     .   , , -   .</p><br>
<p>    -   ,    ,   32-  <em>cur-seqno</em>    -    <em>req-seqno</em>  ( )    .     (ACCEPTed —    ACCEPT)   ,    ,  <em>req-seqno</em>  <em>cur-seqno</em>.     <em>cur-seqno</em>      ,            .</p><br>
<p>    <em>expire-at</em>          ,   Unix-    .        <em>seqno</em>;   ,  -    ()   ( )            ,        .           ,      .</p><br>
<p> ,     256-  ( ), 32- <em>req-seqno</em> ( ), 32- <em>expire-at</em> ( ) , , 32- <em>op</em>        <em>op</em>.         ,   ,          - (      ).</p><br>
<h2 id="get-metody">Get-</h2><br>
<p>,   -     get-. ,  - dns-  TON DNS,  ,  get- "dnsresolve".  -     get-.        —  get- "seqno" ( ),    <em>seqno</em> -,        ,     ,  ,     .</p><br>
<p>:</p><br>
<ul>
<li>Cell () — A TVM cell consists of at most 1023 bits of data, and of at most four references to other cells. All persistent data (including TVM code) in the TON Blockchain is represented as a collection of TVM cells (cf. [1, 2.5.14]). —  TVM      1023            .    (  TVM)   TON      TVM (. [1, 2.5.14]). —   TON Virtual Machine description (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">https://test.ton.org/tvm.pdf</a>)</li>
</ul><br>
<h2 id="kakie-mozhno-sdelat-vyvody-na-osnove-prochitannogo">      ?</h2><br>
<ol>
<li>    ,   - .</li>
<li> — , ,  </li>
<li>   <em>seqno</em>     </li>
<li> dns- —  dnsresolve</li>
<li>        ,     ,      <em>expired_at</em>   </li>
<li>      ,   —    </li>
<li>  -   : <em>op, query_id</em> — ,       <em>op</em></li>
<li>        UTF-8    “ ”       </li>
<li>      </li>
<li>"    " —    </li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要求/応答メッセージの上位ビットは、要求メッセージの場合は値0、応答メッセージの場合は値1を取ります。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">エラーを特定するための応答メッセージには標準のop値があります</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">応答メッセージが不明な操作で受信された場合、無視する必要があります。つまり、コード0で完全に実行します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メッセージの送信、ガスの送信、応答の送信には料金がかかります。</font><font style="vertical-align: inherit;">同時に、彼が必要以上に送った場合、超過分は回答で返されます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メッセージを受信するときは、常に</font><em><font style="vertical-align: inherit;">バウンスされた</font></em><font style="vertical-align: inherit;">フラグを</font><em><font style="vertical-align: inherit;">最初に</font></em><font style="vertical-align: inherit;">チェックする価値があります</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></em></li>
</ol><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ご清聴ありがとうございました。建設的なフィードバックをいただければ幸いです。</font></font></p></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja470750/index.html">アマゾンが人気商品をキャッチ</a></li>
<li><a href="../ja470752/index.html">Wechat支払いの解析</a></li>
<li><a href="../ja470754/index.html">RASAチャットボット：Parallels Experience</a></li>
<li><a href="../ja470756/index.html">Apolloオンラインチャット、Node.jsのバックエンドアプリケーションの作成</a></li>
<li><a href="../ja470758/index.html">2019年9月のバイラル活動の概要</a></li>
<li><a href="../ja470774/index.html">Python 3.8の新しい型注釈（プロトコル、最終、TypedDict、リテラル）</a></li>
<li><a href="../ja470778/index.html">Seagate ST2000DM008ドライブレビュー：値上がりのない高速「2」</a></li>
<li><a href="../ja470780/index.html">バーが採用されました-Seagateの新しいストレージ</a></li>
<li><a href="../ja470782/index.html">国境のデータ：新しいITアーキテクチャを構築する方法</a></li>
<li><a href="../ja470784/index.html">死んだ細胞の神秘的な世界のカラーデザイン</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>