<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤛🏻 👨🏻‍🍳 💤 Commande de moteur sans fil de Lego à l'aide de Steam Controller 👩🏼‍🔧 🗼 🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Quand j'étais jeune, j'ai toujours voulu avoir des kits Lego Technics pour collecter toutes sortes de trucs sympas d'eux. Réservoirs autonomes avec to...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Commande de moteur sans fil de Lego à l'aide de Steam Controller</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/500668/"><img src="https://habrastorage.org/webt/to/-q/fh/to-qfh-f6as72siykacsf0u_8du.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quand j'étais jeune, j'ai toujours voulu avoir des kits Lego Technics pour collecter toutes sortes de trucs sympas d'eux. Réservoirs autonomes avec tourelles rotatives tirant des briques Lego. Mais je n'avais pas un tel ensemble. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et même les briques habituelles de Lego ne l'étaient pas. Je n'avais qu'un ami dont le frère avait tous ces jouets chers. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et maintenant, j'ai un fils de son âge. Et il construit des réservoirs qui ... collent bêtement en avant jusqu'à ce qu'ils heurtent le mur :) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et maintenant, le moment est venu pour ESP32 et la magie du fer à souder - nous allons assembler la télécommande appropriée pour eux!</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Non, bien sûr, je connais l'existence de telles télécommandes. </font><font style="vertical-align: inherit;">Mais aucun ne me convient parfaitement. </font><font style="vertical-align: inherit;">Ils sont soit infrarouges, avec la technologie des années 80, soit trop grands. </font><font style="vertical-align: inherit;">Ou cher. </font><font style="vertical-align: inherit;">Et le plus important - je ne peux pas dire à mon fils à propos de l'un d'eux: "Je l'ai fait spécialement pour vous!" </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Faisons donc une nouvelle télécommande améliorée pour gouverner tout le monde!</font></font><br>
<a name="habracut"></a><br>
<img src="https://habrastorage.org/getpro/habr/post_images/ffa/c72/7fd/ffac727fd7f9547d36657745fe7ea3a1.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ingrédients:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ESP32-WROOM-32D | </font><font style="vertical-align: inherit;">WiFi, BLE et un processeur avec E / S - assez pour contrôler deux </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">moteurs</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et une </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LED</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DRV8833 | </font><font style="vertical-align: inherit;">double pont en H avec suffisamment de puissance pour les moteurs.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TPS62162 | </font><font style="vertical-align: inherit;">abaissement de la tension à 17 V, ainsi que pour le divertissement lors du soudage du boîtier WSON-8 2 × 2 mm</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CP2104 | </font><font style="vertical-align: inherit;">pour programmer ESP32</font></font></li>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"></a>     .      ,   Lego  .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout cela sera situé sur une carte assez petite - voici son apparence dans l'éditeur EasyEDA: Le </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/3c8/4af/b81/3c84afb81433206ebf31adbfde2b8700.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
fil visible sur la photo d'en-tête n'est pas nécessaire pour corriger les erreurs, mais pour alimenter l'USB. Ce n'est peut-être pas suffisant pour le moteur, mais, malheureusement, les contacts de la Chine ne me sont toujours pas parvenus. Par conséquent, je vérifie d'abord le fonctionnement des LED. Pour la beauté de la photo, je viens de mettre le connecteur du moteur sur la carte. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sur la version 1.1 de ma carte (contrairement à la version 1.2, qui est déjà sur EasyEDA), il n'y avait pas de LED, j'ai donc soudé deux diodes anti-parallèles à la sortie pour que ce qui se passait soit visible. Si vous regardez de près, la vidéo montre une inclusion alternative d'une paire de diodes 0603, indiquant un mouvement avant / arrière.</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/UX0iBoP1utU" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En ce qui concerne le panneau de commande, au début, je voulais simplement récupérer une carte supplémentaire avec des boutons et un autre ESP32 - une télécommande classique. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cependant, je me suis souvenu que les contrôleurs de vapeur ont un mode Bluetooth Low Energy (BLE). J'ai décidé de résoudre ce problème et après quelques heures, j'ai appris à recevoir des paquets du contrôleur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour ce faire, recherchez simplement le périphérique HID qui s'appelle SteamController et connectez-vous à celui-ci. Et puis utilisez le service non documenté de Valve et quelques </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">commandes non documentées</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> qui permettent les transferts de paquets. </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/2f7/fb5/877/2f7fb5877ff2dae71c57c405b3e4c5d4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et je suis également tombé sur un format de rapport non documenté, que j'ai analysé manuellement.</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/22c/8ab/3db/22c8ab3db50e5ac2a0fb6c0c48a2701e.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Après environ une heure, la signification des drapeaux et des valeurs est devenue claire pour moi, et j'ai réussi à faire clignoter la LED à l'aide du contrôleur Steam et de l'ESP32. </font><font style="vertical-align: inherit;">¯ \ _ (ツ) _ / ¯</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Des dossiers</font></font></h2><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Circuit imprimé et carte </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EasyEDA easyeda.com/EFS-GH/legoremote</font></font></a></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sources pour Arduino: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github.com/g3gg0/LegoRemote</font></font></a></li>
</ul><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">v1.0:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> «approche d'essai» </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - la première option pour laquelle j'ai choisi le mauvais régulateur de tension. Le TPS62291 n'augmente la tension qu'à 6 V. J'ai développé plusieurs projets en parallèle, et j'ai oublié que l'appareil doit fonctionner avec 9 V. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">v1.1:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> «assez bien» </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - cette option est visible dans les publicités, et tout fonctionne </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">v1.2:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> «final» </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - ajout de LED d'indication à la sortie et optimisation de la taille et de la disposition de la carte </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La courte vidéo suivante montre la phase de connexion (1 à 3 secondes après la mise sous tension) et le contrôle des sorties du moteur. Le connecteur Lego n'est pas encore connecté. Il ira dans un espace vide à côté des autres connecteurs, marqué d'un rectangle blanc.</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/-2-QGO-eoNQ" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mon fils utilise maintenant régulièrement ce contrôleur pour contrôler les appareils qu'il a assemblés. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pendant le test de stress, je n'ai rencontré qu'un seul problème: je pensais que le mode de «décroissance rapide» du pilote de moteur fonctionnerait mieux, mais à cause de cela, après quelques secondes de fonctionnement, la vitesse du moteur chuterait beaucoup. </font><font style="vertical-align: inherit;">J'ai donc changé le code pour qu'il utilise la «décroissance lente». </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/c1e/e09/921/c1ee09921222a6c99fa4dce4395ca4a7.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jusqu'à présent, je ne sais pas comment fonctionne le DRV et pourquoi le moteur tourne d'abord rapidement, puis après 10 secondes, il commence à ralentir progressivement. </font><font style="vertical-align: inherit;">Peut-être que les MOSFET se réchauffent et que leur résistance augmente trop.</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/aIFafodKasQ" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'espère que cet exemple d'utilisation d'Arduino inspire sans effort d'autres personnes et leur permet d'initier leurs enfants à l'électronique.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr500648/index.html">Qu'est-ce qu'un modèle architectural de maturité d'entreprise?</a></li>
<li><a href="../fr500654/index.html">WebRTC sur Android: comment activer l'encodage matériel sur plusieurs appareils</a></li>
<li><a href="../fr500656/index.html">Journalisation hiérarchique de l'application dans la base de données</a></li>
<li><a href="../fr500660/index.html">Une histoire simplifiée et très courte du développement des "nuages"</a></li>
<li><a href="../fr500666/index.html">Certification en ligne Microsoft - vous, votre espace et votre ordinateur</a></li>
<li><a href="../fr500670/index.html">Comment nous créons notre produit. Première partie, Recherche</a></li>
<li><a href="../fr500672/index.html">Poursuite du flux pour les testeurs et pas seulement</a></li>
<li><a href="../fr500676/index.html">Annonce d'un atelier en ligne sur l'automatisation des tests</a></li>
<li><a href="../fr500678/index.html">ClickHouse pour les utilisateurs avancés dans les questions et réponses</a></li>
<li><a href="../fr500688/index.html">Travailler avec une base de données dans Flask: de juin à juin</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>