<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‰ ğŸš ğŸ§‘ğŸ¼â€ğŸ¤â€ğŸ§‘ğŸ¼ BFCache ou LÃ  et retour. Rapport Yandex ğŸ’…ğŸ¼ ğŸ§ğŸ¿ ğŸ’¾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Les gens utilisent le bouton de retour Ã  la page prÃ©cÃ©dente dans le navigateur trÃ¨s souvent - peut-Ãªtre plus souvent que vous ne le pensez. Et si oui,...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>BFCache ou LÃ  et retour. Rapport Yandex</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yandex/blog/496360/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les gens utilisent le bouton de retour Ã  la page prÃ©cÃ©dente dans le navigateur trÃ¨s souvent - peut-Ãªtre plus souvent que vous ne le pensez. </font><font style="vertical-align: inherit;">Et si oui, alors pourquoi jeter immÃ©diatement la page hors de la mÃ©moire du navigateur, et aprÃ¨s une seconde passer du temps et du trafic Ã  la rouvrir? </font><font style="vertical-align: inherit;">Afin que l'utilisateur puisse revenir rapidement en arriÃ¨re, la technologie BFCache a Ã©tÃ© inventÃ©e, ce qu'il est important de retenir lors du dÃ©veloppement des interfaces. </font><font style="vertical-align: inherit;">Victor Khomyakov</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">victor-homyakov</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> compris la "mise en cache aller-retour" et compilÃ© une table de compatibilitÃ© BFCache avec diffÃ©rentes API.</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/vz2IsHcSaKE" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- Bonjour, je m'appelle Victor. </font><font style="vertical-align: inherit;">Je travaille au sein d'une Ã©quipe assez importante qui s'occupe de la page de recherche.</font></font><br>
<a name="habracut"></a><br>
<img src="https://habrastorage.org/webt/ai/mc/ut/aimcutfjg_xnumc1xre2li547vw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Au minimum, vous avez dÃ©jÃ  vu la mÃªme page ou une page similaire sur Google. Et en particulier, je traite le problÃ¨me de la vitesse de tÃ©lÃ©chargement de cette page - afin qu'elle s'affiche sur le serveur le plus rapidement possible et se tÃ©lÃ©charge et s'affiche aux clients le plus rapidement possible. Pourquoi c'est important? Moins le client attend que votre page se charge, moins il est probable qu'il n'attendra pas et ne vous quittera pas. Et plus il est probable que le client rÃ©ussira Ã  se convertir Ã  quelque chose d'autre, plus le score net de promotion sera Ã©levÃ©. Autrement dit, le client se fera un plaisir de dire Ã  tout le monde qu'il sait que c'est une page gÃ©niale gÃ©niale - elle se charge trÃ¨s rapidement, elle est trÃ¨s pratique Ã  utiliser. Et finalement, plus vous gagnez d'argent. Ou votre entreprise, alors elle vous donnera un prix.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je vais donner un certain nombre d'exemples d'entreprises bien connues. Google a menÃ© une expÃ©rience. Ils ont intentionnellement intÃ©grÃ© un retard sur la page de recherche et mesurÃ© comment cela affecte les performances. Il s'est avÃ©rÃ© qu'en moyenne, il y avait un demi pour cent de recherches en moins par utilisateur. Qu'est-ce qu'un demi pour cent? Calculer: un demi pour cent de centaines de millions d'utilisateurs de Google est un nombre assez important. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bing a fait la mÃªme expÃ©rience. Ils ne croyaient pas Google, ils ont dÃ©cidÃ© de revÃ©rifier. Ils ont obtenu des rÃ©sultats similaires: sensiblement moins de revenus par utilisateur lorsque la page ralentit. Pourquoi ralentir? Parce qu'il est plus facile de ralentir la page du nombre exact de millisecondes afin qu'elle puisse Ãªtre facilement reproduite en production que de l'accÃ©lÃ©rer de la mÃªme quantitÃ©.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Exemple sur AliExpress. Ils ont accÃ©lÃ©rÃ© leur site de 36% et reÃ§u beaucoup plus de commandes des utilisateurs. Les commandes sont en argent direct. En gÃ©nÃ©ral, il est dÃ©jÃ  clair pour tout le monde que la vitesse est assez importante, elle affecte, Ã  travers un certain nombre de mÃ©triques, l'argent gagnÃ©. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et encore un facteur. Aujourd'hui, nous </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">avons</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dÃ©jÃ  </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">parlÃ©</font></a><font style="vertical-align: inherit;"> de l'optimisation d'image. En optimisant votre trafic, en rÃ©duisant le nombre de tÃ©lÃ©chargements, vous payez moins d'argent Ã  vos hÃ©bergeurs pour le trafic sortant. C'est aussi l'argent qui restera dans votre poche. Et si je vous offre soudainement une remise de 10% sur le trafic de n'importe quel hÃ´te sans aucune restriction ni condition? Et si je propose de m'assurer que la part de vos pages - par exemple, dix pour cent - est chargÃ©e par l'utilisateur presque instantanÃ©ment? Personne ne refusera.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La technologie dont j'essaierai de parler aujourd'hui est l'une des solutions possibles qui impose peu de restrictions sur la pile avec laquelle vous travaillez, sur quelles technologies, mais promet en mÃªme temps de vous apporter des gains assez importants. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour commencer, Google collecte des statistiques sur la faÃ§on dont ces navigateurs sont utilisÃ©s dans leurs navigateurs. Et ils ont publiÃ© un tel nombre: il s'avÃ¨re que, en moyenne, de toutes les ouvertures de pages, de toute la navigation dans Chrome mobile, environ 19% est un mouvement de va-et-vient Ã  travers l'histoire. Pensez Ã  ce que cela signifie? Si vous arrondissez, il s'avÃ¨re que 20% de la navigation se dÃ©place vers la page oÃ¹ l'utilisateur vient d'Ãªtre.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour nous, comme pour les auteurs des pages, cela signifie: mÃªme si l'utilisateur le quitte, il y a de fortes chances qu'il soit sur le point de revenir. D'une part, cela peut Ãªtre prÃ©cisÃ©ment le problÃ¨me des tÃ©lÃ©phones portables: tout est petit, il est facile de rater un doigt, cliquez sur le lien et quittez la page, puis dites: "Oh enfer! Je veux retourner". Mais sur les ordinateurs de bureau, la situation est Ã  peu prÃ¨s la mÃªme: lÃ , le nombre est moindre, mais il y a quand mÃªme un pourcentage important de retours. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Que faisons-nous en ce moment? Nous passons inefficacement sur le temps et le trafic des utilisateurs. Autrement dit, nous commenÃ§ons Ã  recharger la mÃªme page en arriÃ¨re, Ã  l'analyser, Ã  recrÃ©er le DOM, Ã  tout redessiner Ã  l'Ã©cran, Ã  charger, Ã  exÃ©cuter JavaScript.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le navigateur est une chose assez puissante. Il essaie d'utiliser des caches dans la mesure du possible. Et la plupart des ressources peuvent Ãªtre dans son cache. Il ne les attendra pas sur le rÃ©seau, mais les rÃ©cupÃ©rera directement dans le cache. Par exemple, dans le moteur V8, le rÃ©sultat de l'analyse JavaScript est Ã©galement mis en cache. Autrement dit, le navigateur ne rechargera pas et n'analysera pas JS, et dans la plupart des cas, il faudra pour l'exÃ©cuter immÃ©diatement. Mais tout de mÃªme, la reconstruction du DOM, le rechargement des ressources non mises en cache et l'exÃ©cution de JS prennent beaucoup de temps. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La solution se suggÃ¨re. Qu'est-ce que nous faisons? Nous, lorsque l'utilisateur quitte notre page, ne la nettoyons pas immÃ©diatement. Nous sauvegardons simplement son Ã©tat et le cachons visuellement Ã  l'utilisateur afin que sous le capot il reste Ã  la disposition du navigateur.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Que ferons-nous si l'utilisateur dÃ©cide de revenir? </font><font style="vertical-align: inherit;">Montrez-lui simplement la mÃªme page enregistrÃ©e. </font><font style="vertical-align: inherit;">Il peut Ãªtre affichÃ© presque instantanÃ©ment. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ax/xm/7d/axxm7doualef_atc2j8_ufybr2i.gif"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cette technologie est appelÃ©e cache arriÃ¨re / avant, Ã  partir des mots Â«va-et-vientÂ». </font><font style="vertical-align: inherit;">AbrÃ©viation de bfcache. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici un exemple de la faÃ§on dont le mÃªme navigateur, le mÃªme assembly, se comporte lorsque bfcache est Ã©teint et allumÃ©. </font><font style="vertical-align: inherit;">L'ouverture de la premiÃ¨re page est tout aussi lente ici et lÃ . </font><font style="vertical-align: inherit;">Mais de plus, lorsque nous commenÃ§ons Ã  nous dÃ©placer d'avant en arriÃ¨re dans l'histoire, une pause est perceptible Ã  gauche, et pas Ã  droite. </font><font style="vertical-align: inherit;">A gauche, le mouvement habituel Ã  travers l'histoire prend du temps. </font><font style="vertical-align: inherit;">A droite, tout se passe trÃ¨s, trÃ¨s vite.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Afficher le GIF</font></font></b><div class="spoiler_text"><img src="https://habrastorage.org/webt/lf/0n/h1/lf0nh1gnji5qf1w9kj_irqcagrm.gif" width="350"><img src="https://habrastorage.org/webt/og/ca/_n/ogca_ny6xmytv-_iqvdl4xslpcq.gif" width="350"></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un exemple similaire de notre recherche. Ã€ gauche se trouve le Safari habituel sur macOS avec bfcache dÃ©sactivÃ©, Ã  droite se trouve le mÃªme Safari avec les paramÃ¨tres par dÃ©faut et bfcache activÃ©. C'est un cas assez courant: une personne vient Ã  la recherche, peut ne pas savoir exactement ce qu'elle cherche, peut demander plusieurs options de requÃªte. J'ai demandÃ© la premiÃ¨re demande - quelque chose ne va pas. La deuxiÃ¨me demande semble meilleure. TroisiÃ¨mement - non, pire, revenez Ã  la demande prÃ©cÃ©dente. Et en ce moment ce serait bien de ne pas le faire attendre. Il vient de voir cette demande prÃ©cÃ©dente, montrez-la tout de suite.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ou la deuxiÃ¨me option, si vous avez la pagination et plusieurs pages sur le problÃ¨me. Homme feuilletant la question. Je suis allÃ© Ã  la deuxiÃ¨me, troisiÃ¨me, quatriÃ¨me page, j'ai regardÃ© - non, il y a un problÃ¨me, je reviens. Et nous, encore une fois, pouvons lui montrer les pages prÃ©cÃ©dentes presque instantanÃ©ment. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un problÃ¨me important est la sÃ©curitÃ©. Bien que la page sur laquelle l'utilisateur n'Ã©tait pas dans un Ã©tat masquÃ©, il peut accÃ©der Ã  diverses API qui vous permettent de lire l'Ã©tat matÃ©riel de votre tÃ©lÃ©phone ou ordinateur. Voici une courte liste de ce qui m'est immÃ©diatement venu Ã  l'esprit: gÃ©olocalisation, modification de la position de votre appareil dans l'espace, accÃ¨s Ã  la camÃ©ra et son du microphone.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, lorsque la page apparaÃ®t, il est important qu'elle n'accÃ¨de pas Ã  tous les Ã©vÃ©nements qui se sont produits pendant la pÃ©riode oÃ¹ elle a Ã©tÃ© masquÃ©e. </font><font style="vertical-align: inherit;">Sinon, un canal supplÃ©mentaire s'ouvrira pour espionner les utilisateurs. </font><font style="vertical-align: inherit;">Il est important qu'elle n'obtienne pas un historique de vos mouvements pendant tout ce temps et des enregistrements du microphone et de la camÃ©ra. </font><font style="vertical-align: inherit;">Les dÃ©veloppeurs de navigateurs ne doivent pas non plus l'oublier.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Support API et navigateur</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Plus proche du sujet. Supposons que je vous ai dÃ©jÃ  convaincu, vous Ãªtes: "Oui, un bon sujet, nous devons travailler avec cela." Quelles API avons-nous Ã  notre disposition, avec quoi pouvons-nous travailler si nous acceptons de prendre en compte bfcache, et comment cela est-il pris en charge par les navigateurs? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
OÃ¹ bfcache existe-t-il dÃ©jÃ , oÃ¹ puis-je le voir? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- Il a longtemps Ã©tÃ© implÃ©mentÃ© dans les navigateurs Firefox, Safari (et macOS et iOS), ainsi que dans Internet Explorer 11 (!). Habituellement, nous rÃ©primandons les dÃ©veloppeurs Microsoft, mais ici, ils ont juste essayÃ©. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- Il est implÃ©mentÃ© dans le navigateur UC Browser 11/12, version pour Android. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- Du coup, il n'est plus dans Chrome. Et dans Chromium, cette fonctionnalitÃ© est en cours de dÃ©veloppement.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/_v/dh/yq/_vdhyq6ph84lnnb05f2ffw75ud4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainsi, lorsqu'ils le font dans Chromium, presque tous ces navigateurs (et ce n'est pas une liste complÃ¨te) obtiendront tÃ´t ou tard cette fonctionnalitÃ© - gratuitement, sans SMS et sans inscription. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Existe-t-il une sorte d'API? Je veux gÃ©rer bfcache, je veux l'activer et le dÃ©sactiver directement Ã  partir de JavaScript, pour savoir s'il y a une page dans bfcache ou non. Que diriez-vous d'une telle API? Il n'y a pas une telle API. Et cela a Ã©tÃ© fait consciemment: la page ne devrait pas vouloir activer ou dÃ©sactiver bfcache pour tout le monde et pour elle-mÃªme. Ou dÃ©couvrez s'il y a quelqu'un dans ce bfcache ou non. Tout cela est dÃ» Ã  la sÃ©curitÃ©. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/4m/5i/ra/4m5iragmxqrikl_7i8dqp-0ijcy.jpeg"><br>
<b><sup><sub><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lien depuis la diapositive</font></font></a></sub></sup></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais qu'avons-nous? Types de navigation. Il existe un type de lien - prÃ©rendeur de lien, lorsque nous voulons afficher une page Ã  l'avance. Il existe pour lui un type de navigation particulier: cette page s'ouvrira avec le Â«PrerenderÂ» NavigationType. Si nous ouvrons simplement la page dans un navigateur, il y aura alors Â«naviguerÂ». Si nous cliquons sur le bouton Â«Mettre Ã  jourÂ», ce sera Â«rechargerÂ». </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous sommes intÃ©ressÃ©s par le type de navigation Â«back_forwardÂ» ici, cela indique clairement que l'utilisateur s'est dÃ©placÃ© d'avant en arriÃ¨re dans l'histoire. C'est exactement le type de navigation avec lequel notre bfcache peut fonctionner.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ud/8o/o_/ud8oo_rhzpnyzjfdymvr11pfg4i.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une autre API est les Ã©vÃ©nements pageshow pagehide. Ils existaient dÃ©jÃ  dans les navigateurs. En consÃ©quence, pageshow est dÃ©clenchÃ© lorsque votre page est affichÃ©e dans le navigateur pour l'utilisateur, pagehide est dÃ©clenchÃ©e lorsque la page se cache pour une raison quelconque. Et ils ont Ã©tÃ© complÃ©tÃ©s par le champ persistant. Si la page se cache et en mÃªme temps sera placÃ©e dans bfcache, le champ persistant sera vrai. Si la page s'affiche lors de son Ã©lÃ©vation Ã  partir de bfcache, le champ persistant sera Ã  nouveau vrai. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par consÃ©quent, si le navigateur ne va pas mettre en cache la page, le masquage de page restera faux. Et si le navigateur affiche la page pendant le chargement normal, ou s'il n'utilise pas bfcache, alors pageshow persistera Ã©galement faux. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/7v/kh/kh/7vkhkhw8tjkz6y10o97urigdhea.jpeg"><br>
<b><sup><sub><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lien depuis la diapositive</font></font></a></sub></sup></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La prise en charge des Ã©vÃ©nements est disponible dans presque tous les navigateurs, mÃªme ceux qui ne prennent pas encore en charge bfcache. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/om/6w/7h/om6w7hjxxswbq5uvpaiu-afe5to.jpeg"><br>
<b><sup><sub><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lien depuis la diapositive</font></font></a></sub></sup></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Il en va de mÃªme pour le champ persistant. Il existe dÃ©jÃ  dans Chrome et Chrome ne prend toujours pas en charge bfcache. Autrement dit, ce champ sera toujours dedans, mais pour l'instant il sera faux. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quand je suis tombÃ© sur ce phÃ©nomÃ¨ne, bfcache, j'ai dÃ» l'Ã©tudier, taper de tous les cÃ´tÃ©s, regarder comment Ã§a marche. J'ai immÃ©diatement voulu voir sur ma page lorsque j'ouvre la valeur du champ persistant dans mes gestionnaires.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/dx/k6/qe/dxk6qegw2k1ohv-osipeghzjccw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il semblerait que tout soit assez simple. J'ai Ã©crit un gestionnaire et sorti sur console.log () ce qui m'arrive. Mais lors de l'ouverture de DevTools dans certains navigateurs, bfcache peut soudainement s'arrÃªter. Autrement dit, j'ai ouvert DevTools, je fais des allers-retours dans les pages, et ma persistance est toujours fausse, la page n'entre pas dans bfcache. D'accord, j'ai un autre outil puissant - alerte. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais non. Les navigateurs modernes lors du dÃ©chargement d'une page dans le masque de page, avant et aprÃ¨s le dÃ©chargement ignorent simplement l'alerte, cela ne fonctionne tout simplement pas. Et encore une fois, je ne vois pas ce que je veux. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/by/1b/ij/by1bijibkuzglk6vvkhbcvrmmgo.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
D'accord, j'ai un produit encore plus tueur. Je suis dans un bloc directement sur ma propre page, que j'explore, en ajoutant simplement le texte du contenu de mon Ã©vÃ©nement et en enregistrant ainsi tout. Cette mÃ©thode a fonctionnÃ©.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/jw/xt/o1/jwxto1ndmuldxtn4hpoa_3z6-bk.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout, s'il vous plaÃ®t, peut Ãªtre utilisÃ©. J'ai dÃ©boguÃ© mon code, Ã§a marche pour moi, je peux continuer Ã  continuer. Bien sÃ»r, je n'oublie pas qu'aprÃ¨s tout, un script statique externe est mieux adaptÃ© pour ne pas charger le mÃªme code en ligne sur la page, mais pour utiliser la mise en cache des fichiers. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai mis ce code dÃ©boguÃ© dans un script externe. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/x1/5m/s0/x15ms0a9q4solt69-vucvdyoqgu.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais non, les gestionnaires de pageshowhide sont tombÃ©s dans Safari! Pour une raison quelconque, ils ne fonctionnent pas Ã  partir d'un script externe. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
D'accord, j'ai dÃ©jÃ  une version fonctionnelle. J'ai dÃ» le laisser comme Ã§a.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/td/kq/aw/tdkqawklgz4m_mdw7d_elw7a27m.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je vais Ã©numÃ©rer briÃ¨vement ce que j'ai rÃ©ussi Ã  marcher en une seule journÃ©e. Tout d'abord, DevTools peut dÃ©sactiver la mise en cache. Vous vous souvenez probablement que dans DevTools sur l'onglet RÃ©seau dans Chrome, il y a une case Ã  cocher "DÃ©sactiver le cache". Il dÃ©sactive le cache rÃ©seau, il ne peut pas affecter bfcache, ou il peut. L'analogie est claire: nous avons ouvert DevTools, ce qui signifie que nous dÃ©veloppons et que nous n'avons peut-Ãªtre pas besoin de mise en cache. Peut-Ãªtre que cela nous dÃ©range. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/4d/up/mb/4dupmbrpcewpmpngg49_fddhuf4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La deuxiÃ¨me caractÃ©ristique est l'alerte. Firefox et Safari l'ignoreront en silence et continueront Ã  exÃ©cuter les gestionnaires plus loin, comme s'il n'y avait pas d'alerte. Et un seul bon vieux Chrome dans la console Ã©crira une erreur en rouge - vous avez une alerte, je l'ai bloquÃ©e, sachez-la! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Encore une fois, je vous rappelle que les gestionnaires d'un script externe dans Safari ne peuvent pas Ãªtre appelÃ©s, c'est trÃ¨s Ã©trange.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et une autre nouvelle importante. </font><font style="vertical-align: inherit;">Si votre page est mise en cache, c'est-Ã -dire que vous avez reÃ§u un Ã©vÃ©nement de masquage de page, et il dit persistÃ© vrai, et le navigateur vous dit: "Oui, je l'ai mis dans le cache" - cela ne donne aucune garantie que la page sera plus tard Ã  partir de ce cache est levÃ© et affichÃ© Ã  l'utilisateur. </font><font style="vertical-align: inherit;">Parce que le navigateur peut dÃ©cider d'effacer ce cache s'il manque de mÃ©moire. </font><font style="vertical-align: inherit;">Parce que l'utilisateur peut fermer le navigateur et ne naviguer nulle part. </font><font style="vertical-align: inherit;">N'oubliez pas cela.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CaractÃ©ristiques d'implÃ©mentation</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai commencÃ© Ã  approfondir la documentation, Ã  rechercher comment vivre avec ces connaissances. Ã‰tonnamment, la documentation Ã©tait. Autrement dit, vous pouvez trouver sur Internet une description du fonctionnement de bfcache dans les navigateurs. Mais, plus je lis, plus les diffÃ©rences s'accumulent entre les diffÃ©rents navigateurs. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans l'un, Ã§a marche comme Ã§a, dans l'autre Ã§a marche. Dans l'un, l'un interfÃ¨re, l'autre n'interfÃ¨re pas. Les dÃ©veloppeurs ne savent pas comment traiter correctement un certain nombre d'API lors du placement d'une page dans bfcache. Ils disent: ok, si la page utilise cette API, je l'ignore, je ne la mets en aucun cas dans le cache. Et cette liste est diffÃ©rente selon les navigateurs, chacun fait ce qui lui convient. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et puis j'ai commencÃ© Ã  combiner ce que j'ai appris en une seule table. J'ai quelque chose comme ceci:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/9v/qm/iy/9vqmiyq_zcjwc5ln8nciv8golra.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai lu la documentation des navigateurs - pour Firefox, Safari, la famille Chromium. Il y avait de la documentation disponible sur IE, bien que dÃ©passÃ©e. Nous programmeurs n'aimons pas mettre Ã  jour la documentation aprÃ¨s des changements dans le navigateur? Quand j'ai rÃ©alisÃ© que les informations Ã©taient obsolÃ¨tes, j'ai commencÃ© Ã  tester mes petites pages dans les navigateurs et Ã  vÃ©rifier quelle API fonctionnait et laquelle ne fonctionnait pas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cela ne suffisait pas non plus: je ne sais pas quelles API examiner en principe, mais pas pour tout trier du tout? Et j'ai dÃ» examiner le code source des moteurs de navigateur eux-mÃªmes, c'est-Ã -dire que le code s'est avÃ©rÃ© Ãªtre la source de connaissances la plus prÃ©cise et la plus fiable. Pour le moment, cette plaque (devant vous en est une partie, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">voici un lien</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> vers la version complÃ¨te) est la collection la plus complÃ¨te de connaissances sur les API qui autorisent ou interdisent Ã  bfcache de fonctionner dans les navigateurs.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les API qui n'interfÃ¨rent pas avec une coche et une couleur verte, celles qui empÃªcheront dÃ©finitivement la page d'entrer dans bfcache sont marquÃ©es en rouge. </font><font style="vertical-align: inherit;">Les champs blancs sont des espaces qui ne sont dÃ©crits nulle part.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Firefox</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici quelques dÃ©tails intÃ©ressants de navigateurs spÃ©cifiques. Je vais commencer par Firefox, il a Ã©tÃ© le premier Ã  tout faire. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/fh/bt/fh/fhbtfhn8db-lqcxhqe8n8vm8z6u.jpeg"><br>
<b><sup><sub><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lien depuis la diapositive</font></font></a></sub></sup></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
La chose la plus importante que j'ai apprise des sources de Firefox est que lorsque vous travaillez avec bfcache, il peut Ã©crire dans le journal de texte sur le disque toutes les raisons pour lesquelles il ne peut pas mettre la page dans le cache. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/dd/xp/jr/ddxpjraedcefaftwi0u9cdys2tg.jpeg"><br>
<b><sup><sub><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lien depuis la diapositive</font></font></a></sub></sup></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Et j'ai mÃªme rÃ©ussi Ã  savoir comment le faire. Il y a deux variables d'environnement secrÃ¨tes: dans l'une, nous indiquons ce qu'il faut enregistrer, dans la seconde - dans quel fichier Ã©crire un journal. AprÃ¨s cela, nous lanÃ§ons le binaire, et le tour est jouÃ©! Nous verrons approximativement que sur la diapositive prÃ©cÃ©dente, les lignes du formulaire Â«un tel html ne peut pas Ãªtre mis en cache pour une telle raison, telle pour une autre raisonÂ». Nous pouvons le lire tout de suite, trÃ¨s pratique.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ci/_u/3m/ci_u3mrg5k5um_zah0gtm7splmy.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous souhaitez tester une fois, vous pouvez ouvrir la page about: networking dans Firefox. LÃ , vous pouvez entrer les mÃªmes champs dans la section "Journal". Nous pouvons indiquer dans deux champs quoi et oÃ¹ se connecter, et avec les boutons dÃ©marrer et arrÃªter le journal. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/w3/8s/zb/w38szbgmjgikrkqg-2f7tt6px0a.jpeg"><br>
<b><sup><sub><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lien depuis la diapositive</font></font></a></sub></sup></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Quand Firefox refuse-t-il de mettre en cache la page? Si vous avez des demandes incomplÃ¨tes, y compris des demandes AJAX ou des demandes de ressources telles que des images, alors il refusera de mettre la page en bfcache. Il pense que ce n'est pas terminÃ©, n'a pas fini de tÃ©lÃ©charger, il y a une sorte d'activitÃ© suspecte. Mais tout cela ne s'applique pas au favicon. Si vous avez oubliÃ© le favicon, s'il ne se charge pas, il pense - d'accord, il le fera, c'est normal pour votre site.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous avez un script de longue durÃ©e, le navigateur vous demandera: comme cela prend du temps, bloque l'interface utilisateur, peut-Ãªtre le battre? Et si vous Ãªtes d'accord, une telle page est considÃ©rÃ©e comme un peu fausse et nous ne la mettons pas en cache.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous utilisez IndexedDB ... Ceci est une histoire instructive. Auparavant, dans la premiÃ¨re implÃ©mentation, ils avaient l'air: si vous avez IndexedDB et qu'il y a une transaction incomplÃ¨te, alors une telle page n'est pas mise en cache, car il n'est pas clair comment travailler avec elle (nous essayons de la cacher en plein milieu de la transaction). Mais ils ont simplement perdu ce morceau de code lors de la refactorisation. Et comme vous pouvez l'imaginer, ils n'avaient pas de tests pour cela. Ils ont mÃªme un bug dans le bugtracker. Il a dÃ©jÃ  deux ans avec quelque chose. Les gens ont Ã©crit: "Mon bfcache avec IndexedDB ne fonctionne pas correctement, que dois-je faire?" Les dÃ©veloppeurs de Firefox ont rÃ©pondu - il tombe vraiment en panne, nous venons de perdre ce morceau de texte lors du refactoring, d'accord, laissez-le continuer. MoralitÃ©: Ã©crivez des tests, mÃªme si vous Ã©crivez Firefox, sinon tout peut malheureusement se terminer.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et un autre facteur intÃ©ressant de non-disponibilitÃ© dans bfcache - si le contenu mixte est explicitement autorisÃ©. Ce que c'est? </font></font><br>
<br>
<img src="https://habrastorage.org/webt/fm/2s/le/fm2sleys4nir1cuff_lw8q87cqi.jpeg"><br>
<b><sup><sub><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lien depuis la diapositive</font></font></a></sub></sup></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Supposons que votre page s'ouvre via HTTPS, mais que vous chargez toujours certaines ressources via HTTP, en particulier des scripts. Autrement dit, vous avez un script non sÃ©curisÃ©, il peut Ãªtre modifiÃ© par n'importe qui. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ts/k8/kj/tsk8kj6weynueewx9goi38sm81o.jpeg"><br>
<b><sup><sub><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lien Ã  partir de la diapositive</font></font></a></sub></sup></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Par dÃ©faut, Firefox, comme les autres navigateurs, n'exÃ©cute pas un tel script sans sÃ©curitÃ© maintenant. Mais si c'est trÃ¨s important pour vous, vous Ãªtes montÃ© dans les paramÃ¨tres et avez autorisÃ© son exÃ©cution, puis, en consÃ©quence, il ne mettra pas en cache une telle page. Il dira - eh bien, vous m'avez dit de ne pas exÃ©cuter le code, mais non, non!</font></font><br>
<br>
<img src="https://habrastorage.org/webt/pm/fg/_f/pmfg_fqywdhl7tihvcy09agmaxy.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un autre ajustement est la taille de bfcache lui-mÃªme. Ici, la valeur par dÃ©faut est moins un. Cela signifie la quantitÃ© de mÃ©moire de Firefox, autant de pages qu'il tente de mettre en cache. Mais nous pouvons forcer la dÃ©sactivation du cache en mettant un zÃ©ro ou en dÃ©finissant explicitement un nombre - par exemple, n'oubliez pas plus de cinq pages. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Avertissement: la diapositive suivante contient un exemple de code dans le langage effrayant C ++, cela peut Ãªtre dangereux lors d'une confÃ©rence front-end. N'essayez pas de le copier, exÃ©cutez-le dans la console du navigateur. Votre disque peut Ãªtre formatÃ©, l'Ã©cran peut exploser ou des bitcoins peuvent Ãªtre extraits. Je t'avais prÃ©venu. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/31/l-/uo/31l-uokshfiuo6dyxcivmfzsm5o.jpeg"><br>
<b><sup><sub><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lien depuis la diapositive</font></font></a></sub></sup></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Donc, le code Gecko. </font><font style="vertical-align: inherit;">Il peut Ãªtre ouvert, lu, consultÃ© gratuitement sur Internet. </font><font style="vertical-align: inherit;">Et j'ai fouillÃ©. </font><font style="vertical-align: inherit;">Il existe la mÃ©thode la plus importante - CanSavePresentation (), elle rÃ©pond Ã  la question: est-il possible de mettre en cache ce document? </font><font style="vertical-align: inherit;">Autrement dit, c'est la source ultime de vÃ©ritÃ© sur ce qui est maintenant implÃ©mentÃ© dans Firefox. </font><font style="vertical-align: inherit;">Et pourtant - c'est Ã  partir de lÃ  que j'ai appris que vous pouvez lire le journal. </font><font style="vertical-align: inherit;">Il existe une telle variable - gPageCacheLog. </font><font style="vertical-align: inherit;">Ceci est le journal dans lequel tout est Ã©crit. </font><font style="vertical-align: inherit;">Voici une histoire tellement intÃ©ressante sur une excursion en C ++. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est-Ã -dire que vous ouvrez le lien, regardez le code, recherchez (il y a une recherche pratique et, en plus, rapide) et vous pouvez trouver les dÃ©tails d'implÃ©mentation rÃ©els dans la derniÃ¨re version du navigateur - ceux qui manquent simplement dans la documentation.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Safari</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La chose la plus cruelle que fait Safari lorsqu'une page apparaÃ®t sur bfcache: si vous avez des demandes AJAX en attente, Safari les tue. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vp/bh/8p/vpbh8ppqy9qpfbpljjsu2huhtda.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MÃªme si vous les superposez avec des gestionnaires d'erreurs et essayez de tout vÃ©rifier, corrigez-le - il semble que la demande n'existe pas du tout. AprÃ¨s avoir rÃ©cupÃ©rÃ© de bfcache, vous n'aurez aucune erreur, aucun Â«OKÂ», rien du tout. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ic/jx/yk/icjxykful4yo0d7hbjopj_woljo.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les gestionnaires de pageshow pagehide, comme je l'ai dit, dans Safari ne sont appelÃ©s que s'ils sont Ã©crits dans un script en ligne dans la page. Ã€ partir d'un script externe, ils peuvent ou non fonctionner - quelle chance. Mais je vous ai prÃ©venu.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/0i/o7/ns/0io7nsvts4isj0qbirjisggubeg.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Autre diffÃ©rence intÃ©ressante: les gestionnaires beforeunload et unload n'interfÃ¨rent pas avec l'entrÃ©e de la page dans bfcache. Dans ce cas, beforeunload est toujours appelÃ©, et quand il entre dans le cache, et lorsqu'il n'est pas touchÃ©. Mais dÃ©charger lorsque la page atteint le cache n'est pas appelÃ©. Et voici un autre rake localisÃ©: la page peut aller dans le cache et ne jamais en apparaÃ®tre, et si vous avez Ã©crit un code important en dÃ©chargement, il ne sera jamais appelÃ©, bien qu'aucune erreur ne se soit produite sur la page. Autrement dit, il est allÃ© correctement dans le cache, et de lÃ  vers nulle part, et votre dÃ©chargement ne sera jamais appelÃ©.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/6e/m2/xy/6em2xyin9409en33_y-xk3ewxtg.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un autre point intÃ©ressant. Comme vous le savez, vous pouvez ouvrir plusieurs fenÃªtres via window.open (). Et en mÃªme temps, ces fenÃªtres ont des liens entre elles. Autrement dit, ils peuvent simultanÃ©ment grimper dans la fenÃªtre de l'autre, lire / Ã©crire diffÃ©rentes propriÃ©tÃ©s. Cette ouverture des fenÃªtres enfants n'interfÃ¨re pas avec bfcache. Et ici, trÃ¨s probablement, Safari est tout aussi cruel qu'avec les demandes AJAX, c'est-Ã -dire que tout se dÃ©chire et au revoir. Les dÃ©veloppeurs d'Apple l'aiment plus. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Encore une minute en C ++! Les sources WebKit ne sont pas non plus secrÃ¨tes, elles peuvent Ã©galement Ãªtre ouvertes, lues et Ã©tudiÃ©es. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/a4/p5/cs/a4p5cs2yfjtvgxb_3iud8b-xog4.jpeg"><br>
<b><sup><sub><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lien depuis la diapositive</font></font></a></sub></sup></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Ils sont sur GitHub, lÃ  j'ai mis en Ã©vidence deux fonctions importantes: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- canCacheFrame () - vÃ©rifier si ce cadre peut Ãªtre mis en cache.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- Dans diffÃ©rents objets de la page, tels qu'un Ã©lÃ©ment HTML ou une police, il existe des mÃ©thodes canSuspendForDocumentSuspension (). Cet objet est responsable de savoir s'il peut mettre en cache, geler ou non. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et un autre aspect important: WebKit propose des tests trÃ¨s pratiques. LÃ , directement dans le dossier LayoutTests / fast / history, sous la forme d'un petit html concis et compact, il y a des tests pour le travail de diffÃ©rentes API qui sont implÃ©mentÃ©es dans Safari avec bfcache. Ceci est un exemple vivant de la faÃ§on dont vous pouvez Ã©crire du code dans Safari avec ces API et comment elles affectent ou non si elles autorisent ou non les hits bfcache. TrÃ¨s intÃ©ressant Ã  voir.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/hx/r-/un/hxr-un8ehvr-zc5dqa_kgr4ieki.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De lÃ , j'ai appris que Safari Ã©crit Ã©galement toutes ses connaissances sur bfcache, toutes les fonctionnalitÃ©s, dans un journal de texte. </font><font style="vertical-align: inherit;">Mais, malheureusement, je n'ai jamais dÃ©couvert comment activer cette journalisation ou, si elle est activÃ©e, oÃ¹ trouver ce fichier sur le disque. </font><font style="vertical-align: inherit;">Si quelqu'un le sait, dites-moi, je vous en serai trÃ¨s reconnaissant.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chrome.</font></font></h3><br>
<img src="https://habrastorage.org/webt/8z/yv/b5/8zyvb5feibkmt6njztlfuxgipas.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme je l'ai dÃ©jÃ  dit, il y a encore du travail en cours, tout est fermÃ© sous le drapeau. Vous pouvez tÃ©lÃ©charger le nouveau Chrome Canary, allez aux drapeaux. Le rÃ©glage y est cachÃ© - vous pouvez essayer de jouer avec. Vous pourriez voir quelque chose. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/nu/fr/lw/nufrlwudx02dcxcxuwq0n-fk57e.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De l'intÃ©ressant - j'ai dÃ©jÃ  parlÃ© d'ouvrir une page via window.open (). Dans Chromium, ces pages ne sont pas mises en cache jusqu'Ã  prÃ©sent. Ils n'ont pas compris comment rÃ©soudre correctement tout cela, et l'ont coupÃ© sans vergogne, car dans Safari, leur conscience ne le leur permet pas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si DOMContentLoaded ne se produit pas, la page ne sera pas non plus mise en cache.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il existe de nombreuses nouvelles API qui commencent par Â«WebÂ» - elles sont Ã©galement difficiles et incomprÃ©hensibles avec elles, et jusqu'Ã  prÃ©sent, toutes dÃ©sactivent bfcache par dÃ©faut. Autrement dit, si quelque chose de branchÃ©, de nouveau est utilisÃ© sur la page, comme WebGL, WebVR, WebUSB, WebBluetooth, etc., une telle page n'entrera pas dans bfcache. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Travailleur de service. De plus, nous ne mettons pas encore en cache une telle page, mais nous prÃ©voyons de la traiter correctement, de la cacher aux yeux vigilants du technicien de service. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si la gÃ©olocalisation est activÃ©e, nous ne la mettons pas encore en cache. Si simple pour l'instant. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si pendant le temps oÃ¹ la page Ã©tait dans le cache, les cookies Ã©taient pourris, nous pensons qu'une sorte d'autorisation a expirÃ©. C'Ã©tait peut-Ãªtre des services bancaires en ligne ou autre chose. Cela signifie que la page n'est plus valide - nous la supprimons du cache. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ae/et/dj/aeetdjeogvqqqmflxx5rtdbtz1o.jpeg"><br>
<b><sup><sub><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lien depuis la diapositive</font></font></a></sub></sup></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les gars de Google sont allÃ©s encore plus loin. </font><font style="vertical-align: inherit;">Ils ont suggÃ©rÃ© que nous unifions tout formaliser, unifier dans tous les navigateurs, a proposÃ© une spÃ©cification du cycle de vie des pages pour tous les Ã©tats, a suggÃ©rÃ© d'ajouter de nouveaux Ã©vÃ©nements aux transitions entre les diffÃ©rents Ã©tats. </font><font style="vertical-align: inherit;">Vous pouvez regarder le lien qu'ils ont pensÃ© lÃ -haut. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/bl/nn/tw/blnntwl767kxalazcyls6lhx98c.jpeg"><br>
<b><sup><sub><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lien depuis la diapositive</font></font></a></sub></sup></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sources. </font><font style="vertical-align: inherit;">Comme vous le savez, des sources de chrome sont Ã©galement disponibles. </font><font style="vertical-align: inherit;">Tout cela rÃ©side dans une classe appelÃ©e BackForwardCacheImpl - trÃ¨s bonne dÃ©nomination, n'a presque pas eu Ã  chercher. </font><font style="vertical-align: inherit;">La principale mÃ©thode qui vÃ©rifie si un document peut Ãªtre enregistrÃ© s'appelle CanStoreDocument (). </font><font style="vertical-align: inherit;">Il existe Ã©galement une mÃ©thode GetDisallowedFeatures (), qui rÃ©pertorie simplement toutes les nouvelles fonctionnalitÃ©s et API qui ne sont pas prises en charge dans bfcache. </font><font style="vertical-align: inherit;">TrÃ¨s pratique: concentrÃ© en un seul endroit, lu et rÃ©alisÃ© ce qui est actuellement possible et ce qui ne peut pas Ãªtre utilisÃ©.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Internet Explorer 11</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une excursion dans l'histoire pour ceux qui ont encore IE 11. Pour ceux qui ont tout mal. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hw/st/sy/hwstsylp95mjeehn-yapop5nwqy.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il y a bfcache lÃ , et c'est le principal problÃ¨me, car il faut y faire face. </font><font style="vertical-align: inherit;">La documentation indique que bfcache ne fonctionne que sur HTTP. </font><font style="vertical-align: inherit;">En fait, en production, il fonctionne Ã©galement sur HTTPS pour une raison quelconque. </font><font style="vertical-align: inherit;">MoralitÃ©: si vous Ãªtes dÃ©veloppeur, faites attention Ã  votre documentation. </font><font style="vertical-align: inherit;">Ensuite, vous devez souffrir Ã  cause d'elle. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
S'il existe un gestionnaire beforeunload, il l'empÃªchera de pÃ©nÃ©trer dans le cache. </font><font style="vertical-align: inherit;">Ils n'ont rien dit au sujet du dÃ©chargement dans la documentation - peut-Ãªtre qu'ils ne le savaient pas ou l'ont oubliÃ©. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si la page n'a pas terminÃ© son chargement, elle n'est pas non plus mise en cache. </font><font style="vertical-align: inherit;">Si quelqu'un utilise des composants ActiveX, nous ne mettons pas non plus en cache. </font><font style="vertical-align: inherit;">Et si DevTools y est Ã©galement ouvert. </font><font style="vertical-align: inherit;">C'est un point important.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/8o/lh/n5/8olhn5ii0fctbxehrs7ab4blwro.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comment sans bugs? Champ persistant ajoutÃ©, mais parfois cela ne fonctionne pas. Autrement dit, la page pÃ©nÃ¨tre vraiment dans le cache, en revient et persiste n'est pas dÃ©finie sur true. Que faire? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avions un beau code qui dÃ©termine si nous sommes revenus du cache ou rechargÃ©s depuis le serveur. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/op/h1/xb/oph1xbddsxbkhzjlygiyoavtmam.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, il devait Ãªtre complÃ©tÃ© par une bÃ©quille pour IE. Nous dÃ©terminons que nous avons IE, et dans certaines solutions de contournement, nous comprenons que la page a nÃ©anmoins Ã©tÃ© extraite du cache et en mÃªme temps, nous avons eu une navigation dans l'historique (back_forward). </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ct/xe/af/ctxeafrbbmwt1h_9j16jw4fviji.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De plus, comment savoir si une page est mise en cache? Nous prenons son temps de chargement. S'il est chargÃ© Ã  partir du serveur en 50 millisecondes ou plus rapidement, cela ne peut pas Ãªtre dans IE - cela signifie qu'il provient du cache! :)</font></font><br>
<br>
<img src="https://habrastorage.org/webt/j-/ib/ch/j-ibchnxog-rdmeez6gmjnbmwr4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai dÃ©jÃ  mentionnÃ© la navigation dans l'histoire. </font><font style="vertical-align: inherit;">Si nous avons le type de navigation back_forward, alors nous avons parcouru l'historique, et si la page provient du cache, cela signifie bfcache, il n'y a pas d'autres options dans IE.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Et aprÃ¨s?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Que faire ensuite avec cette connaissance? </font><font style="vertical-align: inherit;">Je ne voudrais pas que vous sortiez et oubliez tout cela comme un cauchemar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- Tout d'abord, voici la chose la plus prÃ©cieuse que j'ai rencontrÃ©e et ce sur quoi je veux vous pousser: utilisez des navigateurs open source! </font><font style="vertical-align: inherit;">Dans le libre accÃ¨s Ã  Internet en ce moment sont le code source de tous les principaux navigateurs que nos clients utilisent. </font><font style="vertical-align: inherit;">Et c'est la documentation la plus pertinente sur comment et comment elle est prise en charge, oÃ¹ et comment cela fonctionne. </font><font style="vertical-align: inherit;">Y compris il y a des tests qui sont directement Ã©crits en HTML et JS. </font><font style="vertical-align: inherit;">Utilisez, regardez!</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- DeuxiÃ¨mement, considÃ©rez dans les applications existantes qu'elles peuvent s'exÃ©cuter dans bfcache. </font><font style="vertical-align: inherit;">Informez vos testeurs Ã  ce sujet afin que lorsqu'ils vÃ©rifient la navigation, ils sachent que lors de la navigation dans l'historique, la page peut Ãªtre ouverte Ã  la fois depuis le serveur et depuis bfcache. </font><font style="vertical-align: inherit;">Voici une vidÃ©o du vrai bug que nous avons corrigÃ© lorsque bfcache fonctionnait pour nous:</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ouvrir GIF</font></font></b><div class="spoiler_text"><img src="https://habrastorage.org/webt/vx/1j/dv/vx1jdv4ubukownlagrvftn30g6k.gif" width="400"></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'utilisateur entre quatre demandes, voit quatre problÃ¨mes. </font><font style="vertical-align: inherit;">AprÃ¨s cela, il revient en arriÃ¨re, voit le problÃ¨me 3 et la requÃªte 4. Un autre problÃ¨me prÃ©cÃ©dent est 2 et la requÃªte 3. C'est-Ã -dire qu'il a un Ã©tat incompatible de la page - le contenu de la recherche et les chaÃ®nes de recherche se contredisent. </font><font style="vertical-align: inherit;">Gardez cela Ã  l'esprit dans vos applications. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- Et troisiÃ¨mement, si vous Ã©crivez du nouveau code, pensez si vous avez besoin de bfcache. </font><font style="vertical-align: inherit;">Si tel est le cas, utilisez le tableau de compatibilitÃ© des API. </font><font style="vertical-align: inherit;">Sinon, ne l'utilisez pas, mais si vous entrez accidentellement dans bfcache, pensez aux fonctionnalitÃ©s de Safari et des autres navigateurs que j'ai mentionnÃ©s. </font><font style="vertical-align: inherit;">Certaines choses peuvent se dÃ©chirer insolemment et vous ne pourrez pas comprendre pourquoi cela se produit. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme promis, un </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lien</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> vers les matÃ©riaux.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr496348/index.html">Ã‰tudes de cas sur l'API de stockage Web</a></li>
<li><a href="../fr496350/index.html">Vous ne pouvez pas passer! - Les imprimantes 3D rÃ©pondent au coronavirus</a></li>
<li><a href="../fr496354/index.html">Programmation informatique ternaire: jouer avec l'Ã©mulateur</a></li>
<li><a href="../fr496356/index.html">CrÃ©ation d'un navigateur Ã  l'aide de technologies de rÃ©alitÃ© augmentÃ©e et de mÃ©thodes d'apprentissage automatique</a></li>
<li><a href="../fr496358/index.html">Se prÃ©parer Ã  cÃ©lÃ©brer la JournÃ©e de la cosmonautique en ligne (la liste est en cours de mise Ã  jour)</a></li>
<li><a href="../fr496362/index.html">RÃ©initialisation des masques</a></li>
<li><a href="../fr496366/index.html">MinisÃ©rie: ordinateur ternaire Ã  faire soi-mÃªme</a></li>
<li><a href="../fr496368/index.html">Une startup australienne dÃ©veloppe un PC hybride Ã  partir de composants Ã©lectroniques et biologiques</a></li>
<li><a href="../fr496370/index.html">Joies et chagrins de victoires sur C: nous fabriquons des bonbons Ã  partir du prototype wc sur Haskell</a></li>
<li><a href="../fr496372/index.html">Comment crÃ©er une vue personnalisÃ©e pour alert (), confirm () et prompt () pour une utilisation en JavaScript</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>