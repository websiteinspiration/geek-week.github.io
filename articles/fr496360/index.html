<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🏉 🚁 🧑🏼‍🤝‍🧑🏼 BFCache ou Là et retour. Rapport Yandex 💅🏼 🧝🏿 💾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Les gens utilisent le bouton de retour à la page précédente dans le navigateur très souvent - peut-être plus souvent que vous ne le pensez. Et si oui,...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>BFCache ou Là et retour. Rapport Yandex</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yandex/blog/496360/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les gens utilisent le bouton de retour à la page précédente dans le navigateur très souvent - peut-être plus souvent que vous ne le pensez. </font><font style="vertical-align: inherit;">Et si oui, alors pourquoi jeter immédiatement la page hors de la mémoire du navigateur, et après une seconde passer du temps et du trafic à la rouvrir? </font><font style="vertical-align: inherit;">Afin que l'utilisateur puisse revenir rapidement en arrière, la technologie BFCache a été inventée, ce qu'il est important de retenir lors du développement des interfaces. </font><font style="vertical-align: inherit;">Victor Khomyakov</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">victor-homyakov</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> compris la "mise en cache aller-retour" et compilé une table de compatibilité BFCache avec différentes API.</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/vz2IsHcSaKE" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- Bonjour, je m'appelle Victor. </font><font style="vertical-align: inherit;">Je travaille au sein d'une équipe assez importante qui s'occupe de la page de recherche.</font></font><br>
<a name="habracut"></a><br>
<img src="https://habrastorage.org/webt/ai/mc/ut/aimcutfjg_xnumc1xre2li547vw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Au minimum, vous avez déjà vu la même page ou une page similaire sur Google. Et en particulier, je traite le problème de la vitesse de téléchargement de cette page - afin qu'elle s'affiche sur le serveur le plus rapidement possible et se télécharge et s'affiche aux clients le plus rapidement possible. Pourquoi c'est important? Moins le client attend que votre page se charge, moins il est probable qu'il n'attendra pas et ne vous quittera pas. Et plus il est probable que le client réussira à se convertir à quelque chose d'autre, plus le score net de promotion sera élevé. Autrement dit, le client se fera un plaisir de dire à tout le monde qu'il sait que c'est une page géniale géniale - elle se charge très rapidement, elle est très pratique à utiliser. Et finalement, plus vous gagnez d'argent. Ou votre entreprise, alors elle vous donnera un prix.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je vais donner un certain nombre d'exemples d'entreprises bien connues. Google a mené une expérience. Ils ont intentionnellement intégré un retard sur la page de recherche et mesuré comment cela affecte les performances. Il s'est avéré qu'en moyenne, il y avait un demi pour cent de recherches en moins par utilisateur. Qu'est-ce qu'un demi pour cent? Calculer: un demi pour cent de centaines de millions d'utilisateurs de Google est un nombre assez important. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bing a fait la même expérience. Ils ne croyaient pas Google, ils ont décidé de revérifier. Ils ont obtenu des résultats similaires: sensiblement moins de revenus par utilisateur lorsque la page ralentit. Pourquoi ralentir? Parce qu'il est plus facile de ralentir la page du nombre exact de millisecondes afin qu'elle puisse être facilement reproduite en production que de l'accélérer de la même quantité.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Exemple sur AliExpress. Ils ont accéléré leur site de 36% et reçu beaucoup plus de commandes des utilisateurs. Les commandes sont en argent direct. En général, il est déjà clair pour tout le monde que la vitesse est assez importante, elle affecte, à travers un certain nombre de métriques, l'argent gagné. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et encore un facteur. Aujourd'hui, nous </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">avons</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> déjà </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">parlé</font></a><font style="vertical-align: inherit;"> de l'optimisation d'image. En optimisant votre trafic, en réduisant le nombre de téléchargements, vous payez moins d'argent à vos hébergeurs pour le trafic sortant. C'est aussi l'argent qui restera dans votre poche. Et si je vous offre soudainement une remise de 10% sur le trafic de n'importe quel hôte sans aucune restriction ni condition? Et si je propose de m'assurer que la part de vos pages - par exemple, dix pour cent - est chargée par l'utilisateur presque instantanément? Personne ne refusera.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La technologie dont j'essaierai de parler aujourd'hui est l'une des solutions possibles qui impose peu de restrictions sur la pile avec laquelle vous travaillez, sur quelles technologies, mais promet en même temps de vous apporter des gains assez importants. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour commencer, Google collecte des statistiques sur la façon dont ces navigateurs sont utilisés dans leurs navigateurs. Et ils ont publié un tel nombre: il s'avère que, en moyenne, de toutes les ouvertures de pages, de toute la navigation dans Chrome mobile, environ 19% est un mouvement de va-et-vient à travers l'histoire. Pensez à ce que cela signifie? Si vous arrondissez, il s'avère que 20% de la navigation se déplace vers la page où l'utilisateur vient d'être.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour nous, comme pour les auteurs des pages, cela signifie: même si l'utilisateur le quitte, il y a de fortes chances qu'il soit sur le point de revenir. D'une part, cela peut être précisément le problème des téléphones portables: tout est petit, il est facile de rater un doigt, cliquez sur le lien et quittez la page, puis dites: "Oh enfer! Je veux retourner". Mais sur les ordinateurs de bureau, la situation est à peu près la même: là, le nombre est moindre, mais il y a quand même un pourcentage important de retours. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Que faisons-nous en ce moment? Nous passons inefficacement sur le temps et le trafic des utilisateurs. Autrement dit, nous commençons à recharger la même page en arrière, à l'analyser, à recréer le DOM, à tout redessiner à l'écran, à charger, à exécuter JavaScript.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le navigateur est une chose assez puissante. Il essaie d'utiliser des caches dans la mesure du possible. Et la plupart des ressources peuvent être dans son cache. Il ne les attendra pas sur le réseau, mais les récupérera directement dans le cache. Par exemple, dans le moteur V8, le résultat de l'analyse JavaScript est également mis en cache. Autrement dit, le navigateur ne rechargera pas et n'analysera pas JS, et dans la plupart des cas, il faudra pour l'exécuter immédiatement. Mais tout de même, la reconstruction du DOM, le rechargement des ressources non mises en cache et l'exécution de JS prennent beaucoup de temps. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La solution se suggère. Qu'est-ce que nous faisons? Nous, lorsque l'utilisateur quitte notre page, ne la nettoyons pas immédiatement. Nous sauvegardons simplement son état et le cachons visuellement à l'utilisateur afin que sous le capot il reste à la disposition du navigateur.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Que ferons-nous si l'utilisateur décide de revenir? </font><font style="vertical-align: inherit;">Montrez-lui simplement la même page enregistrée. </font><font style="vertical-align: inherit;">Il peut être affiché presque instantanément. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ax/xm/7d/axxm7doualef_atc2j8_ufybr2i.gif"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cette technologie est appelée cache arrière / avant, à partir des mots «va-et-vient». </font><font style="vertical-align: inherit;">Abréviation de bfcache. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici un exemple de la façon dont le même navigateur, le même assembly, se comporte lorsque bfcache est éteint et allumé. </font><font style="vertical-align: inherit;">L'ouverture de la première page est tout aussi lente ici et là. </font><font style="vertical-align: inherit;">Mais de plus, lorsque nous commençons à nous déplacer d'avant en arrière dans l'histoire, une pause est perceptible à gauche, et pas à droite. </font><font style="vertical-align: inherit;">A gauche, le mouvement habituel à travers l'histoire prend du temps. </font><font style="vertical-align: inherit;">A droite, tout se passe très, très vite.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Afficher le GIF</font></font></b><div class="spoiler_text"><img src="https://habrastorage.org/webt/lf/0n/h1/lf0nh1gnji5qf1w9kj_irqcagrm.gif" width="350"><img src="https://habrastorage.org/webt/og/ca/_n/ogca_ny6xmytv-_iqvdl4xslpcq.gif" width="350"></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un exemple similaire de notre recherche. À gauche se trouve le Safari habituel sur macOS avec bfcache désactivé, à droite se trouve le même Safari avec les paramètres par défaut et bfcache activé. C'est un cas assez courant: une personne vient à la recherche, peut ne pas savoir exactement ce qu'elle cherche, peut demander plusieurs options de requête. J'ai demandé la première demande - quelque chose ne va pas. La deuxième demande semble meilleure. Troisièmement - non, pire, revenez à la demande précédente. Et en ce moment ce serait bien de ne pas le faire attendre. Il vient de voir cette demande précédente, montrez-la tout de suite.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ou la deuxième option, si vous avez la pagination et plusieurs pages sur le problème. Homme feuilletant la question. Je suis allé à la deuxième, troisième, quatrième page, j'ai regardé - non, il y a un problème, je reviens. Et nous, encore une fois, pouvons lui montrer les pages précédentes presque instantanément. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un problème important est la sécurité. Bien que la page sur laquelle l'utilisateur n'était pas dans un état masqué, il peut accéder à diverses API qui vous permettent de lire l'état matériel de votre téléphone ou ordinateur. Voici une courte liste de ce qui m'est immédiatement venu à l'esprit: géolocalisation, modification de la position de votre appareil dans l'espace, accès à la caméra et son du microphone.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, lorsque la page apparaît, il est important qu'elle n'accède pas à tous les événements qui se sont produits pendant la période où elle a été masquée. </font><font style="vertical-align: inherit;">Sinon, un canal supplémentaire s'ouvrira pour espionner les utilisateurs. </font><font style="vertical-align: inherit;">Il est important qu'elle n'obtienne pas un historique de vos mouvements pendant tout ce temps et des enregistrements du microphone et de la caméra. </font><font style="vertical-align: inherit;">Les développeurs de navigateurs ne doivent pas non plus l'oublier.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Support API et navigateur</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Plus proche du sujet. Supposons que je vous ai déjà convaincu, vous êtes: "Oui, un bon sujet, nous devons travailler avec cela." Quelles API avons-nous à notre disposition, avec quoi pouvons-nous travailler si nous acceptons de prendre en compte bfcache, et comment cela est-il pris en charge par les navigateurs? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Où bfcache existe-t-il déjà, où puis-je le voir? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- Il a longtemps été implémenté dans les navigateurs Firefox, Safari (et macOS et iOS), ainsi que dans Internet Explorer 11 (!). Habituellement, nous réprimandons les développeurs Microsoft, mais ici, ils ont juste essayé. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- Il est implémenté dans le navigateur UC Browser 11/12, version pour Android. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- Du coup, il n'est plus dans Chrome. Et dans Chromium, cette fonctionnalité est en cours de développement.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/_v/dh/yq/_vdhyq6ph84lnnb05f2ffw75ud4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainsi, lorsqu'ils le font dans Chromium, presque tous ces navigateurs (et ce n'est pas une liste complète) obtiendront tôt ou tard cette fonctionnalité - gratuitement, sans SMS et sans inscription. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Existe-t-il une sorte d'API? Je veux gérer bfcache, je veux l'activer et le désactiver directement à partir de JavaScript, pour savoir s'il y a une page dans bfcache ou non. Que diriez-vous d'une telle API? Il n'y a pas une telle API. Et cela a été fait consciemment: la page ne devrait pas vouloir activer ou désactiver bfcache pour tout le monde et pour elle-même. Ou découvrez s'il y a quelqu'un dans ce bfcache ou non. Tout cela est dû à la sécurité. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/4m/5i/ra/4m5iragmxqrikl_7i8dqp-0ijcy.jpeg"><br>
<b><sup><sub><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lien depuis la diapositive</font></font></a></sub></sup></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais qu'avons-nous? Types de navigation. Il existe un type de lien - prérendeur de lien, lorsque nous voulons afficher une page à l'avance. Il existe pour lui un type de navigation particulier: cette page s'ouvrira avec le «Prerender» NavigationType. Si nous ouvrons simplement la page dans un navigateur, il y aura alors «naviguer». Si nous cliquons sur le bouton «Mettre à jour», ce sera «recharger». </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous sommes intéressés par le type de navigation «back_forward» ici, cela indique clairement que l'utilisateur s'est déplacé d'avant en arrière dans l'histoire. C'est exactement le type de navigation avec lequel notre bfcache peut fonctionner.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ud/8o/o_/ud8oo_rhzpnyzjfdymvr11pfg4i.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une autre API est les événements pageshow pagehide. Ils existaient déjà dans les navigateurs. En conséquence, pageshow est déclenché lorsque votre page est affichée dans le navigateur pour l'utilisateur, pagehide est déclenchée lorsque la page se cache pour une raison quelconque. Et ils ont été complétés par le champ persistant. Si la page se cache et en même temps sera placée dans bfcache, le champ persistant sera vrai. Si la page s'affiche lors de son élévation à partir de bfcache, le champ persistant sera à nouveau vrai. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par conséquent, si le navigateur ne va pas mettre en cache la page, le masquage de page restera faux. Et si le navigateur affiche la page pendant le chargement normal, ou s'il n'utilise pas bfcache, alors pageshow persistera également faux. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/7v/kh/kh/7vkhkhw8tjkz6y10o97urigdhea.jpeg"><br>
<b><sup><sub><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lien depuis la diapositive</font></font></a></sub></sup></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La prise en charge des événements est disponible dans presque tous les navigateurs, même ceux qui ne prennent pas encore en charge bfcache. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/om/6w/7h/om6w7hjxxswbq5uvpaiu-afe5to.jpeg"><br>
<b><sup><sub><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lien depuis la diapositive</font></font></a></sub></sup></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Il en va de même pour le champ persistant. Il existe déjà dans Chrome et Chrome ne prend toujours pas en charge bfcache. Autrement dit, ce champ sera toujours dedans, mais pour l'instant il sera faux. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quand je suis tombé sur ce phénomène, bfcache, j'ai dû l'étudier, taper de tous les côtés, regarder comment ça marche. J'ai immédiatement voulu voir sur ma page lorsque j'ouvre la valeur du champ persistant dans mes gestionnaires.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/dx/k6/qe/dxk6qegw2k1ohv-osipeghzjccw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il semblerait que tout soit assez simple. J'ai écrit un gestionnaire et sorti sur console.log () ce qui m'arrive. Mais lors de l'ouverture de DevTools dans certains navigateurs, bfcache peut soudainement s'arrêter. Autrement dit, j'ai ouvert DevTools, je fais des allers-retours dans les pages, et ma persistance est toujours fausse, la page n'entre pas dans bfcache. D'accord, j'ai un autre outil puissant - alerte. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais non. Les navigateurs modernes lors du déchargement d'une page dans le masque de page, avant et après le déchargement ignorent simplement l'alerte, cela ne fonctionne tout simplement pas. Et encore une fois, je ne vois pas ce que je veux. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/by/1b/ij/by1bijibkuzglk6vvkhbcvrmmgo.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
D'accord, j'ai un produit encore plus tueur. Je suis dans un bloc directement sur ma propre page, que j'explore, en ajoutant simplement le texte du contenu de mon événement et en enregistrant ainsi tout. Cette méthode a fonctionné.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/jw/xt/o1/jwxto1ndmuldxtn4hpoa_3z6-bk.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout, s'il vous plaît, peut être utilisé. J'ai débogué mon code, ça marche pour moi, je peux continuer à continuer. Bien sûr, je n'oublie pas qu'après tout, un script statique externe est mieux adapté pour ne pas charger le même code en ligne sur la page, mais pour utiliser la mise en cache des fichiers. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai mis ce code débogué dans un script externe. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/x1/5m/s0/x15ms0a9q4solt69-vucvdyoqgu.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais non, les gestionnaires de pageshowhide sont tombés dans Safari! Pour une raison quelconque, ils ne fonctionnent pas à partir d'un script externe. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
D'accord, j'ai déjà une version fonctionnelle. J'ai dû le laisser comme ça.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/td/kq/aw/tdkqawklgz4m_mdw7d_elw7a27m.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je vais énumérer brièvement ce que j'ai réussi à marcher en une seule journée. Tout d'abord, DevTools peut désactiver la mise en cache. Vous vous souvenez probablement que dans DevTools sur l'onglet Réseau dans Chrome, il y a une case à cocher "Désactiver le cache". Il désactive le cache réseau, il ne peut pas affecter bfcache, ou il peut. L'analogie est claire: nous avons ouvert DevTools, ce qui signifie que nous développons et que nous n'avons peut-être pas besoin de mise en cache. Peut-être que cela nous dérange. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/4d/up/mb/4dupmbrpcewpmpngg49_fddhuf4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La deuxième caractéristique est l'alerte. Firefox et Safari l'ignoreront en silence et continueront à exécuter les gestionnaires plus loin, comme s'il n'y avait pas d'alerte. Et un seul bon vieux Chrome dans la console écrira une erreur en rouge - vous avez une alerte, je l'ai bloquée, sachez-la! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Encore une fois, je vous rappelle que les gestionnaires d'un script externe dans Safari ne peuvent pas être appelés, c'est très étrange.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et une autre nouvelle importante. </font><font style="vertical-align: inherit;">Si votre page est mise en cache, c'est-à-dire que vous avez reçu un événement de masquage de page, et il dit persisté vrai, et le navigateur vous dit: "Oui, je l'ai mis dans le cache" - cela ne donne aucune garantie que la page sera plus tard à partir de ce cache est levé et affiché à l'utilisateur. </font><font style="vertical-align: inherit;">Parce que le navigateur peut décider d'effacer ce cache s'il manque de mémoire. </font><font style="vertical-align: inherit;">Parce que l'utilisateur peut fermer le navigateur et ne naviguer nulle part. </font><font style="vertical-align: inherit;">N'oubliez pas cela.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Caractéristiques d'implémentation</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai commencé à approfondir la documentation, à rechercher comment vivre avec ces connaissances. Étonnamment, la documentation était. Autrement dit, vous pouvez trouver sur Internet une description du fonctionnement de bfcache dans les navigateurs. Mais, plus je lis, plus les différences s'accumulent entre les différents navigateurs. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans l'un, ça marche comme ça, dans l'autre ça marche. Dans l'un, l'un interfère, l'autre n'interfère pas. Les développeurs ne savent pas comment traiter correctement un certain nombre d'API lors du placement d'une page dans bfcache. Ils disent: ok, si la page utilise cette API, je l'ignore, je ne la mets en aucun cas dans le cache. Et cette liste est différente selon les navigateurs, chacun fait ce qui lui convient. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et puis j'ai commencé à combiner ce que j'ai appris en une seule table. J'ai quelque chose comme ceci:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/9v/qm/iy/9vqmiyq_zcjwc5ln8nciv8golra.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai lu la documentation des navigateurs - pour Firefox, Safari, la famille Chromium. Il y avait de la documentation disponible sur IE, bien que dépassée. Nous programmeurs n'aimons pas mettre à jour la documentation après des changements dans le navigateur? Quand j'ai réalisé que les informations étaient obsolètes, j'ai commencé à tester mes petites pages dans les navigateurs et à vérifier quelle API fonctionnait et laquelle ne fonctionnait pas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cela ne suffisait pas non plus: je ne sais pas quelles API examiner en principe, mais pas pour tout trier du tout? Et j'ai dû examiner le code source des moteurs de navigateur eux-mêmes, c'est-à-dire que le code s'est avéré être la source de connaissances la plus précise et la plus fiable. Pour le moment, cette plaque (devant vous en est une partie, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">voici un lien</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> vers la version complète) est la collection la plus complète de connaissances sur les API qui autorisent ou interdisent à bfcache de fonctionner dans les navigateurs.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les API qui n'interfèrent pas avec une coche et une couleur verte, celles qui empêcheront définitivement la page d'entrer dans bfcache sont marquées en rouge. </font><font style="vertical-align: inherit;">Les champs blancs sont des espaces qui ne sont décrits nulle part.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Firefox</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici quelques détails intéressants de navigateurs spécifiques. Je vais commencer par Firefox, il a été le premier à tout faire. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/fh/bt/fh/fhbtfhn8db-lqcxhqe8n8vm8z6u.jpeg"><br>
<b><sup><sub><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lien depuis la diapositive</font></font></a></sub></sup></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
La chose la plus importante que j'ai apprise des sources de Firefox est que lorsque vous travaillez avec bfcache, il peut écrire dans le journal de texte sur le disque toutes les raisons pour lesquelles il ne peut pas mettre la page dans le cache. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/dd/xp/jr/ddxpjraedcefaftwi0u9cdys2tg.jpeg"><br>
<b><sup><sub><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lien depuis la diapositive</font></font></a></sub></sup></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Et j'ai même réussi à savoir comment le faire. Il y a deux variables d'environnement secrètes: dans l'une, nous indiquons ce qu'il faut enregistrer, dans la seconde - dans quel fichier écrire un journal. Après cela, nous lançons le binaire, et le tour est joué! Nous verrons approximativement que sur la diapositive précédente, les lignes du formulaire «un tel html ne peut pas être mis en cache pour une telle raison, telle pour une autre raison». Nous pouvons le lire tout de suite, très pratique.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ci/_u/3m/ci_u3mrg5k5um_zah0gtm7splmy.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous souhaitez tester une fois, vous pouvez ouvrir la page about: networking dans Firefox. Là, vous pouvez entrer les mêmes champs dans la section "Journal". Nous pouvons indiquer dans deux champs quoi et où se connecter, et avec les boutons démarrer et arrêter le journal. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/w3/8s/zb/w38szbgmjgikrkqg-2f7tt6px0a.jpeg"><br>
<b><sup><sub><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lien depuis la diapositive</font></font></a></sub></sup></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Quand Firefox refuse-t-il de mettre en cache la page? Si vous avez des demandes incomplètes, y compris des demandes AJAX ou des demandes de ressources telles que des images, alors il refusera de mettre la page en bfcache. Il pense que ce n'est pas terminé, n'a pas fini de télécharger, il y a une sorte d'activité suspecte. Mais tout cela ne s'applique pas au favicon. Si vous avez oublié le favicon, s'il ne se charge pas, il pense - d'accord, il le fera, c'est normal pour votre site.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous avez un script de longue durée, le navigateur vous demandera: comme cela prend du temps, bloque l'interface utilisateur, peut-être le battre? Et si vous êtes d'accord, une telle page est considérée comme un peu fausse et nous ne la mettons pas en cache.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous utilisez IndexedDB ... Ceci est une histoire instructive. Auparavant, dans la première implémentation, ils avaient l'air: si vous avez IndexedDB et qu'il y a une transaction incomplète, alors une telle page n'est pas mise en cache, car il n'est pas clair comment travailler avec elle (nous essayons de la cacher en plein milieu de la transaction). Mais ils ont simplement perdu ce morceau de code lors de la refactorisation. Et comme vous pouvez l'imaginer, ils n'avaient pas de tests pour cela. Ils ont même un bug dans le bugtracker. Il a déjà deux ans avec quelque chose. Les gens ont écrit: "Mon bfcache avec IndexedDB ne fonctionne pas correctement, que dois-je faire?" Les développeurs de Firefox ont répondu - il tombe vraiment en panne, nous venons de perdre ce morceau de texte lors du refactoring, d'accord, laissez-le continuer. Moralité: écrivez des tests, même si vous écrivez Firefox, sinon tout peut malheureusement se terminer.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et un autre facteur intéressant de non-disponibilité dans bfcache - si le contenu mixte est explicitement autorisé. Ce que c'est? </font></font><br>
<br>
<img src="https://habrastorage.org/webt/fm/2s/le/fm2sleys4nir1cuff_lw8q87cqi.jpeg"><br>
<b><sup><sub><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lien depuis la diapositive</font></font></a></sub></sup></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Supposons que votre page s'ouvre via HTTPS, mais que vous chargez toujours certaines ressources via HTTP, en particulier des scripts. Autrement dit, vous avez un script non sécurisé, il peut être modifié par n'importe qui. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ts/k8/kj/tsk8kj6weynueewx9goi38sm81o.jpeg"><br>
<b><sup><sub><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lien à partir de la diapositive</font></font></a></sub></sup></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Par défaut, Firefox, comme les autres navigateurs, n'exécute pas un tel script sans sécurité maintenant. Mais si c'est très important pour vous, vous êtes monté dans les paramètres et avez autorisé son exécution, puis, en conséquence, il ne mettra pas en cache une telle page. Il dira - eh bien, vous m'avez dit de ne pas exécuter le code, mais non, non!</font></font><br>
<br>
<img src="https://habrastorage.org/webt/pm/fg/_f/pmfg_fqywdhl7tihvcy09agmaxy.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un autre ajustement est la taille de bfcache lui-même. Ici, la valeur par défaut est moins un. Cela signifie la quantité de mémoire de Firefox, autant de pages qu'il tente de mettre en cache. Mais nous pouvons forcer la désactivation du cache en mettant un zéro ou en définissant explicitement un nombre - par exemple, n'oubliez pas plus de cinq pages. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Avertissement: la diapositive suivante contient un exemple de code dans le langage effrayant C ++, cela peut être dangereux lors d'une conférence front-end. N'essayez pas de le copier, exécutez-le dans la console du navigateur. Votre disque peut être formaté, l'écran peut exploser ou des bitcoins peuvent être extraits. Je t'avais prévenu. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/31/l-/uo/31l-uokshfiuo6dyxcivmfzsm5o.jpeg"><br>
<b><sup><sub><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lien depuis la diapositive</font></font></a></sub></sup></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Donc, le code Gecko. </font><font style="vertical-align: inherit;">Il peut être ouvert, lu, consulté gratuitement sur Internet. </font><font style="vertical-align: inherit;">Et j'ai fouillé. </font><font style="vertical-align: inherit;">Il existe la méthode la plus importante - CanSavePresentation (), elle répond à la question: est-il possible de mettre en cache ce document? </font><font style="vertical-align: inherit;">Autrement dit, c'est la source ultime de vérité sur ce qui est maintenant implémenté dans Firefox. </font><font style="vertical-align: inherit;">Et pourtant - c'est à partir de là que j'ai appris que vous pouvez lire le journal. </font><font style="vertical-align: inherit;">Il existe une telle variable - gPageCacheLog. </font><font style="vertical-align: inherit;">Ceci est le journal dans lequel tout est écrit. </font><font style="vertical-align: inherit;">Voici une histoire tellement intéressante sur une excursion en C ++. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est-à-dire que vous ouvrez le lien, regardez le code, recherchez (il y a une recherche pratique et, en plus, rapide) et vous pouvez trouver les détails d'implémentation réels dans la dernière version du navigateur - ceux qui manquent simplement dans la documentation.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Safari</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La chose la plus cruelle que fait Safari lorsqu'une page apparaît sur bfcache: si vous avez des demandes AJAX en attente, Safari les tue. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vp/bh/8p/vpbh8ppqy9qpfbpljjsu2huhtda.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Même si vous les superposez avec des gestionnaires d'erreurs et essayez de tout vérifier, corrigez-le - il semble que la demande n'existe pas du tout. Après avoir récupéré de bfcache, vous n'aurez aucune erreur, aucun «OK», rien du tout. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ic/jx/yk/icjxykful4yo0d7hbjopj_woljo.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les gestionnaires de pageshow pagehide, comme je l'ai dit, dans Safari ne sont appelés que s'ils sont écrits dans un script en ligne dans la page. À partir d'un script externe, ils peuvent ou non fonctionner - quelle chance. Mais je vous ai prévenu.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/0i/o7/ns/0io7nsvts4isj0qbirjisggubeg.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Autre différence intéressante: les gestionnaires beforeunload et unload n'interfèrent pas avec l'entrée de la page dans bfcache. Dans ce cas, beforeunload est toujours appelé, et quand il entre dans le cache, et lorsqu'il n'est pas touché. Mais décharger lorsque la page atteint le cache n'est pas appelé. Et voici un autre rake localisé: la page peut aller dans le cache et ne jamais en apparaître, et si vous avez écrit un code important en déchargement, il ne sera jamais appelé, bien qu'aucune erreur ne se soit produite sur la page. Autrement dit, il est allé correctement dans le cache, et de là vers nulle part, et votre déchargement ne sera jamais appelé.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/6e/m2/xy/6em2xyin9409en33_y-xk3ewxtg.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un autre point intéressant. Comme vous le savez, vous pouvez ouvrir plusieurs fenêtres via window.open (). Et en même temps, ces fenêtres ont des liens entre elles. Autrement dit, ils peuvent simultanément grimper dans la fenêtre de l'autre, lire / écrire différentes propriétés. Cette ouverture des fenêtres enfants n'interfère pas avec bfcache. Et ici, très probablement, Safari est tout aussi cruel qu'avec les demandes AJAX, c'est-à-dire que tout se déchire et au revoir. Les développeurs d'Apple l'aiment plus. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Encore une minute en C ++! Les sources WebKit ne sont pas non plus secrètes, elles peuvent également être ouvertes, lues et étudiées. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/a4/p5/cs/a4p5cs2yfjtvgxb_3iud8b-xog4.jpeg"><br>
<b><sup><sub><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lien depuis la diapositive</font></font></a></sub></sup></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Ils sont sur GitHub, là j'ai mis en évidence deux fonctions importantes: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- canCacheFrame () - vérifier si ce cadre peut être mis en cache.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- Dans différents objets de la page, tels qu'un élément HTML ou une police, il existe des méthodes canSuspendForDocumentSuspension (). Cet objet est responsable de savoir s'il peut mettre en cache, geler ou non. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et un autre aspect important: WebKit propose des tests très pratiques. Là, directement dans le dossier LayoutTests / fast / history, sous la forme d'un petit html concis et compact, il y a des tests pour le travail de différentes API qui sont implémentées dans Safari avec bfcache. Ceci est un exemple vivant de la façon dont vous pouvez écrire du code dans Safari avec ces API et comment elles affectent ou non si elles autorisent ou non les hits bfcache. Très intéressant à voir.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/hx/r-/un/hxr-un8ehvr-zc5dqa_kgr4ieki.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De là, j'ai appris que Safari écrit également toutes ses connaissances sur bfcache, toutes les fonctionnalités, dans un journal de texte. </font><font style="vertical-align: inherit;">Mais, malheureusement, je n'ai jamais découvert comment activer cette journalisation ou, si elle est activée, où trouver ce fichier sur le disque. </font><font style="vertical-align: inherit;">Si quelqu'un le sait, dites-moi, je vous en serai très reconnaissant.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chrome.</font></font></h3><br>
<img src="https://habrastorage.org/webt/8z/yv/b5/8zyvb5feibkmt6njztlfuxgipas.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme je l'ai déjà dit, il y a encore du travail en cours, tout est fermé sous le drapeau. Vous pouvez télécharger le nouveau Chrome Canary, allez aux drapeaux. Le réglage y est caché - vous pouvez essayer de jouer avec. Vous pourriez voir quelque chose. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/nu/fr/lw/nufrlwudx02dcxcxuwq0n-fk57e.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De l'intéressant - j'ai déjà parlé d'ouvrir une page via window.open (). Dans Chromium, ces pages ne sont pas mises en cache jusqu'à présent. Ils n'ont pas compris comment résoudre correctement tout cela, et l'ont coupé sans vergogne, car dans Safari, leur conscience ne le leur permet pas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si DOMContentLoaded ne se produit pas, la page ne sera pas non plus mise en cache.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il existe de nombreuses nouvelles API qui commencent par «Web» - elles sont également difficiles et incompréhensibles avec elles, et jusqu'à présent, toutes désactivent bfcache par défaut. Autrement dit, si quelque chose de branché, de nouveau est utilisé sur la page, comme WebGL, WebVR, WebUSB, WebBluetooth, etc., une telle page n'entrera pas dans bfcache. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Travailleur de service. De plus, nous ne mettons pas encore en cache une telle page, mais nous prévoyons de la traiter correctement, de la cacher aux yeux vigilants du technicien de service. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si la géolocalisation est activée, nous ne la mettons pas encore en cache. Si simple pour l'instant. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si pendant le temps où la page était dans le cache, les cookies étaient pourris, nous pensons qu'une sorte d'autorisation a expiré. C'était peut-être des services bancaires en ligne ou autre chose. Cela signifie que la page n'est plus valide - nous la supprimons du cache. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ae/et/dj/aeetdjeogvqqqmflxx5rtdbtz1o.jpeg"><br>
<b><sup><sub><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lien depuis la diapositive</font></font></a></sub></sup></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les gars de Google sont allés encore plus loin. </font><font style="vertical-align: inherit;">Ils ont suggéré que nous unifions tout formaliser, unifier dans tous les navigateurs, a proposé une spécification du cycle de vie des pages pour tous les états, a suggéré d'ajouter de nouveaux événements aux transitions entre les différents états. </font><font style="vertical-align: inherit;">Vous pouvez regarder le lien qu'ils ont pensé là-haut. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/bl/nn/tw/blnntwl767kxalazcyls6lhx98c.jpeg"><br>
<b><sup><sub><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lien depuis la diapositive</font></font></a></sub></sup></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sources. </font><font style="vertical-align: inherit;">Comme vous le savez, des sources de chrome sont également disponibles. </font><font style="vertical-align: inherit;">Tout cela réside dans une classe appelée BackForwardCacheImpl - très bonne dénomination, n'a presque pas eu à chercher. </font><font style="vertical-align: inherit;">La principale méthode qui vérifie si un document peut être enregistré s'appelle CanStoreDocument (). </font><font style="vertical-align: inherit;">Il existe également une méthode GetDisallowedFeatures (), qui répertorie simplement toutes les nouvelles fonctionnalités et API qui ne sont pas prises en charge dans bfcache. </font><font style="vertical-align: inherit;">Très pratique: concentré en un seul endroit, lu et réalisé ce qui est actuellement possible et ce qui ne peut pas être utilisé.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Internet Explorer 11</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une excursion dans l'histoire pour ceux qui ont encore IE 11. Pour ceux qui ont tout mal. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hw/st/sy/hwstsylp95mjeehn-yapop5nwqy.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il y a bfcache là, et c'est le principal problème, car il faut y faire face. </font><font style="vertical-align: inherit;">La documentation indique que bfcache ne fonctionne que sur HTTP. </font><font style="vertical-align: inherit;">En fait, en production, il fonctionne également sur HTTPS pour une raison quelconque. </font><font style="vertical-align: inherit;">Moralité: si vous êtes développeur, faites attention à votre documentation. </font><font style="vertical-align: inherit;">Ensuite, vous devez souffrir à cause d'elle. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
S'il existe un gestionnaire beforeunload, il l'empêchera de pénétrer dans le cache. </font><font style="vertical-align: inherit;">Ils n'ont rien dit au sujet du déchargement dans la documentation - peut-être qu'ils ne le savaient pas ou l'ont oublié. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si la page n'a pas terminé son chargement, elle n'est pas non plus mise en cache. </font><font style="vertical-align: inherit;">Si quelqu'un utilise des composants ActiveX, nous ne mettons pas non plus en cache. </font><font style="vertical-align: inherit;">Et si DevTools y est également ouvert. </font><font style="vertical-align: inherit;">C'est un point important.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/8o/lh/n5/8olhn5ii0fctbxehrs7ab4blwro.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comment sans bugs? Champ persistant ajouté, mais parfois cela ne fonctionne pas. Autrement dit, la page pénètre vraiment dans le cache, en revient et persiste n'est pas définie sur true. Que faire? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avions un beau code qui détermine si nous sommes revenus du cache ou rechargés depuis le serveur. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/op/h1/xb/oph1xbddsxbkhzjlygiyoavtmam.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, il devait être complété par une béquille pour IE. Nous déterminons que nous avons IE, et dans certaines solutions de contournement, nous comprenons que la page a néanmoins été extraite du cache et en même temps, nous avons eu une navigation dans l'historique (back_forward). </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ct/xe/af/ctxeafrbbmwt1h_9j16jw4fviji.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De plus, comment savoir si une page est mise en cache? Nous prenons son temps de chargement. S'il est chargé à partir du serveur en 50 millisecondes ou plus rapidement, cela ne peut pas être dans IE - cela signifie qu'il provient du cache! :)</font></font><br>
<br>
<img src="https://habrastorage.org/webt/j-/ib/ch/j-ibchnxog-rdmeez6gmjnbmwr4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai déjà mentionné la navigation dans l'histoire. </font><font style="vertical-align: inherit;">Si nous avons le type de navigation back_forward, alors nous avons parcouru l'historique, et si la page provient du cache, cela signifie bfcache, il n'y a pas d'autres options dans IE.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Et après?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Que faire ensuite avec cette connaissance? </font><font style="vertical-align: inherit;">Je ne voudrais pas que vous sortiez et oubliez tout cela comme un cauchemar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- Tout d'abord, voici la chose la plus précieuse que j'ai rencontrée et ce sur quoi je veux vous pousser: utilisez des navigateurs open source! </font><font style="vertical-align: inherit;">Dans le libre accès à Internet en ce moment sont le code source de tous les principaux navigateurs que nos clients utilisent. </font><font style="vertical-align: inherit;">Et c'est la documentation la plus pertinente sur comment et comment elle est prise en charge, où et comment cela fonctionne. </font><font style="vertical-align: inherit;">Y compris il y a des tests qui sont directement écrits en HTML et JS. </font><font style="vertical-align: inherit;">Utilisez, regardez!</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- Deuxièmement, considérez dans les applications existantes qu'elles peuvent s'exécuter dans bfcache. </font><font style="vertical-align: inherit;">Informez vos testeurs à ce sujet afin que lorsqu'ils vérifient la navigation, ils sachent que lors de la navigation dans l'historique, la page peut être ouverte à la fois depuis le serveur et depuis bfcache. </font><font style="vertical-align: inherit;">Voici une vidéo du vrai bug que nous avons corrigé lorsque bfcache fonctionnait pour nous:</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ouvrir GIF</font></font></b><div class="spoiler_text"><img src="https://habrastorage.org/webt/vx/1j/dv/vx1jdv4ubukownlagrvftn30g6k.gif" width="400"></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'utilisateur entre quatre demandes, voit quatre problèmes. </font><font style="vertical-align: inherit;">Après cela, il revient en arrière, voit le problème 3 et la requête 4. Un autre problème précédent est 2 et la requête 3. C'est-à-dire qu'il a un état incompatible de la page - le contenu de la recherche et les chaînes de recherche se contredisent. </font><font style="vertical-align: inherit;">Gardez cela à l'esprit dans vos applications. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- Et troisièmement, si vous écrivez du nouveau code, pensez si vous avez besoin de bfcache. </font><font style="vertical-align: inherit;">Si tel est le cas, utilisez le tableau de compatibilité des API. </font><font style="vertical-align: inherit;">Sinon, ne l'utilisez pas, mais si vous entrez accidentellement dans bfcache, pensez aux fonctionnalités de Safari et des autres navigateurs que j'ai mentionnés. </font><font style="vertical-align: inherit;">Certaines choses peuvent se déchirer insolemment et vous ne pourrez pas comprendre pourquoi cela se produit. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme promis, un </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lien</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> vers les matériaux.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr496348/index.html">Études de cas sur l'API de stockage Web</a></li>
<li><a href="../fr496350/index.html">Vous ne pouvez pas passer! - Les imprimantes 3D répondent au coronavirus</a></li>
<li><a href="../fr496354/index.html">Programmation informatique ternaire: jouer avec l'émulateur</a></li>
<li><a href="../fr496356/index.html">Création d'un navigateur à l'aide de technologies de réalité augmentée et de méthodes d'apprentissage automatique</a></li>
<li><a href="../fr496358/index.html">Se préparer à célébrer la Journée de la cosmonautique en ligne (la liste est en cours de mise à jour)</a></li>
<li><a href="../fr496362/index.html">Réinitialisation des masques</a></li>
<li><a href="../fr496366/index.html">Minisérie: ordinateur ternaire à faire soi-même</a></li>
<li><a href="../fr496368/index.html">Une startup australienne développe un PC hybride à partir de composants électroniques et biologiques</a></li>
<li><a href="../fr496370/index.html">Joies et chagrins de victoires sur C: nous fabriquons des bonbons à partir du prototype wc sur Haskell</a></li>
<li><a href="../fr496372/index.html">Comment créer une vue personnalisée pour alert (), confirm () et prompt () pour une utilisation en JavaScript</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>