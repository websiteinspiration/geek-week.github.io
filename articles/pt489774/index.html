<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👧🏾 👀 🛷 A história de como automatizei o apartamento usando o Node-RED. parte II 👐 🚺 🚫</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A tão esperada continuação do post sobre a automação do apartamento . Nesta parte, falarei sobre iluminação, um sistema multimídia e sensores de segur...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>A história de como automatizei o apartamento usando o Node-RED. parte II</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/tinkoff/blog/489774/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A tão esperada </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">continuação do post sobre a automação do apartamento</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Nesta parte, falarei sobre iluminação, um sistema multimídia e sensores de segurança.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/89/pw/1w/89pw1w8yo0rpgru9rx1cckulooc.png"><br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Iluminação</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para controlar a iluminação, vários componentes são usados:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cortinas motorizadas;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iluminação regulável.</font></font></li>
</ul><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Brilho</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A luz nos quartos é dividida em duas zonas. </font><font style="vertical-align: inherit;">Eu uso lâmpadas dimmable LED ikeev. </font><font style="vertical-align: inherit;">I usar três módulos de controlo: </font></font><br>
<img src="https://habrastorage.org/webt/4h/94/fp/4h94fp3qxcxmwpmqqi2kmeecuuo.jpeg" alt="Dimmer embutido FIBARO Dimmer 2"><br>
<font color="#909090"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Built-in dimmer </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FIBARO dimmer 2</font></font></a></font><br>
<br>
<img src="https://habrastorage.org/webt/7n/tn/sh/7ntnshtkobrl2nsbrlijuj5ujre.jpeg" alt="Relé duplo embutido FIBARO Double Switch 2x1.5kW"><br>
<font color="#909090"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Built-in dupla relé </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FIBARO Duplo Interruptor 2x1.5kW</font></font></a></font><br>
<br>
<img src="https://habrastorage.org/webt/av/ju/nz/avjunzs_vw57crfbzkqcrlsc-sa.jpeg" alt="Relé embutido FIBARO Single Switch 2.5kW"><br>
<font color="#909090"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Built-in relé </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FIBARO único interruptor 2.5kW</font></font></a></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
dimmer pode escolher automaticamente um método de escurecimento (sobre os bordos anterior e posterior da fase) e calibrar para mínimo e máximo brilho. </font><font style="vertical-align: inherit;">Como eu tinha um sistema de três fios com antecedência para todas as tomadas, não precisava usar um desvio. </font><font style="vertical-align: inherit;">As lâmpadas LED não piscam e não acendem quando não há tensão. </font><font style="vertical-align: inherit;">Para módulos dimerizáveis, uso interruptores de campainha para que você possa ajustar o brilho. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/9v/f7/dl/9vf7dlpauw3strd9emtimu-ct7w.png" alt="     "><br>
<font color="#909090"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Diagrama de fiação do redutor de três fios</font></font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Veja como funciona:</font></font><br>
<br>
<ul>
<li>  -    ,       (     ).</li>
<li>      -    ,          —    .         .      ,      .</li>
<li>      ,   ,   .        —   .</li>
<li>   ,         .    ,    1% .</li>
<li>      ,    15   .</li>
<li>    ,   .</li>
</ul><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/yj/wi/w2/yjwiw2pdfhu75m12gjyckm77l4e.png" alt="  "></a><br>
<font color="#909090">  </font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/ll/46/nj/ll46nj_cya6jsqp5psnpvs1mzbc.png" alt="  "></a><br>
<font color="#909090">  </font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/dl/9h/jp/dl9hjpmwyo23zbxv7drmykp9sfm.png" alt="  "></a><br>
<font color="#909090">  </font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/kg/cl/md/kgclmdshmkmuagjrnidhbh40mhu.png" alt="  "></a><br>
<font color="#909090">  </font><br>
<br>
<h3></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como escrevi anteriormente, todas as janelas do meu apartamento têm vista para uma avenida movimentada com luzes brilhantes. Para resolver o problema da luz brilhante das lâmpadas à noite ou no verão devido ao sol forte, uso persianas motorizadas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No começo, eu queria comprar kits prontos, mas os preços eram muito altos e não gostei do esquema de cores. Essa idéia teve que ser descartada e montar vários conjuntos por conta própria. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dos motores de 220 V, a escolha foi pequena: o francês Somfy ou o chinês Dooya. Somfy é mais silencioso, mas também mais caro, então a escolha caiu nos motores Dooya DM35S. Encomendei-os juntamente com os prendedores no "Aliexpress". O motor possui dois interruptores de limite que ajustam a posição máxima e mínima. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qj/yw/06/qjyw064wkqndni2rppwdvzzkdz0.jpeg" alt="  "><br>
<font color="#909090"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Motor com suportes</font></font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O próximo problema foi o tubo para cortinas de enrolamento. De acordo com as regras da mensagem, você pode enviar um pacote com no máximo 180 cm e uma das janelas que tenho é superior a 2 metros. No mercado de construção mais próximo, encontrei um tubo de alumínio com o diâmetro desejado - 50 mm. Depois de instalar os motores nos tubos, resta encontrar cortinas opacas. Encomendei o tecido nos meus tamanhos de "Aliexpress" depois de concordar com o vendedor que ele me enviaria apenas o tecido, sem mecanismos. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/5j/cy/pm/5jcypmbghomntcc_bolirecpmya.jpeg" alt="  "><br>
<font color="#909090"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A cortina montada fixa As</font></font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
as cortinas são controlados usando o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rolo FIBARO do obturador 2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> módulo de controle cego Z-onda. </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">Gelosia </font></a></font><br>
<br>
<img src="https://habrastorage.org/webt/p-/yn/u2/p-ynu2giqo5wktxhwyb3h7onz0u.jpeg" alt="  "><br>
<font color="#909090"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">módulo de controle</font></font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O módulo está embutido no soquete. Para esses módulos, é aconselhável colocar imediatamente soquetes profundos para empurrar o módulo, os fios e o interruptor. O módulo possui configurações suficientes, incluindo resposta a alarmes, cálculo do consumo de energia, calibração com chaves fim de curso. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ow/bc/ub/owbcubpc-6tca4tltprsmlj8s74.jpeg" alt=" "><br>
<font color="#909090"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Interruptor montado As</font></font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
cortinas são instaladas em cada quarto e na cozinha. Você pode controlar as cortinas pelos comutadores localizados ao lado deles ou usando uma interface ou script. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As cortinas são abaixadas automaticamente quando o crepúsculo se aproxima e as luzes acendem na rua. Eles aumentam de acordo com o horário programado para cada quarto nos dias de semana e fins de semana. Se estiver escuro lá fora, a luz começa a acender suavemente na sala onde a cortina é abaixada.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os dias úteis e fins de semana são calculados de acordo com o calendário de produção baixado. </font><font style="vertical-align: inherit;">Você pode reconfigurar a hora no dia seguinte para cada sala usando o comando telegrama. </font><font style="vertical-align: inherit;">Antes de dobrar as cortinas de acordo com o "despertador", chega uma mensagem de telegrama com a capacidade de confirmar, cancelar e reagendar por 30 minutos. </font><font style="vertical-align: inherit;">Se a ação não seguir, as cortinas se dobram automaticamente. </font><font style="vertical-align: inherit;">Em dias claros, as cortinas definem sua posição automaticamente, dependendo da iluminação da sala e da hora do dia, além de verificar se a luz está acesa ou não. </font><font style="vertical-align: inherit;">Após o recebimento do comando "Férias", todas as cortinas em todos os quartos são abaixadas. </font><font color="#909090"><font style="vertical-align: inherit;">Cortina de </font></font><font color="#909090"><font style="vertical-align: inherit;">Gestão Cenário cortina cenário de gestão</font></font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/-w/j0/na/-wj0na6ajgmspxvn9ul-vfxesri.png" alt="  "></a><br>
<font color="#909090"><font style="vertical-align: inherit;"></font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/vj/1h/6z/vj1h6z5-dl53n-44smy6edp89iq.png" alt="  "></a><br>
<font color="#909090"><font style="vertical-align: inherit;"></font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/dsvjkFMLkcQ" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<font color="#909090"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exemplo de trabalho</font></font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sistema multimídia</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eu tenho muitos dispositivos multimídia com vários controles remotos na sala de estar e queria controlá-los com um botão. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na Internet, encontrei códigos IR separados para ligar e desligar o amplificador, a TV e o divisor HDMI. Usando o script Python </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pronto_broadlink,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> eles foram transcodificados para base64 e depois convertidos em uma matriz de bytes e gravados na base de código IR. Portanto, agora não é necessário saber em que estado o dispositivo está agora: você pode simplesmente enviar o sinal novamente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como meu amplificador é bastante antigo e não sabe como processar uma imagem 4K via HDMI, comprei um divisor HDMI. Permite dividir o sinal de vídeo e áudio em dois HDMI separados: um deles é conectado ao amplificador e o segundo à TV. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yd/u_/4y/ydu_4yehplzjy-aqnc_lohuxbwo.jpeg" alt="   "><br>
<font color="#909090"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Amplificador e outros dispositivos</font></font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No momento, tenho duas fontes de áudio e vídeo: um computador desktop e um servidor. Na interface, você pode ativar todos os dispositivos para reprodução com um botão, apenas em um caso a recepção do sinal será configurada no divisor do servidor e no segundo - no computador. No futuro, está planejado conectar consoles de jogos ao divisor. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se todos saírem de casa, todos os dispositivos multimídia serão desligados. </font><font color="#909090"><font style="vertical-align: inherit;">Cena de controle de mídia</font></font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/6e/li/w3/6eliw3ospeig-4jdz0vzibq3scq.png" alt="  "></a><br>
<font color="#909090"><font style="vertical-align: inherit;"></font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O sistema de presença opera com 6 sensores de movimento e um sensor de abertura da porta frontal. </font><font style="vertical-align: inherit;">Se, após abrir e fechar a porta, nenhum sensor de ocupação for acionado, uma mensagem será enviada ao Telegram em um determinado intervalo com confirmação. </font><font style="vertical-align: inherit;">Se nenhuma ação for tomada dentro de dois minutos ou o botão “Ok” for pressionado, o sistema mudará para o modo “Fora de casa”. </font><font style="vertical-align: inherit;">Se ocorrer um movimento neste momento, o comando é cancelado e a mensagem é excluída. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tentei usar o BLE, mas, no meu caso, não funcionou muito estável e dependia muito do transmissor do telefone. </font><font color="#909090"><font style="vertical-align: inherit;">Detecção automática de presença</font></font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/r_/if/x8/r_ifx8nmt01pioisfqkdalu35x8.png" alt="  "></a><br>
<font color="#909090"><font style="vertical-align: inherit;"></font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sensores de segurança</font></font></h3><br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Os</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
dispositivos de trava </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">Gidrolock</font></a><font style="vertical-align: inherit;"> são instalados nos canos de água </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Quando o fio de controle está em curto na fase, o atuador fecha a torneira e, quando desconectado, ele abre. </font><font style="vertical-align: inherit;">Ambos os inversores estão conectados a um relé </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Philio de</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> contato seco. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ys/tx/3i/ystx3iuuvzjpm_yso_wthzk_g5u.jpeg" alt=" Gidrolock"><br>
<font color="#909090"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O inversor Gidrolock</font></font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Relay </font><font color="#909090"><font style="vertical-align: inherit;">é</font></font><font style="vertical-align: inherit;"> controlado pelos </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sensores NEO Coolcam</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Z-Wave </font><font style="vertical-align: inherit;">localizados nas áreas de possíveis vazamentos. </font><font style="vertical-align: inherit;">Todos os sensores estão diretamente associados ao relé, de modo que a água é desligada sem a participação do controlador. </font><font style="vertical-align: inherit;">Para evitar que a torneira fique azeda, a cada duas semanas à noite, ela abre e fecha automaticamente. </font><font color="#909090"><font style="vertical-align: inherit;">Diagrama de automação de unidade</font></font><font style="vertical-align: inherit;"> 
quando </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">Philio fuma um sensor</font></a></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/d6/oi/wi/d6oiwiu4axhpwaizc46i4ongyeq.png" alt="  "></a><br>
<font color="#909090"><font style="vertical-align: inherit;"></font></font><br>
<br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a ventilação é desligada para não inflar o fogo. </font><font style="vertical-align: inherit;">Ao mesmo tempo, uma mensagem é enviada para o bate-papo por telegrama e o sensor chia nojento.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Outros sensores e dispositivos</font></font></h4><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sensor </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6 em 1 Multisensor Aeotec Multisensor 6</font></font></a></li>
<li><font style="vertical-align: inherit;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">Sensor de</font></a><font style="vertical-align: inherit;"> abertura </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NEO Coolcam</font></font></a></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Autorizar servidor</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este módulo é uma implementação simples de um serviço de autorização. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Existem dois métodos http: um verificará se a solicitação veio da rede interna e, se houver, autorizará o usuário emitindo um token JWT. </font><font style="vertical-align: inherit;">O token JWT é criptografado usando o RSA 256, a chave privada deve ser registrada no arquivo ao lado. </font><font style="vertical-align: inherit;">Se a solicitação não for da rede interna, o usuário será redirecionado para a página de login, onde deverá inserir o login e a senha e efetuar login. </font><font style="vertical-align: inherit;">Como a separação em usuários não é suposta, o arquivo de login e a senha em formato criptografado (SHA 512) estão próximos no arquivo de configuração.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Servidor MQTT</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O servidor MQTT é implementado usando o componente </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aedes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O servidor sobe em duas portas: interna, para comunicação com o servidor, sem autorização, e externa, que implementa o WebSocket. </font><font style="vertical-align: inherit;">Todos os clientes front-end se conectam por meio de um soquete e passam a autenticação durante a autorização, assinando o tópico e publicando qualquer mensagem. </font><font style="vertical-align: inherit;">O token JWT que foi recebido do servidor de autorização entra e é validado usando a chave pública. </font><font style="vertical-align: inherit;">Para solicitações do servidor, a validação não ocorre.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nós Node-RED personalizados</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ao escrever a automação, era necessário implementar um nó adicional e dois para finalizar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eu tive que modificar o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">node-red-contrib-openzwave</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , pois minha solicitação de </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">recebimento</font></a><font style="vertical-align: inherit;"> foi aceita somente após 7 meses, mas agora você pode usar a biblioteca a partir do npm. O refinamento consistiu em lançar um evento de remoção de nó. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/kh/r4/nu/khr4nu0e2xikiinmz6wcxkslhea.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O nó MQTT também foi finalizado. De fato, o principal refinamento é extrair o ID do cliente conectado e gravá-lo novamente quando enviado para a fila. Aqui você pode conviver com a funcionalidade do subfluxo. Também era suposto transferir quaisquer dados para a entrada do nó MQTT, mas não era útil.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ef/xu/mb/efxumb_9d6wk07dbzc5ippu3pec.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para controlar as cortinas e as torneiras de água, era necessário um nó de programação. </font><font style="vertical-align: inherit;">As bibliotecas disponíveis na época eram muito ricas em recursos e não suportavam uma implementação simples usando o CRON. </font><font style="vertical-align: inherit;">Minha implementação é bastante simples: uma programação pode ser feita na entrada de um nó ou definida internamente. </font><font style="vertical-align: inherit;">É possível cancelar a programação. </font><font style="vertical-align: inherit;">Sob o capô, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a programação do nó é usada</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<img src="https://habrastorage.org/webt/qa/ku/a1/qakua12yqbuuz8gkchotr2nj4ps.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Frente</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cada componente ativo do apartamento, que acaba com a automação, é um módulo na frente. </font><font style="vertical-align: inherit;">Cada módulo é independente e contém todos os componentes necessários para renderização. </font><font style="vertical-align: inherit;">Os módulos são divididos em duas agregações: estática e Z-Wave. </font><font style="vertical-align: inherit;">Os módulos devem implementar uma interface.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Interface</font></font></b><div class="spoiler_text"><pre><code class="javascript hljs"><span class="hljs-keyword">export</span> interface INode {
    <span class="hljs-attr">id</span>: string;<font></font>
    type: NodeTypes;<font></font>
    name: string;<font></font>
    addWidget: ComponentClass&lt;AddProps&gt; | StatelessComponent&lt;AddProps&gt;;<font></font>
    model: INodeModelConstructor;<font></font>
    service?: INodeServiceConstructor;<font></font>
    smallComponent: ComponentClass&lt;WidgetProps&lt;any&gt;&gt; | StatelessComponent&lt;WidgetProps&lt;any&gt;&gt;;<font></font>
    bigComponent: ComponentClass&lt;WidgetProps&lt;any&gt;&gt; | StatelessComponent&lt;WidgetProps&lt;any&gt;&gt;;<font></font>
    dialogEditComponent: ComponentClass&lt;WidgetProps&lt;any&gt;&gt; | StatelessComponent&lt;WidgetProps&lt;any&gt;&gt;;<font></font>
    dialogViewComponent: ComponentClass&lt;WidgetProps&lt;any&gt;&gt; | StatelessComponent&lt;WidgetProps&lt;any&gt;&gt;;<font></font>
}<font></font>
</code></pre><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exemplo de implementação</font></font></b><div class="spoiler_text"><pre><code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Widget</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">BaseWidget</span> <span class="hljs-title">implements</span> <span class="hljs-title">INode</span> </span>{
    <span class="hljs-attr">model</span>: INodeModelConstructor = Model;<font></font>
    manufacturerid: string = <span class="hljs-string">'0x0086'</span>;<font></font>
    producttype: string = <span class="hljs-string">'0x1a02'</span>;<font></font>
    productid: string = <span class="hljs-string">'0x0064'</span>;<font></font>
    addWidget: StatelessComponent&lt;AddProps&gt; = AddWidget;<font></font>
    service: INodeServiceConstructor = Service;<font></font>
    smallComponent: StatelessComponent&lt;WidgetProps&lt;Model&gt;&gt; = SmallComponent;<font></font>
    bigComponent: StatelessComponent&lt;WidgetProps&lt;Model&gt;&gt; = BigComponent;<font></font>
    dialogEditComponent: ComponentClass&lt;WidgetProps&lt;Model&gt;&gt; = DialogEditComponent;<font></font>
    dialogViewComponent: ComponentClass&lt;WidgetProps&lt;Model&gt;&gt; = DialogViewComponent;<font></font>
}<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> Widget;</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para módulos estáticos - por exemplo, condicionadores de ar - você precisa implementar um data warehouse na frente. </font><font style="vertical-align: inherit;">Essa implementação é inconveniente e, de uma maneira boa, precisa ser alterada para um repositório.Para os </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
módulos Z-Wave, organizei um repositório comum e acompanhei todas as alterações nele. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O módulo implementa a exibição de duas maneiras:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para telas "grandes" (tablet, computador);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para telefones.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dependendo do tipo de dispositivo, o controle por toque ou mouse será selecionado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O aplicativo é desenvolvido usando o webpack + babel: de acordo com as configurações atuais, ele é montado para as duas últimas versões do Firefox, Chrome e Chrome Android.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Recursos de códigos-fonte</font></font></h3><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fontes</font></font></b></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Todo o fluxo está desativado, para não gerar erros no log. </font><font style="vertical-align: inherit;">O nó de configuração do Z-Wave é excluído: é incorreto se não encontrar o controlador Z-Wave e descarta todo o Node-RED. </font><font style="vertical-align: inherit;">Deve ser algo como isto:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/nt/up/cf/ntupcfzfm3ths5v6h6ys6-hnv2s.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para que o carregador do calendário de trabalho funcione, é necessário registrar-se em </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">data.gov.ru</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , obter um token lá e inseri-lo após access_token:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/fj/rs/rh/fjrsrhnxndutit6hgfrwic9kz5c.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A previsão do tempo é baixada do </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">darksky.net</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> uma vez a cada 15 minutos. </font><font style="vertical-align: inherit;">Ele também precisa de um token, é necessário registrar e inserir o token após a previsão, nas coordenadas:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/bf/ka/kz/bfkakzodfw6mpsboylfszwjdurw.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para enviar notificações por telegrama, você precisa obter seu bot, insira-o no nó de configuração do Telegram e escreva o ID do bate-papo quando necessário. </font><font style="vertical-align: inherit;">No caso do meu Flow, isso é subfluxo: As </font></font><br>
<br>
<img src="https://habrastorage.org/webt/mm/gm/xu/mmgmxuevhgbi_i8gosfkcm5tuow.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
fontes são divididas em frente e verso. </font><font style="vertical-align: inherit;">Na parte de trás encontra-se:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Autorizar servidor.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Servidor MQTT.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Módulos Node-RED personalizados.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fluxos exportados em um arquivo, que pode ser carregado em sua própria conta ou em uma instância separada para testes.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um projeto para o Node-RED, no qual você precisa instalar os módulos e, em seguida, carregar apenas o fluxo exportado (os módulos já estão no projeto).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Base de backup Mongo.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Você pode encontrar informações mais detalhadas sobre a instalação no arquivo leia-me no </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">repositório do github</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Planos</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os planos são usar o microfone de um smartphone ou tablet montado na parede para controle de voz. </font><font style="vertical-align: inherit;">Planejo implantar meu sistema de código aberto em um servidor baseado no </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CMU Sphinx</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Também planejo montar um módulo para tirar e transmitir leituras de medidores de encanamento e eletricidade. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Também vale a pena considerar o uso de estatísticas acumuladas para vários parâmetros, a fim de otimizar a automação.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusão</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No momento, consegui uma automação quase completa da casa para as minhas necessidades - para manter um clima confortável e iluminação na casa. Devido a alguma automação, foi possível reduzir o consumo de eletricidade (cerca de 1.500 ₽ no inverno em comparação com o mesmo equipamento sem automação), tanto pelos elementos de aquecimento quanto pelo lado da iluminação. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Claro, ainda existem bugs nos algoritmos, mas eu os pegarei algum dia, pelo menos estou me movendo nessa direção. O sistema funciona de forma estável, não vejo freios, apesar da velocidade muito baixa no protocolo Z-Wave.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Obviamente, o sistema não se pagará à custa da economia, há mais uma questão de conforto. </font><font style="vertical-align: inherit;">Essa automação é muito úmida em termos de pequenas coisas, como fechar e abrir cortinas, controlar a luz. </font><font style="vertical-align: inherit;">Quando você está em um apartamento comum, às vezes esquece de acender ou apagar as luzes e não abre as cortinas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Raramente ajusto o sistema climático com as mãos, mas às vezes é preciso ligar ou desligar o ar condicionado ou ajustar a temperatura da bateria. </font><font style="vertical-align: inherit;">Em geral, estou satisfeito com o sistema resultante: permite menos tempo para gastar em quaisquer ajustes. </font><font style="vertical-align: inherit;">No caso de uma falha do controlador, todas as funcionalidades permanecerão no local (somente a automação cairá). </font><font style="vertical-align: inherit;">A funcionalidade do fechamento da água também será preservada. </font><font style="vertical-align: inherit;">Se eu decidir vender o apartamento, removerei facilmente toda a automação. </font><font style="vertical-align: inherit;">Ou deixe-o no lugar, mas vendendo mais.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt489762/index.html">Um exemplo simples de análise e análise de dados para o World of Tanks</a></li>
<li><a href="../pt489764/index.html">"O destino tem muitas formas ..." ou automatizamos o controle de uma lâmpada usando CANNY 3 tiny e um fotorresistor</a></li>
<li><a href="../pt489768/index.html">Como π combina blocos de colisão e um algoritmo de pesquisa quântica</a></li>
<li><a href="../pt489770/index.html">Vídeo do MinskJS mitap: meu relatório sobre extensões do navegador</a></li>
<li><a href="../pt489772/index.html">Hackathon em Simferopol, Yandex Diálogos e leis da tecnologia de chat-bot</a></li>
<li><a href="../pt489776/index.html">The Ember Times - Edição 136</a></li>
<li><a href="../pt489778/index.html">CSS antigo e novo. História do Web Design</a></li>
<li><a href="../pt489782/index.html">FizzBuzz 2.0: Perguntas pragmáticas para programadores</a></li>
<li><a href="../pt489784/index.html">27 de fevereiro - início do projeto para estudantes do NX Bootcamp em Novosibirsk</a></li>
<li><a href="../pt489786/index.html">Tubo quente e muito perigoso</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>