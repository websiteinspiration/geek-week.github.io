<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèª‚Äçüé§ üî¶ ü§∏üèø Probl√®mes et fonctionnalit√©s de l'impl√©mentation UEFI sur diverses plates-formes üßïüèº üï∞Ô∏è üë®‚Äçüë©‚Äçüëß</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Environ dix-neuf ans se sont √©coul√©s depuis la publication de la premi√®re sp√©cification EFI en 2000. Il a fallu dix ans √† l'interface pour p√©n√©trer le...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Probl√®mes et fonctionnalit√©s de l'impl√©mentation UEFI sur diverses plates-formes</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/gaz-is/blog/493822/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Environ dix-neuf ans se sont √©coul√©s depuis la publication de la premi√®re sp√©cification EFI en 2000. Il a fallu dix ans √† l'interface pour p√©n√©trer le march√© des utilisateurs et y prendre pied. Pour le moment, vous pouvez rarement voir un ordinateur moderne sans UEFI dans le firmware de la carte m√®re. L'interface standard a augment√© la "viande" et plusieurs milliers de pages dans la documentation officielle. Pour l'utilisateur moyen, rien n'a chang√©, √† l'exception des collisions occasionnelles avec Secure Boot activ√©. Mais si le plan de travail passe au d√©veloppement, tout devient plus int√©ressant.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/1f/ek/as/1fekaswnox-diqt-hgzmaiqnq4g.png"><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le concept m√™me de l'architecture modulaire de l'UEFI implique que ces modules peuvent non seulement √™tre utilis√©s dans la configuration standard, mais √©galement t√©l√©charger quelque chose qui leur est propre. Le pilote du syst√®me de fichiers (non limit√© au FAT natif eFi-timide?), Les pilotes de p√©riph√©riques, les applications, les chargeurs de d√©marrage - vous pouvez tout charger √† la main, il serait bien de charger un peu de Shell. Vous pouvez aller plus loin et regarder le contenu du firmware, vous √©vitant de danser avec SecureBoot et la n√©cessit√© d'√©crire une couche de scripts (il y a suffisamment d'articles sur les pages du hub).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sur cette base, l'id√©e est n√©e de cr√©er des modules fonctionnels qui ex√©cutent diverses fonctions de s√©curit√© avant de charger le syst√®me d'exploitation, qui peuvent encore s'unir et devenir une sorte d'environnement de d√©marrage s√©curis√© int√©gr√© affectant √† la fois les services de l'interface de d√©marrage et d'ex√©cution de sorte qu'entre les modules du micrologiciel et les modules du disque rien ne pouvait √™tre ¬´pouss√©¬ª sans intervention de bas niveau, et apr√®s eux - uniquement avec la permission de l'administrateur de la s√©curit√©. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La mise en ≈ìuvre de cette id√©e nous a pr√©sent√© un grand nombre de nuances et de subtilit√©s de l'UEFI - √† commencer par de nombreuses fonctionnalit√©s, bogues et documents non document√©s ou mal document√©s, et se terminant par le comportement non d√©fini tant appr√©ci√© par tous les d√©veloppeurs. </font><font style="vertical-align: inherit;">Commen√ßons dans l'ordre.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D√©pendance √† la plateforme</font></font></h4><br>
<img src="https://habrastorage.org/webt/wn/pz/1f/wnpz1fwi6hrqqhoogamysefkdic.png" width="770"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La premi√®re chose que vous devez savoir lors de l'int√©gration √† la plate-forme est de savoir si nous pouvons travailler avec elle? La version de la sp√©cification UEFI est importante et, sur la plupart des appareils, elle est pr√©sent√©e dans une plage comprise entre 2,1 et 2,7. Le plus r√©cent n'a pas encore atteint le stand de recherche. Le plus ancien est trouv√©, et ses performances peuvent √™tre limit√©es en raison de l'absence des protocoles n√©cessaires ou des pilotes √©crits de mani√®re tordue pour leur impl√©mentation. Par exemple, UnicodeCollation n'est souvent pas suffisant, lors de l'acc√®s aux smbios il y a des erreurs non document√©es, les fonctions de changement de langue via SetVariable () ne fonctionnent pas. Tout peut arriver, selon le fournisseur et la fra√Æcheur, car il faut parfois mettre ses protocoles m√™me sur des cartes relativement r√©centes.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
M√™me dans notre pratique, j'ai eu la chance de tomber sur deux mini-ordinateurs avec Intel Bay Trail D et un firmware 32 bits √† bord. Le cas est rare, mais √† un moment donn√©, il a fallu recompiler d'urgence les modules. En fait, comme la question: allons-nous rencontrer √† l'avenir une plate-forme plus moderne de la m√™me capacit√©? Et si nous nous rencontrons, alors o√π?</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'√©tape suivante consiste √† d√©terminer comment int√©grer. Les modules sont int√©gr√©s au micrologiciel, le micrologiciel se trouve dans la puce SPI de la carte et PCH avec Intel ME est situ√© √† proximit√©. Et ici se pose la question la plus int√©ressante - comment s'y rendre? Bon vieux programmeur avec un "crocodile" - c'est bien, c'est fiable. M√™me si vous ne vous attardez pas √† la fin, vous pouvez toujours regarder les LED br√ªlantes sur la carte, elles ont suffisamment de puissance du programmeur. Il fonctionne presque parfaitement, √† l'exception de certains anciens mod√®les HP, o√π le mikruha SOIC-16 avec firmware est si accessible qu'il est plus facile de concevoir et de souder l'adaptateur √† ses jambes que de serrer le clip. </font></font><br>
 <br>
<img src="https://habrastorage.org/webt/uu/ce/6b/uuce6bumbvwdovmxow0ntfoeynm.png" width="770"><br>
<img src="https://habrastorage.org/webt/qj/kf/k1/qjkfk14esp5_ol1vchn8fkaiwt4.png" width="770"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Je sais qu'il y a des gens sur Habr√© qui ont contribu√© √† l'√©criture de flashrom, gr√¢ce √† eux s√©par√©ment.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais, malgr√© la fiabilit√© et la fiabilit√© de la suppression des vidages par le programmeur, cette m√©thode ne convient pas si vous devez installer quelque chose dans UEFI sur plusieurs machines, ou si la plate-forme cible pour l'installation n'est pas sur votre bureau. Heureusement pour nous, les fabricants ont laiss√© derri√®re eux les utilitaires de firmware natifs: FPT (outil de programmation Flash) du kit Intel (CS) ME System Tools et AFU (AMI Firmware Update) pour Aptio d'American Megatrends. Ces utilitaires sont lanc√©s √† partir de l'environnement EFI et des syst√®mes d'exploitation Windows, Linux et DOS. Les utilitaires sont quelque peu interchangeables, les deux vous permettent de consid√©rer l'image, sinon la totalit√©, puis certaines r√©gions √† coup s√ªr. Et parfois, ils vous laissent m√™me r√©√©crire. </font></font><br>
 <br>
<img src="https://habrastorage.org/webt/hk/vz/pp/hkvzppckxwb02epv3ieytikh5y0.png" width="770"><br>
<img src="https://habrastorage.org/webt/we/qx/3y/weqx3ysvpinegiv9gxh9biw7xdg.png" width="770"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il √©crit et n'√©crit pas</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est l√† que la premi√®re pierre d'achoppement s√©rieuse sur le chemin de l'int√©gration appara√Æt. Toutes les cartes m√®res ne vous permettent pas de lire l'int√©gralit√© du firmware, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">interdisant l'acc√®s</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √† la r√©gion ME (ME est presque sacr√©, Intel ne permettra pas qu'il soit lu dans le bon sens, mais </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dans le mauvais sens,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nous ne voulons pas toujours). Encore moins - versez quelque chose m√™me dans la r√©gion du BIOS, sauf s'il s'agit d'une capsule sign√©e. Les chances de succ√®s varient consid√©rablement selon le fabricant et la fra√Æcheur du chipset. Sur certains mod√®les de cartes m√®res, vous pouvez observer une image amusante: celle qui n'√©tait pas enregistr√©e sur les anciennes cartes des fournisseurs vole √† de nouveaux moments. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parfois, l' </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">analyseur IFR</font></a><font style="vertical-align: inherit;"> aide √† lutter contre la protection en √©criture</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, ce qui ouvre le rideau sur les param√®tres et les variables cach√©s. </font><font style="vertical-align: inherit;">Et parfois, seul un cavalier hardcore aide, permettant d'acc√©der √† l'enregistrement ou de "d√©sactiver" ME (si un est fourni, bien s√ªr).</font></font><br>
 <br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La nature complexe des syst√®mes</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans la plupart des cas, les cartes Acer, Asus, AsRock et Gigabyte sont √©crites sans difficult√©s inutiles. </font><font style="vertical-align: inherit;">Intel, HP et le mat√©riel serveur se distinguent. </font><font style="vertical-align: inherit;">Non seulement HP n'autorise pas l'√©criture par programmation, mais il jure √©galement √† toute tentative de modification du micrologiciel (dans</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CodeRush</font></font></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">il existe des </font></font></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">articles</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sur la recherche et la d√©sactivation de la v√©rification d'int√©grit√©). Intel a plus ou moins enregistr√© jusqu'au 87√®me chipset, puis il est devenu sourd aux demandes d'ouverture des portes de la r√©gion BIOS. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Avec Intel, la premi√®re fois √©tait dr√¥le. Les modules ont √©t√© import√©s dans le firmware √† l'aide de l'utilitaire UEFITool, et nous sommes tomb√©s sur un bug int√©ressant: si nous ins√©rons des modules ffs √† la fin du volume DXE, apr√®s toutes les formes libres, l'image assembl√©e ¬´maquillait¬ª la carte. La solution √©tait d'ajouter des modules apr√®s n'importe quel pilote DXE natif. Nous n'y sommes pas imm√©diatement arriv√©s, et au d√©but, il semblait qu'Intel surveillait l'int√©grit√© du firmware, comme HP. Plus tard, il est devenu clair que l'on ne pouvait pas se passer d'un utilitaire automatique pour importer des modules, et le probl√®me est venu √† n√©ant apr√®s l'avoir √©crit.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le mat√©riel c√¥t√© serveur est √† la fois plus simple et plus complexe. D'une part, il existe toujours des moyens suppl√©mentaires de mettre √† jour et de modifier les BIOS sur les serveurs, d'autre part, le volume de personnalisation dans ces m√™mes BIOS est √©crasant, car ils ne l√©sinent pas sur les serveurs et n'installent pas de puces de m√©moire flash assez volumineuses, souvent √©galement en les sauvegardant. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lors de l'installation sur un serveur, il est toujours agr√©able de pouvoir mettre √† jour le BIOS √† distance via IPMI. Certes, pour cela, vous avez besoin d'une licence, bien s√ªr pay√©e. S'il n'appara√Æt pas au bon moment, il est tout √† fait possible de se retrouver dans une situation amusante, similaire √† celle que nous avons eue en introduisant des modules dans le BIOS du serveur Supermicro.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apr√®s l'introduction des modules, la charge se bloque fortement en raison du blocage par l'un des modules de s√©curit√© (ils n'ont pas pris en compte le caract√®re capricieux des BIOS du serveur, avec qui cela n'arrive pas!). En l'absence de la possibilit√© de forcer le BIOS √† √™tre restaur√© via IPMI, la main elle-m√™me a atteint le programmeur, mais ce n'√©tait pas une chance - le clip SOIC-8 standard n'√©tait pas suffisant pour une puce SOIC-16! Eh bien, d'accord, car en th√©orie, la carte serveur a la possibilit√© de sauvegarder √† partir du support connect√©, en r√©cup√©rant l'image SUPER.ROM √† la racine. Mais ce m√©canisme ne d√©marre pas, car selon le syst√®me tout va bien, tout fonctionne, donc, la restauration du BIOS n'est pas n√©cessaire! Que faire?! .. L'histoire a fini par courir dans la ville √† la recherche du bon clip, un resoudage d'urgence des fils, enduit par les Chinois dans un ordre incompr√©hensible pour nous, et enfin - un clignotement.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lenovo est sorti encore plus int√©ressant. Sur les commutateurs re√ßus du vendeur, sous le couvercle du bo√Ætier, une carte de contr√¥le a √©t√© trouv√©e avec deux "mikruhs" pour firmware, avec un SSD pour OS et avec une batterie fixe. Le BIOS s'est av√©r√© √™tre un dur √† cuire, je ne voulais en aucun cas manger une image modifi√©e, ne succombant qu'au programmeur. Dans l'une des tentatives d'√©crire quelque chose, ils ont ins√©r√© un lecteur flash avec la console ubuntu dans le commutateur (le terminal n'a pas donn√© de graphiques) et ont d√©marr√© en toute s√©curit√©. Apr√®s avoir fait ce qui √©tait n√©cessaire, ils ont √©teint le syst√®me en utilisant la commande halt -p de l'ancienne m√©moire. L'interrupteur, de par sa nature, n'√©tait adapt√© √† aucun arr√™t, sauf par manque de puissance, n'√©tait pas pr√™t pour cela et ne voulait plus d√©marrer. Le lien sur le visage a br√ªl√© une fois, les fans ont bruiss√© doucement et tous les ports n'ont rien r√©v√©l√©. Le nouveau clignotement n'a pas aid√©,la batterie √©tait assise comme un gant - nous avions peur de casser la monture. En cons√©quence, une fine plaque di√©lectrique a ramp√© sous la force de la pers√©v√©rance et de l'inspiration verbale sous les contacts, la m√©moire volatile a √©t√© effac√©e, l'interrupteur a pris vie.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'√©tude des d√©charges pr√©lev√©es sur deux puces a montr√© beaucoup de choses int√©ressantes. En particulier, un grand nombre d'entr√©es "invalides" dans la NVRAM du firmware principal et plusieurs similaires dans la sauvegarde. Eh bien, et pas un hachage de donn√©es rencontr√© pr√©c√©demment dans le volume avec les pilotes DXE. On ne pouvait que deviner la cause exacte du probl√®me de d√©marrage du commutateur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En g√©n√©ral, la partie logicielle est rarement priv√©e de ses nuances inattendues. De nombreuses cartes m√®res que nous avons rencontr√©es jusqu'au 87e chipset (de diff√©rents fabricants) ont la caract√©ristique d√©sagr√©able de g√©n√©rer un flux infini d'erreurs lors de la saisie de la commande "dh -v" dans la console shell. Avec la saisie manuelle, ce n'est pas critique, mais lors de la collecte de donn√©es dans un fichier, cela se termine par un blocage malheureux. Dans les deux cas, vous devez red√©marrer la machine. Je suis heureux qu'en m√™me temps le fichier de donn√©es ne gonfle pas √† des tailles immenses.</font></font><br>
 <br>
<img src="https://habrastorage.org/webt/z-/rr/_k/z-rr_k9f6o7pmt_ezbza-ysrjzw.png" width="770"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le BIOS Kraftway avec carte ASRock H81M-DGS s'est r√©v√©l√© tr√®s capricieux. Ainsi, il r√©pond √† Ctrl Alt Del Del par un accrochage, duquel seul Reset peut le sortir. Il y a eu des probl√®mes pour ignorer le script de d√©marrage &lt;startup.nsh&gt; dans Shell'e - une fraction de seconde √† choisir au lieu de cinq par d√©faut. Peut-√™tre que ces probl√®mes sont caus√©s par la modification par les modules propri√©taires de KSS, peut-√™tre que le probl√®me est inexactement ¬´d√©viss√©¬ª ME.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sur la carte Asus H97-PLUS, le firmware a la fonctionnalit√© suivante - BootOrder d√©borde au fil du temps. Tr√®s probablement, la raison r√©side dans les erreurs dans le code. Bien que, peut-√™tre, le fabricant ait voulu conserver tous les p√©riph√©riques de d√©marrage jamais connect√©s √† la carte, mais n'a pas calcul√© qu'il pourrait y en avoir plus d'une douzaine en une journ√©e. Ainsi, lorsque BootOrder d√©borde, le syst√®me se bloque pendant le processus de d√©marrage. Pour le nettoyer, vous devez √©teindre tous les p√©riph√©riques de d√©marrage et allumer le syst√®me. Le firmware s‚Äôefface et le syst√®me d√©marre directement dans le shell de configuration du BIOS. Les performances restent jusqu'au prochain d√©bordement.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En r√©sumant l'exp√©rience de travail avec les conseils d'administration de divers fournisseurs, vous arrivez √† la conclusion qu'il est presque impossible de savoir quelles surprises au niveau EFI vous aurez √† traiter sur le prochain tableau, m√™me s'il a d√©j√† un mod√®le bien connu. </font><font style="vertical-align: inherit;">Il s'agit d'une sorte de loterie, car des difficult√©s peuvent parfois survenir au stade de la collecte d'informations sur le syst√®me. </font><font style="vertical-align: inherit;">Peut-√™tre cela a-t-il une part d'id√©alisme de recherche inextinguible et de confiance dans le fabricant, car comment autrement certaines des cartes m√®res les plus r√©centes avec ME v11 et v12 pourraient-elles se bloquer lors de l'ex√©cution de FPT ou MEInfo des anciennes versions?</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Probl√®mes de travail avec les protocoles mat√©riels</font></font></h4><br>
<img src="https://habrastorage.org/webt/j2/yo/ze/j2yozeg6zdyfa--juz_ycvvobbc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Certains probl√®mes apparaissent lorsque nous commen√ßons √† travailler avec des p√©riph√©riques USB - lecteurs et jetons. Cela se produit souvent parce que le code BIOS pour travailler avec les p√©riph√©riques est un dangereux cocktail de pilotes et d'applications du fournisseur de mat√©riel ind√©pendant (IHV) pour un p√©riph√©rique sp√©cifique, du code du fabricant du chipset (dans notre cas, d'Intel), du code du fabricant du BIOS et du code du fabricant de la carte m√®re. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les situations ¬´int√©ressantes¬ª suivantes se </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
sont produites </font><font style="vertical-align: inherit;">: </font><font style="vertical-align: inherit;">jeton ¬´non d√©tect√©¬ª. En m√™me temps, une LED est allum√©e dessus. Tr√®s probablement, le contr√¥leur h√¥te ne passe pas par la proc√©dure de r√©initialisation initiale du p√©riph√©rique USB, c'est-√†-dire que l'alimentation est fournie, mais la r√©initialisation en modifiant les lignes D + et D- ne fonctionne pas correctement, et sans cela, aucune autre manipulation avec le jeton n'a de sens.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'ordinateur se fige avant de charger le shell (encore une fois, avec un jeton connect√©). Dans ce cas, sans jeton, le PC d√©marre normalement. En direct, cela ressemble √† ceci: l'ordinateur semble planter juste apr√®s le d√©marrage, tandis que le jeton sort du connecteur. Vous le retirez - le chargement continue soudainement. Connectez-vous - suspendu √† nouveau. Le probl√®me √©vident est dans UEFI, et on ne peut que sp√©culer sur les raisons. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La situation o√π il n'est pas possible d'ouvrir l'interface USB_IO. Peut-√™tre qu'il est connect√© uniquement avec l'interface pour travailler avec des cartes √† puce - USB CCID. Un pilote AMI a d√©j√† ouvert USB_IO avec le param√®tre EFI_OPEN_PROTOCOL_BY_DRIVER. Le pilote a un protocole avec un GUID:</font></font><br>
<br>
<pre><code class="plaintext hljs">#define EFI_AMI_USB_CCID_PROTOCOL_GUID	 { 0x5FDEE00D, 0xDA40, 0x405A, { 0xB9, 0x2E, 0xCF, 0x4A, 0x80, 0xEA, 0x8F, 0x76} }<font></font>
 // Workaround.      EFI_OPEN_PROTOCOL_BY_DRIVER,  ,     EFI_OPEN_PROTOCOL_GET_PROTOCOL.<font></font>
 //<font></font>
 // Open USB I/O Protocol<font></font>
 //<font></font>
 Status = gBS-&gt;OpenProtocol (<font></font>
 ControllerHandle,<font></font>
 &amp;gEfiUsbIoProtocolGuid,<font></font>
 (VOID **) &amp;UsbIo,<font></font>
 This-&gt;DriverBindingHandle,<font></font>
 ControllerHandle,<font></font>
 EFI_OPEN_PROTOCOL_BY_DRIVER<font></font>
 );<font></font>
<font></font>
 if (EFI_ACCESS_DENIED == Status)<font></font>
 {		// AMI BIOS workaround (BindingStop will not be invoked)<font></font>
	 Status = gBS-&gt;OpenProtocol(<font></font>
		 ControllerHandle,<font></font>
		 &amp;gEfiUsbIoProtocolGuid,<font></font>
		 (VOID **)&amp;UsbIo,<font></font>
		 This-&gt;DriverBindingHandle,<font></font>
		 ControllerHandle,<font></font>
		 EFI_OPEN_PROTOCOL_GET_PROTOCOL<font></font>
	 );<font></font>
 }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cependant, BindingStop () ne sera pas appel√©, c'est-√†-dire l'√©v√©nement d'extraction de p√©riph√©rique n'est pas surveill√© et le pilote essaiera d'utiliser un handle non valide. Cela a √©t√© observ√© avec le PC HP Compaq Elite 8300 SFF et quelques autres. Il s'agit soit d'une sorte de protection des fournisseurs contre les pilotes ind√©sirables, soit d'un bogue de d√©veloppement normal. Peut-√™tre qu'AMI fait constamment quelque chose en direction de USB CCID, mais le pilote interf√©rant ne peut pas √™tre d√©charg√©, car il est situ√© dans le m√™me module AMI UHCI avec USB HID, USB MassStorage. Avec UninstallInterface (), les choses sont similaires.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ou une autre fonctionnalit√© int√©ressante. Dans l'un des BIOS UEFI, o√π le jeton n'a pas √©t√© d√©tect√©, USB_IO a autoris√© la lecture des descripteurs de p√©riph√©rique, mais EFI_INVALID_PARAMETER est revenu au prochain UsbBulkTransfer (). De plus, cela ne s'est produit qu'avec certains types de jetons, avec absolument les m√™mes param√®tres, d'autres fonctionnaient parfaitement.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En g√©n√©ral, dans le protocole EFI_USB_IO_PROTOCOL, la m√©thode UsbBulkTransfer () est impl√©ment√©e de mani√®re int√©ressante. </font><font style="vertical-align: inherit;">Il est pr√©vu pour une livraison de colis garantie pour une dur√©e illimit√©e ou pour la dur√©e sp√©cifi√©e dans le param√®tre Timeout. </font><font style="vertical-align: inherit;">Mais une exp√©rience a √©t√© men√©e avec un appareil MassStorage: lors de la copie d'un gros fichier sur une cl√© USB, il a √©t√© supprim√©. </font><font style="vertical-align: inherit;">Le PC se bloque fermement. </font><font style="vertical-align: inherit;">Lors de la connexion de la cl√© USB, le PC s'est affaiss√© et a continu√© √† √©crire le fichier comme si de rien n'√©tait. </font><font style="vertical-align: inherit;">La m√™me situation √©tait avec des jetons, mais avec ses propres sp√©cificit√©s. </font><font style="vertical-align: inherit;">C'est un probl√®me architectural, dans EFI il n'y a pas d'interruptions sauf une minuterie, et les appareils fonctionnent selon un sondage. </font><font style="vertical-align: inherit;">Autrement dit, le syst√®me s'est √©cras√© quelque part dans le sondage USB, mais n'a pas atteint la sortie de d√©lai d'expiration; lorsque l'appareil r√©appara√Æt, il a simplement continu√© et termin√© l'op√©ration.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Virtualisation</font></font></h4> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous devrions √©galement parler des environnements virtuels. Actuellement, il existe deux principales plates-formes sur le march√© qui prennent en charge l'√©mulation de l'environnement EFI: VMware et VirtualBox. Les deux ont leurs avantages et leurs inconv√©nients lorsqu'ils interagissent avec eux comme avec les ¬´vrais¬ª syst√®mes. L'environnement VMware fournit un travail ad√©quat avec les variables NVRAM, mais tr√©buche lors de l'affichage visuel des messages lors de l'initialisation des modules DXE: dans le meilleur des cas, la pr√©f√©rence sera donn√©e aux messages natifs sur la recherche de supports de d√©marrage, laissant derri√®re nous ce dont nous avons besoin. VirtualBox, au contraire, rend parfaitement tout ce qui est n√©cessaire, mais ne veut pas se souvenir de longues variables.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une autre petite pierre dans le jardin VMware - le pilote FAT32 int√©gr√© prend en charge la cr√©ation et l'√©dition de fichiers uniquement en notation 8.3. </font><font style="vertical-align: inherit;">Il n'est pas clair pourquoi cela a √©t√© fait, mais c'est une limitation qui n√©cessite clairement une attention. </font><font style="vertical-align: inherit;">Il est probable qu'une impl√©mentation similaire du pilote puisse √™tre observ√©e sur des plates-formes r√©elles, mais jusqu'√† pr√©sent, nous ne les avons pas rencontr√©es. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
D'autre part, dans les machines virtuelles, il n'y a pas de danses avec des utilitaires de firmware, des programmeurs, des cavaliers, des puces inconfortables. </font><font style="vertical-align: inherit;">Un fichier ROM s√©par√©, UEFITool et une ligne dans le fichier de configuration. </font><font style="vertical-align: inherit;">Presque une idylle.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√Ä la fin</font></font></h4><br>
<img src="https://habrastorage.org/webt/cb/qg/va/cbqgvany9ens-l7ippxwgzox9co.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Une tranche de la demande de CHIPSEC. </font><font style="vertical-align: inherit;">O√π enseignent-ils de tels sacrements? </font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme d√©j√† mentionn√©, le d√©veloppement et la mise en ≈ìuvre dans le shell UEFI est un processus fascinant et cr√©atif. </font><font style="vertical-align: inherit;">Vous pouvez toujours trouver quelque chose de nouveau, m√™me sur un domaine c√©l√®bre. </font><font style="vertical-align: inherit;">D'une part, il est encourageant de constater que la norme √©volue, d'autre part, il est triste que les mises en ≈ìuvre concr√®tes de celle-ci par les producteurs soient trop ¬´cr√©atives¬ª. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les principaux probl√®mes √©taient et demeurent:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D√©part des fournisseurs de la sp√©cification UEFI lors du d√©veloppement du firmware.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erreurs dans le code lors de l'impl√©mentation.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NDV dans le code, pop-up lors de l'int√©gration.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et enfin, mais non des moindres, l'absence de beaucoup de choses dans la documentation officielle (lue, ouverte), comme, par exemple, les descriptions du protocole pour communiquer avec ME via des p√©riph√©riques PCI comme MEI, HECI. </font><font style="vertical-align: inherit;">Vous pouvez trouver une description des registres, mais pas les commandes. </font><font style="vertical-align: inherit;">Trouvez un GUID, mais pas son objectif. </font><font style="vertical-align: inherit;">Ce qui renvoie encore une fois le travail √† une longue analyse, collecte de donn√©es et statistiques sur les plateformes et utilisation du d√©monteur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il convient de noter que la situation se corrige lentement mais s√ªrement, et je veux croire que le moment n'est pas loin o√π l'√©laboration de la norme deviendra un processus assez pr√©visible et tr√®s agr√©able. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vladimir Onipchuk, </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
responsable du groupe de produits de protection mat√©rielle et logicielle de </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gazinformservice LLC</font></font></b></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr493810/index.html">Cinq ans de d√©veloppement intensif du march√© de la reconnaissance de documents</a></li>
<li><a href="../fr493814/index.html">Comment nous menons des entretiens √† Barcelone</a></li>
<li><a href="../fr493816/index.html">Git Guide Partie num√©ro 1: tout ce que vous devez savoir sur le r√©pertoire .git</a></li>
<li><a href="../fr493818/index.html">Git Guide Partie num√©ro 2: la r√®gle d'or et autres bases de rebase</a></li>
<li><a href="../fr493820/index.html">√âquilibrage de charge et mise √† l'√©chelle de connexions √† longue dur√©e de vie Kubernetes</a></li>
<li><a href="../fr493826/index.html">Diviser pour mieux r√©gner: am√©liorer l'√©lectrolyse de l'eau</a></li>
<li><a href="../fr493828/index.html">Comment l'interface raconte des histoires dans les jeux vid√©o</a></li>
<li><a href="../fr493830/index.html">Quelles questions sont pos√©es par le d√©veloppeur iOS junior lors des premi√®res interviews</a></li>
<li><a href="../fr493832/index.html">Tableau de bord de distribution du Coronavirus COVID-19 (React + Chart.js + BootstrapTable)</a></li>
<li><a href="../fr493840/index.html">Avis: Asana, Jira, Bitrix-24, Trello, YouGile. Qu'est-ce qui vous pla√Æt et ce qui vous exasp√®re?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>