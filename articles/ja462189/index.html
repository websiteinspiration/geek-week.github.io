<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🥔 🌤️ 🆒 travajsによるデータのエッチング 🏭 🧑🏾‍🤝‍🧑🏽 🧗🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="私には、以前の記事、別の開発時に、私は要点を説明したオープンソースのライブラリを。私はもう1つ言及するのを忘れていました。ライブラリについて誰にも言わない場合、それが何であれ、だれもそれについて知らないでしょう。
 
 それでは、trava.jsに会ってください -プロジェクトの利益のためのジューシ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>travajsによるデータのエッチング</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/462189/"><img src="https://habrastorage.org/webt/kb/fw/tm/kbfwtmm5xe1jxdaa1l2avw8geuo.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私には</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、以前の記事、</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">別の開発時に、私は要点を説明した</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">オープンソースのライブラリを</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">私はもう1つ言及するのを忘れていました。ライブラリについて誰にも言わない場合、それが何であれ、だれもそれについて知らないでしょう。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それでは、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">trava.js</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に会って</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ください</font></a><font style="vertical-align: inherit;"> -プロジェクトの利益のためのジューシーな検証。</font><font style="vertical-align: inherit;">ちなみに草は半年以上使ってますので、使うメリットを説明する時がきたと思いました。</font><font style="vertical-align: inherit;">もう乾いているので息を止めて。</font><font style="vertical-align: inherit;">そしてどうぞ。</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">概念</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一見すると、検証は特別な注意を必要としない簡単なトピックのようです。</font><font style="vertical-align: inherit;">値はtrueまたはnotのいずれかであり、より単純になる可能性があります。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">validate</span> (<span class="hljs-params">value</span>) </span>{
  <span class="hljs-comment">// any checking...</span>
  <span class="hljs-keyword">if</span> (!check(value)) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
  <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、通常、正確に何がうまくいかなかったのかを知っておくとよいでしょう。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">validate</span> (<span class="hljs-params">value</span>) </span>{
  <span class="hljs-keyword">if</span> (!check1(value)) <span class="hljs-keyword">return</span> <span class="hljs-string">'ERROR_1'</span>;
  <span class="hljs-keyword">if</span> (!check2(value)) <span class="hljs-keyword">return</span> <span class="hljs-string">'ERROR_2'</span>;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実際にはこれですべてです。問題は解決されました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そうでない場合は「しかし」。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実際のアプリケーションを開発した経験から、問題は検証で終わらないことがわかりました。通常、このデータは特定の形式に変換する必要もあります。たとえば、日付、セット、その他のカスタムデータ型など、そのままではシリアライザがサポートしていない理由があります。これは主にJSONであることを考えると、実際には、検証および変換中に入力データ構造をダブルパスする必要があることがわかります。この2つの段階を1つにまとめてみませんか。可能なプラスは、明示的な宣言型データスキーマの存在です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
値の特定の形式への変換をサポートするには、バリデーターはエラーだけでなく、削減された値も返すことができる必要があります。</font><font style="vertical-align: inherit;">jsの世界では、いくつかのインターフェースオプションが、エラーが返される可能性がある場合にかなり一般的です。</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">おそらく最も一般的なのは、[エラー、データ]タプルの戻りです。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">validate</span> (<span class="hljs-params">value</span>) </span>{
  <span class="hljs-keyword">if</span> (!check1(value)) <span class="hljs-keyword">return</span> [<span class="hljs-string">'ERROR_1'</span>];
  <span class="hljs-keyword">if</span> (!check2(value)) <span class="hljs-keyword">return</span> [<span class="hljs-string">'ERROR_2'</span>];
  <span class="hljs-keyword">return</span> [<span class="hljs-literal">null</span>, value];<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
配列が返されない同様のオプションもありますが、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{error、data}</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">オブジェクトです</font><font style="vertical-align: inherit;">が、基本的な違いはありません。</font><font style="vertical-align: inherit;">このアプローチの利点は自明であることですが、マイナス点は、この契約をどこでもサポートする必要があることです。</font><font style="vertical-align: inherit;">検証の場合、これは不都合を引き起こしませんが、変換の場合、これは明らかに不必要です。</font></font><br>
</li>
<li> .       —    ,  .    ,      ,   -   .        ,      ,      ,    .      —      ,     .<br>
</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a>     .         .<br>
</li>
<li>    .     ,      ,   .<br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">validate</span> (<span class="hljs-params">value</span>) </span>{
  <span class="hljs-keyword">if</span> (!check1(value)) <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Trava.ValidationError({ <span class="hljs-attr">code</span>: <span class="hljs-number">401</span> });
  <span class="hljs-keyword">if</span> (!check2(value)) <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Trava.ValidationError({ <span class="hljs-attr">code</span>: <span class="hljs-number">405</span> });
  <span class="hljs-keyword">return</span> parseOrTransform(value);  <span class="hljs-comment">// apply some parse or transform</span>
}</code></pre><br>
</li>
</ol><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私は後者のオプションを選択しましたが、これも妥協ですが、全体的に悪くはありません。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Trava.ValidationErrorは</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、エラーのタイプとして提案されています</font><font style="vertical-align: inherit;">。これは、標準の</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">エラー</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を継承し、</font><font style="vertical-align: inherit;">任意のデータタイプを使用してエラーを報告する機能を追加します。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Trava.ValidationError</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を使用する必要はありません。</font><font style="vertical-align: inherit;">標準の</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Errorを</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用できますが</font><font style="vertical-align: inherit;">、エラーメッセージは文字列のみであることを忘れないでください。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
要約すると、バリデーターは、値に加えてエラーを返すことができるクリーンな同期関数であると言えます。</font><font style="vertical-align: inherit;">非常にシンプルです。</font><font style="vertical-align: inherit;">そして、この理論はライブラリなしでもうまく機能します。</font><font style="vertical-align: inherit;">実際には、バリデーターはチェーンと階層に組み合わされており、ここでは確実に草が役に立ちます。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">組成</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
おそらく、コンポジションはバリデーターを扱う最も一般的なケースです。構成の実装は異なる場合があります。たとえば、よく知られている</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">joi</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">および</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">v8nライブラリで</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">、</font></a><font style="vertical-align: inherit;">これはオブジェクトと一連のメソッドを通じて行われます。</font></font><br>
<br>
<pre><code class="javascript hljs">Joi.string().alphanum().min(<span class="hljs-number">0</span>).max(<span class="hljs-number">255</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一見美しいように見えますが、このアプローチにはいくつかの欠点があり、1つは致命的です。そしてここにあるものです。私の経験では、バリデーターは常に特定のアプリケーションのためのものであるため、ライブラリーの主な焦点は、バリデーターの拡張と既存のアプローチとの統合の利便性であり、基本的なプリミティブの数ではなく、ライブラリーに重みを加えるだけですが、ほとんどは使用されません。たとえば、文字列に対して同じバリデーターを使用します。次に、スペースを端から削除する必要があることがわかり、突然、1つのケースで特殊文字の使用を許可する必要があり、どこかで小文字にする必要があるなどです。実際、そのようなプリミティブは無数に存在する可能性があり、それらをライブラリーに追加し始めても意味がありません。私の意見では、オブジェクトの使用も冗長であり、展開中に複雑さが増しますが、一見すると、より簡単に見えるようです。たとえばc</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">joiは</font></font></i><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バリデーターを書くのは</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">簡単で</font><i><font style="vertical-align: inherit;">はあり</font></i><font style="vertical-align: inherit;">ません</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここで機能的なアプローチと草が役立つかもしれません。</font><font style="vertical-align: inherit;">0から255の範囲で指定された数値を検証する同じ例：</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">//   </span>
<span class="hljs-keyword">const</span> isNumber = <span class="hljs-function"><span class="hljs-params">n</span> =&gt;</span> <span class="hljs-keyword">typeof</span> n == <span class="hljs-string">'number'</span> &amp;&amp; !<span class="hljs-built_in">isNaN</span>(n);
<span class="hljs-comment">// </span>
<span class="hljs-keyword">const</span> numberValidator = Trava.Check(isNumber);
<span class="hljs-keyword">const</span> byteValidator = Trava.Compose([<font></font>
  numberValidator,<font></font>
  Trava.Check(<span class="hljs-function"><span class="hljs-params">n</span> =&gt;</span> <span class="hljs-number">0</span> &lt;= n &amp;&amp; n &lt; <span class="hljs-number">256</span>),<font></font>
]);<font></font>
byteValidator(<span class="hljs-number">-1</span>); <span class="hljs-comment">// !</span>
</code></pre><br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Check</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ステートメント</font><font style="vertical-align: inherit;">は、真偽チェックからバリデーターを</font><font style="vertical-align: inherit;">作成し</font><font style="vertical-align: inherit;">ます（値=&gt; true / false）。</font><font style="vertical-align: inherit;">そして</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Composeは</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バリデーターを</font><b><font style="vertical-align: inherit;">チェーンし</font></b><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">実行すると、最初のエラーの後でチェーンが中断されます。</font><font style="vertical-align: inherit;">重要なのは、通常の関数がどこでも使用されていることです。これは、拡張して使用するのが非常に簡単です。</font><font style="vertical-align: inherit;">私の意見では、有効な検証ライブラリーの重要な機能は、拡張のしやすさです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
従来、検証の別の場所は</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">undefinedを</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">チェックすることで占められていました</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">このために草の中に補助的なオペレーターがいます：</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">//   null  undefined</span>
<span class="hljs-keyword">const</span> requiredNumberValidator = Trava.Required(numberValidator);<font></font>
requiredNumberValidator(<span class="hljs-literal">undefined</span>); <span class="hljs-comment">// !</span><font></font>
<font></font>
<span class="hljs-keyword">const</span> optNumberValidator = Trava.Optional(numberValidator, <span class="hljs-number">2</span>); <span class="hljs-comment">// 2 is default</span>
optNumberValidator(<span class="hljs-literal">undefined</span>); <span class="hljs-comment">// 2</span>
optNumberValidator(<span class="hljs-literal">null</span>); <span class="hljs-comment">// null</span><font></font>
<font></font>
<span class="hljs-keyword">const</span> nullNumberValidator = Trava.Nullable(numberValidator, <span class="hljs-number">3</span>); <span class="hljs-comment">// 3 is default</span>
nullNumberValidator(<span class="hljs-literal">undefined</span>); <span class="hljs-comment">// 3</span>
nullNumberValidator(<span class="hljs-literal">null</span>); <span class="hljs-comment">// 3</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
芝生にはさらにいくつかのヘルパーオペレーターがあり、それらはすべて美しく、驚くほど単純に拡張して構成されています。</font><font style="vertical-align: inherit;">通常の関数のように:)</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">階層</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
単純なデータ型は階層構造になっています。</font><font style="vertical-align: inherit;">最も一般的なケースはオブジェクトと配列です。</font><font style="vertical-align: inherit;">芝生には、作業しやすいオペレーターがいます。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">//  </span>
<span class="hljs-keyword">const</span> byteArrayValidator = Trava.Each(byteValidator);<font></font>
byteArrayValidator([<span class="hljs-number">1</span>, <span class="hljs-number">-1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">-3</span>]);
<span class="hljs-comment">// ValidationError: {"1":"Incorrect value","3":"Incorrect value"}</span><font></font>
<font></font>
<span class="hljs-comment">//  </span>
<span class="hljs-keyword">const</span> pointValidator = Trava.Keys({
  <span class="hljs-attr">x</span>: numberValidator,
  <span class="hljs-attr">y</span>: numberValidator,<font></font>
});<font></font>
pointValidator({<span class="hljs-attr">x</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">y</span>: <span class="hljs-string">'a'</span>}); <span class="hljs-comment">// ValidationError: {"y":"Incorrect value"}</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
オブジェクトを検証するとき、定義の重要度を強調することが決定されました。すべてのキーはデフォルトで</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必須</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">です（</font><b><font style="vertical-align: inherit;">Requiredに</font></b><font style="vertical-align: inherit;">ラップされています</font><font style="vertical-align: inherit;">）。バリデータで指定されていないキーは破棄されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一部の</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jsonschema</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">カルテット</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ソリューション</font><font style="vertical-align: inherit;">は、バリデーターをデータとして説明</font><font style="vertical-align: inherit;">する</font><font style="vertical-align: inherit;">ことを好みます（例：{x： 'number'、y： 'number'}）。このアプローチの重要な利点は、回路ではシリアル化および交換が可能であり、機能では不可能です。ただし、これは機能インターフェースの上に簡単に実装できます。関数を線の後ろに隠す必要はありません！関数にはすでに名前があり、それだけで十分です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
バリデーター内での使いやすさのために、</font><b><font style="vertical-align: inherit;">Compose</font></b><font style="vertical-align: inherit;">ステートメント</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">そして</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">キーは</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">でルートバリデータをラップするためにも便利です、省略することができ</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Trava</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> pointValidator = Trava({  <span class="hljs-comment">//  -&gt; Keys</span>
  <span class="hljs-attr">x</span>: [numberValidator, Trava.Check(<span class="hljs-function"><span class="hljs-params">v</span> =&gt;</span> v &gt; <span class="hljs-number">180</span>)],  <span class="hljs-comment">//  -&gt; Compose</span>
  <span class="hljs-attr">y</span>: [numberValidator, Trava.Check(<span class="hljs-function"><span class="hljs-params">v</span> =&gt;</span> v &lt; <span class="hljs-number">180</span>)],<font></font>
});</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2番目の引数を指定して</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Trava</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">
呼び出す</font><font style="vertical-align: inherit;">と、戻り値はバリデーターを適用した結果になります。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> point = Trava({
  <span class="hljs-attr">x</span>: [numberValidator, Trava.Check(<span class="hljs-function"><span class="hljs-params">v</span> =&gt;</span> v &gt; <span class="hljs-number">180</span>)],
  <span class="hljs-attr">y</span>: [numberValidator, Trava.Check(<span class="hljs-function"><span class="hljs-params">v</span> =&gt;</span> v &lt; <span class="hljs-number">180</span>)],<font></font>
},<font></font>
<span class="hljs-comment">//     </span><font></font>
{<font></font>
  <span class="hljs-attr">x</span>: <span class="hljs-number">200</span>,
  <span class="hljs-attr">y</span>: <span class="hljs-number">100</span>,<font></font>
}); <span class="hljs-comment">// { x: 200, y: 100 }</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これまでのところ、サポートは配列とオブジェクトに対してのみ実装されています。</font><font style="vertical-align: inherit;">基本的にJSONを毒し、それで十分です。</font><font style="vertical-align: inherit;">ウェルカムへのプルリクエスト！</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">環境</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
バリデーターを最後のパラメーターとして使用する場合、呼び出されたすべてのバリデーターからアクセスできるコンテキストを最後のパラメーターとして渡すことができます。</font><font style="vertical-align: inherit;">個人的には、この機会はまだ役に立ちませんが、可能です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
エラーを返す可能性がある一部のバリデーターでは、さまざまなレベルでエラーメッセージを定義することができます。</font><font style="vertical-align: inherit;">例：</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> pos = Trava.Check(<span class="hljs-function"><span class="hljs-params">v</span> =&gt;</span> v &gt; <span class="hljs-number">0</span>);<font></font>
pos(<span class="hljs-number">-1</span>);  <span class="hljs-comment">// ValidationError: "Incorrect value" (by default)</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1つのケースのオーバーライド：</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> pos = Trava.Check(<span class="hljs-function"><span class="hljs-params">v</span> =&gt;</span> v &gt; <span class="hljs-number">0</span>, <span class="hljs-string">"    "</span>);<font></font>
pos(<span class="hljs-number">-1</span>); <span class="hljs-comment">// ValidationError: "    "</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべてのケースで上書き：</font></font><br>
<br>
<pre><code class="javascript hljs">Trava.Check.ErrorMessage = <span class="hljs-string">" "</span>;<font></font>
pos(<span class="hljs-number">-1</span>); <span class="hljs-comment">// ValidationError: " "</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、より詳細な構成のために、エラーの場所で関数を転送することができます。これはエラーを返す必要があり、検証パラメーターで呼び出されます。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用事例</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ほとんどの場合、koaとともにバックエンドでJSONを毒します。</font><font style="vertical-align: inherit;">フロントエンドもゆっくりと座っています。</font><font style="vertical-align: inherit;">両端に共通のバリデータがあると便利です。</font><font style="vertical-align: inherit;">そして今、私はほとんど実際のユースケースを示します。</font><font style="vertical-align: inherit;">患者データを作成および更新するAPIを実装するとします。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">// validators.js</span>
<span class="hljs-keyword">const</span> trava = <span class="hljs-built_in">require</span>(<span class="hljs-string">'trava'</span>);
<span class="hljs-keyword">const</span> { isFilledString, isDate, isNumber } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../common/validators'</span>);<font></font>
<font></font>
<span class="hljs-keyword">const</span> patientSchema = {
  <span class="hljs-attr">name</span>: isFilledString,
  <span class="hljs-attr">dateOfBirth</span>: isDate,
  <span class="hljs-attr">height</span>: isNumber,<font></font>
}<font></font>
<span class="hljs-comment">//       </span>
<span class="hljs-comment">//     </span>
<span class="hljs-keyword">const</span> patientNew = trava(patientSchema);
<span class="hljs-comment">//     </span>
<span class="hljs-keyword">const</span> patientPatch = trava(mapValues(patientSchema, trava.Optional));<font></font>
<font></font>
<span class="hljs-built_in">module</span>.exports = {<font></font>
  patientNew,<font></font>
  patientPatch,<font></font>
};<font></font>
<font></font>
<span class="hljs-comment">// controllers.js</span>
<span class="hljs-keyword">const</span> validate = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./validators'</span>);
<span class="hljs-keyword">const</span> { ValidationError } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../common/errors'</span>);<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">create</span> (<span class="hljs-params">ctx</span>) </span>{
  <span class="hljs-keyword">const</span> patientData = validate.patientNew(ctx.request.body);
  <span class="hljs-comment">//       Error,             Error</span>
  <span class="hljs-keyword">if</span> (patientData <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Error</span>) <span class="hljs-keyword">return</span> ValidationError(ctx, patientData);<font></font>
  <font></font>
   <span class="hljs-comment">// ...create new patient</span><font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">update</span> (<span class="hljs-params">ctx</span>) </span>{
  <span class="hljs-keyword">const</span> patientData = validate.patientPatch(ctx.request.body);
  <span class="hljs-keyword">if</span> (patientData <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Error</span>) <span class="hljs-keyword">return</span> ValidationError(ctx, patientData);<font></font>
  <font></font>
   <span class="hljs-comment">// ...update patient data</span><font></font>
}<font></font>
</code></pre><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">共通/errors.js</font></font></b><div class="spoiler_text">const trava = require('trava');<br>
<br>
function ValidationError (ctx, params) {<br>
 if (params instanceof Error) {<br>
 params = trava.ValidationError.extractData(params);<br>
 }<br>
 ctx.body = {<br>
 code: 'VALIDATION_ERROR',<br>
 params,<br>
 };<br>
 ctx.status = HttpStatus.BAD_REQUEST;<br>
}<br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この例は非常に単純ですが、単純化したものとは言えません。</font><font style="vertical-align: inherit;">実際のアプリケーションでは、バリデーターのみが複雑になります。</font><font style="vertical-align: inherit;">ミドルウェアで検証を行うこともできます。バリデーターは、完全にコンテキストまたはリクエストの本文に適用されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
検証の作業と使用の過程で、単純な同期バリデーターと単純なエラーメッセージで十分であるという結論に達しました。</font><font style="vertical-align: inherit;">実際、「REQUIRED」と「INVALID」の2つのメッセージのみを使用するという結論に達しました。これらはフィールドのプロンプトとともにフロントエンドにローカライズされています。</font><font style="vertical-align: inherit;">追加のアクションが必要な他のチェック（たとえば、そのようなメールがすでに存在することを確認するための登録時）は、検証の範囲外です。</font><font style="vertical-align: inherit;">いずれにせよ、草はこのケースについてではありません。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">拘留されて</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この短い記事では、ライブラリのほぼすべての機能について説明しましたが、記事の範囲を超えて、ライフを簡略化するヘルパーがいくつかあります。</font><font style="vertical-align: inherit;">github </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github.com/uNmAnNeR/travajs</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で詳細を尋ねます</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
可能な限りカスタマイズできるツールが必要でした。余分なものは何もありませんが、同時に日常の作業に必要なものがすべて揃っています。</font><font style="vertical-align: inherit;">そして、一般的にはこれが達成されたと思います。誰かが生活を楽にしてくれることを願っています。</font><font style="vertical-align: inherit;">私は希望や提案を喜んでいたします。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
健康のために。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja462175/index.html">ラテン語の略語やフレーズは英語で扱っています</a></li>
<li><a href="../ja462177/index.html">ファースマンにちなんで名付けられた鉱物学博物館の写真ツアー</a></li>
<li><a href="../ja462179/index.html">F文字列、またはコードをもう少し速く読みやすくする方法</a></li>
<li><a href="../ja462181/index.html">グループチャットでの効果的なコミュニケーションのルール</a></li>
<li><a href="../ja462185/index.html">革命は終わりました。リチウムイオン電池の代替品はありますか？</a></li>
<li><a href="../ja462191/index.html">DataArt Museum：北イタリアのツアー</a></li>
<li><a href="../ja462197/index.html">心を解放し、創造性を高める方法に関するヒント</a></li>
<li><a href="../ja462203/index.html">KVM（アンダー）VDI、bashを使用した1回限りの仮想マシン</a></li>
<li><a href="../ja462209/index.html">ポリコムのビデオ会議ソリューション。6年後の思い出...ステージ2。パート1。RMX1500</a></li>
<li><a href="../ja462213/index.html">学び、働きます：情報技術およびプログラミング学部の学部生の経験</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>