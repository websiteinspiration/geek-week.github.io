<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>💎 🤲🏿 🚗 Automatisches Gartenbewässerungssystem für Home Assistant, ESP8266 und MiFlora 👎🏿 👎🏿 🚴🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Vor einiger Zeit hatte meine Familie ein Haus mit einem kleinen Garten an einem sehr warmen und trockenen Ort, und wir standen vor dem Problem der reg...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Automatisches Gartenbewässerungssystem für Home Assistant, ESP8266 und MiFlora</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/497606/"><img src="https://habrastorage.org/webt/87/-y/wi/87-ywilifgui1kkhe06izsbt7ag.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vor einiger Zeit hatte meine Familie ein Haus mit einem kleinen Garten an einem sehr warmen und trockenen Ort, und wir standen vor dem Problem der regelmäßigen Bewässerung. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich wollte, dass das Bewässerungssystem automatisch ist, während ich es auswählte, musste ich die folgenden Bedingungen berücksichtigen:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sehr teures Wasser, das auf alle verfügbaren Arten gespart werden muss </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Verschiedene Pflanzen im Garten für den Feuchtigkeitsbedarf, von Sukkulenten bis zu feuchtigkeitsliebenden</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> die Notwendigkeit einer vollständig autonomen Bewässerung während der Abwesenheit von Personen im Haus, vorzugsweise mit der Möglichkeit der Fernsteuerung </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> trockenes Klima, das Bewässerungsfehler nicht verzeiht</font></font></li>
</ul> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nachdem wir die vorgefertigten Lösungen evaluiert hatten, die in lokalen DIY-Netzwerken und bei Amazon gefunden wurden, und Bewertungen über ihre Zuverlässigkeit gelesen hatten (normalerweise nicht die höchste), beschlossen wir, etwas selbst zu tun. </font></font><br>
<a name="habracut"></a><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Haftungsausschluss: Der Autor ist kein IT-Spezialist und erhebt keinen Anspruch auf Fachkenntnisse des Themas. </font><font style="vertical-align: inherit;">Der Grad der Projektdurchführung ist ein Hobby. </font><font style="vertical-align: inherit;">Der Autor ist sich seines Kenntnisstands in Programmierung und Elektronik bewusst und wird Vorschläge zur Verbesserung und Optimierung der verwendeten Lösungen sehr schätzen.</font></font></i><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Schaltplan</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Garten wurde in 4 Bewässerungszonen unterteilt, von denen jede mit einem individuellen Bodenfeuchtesensor ausgestattet ist und nach einem individuellen Zeitplan und einer anderen Wassermenge bewässert werden kann. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Auf dem Boden werden PND-Rohre für die Tropfbewässerung mit Perforation verlegt, die mit Rohren verbunden sind, die in der Wassersammeleinheit zusammenlaufen, und über die elektromagnetischen Ventile mit der Wasserversorgung verbunden sind. </font><font style="vertical-align: inherit;">Die Ventile werden über Relais gesteuert, die an den ESP8266 (Sonoff 4Ch) angeschlossen sind. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Bewässerung erfolgt nachts durch Zeitschaltuhren, um die Menge an Wasser zu erhöhen, die vom Boden aufgenommen wird und von der Sonne nicht verdunstet wird. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zum geplanten Bewässerungszeitpunkt wird die Einhaltung mehrerer Bedingungen überprüft:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Bodenfeuchtigkeit unter einem vorgegebenen Wert </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Für die nächsten 2 Tage wird kein ausreichend großer Niederschlag vorhergesagt </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die für diese Leitung festgelegte Wassergrenze für die Bewässerung wird nicht überschritten</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gebrauchte Ausrüstung</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Raspberry Pie</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mit installiertem HassIO (bereits vorhanden) </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ESP32 DevKit</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , einer ESPHome-Firmware, die als Bluetooth-Gateway für MiFlora fungiert und Daten von kabelgebundenen Feuchtigkeitssensoren empfängt. </font><font style="vertical-align: inherit;">Befindet sich im Garten. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Verkabelte Feuchtigkeitssensoren </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kapazitiver Bodenfeuchtesensor v1.2</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , der die Luftfeuchtigkeit in den Bewässerungszonen misst, die dem ESP32-Installationsort am nächsten liegen. MiFlora- </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sensoren sind</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> über BLE mit dem ESP32 verbunden, der die Feuchtigkeit in entfernten Bewässerungszonen misst. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SONOFF 4Ch</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , mit ESPHome vernäht, befindet sich in der Wasseransaugeinheit, wo Rohre aus allen Bewässerungszonen kommen. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4 Normalerweise geschlossene Magnetventile für 220 V.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">befindet sich im Wasserstand und ist mit dem Sonoff 4Ch verbunden. Öffnen Sie die Wasserversorgung zur Bewässerung. Ein normalerweise geschlossenes Modell wurde so gewählt, dass die Wahrscheinlichkeit eines „Überflutens“ bei einem Ausfall der Elektrik und Elektronik minimal war und die Anzahl der erforderlichen Relaisausgänge minimiert wurde. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ein gepulster Wasserzähler</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> am Eingang zum Bewässerungssystem in der Wasseransaugeinheit und angeschlossen an den Sonoff 4ch. Erlaubt die vollständige Übertragung von Wasserflussdaten an Home Asssistant und die Implementierung der Bewässerungsfunktion mit einer bestimmten Menge. Es stellte sich als sehr erfolgreich heraus, dass bei dieser Version von sonoff die Kontakte für die Firmware bereits verlötet waren und es sogar einen freien GPIO02 gab - ein Impulszähler wurde daran gehängt.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ec/zz/d9/eczzd9zfq4drf8katpm4ofyn0b4.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es sieht aus wie ein Kollektor mit installierten Ventilen und einem Wasserzähler. </font><font style="vertical-align: inherit;">Der Controller (sonoff 4Ch) ist nicht in den Rahmen eingedrungen, er ist in einem Abstand von einem halben Meter in der IP65-Abschirmung installiert</font></font></i><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ESPHome- und Home Assistant-Einstellungen</font></font></h3><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sonoff 4ch</font></font></b><div class="spoiler_text"> ESPHome    ,     :<br>
<br>
<pre><code class="xml hljs">switch:<font></font>
  - platform: gpio<font></font>
    name: "   1"<font></font>
    pin: GPIO12<font></font>
    id: sw1<font></font>
    icon: mdi:water<font></font>
  - platform: gpio<font></font>
    name: "   2"<font></font>
    pin: GPIO5<font></font>
    id: sw2<font></font>
    icon: mdi:water<font></font>
  - platform: gpio<font></font>
    name: "   3"<font></font>
    pin: GPIO4<font></font>
    id: sw3<font></font>
    icon: mdi:water<font></font>
  - platform: gpio<font></font>
    name: "   4"<font></font>
    pin: GPIO15<font></font>
    id: sw4<font></font>
    icon: mdi:water<font></font>
binary_sensor:<font></font>
  - platform: gpio<font></font>
    name: "WaterCounter"<font></font>
    id: button<font></font>
    pin:<font></font>
      number: GPIO2<font></font>
      mode: INPUT_PULLUP<font></font>
</code></pre><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kapazitiver Bodenfeuchtesensor v1.2</font></font></b><div class="spoiler_text">   ESPHome:<br>
<br>
<pre><code class="xml hljs">sensor:<font></font>
  - platform: adc<font></font>
    pin: GPIO34<font></font>
    filters:<font></font>
      - lambda: |-<font></font>
          if (x &gt; 3.22) {<font></font>
            return 0;<font></font>
          } else if (x <span class="hljs-tag">&lt; <span class="hljs-attr">1.65</span>) {
            <span class="hljs-attr">return</span> <span class="hljs-attr">100</span>;
          } <span class="hljs-attr">else</span> {
            <span class="hljs-attr">return</span> (<span class="hljs-attr">3.22-x</span>) / (<span class="hljs-attr">3.22-1.65</span>) * <span class="hljs-attr">100.0</span>;
          }
    <span class="hljs-attr">name:</span> "   <span class="hljs-attr">1</span>  "
    <span class="hljs-attr">update_interval:</span> <span class="hljs-attr">60s</span>
    <span class="hljs-attr">attenuation:</span> <span class="hljs-attr">11db</span>
    <span class="hljs-attr">unit_of_measurement:</span> "%"
    <span class="hljs-attr">accuracy_decimals:</span> <span class="hljs-attr">0</span>
    <span class="hljs-attr">icon:</span> <span class="hljs-attr">mdi:water-percent</span>
</span></code></pre><br>
       (ADC)  <br>
  ,        (   3.22 )     (1,65 ).      log'   ESPHome  HassIO            .<br>
<br>
<img src="https://habrastorage.org/webt/sb/tf/b4/sbtfb4ckgxx7kltxe6kk8a5q0r4.png"><br>
<br>
  ESP32  Home Assistant    ,         <br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pulswasserzähler</font></font></b><div class="spoiler_text">   «»,          (   ).       —      ,   ,        (  —  3   10 ). <br>
,      GND    GPIO      .<br>
<br>
  ESPHome   : <br>
<br>
<pre><code class="xml hljs">binary_sensor:<font></font>
  - platform: gpio<font></font>
    name: "WaterCounter"<font></font>
    id: counter<font></font>
    pin:<font></font>
      number: GPIO2<font></font>
      mode: INPUT_PULLUP<font></font>
</code></pre><br>
 Home Assistant   :<br>
<br>
     (counter),       <br>
          (,   «»  ).      —  counter,              ESPHome,   sensor,          counter (       ).<br>
<br>
           2      —    ,    «».       ,   ,                      . <br>
<br>
<div class="spoiler"><b class="spoiler_title">    ( automations.yaml   )</b><div class="spoiler_text"><pre><code class="xml hljs">- alias:     <font></font>
  trigger:<font></font>
  - entity_id: binary_sensor.watercounter<font></font>
    platform: state<font></font>
    from: 'on'<font></font>
    to: 'off'<font></font>
  action:<font></font>
  - data:<font></font>
      entity_id:<font></font>
      - counter.my_water_counter<font></font>
    service: counter.increment<font></font>
- alias:    1 <font></font>
  trigger:<font></font>
  - entity_id: binary_sensor.watercounter<font></font>
    platform: state<font></font>
    from: 'on'<font></font>
    to: 'off'<font></font>
  condition:<font></font>
    - condition: state<font></font>
      entity_id: switch.sistema_poliva_liniia_1<font></font>
      state: 'on'<font></font>
  action:<font></font>
  - data:<font></font>
      entity_id:<font></font>
      - counter.my_water_line1, counter.my_water_line1t<font></font>
    service: counter.increment    <font></font>
</code></pre><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title">  configuration.yaml    +      </b><div class="spoiler_text"><pre><code class="xml hljs"><font></font>
sensor:<font></font>
  - platform: template<font></font>
    sensors:<font></font>
      water_counter:    <font></font>
        unit_of_measurement: 'M3'<font></font>
        value_template: "{{ (states('counter.my_water_counter')| float)/1000 }}"    <font></font>
counter:<font></font>
  my_water_counter:<font></font>
    initial: 2.667<font></font>
    step: 10<font></font>
  my_water_line1:<font></font>
    name: " 1     ()"<font></font>
    initial: 0<font></font>
    step: 10<font></font>
  my_water_line1t:<font></font>
    name: " 1   ()"<font></font>
    initial: 0<font></font>
    step: 10<font></font>
</code></pre><br>
</div></div><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MiFlora Sensor</font></font></b><div class="spoiler_text"> MiFlora   ESPHome   ,       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow">esphome.io</a> <br>
 Home Assistant          — , ,   «» .   —     ,        .<br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Virtueller Niederschlagssensor</font></font></b><div class="spoiler_text">   —          .            ,   . <br>
<br>
       darksky.  ,          Apple        « ». API  , ,   ,      ,   HA     .      darksky, ,          .<br>
<br>
  2        :<br>
<br>
<div class="spoiler"><b class="spoiler_title">  configuration.yaml  sensors.yaml   </b><div class="spoiler_text"><pre><code class="xml hljs"><font></font>
sensor:<font></font>
  - platform: darksky<font></font>
    api_key: xxxx_your_API_key_xxxx<font></font>
    forecast:<font></font>
      - 1<font></font>
      - 2<font></font>
    monitored_conditions:<font></font>
      - precip_intensity<font></font>
</code></pre><br>
   HA   : sensor.dark_sky_precip_intensity_1d  sensor.dark_sky_precip_intensity_2d,              .<br>
</div></div><br>
       template-sensor:<br>
<br>
<div class="spoiler"><b class="spoiler_title">  configuration.yaml  sensors.yaml    </b><div class="spoiler_text"><pre><code class="xml hljs"><font></font>
sensor:<font></font>
  - platform: template<font></font>
    sensors:<font></font>
       rain2days:    <font></font>
        unit_of_measurement: 'mm'<font></font>
        value_template: "{{ (((states('sensor.dark_sky_precip_intensity_2d')| float)+(states('sensor.dark_sky_precip_intensity_1d')| float))*24)| round(3) }}"    <font></font>
</code></pre><br>
 HA  sensor.rain2days          2 . <br>
  ,   Darksky         ,              <br>
</div></div><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nachdem alle Daten gesammelt wurden, können Sie direkt mit dem Gießen fortfahren. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So sehe ich einen Teil der Benutzeroberfläche aus einer der Zonen im Home Assistant: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/pf/l6/ut/pfl6ut8aoieytcg0kxlk-mjslcu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hier können Sie die Wassermenge für die Bewässerung einstellen (mit einem Schieberegler) und die Werte der Hauptsensoren und -zähler anzeigen. </font><font style="vertical-align: inherit;">Ich habe die Schnittstelle für eine der Leitungen angegeben, im Übrigen ist alles gleich, nur bei Leitungen mit kabelgebundenen Datensensoren ist es etwas weniger.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In der Benutzeroberfläche sehen Sie ein „überflüssiges“ Detail - den Hilfssensor „Die Norm wurde erreicht“. </font><font style="vertical-align: inherit;">Es musste eingeführt werden, weil </font><font style="vertical-align: inherit;">Ich konnte keine Bedingung erhalten: Vorlage zum Arbeiten, um die Automatisierung zu stoppen, wenn die Norm für die Wassermenge erreicht wurde, und als Ergebnis überprüft die Automatisierung nur den Wert dieses Sensors. </font><font style="vertical-align: inherit;">Ich bin sicher, dass dieser Teil der Automatisierung einfacher und eleganter gestaltet werden kann, aber mein Niveau hat dafür nicht gereicht. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unten ist der Code für den resultierenden "Krücken" -Schablonensensor:</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bewässerungssensor (innerhalb der Konfiguration.yaml oder einer separaten Datei)</font></font></b><div class="spoiler_text"><pre><code class="xml hljs">  - platform: template<font></font>
    sensors:<font></font>
      line4_status:<font></font>
        friendly_name: " 4 -  "<font></font>
        value_template: &gt;-<font></font>
          {% if states('counter.my_water_line4t')|float &gt; states('input_number.slider4')|float %}<font></font>
            yes<font></font>
          {% elif states('counter.my_water_line4t')|float == states('input_number.slider4')|float  %}<font></font>
            yes<font></font>
          {% else %}<font></font>
            no<font></font>
          {% endif %}<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Automatisierung zum Bewässern sieht letztendlich so aus:</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beginnen Sie mit dem Gießen (in automations.yaml oder einer separaten Datei)</font></font></b><div class="spoiler_text"><pre><code class="xml hljs">- alias:   4   23.01<font></font>
  trigger:<font></font>
    platform: time<font></font>
    at: "23:01:00"<font></font>
  condition:<font></font>
   condition: and<font></font>
   conditions:<font></font>
#    <font></font>
    - condition: numeric_state<font></font>
      entity_id: sensor.rainfor2days<font></font>
      below: 5<font></font>
#      <font></font>
    - condition: numeric_state<font></font>
      entity_id: sensor.miflora_1_moisture<font></font>
      below: 50<font></font>
# ,       <font></font>
    - condition: state<font></font>
      entity_id: 'sensor.line4_status'<font></font>
      state: 'no'<font></font>
  action:<font></font>
   - service: switch.turn_on<font></font>
     entity_id: switch.sistema_poliva_liniia_4<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Bewässerung beginnt am späten Abend, wobei jede Linie in einem eigenen Zeitintervall beginnt. </font><font style="vertical-align: inherit;">Durch die Trennung nach Startzeit können Sie einen Einlasswasserzähler verwenden, um Daten auf 4 Leitungen zu erhalten. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beim Start werden drei Bedingungen überprüft:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wird die Grenze für die Wassermenge für heute nicht überschritten (wenn beispielsweise die manuelle Bewässerung aktiviert wurde)?</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Überschreitet die Luftfeuchtigkeit 50% (nach Beobachtungen unter unseren Bedingungen hat frisch verschütteter Boden einen Feuchtigkeitsgehalt von nicht mehr als 60%)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ein Niederschlag von mehr als 5 mm wird in den nächsten zwei Tagen nicht erwartet.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die nächste Automatisierung ist das Deaktivieren der Bewässerung:</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Deaktivieren der Bewässerung (in automations.yaml oder einer separaten Datei)</font></font></b><div class="spoiler_text"><pre><code class="xml hljs">- alias:   4 <font></font>
  trigger:<font></font>
#      <font></font>
  - entity_id: sensor.line4_status<font></font>
    platform: state<font></font>
    to: 'yes'<font></font>
    for: <font></font>
      seconds: 5    <font></font>
#   <font></font>
  - platform: time<font></font>
    at: "23:59:00"<font></font>
#     <font></font>
  - platform: numeric_state<font></font>
    entity_id: sensor.miflora_1_moisture<font></font>
    above: 65<font></font>
#       <font></font>
  - platform: state<font></font>
    entity_id: switch.sistema_poliva_liniia_4<font></font>
    to: 'on'<font></font>
    for: <font></font>
      minutes: 60<font></font>
  action:<font></font>
   - service: switch.turn_off<font></font>
     entity_id: switch.sistema_poliva_liniia_4<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In der Automatisierung wurden bis zu 4 Varianten von Auslösern verwendet, in den meisten Fällen wird sie jedoch vom ersten ausgelöst - einem „Krückensensor“, der den Grenzwertüberschuss durch die Wassermenge überwacht. </font><font style="vertical-align: inherit;">Der Rest der Auslöser erfolgt aus Sicherheitsgründen weitgehend. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nun, die letzte Automatisierung im Zusammenhang mit dem Problem ist das Zurücksetzen des Tageszählers</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nullstellen des Tageszählers (in automations.yaml oder einer separaten Datei)</font></font></b><div class="spoiler_text"><pre><code class="xml hljs"><font></font>
- alias:    4 <font></font>
  trigger:<font></font>
  - platform: time<font></font>
    at: "00:00:01"<font></font>
  action:<font></font>
  - service: counter.reset<font></font>
    entity_id: counter.my_water_line4t<font></font>
</code></pre><br>
</div></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Projektökonomie</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Kosten für den Steuerungsteil des Bewässerungssystems waren wie folgt: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(Raspberry PIE mit HassIO an Bord und ein WLAN-Router mit einer Beschichtung im Garten waren bereits vor Projektbeginn, ich berücksichtige sie nicht) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
UNIPUMP BCX-15 1/2 "Magnetventil (normalerweise geschlossen) 4 * 20 Euro </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sonoff 4CH 17 Euro Pulsmesser </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pulsar 8 Euro </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ESP32 DevKitC 3,5 Euro </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kapazitiver Bodenfeuchtesensor v1.2 2 * 0,67 Euro </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MiFlora-Sensoren 2 * 16 Euro Schutzvorrichtungen </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
, Kollektor, Drähte, Armaturen insgesamt ca. 50 Euro </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GESAMT: ca. 190 Euro</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Zeit, die für die Einrichtung der Sensoren und des MK aufgewendet wird, beträgt mehrere Stunden zwischen 15 und 15 Uhr. Die meiste Zeit wurde jedoch für die „Erfindung von Fahrrädern“ und „Krücken“ aufgewendet. Im Allgemeinen gibt es nicht viel Arbeit. </font><font style="vertical-align: inherit;">Die physische Montage des Systems dauerte ca. 2 Abende. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im Allgemeinen werden Wassereinsparungen von etwa 20-50% im Vergleich zum „albernen“ Zeitgebersystem erwartet, und bei lokalen Wasserpreisen sollte sich das System in ein oder zwei Jahreszeiten auszahlen.</font></font><br>
 <br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mängel und Pläne für eine Überarbeitung</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Als Ergebnis des Projekts wurden einige Nuancen und Möglichkeiten zur weiteren Verbesserung aufgezeigt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Insbesondere würde ich 220-V-Magnetventile durch ein 24-V-Modell ersetzen - diese Spannung ist Standard für Bewässerungssysteme. In diesem Fall müssten Sie dem System einen 24-V-Transformator hinzufügen und den Sonoff 4Ch gegen einen trockenen Kontakt austauschen (z. B. Sonoff 4CH Pro oder etwas Selbstmontiertes). Die Ventile selbst sind billiger (ab 8 Euro) und verringern die Wahrscheinlichkeit eines Stromschlags. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es stellte sich auch heraus, dass für die Arbeit mit Kunststoffrohrleitungen der Druck aus der Wasserversorgung zu hoch ist und die Armaturen während des Bewässerungszyklus undicht werden können. In meinem Fall ist dies nicht kritisch, alle Armaturen befinden sich über dem Bewässerungsboden, aber auf gute Weise müssen Sie am Einlass ein Reduzierstück hinzufügen, um den Druck zu senken.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich war immer noch ein wenig verärgert über die Unmöglichkeit, die Menge an Wasser für die Bewässerung in Mengen von weniger als 10 Litern zu berücksichtigen - dieses Volumen ist die messbare Mindestmenge für einen solchen Zähler. </font><font style="vertical-align: inherit;">Dieses Problem kann gelöst werden, indem der Zähler zerlegt und die Räder ausgetauscht werden. Bis dahin haben die Hände ihn jedoch nicht erreicht.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de497588/index.html">Spring Security - Ein Beispiel für eine OAuth2-Autorisierungs-Webanwendung über BitBucket</a></li>
<li><a href="../de497590/index.html">Wir beschäftigen uns mit dem Wellenfunktionskollapsalgorithmus</a></li>
<li><a href="../de497594/index.html">Externer Datenspeicher: von IBM 1311 bis heute. Teil 1</a></li>
<li><a href="../de497596/index.html">Es lebe PHP</a></li>
<li><a href="../de497602/index.html">Betrachten Sie sich als Unterzeichner? Wen scherzen Sie?</a></li>
<li><a href="../de497608/index.html">Wie Verkehrsanalysesysteme Hacker-Taktiken erkennen von MITRE ATT & CK, Teil 5</a></li>
<li><a href="../de497612/index.html">Die Geschichte, wie mich die unsichtbare Hand des Marktes an einen abgelegenen Ort brachte</a></li>
<li><a href="../de497614/index.html">Gedankenexperimente, Paradoxien und Grenzen der Logik // Wir sind zum Scheitern verurteilt # 2</a></li>
<li><a href="../de497616/index.html">Interview mit Alexander Makarov (Yii) über Opensource, Konferenzen und Yii</a></li>
<li><a href="../de497618/index.html">Umsetzung des Konzepts des hochsicheren Fernzugriffs</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>