<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§í üêª üöµüèæ Acelerando o frontend. Quando muitas solicita√ß√µes de servidor s√£o boas üóÑÔ∏è ü§öüèΩ üìü</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Este artigo descreve alguns m√©todos para acelerar o carregamento de aplicativos front-end para implementar uma interface de usu√°rio r√°pida e responsiv...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Acelerando o frontend. Quando muitas solicita√ß√µes de servidor s√£o boas</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/itsumma/blog/490210/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Este artigo descreve alguns m√©todos para acelerar o carregamento de aplicativos front-end para implementar uma interface de usu√°rio r√°pida e responsiva. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Discutiremos a arquitetura geral do front-end, como pr√©-carregar os recursos necess√°rios e aumentar a probabilidade de eles estarem no cache. </font><font style="vertical-align: inherit;">Discutiremos um pouco sobre como fornecer recursos do back-end e quando √© poss√≠vel limitar-nos a p√°ginas est√°ticas, em vez de um aplicativo cliente interativo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O processo de download √© dividido em tr√™s etapas. </font><font style="vertical-align: inherit;">Para cada est√°gio, formulamos estrat√©gias gerais para aumentar a produtividade:</font></font><br>
<br>
<ol>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Renderiza√ß√£o inicial</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : quanto tempo leva para o usu√°rio ver pelo menos algo</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reduzir solicita√ß√µes de bloqueio de renderiza√ß√£o</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Evite cadeias seq√ºenciais</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reutilizar conex√µes do servidor</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Trabalhadores de servi√ßo para renderiza√ß√£o instant√¢nea</font></font></li>
</ul></li>
<li><b> </b>:   ,     <br>
<ul>
<li>    .    .    <br>
</li>
<li>,        <br>
</li>
<li>       <br>
</li>
<li>     <br>
</li>
<li>    </li>
</ul></li>
<li><b> </b>:        <br>
<ul>
<li>    ,   <br>
</li>
<li>      </li>
</ul></li>
</ol><a name="habracut"></a><br>
<h1> </h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
At√© a renderiza√ß√£o inicial, o usu√°rio n√£o v√™ nada na tela. O que precisamos para esta renderiza√ß√£o? No m√≠nimo, fa√ßa upload de um documento HTML e, na maioria dos casos, recursos adicionais, como arquivos CSS e JavaScript. Uma vez dispon√≠veis, o navegador pode iniciar algum tipo de renderiza√ß√£o. </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">Os</font></a></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
gr√°ficos </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WebPageTest</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> s√£o fornecidos neste artigo </font><font style="vertical-align: inherit;">. A sequ√™ncia de consulta para o seu site provavelmente ter√° algo parecido com isto. </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/36a/970/f6e/36a970f6e3069679776958e6e0ef10d8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O documento HTML carrega v√°rios arquivos adicionais e a p√°gina √© renderizada ap√≥s o download. Observe que os arquivos CSS s√£o carregados em paralelo entre si, portanto, cada solicita√ß√£o adicional n√£o adiciona atraso significativo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(Nota: na captura de tela, gov.uk √© um exemplo em que o </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">HTTP / 2</font></a><font style="vertical-align: inherit;"> agora </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">est√° ativado</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para que o dom√≠nio do recurso possa reutilizar uma conex√£o existente. </font><font style="vertical-align: inherit;">Veja abaixo as conex√µes do servidor.)</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reduzir solicita√ß√µes de bloqueio de renderiza√ß√£o</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Folhas de estilo e scripts (por padr√£o) bloqueiam a renderiza√ß√£o de qualquer conte√∫do abaixo deles. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Existem v√°rias op√ß√µes para corrigir isso:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mover tags de script para a parte inferior do corpo </font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fa√ßa o download de scripts no modo ass√≠ncrono usando </font></font><code>async</code><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se JS ou CSS devem ser carregados sequencialmente, √© melhor incorpor√°-los com pequenos trechos</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Evite conversas com solicita√ß√µes sequenciais que bloqueiam a renderiza√ß√£o</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O atraso na renderiza√ß√£o do site n√£o est√° necessariamente associado a um grande n√∫mero de solicita√ß√µes que bloqueiam a renderiza√ß√£o. </font><font style="vertical-align: inherit;">Mais importante √© o tamanho de cada recurso, bem como a hora de in√≠cio do seu download. </font><font style="vertical-align: inherit;">Ou seja, o momento em que o navegador percebe subitamente que esse recurso precisa ser baixado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se o navegador detectar a necessidade de baixar o arquivo somente depois de concluir outra solicita√ß√£o, haver√° uma cadeia de solicita√ß√µes. </font><font style="vertical-align: inherit;">Pode se formar por v√°rios motivos:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Regras </font></font><code>@import</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CSS</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fontes da Web referenciadas pelo arquivo CSS</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tags de script ou JavaScript para download</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Veja este exemplo: </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/ebe/a1b/e44/ebea1be44487e800d63034b7fb2e9b79.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um dos arquivos CSS deste site carrega a fonte do Google atrav√©s da regra </font></font><code>@import</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Isso significa que o navegador deve se revezar na execu√ß√£o dos seguintes pedidos:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Documento HTML</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aplica√ß√µes CSS</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CSS para fontes do Google</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Arquivo Woff de fonte do Google (n√£o mostrado no diagrama)</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para corrigir isso, primeiro mova a solicita√ß√£o CSS do Google Fonts da tag </font></font><code>@import</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para o link no documento HTML. </font><font style="vertical-align: inherit;">Ent√£o reduzimos a corrente em um link. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para acelerar ainda mais as coisas, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">incorpore o CSS das fontes do Google</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> diretamente ao seu arquivo HTML ou CSS. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(Lembre-se de que a resposta CSS do servidor do Google Fonts depende da linha do agente do usu√°rio. Se voc√™ fizer uma solicita√ß√£o usando o IE8, o CSS consultar√° o arquivo EOT, o IE11 receber√° o arquivo woff e os navegadores modernos receber√£o o arquivo woff2. Se voc√™ concorda que Se os navegadores antigos ficarem limitados √†s fontes do sistema, voc√™ pode simplesmente copiar e colar o conte√∫do do arquivo CSS para si mesmo).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mesmo ap√≥s o in√≠cio da renderiza√ß√£o, √© improv√°vel que o usu√°rio consiga interagir com a p√°gina, porque a fonte precisa ser carregada para exibir o texto. </font><font style="vertical-align: inherit;">Esse √© um atraso de rede adicional que eu gostaria de evitar. </font><font style="vertical-align: inherit;">O </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">par√¢metro swap</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √© √∫til aqui </font><font style="vertical-align: inherit;">, permite us√°-lo </font></font><code>font-display</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">com o Google Fonts e armazenar fontes localmente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√Äs vezes, a cadeia de consulta n√£o pode ser resolvida. </font><font style="vertical-align: inherit;">Nesses casos, conv√©m considerar </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a tag de pr√©-carregamento ou pr√©-conex√£o</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Por exemplo, o site no exemplo acima pode se conectar </font></font><code>fonts.googleapis.com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">antes que a solicita√ß√£o CSS real chegue.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reutilizando conex√µes do servidor para acelerar solicita√ß√µes</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para estabelecer uma nova conex√£o com o servidor, geralmente s√£o necess√°rias tr√™s trocas de pacotes entre o navegador e o servidor:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pesquisa de DNS</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Estabelecer uma conex√£o TCP</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Estabelecer uma conex√£o SSL</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Depois que a conex√£o √© estabelecida, pelo menos mais uma troca de pacotes √© necess√°ria para enviar uma solicita√ß√£o e receber uma resposta. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O gr√°fico abaixo mostra que iniciar uma liga√ß√£o com quatro servidores diferentes: </font></font><code>hostgator.com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>optimizely.com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>googletagmanager.com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, e </font></font><code>googelapis.com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No entanto, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">solicita√ß√µes subsequentes do servidor podem reutilizar uma conex√£o existente</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">O download </font></font><code>base.css</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tanto </font></font><code>index1.css</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">acontece mais r√°pido porque eles est√£o localizados no mesmo servidor </font></font><code>hostgator.com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">com o qual uma conex√£o j√° foi estabelecida.</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/78d/f76/03c/78df7603c84c54788fbec82a7d0622c7.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reduza o tamanho do arquivo e use CDN</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voc√™ controla dois fatores que afetam o tempo de execu√ß√£o da consulta: o tamanho dos arquivos de recursos e o local dos servidores. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Envie o m√≠nimo poss√≠vel de dados para o usu√°rio e verifique se eles est√£o compactados (por exemplo, usando brotli ou gzip). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As redes de entrega de conte√∫do (CDNs) possuem servidores em todo o mundo. </font><font style="vertical-align: inherit;">Em vez de se conectar a um servidor central, um usu√°rio pode se conectar a um servidor CDN mais pr√≥ximo. </font><font style="vertical-align: inherit;">Assim, a troca de pacotes ser√° muito mais r√°pida. </font><font style="vertical-align: inherit;">Isso √© especialmente adequado para recursos est√°ticos, como CSS, JavaScript e imagens, pois s√£o f√°ceis de distribuir via CDN.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Elimine a lat√™ncia da rede com trabalhadores de servi√ßo</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os t√©cnicos de servi√ßo permitem interceptar solicita√ß√µes antes de envi√°-las para a rede. </font><font style="vertical-align: inherit;">Isso significa que a </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">resposta vem quase instantaneamente</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ! </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/c0c/5b2/7bd/c0c5b27bd4df5e42b3b8e57b2dfb02f2.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Obviamente, isso s√≥ funciona se voc√™ realmente n√£o precisar receber dados da rede. </font><font style="vertical-align: inherit;">A resposta j√° deve estar em cache, para que o benef√≠cio apare√ßa apenas no segundo download do aplicativo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O respons√°vel pelo servi√ßo abaixo armazena em cache o HTML e o CSS necess√°rios para renderizar a p√°gina. </font><font style="vertical-align: inherit;">Quando o aplicativo √© carregado novamente, ele tenta emitir os pr√≥prios recursos em cache - e acessa a rede somente se eles n√£o estiverem dispon√≠veis.</font></font><br>
<br>
<pre><code class="javascript hljs">self.addEventListener(<span class="hljs-string">"install"</span>, <span class="hljs-keyword">async</span> e =&gt; {<font></font>
 caches.open(<span class="hljs-string">"v1"</span>).then(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">cache</span>) </span>{
   <span class="hljs-keyword">return</span> cache.addAll([<span class="hljs-string">"/app"</span>, <span class="hljs-string">"/app.css"</span>]);<font></font>
 });<font></font>
});<font></font>
<font></font>
self.addEventListener(<span class="hljs-string">"fetch"</span>, event =&gt; {<font></font>
 event.respondWith(<font></font>
   caches.match(event.request).then(<span class="hljs-function"><span class="hljs-params">cachedResponse</span> =&gt;</span> {
     <span class="hljs-keyword">return</span> cachedResponse || fetch(event.request);<font></font>
   })<font></font>
 );<font></font>
});</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">este guia,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> explicado em detalhes sobre o uso de workers` servi√ßo para recursos de pr√©-carga e cache.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Baixar aplicativo</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ent√£o, o usu√°rio v√™ algo na tela. </font><font style="vertical-align: inherit;">Que etapas adicionais s√£o necess√°rias para ele usar o aplicativo?</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fa√ßa o download do c√≥digo do aplicativo (JS e CSS)</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fa√ßa o download dos dados necess√°rios para a p√°gina</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Baixe dados e imagens adicionais</font></font></li>
</ol><br>
<img src="https://habrastorage.org/getpro/habr/post_images/175/e7f/810/175e7f810d7e33f9647203ad609b402f.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Observe que n√£o apenas o download de dados da rede pode atrasar a renderiza√ß√£o. </font><font style="vertical-align: inherit;">Depois que seu c√≥digo √© carregado, o navegador deve analis√°-lo, compil√°-lo e execut√°-lo.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fa√ßa o download apenas do c√≥digo necess√°rio e maximize o n√∫mero de ocorr√™ncias no cache</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
‚ÄúQuebrar um pacote‚Äù significa baixar apenas o c√≥digo necess√°rio para a p√°gina atual, n√£o o aplicativo inteiro. </font><font style="vertical-align: inherit;">Isso tamb√©m significa que partes do pacote podem ser armazenadas em cache, mesmo que outras partes tenham sido alteradas e precisem ser recarregadas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como regra, o c√≥digo √© dividido nas seguintes partes:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C√≥digo para uma p√°gina espec√≠fica (espec√≠fica da p√°gina)</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C√≥digo de aplica√ß√£o comum</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M√≥dulos de terceiros que raramente mudam (√≥timo para armazenamento em cache!)</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O Webpack pode fazer essa otimiza√ß√£o automaticamente, quebrar o c√≥digo e reduzir o peso geral da carga. </font><font style="vertical-align: inherit;">O c√≥digo √© dividido em peda√ßos usando o objeto </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">optimization.splitChunks</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Separe o tempo de execu√ß√£o (tempo de execu√ß√£o) em um arquivo separado: dessa forma, voc√™ pode se beneficiar do cache de longo prazo. </font><font style="vertical-align: inherit;">Ivan Akulov escreveu um </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">guia detalhado sobre como dividir um pacote em arquivos separados e armazenar em cache no Webpack</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N√£o √© poss√≠vel alocar automaticamente o c√≥digo para uma p√°gina espec√≠fica. </font><font style="vertical-align: inherit;">Voc√™ deve identificar manualmente as partes que podem ser baixadas separadamente. </font><font style="vertical-align: inherit;">Geralmente, esse √© um caminho ou conjunto de p√°ginas espec√≠fico. </font><font style="vertical-align: inherit;">Use </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">importa√ß√µes din√¢micas</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para carregar lentamente esse c√≥digo.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dividir o pacote geral em partes aumentar√° o n√∫mero de solicita√ß√µes para fazer o download do seu aplicativo. Mas isso n√£o √© um grande problema se as solicita√ß√µes forem executadas em paralelo, especialmente se o site for carregado usando o protocolo HTTP / 2. Voc√™ pode ver isso nas tr√™s primeiras consultas no diagrama a seguir: </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/995/816/714/9958167144c54dc634d1b7daa03077e3.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No entanto, duas consultas consecutivas tamb√©m s√£o vis√≠veis no diagrama. Esses fragmentos s√£o necess√°rios apenas para esta p√°gina espec√≠fica e s√£o carregados dinamicamente </font></font><code>import()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voc√™ pode tentar corrigir o problema inserindo uma tag preload </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">preload</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/955/2cf/efc/9552cfefcbb751b50e378a0834320b73.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas vemos que o tempo total de carregamento da p√°gina aumentou. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√Äs vezes, o pr√©-carregamento de recursos √© contraproducente, pois atrasa o carregamento de arquivos mais importantes. Ler</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Artigo de Andy Davis sobre pr√©-carregamento de fontes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e como esse procedimento bloqueia o in√≠cio da renderiza√ß√£o da p√°gina.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Carregando dados para uma p√°gina</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seu aplicativo provavelmente deve mostrar alguns dados. </font><font style="vertical-align: inherit;">Aqui est√£o algumas dicas que voc√™ pode usar para baixar esses dados mais cedo, sem atrasos desnecess√°rios na renderiza√ß√£o.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N√£o espere o download completo do pacote antes de come√ßar a baixar os dados</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui est√° um caso especial de uma cadeia de solicita√ß√µes sequenciais: voc√™ baixa o pacote de aplicativos inteiro e, em seguida, esse c√≥digo solicita os dados necess√°rios para a p√°gina. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Existem duas maneiras de evitar isso:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Incorporar dados em um documento HTML</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Execute uma solicita√ß√£o de dados usando o script interno dentro do documento</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A incorpora√ß√£o dos dados em HTML garante que o aplicativo n√£o espere o carregamento. Tamb√©m reduz a complexidade do sistema, pois voc√™ n√£o precisa lidar com o status de inicializa√ß√£o. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No entanto, essa n√£o √© uma boa ideia se essa t√©cnica atrasar a renderiza√ß√£o inicial. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nesse caso, al√©m de enviar um documento HTML em cache por meio de um trabalhador de servi√ßo, voc√™ pode usar o script interno para baixar esses dados como alternativa. Voc√™ pode disponibiliz√°-lo como um objeto global, aqui est√° uma promessa:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-built_in">window</span>.userDataPromise = fetch(<span class="hljs-string">"/me"</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se os dados estiverem prontos e em tal situa√ß√£o, o aplicativo poder√° iniciar imediatamente a renderiza√ß√£o ou aguardar at√© que esteja pronto. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ao usar os dois m√©todos, voc√™ precisa saber com anteced√™ncia quais dados a p√°gina carregar√° antes que o aplicativo inicie a renderiza√ß√£o. </font><font style="vertical-align: inherit;">Isso geralmente √© √≥bvio para dados relacionados ao usu√°rio (nome de usu√°rio, notifica√ß√µes etc.), mas √© mais dif√≠cil com o conte√∫do espec√≠fico de uma p√°gina espec√≠fica. </font><font style="vertical-align: inherit;">Talvez fa√ßa sentido destacar as p√°ginas mais importantes e escrever sua pr√≥pria l√≥gica para elas.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N√£o bloqueie a renderiza√ß√£o enquanto aguarda dados irrelevantes</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√Äs vezes, para gerar dados, voc√™ precisa executar uma l√≥gica complexa lenta no back-end. </font><font style="vertical-align: inherit;">Nesses casos, voc√™ pode tentar baixar uma vers√£o mais simples dos dados primeiro, se isso for suficiente para tornar o aplicativo funcional e interativo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por exemplo, uma ferramenta de an√°lise pode primeiro fazer o download de uma lista de todos os gr√°ficos antes de carregar os dados. </font><font style="vertical-align: inherit;">Isso permite que o usu√°rio procure imediatamente o diagrama de seu interesse e tamb√©m ajuda a distribuir solicita√ß√µes de back-end para diferentes servidores.</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/996/ab6/613/996ab66136976b0b22d95e7778fb4664.png"><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Evite consultas consecutivas de dados</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Isso pode contradizer o par√°grafo anterior, de que √© melhor divulgar dados n√£o essenciais em uma solicita√ß√£o separada. </font><font style="vertical-align: inherit;">Portanto, deve ser esclarecido: evite cadeias com solicita√ß√µes de dados sequenciais, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se cada solicita√ß√£o conclu√≠da n√£o levar ao fato de que o usu√°rio recebe mais informa√ß√µes</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em vez de primeiro consultar qual usu√°rio est√° conectado e solicitar uma lista de seus grupos, retorne imediatamente a lista de grupos junto com as informa√ß√µes do usu√°rio na primeira consulta. </font><font style="vertical-align: inherit;">Voc√™ pode usar o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GraphQL</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para isso </font><font style="vertical-align: inherit;">, mas o terminal </font></font><code>user?includeTeams=true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tamb√©m funciona bem.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Renderiza√ß√£o do lado do servidor</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Renderiza√ß√£o no servidor significa pr√©-renderizar o aplicativo, para que um HTML de p√°gina inteira seja retornado mediante solicita√ß√£o do cliente. O cliente v√™ a p√°gina completamente renderizada, sem aguardar o carregamento de c√≥digo ou dados adicionais! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como o servidor envia ao cliente apenas HTML est√°tico, o aplicativo n√£o √© interativo neste momento. Voc√™ precisa fazer o download do aplicativo em si, iniciar a l√≥gica de renderiza√ß√£o e conectar os ouvintes de eventos necess√°rios ao DOM. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Use a renderiza√ß√£o no servidor se a visualiza√ß√£o de conte√∫do n√£o interativo for valiosa por si s√≥. Tamb√©m √© bom armazenar em cache o HTML renderizado no servidor e devolv√™-lo imediatamente a todos os usu√°rios sem demora. Por exemplo, a renderiza√ß√£o do lado do servidor √© excelente ao usar o React para exibir postagens do blog. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AT</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Este artigo de Mikhail Yanashek</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> descreve como combinar trabalhadores de servi√ßo e renderiza√ß√£o do lado do servidor.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pr√≥xima p√°gina</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em algum momento, o usu√°rio est√° prestes a pressionar um bot√£o e ir para a pr√≥xima p√°gina. </font><font style="vertical-align: inherit;">A partir do momento em que voc√™ abre a p√°gina inicial, voc√™ controla o que acontece no navegador para poder se preparar para a pr√≥xima intera√ß√£o.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pr√©-carregamento de recursos</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se voc√™ pr√©-carregar o c√≥digo necess√°rio para a pr√≥xima p√°gina, o atraso desaparecer√° quando o usu√°rio iniciar a navega√ß√£o. </font><font style="vertical-align: inherit;">Use </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tags de pr√©-busca</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ou </font></font><code>webpackPrefetch</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para importa√ß√£o din√¢mica:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">import</span>(
    <span class="hljs-comment">/* webpackPrefetch: true, webpackChunkName: "todo-list" */</span> <span class="hljs-string">"./TodoList"</span>
)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Considere o tipo de carga que voc√™ coloca no usu√°rio em termos de tr√°fego e largura de banda, especialmente se ele estiver conectado por uma conex√£o m√≥vel. </font><font style="vertical-align: inherit;">Se uma pessoa baixou a vers√£o m√≥vel do site e o modo de armazenamento de dados est√° ativo, √© razo√°vel pr√©-carregar menos agressivamente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Considere estrategicamente quais partes do aplicativo o usu√°rio precisar√° antes.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reutiliza√ß√£o de dados j√° baixados</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Armazene dados em cache localmente no seu aplicativo e use-os para evitar solicita√ß√µes futuras. </font><font style="vertical-align: inherit;">Se o usu√°rio sair da lista de seus grupos para a p√°gina "Editar grupo", voc√™ poder√° fazer a transi√ß√£o instantaneamente, reutilizando dados baixados anteriormente sobre o grupo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Observe que isso n√£o funcionar√° se o objeto for frequentemente editado por outros usu√°rios e os dados baixados puderem estar desatualizados. </font><font style="vertical-align: inherit;">Nesses casos, h√° uma op√ß√£o para mostrar primeiro os dados somente leitura existentes enquanto executa simultaneamente uma solicita√ß√£o de dados atualizados.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclus√£o</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este artigo lista v√°rios fatores que podem tornar a p√°gina mais lenta em diferentes est√°gios do processo de carregamento. Ferramentas como o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chrome DevTools</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WebPageTest</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lighthouse</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ajudar√£o voc√™ a descobrir quais desses fatores afetam seu aplicativo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na pr√°tica, raramente a otimiza√ß√£o est√° indo imediatamente em todas as dire√ß√µes. Precisamos descobrir o que tem maior impacto sobre os usu√°rios e focar nisso.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Enquanto escrevia o artigo, percebi uma coisa importante: eu acreditava firmemente que muitas solicita√ß√µes individuais de servidor eram ruins para o desempenho. </font><font style="vertical-align: inherit;">Esse era o caso no passado, quando cada solicita√ß√£o exigia uma conex√£o separada e os navegadores permitiam apenas algumas conex√µes por dom√≠nio. </font><font style="vertical-align: inherit;">Mas com HTTP / 2 e navegadores modernos, esse n√£o √© mais o caso. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Existem bons argumentos a favor de dividir o aplicativo em partes (com consultas multiplicadas). </font><font style="vertical-align: inherit;">Isso permite que voc√™ baixe apenas os recursos necess√°rios e √© melhor usar o cache, pois apenas os arquivos alterados precisar√£o ser recarregados.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt490196/index.html">[Flipper Zero] recusam Raspberry Pi, fazem nossa pr√≥pria prancha do zero. Encontrar o chip WiFi certo</a></li>
<li><a href="../pt490198/index.html">Confie mas verifique! Zona de demonstra√ß√£o com projetores Epson para home theater na sala de demonstra√ß√£o Pult.ru</a></li>
<li><a href="../pt490202/index.html">Contagem de consultas: teste b√°sico de desempenho do Django</a></li>
<li><a href="../pt490204/index.html">Resumo dos eventos para recrutadores de RH e TI em mar√ßo de 2020</a></li>
<li><a href="../pt490208/index.html">Se√ß√£o de back-end no DUMP2020: brincadeira, ventilador, falha</a></li>
<li><a href="../pt490222/index.html">Biblioteca Padr√£o da Morte</a></li>
<li><a href="../pt490224/index.html">Discri√ß√£o na moda</a></li>
<li><a href="../pt490226/index.html">Blending e Unity Terrain: como se livrar dos cruzamentos e parar de fazer seus olhos doerem</a></li>
<li><a href="../pt490242/index.html">Servi√ßo de localiza√ß√£o GSM dos m√≥dulos SIM800x e seu trabalho com a API Yandex.Locator</a></li>
<li><a href="../pt490244/index.html">Otimiza√ß√£o de c√≥digo Python com ctypes</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>