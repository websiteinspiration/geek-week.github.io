<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏼‍✈️ 🙊 💴 将开发人员作为CI服务进行负载测试 🏘️ 💡 🕴🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="多产品软件供应商经常遇到的问题之一是几乎每个团队中工程师（开发人员，测试人员和基础架构管理员）的能力重复。这也适用于昂贵的工程师-负载测试领域的专家。
 
 工程师们不必承担直接的责任并利用他们独特的经验来构建负载测试过程，选择一种方法，最佳度量并根据负载配置文件编写自测，工程师通常不得不从头开始部...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>将开发人员作为CI服务进行负载测试</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pt/blog/504290/"><img src="https://habrastorage.org/webt/r5/fa/5g/r5fa5gszksri1ly608-wffhunqu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
多产品软件供应商经常遇到的问题之一是几乎每个团队中工程师（开发人员，测试人员和基础架构管理员）的能力重复。这也适用于昂贵的工程师-负载测试领域的专家。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
工程师们不必承担直接的责任并利用他们独特的经验来构建负载测试过程，选择一种方法，最佳度量并根据负载配置文件编写自测，工程师通常不得不从头开始部署测试基础架构，配置负载工具并将其嵌入在CI系统中，配置监视和报告发布。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">另一篇文章中，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可以找到我们在Positive Technologies使用的测试中一些组织问题的解决方案</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在此，我将讨论使用“负载测试即服务”的概念将负载测试集成到通用CI管道中的可能性。</font><font style="vertical-align: inherit;">您将学习如何在CI管道中使用负载源的docker镜像以及如何使用它们。</font><font style="vertical-align: inherit;">如何使用装配模板将负载源连接到CI项目；</font><font style="vertical-align: inherit;">演示管道运行负载测试并发布结果的外观。</font><font style="vertical-align: inherit;">本文对于考虑过其负载系统的体系结构的CI的软件测试工程师和自动化工程师可能有用。</font></font><a name="habracut"></a><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">概念的本质</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
负载测试即服务的概念意味着可以将Apache JMeter，Yandex.Tank负载工具和自己的框架集成到任意连续集成系统中。演示将针对GitLab CI，但陈述了所有CI系统共有的原理。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
负载测试即服务是用于进行负载测试的集中服务。负载测试在专用的代理程序池中运行，结果将自动发布在GitLab Pages，Influx DB和Grafana或测试报告系统（TestRail，ReportPortal等）中。通过在GitLab CI项目中添加和参数化通常的gitlab-ci.yml模板，可以尽可能简单地实现自动化和扩展。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
该方法的优势在于，整个自动化基础架构，负载代理，负载源的docker映像，测试管道和报告的发布均由中央自动化部门（DevOps工程师）支持，并且负载测试工程师可以将精力集中在测试开发上分析其结果，而无需处理基础架构问题。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
为了简化描述，我们假设目标测试应用程序或服务器已经预先部署和配置（为此，可以使用Python，SaltStack，Ansible等中的自动化脚本）。然后，压力测试即服务的整个概念分为三个阶段：</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">准备，测试，报告的发布</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。图上的更多详细信息（所有图片均可单击）：</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><img src="https://habrastorage.org/webt/uc/no/nj/ucnonjamcikvuob-3njskwev-he.png"></a><br>
<br>
<h2>      </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在进行压力测试时，我们尝试遵守</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ISTQB</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">标准和方法</font></a><font style="vertical-align: inherit;">，使用适当的术语和推荐的度量标准。我将简要列出负载测试中的基本概念和定义。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">加载代理（加载代理）</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -将在其上启动应用程序的虚拟机-加载源（Apache JMeter，Yandex.Tank或自写加载模块）。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">测试的目的（目标）</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是要承受负载的服务器或服务器上安装的应用程序。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">测试用例（测试用例）</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -一组参数化步骤：用户操作和对这些操作的预期反应，并根据指定的参数具有固定的网络请求和响应。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">配置文件或负载计划（配置文件）</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -在</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ISTQB方法</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">第</font></a><font style="vertical-align: inherit;"> 4.2.4 </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">节</font></a><font style="vertical-align: inherit;">，第43页）中，负载配置文件确定了对特定测试至关重要的度量标准以及在测试期间更改负载参数的选项。您可以在图中看到概要文件的示例。</font><b><font style="vertical-align: inherit;">测试</font></b><font style="vertical-align: inherit;">是具有一组预定义参数的脚本。</font><b><font style="vertical-align: inherit;">测试计划</font></b><font style="vertical-align: inherit;"> -测试套件和负载配置文件。</font><b><font style="vertical-align: inherit;">Testrun（testrun）</font></b><font style="vertical-align: inherit;"> -使用完全执行的加载方案和收到的报告运行一个测试的一次迭代。</font><b><font style="vertical-align: inherit;">网络请求（请求）</font></b><font style="vertical-align: inherit;"> -从代理发送到目标的HTTP请求。</font><b><font style="vertical-align: inherit;">网络响应（响应）</font></b><font style="vertical-align: inherit;"> -从目标发送到代理的HTTP响应。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><img src="https://habrastorage.org/webt/qm/iq/d5/qmiqd5egscabj6hrmlnufxnyv4m.png"></a><br>
<br>
<b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
HTTP响应状态是来自应用程序服务器的标准响应代码。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
事务（事务）-“请求-响应”的整个周期。</font><font style="vertical-align: inherit;">从开始发送请求（请求）到完成接收响应（响应）的过程中对事务进行计数。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">交易状态（交易状态）</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -是否可以成功完成周期“请求-响应”。</font><font style="vertical-align: inherit;">如果此循环中有任何错误，则认为整个事务均未成功。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">响应时间（延迟）</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -从发送请求（请求）结束到开始接收响应（响应）的时间。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">负载量度（度量标准）</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -负载测试过程中定义的负载服务和负载代理的特征。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">测量负载参数的基本指标</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
下</font><font style="vertical-align: inherit;">表显示</font><font style="vertical-align: inherit;">了</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ISTQB</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法中一些最常用和推荐的</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">指标</font></a><font style="vertical-align: inherit;">（第</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">36、52</font></a><font style="vertical-align: inherit;">页）。</font><font style="vertical-align: inherit;">代理和目标的相似指标显示在同一行上。</font></font><br>
<br>
<div class="scrollable-table"><table>
<thead>
<tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">负载代理指标</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在负载下测试的目标系统或应用程序的指标</font></font></th>
</tr>
</thead>
<tbody>
<tr>
<td><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vCPU</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RAM</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内存</font><font style="vertical-align: inherit;">的数量&nbsp;&nbsp; </font><font style="vertical-align: inherit;">，</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">磁盘</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -“铁”负载代理的特征</font></font></td>
<td><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CPU</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内存，磁盘使用情况</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
测试期间</font><font style="vertical-align: inherit;">加载处理器，内存和磁盘的动态</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">通常以</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最大可用值</font><font style="vertical-align: inherit;">的百分比来衡量</font><font style="vertical-align: inherit;">。</font></font></td>
</tr>
<tr>
<td><b>Network throughput</b> (on load agent) —   <br>
   , <br>
   . <br>
      (bps)</td>
<td><b>Network throughput</b>(on target) —     <br>
  .       (bps)</td>
</tr>
<tr>
<td><b>Virtual users</b>—   , <br>
    <br>
   </td>
<td><b>Virtual users status</b>, Passed/Failed/Total —    <br>
     <br>
  ,     .<br>
<br>
 ,      <br>
  ,    . <br>
   ,       <br>
      </td>
</tr>
<tr>
<td><b>Requests per second (minute)</b>—      ( ).<br>
<br>
   :     . <br>
       </td>
<td><b>Responses per second (minute)</b><br>
 —      ( ).<br>
<br>
   :   <br>
       <br>
 </td>
</tr>
<tr>
<td></td>
<td><b>HTTP responses status</b>—     <br>
  ,   . <br>
, 200 OK   , <br>
 404 —    </td>
</tr>
<tr>
<td></td>
<td><b>Latency</b> ( ) —    <br>
  (request)     (response). <br>
    (ms)</td>
</tr>
<tr>
<td></td>
<td><b>Transaction response time</b>—    , <br>
  « — ». <br>
      (request) <br>
    (response).<br>
<br>
      ( ) <br>
 :  , <br>
,  , , 90- . <br>
    —   <br>
  . <br>
    , <br>
    , <br>
     </td>
</tr>
<tr>
<td></td>
<td><b>Transactions per second (minute)</b> —   <br>
   (), <br>
       <br>
    . <br>
    </td>
</tr>
<tr>
<td></td>
<td><b>Transactions status</b> , Passed / Failed / Total —  <br>
,     .<br>
<br>
    <br>
    <br>
     </td>
</tr>
</tbody>
</table></div><br>
<h2>   </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
负载测试的基本方案非常简单，包括三个主要阶段，我已经提到了它们：</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prepare-Test-Report</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，即准备测试目标并为负载源设置参数，然后执行负载测试，最后生成并发布报告关于测试。</font><font style="vertical-align: inherit;">
该计划的注意事项：</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><img src="https://habrastorage.org/webt/o5/s5/z5/o5s5z5f79dpui3ojk5vbwgsayso.png"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">QA.Tester-压力测试专家，</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目标是您需要了解其负载情况下的行为的目标应用程序。</font></font></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图中实体，阶段和步骤的分类器</font></font></h2><br>
<div class="scrollable-table"><table>
<thead>
<tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">阶段和步骤</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发生了什么</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">入口处是什么</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输出是什么</font></font></th>
</tr>
</thead>
<tbody>
<tr>
<td colspan="4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">准备：测试准备阶段</font></font></td>
</tr>
<tr>
<td><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">负载参数</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置和初始化</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
用户</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
负载参数，</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
选择指标并</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
准备测试计划</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（负载配置文件）</font></font></td>
<td>  <br>
  <br>
-<br>
 </td>
<td></td>
</tr>
<tr>
<td><b>VM</b></td>
<td>   <br>
   <br>
 </td>
<td>    <br>
   <br>
 </td>
<td>  <br>
 </td>
</tr>
<tr>
<td><b>Env</b></td>
<td>    <br>
  <br>
  </td>
<td>   <br>
 <br>
   <br>
 </td>
<td> : <br>
,   , <br>
   <br>
 </td>
</tr>
<tr>
<td><b>LoadAgents</b></td>
<td>,    <br>
 . <br>
  -  <br>
  </td>
<td>-   <br>
(, JM   )<br>
  <br>
 </td>
<td>   <br>
   <br>
</td>
</tr>
<tr>
<td colspan="4">Test:    .    ,       GitLab CI</td>
</tr>
<tr>
<td><b>Load</b></td>
<td>   <br>
  -<br>
   </td>
<td>  <br>
  <br>
 <br>
-<br>
 </td>
<td>  <br>
 <br>
 <br>
      </td>
</tr>
<tr>
<td><b>RunAgents</b></td>
<td>  <br>
   <br>
  <br>
  <br>
   <br>
  </td>
<td>-<br>
 </td>
<td></td>
</tr>
<tr>
<td><b>Logs</b></td>
<td> «»  <br>
   : <br>
    , <br>
   <br>
 ,    </td>
<td></td>
<td>  <br>
 <br>
 </td>
</tr>
<tr>
<td><b>Metrics</b></td>
<td> «»    </td>
<td></td>
<td>    <br>
  </td>
</tr>
<tr>
<td colspan="4">Report:     </td>
</tr>
<tr>
<td><b>Generator</b></td>
<td>  <br>
   <br>
  «» <br>
  <br>
   <br>
 , <br>
   <br>
</td>
<td>  <br>
 <br>
 <br>
   <br>
   </td>
<td> «»  <br>
 ,   <br>
   <br>
   ,<br>
   </td>
</tr>
<tr>
<td><b>Publish</b></td>
<td>  <br>
  <br>
   <br>
</td>
<td> «» <br>
  ,  <br>
    <br>
</td>
<td>   <br>
   <br>
,  <br>
  </td>
</tr>
</tbody>
</table></div><br>
<h2>    CI-</h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
让我们继续实践部分。我想展示在</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Positive Technologies的</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">某些项目中</font><font style="vertical-align: inherit;">我们如何实现负载测试即服务的概念。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
首先，在DevOps工程师的帮助下，我们在GitLab CI中创建了一个专用的代理程序池来运行负载测试。为了不使它们在模板中与其他组件（如程序集池）混淆，我们向这些代理添加了</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标签</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">tag</font></a><font style="vertical-align: inherit;">：load。您可以使用任何其他清除标签。它们是</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> GitLab CI Runners </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">注册期间</font></a><font style="vertical-align: inherit;">设置</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">的</font></a><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如何通过硬件找出所需的功率？可以基于必须在该代理程序上运行Docker，Python（对于Yandex.Tank），GitLab CI代理程序，Java（对于Apache JMeter）的负载代理程序的特性-足够数量的vCPU，RAM和磁盘-进行计算。对于Java，JMeter还建议使用至少512 MB的RAM和</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">80％的可用内存</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为上限</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
因此，根据我们的经验，我们建议为负载代理至少使用4个vCPU，4 GB RAM，60 GB SSD。网卡带宽是根据负载配置文件的要求确定的。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们主要使用两个负载源-docker镜像Apache JMeter和Yandex.Tank。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Yandex.Tank</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-这是Yandex进行压力测试的开源工具。它的模块化体系结构基于高性能的基于异步命中的HTTP请求生成器Phantom。储罐使用SSH协议对受测服务器的资源进行内置监控，可以根据给定条件自动停止测试，可以将结果输出到控制台并以图形形式输出，您可以将模块连接到它以扩展功能。顺便说一下，我们在尚未成为主流的时候使用了Tank。在“ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Yandex.Tank和负载测试自动化</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”一文中，您可以阅读有关如何在2013年使用它对</font><font style="vertical-align: inherit;">公司产品之一</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PT Appllication Firewall进行</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">负载测试的故事</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apache JMeter</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是用于执行Apache压力测试的开源工具。它同样可以很好地用于测试静态和动态Web应用程序。 JMeter支持大量协议和与应用程序交互的方式：HTTP，HTTPS（Java，NodeJS，PHP，ASP.NET等），SOAP / REST Web服务，FTP，TCP，LDAP，SMTP（S），POP3（S ）和IMAP（S），通过JDBC的数据库，可以执行Shell命令并使用Java对象。 JMeter具有用于创建，调试和执行测试计划的IDE。还有一个CLI可在任何兼容的Java OS（Linux，Windows，Mac OS X）的命令行上工作。该工具可以动态生成HTML测试报告。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
为了便于在公司内部使用，为了使测试人员能够更改和添加环境，我们在GitLab CI上制作了负载源的docker映像，并</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在Artifactory</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的内部</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">docker-register中进行了发布</font></a><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这样可以更快，更轻松地将它们连接到管道中以进行负载测试。</font><font style="vertical-align: inherit;">如何通过GitLab CI使Docker推送注册表-请参阅</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">说明</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Yandex.Tank的基本docker文件我们采用了以下方法：</font></font><br>
<br>
<pre><code class="bash hljs">Dockerfile <font></font>
1 | FROM direvius/yandex-tank<font></font>
2 | ENTRYPOINT [<span class="hljs-string">""</span>]</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
对于Apache JMeter，这是一个：</font></font><br>
<br>
<pre><code class="bash hljs">Dockerfile <font></font>
1 | FROM vmarrazzo/jmeter<font></font>
2 | ENTRYPOINT [<span class="hljs-string">""</span>]</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
您可以在文章“ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">开发流程的自动化：我们如何在Positive Technologies中实现DevOps想法”中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">阅读我们的持续集成系统的工作原理</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模板和管道</font></font></h2><br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">demo-load</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
项目中提供了用于进行负载测试的示例模板</font><font style="vertical-align: inherit;">。您</font><font style="vertical-align: inherit;">可以</font><font style="vertical-align: inherit;">在</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自述文件中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">阅读有关使用模板的说明。在模板本身（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.gitlab-ci.yml文件</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）中，有关于此步骤或该步骤负责的内容的注释。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
该模板非常简单，并在图中说明了上述负载测试的三个阶段：准备，测试和发布报告。负责它的</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Stage目录</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prepare，Test和Report</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<ol>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Prepare</a>           .       ,     -    docker registry:       Test.         .</li>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Test</a>     ,      .     : Yandex.Tank, Apache JMeter,    .         job-.     :<br>
 <ul>
<li>  Yandex.Tank    .<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">/tests/yandextank.sh</a>,</li>
<li>  Apache JMeter    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">./tests/jmeter.sh</a>.</li>
</ul><br>
:         CI-        .     ,    bash-.   ,       —    QA-.               .        <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">./tests</a>.<br>
 </li>
<li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Report</a>      ,    Test,   ,   GitLab Pages    .  GitLab Pages ,      ./public        index.html.     GitLab Pages    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="> </a>.<br>
<br>
,   : <ul>
<li> JMeter  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">GitLab Pages</a>,</li>
<li> Yandex.Tank  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">InfluxDB  Grafana</a>.</li>
</ul><br>
   :<ul>
<li>HTML-  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">GitLab Pages</a>,</li>
<li> InfluxDB    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Grafana</a>.</li>
</ul></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在一个演示示例中，具有负载测试和两个负载源（您可以禁用不必要的负载）的管道如下所示：</font><font style="vertical-align: inherit;">
Apache JMeter本身可以生成HTML报告，因此使用常规工具将其保存在GitLab Pages中更有利可图。</font><font style="vertical-align: inherit;">这是Apache JMeter报告的样子：</font><font style="vertical-align: inherit;">
在Yandex.Tank的演示中，您将</font><font style="vertical-align: inherit;">在GitLab Pages部分中</font><font style="vertical-align: inherit;">仅看到</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">假文本报告</font></a><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在测试过程中，Tank可以将结果保存到InfluxDB数据库中，然后可以在其中显示结果，例如，在Grafana中显示（配置在文件</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">./tests/example-yandextank-test.yml中进行</font></a><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">这是Tank的报告在Grafana中的样子：</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><img src="https://habrastorage.org/webt/t6/0f/bx/t60fbxhrvwnju5mubzwmifhjmn0.png"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><img src="https://habrastorage.org/webt/fr/pl/pr/frplprdv1ns3obkqrpn2i4tgetu.png"></a><br>
<br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><img src="https://habrastorage.org/webt/a6/y9/zw/a6y9zw9ej6wcy_g5pk69s1ncrpa.png"></a><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">摘要</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在本文中，我讨论了“负载测试即服务”（负载测试即服务）的概念。主要思想是使用预配置的负载代理池，负载源的docker映像，报告系统以及基于简单的.gitlab-ci.yml模板在GitLab CI中将它们组合在一起的管道的基础架构（请</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参考</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例</font><font style="vertical-align: inherit;">）。所有这一切都由一小组自动化工程师提供支持，并应产品团队的要求进行复制。我希望这可以帮助您在公司中准备和实施类似的计划。感谢您的关注！</font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS：我要对我的同事Sergey Kurbanov和Nikolay Yusev表示非常感谢，他们为在我们公司中实现负载测试即服务的概念提供了技术帮助。</font></font></i><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作者</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Timur Gilmullin-</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">副主席。</font><font style="vertical-align: inherit;">积极技术技术与开发流程（DevOps）负责人</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN504264/index.html">华为评论评论：评论Wi-Fi 6帖子并获得奖品</a></li>
<li><a href="../zh-CN504270/index.html">Svelte是小部件实现的不错选择吗？</a></li>
<li><a href="../zh-CN504276/index.html">十大开发人员书籍</a></li>
<li><a href="../zh-CN504282/index.html">在NSPK中创建企业架构</a></li>
<li><a href="../zh-CN504284/index.html">《纯粹的敏捷》一书。灵活性的基础</a></li>
<li><a href="../zh-CN504296/index.html">在Python中生成随机分支</a></li>
<li><a href="../zh-CN504306/index.html">如何在Elbrus上制造用于存储Aerodisk Vostok的俄罗斯硬件</a></li>
<li><a href="../zh-CN504310/index.html">数据二分法：重新考虑与数据和服务的关系</a></li>
<li><a href="../zh-CN504312/index.html">俄语程序和GPL的统一注册。我的五分钱</a></li>
<li><a href="../zh-CN504314/index.html">通过HTTP请求在没有docker client的情况下实现docker pull和docker push命令</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>