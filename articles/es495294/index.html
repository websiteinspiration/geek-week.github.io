<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚õπÔ∏è üë©üèø‚Äçü§ù‚Äçüë©üèΩ üé£ Macros para un pitonista. Informe Yandex üñïüèæ üè§ üîÉ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="¬øC√≥mo puedo extender la sintaxis de Python y agregarle las caracter√≠sticas necesarias? El verano pasado en PyCon intent√© descifrar este tema. En el in...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Macros para un pitonista. Informe Yandex</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yandex/blog/495294/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øC√≥mo puedo extender la sintaxis de Python y agregarle las caracter√≠sticas necesarias? </font><font style="vertical-align: inherit;">El verano pasado en PyCon intent√© descifrar este tema. </font><font style="vertical-align: inherit;">En el informe puede averiguar c√≥mo se organizan las bibliotecas de patrones pytest, macropy, y c√≥mo logran resultados tan interesantes. </font><font style="vertical-align: inherit;">Al final hay un ejemplo de generaci√≥n de c√≥digo utilizando macros en HyLang, un lenguaje similar a Lisp que se ejecuta sobre Python.</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/IMkvg45Vw70" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- Hola chicos. </font><font style="vertical-align: inherit;">En primer lugar, quiero agradecer a los organizadores de PyCon. </font><font style="vertical-align: inherit;">Soy desarrollador en Yandex. </font><font style="vertical-align: inherit;">El informe no ser√° sobre el trabajo en absoluto, sino sobre cosas experimentales. </font><font style="vertical-align: inherit;">Tal vez lo lleven a uno de ustedes a la idea de que en Python pueden hacer cosas geniales que ni siquiera sab√≠an antes, que no pensaban en esta direcci√≥n.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un poco para aquellos que no saben lo que son las macros: esta es una forma de generaci√≥n de c√≥digo cuando una expresi√≥n en el lenguaje se expande en c√≥digo m√°s complejo. </font><font style="vertical-align: inherit;">¬øCu√°les son las golosinas para ti? </font><font style="vertical-align: inherit;">Para usted, el registro macro es conciso, expresa algo de abstracci√≥n, pero hace mucho trabajo bajo el cap√≥ para usted y no necesita escribir todo este c√≥digo con las manos.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pytest</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lo m√°s probable es que te hayas encontrado con un marco de prueba de pytest, muchos aqu√≠ seguramente lo usan. No s√© si alguna vez lo has notado, pero bajo el cap√≥ tambi√©n hace algo de magia. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/al/o6/qv/alo6qvpzofmabtejvqqojenx31a.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por ejemplo, tienes una prueba tan simple. Si lo ejecuta sin pytest, arrojar√° un AssertionError simplemente. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ih/an/ck/ihanckzzqzelb5o87nfx9olt2vw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Desafortunadamente, mi ejemplo es un poco degenerado, y aqu√≠ es inmediatamente obvio que Len est√° tomado de una lista de tres elementos. Pero si se llamara a alguna funci√≥n, entonces nunca hubiera sabido de un AssertionError que la funci√≥n regres√≥. Ella devolvi√≥ algo que no es igual a cien. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/cu/ko/sa/cukosarqifegg5uvzo14xneczkc.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sin embargo, si se ejecuta bajo pytest, mostrar√° informaci√≥n de depuraci√≥n adicional. ¬øC√≥mo lo hace adentro?</font></font><br>
<br>
<img src="https://habrastorage.org/webt/6h/g9/vr/6hg9vr5nedvvkvzxlsupjqor71a.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esta magia funciona de manera muy simple. Pytest crea su propio gancho especial que se activa cuando se carga el m√≥dulo con la prueba. Despu√©s de eso, pytest analiza de forma independiente este archivo de Python y, como resultado del an√°lisis, se obtiene su representaci√≥n intermedia, que se denomina √°rbol AST. El √°rbol AST es un concepto b√°sico que le permite cambiar el c√≥digo de Python sobre la marcha. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despu√©s de recibir dicho √°rbol, pytest le impone una transformaci√≥n que busca todas las expresiones llamadas aserciones. Los cambia de cierta manera, compila el nuevo √°rbol AST resultante y obtiene un m√≥dulo con pruebas, que luego se ejecuta en una m√°quina virtual Python normal.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/t3/fj/x-/t3fjx-trld3abinbaqxioiizptg.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As√≠ es como se ve el √°rbol AST original no convertido a pytest. </font><font style="vertical-align: inherit;">El √°rea roja resaltada es nuestra Afirmaci√≥n. </font><font style="vertical-align: inherit;">Si observa detenidamente, ver√° sus partes izquierda y derecha, la lista misma. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cuando pytest convierte esto y genera un nuevo a√±o, el √°rbol comienza a verse as√≠. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yv/xh/qb/yvxhqbjsokha_vdwfn9-ksm0isi.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hay alrededor de un centenar de l√≠neas de c√≥digo que Pytest gener√≥ para usted. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/cu/fc/zi/cufczioilng0zfzx05nbrtwgl8g.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si convierte este √°rbol AST de nuevo a Python, se ver√° m√°s o menos as√≠. </font><font style="vertical-align: inherit;">Las √°reas resaltadas en rojo aqu√≠ son donde pytest calcula las partes izquierda y derecha de la expresi√≥n, genera un mensaje de error y genera un error de aserci√≥n si algo sali√≥ mal con este mensaje de error.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La coincidencia de patrones</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬øQu√© m√°s puedes hacer con tal cosa? Puedes convertir cualquier c√≥digo de Python. Y hay una biblioteca maravillosa que encontr√© por accidente en PyPI, es interesante excavar all√≠. Ella combina patrones. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/3k/yb/eq/3kybeqrilpfpqnvj4bmeon62ibm.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quiz√°s este c√≥digo le sea familiar a alguien. √âl considera factorial recursivamente. Veamos c√≥mo se puede grabar usando la coincidencia de patrones.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/xy/cv/as/xycvassi6jwpp9getvm4sy4bbmm.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para hacer esto, simplemente cuelgue el decorador en la funci√≥n. Tenga en cuenta: dentro del cuerpo, la funci√≥n ya funciona de manera diferente. Cada uno de estos ifs es una regla para la coincidencia de patrones, que analiza la expresi√≥n que se ingresa a la funci√≥n y de alguna manera la transforma. Adem√°s, ni siquiera hay retornos expl√≠citos del resultado. Debido a que la biblioteca de patrones, cuando transforma el cuerpo de la funci√≥n, en primer lugar, comprueba que contiene solo si, y en segundo lugar, agrega retornos impl√≠citos del resultado, cambiando as√≠ la sem√°ntica del lenguaje. Es decir, ella hace un nuevo DSL, que funciona un poco diferente. Y gracias a esto, puedes escribir algunas cosas declarativamente. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/3k/yb/eq/3kybeqrilpfpqnvj4bmeon62ibm.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La funci√≥n anterior es como si estuviera escrita en tres l√≠neas.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/xy/cv/as/xycvassi6jwpp9getvm4sy4bbmm.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/pj/fm/ux/pjfmuxf4zsl_zpppzidv9oirkim.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y el resto de las l√≠neas agregan funcionalidad adicional que permite, por ejemplo, leer factorial de una lista de valores o pasarlo a trav√©s de una funci√≥n arbitraria. </font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øC√≥mo escribir conversiones usted mismo? </font><font style="vertical-align: inherit;">macropy!</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora probablemente se est√© preguntando, pero ¬øc√≥mo puede aplicarlo usted mismo? Debido a que es tedioso hacer, como pytest: analizar manualmente los archivos, busque el c√≥digo que necesita ser convertido. En pytest, esto se realiza mediante un m√≥dulo separado para mil o m√°s l√≠neas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para no hacer esto por nuestra cuenta, algunos tipos inteligentes ya han creado un m√≥dulo para nosotros llamado macropy. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esta versi√≥n del m√≥dulo es tanto para el segundo Python como para el tercero. Lo escribieron en el tiempo de la segunda Python. Luego, los chicos hicieron una broma para descubrir qu√© se puede hacer con Python, y la biblioteca incluye varios ejemplos. Echemos un vistazo a ellos, te dar√°n una idea de lo que puedes hacer con esta t√©cnica. Lo primero que describieron en el tutorial es una macro que implementa cadenas de formato para el segundo Python, como en el tercero.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/er/3h/vv/er3hvvz7g-0edq1spxz5bukrk3q.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La expresi√≥n resaltada en rojo es solo la sintaxis de la llamada macro. La letra S es el nombre de la macro, y luego entre corchetes es la expresi√≥n que convierte. Como resultado, las variables se sustituyen aqu√≠. Esto funciona en el segundo Python, pero el tercero ya no es necesario en dicha macro. As√≠, por ejemplo, puede crear su propia macro, que implementa una sem√°ntica m√°s compleja y hace cosas m√°s divertidas que las cadenas de formato est√°ndar.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/jw/bf/hx/jwbfhxtuxzzrbjd-vvu3rhdsok8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cuando una macro se expande, y esto sucede al momento de cargar el m√≥dulo, simplemente se convierte a ese c√≥digo. Los marcadores de posici√≥n se insertan en la cadena de formato y se le aplica el procedimiento de sustituci√≥n. Adem√°s Python ya de una manera est√°ndar compila todo esto. En tiempo de ejecuci√≥n, no se producen expansiones macro. Todos ocurren cuando se carga el m√≥dulo. Por lo tanto, en tal caso, incluso puede hacer optimizaciones o c√°lculos que ocurrir√°n al momento de cargar el m√≥dulo y generar un c√≥digo de bytes m√°s √≥ptimo. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/2i/gz/9t/2igz9tsitqjebyuxpln51mhknra.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El segundo ejemplo tambi√©n es interesante. Esta es una notaci√≥n abreviada para escribir lambdas. La macro f toma una serie de argumentos y devuelve una funci√≥n en su lugar. Cada expresi√≥n que comienza con el nombre de macro "f", par√©ntesis, y luego absolutamente cualquier expresi√≥n se convierte en lambda.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/l5/vq/ym/l5vqym-i-69vtjohomf2nsxfsj0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En mi opini√≥n, esto tambi√©n es genial, especialmente para aquellos a quienes les gusta desarrollar y escribir c√≥digo en un estilo funcional y usar MapReduce. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/0j/fx/xc/0jfxxcdmblyze8e4bcxqrqrgaoy.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqu√≠ hay otro ejemplo familiar. Esta funci√≥n considera factorial, el c√≥digo se resalta en rojo. ¬øQu√© pasar√° cuando la llamen? </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ov/gj/v0/ovgjv0vqgcbzx0wxy5q-kuvozzg.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lanzar√° un error en Python, porque se ejecutar√° en el l√≠mite de la pila y habr√° un RecursionError tan feo. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/wi/zz/1h/wizz1haarmzw9is0q0k3n_r6mji.jpeg" width="600"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬øC√≥mo se puede arreglar esto? Usando macropy, solucionar el problema es muy simple. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/wc/ej/-n/wcej-na40treik2p0hkdp1jfbns.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cuelgas el decorador, toma el cuerpo de la funci√≥n y lo transforma de una manera m√°gica. No necesita cambiar nada en la funci√≥n en s√≠, macropy har√° todo por usted. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/xc/c8/ld/xcc8ldcmcykmbaxjceek4xsgrka.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y la funci√≥n volver√° a ser un resultado bastante normal, yendo lejos al subsuelo. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ek/uq/mi/ekuqmigu-x5hhmdyyy8q04wob5c.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬øC√≥mo lo hace macropy?</font></font><br>
<br>
<img src="https://habrastorage.org/webt/fz/1r/5f/fz1r5ff8_v-egywcvufzvw-zsec.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Reemplaza todas las llamadas a la funci√≥n en s√≠ con un objeto especial TailCall, que luego es llamado en un bucle por el decorador de TCO. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/dg/25/5b/dg255bb2t_mzo9ku4ucwq-uz31o.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El circuito se parece a esto. El decorador en el bucle llama a la funci√≥n hasta que devuelva alg√∫n resultado normal en lugar de TailCall. Y si ella regres√≥, entonces lo devuelve. Y eso es todo. ¬°Estas cosas geniales se pueden hacer con macros! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Macropy tambi√©n incluye otros ejemplos. Espero que aquellos que sienten curiosidad por ti vayan a verlos por su cuenta. Digamos que hay cosas √∫tiles para la depuraci√≥n.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/wd/hg/rq/wdhgrqonz6lfdcicgdynvnfipfs.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Te contar√© sobre otra cosa genial. Un ejemplo es esta macro de consulta. ¬øQu√© est√° haciendo? Dentro de √©l, escribe c√≥digo Python regular, que luego puede usar como resultado regular de ejecutar esta expresi√≥n. Pero por dentro, macropy transforma este c√≥digo y lo convierte en el c√≥digo del lenguaje de consulta Alchemy SQL. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ag/qb/jk/agqbjkyzfbun_tbdnjxww5lutms.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lo reescribe para ti, hace esta terrible expresi√≥n. Se puede reescribir a mano, luego ser√° m√°s corto. Lo hice. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/4k/ts/5w/4kts5wogftqmpcceukufkib56be.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqu√≠ est√° la expresi√≥n original. Despu√©s de expandir la macro, toma algo como esto. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/du/i0/uv/dui0uvfpouzuuioj2tmirtfyg5c.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quiz√°s alguien est√© interesado en escribir c√≥digo m√°s similar a Python, y no obligar a sus desarrolladores a escribir consultas sobre DSL SQL Alchemy.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De la misma manera, puede generar cualquier cosa desde Python - SQL puro, JavaScript - y guardarlo en alg√∫n lugar al lado del archivo, y luego usarlo en la interfaz. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/kk/s3/j3/kks3j3s2wwep0vejhof8-3fw-oq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora veamos c√≥mo hacer tu propia macro. Con macropy, es muy simple. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Una macro es una funci√≥n que toma un √°rbol AST en la entrada y, de alguna manera transform√°ndolo, devuelve uno nuevo. Aqu√≠ hay un ejemplo de macro que agrega una descripci√≥n a la llamada de aserci√≥n que contiene la expresi√≥n de origen para que podamos entender por qu√© ocurri√≥ el error AssertionError. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqu√≠, la funci√≥n interna replace_assert es auxiliar. Ella hace un descenso recursivo en un √°rbol para ti. Dentro de replace_assert, se pasa el elemento de sub√°rbol.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/3u/qn/wa/3uqnwavrca79l0wumgmnfxfcm58.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Debido a esto, puede verificar su tipo y? Si se trata de una llamada de afirmaci√≥n, haga algo con ella. Aqu√≠ dar√© un ejemplo sint√©tico simple que toma la parte izquierda, la parte derecha, genera un mensaje de error de ellos y escribe todo en el atributo msg. Este es el mensaje que deber√° devolverse. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/rf/re/hn/rfrehnypphthxdzqbjwehtj3fas.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/va/ak/jm/vaakjmq4tpgqjwttqmi8nepgtym.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/x7/hq/cs/x7hqcswjuj59uhp5thatiojofja.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cuando lo usa, adjunta dicha macro a un bloque de c√≥digo usando el administrador de contexto with, y todo el c√≥digo que ingresa al administrador de contexto pasa por esta transformaci√≥n. A continuaci√≥n se ve que nuestro mensaje de error se agreg√≥ a AssertionError, que formamos a partir de la expresi√≥n len ([1, 2, 3]).</font></font><br>
<br>
<img src="https://habrastorage.org/webt/yo/zo/zc/yozozclanvtdlinutuvnl58puve.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sin embargo, este m√©todo tiene una limitaci√≥n que me pone triste personalmente. </font><font style="vertical-align: inherit;">Intent√© como experimento hacer nuevos dise√±os que funcionen en el idioma. </font><font style="vertical-align: inherit;">Por ejemplo, a algunas personas les gusta el interruptor o las construcciones condicionales, a menos que. </font><font style="vertical-align: inherit;">Pero desafortunadamente, esto no es posible: macropy y cualquier otra herramienta que funcione con el √°rbol AST se usa cuando el c√≥digo fuente ya se lee y se divide en tokens. </font><font style="vertical-align: inherit;">El c√≥digo es le√≠do por el analizador Python, cuya gram√°tica est√° arreglada en el int√©rprete. </font><font style="vertical-align: inherit;">Para cambiarlo, necesita recompilar Python. </font><font style="vertical-align: inherit;">Por supuesto, puede hacer esto, pero ya ser√° una bifurcaci√≥n de Python, y no una biblioteca que se pueda dise√±ar en PyPI. </font><font style="vertical-align: inherit;">Por lo tanto, es imposible hacer tales construcciones usando macropy.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HyLang</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Afortunadamente, durante mi larga vida escrib√≠ no solo en Python y me interesaron varios otros lenguajes alternativos. Hay una sintaxis que a muchos no les gusta, pero m√°s simple y flexible. Estas son expresiones s. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Afortunadamente para nosotros, hay un complemento de Python llamado HyLang. Esto recuerda un poco a Clojure, solo Clojure se ejecuta sobre JVM y HyLang se ejecuta sobre Python Virtual Machine. Es decir, le proporciona una nueva sintaxis para escribir c√≥digo. Pero al mismo tiempo, todo el c√≥digo que escriba ser√° totalmente compatible con las bibliotecas de Python existentes, y puede usarse desde las bibliotecas de Python. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/54/sc/rr/54scrrucaeden67utnbyx3jva0i.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se ve algo como esto.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/qo/vr/w7/qovrw7a-mivofegxjhx61jtlky0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La parte de la izquierda escrita en Python, a la derecha, en HyLang. Y desde abajo para ambos hay un bytecode, que es el resultado. Probablemente not√≥ que es exactamente lo mismo, solo cambia la sintaxis. Expresiones s de HyLang, que a muchos no les gusta. Los opositores de los "corchetes" no entienden que tal sintaxis le da al lenguaje un poder tremendo porque le da uniformidad a las construcciones del lenguaje. Y la uniformidad le permite usar macros para implementar cualquier dise√±o. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esto se logra debido al hecho de que dentro de cada expresi√≥n el primer elemento es siempre alg√∫n tipo de acci√≥n. Y luego sus argumentos van.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y todo el c√≥digo est√° compuesto de expresiones anidadas que son f√°ciles de convertir y abrir macros all√≠. Debido a esto, absolutamente cualquier construcci√≥n se puede hacer en HyLang, nueva, de ninguna manera indistinguible de las caracter√≠sticas del lenguaje est√°ndar en el c√≥digo. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/o5/-u/rw/o5-urwww9tzewkt4ufq7krycxj8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Veamos c√≥mo funciona una macro simple en HyLang. Para hacer lo mismo que hicimos con Assert usando macropy, solo necesita este c√≥digo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nuestra macro HyLang recibe entrada, que es c√≥digo. Adem√°s, una macro puede usar f√°cilmente cualquier parte de este c√≥digo para crear un nuevo c√≥digo. La principal diferencia entre macros y funciones: las expresiones son entradas, no valores. Si llamamos a nuestra macro como (es (= 1 2)), recibir√° una expresi√≥n (= 1 2) en lugar de False.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/uc/5b/az/uc5bazq37xtwjlsbaf54_kpe8zu.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entonces podemos generar un mensaje de error de que algo sali√≥ mal. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hn/a9/cm/hna9cmzwxvf87k5e4i0py87cs84.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y luego solo devuelve el nuevo c√≥digo. Esta sintaxis de tilde y tilde significa algo como lo siguiente. La cita posterior dice: tome esta expresi√≥n como es y devu√©lvala como es. Y la tilde dice: sustituye el valor de la variable aqu√≠. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/pi/qn/en/piqnenjm28v8jm0i-hfsdx3ib18.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por lo tanto, cuando escribimos esto, la macro al expandirse nos devolver√° una nueva expresi√≥n, que de este modo se afirmar√° con un mensaje de error adicional.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
HyLang es algo genial. </font><font style="vertical-align: inherit;">Es cierto, mientras no lo usemos. </font><font style="vertical-align: inherit;">Quiz√°s nunca lo hagamos. </font><font style="vertical-align: inherit;">Todos estos art√≠culos son experimentales. </font><font style="vertical-align: inherit;">Quiero que te vayas de aqu√≠ con la sensaci√≥n de que en Python puedes hacer algunas cosas que ni siquiera hab√≠as pensado antes. </font><font style="vertical-align: inherit;">Y quiz√°s algunos de ellos encuentren una aplicaci√≥n pr√°ctica en su trabajo continuo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eso es todo para m√≠. </font><font style="vertical-align: inherit;">Puedes ver los enlaces:</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Patrones</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ,</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MacroPy</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ,</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HyLang</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ,</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El libro OnLisp</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : para un estudio avanzado de las capacidades de las macros. </font><font style="vertical-align: inherit;">Esto es para aquellos especialmente interesados. </font><font style="vertical-align: inherit;">Es cierto que el libro no est√° completamente basado en Python, sino en Common Lisp. </font><font style="vertical-align: inherit;">Pero para un estudio m√°s profundo, esto ser√° incluso interesante.</font></font></li>
</ul></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es495278/index.html">Bases de datos, tarjetas, listas de verificaci√≥n o por qu√© un administrador de conocimiento empresarial</a></li>
<li><a href="../es495280/index.html">Max Patrol SIEM. Descripci√≥n general del sistema de gesti√≥n de eventos de seguridad de la informaci√≥n</a></li>
<li><a href="../es495282/index.html">Validaci√≥n de XML utilizando XSD, JAXB y Spring Framework</a></li>
<li><a href="../es495290/index.html">Explorando la calidad del c√≥digo del sistema operativo Zephyr</a></li>
<li><a href="../es495292/index.html">Lanzamiento de InterSystems IRIS 2020.1</a></li>
<li><a href="../es495296/index.html">An√°lisis forense, inyecci√≥n SQL y gato sufrido: an√°lisis de la tarea n. ¬∞ 3 de la etapa en l√≠nea NeoQUEST-2020</a></li>
<li><a href="../es495298/index.html">Evaluar las opciones de Monte Carlo Clojure</a></li>
<li><a href="../es495302/index.html">C√≥mo aumentar las ventas 2.5 veces en 4 meses en una tienda en l√≠nea: un caso para la promoci√≥n SEO</a></li>
<li><a href="../es495304/index.html">Rejuvenecimiento de c√©lulas humanas debido a su reprogramaci√≥n</a></li>
<li><a href="../es495308/index.html">Rastrillo en el camino para mantenerse vivo</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>