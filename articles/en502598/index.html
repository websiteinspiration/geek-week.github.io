<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>📓 👩🏻 🉑 Security Week 21: Windows Print Service Vulnerability 👩🏿‍💻 👨‍👨‍👧‍👦 ⛅️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The most interesting news last week came as part of the next service pack for Microsoft operating systems and software (a review article ). In total, ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Security Week 21: Windows Print Service Vulnerability</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/kaspersky/blog/502598/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The most interesting news last week came as part of the next service pack for Microsoft operating systems and software (a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">review article</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). In total, developers closed 111 vulnerabilities, 16 of them serious. Unlike previous cumulative updates, not a single bug was exploited until the patch was released. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The vulnerability CVE-2020-1048 (description on </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Microsoft </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;">website</font></a><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">discussion</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> on Habré) in the Windows print service (more precisely, in the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows Print Spooler module</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) stands out not by the degree of threat, but by its history. It was found in an ancient piece of code, which, apparently, has not been updated since Windows NT4.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/od/ih/ye/odihyedgxak7unaxwwqjmdzdths.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The formal description of the problem is as follows: a vulnerability in Print Spooler allows a local user to increase privileges, as it provides random access to the file system. Last Tuesday, May 12, researchers Alex Ionescu and Yarden Shafir published a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">detailed</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> description of the problem. In simple words, CVE-2020-1048 is formulated at the end of the article: this is an incredibly easy-to-use bug - the system can be "attacked" with just a couple of commands in PowerShell. And that’s not all: the study sends us to an even more obsolete code for sending faxes (!) And the industrial attack Stuxnet.</font></font><br>
<a name="habracut"></a><br>
<div class="oembed"><twitter-widget class="twitter-tweet twitter-tweet-rendered" id="twitter-widget-0" style="position: static; visibility: visible; display: block; transform: rotate(0deg); max-width: 100%; width: 500px; min-width: 220px; margin-top: 10px; margin-bottom: 10px;" data-tweet-id="1260466215299973121"></twitter-widget>
<script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
</div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The publication describes in detail the mechanism of operation of Print Spooler - a system that is responsible for both printing documents and managing printers. </font><font style="vertical-align: inherit;">It can work with local and network printing devices, and also supports printing to a file. </font><font style="vertical-align: inherit;">The last method is described in detail in the article, including the mechanism for adding a virtual printer through a command in PowerShell. </font><font style="vertical-align: inherit;">With this result:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/ny/5s/q9/ny5sq92jceuibfsxr4f30z95c3u.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the end, it all comes down to introducing the magic team from the tweet above. Windows did not check the validity of the "destination", which made it possible to create a "printer" with a record in the system file, in this case, the ualapi.dll library. It is enough to “print” an arbitrary executable input into such a “printer”, and you get full control over the system. In the patch, Microsoft developers added print port verification. More precisely, it existed before that, but it only worked when using the tools for working with Print Spooler through a graphical interface (an investigation of Windows Internals shows an attempt to create such a tool). However, it did not work when working from the command line. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This study has a background: as early as April 30, Ionescu and Shafir </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">published</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">an article about a similar attack, but through a fax service (do you remember what it is? No? And Windows still supports them!). </font><font style="vertical-align: inherit;">At that time, researchers already knew the vulnerability in Print Spooler, but had to wait for the release of patches. </font><font style="vertical-align: inherit;">Therefore, the earlier publication had to be illogical to call the second part of the study, and in a couple of weeks to publish the first. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In 2010, a similar </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vulnerability was</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> closed in the Windows printing system </font><font style="vertical-align: inherit;">: privilege escalation in the system by arbitrary “printing” of data to a file. </font><font style="vertical-align: inherit;">The problem was exploited as part of the Stuxnet cyber attack and added to the toolbox for fixing to the target system. </font><font style="vertical-align: inherit;">Actually, we discovered it during the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">study</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">malicious code. </font><font style="vertical-align: inherit;">As a result of an incident 10 years ago, Print Spooler's defense was strengthened, but, as is now clear, not good enough.</font></font><br>
<br>
<h4>  </h4><br>
<div class="oembed"><twitter-widget class="twitter-tweet twitter-tweet-rendered" id="twitter-widget-1" style="position: static; visibility: visible; display: block; transform: rotate(0deg); max-width: 100%; width: 500px; min-width: 220px; margin-top: 10px; margin-bottom: 10px;" data-tweet-id="1260455198130143233"></twitter-widget>
<script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
</div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sophos has </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">interviewed</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> businesses about cyber attacks by ransomware. The average amount of losses due to such incidents amounted to 730 thousand dollars - but this is if you do not pay the ransom, but get a copy of the data from the backup and in other ways restore the infrastructure. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Most interestingly, the average damage among those who complied with the crackers' requirements turned out to be twice as much - 1.4 million dollars. In part, this is the "average temperature in the hospital", since competent protection and reservation can seriously save. But this is another argument for not paying cybercriminals, in addition to many examples of double extortion, when they first demand money for decrypting the data, and then for not distributing it.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Microsoft is </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://threatpost.com/microsoft-dns-over-"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">testing</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> DNS encryption using DNS-over-HTTPS. </font><font style="vertical-align: inherit;">Feature available in Windows 10 Insider Preview </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Build 19628</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Representatives of Facebook paid $ 20 thousand for detecting a bug in the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">service</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Continue with Facebook. </font><font style="vertical-align: inherit;">It allows you to log in to third-party resources through an account on the social network. </font><font style="vertical-align: inherit;">Researcher Vinot Kumar discovered that Continue with Facebook uses JavaScript code from Facebook servers to work, which can be replaced, which allows you to hijack a visitor’s account. </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;">Vulnerability</font></a><font style="vertical-align: inherit;"> found in </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;">Page Builder</font></a></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
plugin </font><font style="vertical-align: inherit;">for Wordpress</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">In theory, up to a million websites are subject to it; the error allows attacking a Wordpress administrator account by executing malicious code in a browser.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en502584/index.html">Manufacturer Mi Band will release a self-disinfecting transparent mask to protect against COVID-19</a></li>
<li><a href="../en502588/index.html">The incredible story of PowerPoint</a></li>
<li><a href="../en502592/index.html">Neomorphism using SwiftUI. Part 1</a></li>
<li><a href="../en502594/index.html">7 reasons why web projects are not brought to an end, and how to deal with it</a></li>
<li><a href="../en502596/index.html">Free quarantine educational courses: design</a></li>
<li><a href="../en502604/index.html">An Introduction to TLS for Patrik Patrick (Part 1)</a></li>
<li><a href="../en502608/index.html">How we started the marketplace of applications in the SaaS service</a></li>
<li><a href="../en502614/index.html">Kubernetes best practices. Setting Queries and Resource Limits</a></li>
<li><a href="../en502620/index.html">Money accounting</a></li>
<li><a href="../en502624/index.html">How do they work on Facebook? Values ​​and hiring in a company</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>