<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🌆 🤟🏻 🎩 我们正在Z-Stack 3.0上为具有ds18b20传感器的Zigbee继电器Sonoff BASICZBR3编写TI cc2530固件 👨🏿‍🤝‍👨🏾 🖐️ 🤚🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="假定读者已经具有C语言的初步知识，对Zigbee，cc2530芯片，闪存的使用方法以及使用它的知识有所了解，并且还熟悉诸如zigbee2mqtt之类的项目。如果不是这样，请准备或在https://myzigbee.ru和https://www.zigbee2mqtt.io/上阅读该
 文章。本文是首...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>我们正在Z-Stack 3.0上为具有ds18b20传感器的Zigbee继电器Sonoff BASICZBR3编写TI cc2530固件</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/iobroker/blog/495926/"><img src="https://habrastorage.org/webt/pk/k8/1r/pkk81rmgifam0ccamhmapnesahq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
假定读者已经具有C语言的初步知识，对Zigbee，cc2530芯片，闪存的使用方法以及使用它的知识有所了解，并且还熟悉诸如zigbee2mqtt之类的项目。</font><font style="vertical-align: inherit;">如果不是这样，请准备或在</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://myzigbee.ru</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://www.zigbee2mqtt.io/上</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">阅读</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">该</font></a></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
文章</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">。</font></a><font style="vertical-align: inherit;">本文是首先详细编写的，但是逐步加速并没有止步于细节，而是描述了完成的固件代码。</font><font style="vertical-align: inherit;">如果有人对推理不感兴趣，则只需打开固件源并阅读它们即可。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最终固件的源代码</font></font></a><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
代码和开发方法并不理想。</font><font style="vertical-align: inherit;">“我不是魔术师，我只是在学习。”</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目的</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
主要目标是长时间了解如何为Z-Stack编写固件。</font><font style="vertical-align: inherit;">因此，我决定为成品设备实施替代固件（以</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sonoff BASICZBR3</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">继电器为例</font><font style="vertical-align: inherit;">），并增加了连接流行的ds18b20温度传感器的功能。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
此外，我想向初学者Zigbee开发人员展示在Z-Stack上为TI cc2530芯片开发固件的示例。</font></font><br>
<a name="habracut"></a><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.准备</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
要开始开发，您需要下载并安装</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Z-Stack 3.0.2-</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这是一个用于开发带有示例和文档的固件的SDK。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
您还需要下载并安装</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">适用于8051的IAR嵌入式工作台</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -这是一个开发环境，能够针对TI cc2530芯片进行编译。</font><font style="vertical-align: inherit;">免费使用期限为1个月（但寻求者会找到解决方案）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
对于开发和调试，我使用CCDebugger-它不仅允许刷新cc2531 / cc2530芯片，而且还可以在IAR环境中调试应用程序。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/_j/aj/pr/_jajpr3cvn5q93lo6_igpenpdly.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
为了简化实验，原型设计和调试，我在devboard和相应的cc2530模块上进行了以下操作：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ql/xc/cq/qlxccqkdbxnqt3pcuo8049lj0ci.jpeg"><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.创建一个新的应用程序</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们基于GenericApp创建一个新项目。</font><font style="vertical-align: inherit;">这是基本Z-Stack应用程序的示例。</font><font style="vertical-align: inherit;">它位于Z-Stack 3.0.2 \ Projects \ zstack \ HomeAutomation \ GenericApp文件夹中。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们将其复制到附近并将其重命名，例如，重命名为DIYRuZRT（让我们为设备调用应用程序）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CC2530DB文件夹中包含文件：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GenericApp.ewd-C-SPY的项目设置</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GenericApp.ewp-项目文件</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GenericApp.eww-工作区</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
将文件重命名为DIYRuZRT.eww和DIYRuZRT.ewp。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在所有文件（包括Source文件夹）中，我们还将对GenericApp的所有引用更改为DIYRuZRT。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在，在IAR中打开DIYRuZRT.ewp项目。我们选择RouterEB的配置并执行全部重建。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/fb/re/mb/fbremb-ma8rcyafhwdcj6klys9k.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
将在CC2530DB文件夹中创建RouterEB文件夹，并且DIYRuZRT.d51文件将出现在EXE文件夹中-此文件便于从IAR进行刷新和调试。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
但是，如果我们需要通过SmartRF Flash编程器来刷新固件，那么我们将进行一些小的更改。为此，请在输出选项卡上链接部分的项目设置中，更改输出文件和格式的设置：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/r5/cb/xl/r5cbxlrunrutiwxxgt-gytlwjz4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
之后，将在EXE文件夹中创建DIYRuZRT.hex固件文件，方便</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从其他工具和其他方式进行刷新</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
但是上载此固件后，设备无法连接到网络。</font><font style="vertical-align: inherit;">好吧，我们会明白的。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.一点术语</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zigbee术语具有以下概念：</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">端点</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -终端设备的描述点。</font><font style="vertical-align: inherit;">通常在简单设备中只有一个端点。</font><font style="vertical-align: inherit;">在多功能设备中，以及在具有不同交互配置文件（一个配置文件-一个端点）的设备中，可以有多个配置文件。</font></font><br>
</li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">群集（群集）</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -与单个功能（开/关，调光，温度测量等）相关的一组属性和命令。</font><font style="vertical-align: inherit;">集群指示端点实现的机会。</font><font style="vertical-align: inherit;">在一个端点中，您可以实现几个不同的集群，但不能实现相同的集群。</font></font><br>
</li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性（属性）</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -可以读取或写入其值的集群的特征。</font><font style="vertical-align: inherit;">集群可以具有许多属性。</font></font><br>
</li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -集群可以处理的控制消息。</font><font style="vertical-align: inherit;">团队可能有参数。</font><font style="vertical-align: inherit;">这是通过接收命令和参数时执行的功能来实现的。</font></font><br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zigbee群集库中标准化了群集的类型，属性，命令。</font><font style="vertical-align: inherit;">但是制造商可以使用具有自己的属性和团队的自己的集群。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一些可怜的生产者不关心标准，而对标准有所作为。</font><font style="vertical-align: inherit;">然后，您必须适应它们。</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">Z-Stack</font></a></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
术语</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">也有其自己的概念</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，例如：</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OSAL（操作系统抽象层）</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -操作系统的抽象级别。</font><font style="vertical-align: inherit;">在这里，它们与任务（任务），消息（消息），事件（事件），计时器（定时器）和其他对象一起工作。</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HAL（硬件抽象层）</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -设备抽象级别。</font><font style="vertical-align: inherit;">在这里，它们通过按钮（按键），LED（指示灯），中断（Interrupt）等进行操作。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
硬件层提供了程序代码及其控制设备的隔离。</font><font style="vertical-align: inherit;">操作级别提供了用于在应用程序元素之间构建和交互的机制。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
原则上，在开发固件时，所有这些都在下面等着您。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.我们在基本应用程序中拥有什么？</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
应用程序代码位于“源”文件夹中：</font></font><br>
<br>
<ul>
<li><i>OSAL_DIYRuZRT.c</i> —    <br>
</li>
<li><i>zcl_DIYRuZRT.h</i> —  <br>
</li>
<li><i>zcl_DIYRuZRT.c</i> —   <br>
</li>
<li><i>zcl_DIYRuZRT_data.c</i> —  ,   <br>
</li>
</ul><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OSAL_DIYRuZRT.c-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主文件，在其中</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">填充</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">任务处理程序（任务）</font><b><font style="vertical-align: inherit;">pTaskEventHandlerFn taskArr</font></b><font style="vertical-align: inherit;">的数组，&nbsp; </font><font style="vertical-align: inherit;">并实现</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">osalInitTasks</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">初始化功能</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
需要所有其他文件来实现这些初始化程序和处理程序。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
任务处理程序的列表</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pTaskEventHandlerFn taskAr</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> r中填充了函数引用。一些任务通过相应的编译指令连接/断开。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
您可以在“已定义符号”编译器选项中查看和配置编译指令：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/pn/tl/u6/pntlu6bioazjsoaywmdfofeloas.png"><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">const</span> pTaskEventHandlerFn tasksArr[] = {<font></font>
  macEventLoop,<font></font>
  nwk_event_loop,<font></font>
#<span class="hljs-keyword">if</span> !defined (DISABLE_GREENPOWER_BASIC_PROXY) &amp;&amp; (ZG_BUILD_RTR_TYPE)<font></font>
  gp_event_loop,<font></font>
#endif  <font></font>
  Hal_ProcessEvent,<font></font>
#<span class="hljs-keyword">if</span> defined( MT_TASK )<font></font>
  MT_ProcessEvent,<font></font>
#endif<font></font>
  APS_event_loop,<font></font>
#<span class="hljs-keyword">if</span> defined ( ZIGBEE_FRAGMENTATION )<font></font>
  APSF_ProcessEvent,<font></font>
#endif<font></font>
  ZDApp_event_loop,<font></font>
#<span class="hljs-keyword">if</span> defined ( ZIGBEE_FREQ_AGILITY ) || defined ( ZIGBEE_PANID_CONFLICT )<font></font>
  ZDNwkMgr_event_loop,<font></font>
#endif<font></font>
  <span class="hljs-comment">//Added to include TouchLink functionality</span>
  #<span class="hljs-keyword">if</span> defined ( INTER_PAN )<font></font>
    StubAPS_ProcessEvent,<font></font>
  #endif<font></font>
  <span class="hljs-comment">// Added to include TouchLink initiator functionality</span>
  #<span class="hljs-keyword">if</span> defined ( BDB_TL_INITIATOR )<font></font>
    touchLinkInitiator_event_loop,<font></font>
  #endif<font></font>
  <span class="hljs-comment">// Added to include TouchLink target functionality</span>
  #<span class="hljs-keyword">if</span> defined ( BDB_TL_TARGET )<font></font>
    touchLinkTarget_event_loop,<font></font>
  #endif<font></font>
  zcl_event_loop,<font></font>
  bdb_event_loop,<font></font>
  zclDIYRuZRT_event_loop<font></font>
};<font></font>
</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">osalInitTasks</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是应用程序启动功能，用于注册</font><b><font style="vertical-align: inherit;">由</font></b><font style="vertical-align: inherit;">应用程序</font><b><font style="vertical-align: inherit;">执行的</font></b><font style="vertical-align: inherit;">任务。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
任务注册按顺序执行，每个任务都有自己的编号。重要的是要遵循与</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">taskArr</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数组相同的顺序</font><font style="vertical-align: inherit;">，因为根据任务编号调用处理程序。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">osalInitTasks</span><span class="hljs-params">( <span class="hljs-keyword">void</span> )</span>
</span>{<font></font>
  uint8 taskID = <span class="hljs-number">0</span>;<font></font>
<font></font>
  tasksEvents = (uint16 *)osal_mem_alloc( <span class="hljs-keyword">sizeof</span>( uint16 ) * tasksCnt);<font></font>
  osal_memset( tasksEvents, <span class="hljs-number">0</span>, (<span class="hljs-keyword">sizeof</span>( uint16 ) * tasksCnt));<font></font>
<font></font>
  macTaskInit( taskID++ );<font></font>
  nwk_init( taskID++ );<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> !defined (DISABLE_GREENPOWER_BASIC_PROXY) &amp;&amp; (ZG_BUILD_RTR_TYPE)</span><font></font>
  gp_Init( taskID++ );<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><font></font>
  Hal_Init( taskID++ );<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> defined( MT_TASK )</span><font></font>
  MT_TaskInit( taskID++ );<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><font></font>
  APS_Init( taskID++ );<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> defined ( ZIGBEE_FRAGMENTATION )</span><font></font>
  APSF_Init( taskID++ );<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><font></font>
  ZDApp_Init( taskID++ );<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> defined ( ZIGBEE_FREQ_AGILITY ) || defined ( ZIGBEE_PANID_CONFLICT )</span><font></font>
  ZDNwkMgr_Init( taskID++ );<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span>
  <span class="hljs-comment">// Added to include TouchLink functionality</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> defined ( INTER_PAN )</span><font></font>
  StubAPS_Init( taskID++ );<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span>
<span class="hljs-comment">// Added to include TouchLink initiator functionality</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> defined( BDB_TL_INITIATOR )</span><font></font>
  touchLinkInitiator_Init( taskID++ );<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span>
<span class="hljs-comment">// Added to include TouchLink target functionality</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> defined ( BDB_TL_TARGET )</span><font></font>
  touchLinkTarget_Init( taskID++ );<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><font></font>
  zcl_Init( taskID++ );<font></font>
  bdb_Init( taskID++ );<font></font>
  zclDIYRuZRT_Init( taskID );<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们的应用程序注册了函数处理程序</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zclDIYRuZRT_event_loop</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和初始化函数</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zclDIYRuZRT_Init</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。它们被添加到列表的最后。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这是我们应用程序的两个主要功能。这些功能的实现在</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zcl_DIYRuZRT.c</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件中</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zclDIYRuZRT_Init-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">任务注册功能。</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DIYRuZRT_ENDPOINT-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们的应用程序实现的端点号。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
描述我们的应用程序的注册步骤是按顺序执行的：</font></font><br>
<br>
<ul>
<li><b>bdb_RegisterSimpleDescriptor </b> —    .    <b>SimpleDescriptionFormat_t zclDIYRuZRT_SimpleDesc</b> —    ,  , ,    .       <i>OSAL_DIYRuZRT_data.c</i><br>
</li>
<li><b>zclGeneral_RegisterCmdCallbacks </b> —      <b>zclGeneral_AppCallbacks_t zclDIYRuZRT_CmdCallbacks</b> —  ,       .<br>
</li>
<li><b>zcl_registerAttrList </b> —    <b>zclAttrRec_t zclDIYRuZRT_Attrs</b> —  ,     .<br>
</li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zcl_registerForMsg-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注册接收控制消息。</font></font><br>
</li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RegisterForKeys-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们签署了接收按钮单击事件的任务。</font></font><br>
</li>
</ul><br>
<pre><code class="cpp hljs"><span class="hljs-comment">/*********************************************************************
 * SIMPLE DESCRIPTOR
 */</span>
<span class="hljs-comment">// This is the Cluster ID List and should be filled with Application</span>
<span class="hljs-comment">// specific cluster IDs.</span>
<span class="hljs-keyword">const</span> cId_t zclDIYRuZRT_InClusterList[] =<font></font>
{<font></font>
  ZCL_CLUSTER_ID_GEN_BASIC,<font></font>
  ZCL_CLUSTER_ID_GEN_IDENTIFY,<font></font>
  <font></font>
  <span class="hljs-comment">// DIYRuZRT_<span class="hljs-doctag">TODO:</span> Add application specific Input Clusters Here. </span>
  <span class="hljs-comment">//       See zcl.h for Cluster ID definitions</span><font></font>
  <font></font>
};<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> ZCLDIYRuZRT_MAX_INCLUSTERS   (sizeof(zclDIYRuZRT_InClusterList) / sizeof(zclDIYRuZRT_InClusterList[0]))</span><font></font>
<font></font>
<font></font>
<span class="hljs-keyword">const</span> cId_t zclDIYRuZRT_OutClusterList[] =<font></font>
{<font></font>
  ZCL_CLUSTER_ID_GEN_BASIC,<font></font>
  <font></font>
  <span class="hljs-comment">// DIYRuZRT_<span class="hljs-doctag">TODO:</span> Add application specific Output Clusters Here. </span>
  <span class="hljs-comment">//       See zcl.h for Cluster ID definitions</span><font></font>
};<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> ZCLDIYRuZRT_MAX_OUTCLUSTERS  (sizeof(zclDIYRuZRT_OutClusterList) / sizeof(zclDIYRuZRT_OutClusterList[0]))</span><font></font>
<font></font>
<font></font>
SimpleDescriptionFormat_t zclDIYRuZRT_SimpleDesc =<font></font>
{<font></font>
  DIYRuZRT_ENDPOINT,                  <span class="hljs-comment">//  int Endpoint;</span>
  ZCL_HA_PROFILE_ID,                     <span class="hljs-comment">//  uint16 AppProfId;</span>
  <span class="hljs-comment">// DIYRuZRT_<span class="hljs-doctag">TODO:</span> Replace ZCL_HA_DEVICEID_ON_OFF_LIGHT with application specific device ID</span>
  ZCL_HA_DEVICEID_ON_OFF_LIGHT,          <span class="hljs-comment">//  uint16 AppDeviceId; </span>
  DIYRuZRT_DEVICE_VERSION,            <span class="hljs-comment">//  int   AppDevVer:4;</span>
  DIYRuZRT_FLAGS,                     <span class="hljs-comment">//  int   AppFlags:4;</span>
  ZCLDIYRuZRT_MAX_INCLUSTERS,         <span class="hljs-comment">//  byte  AppNumInClusters;</span>
  (cId_t *)zclDIYRuZRT_InClusterList, <span class="hljs-comment">//  byte *pAppInClusterList;</span>
  ZCLDIYRuZRT_MAX_OUTCLUSTERS,        <span class="hljs-comment">//  byte  AppNumInClusters;</span>
  (cId_t *)zclDIYRuZRT_OutClusterList <span class="hljs-comment">//  byte *pAppInClusterList;</span><font></font>
};<font></font>
</code></pre><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zclDIYRuZRT_event_loop-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们的应用程序的事件处理程序的功能。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
首先，系统事件在循环中处理：</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ZCL_INCOMING_MSG-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设备控制命令在zclDIYRuZRT_ProcessIncomingMsg中处理。</font></font><br>
</li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">KEY_CHANGE-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">按钮单击事件在</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zclDIYRuZRT_HandleKeys</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中处理</font><font style="vertical-align: inherit;">。</font></font><br>
</li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ZDO_STATE_CHANGE-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">网络状态更改事件。</font></font><br>
</li>
</ul><br>
<pre><code class="cpp hljs">  <span class="hljs-keyword">if</span> ( events &amp; SYS_EVENT_MSG )<font></font>
  {<font></font>
    <span class="hljs-keyword">while</span> ( (MSGpkt = (afIncomingMSGPacket_t *)osal_msg_receive( zclDIYRuZRT_TaskID )) )<font></font>
    {<font></font>
      <span class="hljs-keyword">switch</span> ( MSGpkt-&gt;hdr.event )<font></font>
      {<font></font>
        <span class="hljs-keyword">case</span> ZCL_INCOMING_MSG:
          <span class="hljs-comment">// Incoming ZCL Foundation command/response messages</span><font></font>
          zclDIYRuZRT_ProcessIncomingMsg( (zclIncomingMsg_t *)MSGpkt );<font></font>
          <span class="hljs-keyword">break</span>;<font></font>
<font></font>
        <span class="hljs-keyword">case</span> KEY_CHANGE:<font></font>
          zclDIYRuZRT_HandleKeys( ((keyChange_t *)MSGpkt)-&gt;state, ((keyChange_t *)MSGpkt)-&gt;keys );<font></font>
          <span class="hljs-keyword">break</span>;<font></font>
<font></font>
        <span class="hljs-keyword">case</span> ZDO_STATE_CHANGE:<font></font>
          zclDIYRuZRT_NwkState = (devStates_t)(MSGpkt-&gt;hdr.status);<font></font>
<font></font>
          <span class="hljs-comment">// now on the network</span>
          <span class="hljs-keyword">if</span> ( (zclDIYRuZRT_NwkState == DEV_ZB_COORD) ||<font></font>
               (zclDIYRuZRT_NwkState == DEV_ROUTER)   ||<font></font>
               (zclDIYRuZRT_NwkState == DEV_END_DEVICE) )<font></font>
          {<font></font>
            giGenAppScreenMode = GENERIC_MAINMODE;<font></font>
            zclDIYRuZRT_LcdDisplayUpdate();<font></font>
          }<font></font>
          <span class="hljs-keyword">break</span>;<font></font>
<font></font>
        <span class="hljs-keyword">default</span>:
          <span class="hljs-keyword">break</span>;<font></font>
      }<font></font>
<font></font>
      <span class="hljs-comment">// Release the memory</span><font></font>
      osal_msg_deallocate( (uint8 *)MSGpkt );<font></font>
    }<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
接下来是特殊事件</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DIYRuZRT_EVT_1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的处理，该事件</font><font style="vertical-align: inherit;">将切换LED </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HAL_LED_2</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的状态，</font><font style="vertical-align: inherit;">并为同一事件启动500m的计时器。</font><font style="vertical-align: inherit;">这将开始闪烁LED </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HAL_LED_2</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="cpp hljs">  <span class="hljs-keyword">if</span> ( events &amp; DIYRuZRT_EVT_1 )<font></font>
  {<font></font>
    <span class="hljs-comment">// toggle LED 2 state, start another timer for 500ms</span><font></font>
    HalLedSet ( HAL_LED_2, HAL_LED_MODE_TOGGLE );<font></font>
    osal_start_timerEx( zclDIYRuZRT_TaskID, DIYRuZRT_EVT_1, <span class="hljs-number">500</span> );<font></font>
    <font></font>
    <span class="hljs-keyword">return</span> ( events ^ DIYRuZRT_EVT_1 );<font></font>
  }<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
事实是，当固件启动时，</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会发生HAL_KEY_SW_1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">事件</font><b><font style="vertical-align: inherit;">，</font></b><font style="vertical-align: inherit;">并且正是在其中</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">初始化</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">了计时器和</font><b><font style="vertical-align: inherit;">DIYRuZRT_EVT_1</font></b><font style="vertical-align: inherit;">事件</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果您按S2按钮，则闪烁将停止（我的LED保持点亮）。</font><font style="vertical-align: inherit;">再按一次将开始闪烁。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5. HAL：LED和按钮</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
您问：“等等，哪个LED和按钮？”。</font><font style="vertical-align: inherit;">最初，Z-stack中的所有示例都集中于SmartRF05 EB系列的各种调试板：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/tz/bl/ru/tzblrurrrpoze3kghx_dd1zrume.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我有一个略有不同的调试板和一个带有芯片的模块。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
板上有2个按钮（+重置）和3个LED（+电源指示灯）。</font><font style="vertical-align: inherit;">当固件正常工作时，这是其中之一（D2）闪烁。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
调用触点后，我们确定引脚，二极管和按钮的对应关系：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D1-P10</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D2-P11</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D3-P14</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">S2-P20</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">S1-P01</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
因此，HAL是</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">硬件抽象层</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，一种从设备的实现中抽象的方法。应用程序代码使用与抽象（例如</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Button 1</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LED 2）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">配合使用的宏和函数</font><font style="vertical-align: inherit;">，并且抽象和设备的特定对应关系是单独设置的。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
让我们</font><font style="vertical-align: inherit;">弄清楚什么是</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HAL_LED_2，</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以及如何了解它挂在哪个引脚上。</font><i><font style="vertical-align: inherit;">通过</font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
搜索，我们找到了</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hal_led.h</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件</font><font style="vertical-align: inherit;">，其中描述了这些常量和</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HalLedSet</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数</font><font style="vertical-align: inherit;">，并在其中传输了LED编号和模式。在内部，</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调用HalLedOnOff</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数</font><font style="vertical-align: inherit;">来打开和关闭LED，后者依次执行</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HAL_TURN_ON_LED2</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HAL_TURN_OFF_LED2</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HAL_TURN_ON_LED2</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HAL_TURN_OFF_LED2</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是中描述的宏</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hal_board_cfg.h</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">宏会根据硬件配置而变化。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
就我而言：</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> HAL_TURN_OFF_LED2() &nbsp; &nbsp; &nbsp; st( LED2_SBIT = LED2_POLARITY (0); )</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> HAL_TURN_ON_LED2()&nbsp; &nbsp; &nbsp; &nbsp; st( LED2_SBIT = LED2_POLARITY (1); )</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
文件中稍高一点的是</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LED2_SBIT</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LED2_POLARITY</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的对应</font><b><font style="vertical-align: inherit;">关系</font></b><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="cpp hljs">&nbsp;&nbsp;<span class="hljs-comment">/* 2 - Red */</span>
&nbsp;&nbsp;<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LED2_BV &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; BV(1)</span>
&nbsp;&nbsp;<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LED2_SBIT &nbsp; &nbsp; &nbsp; &nbsp; P1_1</span>
&nbsp;&nbsp;<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LED2_DDR&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; P1DIR</span>
&nbsp;&nbsp;<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LED2_POLARITY &nbsp; &nbsp; ACTIVE_HIGH</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这意味着LED 2位于引脚</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P1_1上，</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并且其开关电平为高。</font><font style="vertical-align: inherit;">但是，根据代码判断，当按下按钮时，LED应该熄灭，但随着我们的出现，LED会一直亮着。</font><font style="vertical-align: inherit;">如果在此文件</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hal_board_cfg.h中，我们进行了</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更改：</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LED2_POLARITY &nbsp; &nbsp; ACTIVE_HIGH</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LED2_POLARITY &nbsp; &nbsp; ACTIVE_LOW</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
然后现在按S2按钮时LED熄灭，这应该是逻辑上的。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
为了不更改与我们的应用程序不相关的通用文件，最好这样做：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在我们的Source文件夹中</font><font style="vertical-align: inherit;">创建</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hal_board_cfg.h</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件的副本</font><font style="vertical-align: inherit;">（来自Z-Stack 3.0.2 \ Components \ hal \ target \ CC2530EB \文件夹），并将其命名为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hal_board_cfg_DIYRuZRT.h</font></font></i><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让我们将文件的副本制作为第一个副本（从而排除共享文件的连接）。</font><font style="vertical-align: inherit;">在我们的Source文件夹中创建一个</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">preinclude.h</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件，</font><font style="vertical-align: inherit;">并在其中写入以下行：</font></font><br>
</li>
</ul><br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"hal_board_cfg_DIYRuZRT.h"</span></span></code></pre><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表示此文件的连接是第一个-在项目设置中：</font></font><br>
</li>
</ul><br>
<pre><code class="cpp hljs">$PROJ_DIR$\..\Source\preinclude.h</code></pre><br>
<img src="https://habrastorage.org/webt/jl/_f/j_/jl_fj_oy71xhwehgszprw9jhdiw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在，我们可以在我们的设备参数</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hal_board_cfg_DIYRuZRT.h</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件</font><font style="vertical-align: inherit;">，并在</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">preinclude.h</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件</font><font style="vertical-align: inherit;">，而无需修改共享文件。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我将编译器指令转移到相同的preinclude.h文件，并在编译器选项中将其删除：</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SECURE 1</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> TC_LINKKEY_JOIN</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> NV_INIT</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> NV_RESTORE</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> xZTOOL_P1</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> xMT_TASK</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> xMT_APP_FUNC</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> xMT_SYS_FUNC</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> xMT_ZDO_FUNC</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> xMT_ZDO_MGMT</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> xMT_APP_CNF_FUNC</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LEGACY_LCD_DEBUG</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LCD_SUPPORTED DEBUG</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MULTICAST_ENABLED FALSE</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> ZCL_READ</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> ZCL_WRITE</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> ZCL_BASIC</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> ZCL_IDENTIFY</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> ZCL_SCENES</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> ZCL_GROUPS</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在同一个文件</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hal_board_cfg_DIYRuZRT.h中，</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们找到S1按钮和操纵杆中心按的说明：</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">/* S1 */</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PUSH1_BV&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; BV(1)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PUSH1_SBIT&nbsp; &nbsp; &nbsp; &nbsp; P0_1</span><font></font>
<font></font>
<span class="hljs-comment">/* Joystick Center Press */</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PUSH2_BV&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; BV(0)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PUSH2_SBIT&nbsp; &nbsp; &nbsp; &nbsp; P2_0</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PUSH2_POLARITY&nbsp; &nbsp; ACTIVE_HIGH</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这对应于板上按钮的引脚。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
让我们看一下硬件初始化- </font><font style="vertical-align: inherit;">同一文件中</font><font style="vertical-align: inherit;">的</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HAL_BOARD_INIT</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">宏</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">默认情况下，</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HAL_BOARD_CC2530EB_REV17</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指令</font><b><font style="vertical-align: inherit;">处于打开状态</font></b><font style="vertical-align: inherit;">，因此我们看一下相应的宏变体。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">/* ----------- Board Initialization ---------- */</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> defined (HAL_BOARD_CC2530EB_REV17) &amp;&amp; !defined (HAL_PA_LNA) &amp;&amp; \
    !defined (HAL_PA_LNA_CC2590) &amp;&amp; !defined (HAL_PA_LNA_SE2431L) &amp;&amp; \
    !defined (HAL_PA_LNA_CC2592)</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> HAL_BOARD_INIT()                                         \
{                                                                \
  uint16 i;                                                      \
                                                                 \
  SLEEPCMD &amp;= ~OSC_PD;                       <span class="hljs-comment">/* turn on 16MHz RC and 32MHz XOSC */</span>                \
  while (!(SLEEPSTA &amp; XOSC_STB));            <span class="hljs-comment">/* wait for 32MHz XOSC stable */</span>                     \
  asm(<span class="hljs-meta-string">"NOP"</span>);                                <span class="hljs-comment">/* chip bug workaround */</span>                            \
  for (i=0; i&lt;504; i++) asm(<span class="hljs-meta-string">"NOP"</span>);          <span class="hljs-comment">/* Require 63us delay for all revs */</span>                \
  CLKCONCMD = (CLKCONCMD_32MHZ | OSC_32KHZ); <span class="hljs-comment">/* Select 32MHz XOSC and the source for 32K clock */</span> \
  while (CLKCONSTA != (CLKCONCMD_32MHZ | OSC_32KHZ)); <span class="hljs-comment">/* Wait for the change to be effective */</span>   \
  SLEEPCMD |= OSC_PD;                        <span class="hljs-comment">/* turn off 16MHz RC */</span>                              \
                                                                 \
  <span class="hljs-comment">/* Turn on cache prefetch mode */</span>                              \
  PREFETCH_ENABLE();                                             \
                                                                 \
  HAL_TURN_OFF_LED1();                                           \
  LED1_DDR |= LED1_BV;                                           \
  HAL_TURN_OFF_LED2();                                           \
  LED2_DDR |= LED2_BV;                                           \
  HAL_TURN_OFF_LED3();                                           \
  LED3_DDR |= LED3_BV;                                           \
  HAL_TURN_OFF_LED4();                                           \
  LED4_SET_DIR();                                                \
                                                                 \
  <span class="hljs-comment">/* configure tristates */</span>                                      \
  P0INP |= PUSH2_BV;                                             \
}</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在此宏中，处理器的模式和寄存器被初始化。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
取而代之的是将</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LED2_DDR</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和其他</font><b><font style="vertical-align: inherit;">LED2_DDR</font></b><font style="vertical-align: inherit;">替换为</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P1DIR-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将该端口</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注册</font><font style="vertical-align: inherit;">，充电操作模式引脚（输入或输出）。相应地，</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LED2_BV</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置为相应引脚的每位1（在我们的情况下为1位，对应于</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P1_1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">引脚</font><font style="vertical-align: inherit;">）：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/qr/ed/0y/qred0ypxdrfxxkaleymbpqmjgto.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
寄存器和处理器模式在</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ cc253x用户指南”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的文档中进行了描述，但是在</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">何处看不到</font></a></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
按钮的配置方式。按钮的处理方式类似，但是在另一个文件</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hal_key.c中</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。它定义按钮的参数和功能</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HalKeyInit</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HalKeyConfig</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HalKeyRead</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HalKeyPoll</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这些功能负责初始化使用按钮和读取值的子系统。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
缺省情况下，定时器每100ms进行一次按钮处理。</font><font style="vertical-align: inherit;">当前配置的引脚P2_0被分配到操纵杆，并且单击即可读取其当前状态-因此，LED闪烁计时器启动。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.我们为自己配置设备</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在文件</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zcl_DIYRuZRT.h中进行</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更改</font><font style="vertical-align: inherit;">：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DIYRuZRT_ENDPOINT在1</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在文件</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OSAL_DIYRuZRT_data.c中</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DIYRuZRT_DEVICE_VERSION为1</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{6，'D'，'I'，'Y'，'R'，'u'，'Z'}上的zclDIYRuZRT_ManufacturerName</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{9，'D'，'I'，'Y'，'R'，'u'，'Z'，'_'，'R'，'T'}上的zclDIYRuZRT_ModelId</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{8，'2'，'0'，'2'，'0'，'0'，'4'，'0'，'5'}上的zclDIYRuZRT_DateCode</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
为了使设备能够在任何通道上连接网络（默认情况下，</font><font style="vertical-align: inherit;">在</font><i><font style="vertical-align: inherit;">Tools \ f8wConfig.cfg文件</font></i><font style="vertical-align: inherit;">的</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DEFAULT_CHANLIST</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">伪指令</font><font style="vertical-align: inherit;">中</font><font style="vertical-align: inherit;">仅指定11个</font><font style="vertical-align: inherit;">），必须</font><i><font style="vertical-align: inherit;">通过</font></i><font style="vertical-align: inherit;">更改伪指令的值</font><font style="vertical-align: inherit;">在</font><i><font style="vertical-align: inherit;">preinclude.h</font></i><font style="vertical-align: inherit;">文件中指定此功能</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">
我们还添加了编译指令</font><b><font style="vertical-align: inherit;">DISABLE_GREENPOWER_BASIC_PROXY，</font></b><font style="vertical-align: inherit;">以便未为我们的设备创建GREENPOWER端点。</font><font style="vertical-align: inherit;">
同时关闭对LCD屏幕的不必要的支持。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">//#define LCD_SUPPORTED DEBUG</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> DISABLE_GREENPOWER_BASIC_PROXY</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> DEFAULT_CHANLIST 0x07FFF800&nbsp; <span class="hljs-comment">// ALL Channels</span></span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
为了使我们的设备自动尝试连接到网络，我们将在功能代码</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zclDIYRuZRT_Init中</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">添加到网络的连接</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="cpp hljs">bdb_StartCommissioning(BDB_COMMISSIONING_MODE_NWK_STEERING |<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BDB_COMMISSIONING_MODE_FINDING_BINDING);<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
之后，执行Build，将固件填充到芯片中，然后开始在协调器上进行配对。</font><font style="vertical-align: inherit;">我在ioBroker.zigbee中检查了Zigbee网络的运行情况，这是新连接的设备的外观：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/um/ik/ss/umikss4n4f19icobraxj-rb_tj4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
太好了，原来可以连接该设备！</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.我们使设备的操作复杂化</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在，让我们尝试对功能进行一些调整：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">长按按钮可将设备连接到网络。</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果设备已经在网络上，则长按可从网络上显示它。</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">短按-切换LED的状态。</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设备停电后启动时，LED的状态应保持不变。</font></font><br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
为了设置自己的按钮处理，我创建了</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DIYRuZRT_HalKeyInit</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数，</font><font style="vertical-align: inherit;">类似于</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hal_key.c</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模块中的</font><i><font style="vertical-align: inherit;">函数</font></i><font style="vertical-align: inherit;">，但仅用于我的一组按钮。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">//    ()</span>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">DIYRuZRT_HalKeyInit</span><span class="hljs-params">( <span class="hljs-keyword">void</span> )</span>
</span>{
  <span class="hljs-comment">/*      0 */</span>
  halKeySavedKeys = <span class="hljs-number">0</span>;<font></font>
<font></font>
  PUSH1_SEL &amp;= ~(PUSH1_BV); <span class="hljs-comment">/*    - GPIO */</span>
  PUSH1_DIR &amp;= ~(PUSH1_BV); <span class="hljs-comment">/*    -  */</span><font></font>
  <font></font>
  PUSH1_ICTL &amp;= ~(PUSH1_ICTLBIT); <span class="hljs-comment">/*      */</span>
  PUSH1_IEN &amp;= ~(PUSH1_IENBIT);   <span class="hljs-comment">/*     */</span><font></font>
  <font></font>
  PUSH2_SEL &amp;= ~(PUSH2_BV); <span class="hljs-comment">/* Set pin function to GPIO */</span>
  PUSH2_DIR &amp;= ~(PUSH2_BV); <span class="hljs-comment">/* Set pin direction to Input */</span><font></font>
  <font></font>
  PUSH2_ICTL &amp;= ~(PUSH2_ICTLBIT); <span class="hljs-comment">/* don't generate interrupt */</span>
  PUSH2_IEN &amp;= ~(PUSH2_IENBIT);   <span class="hljs-comment">/* Clear interrupt enable bit */</span><font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
调用此函数将添加到宏</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HAL_BOARD_INIT</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hal_board_cfg_DIYRuZRT.h中</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">为避免冲突，请禁用同一文件</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hal_board_cfg_DIYRuZRT.h中</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的内置</font><i><font style="vertical-align: inherit;">hal_key</font></i><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> HAL_KEY FALSE</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
因为 </font><font style="vertical-align: inherit;">标准按钮阅读器已禁用，我们会自己做。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在初始化函数</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zclDIYRuZRT_Init中</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font><b><font style="vertical-align: inherit;">我们</font></b><font style="vertical-align: inherit;">启动计时器以读取按钮的状态。</font><font style="vertical-align: inherit;">计时器将生成我们的</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HAL_KEY_EVENT</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">事件</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="cpp hljs">osal_start_reload_timer( zclDIYRuZRT_TaskID, HAL_KEY_EVENT, <span class="hljs-number">100</span>);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在事件循环中，我们</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调用</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DIYRuZRT_HalKeyPoll</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数来</font><font style="vertical-align: inherit;">处理</font><b><font style="vertical-align: inherit;">HAL_KEY_EVENT</font></b><font style="vertical-align: inherit;">事件</font><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">//  </span>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">DIYRuZRT_HalKeyPoll</span> <span class="hljs-params">(<span class="hljs-keyword">void</span>)</span>
</span>{<font></font>
  uint8 keys = <span class="hljs-number">0</span>;<font></font>
<font></font>
  <span class="hljs-comment">//   1 ?</span>
  <span class="hljs-keyword">if</span> (HAL_PUSH_BUTTON1())<font></font>
  {<font></font>
    keys |= HAL_KEY_SW_1;<font></font>
  }<font></font>
  <font></font>
  <span class="hljs-comment">//   2 ?</span>
  <span class="hljs-keyword">if</span> (HAL_PUSH_BUTTON2())<font></font>
  {<font></font>
    keys |= HAL_KEY_SW_2;<font></font>
  }<font></font>
  <font></font>
  <span class="hljs-keyword">if</span> (keys == halKeySavedKeys)<font></font>
  {<font></font>
    <span class="hljs-comment">//  -  </span>
    <span class="hljs-keyword">return</span>;<font></font>
  }<font></font>
  <span class="hljs-comment">//        . </span><font></font>
  halKeySavedKeys = keys;<font></font>
<font></font>
  <span class="hljs-comment">//     </span><font></font>
  OnBoard_SendKeys(keys, HAL_KEY_STATE_NORMAL);<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
将按钮的状态保存在</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">halKeySavedKeys</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量中，</font><font style="vertical-align: inherit;">使我们能够确定更改的时刻-按下并释放按钮。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
当您单击按钮时，启动计时器5秒钟。</font><font style="vertical-align: inherit;">如果触发此计时器，则将生成</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DIYRuZRT_EVT_LONG</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">事件</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果释放按钮，计时器将重置。</font><font style="vertical-align: inherit;">无论如何，如果您按下按钮，我们将切换LED的状态。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">//   </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">zclDIYRuZRT_HandleKeys</span><span class="hljs-params">( byte shift, byte keys )</span>
</span>{
  <span class="hljs-keyword">if</span> ( keys &amp; HAL_KEY_SW_1 )<font></font>
  {<font></font>
    <span class="hljs-comment">//       - 5 </span>
    osal_start_timerEx(zclDIYRuZRT_TaskID, DIYRuZRT_EVT_LONG, <span class="hljs-number">5000</span>);
    <span class="hljs-comment">//  </span>
    updateRelay(RELAY_STATE == <span class="hljs-number">0</span>);<font></font>
  }<font></font>
  <span class="hljs-keyword">else</span><font></font>
  {<font></font>
    <span class="hljs-comment">//     </span><font></font>
    osal_stop_timerEx(zclDIYRuZRT_TaskID, DIYRuZRT_EVT_LONG);<font></font>
  }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在，在处理长按事件时，我们通过结构属性</font><b><font style="vertical-align: inherit;">bdbAttributes.bdbNodeIsOnANetwork</font></b><font style="vertical-align: inherit;">注意网络的当前状态。</font></font><b><font style="vertical-align: inherit;"></font></b><br>
<br>
<pre><code class="cpp hljs">  <span class="hljs-comment">//  DIYRuZRT_EVT_LONG</span>
  <span class="hljs-keyword">if</span> ( events &amp; DIYRuZRT_EVT_LONG )<font></font>
  {<font></font>
    <span class="hljs-comment">//    </span>
    <span class="hljs-comment">//      ?</span>
    <span class="hljs-keyword">if</span> ( bdbAttributes.bdbNodeIsOnANetwork )<font></font>
    {<font></font>
      <span class="hljs-comment">//  </span><font></font>
      zclDIYRuZRT_LeaveNetwork();<font></font>
    }<font></font>
    <span class="hljs-keyword">else</span> <font></font>
    {<font></font>
      <span class="hljs-comment">//    </span><font></font>
      bdb_StartCommissioning(<font></font>
        BDB_COMMISSIONING_MODE_NWK_FORMATION | <font></font>
        BDB_COMMISSIONING_MODE_NWK_STEERING | <font></font>
        BDB_COMMISSIONING_MODE_FINDING_BINDING | <font></font>
        BDB_COMMISSIONING_MODE_INITIATOR_TL<font></font>
      );<font></font>
      <span class="hljs-comment">//  ,   </span>
      osal_start_timerEx(zclDIYRuZRT_TaskID, DIYRuZRT_EVT_BLINK, <span class="hljs-number">500</span>);<font></font>
    }<font></font>
    <font></font>
    <span class="hljs-keyword">return</span> ( events ^ DIYRuZRT_EVT_LONG );<font></font>
  }<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们走得更远。</font><font style="vertical-align: inherit;">LED的状态将保存在变量中，我们将其值保存在NV存储器中。</font><font style="vertical-align: inherit;">设备启动时，我们将从内存中读取该值到一个变量中。</font></font><br>
<br>
<pre><code class="cpp hljs">  <span class="hljs-comment">//  NVM   RELAY STATE</span>
  <span class="hljs-keyword">if</span> ( SUCCESS == osal_nv_item_init( NV_DIYRuZRT_RELAY_STATE_ID, <span class="hljs-number">1</span>, &amp;RELAY_STATE ) ) {
    <span class="hljs-comment">//   RELAY STATE  </span>
    osal_nv_read( NV_DIYRuZRT_RELAY_STATE_ID, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, &amp;RELAY_STATE );<font></font>
  }<font></font>
  <span class="hljs-comment">//   </span><font></font>
  applyRelay();<font></font>
</code></pre><br>
<pre><code class="cpp hljs"><span class="hljs-comment">//   </span>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">updateRelay</span> <span class="hljs-params">( <span class="hljs-keyword">bool</span> value )</span>
</span>{
  <span class="hljs-keyword">if</span> (value) {<font></font>
    RELAY_STATE = <span class="hljs-number">1</span>;<font></font>
  } <span class="hljs-keyword">else</span> {<font></font>
    RELAY_STATE = <span class="hljs-number">0</span>;<font></font>
  }<font></font>
  <span class="hljs-comment">//   </span>
  osal_nv_write(NV_DIYRuZRT_RELAY_STATE_ID, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, &amp;RELAY_STATE);
  <span class="hljs-comment">//   </span><font></font>
  applyRelay();<font></font>
}<font></font>
  <font></font>
<span class="hljs-comment">//   </span>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">applyRelay</span> <span class="hljs-params">( <span class="hljs-keyword">void</span> )</span>
</span>{
  <span class="hljs-comment">//  </span>
  <span class="hljs-keyword">if</span> (RELAY_STATE == <span class="hljs-number">0</span>) {
    <span class="hljs-comment">//    1</span><font></font>
    HalLedSet ( HAL_LED_1, HAL_LED_MODE_OFF );<font></font>
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">//    1</span><font></font>
    HalLedSet ( HAL_LED_1, HAL_LED_MODE_ON );<font></font>
  }<font></font>
}<font></font>
</code></pre><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.现在我们将处理Zigbee</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
到目前为止，我们已经对硬件进行了分类-通过按钮，我们可以控制LED。</font><font style="vertical-align: inherit;">现在我们通过Zigbee实现相同的功能。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
要控制中继，对于我们来说，使用我们唯一的端点并实现</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GenOnOff</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">集群就足够了</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">我们已经阅读了</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GenOnOff</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">集群的Zigbee集群库规范</font><font style="vertical-align: inherit;">：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/zo/9z/z7/zo9zz7ccj2oyfyrxrk3mithxh0i.png"><br>
<br>
<img src="https://habrastorage.org/webt/7b/na/ek/7bnaekoi4gmleiisjwvbfw75hao.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
足以实现OnOff属性和On，Off，Toggle命令。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
首先，将指令添加到</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">preinclude.h中</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> ZCL_ON_OFF</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在属性zclDIYRuZRT_Attrs的描述中，我们添加了新的集群属性：</font></font><br>
<br>
<pre><code class="cpp hljs">  <span class="hljs-comment">// ***  On/Off  ***</span><font></font>
  {<font></font>
    ZCL_CLUSTER_ID_GEN_ON_OFF,<font></font>
    { <span class="hljs-comment">// </span><font></font>
      ATTRID_ON_OFF,<font></font>
      ZCL_DATATYPE_BOOLEAN,<font></font>
      ACCESS_CONTROL_READ,<font></font>
      (<span class="hljs-keyword">void</span> *)&amp;RELAY_STATE<font></font>
    }<font></font>
  },<font></font>
  {<font></font>
    ZCL_CLUSTER_ID_GEN_ON_OFF,<font></font>
    {  <span class="hljs-comment">//  On/Off </span><font></font>
      ATTRID_CLUSTER_REVISION,<font></font>
      ZCL_DATATYPE_UINT16,<font></font>
      ACCESS_CONTROL_READ | ACCESS_CLIENT,<font></font>
      (<span class="hljs-keyword">void</span> *)&amp;zclDIYRuZRT_clusterRevision_all<font></font>
    }<font></font>
  },<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们还将集群添加到支持的传入端点集群</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zclDIYRuZRT_InClusterList</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的列表中</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
要实现控制命令，请将处理程序添加到</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zclDIYRuZRT_CmdCallbacks</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">/*********************************************************************
 *    ZCL 
 */</span>
<span class="hljs-keyword">static</span> zclGeneral_AppCallbacks_t zclDIYRuZRT_CmdCallbacks =<font></font>
{<font></font>
  zclDIYRuZRT_BasicResetCB,               <span class="hljs-comment">// Basic Cluster Reset command</span>
  <span class="hljs-literal">NULL</span>,                                   <span class="hljs-comment">// Identify Trigger Effect command</span>
  zclDIYRuZRT_OnOffCB,                    <span class="hljs-comment">// On/Off cluster commands</span>
  <span class="hljs-literal">NULL</span>,                                   <span class="hljs-comment">// On/Off cluster enhanced command Off with Effect</span>
  <span class="hljs-literal">NULL</span>,                                   <span class="hljs-comment">// On/Off cluster enhanced command On with Recall Global Scene</span>
  <span class="hljs-literal">NULL</span>,                                   <span class="hljs-comment">// On/Off cluster enhanced command On with Timed Off</span><font></font>
#ifdef ZCL_LEVEL_CTRL<font></font>
  <span class="hljs-literal">NULL</span>,                                   <span class="hljs-comment">// Level Control Move to Level command</span>
  <span class="hljs-literal">NULL</span>,                                   <span class="hljs-comment">// Level Control Move command</span>
  <span class="hljs-literal">NULL</span>,                                   <span class="hljs-comment">// Level Control Step command</span>
  <span class="hljs-literal">NULL</span>,                                   <span class="hljs-comment">// Level Control Stop command</span><font></font>
#endif<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们实现它：</font></font><br>
<pre><code class="cpp hljs"><span class="hljs-comment">//    OnOff</span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">zclDIYRuZRT_OnOffCB</span><span class="hljs-params">(uint8 cmd)</span>
</span>{
  <span class="hljs-comment">//  ,   </span>
  <span class="hljs-comment">//    </span><font></font>
  afIncomingMSGPacket_t *pPtr = zcl_getRawAFMsg();<font></font>
  zclDIYRuZRT_DstAddr.addr.shortAddr = pPtr-&gt;srcAddr.addr.shortAddr;<font></font>
  <font></font>
  <span class="hljs-comment">// </span>
  <span class="hljs-keyword">if</span> (cmd == COMMAND_ON) {<font></font>
    updateRelay(TRUE);<font></font>
  }<font></font>
  <span class="hljs-comment">// </span>
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (cmd == COMMAND_OFF) {<font></font>
    updateRelay(FALSE);<font></font>
  }<font></font>
  <span class="hljs-comment">// </span>
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (cmd == COMMAND_TOGGLE) {<font></font>
    updateRelay(RELAY_STATE == <span class="hljs-number">0</span>);<font></font>
  }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
很好，现在可以通过命令切换继电器。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/rg/_b/r5/rg_br5mwpw1z8g63trgcdts2o84.png"><br>
<br>
<img src="https://habrastorage.org/webt/sc/s8/-h/scs8-heldl3hz6l7h4ia3jllscw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
但这还不够。</font><font style="vertical-align: inherit;">现在，如果我们使用按钮进行切换，我们还必须告知协调器LED的当前状态。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
再次，添加指令：</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> ZCL_REPORTING_DEVICE</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在，创建一个</font><font style="vertical-align: inherit;">发送状态消息</font><font style="vertical-align: inherit;">的函数</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zclDIYRuZRT_ReportOnOff</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">我们将在切换LED和设备启动时称呼它。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">//    </span>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">zclDIYRuZRT_ReportOnOff</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{
  <span class="hljs-keyword">const</span> uint8 NUM_ATTRIBUTES = <span class="hljs-number">1</span>;<font></font>
<font></font>
  zclReportCmd_t *pReportCmd;<font></font>
<font></font>
  pReportCmd = osal_mem_alloc(<span class="hljs-keyword">sizeof</span>(zclReportCmd_t) +<font></font>
                              (NUM_ATTRIBUTES * <span class="hljs-keyword">sizeof</span>(zclReport_t)));
  <span class="hljs-keyword">if</span> (pReportCmd != <span class="hljs-literal">NULL</span>) {<font></font>
    pReportCmd-&gt;numAttr = NUM_ATTRIBUTES;<font></font>
<font></font>
    pReportCmd-&gt;attrList[<span class="hljs-number">0</span>].attrID = ATTRID_ON_OFF;<font></font>
    pReportCmd-&gt;attrList[<span class="hljs-number">0</span>].dataType = ZCL_DATATYPE_BOOLEAN;<font></font>
    pReportCmd-&gt;attrList[<span class="hljs-number">0</span>].attrData = (<span class="hljs-keyword">void</span> *)(&amp;RELAY_STATE);<font></font>
<font></font>
    zclDIYRuZRT_DstAddr.addrMode = (afAddrMode_t)Addr16Bit;<font></font>
    zclDIYRuZRT_DstAddr.addr.shortAddr = <span class="hljs-number">0</span>;<font></font>
    zclDIYRuZRT_DstAddr.endPoint = <span class="hljs-number">1</span>;<font></font>
<font></font>
    zcl_SendReportCmd(DIYRuZRT_ENDPOINT, &amp;zclDIYRuZRT_DstAddr,<font></font>
                      ZCL_CLUSTER_ID_GEN_ON_OFF, pReportCmd,<font></font>
                      ZCL_FRAME_CLIENT_SERVER_DIR, <span class="hljs-literal">false</span>, SeqNum++);<font></font>
  }<font></font>
<font></font>
  osal_mem_free(pReportCmd);<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在，在日志中，我们看到有关LED状态更改的消息。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.连接ds18b20温度传感器</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
传感器连接到任何空闲引脚（在我的情况下，设置为</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P2_1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
将传感器轮询代码添加到应用程序。我们将定期进行面试-每分钟一次。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
轮询后，网络协调员会立即将当前值通知您。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
阅读ZCL规范以从温度传感器发送数据。我们需要一个</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">温度测量</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">集群</font></font><br>
<br>
<img src="https://habrastorage.org/webt/o2/_q/8h/o2_q8h7gtgxs7cjvvz8dumonsgq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
，我们需要实现3个属性，其中一个代表温度值乘以100，</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这里我们通过与</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GenOnOff</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">集群类似的方式添加属性</font><font style="vertical-align: inherit;">。我们将</font><font style="vertical-align: inherit;">在开始时每分钟计划一次</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DIYRuZRT_REPORTING_EVT</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">事件</font><font style="vertical-align: inherit;">，</font><font style="vertical-align: inherit;">通知协调员</font><font style="vertical-align: inherit;">。在事件处理程序中，我们将调用</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zclDIYRuZRT_ReportTemp</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，它将读取传感器的温度并发送一条消息。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">//   </span>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">zclDIYRuZRT_ReportTemp</span><span class="hljs-params">( <span class="hljs-keyword">void</span> )</span>
</span>{
  <span class="hljs-comment">//  </span><font></font>
  zclDIYRuZRT_MeasuredValue = readTemperature();<font></font>
  <font></font>
  <span class="hljs-keyword">const</span> uint8 NUM_ATTRIBUTES = <span class="hljs-number">1</span>;<font></font>
<font></font>
  zclReportCmd_t *pReportCmd;<font></font>
<font></font>
  pReportCmd = osal_mem_alloc(<span class="hljs-keyword">sizeof</span>(zclReportCmd_t) +<font></font>
                              (NUM_ATTRIBUTES * <span class="hljs-keyword">sizeof</span>(zclReport_t)));
  <span class="hljs-keyword">if</span> (pReportCmd != <span class="hljs-literal">NULL</span>) {<font></font>
    pReportCmd-&gt;numAttr = NUM_ATTRIBUTES;<font></font>
<font></font>
    pReportCmd-&gt;attrList[<span class="hljs-number">0</span>].attrID = ATTRID_MS_TEMPERATURE_MEASURED_VALUE;<font></font>
    pReportCmd-&gt;attrList[<span class="hljs-number">0</span>].dataType = ZCL_DATATYPE_INT16;<font></font>
    pReportCmd-&gt;attrList[<span class="hljs-number">0</span>].attrData = (<span class="hljs-keyword">void</span> *)(&amp;zclDIYRuZRT_MeasuredValue);<font></font>
<font></font>
    zclDIYRuZRT_DstAddr.addrMode = (afAddrMode_t)Addr16Bit;<font></font>
    zclDIYRuZRT_DstAddr.addr.shortAddr = <span class="hljs-number">0</span>;<font></font>
    zclDIYRuZRT_DstAddr.endPoint = <span class="hljs-number">1</span>;<font></font>
<font></font>
    zcl_SendReportCmd(DIYRuZRT_ENDPOINT, &amp;zclDIYRuZRT_DstAddr,<font></font>
                      ZCL_CLUSTER_ID_MS_TEMPERATURE_MEASUREMENT, pReportCmd,<font></font>
                      ZCL_FRAME_CLIENT_SERVER_DIR, <span class="hljs-literal">false</span>, SeqNum++);<font></font>
  }<font></font>
<font></font>
  osal_mem_free(pReportCmd);<font></font>
}<font></font>
</code></pre><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.将固件倒入设备</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
要将开发板更改为Sonoff BASICZBR3，您需要调整LED引脚和按钮的匹配。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/eg/fu/we/egfuweya8lj53yh-5rarbvslzvk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
重做引脚</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P0_7</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上的LED 1 </font><font style="vertical-align: inherit;">以控制继电器。包含由高级别的</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ACTIVE_HIGH执行</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><b><font style="vertical-align: inherit;">我们将</font></b></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">S1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">按钮</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重新挂</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在引脚</font><b><font style="vertical-align: inherit;">P1_3上</font></b><font style="vertical-align: inherit;">，并将信息LED 2 </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">挂</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font><b><font style="vertical-align: inherit;">P1_0上</font></b><font style="vertical-align: inherit;">。我们将温度传感器留在引脚</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P2_1上</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。我们在</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hal_board_cfg_DIYRuZRT.h</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件中进行所有这些更改</font><font style="vertical-align: inherit;">。要选择一个配置，我们将创建一个单独的指令</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HAL_SONOFF</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。如果已设置，则将使用Sonoff BASICZBR3的设置，否则将使用devboard。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">ifdef</span> HAL_SONOFF</span>
  <span class="hljs-comment">/* 1 - P0_7  */</span>
  <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LED1_BV           BV(7)</span>
  <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LED1_SBIT         P0_7</span>
  <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LED1_DDR          P0DIR</span>
  <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LED1_POLARITY     ACTIVE_HIGH</span><font></font>
<font></font>
  <span class="hljs-comment">/* 2 - P1_0  */</span>
  <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LED2_BV           BV(0)</span>
  <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LED2_SBIT         P1_0</span>
  <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LED2_DDR          P1DIR</span>
  <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LED2_POLARITY     ACTIVE_LOW</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">else</span></span>
  <span class="hljs-comment">/* 1 - P1_0  */</span>
  <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LED1_BV           BV(0)</span>
  <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LED1_SBIT         P1_0</span>
  <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LED1_DDR          P1DIR</span>
  <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LED1_POLARITY     ACTIVE_LOW</span><font></font>
<font></font>
  <span class="hljs-comment">/* 2 - P1_1  */</span>
  <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LED2_BV           BV(1)</span>
  <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LED2_SBIT         P1_1</span>
  <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LED2_DDR          P1DIR</span>
  <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LED2_POLARITY     ACTIVE_LOW</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
必须纠正另一个重要参数-“手表”石英的存在，因为 </font><font style="vertical-align: inherit;">在Sonoff BASICZBR3板上未焊接：</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">//#define HAL_CLOCK_CRYSTAL</span>
  <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> OSC32K_CRYSTAL_INSTALLED FALSE</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
没有这些选项，固件将无法启动（或者并非总是启动）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
之后，我们收集固件并连接到固件。</font></font><br>
<blockquote><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意！！！</font><font style="vertical-align: inherit;">在进行任何连接和固件之前，请先将Sonoff BASICZBR3继电器与交流电源断开！</font></font></b></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们将Sonoff BASICZBR3布线与CCDebugger连接，擦除芯片并刷新固件。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/bz/w-/3b/bzw-3bib84ucfczt0kg_mmbajtw.jpeg"><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11.我们在zigbee2mqtt和ioBroker.Zigbee中启动设备</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
尽管该设备已经出现在已连接设备的列表中，并且可以通过发送命令进行管理，但是我们需要更正确地执行此操作-使用图片和状态。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
要在</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ioBroker.Zigbee中</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">获得新设备</font><font style="vertical-align: inherit;">，您需要执行两个步骤：</font></font><br>
<br>
<ol>
<li>     <b>zigbee-herdsman-converters</b>.       ,       <b>zigbee2mqtt</b>.<br>
</li>
<li>    <b>ioBroker.Zigbee</b><br>
</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
可以首先在本地文件中进行所有更改，然后在相应的存储库中进行PR。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们</font><font style="vertical-align: inherit;">在已安装的ioBroker（或zigbee2mqtt）中</font><font style="vertical-align: inherit;">找到</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zigbee-herdsman-converters</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">软件包的位置</font><font style="vertical-align: inherit;">。在包内，我们可以找到</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">devices.js</font></font></i> <font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://github.com/Koenkk/zigbee-herdsman-converters/blob/master/devices.js。</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
此文件包含</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ioBroker.zigbee</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zigbee2mqtt</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以</font><b><font style="vertical-align: inherit;">使用</font></b><font style="vertical-align: inherit;">的所有设备的描述</font><font style="vertical-align: inherit;">。我们在其中找到了DIYRuZ设备的描述块（在2300行之后）。在此块中添加新设备的描述：</font></font><br>
<br>
<pre><code class="javascript hljs">&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">zigbeeModel</span>: [<span class="hljs-string">'DIYRuZ_RT'</span>],
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">model</span>: <span class="hljs-string">'DIYRuZ_RT'</span>,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">vendor</span>: <span class="hljs-string">'DIYRuZ'</span>,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">description</span>: <span class="hljs-string">''</span>,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">supports</span>: <span class="hljs-string">'on/off, temperature'</span>,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">fromZigbee</span>: [fz.on_off, fz.temperature],
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">toZigbee</span>: [tz.on_off],<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;},<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fromZigbee</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性中</font><b><font style="vertical-align: inherit;">，</font></b><font style="vertical-align: inherit;">我们指定将处理来自设备的消息的转换器。我们的两个职位是标准化的。</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fz.on_off</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">转换器</font><font style="vertical-align: inherit;">处理开/关消息，而</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fz.temperature处理</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">温度数据。这些转换器的代码（位于文件转换器/fromZigbee.js中）显示了如何处理传入消息以及温度除以100。</font></font><br>
<br>
<pre><code class="javascript hljs">   on_off: {
        <span class="hljs-attr">cluster</span>: <span class="hljs-string">'genOnOff'</span>,
        <span class="hljs-attr">type</span>: [<span class="hljs-string">'attributeReport'</span>, <span class="hljs-string">'readResponse'</span>],
        <span class="hljs-attr">convert</span>: <span class="hljs-function">(<span class="hljs-params">model, msg, publish, options, meta</span>) =&gt;</span> {
            <span class="hljs-keyword">if</span> (msg.data.hasOwnProperty(<span class="hljs-string">'onOff'</span>)) {
                <span class="hljs-keyword">const</span> property = getProperty(<span class="hljs-string">'state'</span>, msg, model);
                <span class="hljs-keyword">return</span> {[property]: msg.data[<span class="hljs-string">'onOff'</span>] === <span class="hljs-number">1</span> ? <span class="hljs-string">'ON'</span> : <span class="hljs-string">'OFF'</span>};<font></font>
            }<font></font>
        },<font></font>
    },<font></font>
</code></pre><br>
<pre><code class="javascript hljs"> temperature: {
        <span class="hljs-attr">cluster</span>: <span class="hljs-string">'msTemperatureMeasurement'</span>,
        <span class="hljs-attr">type</span>: [<span class="hljs-string">'attributeReport'</span>, <span class="hljs-string">'readResponse'</span>],
        <span class="hljs-attr">convert</span>: <span class="hljs-function">(<span class="hljs-params">model, msg, publish, options, meta</span>) =&gt;</span> {
            <span class="hljs-keyword">const</span> temperature = <span class="hljs-built_in">parseFloat</span>(msg.data[<span class="hljs-string">'measuredValue'</span>]) / <span class="hljs-number">100.0</span>;
            <span class="hljs-keyword">return</span> {<span class="hljs-attr">temperature</span>: calibrateAndPrecisionRoundOptions(temperature, options, <span class="hljs-string">'temperature'</span>)};<font></font>
        },<font></font>
    },<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">toZigbee</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性中，</font><b><font style="vertical-align: inherit;">我们</font></b><font style="vertical-align: inherit;">指定将处理命令到设备的转换器。</font><font style="vertical-align: inherit;">在我们的例子中，它是</font><font style="vertical-align: inherit;">用于切换继电器</font><font style="vertical-align: inherit;">的</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tz.on_off</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">转换器</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一切都添加到了“转换器”中。</font><font style="vertical-align: inherit;">谁在使用</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zigbee2mqtt-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您已经可以使用它。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
并且ioBroker用户仍将设备的描述添加到</font><i><font style="vertical-align: inherit;">ioBroker.zigbee \ lib \ devices.js</font></i><font style="vertical-align: inherit;">文件中</font></font><i><font style="vertical-align: inherit;"></font></i><br>
<br>
<pre><code class="javascript hljs">&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">vendor</span>: <span class="hljs-string">'DIYRuZ'</span>,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">models</span>: [<span class="hljs-string">'DIYRuZ_RT'</span>],
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">icon</span>: <span class="hljs-string">'img/DIYRuZ.png'</span>,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">states</span>: [<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;states.state,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;states.temperature,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;],<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;},<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在这里，足以表明完全相同的模型，带有图片的文件和状态列表。</font><font style="vertical-align: inherit;">在我们的情况下，状态也是标准的：</font><font style="vertical-align: inherit;">继电器</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">状态</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的状态，</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">温度</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示的温度值。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/oz/fu/zm/ozfuzmz72p-e1lwweegnd4fv74q.png"><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12.接下来呢？</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
不幸的是，我无法弄清楚Z-Stack 3.0提供的所有方面和功能。</font><font style="vertical-align: inherit;">我很可能甚至没有正确实现某种功能，或者可能使用一些内置机制来实现它。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
因此，可以改进和开发上述解决方案。</font><font style="vertical-align: inherit;">以下是一些指示：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我无法快速找到通过继电器连接子设备的解决方案。</font><font style="vertical-align: inherit;">其他路由器设备可以执行allow_join命令并通过自身连接新设备，而不必将新设备带到协调器。</font><font style="vertical-align: inherit;">该设备由路由器代表，可以在网络图上正确显示，但是拒绝执行“ permit_join”命令。</font><font style="vertical-align: inherit;">更准确地说，该命令会执行，但设备不会通过该命令进行连接。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此外，未实施正确的报告。</font><font style="vertical-align: inherit;">当您可以使用configReport命令指定要发送的属性列表和通知频率时，这是一种配置状态通知的方法。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与小组合作。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">处理中断并通过中断实现轮询按钮。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
好吧，对于以下设备，您需要处理电源模式并在电池上创建“休眠”设备。</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与往常一样，除评论外，我邀请您</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在Zigbee上的Telegram聊天中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">讨论此设备和其他设备</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我想对Telegram聊天和Zigbee社区的同事们的发展给予的支持和帮助表示感谢：</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t.me/DJONvl</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t.me/antstar</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t.me/Jager_f</font></font></a></li>
</ul><br>
</blockquote><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参考文献</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
主要文档包含在Z-Stack 3.0.2 SDK中，并随其一起安装。</font><font style="vertical-align: inherit;">但我将在此处提供部分链接：</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OSAL和HAL </font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TI ZIgbee维基</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Create New Application For SmartRF05 + CC2530 SWRA231 Version 1.1</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Z-Stack Home Sample Application User's Guide SWRU354 Version 1.3</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Z-Stack Sample Applications SWRA201 Version 1.6</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Z-Stack Developer's Guide SWRA176 Version 1.12</a>&nbsp;</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Z-Stack 3.0 Developer's Guide Version 1.14</a>&nbsp;</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Z-Stack API SWRA195 Version 1.10</a>&nbsp;</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">TI CC253x User's Guide</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://github.com/formtapez/ZigUP</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Zigbee Cluster Library rev 6</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">   DIYRuZ_RT</a></li>
</ul></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN495910/index.html">在Ubuntu单板IMG映像中安装ROS</a></li>
<li><a href="../zh-CN495912/index.html">智能重播贴纸</a></li>
<li><a href="../zh-CN495918/index.html">如何在电脑游戏和VR中再现逼真的声音以及为什么很难</a></li>
<li><a href="../zh-CN495920/index.html">PTPv2时间同步协议的实现细节</a></li>
<li><a href="../zh-CN495924/index.html">为什么建立一个良好的COVID-19发行模型如此困难？</a></li>
<li><a href="../zh-CN495932/index.html">SCRUM指南中作者的隐藏含义是什么。第1部分。关于过程</a></li>
<li><a href="../zh-CN495934/index.html">在家中的数据治理</a></li>
<li><a href="../zh-CN495938/index.html">机器学习文章精选：2020年3月的案例，指南和研究</a></li>
<li><a href="../zh-CN495942/index.html">节省时间，精力和工时</a></li>
<li><a href="../zh-CN495944/index.html">更新的TOP50（CIS超级计算机的等级）：动态和趋势</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>