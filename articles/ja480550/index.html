<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🈂️ 🙌🏿 🛄 JVMのバイトコードからのHello World ✍🏼 ☀️ 👨‍👨‍👧‍👦</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="「Hello World」を表示する単純なプログラムをコンパイルし、その構造をウォークスルーします
 

この記事は、バイトコードがどのように表示され、JVMがどのように機能するか（たとえば、少なくとも最も簡単な指示（その存在についての知識）など）を表面的に知らない人にとっては十分な情報にはなりませ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>JVMのバイトコードからのHello World</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/480550/"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「Hello World」を表示する単純なプログラムをコンパイルし、その構造をウォークスルーします</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">この記事は、バイトコードがどのように表示され、JVMがどのように機能するか（たとえば、少なくとも最も簡単な指示（その存在についての知識）など）を表面的に知らない人にとっては十分な情報にはなりません。</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">実際、それほど難しくはありません。</font></font><code>javap</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JDK </font><font style="vertical-align: inherit;">のツールを使用し</font><font style="vertical-align: inherit;">て、逆アセンブルされたコードを検討する</font><font style="vertical-align: inherit;">だけで十分</font><font style="vertical-align: inherit;">です。</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">そして、JVMのバイトコードの構造を分析し始めます</font></font></p><a name="habracut"></a><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">このために非常に有用な本は、公式のJVM仕様-OracleのJava Virtual Machine Specificationでし</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">た。</font></font></a></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">まず、簡単なプログラムを作成します。</font></font></p><br>
<pre><code class="java hljs">    <span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Main</span> </span>{
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String ... args)</span> </span>{<font></font>
            System.out.println(<span class="hljs-string">"Hello World"</span>);<font></font>
        }<font></font>
    }<font></font>
</code></pre><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">チームでコンパイルして</font></font><code>javac Main.java</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">実際に分解する</font></font></p><br>
<pre><code class="plaintext hljs">    javap -c -v Main</code></pre><br>
<p><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Main.class</font></font></em></p><br>
<pre><code class="plaintext hljs">Classfile /C:/Users/Arthur/playground/java/jvm/Main.class<font></font>
  Last modified 26.10.2019; size 413 bytes<font></font>
  MD5 checksum 6449121a3bb611fee394e4f322401ee1<font></font>
  Compiled from "Main.java"<font></font>
public class Main<font></font>
  minor version: 0<font></font>
  major version: 52<font></font>
  flags: ACC_PUBLIC, ACC_SUPER<font></font>
Constant pool:<font></font>
   #1 = Methodref          #6.#15         // java/lang/Object."&lt;init&gt;":()V<font></font>
   #2 = Fieldref           #16.#17        // java/lang/System.out:Ljava/io/PrintStream;<font></font>
   #3 = String             #18            // Hello World<font></font>
   #4 = Methodref          #19.#20 // java/io/PrintStream.println:(Ljava/lang/String;)V<font></font>
   #5 = Class              #21            // Main<font></font>
   #6 = Class              #22            // java/lang/Object<font></font>
   #7 = Utf8               &lt;init&gt;<font></font>
   #8 = Utf8               ()V<font></font>
   #9 = Utf8               Code<font></font>
  #10 = Utf8               LineNumberTable<font></font>
  #11 = Utf8               main<font></font>
  #12 = Utf8               ([Ljava/lang/String;)V<font></font>
  #13 = Utf8               SourceFile<font></font>
  #14 = Utf8               Main.java<font></font>
  #15 = NameAndType        #7:#8          // "&lt;init&gt;":()V<font></font>
  #16 = Class              #23            // java/lang/System<font></font>
  #17 = NameAndType        #24:#25        // out:Ljava/io/PrintStream;<font></font>
  #18 = Utf8               Hello World<font></font>
  #19 = Class              #26            // java/io/PrintStream<font></font>
  #20 = NameAndType        #27:#28        // println:(Ljava/lang/String;)V<font></font>
  #21 = Utf8               Main<font></font>
  #22 = Utf8               java/lang/Object<font></font>
  #23 = Utf8               java/lang/System<font></font>
  #24 = Utf8               out<font></font>
  #25 = Utf8               Ljava/io/PrintStream;<font></font>
  #26 = Utf8               java/io/PrintStream<font></font>
  #27 = Utf8               println<font></font>
  #28 = Utf8               (Ljava/lang/String;)V<font></font>
{<font></font>
  public Main();<font></font>
    descriptor: ()V<font></font>
    flags: ACC_PUBLIC<font></font>
    Code:<font></font>
      stack=1, locals=1, args_size=1<font></font>
         0: aload_0<font></font>
         1: invokespecial #1                  // Method java/lang/Object."&lt;init&gt;":()V<font></font>
         4: return<font></font>
      LineNumberTable:<font></font>
        line 1: 0<font></font>
<font></font>
  public static void main(java.lang.String...);<font></font>
    descriptor: ([Ljava/lang/String;)V<font></font>
    flags: ACC_PUBLIC, ACC_STATIC, ACC_VARARGS<font></font>
    Code:<font></font>
      stack=2, locals=1, args_size=1<font></font>
         0: getstatic     #2        // Field java/lang/System.out:Ljava/io/PrintStream;<font></font>
         3: ldc           #3        // String Hello World<font></font>
         5: invokevirtual #4// Method java/io/PrintStream.println:(Ljava/lang/String;)V<font></font>
         8: return<font></font>
      LineNumberTable:<font></font>
        line 4: 0<font></font>
        line 5: 8<font></font>
}<font></font>
SourceFile: "Main.java"<font></font>
</code></pre><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">これは、元のバイトコードよりも人にとって見やすいバイトコード表現ですが、見た目は異なります。</font></font></p><br>
<pre><code class="plaintext hljs">    cafe babe 0000 0034 001d 0a00 0600 0f09<font></font>
    0010 0011 0800 120a 0013 0014 0700 1507<font></font>
    0016 0100 063c 696e 6974 3e01 0003 2829<font></font>
    5601 0004 436f 6465 0100 0f4c 696e 654e<font></font>
    756d 6265 7254 6162 6c65 0100 046d 6169<font></font>
    6e01 0016 285b 4c6a 6176 612f 6c61 6e67<font></font>
    2f53 7472 696e 673b 2956 0100 0a53 6f75<font></font>
    7263 6546 696c 6501 0009 4d61 696e 2e6a<font></font>
    6176 610c 0007 0008 0700 170c 0018 0019<font></font>
    0100 0b48 656c 6c6f 2057 6f72 6c64 0700<font></font>
    1a0c 001b 001c 0100 044d 6169 6e01 0010<font></font>
    6a61 7661 2f6c 616e 672f 4f62 6a65 6374<font></font>
    0100 106a 6176 612f 6c61 6e67 2f53 7973<font></font>
    7465 6d01 0003 6f75 7401 0015 4c6a 6176<font></font>
    612f 696f 2f50 7269 6e74 5374 7265 616d<font></font>
    3b01 0013 6a61 7661 2f69 6f2f 5072 696e<font></font>
    7453 7472 6561 6d01 0007 7072 696e 746c<font></font>
    6e01 0015 284c 6a61 7661 2f6c 616e 672f<font></font>
    5374 7269 6e67 3b29 5600 2100 0500 0600<font></font>
    0000 0000 0200 0100 0700 0800 0100 0900<font></font>
    0000 1d00 0100 0100 0000 052a b700 01b1<font></font>
    0000 0001 000a 0000 0006 0001 0000 0001<font></font>
    0089 000b 000c 0001 0009 0000 0025 0002<font></font>
    0001 0000 0009 b200 0212 03b6 0004 b100<font></font>
    0000 0100 0a00 0000 0a00 0200 0000 0400<font></font>
    0800 0500 0100 0d00 0000 0200 0e</code></pre><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font><code>.class</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイル-&gt;エンコードして保存-&gt;ヘキサデミカルを示す崇高なテキストでファイルを</font><font style="vertical-align: inherit;">開くことができます</font><font style="vertical-align: inherit;">）</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">このコードで作業します。</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">しかし、最初に、それがどこにあるか混乱しないようにフォーマットする必要があります。実際、バイトコードは非常に厳密な構造を持っています。</font></font></p><br>
<pre><code class="plaintext hljs">    ClassFile {<font></font>
        u4             magic;<font></font>
        u2             minor_version;<font></font>
        u2             major_version;<font></font>
        u2             constant_pool_count;<font></font>
        cp_info      constant_pool[constant_pool_count-1];<font></font>
        u2             access_flags;<font></font>
        u2             this_class;<font></font>
        u2             super_class;<font></font>
        u2             interfaces_count;<font></font>
        u2             interfaces[interfaces_count];<font></font>
        u2             fields_count;<font></font>
        field_info    fields[fields_count];<font></font>
        u2             methods_count;<font></font>
        method_info    methods[methods_count];<font></font>
        u2             attributes_count;<font></font>
        attribute_info attributes[attributes_count];<font></font>
    }</code></pre><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JVM仕様の</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">4.1章ClassFile構造で</font></a><font style="vertical-align: inherit;">見つけることができます。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a></p><br>
<p>   —     ,   .</p><br>
<p> -    hexadecimal,     4 ,  ,    — 4      — 8 .</p><br>
<p><strong>magic</strong></p><br>
<p>magic —  ,     .   <code>0xCAFEBABE</code>,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a>.</p><br>
<p><strong>minor_version, major_version</strong></p><br>
<p>   <code>class</code> .    <code>major_version</code> M  <code>minor_version</code> m,     <code>class</code>   <code>M.m</code></p><br>
<p>         "Hello World",     :</p><br>
<pre><code class="plaintext hljs">    cafe babe   -- magic<font></font>
    0000         -- minor_version<font></font>
    0034         -- major_version</code></pre><br>
<p>       ,      :</p><br>
<pre><code class="plaintext hljs">    ...<font></font>
    public class Main<font></font>
      minor version: 0<font></font>
      major version: 52<font></font>
      flags: ACC_PUBLIC, <font></font>
    ...</code></pre><br>
<p><strong>constant_pool_count</strong></p><br>
<p>      .  ,        -,        ,        ,       (!).</p><br>
<p>   ,      <code>___ + 1</code></p><br>
<p>, :</p><br>
<pre><code class="plaintext hljs">    cafe babe   -- magic<font></font>
    0000 0034   -- version<font></font>
    001d        -- constant_pool_count</code></pre><br>
<p><strong>constant_pool[]</strong></p><br>
<p>        :</p><br>
<pre><code class="plaintext hljs">    cp_info {<font></font>
     u1 tag;<font></font>
     u1 info[];<font></font>
    }</code></pre><br>
<p>    .   <code>tag</code>,                 <code>info[]</code></p><br>
<p>       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Table 4.3 Constant pool tags</a></p><br>
<p>,  :</p><br>
<div class="scrollable-table"><table>
<thead>
<tr>
<th>Constant Type</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>CONSTANT_Class</code></td>
<td>7</td>
</tr>
<tr>
<td><code>CONSTANT_Fieldref</code></td>
<td>9</td>
</tr>
<tr>
<td><code>CONSTANT_Methodref</code></td>
<td>10</td>
</tr>
<tr>
<td><code>CONSTANT_InterfaceMethodref</code></td>
<td>11</td>
</tr>
<tr>
<td><code>CONSTANT_String</code></td>
<td>8</td>
</tr>
<tr>
<td><code>CONSTANT_Integer</code></td>
<td>3</td>
</tr>
<tr>
<td><code>CONSTANT_Float</code></td>
<td>4</td>
</tr>
<tr>
<td><code>CONSTANT_Long</code></td>
<td>5</td>
</tr>
<tr>
<td><code>CONSTANT_Double</code></td>
<td>6</td>
</tr>
<tr>
<td><code>CONSTANT_NameAndType</code></td>
<td>12</td>
</tr>
<tr>
<td><code>CONSTANT_Utf8</code></td>
<td>1</td>
</tr>
<tr>
<td><code>CONSTANT_MethodHandle</code></td>
<td>15</td>
</tr>
<tr>
<td><code>CONSTANT_MethodType</code></td>
<td>16</td>
</tr>
<tr>
<td><code>CONSTANT_InvokeDynamic</code></td>
<td>18</td>
</tr>
</tbody>
</table></div><br>
<p>   ,      .</p><br>
<p>, ,  <code>CONSTANT_Class</code>:</p><br>
<pre><code class="plaintext hljs">    CONSTANT_Class_info {<font></font>
        u1 tag;<font></font>
        u2 name_index;<font></font>
    }</code></pre><br>
<p>   :</p><br>
<pre><code class="plaintext hljs">    CONSTANT_Fieldref_info {<font></font>
        u1 tag;<font></font>
        u2 class_index;<font></font>
        u2 name_and_type_index;<font></font>
    }<font></font>
<font></font>
    CONSTANT_Methodref_info {<font></font>
        u1 tag;<font></font>
        u2 class_index;<font></font>
        u2 name_and_type_index;<font></font>
    }</code></pre><br>
<p>  ,   ,    .</p><br>
<p>   :</p><br>
<pre><code class="plaintext hljs">    cafe babe <font></font>
    0000 0034 <font></font>
    001d -- constant_pool_count <font></font>
    0a00 0600 0f09 0010 0011 0800 12 ...</code></pre><br>
<p>,      ,       .    <code>0a</code> (10) — , ,  <code>CONSTANT_Methodref</code></p><br>
<p>  :</p><br>
<pre><code class="plaintext hljs">    CONSTANT_Methodref_info {<font></font>
        u1 tag;<font></font>
        u2 class_index;<font></font>
        u2 name_and_type_index;<font></font>
    }</code></pre><br>
<p>    ,    4   <code>class_index</code>  <code>name_and_type_index</code></p><br>
<pre><code class="plaintext hljs">    cafe babe <font></font>
    0000 0034 <font></font>
    001d -- constant_pool_count <font></font>
<font></font>
    0a 0006 000f -- CONSTANT_Methodref<font></font>
    0900 1000 1108 0012 ...</code></pre><br>
<p>,       .  . , <code>09</code> —   <code>CONSTANT_Fieldref</code> </p><br>
<p>:</p><br>
<pre><code class="plaintext hljs">    cafe babe <font></font>
    0000 0034 <font></font>
    001d -- constant_pool_count <font></font>
<font></font>
    0a 0006 000f -- CONSTANT_Methodref<font></font>
    09 0010 0011 -- CONSTANT_Fieldref<font></font>
    08 0012 ...</code></pre><br>
<p>  ,      ,    .<br>
,     , <code>CONSTANT_String</code>:</p><br>
<pre><code class="plaintext hljs">    CONSTANT_String_info {<font></font>
        u1 tag;<font></font>
        u2 string_index;<font></font>
    }</code></pre><br>
<p>      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Chapter 4.4 The Constant Pool</a></p><br>
<p> ,      <code>info</code></p><br>
<p>,     <code>*_index</code>       . , <code>class_index</code>     <code>CONSTANT_Class_info</code>,  <code>string_index</code>  <code>CONSTANT_Utf8_info</code></p><br>
<p>       :</p><br>
<pre><code class="plaintext hljs">    #1 = Methodref       #6.#15         // java/lang/Object."&lt;init&gt;":()V<font></font>
    #2 = Fieldref           #16.#17        // java/lang/System.out:Ljava/io/PrintStream;<font></font>
    #3 = String             #18</code></pre><br>
<pre><code class="plaintext hljs">    0a 0006 000f  -- CONSTANT_Methodref<font></font>
    09 0010 0011 -- CONSTANT_Fieldref<font></font>
    08 0012      -- CONSTANT_String</code></pre><br>
<p>      .</p><br>
<p>        <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">4.4.4</a>,      ,         Hello World</p><br>
<p>,    :</p><br>
<pre><code class="plaintext hljs">    CONSTANT_Utf8_info {<font></font>
        u1 tag;<font></font>
        u2 length;<font></font>
        u1 bytes[length];<font></font>
    }</code></pre><br>
<p>,  Hello World:</p><br>
<pre><code class="plaintext hljs">    01      -- tag<font></font>
    000b    -- length<font></font>
    48 65 6c 6c 6f 20 57 6f 72 6c 64    -- bytes[length] // H e l l o   W o r l d</code></pre><br>
<p>    -, :</p><br>
<div class="spoiler"><b class="spoiler_title">  </b><div class="spoiler_text"><pre><code class="plaintext hljs">    -- [Constant Pool]<font></font>
<font></font>
    -- methodref <font></font>
    0a 0006 000f<font></font>
<font></font>
    -- fieldref<font></font>
    09 0010 0011 <font></font>
<font></font>
    -- string<font></font>
    08 0012 <font></font>
<font></font>
    -- methodref<font></font>
    0a 0013 0014<font></font>
<font></font>
    -- Class<font></font>
    07 0015<font></font>
<font></font>
    -- Class<font></font>
    07 0016<font></font>
<font></font>
    -- Utf8<font></font>
    01 0006 <font></font>
    3c 69 6e 69 74 3e <font></font>
<font></font>
    -- Utf8<font></font>
    01 0003 <font></font>
    28 29 56 <font></font>
<font></font>
    -- Utf8<font></font>
    01 0004 <font></font>
    43 6f 64 65 <font></font>
<font></font>
    -- Utf8<font></font>
    01 000f <font></font>
    4c 69 6e 65 4e 75 6d<font></font>
    62 65 72 54 61 62 6c 65<font></font>
<font></font>
    -- Utf8<font></font>
    01 0004 <font></font>
    6d 61 69 6e <font></font>
<font></font>
    -- Utf8<font></font>
    01 0016 <font></font>
    28 5b 4c 6a 61 76 61 2f 6c 61 6e 67<font></font>
    2f 53 74 72 69 6e 67 3b 29 56 <font></font>
<font></font>
    -- Utf8<font></font>
    01 000a <font></font>
    53 6f 75 72 63 65 46 69 6c 65<font></font>
<font></font>
    -- Utf8<font></font>
    01 0009 <font></font>
    4d 61 69 6e 2e 6a 61 76 61 <font></font>
<font></font>
    -- NameAndType<font></font>
    0c 0007 0008 <font></font>
<font></font>
    -- Class<font></font>
    07 0017 <font></font>
<font></font>
    -- NameAndType<font></font>
    0c 0018 0019<font></font>
<font></font>
    -- Utf8<font></font>
    01 000b <font></font>
    48 65 6c 6c 6f 20 57 6f 72 6c 64 <font></font>
<font></font>
    -- Class<font></font>
    07 001a<font></font>
<font></font>
    -- NameAndType<font></font>
    0c 001b 001c <font></font>
<font></font>
    -- Utf8<font></font>
    01 0004 <font></font>
    4d 61 69 6e <font></font>
<font></font>
    -- Utf8<font></font>
    01 0010<font></font>
    6a 61 76 61 2f 6c 61 6e 67 2f 4f 62 6a 65 63 74<font></font>
<font></font>
    -- Utf8<font></font>
    01 0010 <font></font>
    6a 61 76 61 2f 6c 61 6e 67 2f 53 79 73 74 65 6d<font></font>
<font></font>
    -- Utf8<font></font>
    01 0003 <font></font>
    6f 75 74 <font></font>
<font></font>
    -- Utf8<font></font>
    01 0015 <font></font>
    4c 6a 61 76 61 2f 69 6f 2f 50 72 69 6e 74 53 74 <font></font>
    72 65 61 6d 3b<font></font>
<font></font>
    -- Utf8<font></font>
    01 0013 <font></font>
    6a 61 76 61 2f 69 6f 2f 50 72 69 6e 74 53 74 72 <font></font>
    65 61 6d <font></font>
<font></font>
    -- Utf8<font></font>
    01 0007 <font></font>
    70 72 69 6e 74 6c 6e<font></font>
<font></font>
    -- Utf8<font></font>
    01 0015 <font></font>
    28 4c 6a 61 76 61 2f 6c 61 6e 67 2f 53 74 72 69 <font></font>
    6e 67 3b 29 56 <font></font>
<font></font>
    -- [Constant Pool END]</code></pre></div></div><br>
<p>,       :</p><br>
<pre><code class="plaintext hljs">    Constant pool:<font></font>
       #1 = Methodref       #6.#15         // java/lang/Object."&lt;init&gt;":()V<font></font>
       #2 = Fieldref           #16.#17        // java/lang/System.out:Ljava/io/PrintStream;<font></font>
       #3 = String             #18            // Hello World<font></font>
       #4 = Methodref       #19.#20  // java/io/PrintStream.println:(Ljava/lang/String;)V<font></font>
       #5 = Class              #21            // Main<font></font>
       #6 = Class              #22            // java/lang/Object<font></font>
       #7 = Utf8               &lt;init&gt;<font></font>
       #8 = Utf8               ()V<font></font>
       #9 = Utf8               Code<font></font>
      #10 = Utf8               LineNumberTable<font></font>
      #11 = Utf8               main<font></font>
      #12 = Utf8               ([Ljava/lang/String;)V<font></font>
      #13 = Utf8               SourceFile<font></font>
      #14 = Utf8               Main.java<font></font>
      #15 = NameAndType        #7:#8          // "&lt;init&gt;":()V<font></font>
      #16 = Class                     #23            // java/lang/System<font></font>
      #17 = NameAndType        #24:#25        // out:Ljava/io/PrintStream;<font></font>
      #18 = Utf8               Hello World<font></font>
      #19 = Class                      #26            // java/io/PrintStream<font></font>
      #20 = NameAndType        #27:#28        // println:(Ljava/lang/String;)V<font></font>
      #21 = Utf8               Main<font></font>
      #22 = Utf8               java/lang/Object<font></font>
      #23 = Utf8               java/lang/System<font></font>
      #24 = Utf8               out<font></font>
      #25 = Utf8               Ljava/io/PrintStream;<font></font>
      #26 = Utf8               java/io/PrintStream<font></font>
      #27 = Utf8               println<font></font>
      #28 = Utf8               (Ljava/lang/String;)V</code></pre><br>
<p>  ,   ,    <code>javap</code>    -       .</p><br>
<p>    . :</p><br>
<pre><code class="plaintext hljs">      public Main();<font></font>
        descriptor: ()V<font></font>
        flags: ACC_PUBLIC<font></font>
        Code:<font></font>
          stack=1, locals=1, args_size=1<font></font>
             0: aload_0<font></font>
             1: invokespecial #1  //    1   <font></font>
             4: return</code></pre><br>
<p>          <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Chapter 4.4 The Constant Pool</a></p><br>
<p>    <em>ClassFile</em></p><br>
<p><strong>access_flags</strong></p><br>
<p>     </p><br>
<div class="scrollable-table"><table>
<thead>
<tr>
<th>Flag Name</th>
<th>Value</th>
<th>Interpretation</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ACC_PUBLIC</code></td>
<td>0x0001</td>
<td>Declared <code>public</code>; may be accessed from outside its package.</td>
</tr>
<tr>
<td><code>ACC_FINAL</code></td>
<td>0x0010</td>
<td>Declared <code>final</code>; no subclasses allowed.</td>
</tr>
<tr>
<td><code>ACC_SUPER</code></td>
<td>0x0020</td>
<td>Treat superclass methods specially when invoked by the <em>invokespecial</em> instruction.</td>
</tr>
<tr>
<td><code>ACC_INTERFACE</code></td>
<td>0x0200</td>
<td>Is an interface, not a class.</td>
</tr>
<tr>
<td><code>ACC_ABSTRACT</code></td>
<td>0x0400</td>
<td>Declared <code>abstract</code>; must not be instantiated.</td>
</tr>
<tr>
<td><code>ACC_SYNTHETIC</code></td>
<td>0x1000</td>
<td>Declared synthetic; not present in the source code.</td>
</tr>
<tr>
<td><code>ACC_ANNOTATION</code></td>
<td>0x2000</td>
<td>Declared as an annotation type.</td>
</tr>
<tr>
<td><code>ACC_ENUM</code></td>
<td>0x4000</td>
<td>Declared as an <code>enum</code> type.</td>
</tr>
</tbody>
</table></div><br>
<p><strong>this_class</strong></p><br>
<p>    <code>this</code> .   ,     5:</p><br>
<pre><code class="plaintext hljs">    Constant pool:<font></font>
       #1 = Methodref          #6.#15        // java/lang/Object."&lt;init&gt;":()V<font></font>
       #2 = Fieldref           #16.#17        // java/lang/System.out:Ljava/io/PrintStream;<font></font>
       #3 = String             #18               // Hello World<font></font>
       #4 = Methodref          #19.#20     // java/io/PrintStream.println:(Ljava/lang/String;)V<font></font>
       #5 = Class              #21               // Main<font></font>
       #6 = Class              #22               // java/lang/Object<font></font>
      ...</code></pre><br>
<p> ,       <code>CONSTANT_Class_info</code></p><br>
<p><strong>super_class</strong></p><br>
<p>  .   ,    <code>#6</code>. ,       <code>CONSTANT_Class_info</code></p><br>
<p>       <code>CONSTANT_Utf8_info</code>.     <code>#21</code>  <code>#22</code>,  :</p><br>
<pre><code class="plaintext hljs">      ...<font></font>
      #21 = Utf8               Main<font></font>
      #22 = Utf8               java/lang/Object<font></font>
      ...</code></pre><br>
<p>      <code>name_index</code>  :</p><br>
<pre><code class="plaintext hljs">    CONSTANT_Class_info {<font></font>
        u1 tag;<font></font>
        u2 name_index;<font></font>
    }</code></pre><br>
<p><strong>interfaces_count, fields_count</strong></p><br>
<p>    ,      0000,    <code>fields[]</code>, <code>interfaces[]</code>   .</p><br>
<p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">4.1 The ClassFile Structure</a></p><br>
<p><strong>methods_count</strong></p><br>
<p> .          , ,   ,  .  <code>main</code>      .     ,   .</p><br>
<p><strong>methods[]</strong></p><br>
<p>     <code>method_info</code>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Chapter 4.6 Methods</a></p><br>
<pre><code class="plaintext hljs">    method_info {<font></font>
        u2             access_flags;<font></font>
        u2             name_index;<font></font>
        u2             descriptor_index;<font></font>
        u2             attributes_count;<font></font>
        attribute_info attributes[attributes_count];<font></font>
    }</code></pre><br>
<p>  - (,  )   :</p><br>
<pre><code class="plaintext hljs">    -- [methods]<font></font>
<font></font>
    -- public Main();<font></font>
<font></font>
    0001 --access_flags<font></font>
    0007 -- name_index<font></font>
    0008 -- descriptor_index<font></font>
    0001 -- attributes_count<font></font>
<font></font>
    -- attribute_info<font></font>
    0009 -- attribute_name_index (Code)<font></font>
    0000 001d - attribute_length<font></font>
    0001 -- max_stack<font></font>
    0001 -- max_locals<font></font>
    0000 0005 -- code_length <font></font>
    2a b7 00 01 b1  -- code[]<font></font>
<font></font>
    0000 -- exception_table_length<font></font>
    0001 --  attributes_count;<font></font>
    000a -- attribute_name_index<font></font>
    0000 0006 -- attribute_length<font></font>
    00 01 00 00 00 01<font></font>
<font></font>
    -- public static void main(java.lang.String...);<font></font>
<font></font>
    0089  --access_flags<font></font>
    000b  -- name_index<font></font>
    000c  -- descriptor_index<font></font>
    0001  -- attributes_count<font></font>
<font></font>
    -- attribute_info<font></font>
    0009          -- attribute_name_index (Code)<font></font>
    0000 0025  -- attribute_length<font></font>
    0002          -- max_stack<font></font>
    0001          -- max_locals <font></font>
    0000 0009  -- code_length <font></font>
    b2 00 02 12 03 b6 00 04 b1 -- code[]<font></font>
<font></font>
    0000 -- exception_table_length<font></font>
    0001 -- attributes_count<font></font>
    000a -- attribute_name_index<font></font>
    0000 000a -- attribute_length<font></font>
    00 02 00 00 00 04 00 08 00 05 <font></font>
<font></font>
    -- [methods END]</code></pre><br>
<p> -  :</p><br>
<p><strong>access_flags</strong></p><br>
<p> . <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Table 4.5 Method access and property flags</a></p><br>
<div class="scrollable-table"><table>
<thead>
<tr>
<th>Flag Name</th>
<th>Value</th>
<th>Interpretation</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ACC_PUBLIC</code></td>
<td>0x0001</td>
<td>Declared <code>public</code>; may be accessed from outside its package.</td>
</tr>
<tr>
<td><code>ACC_PRIVATE</code></td>
<td>0x0002</td>
<td>Declared <code>private</code>; accessible only within the defining class.</td>
</tr>
<tr>
<td><code>ACC_PROTECTED</code></td>
<td>0x0004</td>
<td>Declared <code>protected</code>; may be accessed within subclasses.</td>
</tr>
<tr>
<td><code>ACC_STATIC</code></td>
<td>0x0008</td>
<td>Declared <code>static</code>.</td>
</tr>
<tr>
<td><code>ACC_FINAL</code></td>
<td>0x0010</td>
<td>Declared <code>final</code>; must not be overridden (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">§5.4.5</a>).</td>
</tr>
<tr>
<td><code>ACC_SYNCHRONIZED</code></td>
<td>0x0020</td>
<td>Declared <code>synchronized</code>; invocation is wrapped by a monitor use.</td>
</tr>
<tr>
<td><code>ACC_BRIDGE</code></td>
<td>0x0040</td>
<td>A bridge method, generated by the compiler.</td>
</tr>
<tr>
<td><code>ACC_VARARGS</code></td>
<td>0x0080</td>
<td>Declared with variable number of arguments.</td>
</tr>
<tr>
<td><code>ACC_NATIVE</code></td>
<td>0x0100</td>
<td>Declared <code>native</code>; implemented in a language other than Java.</td>
</tr>
<tr>
<td><code>ACC_ABSTRACT</code></td>
<td>0x0400</td>
<td>Declared <code>abstract</code>; no implementation is provided.</td>
</tr>
<tr>
<td><code>ACC_STRICT</code></td>
<td>0x0800</td>
<td>Declared <code>strictfp</code>; floating-point mode is FP-strict.</td>
</tr>
<tr>
<td><code>ACC_SYNTHETIC</code></td>
<td>0x1000</td>
<td>Declared synthetic; not present in the source code.</td>
</tr>
</tbody>
</table></div><br>
<p>     -,   <code>public Main();</code> ()   <code>0001</code>,   <code>ACC_PUBLIC</code>.</p><br>
<p>      <code>main</code>. ,    :</p><br>
<ul>
<li>public — ACC_PUBLIC — 0x0001</li>
<li>static — ACC_STATIC — 0x0008</li>
<li>String… args — ACC_VARARGS — 0x0080</li>
</ul><br>
<p> : 0x0001 + 0x0008 + 0x0080 = <code>0x0089</code>. ,   <code>access_flag</code></p><br>
<blockquote> , ACC_VARARGS  ,   , ,   <br>
 String[] args  String… args,      </blockquote><p><strong>name_index</strong></p><br>
<p>   (<code>CONSTANT_Utf8_info</code>)   .   ,      Main,  <code>&lt;init&gt;</code>,    #7.</p><br>
<p>  <code>&lt;init&gt;</code>  <code>&lt;clinit&gt;</code>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Chapter 2.9 Special Methods</a></p><br>
<p><strong>descriptor_index</strong></p><br>
<p> ,      .          .</p><br>
<p>,  JVM   :</p><br>
<div class="scrollable-table"><table>
<thead>
<tr>
<th><em>BaseType</em> Character</th>
<th>Type</th>
<th>Interpretation</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>B</code></td>
<td><code>byte</code></td>
<td>signed byte</td>
</tr>
<tr>
<td><code>C</code></td>
<td><code>char</code></td>
<td>Unicode character code point in the Basic Multilingual Plane, encoded with UTF-16</td>
</tr>
<tr>
<td><code>D</code></td>
<td><code>double</code></td>
<td>double-precision floating-point value</td>
</tr>
<tr>
<td><code>F</code></td>
<td><code>float</code></td>
<td>single-precision floating-point value</td>
</tr>
<tr>
<td><code>I</code></td>
<td><code>int</code></td>
<td>integer</td>
</tr>
<tr>
<td><code>J</code></td>
<td><code>long</code></td>
<td>long integer</td>
</tr>
<tr>
<td><code>L</code> <em>ClassName</em> <code>;</code></td>
<td><code>reference</code></td>
<td>an instance of class <em>ClassName</em></td>
</tr>
<tr>
<td><code>S</code></td>
<td><code>short</code></td>
<td>signed short</td>
</tr>
<tr>
<td><code>Z</code></td>
<td><code>boolean</code></td>
<td><code>true</code> or <code>false</code></td>
</tr>
<tr>
<td><code>[</code></td>
<td><code>reference</code></td>
<td>one array dimension</td>
</tr>
</tbody>
</table></div><br>
<p>     :</p><br>
<pre><code class="plaintext hljs">    ( ParameterDescriptor* ) ReturnDescriptor</code></pre><br>
<p>,  :</p><br>
<pre><code class="plaintext hljs">    Object method(int i, double d, Thread t) {..}</code></pre><br>
<p>   </p><br>
<pre><code class="plaintext hljs">    (IDLjava/lang/Thread;)Ljava/lang/Object</code></pre><br>
<p>, <code>I</code> —  <code>int</code>, <code>D</code> —  <code>double</code>,  <code>Ljava/lang/Thread;</code>  <code>Thread</code>    <code>java.lang</code>.</p><br>
<p>,  ,     .</p><br>
<p> ,   ,    <code>attributes_count</code></p><br>
<p>       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Chapter 4.7 Attributes</a></p><br>
<pre><code class="plaintext hljs">    attribute_info {<font></font>
        u2 attribute_name_index;<font></font>
        u4 attribute_length;<font></font>
        u1 info[attribute_length];<font></font>
    }</code></pre><br>
<p><strong>attribute_name_index</strong></p><br>
<p>  .   ,     <code>Code</code>.     ,         .     ,  <code>attribute_name_index</code>          <code>CONSTANT_Utf8_info</code></p><br>
<p><strong>attribute_length</strong></p><br>
<p>  ,   <code>attribute_name_index</code>  <code>attribute_length</code></p><br>
<p><strong>info</strong></p><br>
<p>,     <code>Code</code>,     <code>attribute_name_index</code>        <code>Code</code>. </p><br>
<p>: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Chapter 4.7.3 The Code Attribute</a></p><br>
<p>  :</p><br>
<pre><code class="plaintext hljs">    Code_attribute {<font></font>
        u2 attribute_name_index;<font></font>
        u4 attribute_length;<font></font>
        u2 max_stack;<font></font>
        u2 max_locals;<font></font>
        u4 code_length;<font></font>
        u1 code[code_length];<font></font>
        u2 exception_table_length;<font></font>
        {   u2 start_pc;<font></font>
            u2 end_pc;<font></font>
            u2 handler_pc;<font></font>
            u2 catch_type;<font></font>
        } exception_table[exception_table_length];<font></font>
        u2 attributes_count;<font></font>
        attribute_info attributes[attributes_count];<font></font>
    }</code></pre><br>
<p><strong>max_stack</strong></p><br>
<p> ,         -  max.   ,        . ,    ,  ,   ,       .</p><br>
<p> , JVM     .    ,  ,  ,       ,     .</p><br>
<p>     "<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://www.tune-it.ru/web/bleizard/blog/-/blogs/o-steke-i-kuce-v-kontekste-mira-java%3F_com_liferay_blogs_web_portlet_BlogsPortlet_redirect%3D">       Java</a>"   "<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">JVM Internals</a>"</p><br>
<p><strong>max_locals</strong></p><br>
<p>   </p><br>
<p>       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Mastering Java Bytecode at the Core of the JVM</a>     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">JVM Internals</a></p><br>
<p><strong>code_length</strong></p><br>
<p> ,     </p><br>
<p><strong>code[]</strong></p><br>
<p>    - .   <code>optcode</code>         — <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Java bytecode instruction listings</a>       </p><br>
<p> ,   :</p><br>
<pre><code class="plaintext hljs">    -- public Main();<font></font>
<font></font>
    0001 --access_flags<font></font>
    0007 -- name_index<font></font>
    0008 -- descriptor_index<font></font>
    0001 -- attributes_count<font></font>
<font></font>
    -- attribute_info<font></font>
    0009 -- attribute_name_index (Code)<font></font>
    0000 001d - attribute_length<font></font>
    00 01 -- max_stack<font></font>
    00 01 -- max_locals<font></font>
    00 00 00 05 -- code_length <font></font>
    2a b7 00 01 b1  -- code[]<font></font>
<font></font>
    0000 -- exception_table_length<font></font>
    0001 --  attributes_count;<font></font>
    00 0a -- attribute_name_index<font></font>
    0000 0006 -- attribute_length<font></font>
    00 01 00 00 00 01</code></pre><br>
<p>     :</p><br>
<pre><code class="plaintext hljs">    2a b7 00 01 b1</code></pre><br>
<p>     :</p><br>
<pre><code class="plaintext hljs">    2a - aload_0<font></font>
    b7 0001 - invokespecial #1<font></font>
    b1 - return</code></pre><br>
<p>      : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Chapter 4.10.1.9. Type Checking Instructions</a></p><br>
<p><strong>exception_table_length</strong></p><br>
<p>     exception_table.           .     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Chapter 4.7.3 The Code Attribute</a></p><br>
<p><strong>exception_table[]</strong></p><br>
<p>   :</p><br>
<pre><code class="plaintext hljs">    {   <font></font>
        u2 start_pc;<font></font>
        u2 end_pc;<font></font>
        u2 handler_pc;<font></font>
        u2 catch_type;<font></font>
    }</code></pre><br>
<p> ,    ,  (<code>start_pc</code>, <code>end_pc</code>) ,    <code>handler_pc</code>    <code>catch_type</code></p><br>
<p><strong>attributes_count</strong></p><br>
<p>   <code>Code</code></p><br>
<p><strong>attributes[]</strong></p><br>
<p>,     .</p><br>
<hr><br>
<h3 id="sredstva-dlya-raboty-s-bayt-kodom">    -</h3><br>
<p>    ,     ,       .</p><br>
<p>    -,   ,  .      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Byte Code Engineering Library</a> (BCEL)  Apache Commons.</p><br>
<p> ,         -:</p><br>
<pre><code class="java hljs">        <span class="hljs-comment">// read file from resources/complied/ClassA.class</span><font></font>
        InputStream inputStream = ClassParserExample.class.getResourceAsStream("/compiled/ClassA.class");<font></font>
        <span class="hljs-keyword">if</span> (inputStream == <span class="hljs-keyword">null</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> FileNotFoundException();<font></font>
<font></font>
        ClassParser parser = <span class="hljs-keyword">new</span> ClassParser(inputStream, <span class="hljs-string">"ClassA.class"</span>);<font></font>
<font></font>
        JavaClass clazz = parser.parse();<font></font>
<font></font>
        <span class="hljs-keyword">final</span> String HEX_BYTECODE = getHex(clazz.getBytes());<font></font>
<font></font>
        System.out.println(<span class="hljs-string">"Hex bytecode: "</span>);<font></font>
        System.out.println(HEX_BYTECODE);<font></font>
        System.out.println();<font></font>
<font></font>
        <span class="hljs-keyword">final</span> String MINOR_VER      =   getHex(clazz.getMinor());
        <span class="hljs-keyword">final</span> String MAJOR_VER      =   getHex(clazz.getMajor());
        <span class="hljs-keyword">final</span> String CONSTANT_POOL  =   getHex(clazz.getConstantPool().getConstantPool());
        <span class="hljs-keyword">final</span> String ACCESS_FLAGS   =   getHex(clazz.getAccessFlags());
        <span class="hljs-keyword">final</span> String THIS_CLASS     =   getHex(clazz.getClassName().getBytes());
        <span class="hljs-keyword">final</span> String SUPER_CLASS    =   getHex(clazz.getSuperClass().getBytes());
        <span class="hljs-keyword">final</span> String INTERFACES     =   getHex(clazz.getInterfaces());
        <span class="hljs-keyword">final</span> String FIELDS         =   getHex(clazz.getFields());
        <span class="hljs-keyword">final</span> String METHODS        =   getHex(clazz.getMethods());
        <span class="hljs-keyword">final</span> String ATTRIBUTES     =   getHex(clazz.getAttributes());</code></pre><br>
<div class="spoiler"><b class="spoiler_title">  </b><div class="spoiler_text"><pre><code class="plaintext hljs">import org.apache.bcel.classfile.*;<font></font>
import org.apache.commons.codec.binary.Hex;<font></font>
<font></font>
import java.io.*;<font></font>
<font></font>
public class ClassParserExample {<font></font>
<font></font>
    public static void main(String... args) throws IOException, ClassNotFoundException {<font></font>
<font></font>
        // read file from resources/complied/ClassA.class<font></font>
        InputStream inputStream = ClassParserExample.class.getResourceAsStream("/compiled/ClassA.class");<font></font>
        if (inputStream == null) throw new FileNotFoundException();<font></font>
<font></font>
        ClassParser parser = new ClassParser(inputStream, "ClassA.class");<font></font>
<font></font>
        JavaClass clazz = parser.parse();<font></font>
<font></font>
        final String HEX_BYTECODE = getHex(clazz.getBytes());<font></font>
<font></font>
        System.out.println("Hex bytecode: ");<font></font>
        System.out.println(HEX_BYTECODE);<font></font>
        System.out.println();<font></font>
<font></font>
        final String MINOR_VER      =   getHex(clazz.getMinor());<font></font>
        final String MAJOR_VER      =   getHex(clazz.getMajor());<font></font>
        final String CONSTANT_POOL  =   getHex(clazz.getConstantPool().getConstantPool());<font></font>
        final String ACCESS_FLAGS   =   getHex(clazz.getAccessFlags());<font></font>
        final String THIS_CLASS     =   getHex(clazz.getClassName().getBytes());<font></font>
        final String SUPER_CLASS    =   getHex(clazz.getSuperClass().getBytes());<font></font>
        final String INTERFACES     =   getHex(clazz.getInterfaces());<font></font>
        final String FIELDS         =   getHex(clazz.getFields());<font></font>
        final String METHODS        =   getHex(clazz.getMethods());<font></font>
        final String ATTRIBUTES     =   getHex(clazz.getAttributes());<font></font>
<font></font>
        System.out.println( "minor: "           + MINOR_VER    );   // 0<font></font>
        System.out.println( "major: "           + MAJOR_VER    );   // 34<font></font>
        System.out.println( "constant pool: "   + CONSTANT_POOL);   // not correctly<font></font>
        System.out.println( "access flags: "    + ACCESS_FLAGS );   // 21<font></font>
        System.out.println( "this class: "      + THIS_CLASS   );<font></font>
        System.out.println( "super class: "     + SUPER_CLASS  );   // Object<font></font>
        System.out.println( "interfaces: "      + INTERFACES   );   // &lt;empty&gt;<font></font>
        System.out.println( "fields: "          + FIELDS       );   // &lt;empty&gt;<font></font>
        System.out.println( "methods: "         + METHODS      );   // one method: psvm hello world<font></font>
        System.out.println( "attributes: "      + ATTRIBUTES   );   // 536f7572636546696c65 - I think it's instructions for Java tools<font></font>
<font></font>
    }<font></font>
<font></font>
    private static String getHex(byte[] bytes){<font></font>
        return Hex.encodeHexString(bytes);<font></font>
    }<font></font>
<font></font>
    private static String getHex(int intNum){<font></font>
        return Integer.toHexString(intNum);<font></font>
    }<font></font>
<font></font>
    private static String getHex(Constant[] constants){<font></font>
        if (constants == null) return null;<font></font>
<font></font>
        StringBuilder sb = new StringBuilder();<font></font>
        for (Constant c : constants){<font></font>
            if (c == null) continue;<font></font>
            sb.append(getHex(c.getTag())).append(" ");<font></font>
        }<font></font>
<font></font>
        return sb.toString();<font></font>
    }<font></font>
<font></font>
    private static String getHex(JavaClass[] clazzes){<font></font>
        if (clazzes == null) return null;<font></font>
<font></font>
        StringBuilder sb = new StringBuilder();<font></font>
        for (JavaClass c : clazzes){<font></font>
            sb.append(getHex(c.getClassName().getBytes())).append(" ");<font></font>
        }<font></font>
<font></font>
        return sb.toString();<font></font>
    }<font></font>
<font></font>
    private static String getHex(Field[] fields){<font></font>
        if (fields == null) return null;<font></font>
<font></font>
        StringBuilder sb = new StringBuilder();<font></font>
        for (Field c : fields){<font></font>
            sb.append(getHex(c.getName().getBytes())).append(" ");<font></font>
        }<font></font>
<font></font>
        return sb.toString();<font></font>
    }<font></font>
<font></font>
    private static String getHex(Method[] methods){<font></font>
        if (methods == null) return null;<font></font>
<font></font>
        StringBuilder sb = new StringBuilder();<font></font>
        for (Method c : methods){<font></font>
            sb.append(getHex(c.getName().getBytes())).append(" ");<font></font>
        }<font></font>
<font></font>
        return sb.toString();<font></font>
    }<font></font>
<font></font>
    private static String getHex(Attribute[] attributes){<font></font>
        if (attributes == null) return null;<font></font>
<font></font>
        StringBuilder sb = new StringBuilder();<font></font>
        for (Attribute c : attributes){<font></font>
            sb.append(getHex(c.getName().getBytes())).append(" ");<font></font>
        }<font></font>
<font></font>
        return sb.toString();<font></font>
    }<font></font>
<font></font>
}<font></font>
<font></font>
/*<font></font>
    Class A:<font></font>
    public class ClassA {<font></font>
        public static void main(String[] args) {<font></font>
            System.out.println("Hello world");<font></font>
        }<font></font>
    }<font></font>
 */<font></font>
<font></font>
/*<font></font>
    Class A bytecode:<font></font>
    cafe babe 0000 0034 0022 0a00 0600 1409<font></font>
    0015 0016 0800 170a 0018 0019 0700 1a07<font></font>
    001b 0100 063c 696e 6974 3e01 0003 2829<font></font>
    5601 0004 436f 6465 0100 0f4c 696e 654e<font></font>
    756d 6265 7254 6162 6c65 0100 124c 6f63<font></font>
    616c 5661 7269 6162 6c65 5461 626c 6501<font></font>
    0004 7468 6973 0100 1d4c 636f 6d2f 6170<font></font>
    706c 6f69 6478 7878 2f70 6172 7365 2f43<font></font>
    6c61 7373 413b 0100 046d 6169 6e01 0016<font></font>
    285b 4c6a 6176 612f 6c61 6e67 2f53 7472<font></font>
    696e 673b 2956 0100 0461 7267 7301 0013<font></font>
    5b4c 6a61 7661 2f6c 616e 672f 5374 7269<font></font>
    6e67 3b01 000a 536f 7572 6365 4669 6c65<font></font>
    0100 0b43 6c61 7373 412e 6a61 7661 0c00<font></font>
    0700 0807 001c 0c00 1d00 1e01 000b 4865<font></font>
    6c6c 6f20 776f 726c 6407 001f 0c00 2000<font></font>
    2101 001b 636f 6d2f 6170 706c 6f69 6478<font></font>
    7878 2f70 6172 7365 2f43 6c61 7373 4101<font></font>
    0010 6a61 7661 2f6c 616e 672f 4f62 6a65<font></font>
    6374 0100 106a 6176 612f 6c61 6e67 2f53<font></font>
    7973 7465 6d01 0003 6f75 7401 0015 4c6a<font></font>
    6176 612f 696f 2f50 7269 6e74 5374 7265<font></font>
    616d 3b01 0013 6a61 7661 2f69 6f2f 5072<font></font>
    696e 7453 7472 6561 6d01 0007 7072 696e<font></font>
    746c 6e01 0015 284c 6a61 7661 2f6c 616e<font></font>
    672f 5374 7269 6e67 3b29 5600 2100 0500<font></font>
    0600 0000 0000 0200 0100 0700 0800 0100<font></font>
    0900 0000 2f00 0100 0100 0000 052a b700<font></font>
    01b1 0000 0002 000a 0000 0006 0001 0000<font></font>
    0006 000b 0000 000c 0001 0000 0005 000c<font></font>
    000d 0000 0009 000e 000f 0001 0009 0000<font></font>
    0037 0002 0001 0000 0009 b200 0212 03b6<font></font>
    0004 b100 0000 0200 0a00 0000 0a00 0200<font></font>
    0000 0800 0800 0900 0b00 0000 0c00 0100<font></font>
    0000 0900 1000 1100 0000 0100 1200 0000<font></font>
    0200 13<font></font>
 */<font></font>
<font></font>
/*<font></font>
    Assembled code:<font></font>
    Classfile /C:/java/BCEL/src/main/resources/compiled/ClassA.class<font></font>
      Last modified 08.12.2019; size 563 bytes<font></font>
      MD5 checksum bcd0198f6764a1dc2f3967fef701452e<font></font>
      Compiled from "ClassA.java"<font></font>
    public class com.apploidxxx.parse.ClassA<font></font>
      minor version: 0<font></font>
      major version: 52<font></font>
      flags: ACC_PUBLIC, ACC_SUPER<font></font>
    Constant pool:<font></font>
       #1 = Methodref          #6.#20         // java/lang/Object."&lt;init&gt;":()V<font></font>
       #2 = Fieldref           #21.#22        // java/lang/System.out:Ljava/io/PrintStream;<font></font>
       #3 = String             #23            // Hello world<font></font>
       #4 = Methodref          #24.#25        // java/io/PrintStream.println:(Ljava/lang/String;)V<font></font>
       #5 = Class              #26            // com/apploidxxx/parse/ClassA<font></font>
       #6 = Class              #27            // java/lang/Object<font></font>
       #7 = Utf8               &lt;init&gt;<font></font>
       #8 = Utf8               ()V<font></font>
       #9 = Utf8               Code<font></font>
      #10 = Utf8               LineNumberTable<font></font>
      #11 = Utf8               LocalVariableTable<font></font>
      #12 = Utf8               this<font></font>
      #13 = Utf8               Lcom/apploidxxx/parse/ClassA;<font></font>
      #14 = Utf8               main<font></font>
      #15 = Utf8               ([Ljava/lang/String;)V<font></font>
      #16 = Utf8               args<font></font>
      #17 = Utf8               [Ljava/lang/String;<font></font>
      #18 = Utf8               SourceFile<font></font>
      #19 = Utf8               ClassA.java<font></font>
      #20 = NameAndType        #7:#8          // "&lt;init&gt;":()V<font></font>
      #21 = Class              #28            // java/lang/System<font></font>
      #22 = NameAndType        #29:#30        // out:Ljava/io/PrintStream;<font></font>
      #23 = Utf8               Hello world<font></font>
      #24 = Class              #31            // java/io/PrintStream<font></font>
      #25 = NameAndType        #32:#33        // println:(Ljava/lang/String;)V<font></font>
      #26 = Utf8               com/apploidxxx/parse/ClassA<font></font>
      #27 = Utf8               java/lang/Object<font></font>
      #28 = Utf8               java/lang/System<font></font>
      #29 = Utf8               out<font></font>
      #30 = Utf8               Ljava/io/PrintStream;<font></font>
      #31 = Utf8               java/io/PrintStream<font></font>
      #32 = Utf8               println<font></font>
      #33 = Utf8               (Ljava/lang/String;)V<font></font>
    {<font></font>
      public com.apploidxxx.parse.ClassA();<font></font>
        descriptor: ()V<font></font>
        flags: ACC_PUBLIC<font></font>
        Code:<font></font>
          stack=1, locals=1, args_size=1<font></font>
             0: aload_0<font></font>
             1: invokespecial #1                  // Method java/lang/Object."&lt;init&gt;":()V<font></font>
             4: return<font></font>
          LineNumberTable:<font></font>
            line 6: 0<font></font>
          LocalVariableTable:<font></font>
            Start  Length  Slot  Name   Signature<font></font>
                0       5     0  this   Lcom/apploidxxx/parse/ClassA;<font></font>
      public static void main(java.lang.String[]);<font></font>
        descriptor: ([Ljava/lang/String;)V<font></font>
        flags: ACC_PUBLIC, ACC_STATIC<font></font>
        Code:<font></font>
          stack=2, locals=1, args_size=1<font></font>
             0: getstatic     #2                  // Field java/lang/System.out:Ljava/io/PrintStream;<font></font>
             3: ldc           #3                  // String Hello world<font></font>
             5: invokevirtual #4                  // Method java/io/PrintStream.println:(Ljava/lang/String;)V<font></font>
             8: return<font></font>
          LineNumberTable:<font></font>
            line 8: 0<font></font>
            line 9: 8<font></font>
          LocalVariableTable:<font></font>
            Start  Length  Slot  Name   Signature<font></font>
                0       9     0  args   [Ljava/lang/String;<font></font>
    }<font></font>
    SourceFile: "ClassA.java<font></font>
 */</code></pre></div></div><br>
<p>    ,    (,  Jasmin) -.</p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">いくつかの例が</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私のリポジトリ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">または</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">公式の例にあります。</font></font></a></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">また、</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ジャスミンにも</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注目しました</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">実際、どのように役立つのかはわかりませんが、バイトコードを使用してJVMの動作メカニズムを研究するときに使用しました。</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">これを使用すると、単純化されたアセンブラコードで記述できます。</font></font></p><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">こんにちは世界</font></font></b><div class="spoiler_text"><pre><code class="plaintext hljs">.bytecode 52.0<font></font>
<font></font>
.source Main.j<font></font>
.class public Main<font></font>
.super java/lang/Object<font></font>
<font></font>
.method public static main([Ljava/lang/String;)V<font></font>
        .limit stack 2<font></font>
        .limit locals 2<font></font>
<font></font>
    getstatic java/lang/System/out Ljava/io/PrintStream;<font></font>
    ldc "Hello world!"<font></font>
    invokevirtual java/io/PrintStream.println(Ljava/lang/String;)V<font></font>
    return<font></font>
.end method</code></pre></div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">オブジェクトの作成</font></font></b><div class="spoiler_text"><pre><code class="plaintext hljs">; ClassCreating.j<font></font>
<font></font>
.bytecode 52.0<font></font>
.source ClassCreating.java<font></font>
.class public ClassCreating<font></font>
.super java/lang/Object<font></font>
<font></font>
.method public &lt;init&gt;()V<font></font>
    .limit stack 1<font></font>
    .limit locals 1<font></font>
    .line 1<font></font>
    0: aload_0<font></font>
    1: invokespecial java/lang/Object/&lt;init&gt;()V<font></font>
    4: return<font></font>
.end method<font></font>
<font></font>
.method public static main([Ljava/lang/String;)V<font></font>
    ; Flag ACC_VARARGS set, see JVM spec<font></font>
    .limit stack 2<font></font>
    .limit locals 3<font></font>
    .line 3<font></font>
    0: new java/lang/String<font></font>
    3: dup<font></font>
    4: invokespecial java/lang/String/&lt;init&gt;()V<font></font>
    7: astore_1<font></font>
    .line 4<font></font>
    8: new ClassCreating<font></font>
    11: dup<font></font>
    12: invokespecial ClassCreating/&lt;init&gt;()V<font></font>
    15: astore_2<font></font>
    .line 5<font></font>
    16: aload_2<font></font>
    17: invokevirtual ClassCreating/sayHello()V<font></font>
    .line 6<font></font>
    20: return<font></font>
.end method<font></font>
<font></font>
.method public sayHello()V<font></font>
    .limit stack 2<font></font>
    .limit locals 1<font></font>
    .line 9<font></font>
    0: getstatic java/lang/System/out Ljava/io/PrintStream;<font></font>
    3: ldc "Hello, User!"<font></font>
    5: invokevirtual java/io/PrintStream/println(Ljava/lang/String;)V<font></font>
    .line 10<font></font>
    8: return<font></font>
<font></font>
.end method</code></pre></div></div><br>
<hr><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">そこで、簡単なHello Worldプログラムを整理しました。</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コメント付きのバイトコードのリストは私のヒストグラムにあります：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gist.github</font></font></a></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">エラーがある場合は、コメントまたは投稿にご記入ください。</font></font></p><br>
<p><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参考文献</font></font></strong></p><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Java仮想マシン仕様</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-docs.oracle</font></font></a></li>
</ul></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja480534/index.html">KotlinでのAndroid向けの16の開発のヒント。パート2</a></li>
<li><a href="../ja480538/index.html">ゲームに最適なのはIntel OptaneとSSDのどちらですか？</a></li>
<li><a href="../ja480540/index.html">Umbraco 8.4リリース：CMSがさらに便利に</a></li>
<li><a href="../ja480542/index.html">大人のセキュリティ意識：フィッシングの脆弱性を解決する方法</a></li>
<li><a href="../ja480544/index.html">Javaの5つの隠された秘密</a></li>
<li><a href="../ja480552/index.html">FirefoxはWebの未来のために戦います</a></li>
<li><a href="../ja480554/index.html">到来しなかったサンのクラウドコンピューティングの未来</a></li>
<li><a href="../ja480556/index.html">NGINX：ロシアのITコミュニティの検証</a></li>
<li><a href="../ja480558/index.html">損益分岐レベルのマイニングでビットコインのピボットポイントを決定する方法</a></li>
<li><a href="../ja480560/index.html">運用部門の機能のICDロボット部分</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>