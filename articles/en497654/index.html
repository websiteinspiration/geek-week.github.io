<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üíä üôçüèº ü§≥üèæ Underwater Ultrasonic Rangefinder Module. Part three ‚óÄÔ∏è üëÑ ‚è™</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Without buildup. 
 
 The most significant changes in the project, compared to previous versions of the sonar ( one and two ), are the simplification o...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Underwater Ultrasonic Rangefinder Module. Part three</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/497654/"><img src="https://habrastorage.org/webt/pn/ym/vz/pnymvzjz28w2cdbkzm8pik8gley.jpeg" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Without buildup. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The most significant changes in the project, compared to previous versions of the sonar ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">one</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">two</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), are the simplification of the analog part and the evolution of the assembly process of modules towards greater manufacturability. </font><font style="vertical-align: inherit;">Various combinations of adhesives and compounds have been tested to seal the board and emitter inside the case. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Well and the fact that now it is a commercial product, brought to the production stage.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Production</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Notably tormented with a very inconvenient Temporary Gain Control, which did not solve the problem of a narrow dynamic range, it was decided to use an integrated logarithmic amplifier. God (if you exist), thank you and the guys at Analog Devices for this miracle! A third of all sonar functionality, without exaggeration, is he. Feedback? Clipping? Self-excitation? No, have not heard. Our answer is AD8310!</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The previous option is also working, but with minuses. </font><font style="vertical-align: inherit;">Firstly, two cascades of active very narrow-band filters are difficult to configure. </font><font style="vertical-align: inherit;">Secondly, the gain control circuit - it needs to be controlled. </font><font style="vertical-align: inherit;">Thirdly, the cascade of amplitude detection is non-linear closer to the boundaries of its dynamic range. </font><font style="vertical-align: inherit;">For the last two points, the characteristics, in part, depend on the temperature and the spread of the parameters of the key components. </font><font style="vertical-align: inherit;">So we came to the logarithmic amplifier. </font><font style="vertical-align: inherit;">The new analog path has a significant advantage - it is a measuring device with a logarithmic scale. </font><font style="vertical-align: inherit;">This allows you to capture the entire available dynamic range (95 dB) with a conventional 12-bit ADC with high fidelity, and gain control can be done in post-processing on the software side.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As for changes in manufacturing technology. </font><font style="vertical-align: inherit;">The main thing is to solve the problems of adhesion.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The issue of adhesion of materials to each other is very important, since it is this property that mainly provides protection against leaks. The module‚Äôs interior is filled with a compound and the weakest point is the junction of the cable sheath with the casting compound, which has the main responsibility for withstanding pressure and sealing the circuit. This compound must have high strength and good adhesion to the components. The fact is that there is air inside the cable, which is compressed under pressure, causing the outer shell to break away from the surrounding compound. There are several solutions to this problem. The main action in our case was the use of a cable in the polyurethane sheath Helukabel DataPUR-C. It has the best adhesion to the selected compound from the many cables we tested. That part of the cablewhich goes into the case and is filled with a compound, in addition</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">plasma treated</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> for even greater grip on the compound. </font><font style="vertical-align: inherit;">
Cutaway </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
module: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/jd/bi/f3/jdbif3asj7kf_kw5gs3oazse38c.jpeg" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Some of the buttherts brought the story of </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RoHS</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">In short, RoHS is the EU rules governing the content of hazardous substances in products (Lead, mercury, cadmium and other byak). </font><font style="vertical-align: inherit;">And since we were originally focused on exporting, priority in the selection of components was given to those that had RoHS certificates / declarations of conformity. </font><font style="vertical-align: inherit;">Therefore, by the way, Russian components were not considered. </font><font style="vertical-align: inherit;">The only exception was lead piezoceramics, used as an electro-acoustic transducer in sonar. </font><font style="vertical-align: inherit;">These materials are exempted from RoHS regulation, like any ceramics with bound lead (2011/65 / EN Exemption 7 ¬© -I).</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Since export was mentioned ...</font></font></b>
                        <div class="spoiler_text">      ,         <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"> </a>   .<br>
<br>
  ,          .    ,       ,     . ,  .   .  ,    .     ,   ,      .   ‚Äì , ,  . <br>
<br>
  ,        (  12¬∞  0,5¬∞),           .    , ,      ( . )    ,       ,   ,              . <br>
     10  ,      -   .<br>
<br>
 ,  ,      ,       .<br>
<br>
      ,          . </div>
                    </div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The sonar case is made of stainless steel, which also acts as a screen for the internal circuit. It should not have direct galvanic contact with circuit elements, therefore it is connected to the ground via a ceramic capacitor welded to the body using spot welding. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
All shipped modules are pressure tested. Despite the declared working depth of 100 meters, the test pressure is 35 Atmospheres (equivalent to almost 350 meters). As they say, it is better to overdo it ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The installation of pressure testing to the limit is simple. The source of pressure is a pressure testing system for heating systems with a manometer. The pressure chamber is a segment of a high-quality polypropylene pipe, on the one side of which there is a fitting connecting the pressure testing hose, and on the other there is a cover with a hole and a seal for the cable of the tested module.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
One of the key parameters is the radiation pattern. The following construction was used as a measuring bench: The </font></font><br>
<br>
<img src="https://habrastorage.org/webt/q1/wm/e7/q1wme76cqflb-jjzyer7wf57zhy.jpeg" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
sonar is fixed in the aquarium permanently. The mobile receiving antenna is located at the same level with the sonar emitter and has the ability to rotate within 180 ¬∞ in the plane perpendicular to the emitter plane. Thus, we are able to measure the amplitude of the received acoustic signal depending on the direction of the receiver relative to the sonar emitter. One of the sonar pins was tuned to the output of the clock for the oscilloscope, so that you could clearly distinguish the direct sonar signal from the reflected ones. The measurements showed an angle of 12 ¬∞ to half the maximum amplitude of the received acoustic signal. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Graph based on the data received:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/82/g5/am/82g5am8jpeb7s_v5hoyt7-sk_aw.png" alt="image"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Use experience</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It is naive to believe that by sending samples of sonars to testers for free, we can get high-quality feedback, we lost time and did not get significant test results. </font><font style="vertical-align: inherit;">There is a feeling that testers would have more motivation to deal with the device, if they paid at least 50% of the cost. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Still, quality feedback is when you yourself become a user of your product. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Here we smoothly move on to one of the possible uses of our sonar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We are still far from underwater robots, but we assembled the autopilot boat for bathymetry on our own. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PixHawk (software - ArduPilot) was chosen as the autopilot controller.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The boat moves along a preformed route. Sonar data on the distance to the bottom are recorded autopilot on a memory card along with data from the GPS receiver. Combining these data, it is possible to make a map of the bottom of the reservoir. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In general terms, the connection diagram is as follows: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/aw/1p/uu/aw1puub4ip0cjkalllxgnhf3t7s.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And this is the Gretta-2 scientific research vessel with the equipment installed: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ty/5b/c9/ty5bc9fou9jxgwjy48bca9fixpk.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A strong wind blew on the test day, and our pelvis was decently sausage, as a result of which the sonar periodically gasped, which affected the readings. The image below shows these abnormal peaks in the measured depth plot. So, if you want to repeat this design, you should pay some attention to this nuance.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/3x/z-/av/3xz-avhia73cpwccba79zoddpua.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tests on a better day made it possible to obtain more accurate data, thanks to which a map of the bottom of a small part of the local reservoir was built: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/mv/pj/ii/mvpjiio_nkbjm3yz6ei1h4rou10.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
By the way, the module implements two types of protocol: binary, and text NMEA. The latter is supported by the ArduPilot platform, so there are no problems with the connection of the sonar and the autopilot controller. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Information on how to pre-configure our sonar to work in conjunction with ArduPilot can be found </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">here.</font></font></b></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
To conduct experiments with a sonar, it is not necessary to have sophisticated external equipment, or possess advanced programming skills. It‚Äôs enough to have an Android smartphone preloaded with </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">our GUI</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, any USB-&gt; UART converter and OTG cable. You can change such parameters as the frequency of radiation, the number of pulses in the packet, the period of generation of the probe pulses, and much more. The result of changing these parameters is immediately visible on the screen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If the smartphone has a GPS module, then you can record sonar data and data from the GPS of the smartphone itself. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Changing the emitter from the disk to an oblong parallelepiped, you can get a kind of HBO - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">side</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">scan sonar</font></a><font style="vertical-align: inherit;"> from a narrow-beam sonar </font><font style="vertical-align: inherit;">. At the minimum, of course. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Although its small power and ultra-compact dimensions will not allow it to shine for tens of meters, it‚Äôs enough to get acquainted with the principles of operation of HBO, play with the settings and instantly see the result of changing these settings.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
HBO on the minimum: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/rd/ky/2h/rdky2h1puyul6gcjkckyzk5ggj0.jpeg" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I would also like to dwell on the GUI. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Along with the fact that he knows how to change the parameters of the sonar, write logs with coordinates, send data to a remote server (a feature in development), this is also an </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">open source project</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> written in Java in Android Studio. </font><font style="vertical-align: inherit;">For those who are engaged in mobile development and communication of the application with external devices, perhaps the solutions that are implemented in our application will be useful. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I would also add that the sonar, in addition to the UART interface, has several additional discrete inputs / outputs that can be used, for example, to synchronize an array of sonars and build a similarity of a locator with a synthetic aperture. </font><font style="vertical-align: inherit;">But this is a completely different story ...</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS I almost forgot ...</font></font></b>
                        <div class="spoiler_text">     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">MEMS IMU</a>.<br>
      ,     ,    .          ,     $2k.   ,       ( )     .<br>
<br>
        ,      ,  ,     (     ):<br>
<br>
<img src="https://habrastorage.org/webt/nz/rg/pc/nzrgpcnfvwsslhj5o2gtsmr8glk.png" alt="image"><br>
</div>
                    </div></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en497638/index.html">Making a modem: transmit digital data over the air using OFDM and GNU Radio</a></li>
<li><a href="../en497642/index.html">Testing the GCC 10 Compiler with PVS-Studio</a></li>
<li><a href="../en497644/index.html">MANU game engine alpha released</a></li>
<li><a href="../en497650/index.html">TextRadar fuzzy search algorithm. Artifacts (Part 2)</a></li>
<li><a href="../en497652/index.html">Material Design Library Slider Component</a></li>
<li><a href="../en497656/index.html">The baby son came to his father and asked the baby: what is DDD? But so that I understand</a></li>
<li><a href="../en497658/index.html">Analysis of encrypted traffic without decryption</a></li>
<li><a href="../en497660/index.html">SpaceX Collects Starship Prototypes at Space Speed</a></li>
<li><a href="../en497662/index.html">About turning interest in the stock exchange into a home project</a></li>
<li><a href="../en497666/index.html">Was there a life before the Audio CD or how else they wrote digital sound MORE</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>