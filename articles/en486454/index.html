<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèº‚Äçüåæ üëéüèø üè¥Û†ÅßÛ†Å¢Û†Å≥Û†Å£Û†Å¥Û†Åø Introducing the Web Animations API üö£ ‚è™ üò°</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day, friends! 
 
 Web APIs are constantly evolving. Some of them, such as Console or Canvas, are well supported by all browsers, others are still...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Introducing the Web Animations API</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/486454/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Good day, friends! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Web APIs are constantly evolving. Some of them, such as Console or Canvas, are well supported by all browsers, others are still under development. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
One of the APIs under development is the Web Animations API or WAAPI. Despite the fact that the first version of the specification was published in 2012, and the API itself was first implemented in the Firefox and Chrome browsers in 2014, I found out about it recently (I have not heard about it before either - approx. Per.). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It allows developers to work with CSS animations using JavaScript. Its syntax is similar to the syntax of traditional CSS animations, but it has some features that make it easier for developers to create and modify animations. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Let's look at this API with a simple example.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Below we see a rotating square, the color of which changes with each turn. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/re/7d/xb/re7dxbnzzzjk9uu_4bktqx7bdzy.gif"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CSS might look like this:</font></font><br>
<br>
<pre><code class="css hljs"><span class="hljs-selector-id">#cube</span> {
    <span class="hljs-attribute">width</span>: <span class="hljs-number">40px</span>;
    <span class="hljs-attribute">height</span>: <span class="hljs-number">40px</span>;
    <span class="hljs-attribute">margin</span>: <span class="hljs-number">50%</span>;
    <span class="hljs-attribute">background-color</span>: pink;
    <span class="hljs-attribute">animation</span>: rotateCube <span class="hljs-number">1s</span> infinite;<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">@keyframes</span> rotateCube {<font></font>
    0% {<font></font>
        <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">rotate</span>(<span class="hljs-number">0deg</span>);<font></font>
    }<font></font>
<font></font>
    30% {<font></font>
        <span class="hljs-attribute">background-color</span>: purple;<font></font>
    }<font></font>
<font></font>
    100% {<font></font>
        <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">rotate</span>(<span class="hljs-number">180deg</span>);<font></font>
    }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now do the same with WAAPI.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Create animation</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It all starts with the creation of a Keyframes object containing information similar to that contained in the @keyframes directive of our CSS:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">let</span> cubeRotating = [<font></font>
    {<span class="hljs-attr">transform</span>: <span class="hljs-string">'rotate(0deg)'</span>, <span class="hljs-attr">backgroundColor</span>: <span class="hljs-string">'pink'</span>},<font></font>
    {<span class="hljs-attr">backgroundColor</span>: <span class="hljs-string">'purple'</span>, <span class="hljs-attr">offset</span>: <span class="hljs-number">0.3</span>},<font></font>
    {<span class="hljs-attr">transform</span>: <span class="hljs-string">'rotate(180deg)'</span>, <span class="hljs-attr">backgroundColor</span>: <span class="hljs-string">'pink'</span>}<font></font>
]<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We see two main differences:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We need to add backgroundColor to other steps.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We do not need to determine the time to complete each step as a percentage.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WAAPI automatically divides the animation into equal parts by the number of keys, so in our case the background color will change by about half of the animation. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
However, we want this to happen by 30%, so we add the offset property with a value of 0.3 in the second step. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There is one important thing to remember: a Keyframes object must have at least two keys. </font><font style="vertical-align: inherit;">Otherwise, a NotSupportedError will be thrown. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Next, an object is created containing animation properties that are responsible for the duration and number of repetitions:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">let</span> cubeTiming = {
    <span class="hljs-attr">duration</span>: <span class="hljs-number">1000</span>,
    <span class="hljs-attr">iterations</span>: <span class="hljs-literal">Infinity</span><font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The duration of the animation is set in milliseconds. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Instead of ‚Äúinfinite‚Äù we use the keyword ‚ÄúInfinity‚Äù. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Finally, to run the animation, we use the Element.animate method:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'cube'</span>).animate(<font></font>
    cubeRotating,<font></font>
    cubeTiming<font></font>
)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There are several more syntax options. </font><font style="vertical-align: inherit;">Examples can be found </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But that's not all. </font><font style="vertical-align: inherit;">The fact is that with WAAPI we can control the playback of animations!</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Animation Playback Control</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Calling the animate method starts the animation immediately, but this is not always what we want. </font><font style="vertical-align: inherit;">Therefore, we can call the pause and play methods to stop and start the animation, respectively:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">let</span> cubeAnimation = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'cube'</span>).animate(<font></font>
    cubeRotating,<font></font>
    cubeTiming<font></font>
)<font></font>
<font></font>
cubeAnimation.pause()<font></font>
<font></font>
<span class="hljs-built_in">document</span>.body.onclick = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> cubeAnimation.play()
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In our example, we work with one animation, but you can add several ‚Äúanimations‚Äù to the page and manage them as you like. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Among the available WAAPI methods, there are also finish, cancel, and reverse methods. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We can also control the playback speed of the animation:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">let</span> cubeAnimation = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'cube'</span>).animate(<font></font>
    cubeRotating,<font></font>
    cubeTiming<font></font>
)<font></font>
<font></font>
<span class="hljs-built_in">document</span>.body.onclick = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> cubeAnimation.playbackRate *= <span class="hljs-number">1.5</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This code makes the square rotate faster when clicked. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/bc/eu/wu/bceuwuajytywsieq0ecqduibo6s.gif"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So far, we have been learning how to create one animation and control its playback. </font><font style="vertical-align: inherit;">Another WAAPI feature is access to all animations at once.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Manage multiple animations</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WAAPI has a getAnimations method that allows you to access all created animations. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Suppose we want to slow down all the animations that are on the page if the user has enabled prefers-reduced-motion (the CSS media function prefers-reduced-motion can be used to determine if the user has requested that the OS minimize the amount of animation or movement that it uses - approx.per.):</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> mediaQuery = <span class="hljs-built_in">window</span>.matchMedia(<span class="hljs-string">'(prefers-reduced-motion: reduce)'</span>)<font></font>
<font></font>
<span class="hljs-keyword">if</span>(mediaQuery.matches){
    <span class="hljs-built_in">document</span>.getAnimations().forEach(<span class="hljs-function"><span class="hljs-params">animation</span> =&gt;</span> {<font></font>
        animation.playbackRate *= <span class="hljs-number">0.5</span><font></font>
    })<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the example above, we are looking for the media function prefers-reduced-motion and, if its value is reduce, we get all the animations on the page and reduce their playback speed by half. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This is one of those things that make WAAPI very useful. </font><font style="vertical-align: inherit;">We can make changes to several animations by changing one property.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dependencies</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Another interesting feature of WAAPI is the ability to determine the dependence of the properties of one animation on the properties of another. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For example, if we have two squares, and we want the second to rotate twice as fast as the first, we can do this in two ways. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
First way:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">let</span> cube1Animation = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'cube'</span>).animate(<font></font>
    cubeRotating,<font></font>
    {<font></font>
        <span class="hljs-attr">duration</span>: <span class="hljs-number">1000</span>,
        <span class="hljs-attr">iterations</span>: <span class="hljs-literal">Infinity</span><font></font>
    }<font></font>
)<font></font>
<font></font>
<span class="hljs-keyword">let</span> cube2Animation = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'cube2'</span>).animate(<font></font>
    cubeRotating,<font></font>
    {<font></font>
        <span class="hljs-attr">duration</span>: <span class="hljs-number">500</span>,
        <span class="hljs-attr">iterations</span>: <span class="hljs-literal">Infinity</span><font></font>
    }<font></font>
)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The animation time of the first square is 1 second, the second - 500 milliseconds. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
However, with this approach, when we change the animation time of the first square, we need to do the same for the second square. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Imagine how difficult it becomes when there are many animations or a large number of animated objects? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The best way to solve our problem is to establish the dependence of the rotation of the second square on the first:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">let</span> cube1Animation = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'cube'</span>).animate(<font></font>
    cubeRotating,<font></font>
    {<font></font>
        <span class="hljs-attr">duration</span>: <span class="hljs-number">1000</span>,
        <span class="hljs-attr">iterations</span>: <span class="hljs-literal">Infinity</span><font></font>
    }<font></font>
)<font></font>
<font></font>
<span class="hljs-keyword">let</span> cube2Animation = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'cube2'</span>).animate(<font></font>
    cubeRotating,<font></font>
    {<font></font>
        <span class="hljs-attr">duration</span>: cube1Animation.effect.timing.duration / <span class="hljs-number">2</span>,
        <span class="hljs-attr">iterations</span>: <span class="hljs-literal">Infinity</span><font></font>
    }<font></font>
)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Thus, we use the animation time of the first square to determine the animation time of the second square. </font><font style="vertical-align: inherit;">Now, when changing the animation time of the first square, the second will always rotate twice as fast!</font></font><br>
<br>
<img src="https://habrastorage.org/webt/uh/aa/pf/uhaapf7c9xqtam-g7ilo0hqal7i.gif"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Performance</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Speaking of performance, I did not notice much difference between using CSS and WAAPI. </font><font style="vertical-align: inherit;">But this may be due to the simplicity of my example. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
One important advantage of WAAPI over other methods of creating animation in JS is that it runs in a separate thread, which allows the main thread to "forget" about the animation and do the rest of the code.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Browser support</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WAAPI is currently in draft status and is partially supported in recent versions of Firefox and Chrome, as well as in major mobile browsers. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Partial support means browsers support methods such as play, pause, reverse, finish and playbackRate, but do not support getAnimations. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ag/2a/r2/ag2ar2ipolk7xfiwxi_mdjbmzao.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There is a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">polyphile</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> for WAAPI in all browsers. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
That's all for me! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Further reading: </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Using the Web Animations API </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Web Animations API examples </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Great series ‚ÄúLet's talk about the Web Animations API‚Äù by Dan Wilson</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Thank you for your attention.</font></font></div>
      
    </div><p class="reference-to-source js-reference-to-source">Source: https://habr.com/ru/post/undefined/</p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en486438/index.html">How to choose a cellular and mobile Internet booster</a></li>
<li><a href="../en486440/index.html">Intel NUC for data management and analysis with SDR receiver</a></li>
<li><a href="../en486442/index.html">AMA with Habr # 16: recalculation of a rating and bug fixes</a></li>
<li><a href="../en486446/index.html">Design, product and rock and roll</a></li>
<li><a href="../en486452/index.html">Set up a simple VPN with WireGuard and Raspberry Pi as a server</a></li>
<li><a href="../en486456/index.html">Censorship in the .NET Framework Source Code</a></li>
<li><a href="../en486460/index.html">Interface Bikes Toxic Grandfather. ‚ÄúExplore it!‚Äù (s1 e1)</a></li>
<li><a href="../en486462/index.html">Amateur rocket science, how I make rockets and my mistakes I learn from (part 1)</a></li>
<li><a href="../en486472/index.html">The most detailed images of the surface of the sun</a></li>
<li><a href="../en486476/index.html">Realization of search for stamps on OpenCV without neurons, registration and SMS</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>