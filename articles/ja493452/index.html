<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>♓️ 🏹 ✋🏻 Unity背景画像ぼかし 🛶 🚯 👩🏿‍🏫</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Unityアプリケーション開発者が直面する可能性のあるタスクの1つは、現在の画像をバックグラウンドに配置して、ユーザーの注意を、表示されるメニューやメッセージなどの新しいものに切り替えることです。この記事では、外部リソースや追加のUnityライセンスを使用せずに、Unityの基本的な知識を持つ開発者...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Unity背景画像ぼかし</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/493452/"><img src="https://habrastorage.org/webt/jb/sq/go/jbsqgovdy74rajkik0r_o24tre8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unityアプリケーション開発者が直面する可能性のあるタスクの1つは、現在の画像をバックグラウンドに配置して、ユーザーの注意を、表示されるメニューやメッセージなどの新しいものに切り替えることです。この記事では、外部リソースや追加のUnityライセンスを使用せずに、Unityの基本的な知識を持つ開発者がこの問題を解決した経験について説明しています。この資料が、同様の問題に直面していて、そのさまざまな段階で効果的な解決策が見つからなかった人に役立つことを願っています。</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
重要なインターフェース要素を強調表示する（そして不要なものを削除する）は、ユーザーエクスペリエンスを向上させるための主要なツールの1つです。これは、モバイルアプリケーションで作業する場合に特に顕著です。この注意の切り替えはさまざまな方法で行うことができます-画面の端からボタンをスムーズに実行する、背景を暗くする、動的な動作など。これらには画像のぼかしが含まれます。一方、この効果は、背景要素のコントラストを低下させ、目がつかまりにくくなります。一方、ぼかしは、画像の焦点が合っていないときに潜在意識の影響を及ぼし、私たちはそれを別様に認識します。このアプローチはゲームでよく使用され、Unityでのよく知られたゲームの例から、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ハースストーン</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クエストのメニューを選択するとき</font><font style="vertical-align: inherit;">や、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">決闘完了画面</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、お気に入りのアプリケーションでも同じまたは類似したいことを想像してください。</font><font style="vertical-align: inherit;">私たちにも予算がなく、Unityの経験がほとんどありません。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パート1-シェーダー</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
生じた最初の考えは、すべてがすでに実現されるべきであるということでした。</font><font style="vertical-align: inherit;">確かにシェーダーを使用しています。</font><font style="vertical-align: inherit;">そして、それは確かにUnityボックスにあるはずです。</font><font style="vertical-align: inherit;">クイック検索とインストールの試みにより、Unityにそのようなシェーダーがあることがわかりましたが、結局のところ、これは標準アセットの一部であり、無料のライセンスでは利用できません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、これはぼやけています！</font><font style="vertical-align: inherit;">数学的にシンプルで、プロジェクトに簡単に実装および統合できる基本的な効果。</font><font style="vertical-align: inherit;">シェーダーについて何も知らなくても。</font><font style="vertical-align: inherit;">次に、インターネットにアクセスすると、すぐに検索により、エフェクト用の既製のシェーダーのソースコードが存在することがわかりました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初の実装では、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">このシェーダー</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が採用されました</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">テストするには、シェーダーをソースファイルとしてプロジェクトに追加し、それをマテリアルに関連付け、マテリアルを画像にバインドします。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パート2-ユーザーインターフェイス</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アプリケーションのユーザーを気にする場合は、ユーザーインターフェイスに十分注意する必要があります。背景にぼかし効果を追加してそれを忘れた場合、これは製品を作成する際の内部原則と必ずしも一致しません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その結果、さらなるアクションのために、何が起こったかに触れ、次にユーザーの必要な認識を引き起こすような方法で考え、調整する必要があります。この点は非常に状況依存です。画像のコントラスト、さまざまな色やその他の要因に応じて、さまざまな値と追加のツールを選択できます。私たちのケースでは、この段階で、ぼかし半径25（シェーダーパラメーター）と70％の追加の透明度（別の画像を通してシェーダーの外側）で良好な結果が得られました。ただし、これは最終的な背景画像にすぎません。電話での感情によると、移行自体はあまりにもシャープでした。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
画像にインストールされているシェーダーはフレームごとに計算されるため、スムーズな切り替えを行うには、ぼかし半径パラメーターと透明度を動的に変更するだけで十分です。</font><font style="vertical-align: inherit;">これはさまざまな方法で整理できますが、本質的には、処理は時間に応じて更新ハンドラで更新されます。</font><font style="vertical-align: inherit;">アプリケーションの最終バージョンでの遷移自体は0.2秒ですが、実際にはユーザーの知覚にとって重要です。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パート3-生産性</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここ数か月間、ゲームプログラムは多くの場合、利用可能なすべてのコンピューターリソースをアイドル状態でブレーキなしで使用しているという、プログラマーでさえないいくつかの異なるユーザーからの不満を聞いています。たとえば、これは、プログラムがトレイに最小化されている場合のビデオカードの最大使用、またはすべてと1つのプロセッサスレッドの継続的なロードに関係なく表現できます。これの理由は直感的です-開発者またはパブリッシャーの収入は最適化に依存せず（人々は購入時にそのようなことに注意を払わない）、通常の開発者はおそらくローカルKPIと遅延の必要性についてより懸念しています。ただし、実際には、このカテゴリに分類したくありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次の発売の前段階を背景ぼかし効果で終えた後、しばらく手に持ったところ、温かみのある感じがしました。メニューにより多くの時間を費やすと、すべてがさらに悪くなります。そして、メニューのユーザーがおそらくそしておそらくほとんどの時間を費やさなくても、私はバッテリーをまったく落としたくないでしょう。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
分析の結果、上で選択したシェーダー</font><font style="vertical-align: inherit;">は、選択した半径に応じ</font><font style="vertical-align: inherit;">て漸近的な複雑度</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O（r </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）を</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">持っていることがわかり</font><font style="vertical-align: inherit;">ました。つまり、ぼかし半径を1から25に増やすと、ポイントあたりの計算数は625倍になります。この場合、計算は各フレームで行われます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ソリューションの最初のステップは、すべてのシェーダーが同等に役立つわけではなく、ぼかし効果をさまざまな方法で実装できるという考えでした。これを行うには、個別のぼかしを行うことができます。その本質は、最初に水平方向の線のみ、次に垂直方向の線のみをぼかすことです。その結果、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O（r）が</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">得</font><font style="vertical-align: inherit;">られ、複雑さが1桁低下します。もう1つの方法は、小さなミップマップを取得することです。これは、ぼかし作業の一部をすでに実行しています。</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">このシェーダー</font></a></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
がベースとして使用されました</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">しかし、そのぼかし効果は不十分であることが判明し、グラフィックのコントラストが高いため、画像は「欠けた」ものになりました。</font><font style="vertical-align: inherit;">より良い効果を得るために、分布が変更されました（GRABPIXEL要素）。</font><font style="vertical-align: inherit;">シェーダーでリンクが半径4の0.18から0.05の場合、バージョンでは半径6の0.14から0.03です（ess、ただしすべての合計は1である必要があります）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、処理の複雑さは1〜2桁減少しました。</font><font style="vertical-align: inherit;">しかし、これは停止する必要はありません。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パート4-静的な背景</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それにもかかわらず、既存の画像にシェーダーを残した場合、それは常に機能し、各フレームで同じ計算を行います。</font><font style="vertical-align: inherit;">バックグラウンドで何かが起こった場合、それを行う必要があります。</font><font style="vertical-align: inherit;">しかし、背景が静止している場合、これは完全にオプションです。</font><font style="vertical-align: inherit;">したがって、動的なぼかしの後、結果を記憶して背景に配置し、シェーダーをオフにすることができます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、コードスニペットを試してみましょう。</font><font style="vertical-align: inherit;">画面全体の宛先テクスチャを準備すると、次のようになります。</font></font><br>
<br>
<pre><code class="cs hljs">_width = Screen.width / <span class="hljs-number">2</span>;<font></font>
_height = Screen.height / <span class="hljs-number">2</span>;<font></font>
_texture = <span class="hljs-keyword">new</span> Texture2D(_width, _height);<font></font>
<font></font>
<span class="hljs-keyword">var</span> fillColor = Color.white;
<span class="hljs-keyword">var</span> fillColorArray = _texture.GetPixels();
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; fillColorArray.Length; ++i)<font></font>
{<font></font>
	fillColorArray[i] = fillColor;<font></font>
}<font></font>
_texture.SetPixels(fillColorArray);<font></font>
_texture.Apply();<font></font>
<font></font>
_from.GetComponent&lt;Image&gt;().sprite = Sprite.Create(_texture, <span class="hljs-keyword">new</span> Rect(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, _texture.width, _texture.height), <span class="hljs-keyword">new</span> Vector2(<span class="hljs-number">0.5f</span>, <span class="hljs-number">0.5f</span>));</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
つまり、ここでは、画面から水平および垂直に2倍小さいテクスチャが用意されています。</font><font style="vertical-align: inherit;">これは、デバイスの画面サイズが2の倍数であることを知っているため、ほとんど常に実行できます。これを実行すると、テクスチャのサイズが小さくなり、ぼかしが容易になります。</font></font><br>
<br>
<pre><code class="cs hljs">RenderTexture temp = RenderTexture.GetTemporary(_width, _height);<font></font>
Graphics.Blit(_from_image.mainTexture, temp, _material);<font></font>
RenderTexture.active = temp;<font></font>
<font></font>
_texture.ReadPixels(<span class="hljs-keyword">new</span> Rect(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, temp.width, temp.height), <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-literal">false</span>);<font></font>
_texture.Apply();<font></font>
<font></font>
_to_image.sprite = Sprite.Create(_texture, <span class="hljs-keyword">new</span> Rect(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, _texture.width, _texture.height), <span class="hljs-keyword">new</span> Vector2(<span class="hljs-number">0.5f</span>, <span class="hljs-number">0.5f</span>));<font></font>
RenderTexture.ReleaseTemporary(temp);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（_materialの）シェーダーを使用してmainTextureで画像をキャプチャするには、Graphics.Blitを使用します。次に、準備したテクスチャに結果を記憶し、それをターゲット画像に配置します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべてが問題なく、実際には、デバイスに応じて背景画像が上下逆になるような効果に直面していました。問題のいくつかの調査とデバッグの後で明らかになった理由- </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">座標系の違い</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unityが非表示にできないDirect3DおよびOpenGL。同時に、シェーダーはUVを検出して正しく処理し、反転は既にUnity環境（ReadPixels）で発生しています。 「裏返した場合は自分で裏返す」、「UVサインを変更する」など、多くのヒントがネット上にあります。 UNITY_UV_STARTS_AT_TOPマクロを使用しても、テスト中のすべてのデバイスを適切に一般化することはできませんでした。さらに、たとえば、iPhoneのXcodeでエミュレーション用にアセンブリを準備し、UnityがMetalではなくOpenGLESのみを使用している場合、他のソフトウェアで実行されているデバイスのエミュレーションなどのケースをインターセプトする必要があるというケースに遭遇しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
いくつかのオプションを試した後、私は2つのタブレットに落ち着きました。最初は</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">カメラのレンダリングを強制することです</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（画像キャプチャ時にforceIntoRenderTextureを設定）。</font><font style="vertical-align: inherit;">2つ目は、SystemInfo.graphicsDeviceTypeを介したグラフィックシステムのタイプの決定です。これにより、OpenGLのようなまたはDirect3Dのような定義が可能になります（最初のグループはOpenGLES2、OpenGLES3、OpenGLCoreおよびVulkanです）。</font><font style="vertical-align: inherit;">さらに、Direct3Dのような実装では、手続き的に（たとえば、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">この</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ように</font><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">反転させる必要があり</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結論</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この記事が、未知のレーキを克服し、ユーザーの生活を改善し、Unityを理解する上で役立つことを願っています。</font><font style="vertical-align: inherit;">戦闘での効果を見ると、Unityは次のようになり</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">アプリケーションでは、感覚は多少異なりますが、このアニメーションは十分なアイデアを与えることができます。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja493442/index.html">PPEリマインダー</a></li>
<li><a href="../ja493444/index.html">プロジェクト「ガラス」。エネルギー効率の使い捨て紅茶/コーヒーカップ</a></li>
<li><a href="../ja493446/index.html">週末の読書：10の珍しいサウンドストーリー-スパイゲームや陰謀論からリラックスしたASMRまで</a></li>
<li><a href="../ja493448/index.html">Spring-効率的なルーティング</a></li>
<li><a href="../ja493450/index.html">初心者の投資家が法的に減税する方法：4つの作業方法</a></li>
<li><a href="../ja493458/index.html">Androidを解放する-Alaverdi</a></li>
<li><a href="../ja493462/index.html">超音波バス。パート2</a></li>
<li><a href="../ja493468/index.html">深く呼吸することを恐れないでください</a></li>
<li><a href="../ja493470/index.html">科学者は海王星の外の新しい小惑星を見つける</a></li>
<li><a href="../ja493478/index.html">ハックザボックス-ウォークスルーフォレスト。AS-REPロースト、DCSync、Pass-The-Hash攻撃</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>