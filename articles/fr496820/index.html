<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏽‍🤝‍👩🏻 🧙🏻 🌯 Pièges de Terraform 🙍🏼 🙍🏽 🎎</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Nous mettrons en évidence quelques pièges, notamment ceux liés aux boucles, aux instructions if et aux techniques de déploiement, ainsi que des problè...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Pièges de Terraform</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/piter/blog/496820/"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><div style="text-align:center;"><img src="https://habrastorage.org/webt/9d/ou/9e/9dou9eb8rwq6zzcphuthymczj4a.jpeg" alt="image"></div></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous mettrons en évidence quelques pièges, notamment ceux liés aux boucles, aux instructions if et aux techniques de déploiement, ainsi que des problèmes plus généraux qui concernent Terraform dans son ensemble:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">les paramètres count et for_each ont des limites;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zéro restriction de déploiement de temps d'arrêt</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">même un bon plan peut échouer;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">le refactoring peut avoir ses astuces;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">la cohérence différée est compatible ... avec le report.</font></font></li>
</ul><a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les paramètres Count et for_each ont des limites</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans les exemples de ce chapitre, le paramètre count et l'expression for_each sont activement utilisés dans les boucles et la logique conditionnelle. </font><font style="vertical-align: inherit;">Ils fonctionnent bien, mais ils ont deux limitations importantes que vous devez connaître.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans count et for_each, aucune variable de sortie de ressource ne peut être référencée.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">count et for_each ne peuvent pas être utilisés dans la configuration du module.</font></font></li>
</ul><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Count et for_each ne peuvent référencer aucune variable de sortie d'une ressource</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Imaginez que vous devez déployer plusieurs serveurs EC2 et que pour une raison quelconque vous ne souhaitiez pas utiliser ASG. </font><font style="vertical-align: inherit;">Votre code pourrait ressembler à ceci:</font></font><br>
<br>
<pre><code class="java hljs">resource <span class="hljs-string">"aws_instance"</span> <span class="hljs-string">"example_1"</span> {<font></font>
   count             = <span class="hljs-number">3</span>
   ami                = <span class="hljs-string">"ami-0c55b159cbfafe1f0"</span>
   instance_type = <span class="hljs-string">"t2.micro"</span><font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous les examinerons tour à tour. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme le paramètre count a une valeur statique, ce code fonctionnera sans problème: lorsque vous exécutez la commande apply, il créera trois serveurs EC2. Mais si vous vouliez déployer un serveur dans chaque zone de disponibilité (zone de disponibilité ou AZ) dans la région AWS actuelle? Vous pouvez demander à votre code de charger la liste des zones à partir de la source de données aws_available_zones, puis de parcourir chacune d'elles et d'y créer un serveur EC2 en utilisant le paramètre count et en accédant au tableau par index:</font></font><br>
<br>
<pre><code class="java hljs">resource <span class="hljs-string">"aws_instance"</span> <span class="hljs-string">"example_2"</span> {<font></font>
   count                   = length(data.aws_availability_zones.all.names)<font></font>
   availability_zone   = data.aws_availability_zones.all.names[count.index]<font></font>
   ami                     = <span class="hljs-string">"ami-0c55b159cbfafe1f0"</span>
   instance_type       = <span class="hljs-string">"t2.micro"</span><font></font>
}<font></font>
<font></font>
data <span class="hljs-string">"aws_availability_zones"</span> <span class="hljs-string">"all"</span> {}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce code fonctionnera tout aussi bien, car le paramètre count peut référencer des sources de données sans aucun problème. </font><font style="vertical-align: inherit;">Mais que se passe-t-il si le nombre de serveurs que vous devez créer dépend de la sortie d'une ressource? </font><font style="vertical-align: inherit;">Pour le démontrer, le moyen le plus simple consiste à prendre la ressource random_integer, qui, comme vous pouvez le deviner d'après le nom, renvoie un entier aléatoire:</font></font><br>
<br>
<pre><code class="java hljs">resource <span class="hljs-string">"random_integer"</span> <span class="hljs-string">"num_instances"</span> {<font></font>
  min = <span class="hljs-number">1</span>
  max = <span class="hljs-number">3</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce code génère un nombre aléatoire de 1 à 3. Voyons ce qui se passe si nous essayons d'utiliser la sortie de résultat de cette ressource dans le paramètre count de la ressource aws_instance:</font></font><br>
<br>
<pre><code class="java hljs">resource <span class="hljs-string">"aws_instance"</span> <span class="hljs-string">"example_3"</span> {<font></font>
   count             = random_integer.num_instances.result<font></font>
   ami                = <span class="hljs-string">"ami-0c55b159cbfafe1f0"</span>
   instance_type = <span class="hljs-string">"t2.micro"</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous exécutez un plan terraform pour ce code, vous obtenez l'erreur suivante:</font></font><br>
<br>
<pre><code class="java hljs">Error: Invalid count argument<font></font>
<font></font>
   on main.tf line <span class="hljs-number">30</span>, in resource <span class="hljs-string">"aws_instance"</span> <span class="hljs-string">"example_3"</span>:
   <span class="hljs-number">30</span>: count = random_integer.num_instances.result<font></font>
<font></font>
The <span class="hljs-string">"count"</span> value depends on resource attributes that cannot be determined until apply, so Terraform cannot predict how many instances will be created. To work around <span class="hljs-keyword">this</span>, use the -target argument to first apply only the resources that the count depends on.</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Terraform requiert que count et for_each soient calculés pendant la phase de planification, avant que des ressources ne soient créées ou modifiées. </font><font style="vertical-align: inherit;">Cela signifie que count et for_each peuvent faire référence à des littéraux, des variables, des sources de données et même des listes de ressources (à condition que leur longueur puisse être déterminée lors de la planification), mais pas aux variables de sortie calculées de la ressource.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">count et for_each ne peuvent pas être utilisés dans la configuration du module</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parfois, vous pourriez être tenté d'ajouter le paramètre count à la configuration du module:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">module</span> <span class="hljs-string">"count_example"</span> {<font></font>
     source = <span class="hljs-string">"../../../../modules/services/webserver-cluster"</span><font></font>
<font></font>
     count = <span class="hljs-number">3</span><font></font>
<font></font>
     cluster_name = <span class="hljs-string">"terraform-up-and-running-example"</span>
     server_port = <span class="hljs-number">8080</span>
     instance_type = <span class="hljs-string">"t2.micro"</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce code tente d'utiliser count à l'intérieur du module pour créer trois copies de la ressource de cluster de serveurs Web. </font><font style="vertical-align: inherit;">Ou, vous souhaitez peut-être rendre la connexion du module facultative en fonction d'une condition booléenne, en affectant son paramètre de comptage à 0. Ce code semblera tout à fait raisonnable, mais à la suite de l'exécution du plan terraform, vous obtiendrez l'erreur suivante:</font></font><br>
<br>
<pre><code class="java hljs">Error: Reserved argument name in <span class="hljs-keyword">module</span> block<font></font>
<font></font>
   on main.tf line <span class="hljs-number">13</span>, in <span class="hljs-keyword">module</span> <span class="hljs-string">"count_example"</span>:
   <span class="hljs-number">13</span>: count = <span class="hljs-number">3</span><font></font>
<font></font>
The name <span class="hljs-string">"count"</span> is reserved <span class="hljs-keyword">for</span> use in a future version of Terraform.</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Malheureusement, au moment de la sortie de Terraform 0.12.6, l'utilisation de count ou for_each dans la ressource de module n'était pas prise en charge. </font><font style="vertical-align: inherit;">Selon les notes de version de Terraform 0.12 (http://bit.ly/3257bv4), HashiCorp prévoit d'ajouter cette fonctionnalité à l'avenir, donc selon le moment où vous lirez ce livre, il se peut qu'elle soit déjà disponible. </font><font style="vertical-align: inherit;">Pour le savoir, consultez le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">journal des modifications de Terraform ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3>     </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'utilisation du bloc create_before_destroy en combinaison avec ASG est une excellente solution pour organiser des déploiements sans temps d'arrêt, à l'exception d'une nuance: les règles de mise à l'échelle automatique ne sont pas prises en charge. Ou, pour être plus précis, cela réinitialise la taille ASG à min_size à chaque déploiement, ce qui peut être un problème si vous avez utilisé des règles de mise à l'échelle automatique pour augmenter le nombre de serveurs en cours d'exécution. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par exemple, le module de cluster de serveurs Web contient une paire de ressources aws_autoscaling_schedule qui, à 9 h, font passer le nombre de serveurs du cluster de deux à dix. Si vous déployez, disons, à 11 heures du matin, le nouvel ASG ne démarrera pas avec dix, mais avec seulement deux serveurs, et restera dans cet état jusqu'à 9 heures le lendemain.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cette limitation peut être contournée de plusieurs manières.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Modifiez le paramètre de récurrence dans aws_autoscaling_schedule de 0 9 * * * («exécuté à 9 h») à quelque chose comme 0-59 9-17 * * * («exécuté toutes les minutes de 9 h à 17 h»). </font><font style="vertical-align: inherit;">Si l'ASG a déjà dix serveurs, la réexécution de cette règle de mise à l'échelle automatique ne changera rien, ce dont nous avons besoin. </font><font style="vertical-align: inherit;">Mais si le groupe ASG a été récemment déployé, cette règle garantit qu'en une minute le nombre de ses serveurs atteint dix. </font><font style="vertical-align: inherit;">Ce n'est pas une approche entièrement élégante, et de grands sauts de dix à deux serveurs et vice versa peuvent également causer des problèmes aux utilisateurs.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Créez un script défini par l'utilisateur qui utilise l'API AWS pour déterminer le nombre de serveurs actifs dans l'ASG, appelez-le à l'aide d'une source de données externe (voir la section "Source de données externe" à la page 263) et définissez le paramètre de capacité souhaitée du groupe ASG sur la valeur renvoyée par ce script. </font><font style="vertical-align: inherit;">Ainsi, chaque nouvelle instance ASG fonctionnera toujours avec la même capacité que l'ancien code Terraform et complique sa maintenance.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bien sûr, idéalement, Terraform devrait avoir une prise en charge intégrée pour les déploiements sans temps d'arrêt, mais en mai 2019, l'équipe HashiCorp n'avait pas prévu d'ajouter cette fonctionnalité (les </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">détails sont ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le plan correct peut être mis en œuvre sans succès.</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parfois, lorsque vous exécutez la commande plan, vous obtenez un plan de déploiement complètement correct, mais la commande apply renvoie une erreur. </font><font style="vertical-align: inherit;">Par exemple, essayez d'ajouter la ressource aws_iam_user avec le même nom que vous avez utilisé pour l'utilisateur IAM que vous avez créé précédemment dans le chapitre 2:</font></font><br>
<br>
<pre><code class="java hljs">resource <span class="hljs-string">"aws_iam_user"</span> <span class="hljs-string">"existing_user"</span> {<font></font>
   #       IAM,<font></font>
   #      terraform <span class="hljs-keyword">import</span>
   name = <span class="hljs-string">"yevgeniy.brikman"</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, si vous exécutez la commande plan, Terraform affichera à première vue un plan de déploiement très raisonnable:</font></font><br>
<br>
<pre><code class="java hljs">Terraform will perform the following actions:<font></font>
<font></font>
   # aws_iam_user.existing_user will be created<font></font>
   + resource <span class="hljs-string">"aws_iam_user"</span> <span class="hljs-string">"existing_user"</span> {<font></font>
         + arn                  = (known after apply)<font></font>
         + force_destroy   = <span class="hljs-keyword">false</span><font></font>
         + id                    = (known after apply)<font></font>
         + name               = <span class="hljs-string">"yevgeniy.brikman"</span>
         + path                 = <span class="hljs-string">"/"</span><font></font>
         + unique_id         = (known after apply)<font></font>
      }<font></font>
<font></font>
Plan: <span class="hljs-number">1</span> to add, <span class="hljs-number">0</span> to change, <span class="hljs-number">0</span> to destroy.</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous exécutez la commande apply, vous obtenez l'erreur suivante:</font></font><br>
<br>
<pre><code class="java hljs">Error: Error creating IAM User yevgeniy.brikman: EntityAlreadyExists:<font></font>
User with name yevgeniy.brikman already exists.<font></font>
<font></font>
   on main.tf line <span class="hljs-number">10</span>, in resource <span class="hljs-string">"aws_iam_user"</span> <span class="hljs-string">"existing_user"</span>:
   <span class="hljs-number">10</span>: resource <span class="hljs-string">"aws_iam_user"</span> <span class="hljs-string">"existing_user"</span> {</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le problème, bien sûr, est qu'un utilisateur IAM portant ce nom existe déjà. Et cela peut se produire non seulement avec les utilisateurs IAM, mais aussi avec presque toutes les ressources. Il est possible que quelqu'un ait créé cette ressource manuellement ou en utilisant la ligne de commande, mais quoi qu'il en soit, la correspondance des identifiants entraîne des conflits. Il existe de nombreuses saveurs à cette erreur qui prennent souvent les débutants Terraform par surprise. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le point clé est que la commande terraform plan ne prend en compte que les ressources spécifiées dans le fichier d'état Terraform. Si les ressources sont créées d'une autre manière (par exemple, manuellement, en cliquant sur la console AWS), elles n'entreront pas dans le fichier d'état et, par conséquent, Terraform ne les prendra pas en compte lors de l'exécution de la commande plan. En conséquence, le plan qui est correct à première vue sera infructueux.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Deux enseignements peuvent en être tirés.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si vous avez déjà commencé à travailler avec Terraform, n'utilisez rien d'autre. </font><font style="vertical-align: inherit;">Si une partie de votre infrastructure est gérée à l'aide de Terraform, vous ne pouvez plus la modifier manuellement. </font><font style="vertical-align: inherit;">Sinon, vous courez non seulement le risque d'obtenir des erreurs Terraform étranges, mais vous annulez également les nombreux avantages de l'IaC, car le code ne sera plus une représentation précise de votre infrastructure.</font></font></li>
<li>     - ,   import.     Terraform    ,          terraform import.  Terraform  ,    .  import   .        .    ,      : _. ( aws_iam_user.existing_user).   —   ,   . ,   ID  aws_iam_user    (, yevgeniy.brikman),  ID  aws_instance    EC2 ( i-190e22e5). ,   ,       .<br>
<br>
   import,    aws_iam_user,       Terraform    IAM   2 (,  yevgeniy.brikman    ):<br>
<br>
<pre><code class="plaintext hljs">$ terraform import aws_iam_user.existing_user yevgeniy.brikman</code></pre><br>
Terraform   API AWS,     IAM           aws_iam_user.existing_user    Terraform.       plan Terraform  ,   IAM  ,        .<br>
<br>
 , ,       ,      Terraform,              .       ,  Terraforming (http://terraforming.dtan4.net/),        AWS   .<br>
<br>
<h3>    </h3><br>
<i></i> —    ,      ,     .  ,     ,     .  —   ,    . ,     Terraform     IaC,      ,      « »  ,    .<br>
<br>
,    —       .  IDE               .        ,     ,   Terraform      ,       .<br>
<br>
 ,   webserver-cluster    cluster_name:<br>
<br>
<pre><code class="java hljs">variable <span class="hljs-string">"cluster_name"</span> {<font></font>
   description = <span class="hljs-string">"The name to use for all the cluster resources"</span><font></font>
   type          = string<font></font>
}</code></pre><br>
,            foo.        bar.     ,    -      .<br>
<br>
  ,   webserver-cluster   cluster_name    ,   name     ALB:<br>
<br>
<pre><code class="java hljs">resource <span class="hljs-string">"aws_lb"</span> <span class="hljs-string">"example"</span> {<font></font>
   name                    = <span class="hljs-keyword">var</span>.cluster_name<font></font>
   load_balancer_type = <span class="hljs-string">"application"</span>
   subnets = data.aws_subnet_ids.<span class="hljs-keyword">default</span>.ids<font></font>
   security_groups      = [aws_security_group.alb.id]<font></font>
}</code></pre><br>
   name  - , Terraform          .      ALB,                    -.   ,    ,       ,      .<br>
<br>
   ,    ,    Terraform.      aws_security_group   webserver-cluster:<br>
<br>
<pre><code class="java hljs">resource <span class="hljs-string">"aws_security_group"</span> <span class="hljs-string">"instance"</span> {<font></font>
  # (...)<font></font>
}</code></pre><br>
    instance. ,            (  )  cluster_instance:<br>
<br>
<pre><code class="java hljs">resource <span class="hljs-string">"aws_security_group"</span> <span class="hljs-string">"cluster_instance"</span> {<font></font>
   # (...)<font></font>
}</code></pre><br>
   ? :   .<br>
<br>
Terraform  ID      . , iam_user     IAM  AWS,  aws_instance —  ID  AWS EC2.     (,  instance  cluster_instance,     aws_security_group),  Terraform    ,        .    , Terraform       ,          .<br>
<br>
   ,       .<br>
<br>
<ul>
<li>   plan.      .         ,  Terraform   , ,  ,   .</li>
<li>,   .     ,  ,       .   ,     create_before_destroy.      ,   :          apply,           apply  .</li>
<li>    .     ,    (,  aws_security_group  instance  cluster_instance),          ,       Terraform.      —     terraform state.       terraform state mv,    :<br>
<br>
<pre><code class="plaintext hljs">terraform state mv &lt;ORIGINAL_REFERENCE&gt; &lt;NEW_REFERENCE&gt;</code></pre><br>
ORIGINAL_REFERENCE —  ,       ,  NEW_REFERENCE —  ,     . ,    aws_security_group  instance  cluster_instance    :<br>
<br>
<pre><code class="java hljs">$ terraform state mv \<font></font>
   aws_security_group.instance \<font></font>
   aws_security_group.cluster_instance</code></pre><br>
   Terraform,  ,     aws_security_group.instance,      aws_security_group.cluster_instance.        terraform plan    , ,    .</li>
</ul><br>
<ul>
<li>   .    .    , Terraform        .      ,        ,      .    plan      create_before_destroy.</li>
</ul><br>
<h3>  …  </h3><br>
API   ,   AWS,     .  ,       ,     .   ,          ;   ,         ,        API-.<br>
<br>
,  ,    API-  AWS     EC2. API  «»  (201 Created)  ,     .        ,     ,     AWS     ,  ,    .  ,      ,      ,    (404 Not Found).   ,      EC2      AWS,     ,    .<br>
<br>
    API         ,         .  , AWS SDK       ,   Terraform       6813 (https://github.com/hashicorp/terraform/issues/6813):<br>
<br>
<pre><code class="java hljs">$ terraform apply<font></font>
aws_subnet.<span class="hljs-keyword">private</span>-persistence<span class="hljs-number">.2</span>: InvalidSubnetID.NotFound:<font></font>
The subnet ID <span class="hljs-string">'subnet-xxxxxxx'</span> does not exist</code></pre><br>
 ,    (, )       -  ( ID    ),  Terraform    .     ( 6813)  ,        ,    Terraform     .  ,        .    terraform apply   ,         .<br>
<br>
       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">«Terraform:    »</a>.</li>
</ul></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr496804/index.html">Installation et configuration de Docker sur le sous-système Windows Linux (WSL)</a></li>
<li><a href="../fr496810/index.html">Analyse financière générale en Python (Partie 3)</a></li>
<li><a href="../fr496812/index.html">Zoom - négligence banale ou espionnage ciblé?</a></li>
<li><a href="../fr496816/index.html">Pouvez-vous sentir le candidat, est-il vivant?</a></li>
<li><a href="../fr496818/index.html">Des centaines de milliers de routes par seconde par cœur. Expérience Yandex.Routing</a></li>
<li><a href="../fr496822/index.html">Comment les startups aux États-Unis meurent à cause du coronavirus</a></li>
<li><a href="../fr496824/index.html">Votre environnement de travail nordique</a></li>
<li><a href="../fr496826/index.html">Des millions de sprites à plus de 120 images par seconde</a></li>
<li><a href="../fr496828/index.html">Où trouver des freelances qui seront amusants? (Spoiler: pas Upwork)</a></li>
<li><a href="../fr496830/index.html">Qu'est-ce que la communication émergente et pourquoi vous devez savoir</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>