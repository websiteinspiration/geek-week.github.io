<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßú üïí üë©üèø‚Äçüé§ Cont√™iner Linux para o aplicativo .NET Framework (quando √© dif√≠cil sair para o .Net Core) üôçüèº üÉè üë®üèº‚Äç‚öïÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ol√°, Habr. 
 
 Quero compartilhar com o mundo uma tarefa bastante at√≠pica, pelo menos para mim, e sua solu√ß√£o, que me parece bastante aceit√°vel. Descr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Cont√™iner Linux para o aplicativo .NET Framework (quando √© dif√≠cil sair para o .Net Core)</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/498396/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ol√°, Habr. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quero compartilhar com o mundo uma tarefa bastante at√≠pica, pelo menos para mim, e sua solu√ß√£o, que me parece bastante aceit√°vel. </font><font style="vertical-align: inherit;">Descrito abaixo pode n√£o ser o caminho ideal para sair da situa√ß√£o, mas funciona e funciona conforme o esperado.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configura√ß√£o e plano de fundo</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Havia uma tarefa a ser trabalhada: voc√™ precisa fazer visualiza√ß√µes em 3D de modelos BIM de v√°rios equipamentos, materiais e objetos no site. </font><font style="vertical-align: inherit;">Precisa de algo leve, sem complica√ß√µes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No site, os modelos desses objetos s√£o armazenados e dispon√≠veis para download em formatos propriet√°rios de v√°rios </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sistemas CAD</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e na forma de formatos abertos para modelos 3D. </font><font style="vertical-align: inherit;">Entre eles est√° o formato </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IFC</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Vou us√°-lo como fonte para resolver esta tarefa.</font></font><br>
<a name="habracut"></a><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Uma das op√ß√µes e seus recursos</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Formalmente, pode-se restringir a escrever algum tipo de conversor * .ifc para exibir algo em uma p√°gina da web. </font><font style="vertical-align: inherit;">Aqui √© onde eu comecei. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um maravilhoso kit de ferramentas, o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">xBIM Toolkit,</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> foi escolhido para essa convers√£o </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os exemplos de uso dessa ferramenta </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">descrevem de</font></font></i></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> maneira </font><font style="vertical-align: inherit;">simples e clara </font><font style="vertical-align: inherit;">como trabalhar com o IFC e o * .wexBIM especializado no formato da Web.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Primeiro, converta * .ifc para * .wexBIM:</font></font></b>
                        <div class="spoiler_text"><pre><code class="cs hljs"><span class="hljs-keyword">using</span> System.IO;
<span class="hljs-keyword">using</span> Xbim.Ifc;
<span class="hljs-keyword">using</span> Xbim.ModelGeometry.Scene;<font></font>
<font></font>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">CreateWexBIM</span><font></font>
{<font></font>
    <span class="hljs-keyword">class</span> <span class="hljs-title">Program</span><font></font>
    {<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>(<span class="hljs-params"></span>)</span><font></font>
        {<font></font>
            <span class="hljs-keyword">const</span> <span class="hljs-keyword">string</span> fileName = <span class="hljs-string">"SampleHouse.ifc"</span>;
            <span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> model = IfcStore.Open(fileName))<font></font>
            {<font></font>
                <span class="hljs-keyword">var</span> context = <span class="hljs-keyword">new</span> Xbim3DModelContext(model);<font></font>
                context.CreateContext();<font></font>
<font></font>
                <span class="hljs-keyword">var</span> wexBimFilename = Path.ChangeExtension(fileName, <span class="hljs-string">"wexBIM"</span>);
                <span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> wexBiMfile = File.Create(wexBimFilename))<font></font>
                {<font></font>
                    <span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> wexBimBinaryWriter = <span class="hljs-keyword">new</span> BinaryWriter(wexBiMfile))<font></font>
                    {<font></font>
                        model.SaveAsWexBim(wexBimBinaryWriter);<font></font>
                        wexBimBinaryWriter.Close();<font></font>
                    }<font></font>
                    wexBiMfile.Close();<font></font>
                }<font></font>
            }<font></font>
        }<font></font>
    }<font></font>
}<font></font>
</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em seguida, o arquivo resultante √© usado no </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">xBIM WeXplorer</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> "player" </font><font style="vertical-align: inherit;">.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um exemplo de incorpora√ß√£o * .wexBIM em uma p√°gina:</font></font></b>
                        <div class="spoiler_text"><pre><code class="javascript hljs">&lt;!DOCTYPE html&gt;
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://www.w3.org/1999/xhtml"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Hello building!<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"js/xbim-viewer.debug.bundle.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"content"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"viewer"</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"500"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"300"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text/javascript"</span>&gt;</span><span class="javascript">
            <span class="hljs-keyword">var</span> viewer = <span class="hljs-keyword">new</span> xViewer(<span class="hljs-string">'viewer'</span>);
            viewer.load(<span class="hljs-string">'data/SampleHouse.wexbim'</span>);
            viewer.start();
        </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>    
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></span>
</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bem, vamos. </font><font style="vertical-align: inherit;">Eu tomo </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nugets</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de xBIM. </font><font style="vertical-align: inherit;">Estou escrevendo um aplicativo de console que recebe v√°rios caminhos para arquivos * .ifc como entrada e, ao lado deles, adiciona um monte de arquivos * .wexBIM. </font><font style="vertical-align: inherit;">Tudo pode ser carregado no site. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas, de alguma forma, √© bastante simples ... Quero que esse programa se torne um tipo de servi√ßo que, no evento de upload * .ifc no portal, cria imediatamente o * .wexBIM necess√°rio e aparece imediatamente no cont√™iner preparado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ok, eu formei novos requisitos:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Deixe as tarefas de convers√£o virem do </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RabbitMQ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quero ver as pr√≥prias tarefas na forma de uma mensagem bin√°ria, que de fato estar√° pronta para desserializa√ß√£o pela classe descrita no </font><font style="vertical-align: inherit;">arquivo </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">protobuf</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a tarefa conter√° um link para baixar o arquivo de origem * .ifc do nosso </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Minio</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> a tarefa tamb√©m me dir√° qual balde no Minio para adicionar o resultado;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">deixe o pr√≥prio aplicativo ser constru√≠do sob o .net core 3.1 e trabalhar dentro do cont√™iner do docker Linux em nosso "farm de docker";</font></font></li>
</ol><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As primeiras dificuldades e conven√ß√µes</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N√£o descreverei detalhadamente os quatro primeiros pontos de implementa√ß√£o. </font><font style="vertical-align: inherit;">Talvez mais tarde. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Faz com que o aplicativo escute a fila de trabalhos e envie uma mensagem com o resultado para a fila do </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CorrelationId da</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mensagem do trabalho. </font><font style="vertical-align: inherit;">Foi danificada a classe de solicita√ß√£o / resposta gerada pelo protobuf. </font><font style="vertical-align: inherit;">Ministrado o download / upload de arquivos no </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">minio</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tudo isso eu fa√ßo no projeto de aplicativo do console. </font><font style="vertical-align: inherit;">Nas configura√ß√µes do projeto:</font></font><br>
<br>
<pre><code class="xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">TargetFramework</span>&gt;</span>netcoreapp3.1<span class="hljs-tag">&lt;/<span class="hljs-name">TargetFramework</span>&gt;</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E na minha m√°quina com o Windows 10 tudo √© completamente depurado e funciona. </font><font style="vertical-align: inherit;">Mas quando tento executar o aplicativo no </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WSL,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pego um erro </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">System.IO.FileLoadException</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Informa√ß√µes de erro completas:</font></font></b>
                        <div class="spoiler_text"><pre><code class="json hljs">{
  <span class="hljs-attr">"Type"</span>: <span class="hljs-string">"System.IO.FileLoadException"</span>,
  <span class="hljs-attr">"Message"</span>: <span class="hljs-string">"Failed to load Xbim.Geometry.Engine64.dll"</span>,
  <span class="hljs-attr">"TargetSite"</span>: <span class="hljs-string">"Void .ctor(Microsoft.Extensions.Logging.ILogger`1[Xbim.Geometry.Engine.Interop.XbimGeometryEngine])"</span>,
  <span class="hljs-attr">"StackTrace"</span>: <span class="hljs-string">" at Xbim.Geometry.Engine.Interop.XbimGeometryEngine..ctor(ILogger`1 logger)\r\n at Xbim.Geometry.Engine.Interop.XbimGeometryEngine..ctor()\r\n at Xbim.ModelGeometry.Scene.Xbim3DModelContext.get_Engine()\r\n at Xbim.ModelGeometry.Scene.Xbim3DModelContext.CreateContext(ReportProgressDelegate progDelegate, Boolean adjustWcs)\r\n at My.Converter.ConvertIfc.CreateWebIfc(String ifcFileFullPath, String wexBIMFolder)"</span>,
  <span class="hljs-attr">"Data"</span>: {},
  <span class="hljs-attr">"InnerException"</span>: {
    <span class="hljs-attr">"Type"</span>: <span class="hljs-string">"System.IO.FileNotFoundException"</span>,
    <span class="hljs-attr">"Message"</span>: <span class="hljs-string">"Could not load file or assembly 'Xbim.Geometry.Engine.dll, Culture=neutral, PublicKeyToken=null'. The system cannot find the file specified."</span>,
    <span class="hljs-attr">"FileName"</span>: <span class="hljs-string">"Xbim.Geometry.Engine.dll, Culture=neutral, PublicKeyToken=null"</span>,
    <span class="hljs-attr">"FusionLog"</span>: <span class="hljs-string">""</span>,
    <span class="hljs-attr">"TargetSite"</span>: <span class="hljs-string">"System.Reflection.RuntimeAssembly nLoad(System.Reflection.AssemblyName, System.String, System.Reflection.RuntimeAssembly, System.Threading.StackCrawlMark ByRef, Boolean, System.Runtime.Loader.AssemblyLoadContext)"</span>,
    <span class="hljs-attr">"StackTrace"</span>: <span class="hljs-string">" at System.Reflection.RuntimeAssembly.nLoad(AssemblyName fileName, String codeBase, RuntimeAssembly assemblyContext, StackCrawlMark&amp; stackMark, Boolean throwOnFileNotFound, AssemblyLoadContext assemblyLoadContext)\r\n at System.Reflection.RuntimeAssembly.InternalLoadAssemblyName(AssemblyName assemblyRef, StackCrawlMark&amp; stackMark, AssemblyLoadContext assemblyLoadContext)\r\n at System.Reflection.Assembly.Load(String assemblyString)\r\n at Xbim.Geometry.Engine.Interop.XbimGeometryEngine..ctor(ILogger`1 logger)"</span>,
    <span class="hljs-attr">"Data"</span>: {},
    <span class="hljs-attr">"Source"</span>: <span class="hljs-string">"System.Private.CoreLib"</span>,
    <span class="hljs-attr">"HResult"</span>: <span class="hljs-number">-2147024894</span><font></font>
  },<font></font>
  <span class="hljs-attr">"Source"</span>: <span class="hljs-string">"Xbim.Geometry.Engine.Interop"</span>,
  <span class="hljs-attr">"HResult"</span>: <span class="hljs-number">-2146232799</span>
}</code></pre></div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Uma sess√£o de pesquisa ativa e leitura cuidadosa me mostrou que eu era extremamente desatento:</font></font><br>
<blockquote>Recently at work, we were evaluating a few options to render building models in the browser. Building Information Modeling (BIM) in interoperability scenarios is done via Industry Foundation Classes, mostly in the STEP Physical File format. The schema is quite huge and complex with all the things you have to consider, so we were glad to find the xBim open source project on GitHub. They've got both projects to visualize building models in the browser with WebGL as well as conversion tools to create the binary-formatted geometry mesh. To achieve that, native C++ libraries are dynamically loaded (so no .Net Core compatibility) which must be present in the bin folder. The C++ libraries are expected either in the same folder as the application binaries or in a x64 (or x86, respectively) sub folder (See <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">here</a> for more details). In regular projects, the xBim.Geometry NuGet package adds a build task to copy the dlls into the build output folder, but this doesn't work with the new tooling. You can, however, get it to work in Visual Studio 2015 by taking care of supplying the interop dlls yourself.</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E dificuldades semelhantes n√£o s√£o apenas para mim. </font><font style="vertical-align: inherit;">Muitas pessoas querem o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">xBIM no .Net Core</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N√£o √© cr√≠tico, mas muda muito ... Tudo </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se resume</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √† incapacidade de carregar o </font><i><font style="vertical-align: inherit;">Xbim.Geometry.Engine64.dll normalmente</font></i><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Voc√™ precisa ter </font></font><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vc_redist.x64.exe</font></font></a></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> na m√°quina </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Quais s√£o as minhas op√ß√µes? </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A primeira coisa que pensei: ‚ÄúUm cont√™iner do Windows com um .NET Framework completo pode ser usado? </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entregue o Microsoft Visual C ++ Redistributable para Visual Studio 2015, 2017 e 2019 neste cont√™iner e tudo ficar√° bem? ‚Äù </font><font style="vertical-align: inherit;">Eu tentei isso:</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Teste a imagem do Windows para a janela de encaixe:</font></font></b>
                        <div class="spoiler_text"> .Net Core :<br>
<br>
<pre><code class="xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">TargetFramework</span>&gt;</span>net47<span class="hljs-tag">&lt;/<span class="hljs-name">TargetFramework</span>&gt;</span></code></pre><br>
Dockerfile:<br>
<br>
<pre><code class="powershell hljs">FROM microsoft/dotnet<span class="hljs-literal">-framework</span>:<span class="hljs-number">4.7</span><font></font>
WORKDIR /bimlibconverter<font></font>
<span class="hljs-built_in">COPY</span> lib/VC_redist.x64.exe /VC_redist.x64.exe<font></font>
RUN C:\VC_redist.x64.exe /quiet /install<font></font>
<span class="hljs-built_in">COPY</span> bin/Release .<font></font>
ENTRYPOINT [<span class="hljs-string">"MyConverter.exe"</span>]</code></pre></div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bem, funcionou ... Est√° vivo! </font><font style="vertical-align: inherit;">Mas. </font><font style="vertical-align: inherit;">Mas e a nossa m√°quina Linux host com docker? </font><font style="vertical-align: inherit;">N√£o funcionar√° para direcionar um cont√™iner com uma imagem no </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows Server Core</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para ele </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Preciso sair ...</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Compromisso e desfecho</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Outra pesquisa na Web me levou a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">um artigo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Nele, o autor requer uma implementa√ß√£o semelhante:</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para piorar as coisas: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
todos os bin√°rios s√£o de 32 bits (x86). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alguns requerem componentes de tempo de execu√ß√£o redistribu√≠veis visuais do C ++. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alguns requerem o tempo de execu√ß√£o do .NET. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alguns precisam de um sistema de janelas, apesar de usarmos apenas a interface da linha de comandos (CLI).</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A publica√ß√£o descreve o potencial para a execu√ß√£o de aplicativos Windows no wine em um cont√™iner Linux. </font><font style="vertical-align: inherit;">Curioso, eu decidi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ap√≥s alguns testes, bugs e adi√ß√µes, o Dockerfile foi recebido:</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Imagem de janela de encaixe baseada no Ubuntu com Wine, .Net Framework e vcredist a bordo:</font></font></b>
                        <div class="spoiler_text"><pre><code class="powershell hljs"><font></font>
FROM ubuntu:latest<font></font>
<span class="hljs-comment">#  x86</span>
RUN dpkg -<span class="hljs-literal">-add</span><span class="hljs-literal">-architecture</span> i386 \<font></font>
    &amp;&amp; apt<span class="hljs-literal">-get</span> update \
    <span class="hljs-comment">#   </span>
    &amp;&amp; apt<span class="hljs-literal">-get</span> install <span class="hljs-literal">-qfy</span> -<span class="hljs-literal">-install</span><span class="hljs-literal">-recommends</span> \<font></font>
        software<span class="hljs-literal">-properties</span><span class="hljs-literal">-common</span> \<font></font>
        gnupg2 \<font></font>
        <span class="hljs-built_in">wget</span> \<font></font>
        xvfb \<font></font>
        cabextract \<font></font>
    <span class="hljs-comment">#  Wine</span>
    &amp;&amp; <span class="hljs-built_in">wget</span> <span class="hljs-literal">-nv</span> https://dl.winehq.org/wine<span class="hljs-literal">-builds</span>/winehq.key \<font></font>
    &amp;&amp; apt<span class="hljs-literal">-key</span> add winehq.key \<font></font>
    &amp;&amp; apt<span class="hljs-literal">-add</span><span class="hljs-literal">-repository</span> <span class="hljs-string">'deb https://dl.winehq.org/wine-builds/ubuntu/ bionic main'</span> \
    <span class="hljs-comment">#     Wine</span>
    &amp;&amp; <span class="hljs-built_in">add-apt</span><span class="hljs-literal">-repository</span> ppa:cybermax<span class="hljs-literal">-dexter</span>/sdl2<span class="hljs-literal">-backport</span> \
    <span class="hljs-comment">#  Wine</span>
    &amp;&amp; apt<span class="hljs-literal">-get</span> install <span class="hljs-literal">-qfy</span> -<span class="hljs-literal">-install</span><span class="hljs-literal">-recommends</span> \<font></font>
        winehq<span class="hljs-literal">-staging</span> \<font></font>
        winbind \<font></font>
    <span class="hljs-comment"># </span>
    &amp;&amp; apt<span class="hljs-literal">-get</span> <span class="hljs-literal">-y</span> clean \<font></font>
    &amp;&amp; <span class="hljs-built_in">rm</span> <span class="hljs-literal">-rf</span> \<font></font>
      /var/lib/apt/lists/* \<font></font>
      /usr/share/doc \<font></font>
      /usr/share/doc<span class="hljs-literal">-base</span> \<font></font>
      /usr/share/<span class="hljs-built_in">man</span> \<font></font>
      /usr/share/locale \<font></font>
      /usr/share/zoneinfo<font></font>
<span class="hljs-comment">#    Wine</span>
ENV WINEDEBUG=fixme<span class="hljs-literal">-all</span><font></font>
ENV WINEPREFIX=/root/.net<font></font>
ENV WINEARCH=win64<font></font>
<span class="hljs-comment">#  Wine</span><font></font>
RUN winecfg \<font></font>
    <span class="hljs-comment"># winetricks,   .Net Framework  </span>
    &amp;&amp; <span class="hljs-built_in">wget</span> https://raw.githubusercontent.com/Winetricks/winetricks/master/src/winetricks \
    <span class="hljs-literal">-O</span> /usr/local/bin/winetricks \<font></font>
    &amp;&amp; chmod +x /usr/local/bin/winetricks \<font></font>
<span class="hljs-comment"># </span>
    &amp;&amp; apt<span class="hljs-literal">-get</span> <span class="hljs-literal">-y</span> clean \<font></font>
    &amp;&amp; <span class="hljs-built_in">rm</span> <span class="hljs-literal">-rf</span> \<font></font>
      /var/lib/apt/lists/* \<font></font>
      /usr/share/doc \<font></font>
      /usr/share/doc<span class="hljs-literal">-base</span> \<font></font>
      /usr/share/<span class="hljs-built_in">man</span> \<font></font>
      /usr/share/locale \<font></font>
      /usr/share/zoneinfo \<font></font>
    <span class="hljs-comment"># Wine   </span>
    &amp;&amp; wineboot <span class="hljs-literal">-u</span> &amp;&amp; winetricks <span class="hljs-literal">-q</span> dotnet472 &amp;&amp; xvfb<span class="hljs-literal">-run</span> winetricks <span class="hljs-literal">-q</span> vcrun2015<font></font>
<font></font>
WORKDIR /root/.net/drive_c/myconverter/<font></font>
<font></font>
<span class="hljs-comment">#  </span>
<span class="hljs-built_in">COPY</span> /bin/Release/ /root/.net/drive_c/myconverter/<font></font>
<font></font>
ENTRYPOINT [<span class="hljs-string">"wine"</span>, <span class="hljs-string">"MyConverter.exe"</span>]
</code></pre><br>
UPD:        .   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">rueler</a><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A constru√ß√£o n√£o √© r√°pida, mas termina com sucesso. </font><font style="vertical-align: inherit;">Eu tento, verifique. </font><font style="vertical-align: inherit;">Trabalho!</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Resultados, conclus√µes, pensamentos</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Funcionou. </font><font style="vertical-align: inherit;">A sa√≠da √© uma imagem do Linux para o cont√™iner do docker. </font><font style="vertical-align: inherit;">√â "inchado" (~ 5,2 GB), mas √© iniciado rapidamente e por dentro executa um aplicativo de console do Windows no .Net Framework 4.7, que ouve RabbitMQ, grava logs no </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Graylog</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , baixa e carrega arquivos no / no Minio. </font><font style="vertical-align: inherit;">Vou atualizar o aplicativo pela API do docker remoto. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A solu√ß√£o para a tarefa dedicada utilit√°ria √© implementada. </font><font style="vertical-align: inherit;">Talvez, e muito provavelmente, n√£o seja universal. </font><font style="vertical-align: inherit;">Mas, em princ√≠pio, fiquei satisfeito. </font><font style="vertical-align: inherit;">Talvez algu√©m venha a calhar tamb√©m. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Obrigado pela leitura. </font><font style="vertical-align: inherit;">Eu escrevo no Habr pela primeira vez. </font><font style="vertical-align: inherit;">Vejo voc√™ nos coment√°rios.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt498378/index.html">An√∫ncio da Escola Noturna de Slurm pela Agile</a></li>
<li><a href="../pt498380/index.html">Janela de Overton em a√ß√£o: como uma pandemia √© usada para limitar nossa liberdade</a></li>
<li><a href="../pt498390/index.html">IAR + Clion = amizade</a></li>
<li><a href="../pt498392/index.html">18 recursos do GitLab s√£o de c√≥digo aberto</a></li>
<li><a href="../pt498394/index.html">7 an√°logos gratuitos de Screaming Frog e Netpeak Spider</a></li>
<li><a href="../pt498398/index.html">Desenvolvedores KOMPAS - designers ou programadores?</a></li>
<li><a href="../pt498402/index.html">Glicose e o que √© consumido</a></li>
<li><a href="../pt498404/index.html">A videoconfer√™ncia √© f√°cil e gr√°tis</a></li>
<li><a href="../pt498406/index.html">Como a personalidade de um jovem programador brilhante foi destru√≠da</a></li>
<li><a href="../pt498410/index.html">Vivaldi para PC e Vivaldi para Android - Jogo em equipe com pontua√ß√£o 3.0</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>