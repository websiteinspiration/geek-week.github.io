<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘¨ğŸ¿â€ğŸ”¬ â›©ï¸ ğŸ‘¶ğŸ¼ å…·æœ‰è™šæ‹ŸèƒŒæ™¯å’Œå¼€æºå·¥å…·çš„è§†é¢‘é€šè¯ ğŸ›€ğŸ¾ ğŸ¤·ğŸ¼ ğŸ˜€</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ç°åœ¨ï¼Œç”±äºCOVID-19ï¼Œæˆ‘ä»¬ä¸­çš„è®¸å¤šäººè¢«éš”ç¦»äº†ï¼Œè§†é¢‘é€šè¯æ¯”ä»¥å‰æ›´åŠ é¢‘ç¹ã€‚ç‰¹åˆ«æ˜¯ï¼ŒZOOMæœåŠ¡çªç„¶å˜å¾—éå¸¸æµè¡Œã€‚æœ€æœ‰è¶£çš„ç¼©æ”¾åŠŸèƒ½å¯èƒ½æ˜¯å¯¹è™šæ‹ŸèƒŒæ™¯çš„æ”¯æŒã€‚å®ƒå…è®¸ç”¨æˆ·ä»¥ä»»ä½•å›¾åƒæˆ–è§†é¢‘äº¤äº’åœ°æ›¿æ¢å…¶èƒŒåçš„èƒŒæ™¯ã€‚ 
 
 
 
 åœ¨Kubernetesä¸Šçš„å¼€æºä¼šè®®ä¸Šï¼Œæˆ‘åœ¨å·¥ä½œä¸­ä½¿ç”¨Zoomå·²æœ‰å¾ˆé•¿æ—¶é—´äº†ï¼Œé€š...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>å…·æœ‰è™šæ‹ŸèƒŒæ™¯å’Œå¼€æºå·¥å…·çš„è§†é¢‘é€šè¯</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/498458/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨ï¼Œ</font><font style="vertical-align: inherit;">ç”±äº</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">COVID-19</font></a><font style="vertical-align: inherit;">ï¼Œ</font><font style="vertical-align: inherit;">æˆ‘ä»¬ä¸­çš„è®¸å¤šäººè¢«</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">éš”ç¦»äº†</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œè§†é¢‘é€šè¯æ¯”ä»¥å‰æ›´åŠ é¢‘ç¹ã€‚ç‰¹åˆ«æ˜¯ï¼Œ</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">ZOOM</font></a><font style="vertical-align: inherit;">æœåŠ¡</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">çªç„¶</font></a><font style="vertical-align: inherit;">å˜å¾—éå¸¸æµè¡Œã€‚æœ€æœ‰è¶£çš„ç¼©æ”¾åŠŸèƒ½å¯èƒ½æ˜¯å¯¹</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">è™šæ‹ŸèƒŒæ™¯çš„</font></a><font style="vertical-align: inherit;">æ”¯æŒ</font><font style="vertical-align: inherit;">ã€‚å®ƒå…è®¸ç”¨æˆ·ä»¥ä»»ä½•å›¾åƒæˆ–è§†é¢‘äº¤äº’åœ°æ›¿æ¢å…¶èƒŒåçš„èƒŒæ™¯ã€‚</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"></font></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><div style="text-align:center;"><img src="https://habrastorage.org/webt/wf/46/1p/wf461pvjwrwmpzvkvnhyvzcf8xy.jpeg"></div></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨Kubernetesä¸Šçš„å¼€æºä¼šè®®ä¸Šï¼Œæˆ‘åœ¨å·¥ä½œä¸­ä½¿ç”¨Zoomå·²æœ‰å¾ˆé•¿æ—¶é—´äº†ï¼Œé€šå¸¸æ˜¯ä½¿ç”¨ä¼ä¸šç¬”è®°æœ¬ç”µè„‘æ¥å®ç°çš„ã€‚ç°åœ¨ï¼Œå½“æˆ‘åœ¨å®¶å·¥ä½œæ—¶ï¼Œæˆ‘å€¾å‘äºä½¿ç”¨åŠŸèƒ½æ›´å¼ºå¤§ï¼Œæ›´æ–¹ä¾¿çš„ä¸ªäººå°å¼è®¡ç®—æœºæ¥è§£å†³æˆ‘çš„ä¸€äº›å¼€æºä»»åŠ¡ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¸å¹¸çš„æ˜¯ï¼Œç¼©æ”¾ä»…æ”¯æŒç§°ä¸ºâ€œ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è‰²åº¦é”®</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> â€æˆ–â€œ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»¿å±</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> â€ </font><font style="vertical-align: inherit;">çš„èƒŒæ™¯å»é™¤æ–¹æ³•</font><font style="vertical-align: inherit;">ã€‚è¦ä½¿ç”¨æ­¤æ–¹æ³•ï¼Œå¿…é¡»ç”¨æŸç§çº¯è‰²ï¼ˆç†æƒ³æƒ…å†µä¸‹ä¸ºç»¿è‰²ï¼‰è¡¨ç¤ºèƒŒæ™¯å¹¶å‡åŒ€ç…§æ˜ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç”±äºæˆ‘æ²¡æœ‰ç»¿å±ï¼Œå› æ­¤æˆ‘å†³å®šç®€å•åœ°å®æ–½è‡ªå·±çš„åå°åˆ é™¤ç³»ç»Ÿã€‚å½“ç„¶ï¼Œè¿™æ¯”åœ¨å…¬å¯“ä¸­æ•´ç†ç‰©å“æˆ–ä¸æ–­ä½¿ç”¨å·¥ä½œç”¨çš„ç¬”è®°æœ¬ç”µè„‘è¦å¥½å¾—å¤šã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
äº‹å®è¯æ˜ï¼Œä½¿ç”¨ç°æˆçš„å¼€æºç»„ä»¶å¹¶ç¼–å†™å‡ è¡Œè‡ªå·±çš„ä»£ç ï¼Œæ‚¨å¯ä»¥è·å¾—éå¸¸ä¸é”™çš„ç»“æœã€‚</font></font><br>
<a name="habracut"></a><br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¯»å–ç›¸æœºæ•°æ®</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è®©æˆ‘ä»¬ä»å¤´å¼€å§‹ï¼Œå›ç­”ä»¥ä¸‹é—®é¢˜ï¼šâ€œå¦‚ä½•ä»å°†è¦å¤„ç†çš„ç½‘ç»œæ‘„åƒå¤´ä¸­è·å–è§†é¢‘ï¼Ÿâ€ </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç”±äºæˆ‘åœ¨å®¶ç”¨è®¡ç®—æœºä¸Šä½¿ç”¨Linuxï¼ˆå½“æˆ‘ä¸ç©æ¸¸æˆæ—¶ï¼‰ï¼Œå› æ­¤æˆ‘å†³å®šä½¿ç”¨</font><font style="vertical-align: inherit;">æˆ‘å·²ç»çŸ¥é“</font><font style="vertical-align: inherit;">çš„</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">Open CV </font></a></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pythonç»‘å®š</font></font></a> <font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">é™¤äº†</font><font style="vertical-align: inherit;">ç”¨äºä»ç½‘ç»œæ‘„åƒå¤´è¯»å–æ•°æ®çš„</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">V4L2ç»‘å®š</font></a><font style="vertical-align: inherit;">ä¹‹å¤–</font><font style="vertical-align: inherit;">ï¼Œå®ƒä»¬è¿˜åŒ…æ‹¬æœ‰ç”¨çš„åŸºæœ¬è§†é¢‘å¤„ç†åŠŸèƒ½ã€‚</font><font style="vertical-align: inherit;">
ä»python-opencvä¸­çš„æ‘„åƒå¤´è¯»å–å¸§éå¸¸ç®€å•ï¼š</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">import</span> cv2<font></font>
cap = cv2.VideoCapture(<span class="hljs-string">'/dev/video0'</span>)<font></font>
success, frame = cap.read()<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¸ºäº†æ”¹å–„ä½¿ç”¨ç›¸æœºçš„æ•ˆæœï¼Œæˆ‘åœ¨ä»ç›¸æœºæ‹æ‘„è§†é¢‘ä¹‹å‰åº”ç”¨äº†ä»¥ä¸‹è®¾ç½®ï¼š</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment">#    720p @ 60 FPS</span>
height, width = <span class="hljs-number">720</span>, <span class="hljs-number">1280</span><font></font>
cap.set(cv2.CAP_PROP_FRAME_WIDTH ,width)<font></font>
cap.set(cv2.CAP_PROP_FRAME_HEIGHT,height)<font></font>
cap.set(cv2.CAP_PROP_FPS, <span class="hljs-number">60</span>)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ„Ÿè§‰å¤§å¤šæ•°è§†é¢‘ä¼šè®®ç¨‹åºä¼šå°†è§†é¢‘é™åˆ¶ä¸º720p @ 30 FPSæˆ–æ›´ä½ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯ï¼Œæ— è®ºå¦‚ä½•ï¼Œæˆ‘ä»¬å¯èƒ½æ— æ³•è¯»å–æ¯ä¸€å¸§ã€‚</font><font style="vertical-align: inherit;">è¿™æ ·çš„è®¾ç½®è®¾ç½®ä¸Šé™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å°†å¸§æ•è·æœºåˆ¶ç½®äºä¸€ä¸ªå¾ªç¯ä¸­ã€‚</font><font style="vertical-align: inherit;">ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ä»æ‘„åƒæœºè®¿é—®è§†é¢‘æµäº†ï¼</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;success, frame = cap.read()<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ‚¨å¯ä»¥ä¿å­˜æ¡†æ¶ä»¥è¿›è¡Œæµ‹è¯•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</font></font><br>
<br>
<pre><code class="python hljs">cv2.imwrite(<span class="hljs-string">"test.jpg"</span>, frame)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ­¤åï¼Œæˆ‘ä»¬å¯ä»¥ç¡®ä¿ç›¸æœºæ­£åœ¨å·¥ä½œã€‚</font><font style="vertical-align: inherit;">å¤§ï¼</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/96c/1ea/155/96c1ea155c714c5f1c8ab70f737444f8.jpg"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘å¸Œæœ›ä½ ä¸åå¯¹æˆ‘çš„èƒ¡é¡»</font></font></font></i><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">èƒŒæ™¯æ£€æµ‹</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥è®¿é—®è§†é¢‘æµäº†ï¼Œæˆ‘ä»¬å°†è€ƒè™‘å¦‚ä½•é€šè¿‡æ‰¾åˆ°èƒŒæ™¯æ¥æ›¿æ¢èƒŒæ™¯æ¥æ£€æµ‹èƒŒæ™¯ã€‚ä½†è¿™å·²ç»æ˜¯ä¸€ä¸ªç›¸å½“å›°éš¾çš„ä»»åŠ¡ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å°½ç®¡æœ‰ä¸€ç§æ„Ÿè§‰ï¼ŒZoomçš„åˆ›å»ºè€…ä»æœªè°ˆè®ºè¿‡è¯¥ç¨‹åºå¦‚ä½•ç¡®åˆ‡åœ°æ¶ˆé™¤èƒŒæ™¯ï¼Œä½†ç³»ç»Ÿçš„è¡Œä¸ºæ–¹å¼ä½¿æˆ‘æ€è€ƒäº†å¦‚æœæ²¡æœ‰ç¥ç»ç½‘ç»œï¼Œè¯¥æ€ä¹ˆåŠã€‚å¾ˆéš¾è§£é‡Šï¼Œä½†ç»“æœçœ‹èµ·æ¥å®Œå…¨åƒé‚£æ ·ã€‚æ­¤å¤–ï¼Œæˆ‘å‘ç°äº†ä¸€ç¯‡æœ‰å…³</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microsoft Teams</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¦‚ä½•</font><font style="vertical-align: inherit;">ä½¿ç”¨</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">å·ç§¯ç¥ç»ç½‘ç»œ</font></a><font style="vertical-align: inherit;">å®ç°</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">èƒŒæ™¯æ¨¡ç³Š</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çš„æ–‡ç« </font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">
åŸåˆ™ä¸Šï¼Œåˆ›å»ºè‡ªå·±çš„ç¥ç»ç½‘ç»œå¹¶ä¸é‚£ä¹ˆå›°éš¾ã€‚å…³äº</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">å›¾åƒåˆ†å‰²</font></a><font style="vertical-align: inherit;">æœ‰å¾ˆå¤šæ–‡ç« å’Œç§‘å­¦è®ºæ–‡</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">ã€‚</font></a></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚æœ‰å¾ˆå¤šå¼€æºåº“å’Œå·¥å…·ã€‚ä½†æ˜¯æˆ‘ä»¬éœ€è¦ä¸€ä¸ªéå¸¸ä¸“ä¸šçš„æ•°æ®é›†æ‰èƒ½è·å¾—è‰¯å¥½çš„ç»“æœã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç‰¹åˆ«æ˜¯ï¼Œæˆ‘ä»¬éœ€è¦å¤§é‡ç±»ä¼¼äºä»ç½‘ç»œæ‘„åƒå¤´è·å¾—çš„å›¾åƒï¼Œå¹¶åœ¨å‰æ™¯ä¸­å®Œç¾å‘ˆç°äººçš„ç…§ç‰‡ã€‚æ­¤ç±»å›¾ç‰‡çš„æ¯ä¸ªåƒç´ åº”æ ‡è®°ä¸ºä¸èƒŒæ™¯ä¸åŒã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å»ºç«‹æ­¤ç±»æ•°æ®é›†ä»¥å‡†å¤‡è®­ç»ƒç¥ç»ç½‘ç»œå¯èƒ½ä¸éœ€è¦å¤ªå¤šçš„å·¥ä½œã€‚è¿™æ˜¯ç”±äºä»¥ä¸‹äº‹å®ï¼šæ¥è‡ªGoogleçš„ç ”ç©¶äººå‘˜å›¢é˜Ÿå·²ç»å°½äº†æœ€å¤§çš„åŠªåŠ›ï¼Œå¹¶å°†é¢„å…ˆè®­ç»ƒçš„ç¥ç»ç½‘ç»œç”¨äºç»†åˆ†äººå‘˜ï¼Œå¹¶å°†å…¶æŠ•å…¥å¼€æºã€‚è¯¥ç½‘ç»œç§°ä¸º</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BodyPix</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚æ•ˆæœå¾ˆå¥½ï¼</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç°åœ¨ä»…ä»¥é€‚ç”¨äº</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">TensorFlow.js</font></a><font style="vertical-align: inherit;">çš„å½¢å¼æä¾›BodyPix</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚ç»“æœï¼Œæœ€ç®€å•çš„æ–¹æ³•æ˜¯ä½¿ç”¨</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">body-pix-node</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åº“</font><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¸ºäº†åŠ å¿«</font><font style="vertical-align: inherit;">æµè§ˆå™¨ä¸­</font><font style="vertical-align: inherit;">çš„</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç½‘ç»œè¾“å‡º</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼ˆé¢„æµ‹ï¼‰ï¼Œæœ€å¥½ä½¿ç”¨</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WebGL</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åç«¯ï¼Œä½†æ˜¯åœ¨</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Node.js</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç¯å¢ƒä¸­ï¼Œ</font><font style="vertical-align: inherit;">æ‚¨å¯ä»¥ä½¿ç”¨</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tensorflow GPUåç«¯</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼ˆè¯·æ³¨æ„ï¼Œä¸ºæ­¤æ‚¨å°†éœ€è¦</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NVIDIA</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æä¾›çš„è§†é¢‘å¡</font><font style="vertical-align: inherit;">ï¼‰ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¸ºäº†ç®€åŒ–é¡¹ç›®è®¾ç½®ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä¸€ä¸ªå°çš„å®¹å™¨åŒ–ç¯å¢ƒï¼Œè¯¥ç¯å¢ƒæä¾›TensorFlow GPUå’ŒNode.jsã€‚ä¸</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nvidia-dockerä¸€èµ·ä½¿ç”¨</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-æ¯”è‡ªå·±æ”¶é›†è®¡ç®—æœºä¸Šçš„å¿…è¦ä¾èµ–å…³ç³»å®¹æ˜“å¾—å¤šã€‚</font><font style="vertical-align: inherit;">ä¸ºæ­¤ï¼Œæ‚¨åªéœ€è¦è®¡ç®—æœºä¸Šçš„Dockerå’Œæœ€æ–°çš„å›¾å½¢é©±åŠ¨ç¨‹åºã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿™æ˜¯æ–‡ä»¶çš„å†…å®¹</font></font><code>bodypix/package.json</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<br>
<pre><code class="json hljs">{
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">"name"</span>: <span class="hljs-string">"bodypix"</span>,
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">"version"</span>: <span class="hljs-string">"0.0.1"</span>,
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">"dependencies"</span>: {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">"@tensorflow-models/body-pix"</span>: <span class="hljs-string">"^2.0.5"</span>,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">"@tensorflow/tfjs-node-gpu"</span>: <span class="hljs-string">"^1.7.1"</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;}<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿™æ˜¯æ–‡ä»¶</font></font><code>bodypix/Dockerfile</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment">#  ,   TensorFlow GPU</span>
FROM nvcr.io/nvidia/cuda:<span class="hljs-number">10.0</span>-cudnn7-runtime-ubuntu18<span class="hljs-number">.04</span>
<span class="hljs-comment">#  node</span><font></font>
RUN apt update &amp;&amp; apt install -y curl make build-essential \<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&amp;&amp; curl -sL https://deb.nodesource.com/setup_12.x | bash - \<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&amp;&amp; apt-get -y install nodejs \<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&amp;&amp; mkdir /.npm \<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&amp;&amp; chmod <span class="hljs-number">777</span> /.npm
<span class="hljs-comment"># ,    &nbsp;</span>
<span class="hljs-comment">#   tfjs-node-gpu      GPU :(</span><font></font>
ENV TF_FORCE_GPU_ALLOW_GROWTH=true<font></font>
<span class="hljs-comment">#  node-</span><font></font>
WORKDIR /src<font></font>
COPY package.json /src/<font></font>
RUN npm install<font></font>
<span class="hljs-comment">#      </span><font></font>
COPY app.js /src/<font></font>
ENTRYPOINT node /src/app.js<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç°åœ¨è®©æˆ‘ä»¬è°ˆè°ˆè·å¾—ç»“æœã€‚</font><font style="vertical-align: inherit;">ä½†æˆ‘ç«‹å³è­¦å‘Šæ‚¨ï¼šæˆ‘ä¸æ˜¯Node.jsä¸“å®¶ï¼</font><font style="vertical-align: inherit;">è¿™åªæ˜¯æˆ‘æ™šä¸Šå®éªŒçš„ç»“æœï¼Œæ‰€ä»¥è¯·å¯¹æˆ‘å®½å®¹:-)ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä»¥ä¸‹ç®€å•è„šæœ¬æ­£åœ¨å¿™äºå¤„ç†ä½¿ç”¨HTTP POSTè¯·æ±‚å‘é€åˆ°æœåŠ¡å™¨çš„äºŒè¿›åˆ¶æ©ç å›¾åƒã€‚</font><font style="vertical-align: inherit;">é®ç½©æ˜¯åƒç´ çš„äºŒç»´é˜µåˆ—ã€‚</font><font style="vertical-align: inherit;">é›¶è¡¨ç¤ºçš„åƒç´ æ˜¯èƒŒæ™¯ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿™æ˜¯æ–‡ä»¶ä»£ç </font></font><code>app.js</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> tf = <span class="hljs-built_in">require</span>(<span class="hljs-string">'@tensorflow/tfjs-node-gpu'</span>);
<span class="hljs-keyword">const</span> bodyPix = <span class="hljs-built_in">require</span>(<span class="hljs-string">'@tensorflow-models/body-pix'</span>);
<span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http'</span>);
<span class="hljs-function">(<span class="hljs-params"><span class="hljs-keyword">async</span> (</span>) =&gt;</span> {
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">const</span> net = <span class="hljs-keyword">await</span> bodyPix.load({
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">architecture</span>: <span class="hljs-string">'MobileNetV1'</span>,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">outputStride</span>: <span class="hljs-number">16</span>,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">multiplier</span>: <span class="hljs-number">0.75</span>,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">quantBytes</span>: <span class="hljs-number">2</span>,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;});<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">const</span> server = http.createServer();<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;server.on(<span class="hljs-string">'request'</span>, <span class="hljs-keyword">async</span> (req, res) =&gt; {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">var</span> chunks = [];<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;req.on(<span class="hljs-string">'data'</span>, (chunk) =&gt; {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;chunks.push(chunk);<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;req.on(<span class="hljs-string">'end'</span>, <span class="hljs-keyword">async</span> () =&gt; {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">const</span> image = tf.node.decodeImage(Buffer.concat(chunks));<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;segmentation = <span class="hljs-keyword">await</span> net.segmentPerson(image, {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">flipHorizontal</span>: <span class="hljs-literal">false</span>,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">internalResolution</span>: <span class="hljs-string">'medium'</span>,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">segmentationThreshold</span>: <span class="hljs-number">0.7</span>,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;res.writeHead(<span class="hljs-number">200</span>, { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/octet-stream'</span> });<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;res.write(Buffer.from(segmentation.data));<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;res.end();<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tf.dispose(image);<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;});<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;server.listen(<span class="hljs-number">9000</span>);<font></font>
})();<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¦å°†æ¡†æ¶è½¬æ¢ä¸ºè’™ç‰ˆï¼Œæˆ‘ä»¬å¯ä»¥åœ¨Pythonè„šæœ¬ä¸­ä½¿ç”¨</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">numpy</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¹¶</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¯·æ±‚</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åŒ…</font><font style="vertical-align: inherit;">ï¼š</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_mask</span>(<span class="hljs-params">frame, bodypix_url=<span class="hljs-string">'http://localhost:9000'</span></span>):</span>
&nbsp;&nbsp;&nbsp;&nbsp;_, data = cv2.imencode(<span class="hljs-string">".jpg"</span>, frame)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;r = requests.post(<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;url=bodypix_url,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data=data.tobytes(),<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;headers={<span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/octet-stream'</span>})
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">#     numpy-</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">#     uint8[width * height]   0  1</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;mask = np.frombuffer(r.content, dtype=np.uint8)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;mask = mask.reshape((frame.shape[<span class="hljs-number">0</span>], frame.shape[<span class="hljs-number">1</span>]))
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span> mask
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç»“æœå¤§è‡´å¦‚ä¸‹ã€‚</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e51/7db/e3c/e517dbe3ce6eee99d646a8e4257a627f.jpg"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é®ç½©</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
åœ¨æ‰§è¡Œæ‰€æœ‰æ“ä½œæ—¶ï¼Œæˆ‘é‡åˆ°äº†</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸‹</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸€æ¡æ¨æ–‡ã€‚</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5a5/c4b/4dd/5a5c4b4dda480f0fa58807ec5b89b457.jpg"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»å¯¹æ˜¯è§†é¢‘é€šè¯çš„æœ€ä½³èƒŒæ™¯ï¼Œ</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ç°åœ¨æˆ‘ä»¬æœ‰äº†ä¸€ä¸ªå°†å‰æ™¯ä¸èƒŒæ™¯åˆ†å¼€çš„é®ç½©ï¼Œç”¨å…¶ä»–ä¸œè¥¿æ›¿æ¢èƒŒæ™¯å°†éå¸¸ç®€å•ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»tweetåˆ†æ”¯ä¸­è·å–äº†èƒŒæ™¯å›¾åƒï¼Œå¹¶å°†å…¶å‰ªåˆ‡åå¾—åˆ°äº†16x9çš„å›¾ç‰‡ã€‚</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/900/311/537/900311537df81d74a682ddfd447a85a5.jpg"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">èƒŒæ™¯å›¾ç‰‡</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
åï¼Œæˆ‘åšäº†ä»¥ä¸‹å†…å®¹ï¼š</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment">#    (     16:9)</span>
replacement_bg_raw = cv2.imread(<span class="hljs-string">"background.jpg"</span>)<font></font>
<font></font>
<span class="hljs-comment">#    ,       (width &amp; height   )</span>
width, height = <span class="hljs-number">720</span>, <span class="hljs-number">1280</span><font></font>
replacement_bg = cv2.resize(replacement_bg_raw, (width, height))<font></font>
<font></font>
<span class="hljs-comment">#     ,   </span>
inv_mask = <span class="hljs-number">1</span>-mask
<span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> range(frame.shape[<span class="hljs-number">2</span>]):<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;frame[:,:,c] = frame[:,:,c]*mask + replacement_bg[:,:,c]*inv_mask<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é‚£å°±æ˜¯æˆ‘å¾—åˆ°çš„ã€‚</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/500/fbf/e3b/500fbfe3ba3753878562533ced87ed69.jpg"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ›¿æ¢èƒŒæ™¯çš„ç»“æœ</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
æ­¤è’™ç‰ˆæ˜¾ç„¶ä¸å¤Ÿå‡†ç¡®ï¼Œå…¶åŸå› æ˜¯æˆ‘ä»¬åœ¨è®¾ç½®BodyPixæ—¶è¿›è¡Œçš„æ€§èƒ½æŠ˜è¡·ã€‚</font><font style="vertical-align: inherit;">æ€»çš„æ¥è¯´ï¼Œå°½ç®¡ä¸€åˆ‡çœ‹èµ·æ¥éƒ½å¯ä»¥å®¹å¿ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä½†æ˜¯ï¼Œå½“æˆ‘çœ‹è¿™ä¸ªèƒŒæ™¯æ—¶ï¼Œä¸€ä¸ªä¸»æ„æµ®ç°åœ¨æˆ‘çš„è„‘æµ·ã€‚</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ‰è¶£çš„å®éªŒ</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»æ‰¾åˆ°äº†é®ç½©çš„æ–¹æ³•ï¼Œæˆ‘ä»¬å°†è¯¢é—®å¦‚ä½•æ”¹å–„æ•ˆæœã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ˜¾è€Œæ˜“è§çš„ç¬¬ä¸€æ­¥æ˜¯è½¯åŒ–è’™ç‰ˆçš„è¾¹ç¼˜ã€‚</font><font style="vertical-align: inherit;">ä¾‹å¦‚ï¼Œå¯ä»¥è¿™æ ·å®Œæˆï¼š</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">post_process_mask</span>(<span class="hljs-params">mask</span>):</span>
&nbsp;&nbsp;&nbsp;&nbsp;mask = cv2.dilate(mask, np.ones((<span class="hljs-number">10</span>,<span class="hljs-number">10</span>), np.uint8) , iterations=<span class="hljs-number">1</span>)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;mask = cv2.erode(mask, np.ones((<span class="hljs-number">10</span>,<span class="hljs-number">10</span>), np.uint8) , iterations=<span class="hljs-number">1</span>)
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span> mask
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿™æ ·å¯ä»¥æ”¹å–„æƒ…å†µï¼Œä½†è¿›å±•ä¸å¤§ã€‚</font><font style="vertical-align: inherit;">è€Œä¸”ç®€å•çš„æ›¿æ¢å¾ˆæ— èŠã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯ï¼Œç”±äºæˆ‘ä»¬è‡ªå·±å®Œæˆäº†æ‰€æœ‰è¿™äº›å·¥ä½œï¼Œå› æ­¤è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥å¯¹å›¾ç‰‡è¿›è¡Œä»»ä½•æ“ä½œï¼Œè€Œä¸ä»…ä»…æ˜¯åˆ é™¤èƒŒæ™¯ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é‰´äºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ã€Šæ˜Ÿçƒå¤§æˆ˜ã€‹çš„è™šæ‹ŸèƒŒæ™¯ï¼Œæˆ‘å†³å®šåˆ›å»ºå…¨æ¯å›¾æ•ˆæœï¼Œä»¥ä½¿å›¾ç‰‡æ›´æœ‰è¶£ã€‚</font><font style="vertical-align: inherit;">æ­¤å¤–ï¼Œè¿™è¿˜å¯ä»¥ä½¿è’™ç‰ˆçš„æ¨¡ç³Šå˜å¾—å¹³æ»‘ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é¦–å…ˆï¼Œæ›´æ–°åå¤„ç†ä»£ç ï¼š</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">post_process_mask</span>(<span class="hljs-params">mask</span>):</span>
&nbsp;&nbsp;&nbsp;&nbsp;mask = cv2.dilate(mask, np.ones((<span class="hljs-number">10</span>,<span class="hljs-number">10</span>), np.uint8) , iterations=<span class="hljs-number">1</span>)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;mask = cv2.blur(mask.astype(float), (<span class="hljs-number">30</span>,<span class="hljs-number">30</span>))
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span> mask
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç°åœ¨ï¼Œè¾¹ç¼˜å˜å¾—æ¨¡ç³Šäº†ã€‚</font><font style="vertical-align: inherit;">å¾ˆå¥½ï¼Œä½†æ˜¯æˆ‘ä»¬ä»ç„¶éœ€è¦åˆ›å»ºå…¨æ¯å›¾æ•ˆæœã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¥½è±åå…¨æ¯å›¾é€šå¸¸å…·æœ‰ä»¥ä¸‹å±æ€§ï¼š</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æµ…è‰²æˆ–å•è‰²å›¾ç‰‡-å¥½åƒæ˜¯ç”±æ˜äº®çš„æ¿€å…‰ç»˜åˆ¶çš„ã€‚</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿™ç§æ•ˆæœè®©äººæƒ³èµ·æ‰«æçº¿æˆ–è¯¸å¦‚ç½‘æ ¼ä¹‹ç±»çš„ä¸œè¥¿-å°±åƒå›¾åƒæ˜¾ç¤ºåœ¨å¤šæ¡å…‰çº¿ä¸­ä¸€æ ·ã€‚</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">â€œå¹»å½±æ•ˆæœâ€-å¥½åƒæŠ•å½±æ˜¯åˆ†å±‚æ‰§è¡Œçš„ï¼Œæˆ–è€…å¥½åƒåœ¨åˆ›å»ºæŠ•å½±æœŸé—´æœªä¿æŒåº”æ˜¾ç¤ºçš„æ­£ç¡®è·ç¦»ã€‚</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ‰€æœ‰è¿™äº›æ•ˆæœéƒ½å¯ä»¥é€æ­¥å®ç°ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é¦–å…ˆï¼Œè¦å°†å›¾åƒç€è‰²ä¸ºè“è‰²é˜´å½±ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ–¹æ³•</font></font><code>applyColorMap</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment">#     -  </span><font></font>
holo = cv2.applyColorMap(frame, cv2.COLORMAP_WINTER)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ¥ä¸‹æ¥-æ·»åŠ ä¸€æ¡å¸¦æœ‰è®©äººæƒ³èµ·åŠè‰²è°ƒçš„æ•ˆæœçš„æ‰«åŠ¨çº¿ï¼š</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment">#    bandLength    10-30%,</span>
<span class="hljs-comment">#    bandGap.</span>
bandLength, bandGap = <span class="hljs-number">2</span>, <span class="hljs-number">3</span>
<span class="hljs-keyword">for</span> y <span class="hljs-keyword">in</span> range(holo.shape[<span class="hljs-number">0</span>]):
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span> y % (bandLength+bandGap) &lt; bandLength:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;holo[y,:,:] = holo[y,:,:] * np.random.uniform(<span class="hljs-number">0.1</span>, <span class="hljs-number">0.3</span>)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬é€šè¿‡å‘å›¾åƒæ·»åŠ å½“å‰æ•ˆæœçš„åç§»åŠ æƒå‰¯æœ¬æ¥å®ç°â€œé¬¼å½±æ•ˆæœâ€ï¼š</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment"># shift_img : https://stackoverflow.com/a/53140617</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">shift_img</span>(<span class="hljs-params">img, dx, dy</span>):</span>
&nbsp;&nbsp;&nbsp;&nbsp;img = np.roll(img, dy, axis=<span class="hljs-number">0</span>)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;img = np.roll(img, dx, axis=<span class="hljs-number">1</span>)
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span> dy&gt;<span class="hljs-number">0</span>:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;img[:dy, :] = <span class="hljs-number">0</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">elif</span> dy&lt;<span class="hljs-number">0</span>:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;img[dy:, :] = <span class="hljs-number">0</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span> dx&gt;<span class="hljs-number">0</span>:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;img[:, :dx] = <span class="hljs-number">0</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">elif</span> dx&lt;<span class="hljs-number">0</span>:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;img[:, dx:] = <span class="hljs-number">0</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span> img<font></font>
<font></font>
<span class="hljs-comment">#    : holo * 0.2 + shifted_holo * 0.8 + 0</span>
holo2 = cv2.addWeighted(holo, <span class="hljs-number">0.2</span>, shift_img(holo1.copy(), <span class="hljs-number">5</span>, <span class="hljs-number">5</span>), <span class="hljs-number">0.8</span>, <span class="hljs-number">0</span>)<font></font>
holo2 = cv2.addWeighted(holo2, <span class="hljs-number">0.4</span>, shift_img(holo1.copy(), <span class="hljs-number">-5</span>, <span class="hljs-number">-5</span>), <span class="hljs-number">0.6</span>, <span class="hljs-number">0</span>)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æœ€åï¼Œæˆ‘ä»¬è¦ä¿ç•™ä¸€äº›åŸå§‹é¢œè‰²ï¼Œå› æ­¤æˆ‘ä»¬å°†å…¨æ¯æ•ˆæœä¸åŸå§‹å¸§ç»“åˆåœ¨ä¸€èµ·ï¼Œè¿›è¡Œç±»ä¼¼äºæ·»åŠ â€œå¹»å½±æ•ˆæœâ€çš„æ“ä½œï¼š</font></font><br>
<br>
<pre><code class="python hljs">holo_done = cv2.addWeighted(img, <span class="hljs-number">0.5</span>, holo2, <span class="hljs-number">0.6</span>, <span class="hljs-number">0</span>)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿™æ˜¯å…·æœ‰å…¨æ¯æ•ˆæœçš„æ¡†æ¶çš„å¤–è§‚ï¼š</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8ba/bda/21c/8babda21c3f11e9fa3867faf65e14c24.jpg"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å…·æœ‰å…¨æ¯æ•ˆæœçš„</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
é•œæ¶æ­¤é•œæ¶æœ¬èº«çœ‹èµ·æ¥éå¸¸ä¸é”™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç°åœ¨ï¼Œè®©æˆ‘ä»¬å°è¯•å°†å…¶ä¸èƒŒæ™¯ç»“åˆèµ·æ¥ã€‚</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/297/7b7/ce4/2977b7ce4f9efdedd6632ffb0a3ad621.jpg"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">èƒŒæ™¯å›¾åƒå åŠ ã€‚</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
å®Œæˆï¼</font><font style="vertical-align: inherit;">ï¼ˆæˆ‘ä¿è¯-è¿™ç§è§†é¢‘çœ‹èµ·æ¥ä¼šæ›´æœ‰è¶£ï¼‰ã€‚</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è§†é¢‘è¾“å‡º</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç°åœ¨æˆ‘å¿…é¡»è¯´ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œé”™è¿‡äº†ä¸€äº›ä¸œè¥¿ã€‚</font><font style="vertical-align: inherit;">äº‹å®æ˜¯ï¼Œæˆ‘ä»¬ä»ç„¶ä¸èƒ½ä½¿ç”¨æ‰€æœ‰è¿™äº›æ¥è¿›è¡Œè§†é¢‘é€šè¯ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfakewebcam</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å’Œ</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">v4l2loopback</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿçš„ç½‘ç»œæ‘„åƒå¤´ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ­¤å¤–ï¼Œæˆ‘ä»¬è®¡åˆ’å°†æ­¤æ‘„åƒå¤´è¿æ¥åˆ°Dockerã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ª</font></font><code>fakecam/requirements.txt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¾èµ–é¡¹æè¿°</font><font style="vertical-align: inherit;">æ–‡ä»¶</font><font style="vertical-align: inherit;">ï¼š</font></font><br>
<br>
<pre><code class="python hljs">numpy==<span class="hljs-number">1.18</span><span class="hljs-number">.2</span>
opencv-python==<span class="hljs-number">4.2</span><span class="hljs-number">.0</span><span class="hljs-number">.32</span>
requests==<span class="hljs-number">2.23</span><span class="hljs-number">.0</span>
pyfakewebcam==<span class="hljs-number">0.1</span><span class="hljs-number">.0</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç°åœ¨</font></font><code>fakecam/Dockerfile</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œä¸ºå®ç°è™šæ‹Ÿç›¸æœºåŠŸèƒ½çš„åº”ç”¨ç¨‹åº</font><font style="vertical-align: inherit;">åˆ›å»ºæ–‡ä»¶</font><font style="vertical-align: inherit;">ï¼š</font></font><br>
<br>
<pre><code class="python hljs">FROM python:<span class="hljs-number">3</span>-buster
<span class="hljs-comment">#   pip</span><font></font>
RUN pip install --upgrade pip<font></font>
<span class="hljs-comment">#   opencv</span><font></font>
RUN apt-get update &amp;&amp; \<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;apt-get install -y \<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`<span class="hljs-comment"># opencv requirements` \</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;libsm6 libxext6 libxrender-dev \<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`<span class="hljs-comment"># opencv video opening requirements` \</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;libv4l-dev<font></font>
<span class="hljs-comment">#    requirements.txt</span><font></font>
WORKDIR /src<font></font>
COPY requirements.txt /src/<font></font>
RUN pip install --no-cache-dir -r /src/requirements.txt<font></font>
<span class="hljs-comment">#   </span><font></font>
COPY background.jpg /data/<font></font>
<span class="hljs-comment">#     (     )</span><font></font>
COPY fake.py /src/<font></font>
ENTRYPOINT python -u fake.py<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç°åœ¨ï¼Œä»å‘½ä»¤è¡Œå®‰è£…v4l2loopbackï¼š</font></font><br>
<br>
<pre><code class="bash hljs">sudo apt install v4l2loopback-dkms
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è®¾ç½®è™šæ‹Ÿæ‘„åƒæœºï¼š</font></font><br>
<br>
<pre><code class="python hljs">sudo modprobe -r v4l2loopback<font></font>
sudo modprobe v4l2loopback devices=<span class="hljs-number">1</span> video_nr=<span class="hljs-number">20</span> card_label=<span class="hljs-string">"v4l2loopback"</span> exclusive_caps=<span class="hljs-number">1</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¸ºäº†ç¡®ä¿æŸäº›åº”ç”¨ç¨‹åºï¼ˆChromeï¼ŒZoomï¼‰çš„åŠŸèƒ½ï¼Œæˆ‘ä»¬éœ€è¦è¿›è¡Œè®¾ç½®</font></font><code>exclusive_caps</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><code>card_label</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è®¾ç½®</font><font style="vertical-align: inherit;">æ­¤æ ‡è®°</font><font style="vertical-align: inherit;">ä»…æ˜¯ä¸ºäº†ç¡®ä¿åœ¨åº”ç”¨ç¨‹åºä¸­é€‰æ‹©ç›¸æœºçš„ä¾¿åˆ©ã€‚</font><font style="vertical-align: inherit;">å¦‚æœç›¸åº”çš„å·ç ä¸å¿™ï¼Œå¹¶ä¸”ä¸å¤ªå¯èƒ½å¿™ï¼Œåˆ™</font><font style="vertical-align: inherit;">æŒ‡ç¤ºå·ç </font></font><code>video_nr=20</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¼šå¯¼è‡´è®¾å¤‡çš„åˆ›å»º</font></font><code>/dev/video20</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç°åœ¨ï¼Œæˆ‘ä»¬å°†å¯¹è„šæœ¬è¿›è¡Œæ›´æ”¹ä»¥åˆ›å»ºè™šæ‹Ÿæ‘„åƒæœºï¼š</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment"># ,  ,   ,   ,  width  height</span>
fake = pyfakewebcam.FakeWebcam(<span class="hljs-string">'/dev/video20'</span>, width, height)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åº”è¯¥æ³¨æ„çš„æ˜¯ï¼ŒpyfakewebcamæœŸæœ›å…·æœ‰RGBé€šé“ï¼ˆçº¢è‰²ï¼Œç»¿è‰²ï¼Œè“è‰²-çº¢è‰²ï¼Œç»¿è‰²ï¼Œè“è‰²ï¼‰çš„å›¾åƒï¼Œè€ŒOpen CVåˆ™æŒ‰BGRé€šé“ï¼ˆè“è‰²ï¼Œç»¿è‰²ï¼Œçº¢è‰²ï¼‰çš„é¡ºåºå·¥ä½œã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ‚¨å¯ä»¥åœ¨è¾“å‡ºå¸§ä¹‹å‰è§£å†³æ­¤é—®é¢˜ï¼Œç„¶ååƒè¿™æ ·å‘é€å¸§ï¼š</font></font><br>
<br>
<pre><code class="python hljs">frame = cv2.cvtColor(frame, cv2.COLOR_BGR2RGB)<font></font>
fake.schedule_frame(frame)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿™æ˜¯å®Œæ•´çš„è„šæœ¬ä»£ç </font></font><code>fakecam/fake.py</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> cv2
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
<span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">import</span> pyfakewebcam<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_mask</span>(<span class="hljs-params">frame, bodypix_url=<span class="hljs-string">'http://localhost:9000'</span></span>):</span>
&nbsp;&nbsp;&nbsp;&nbsp;_, data = cv2.imencode(<span class="hljs-string">".jpg"</span>, frame)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;r = requests.post(<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;url=bodypix_url,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data=data.tobytes(),<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;headers={<span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/octet-stream'</span>})<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;mask = np.frombuffer(r.content, dtype=np.uint8)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;mask = mask.reshape((frame.shape[<span class="hljs-number">0</span>], frame.shape[<span class="hljs-number">1</span>]))
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span> mask<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">post_process_mask</span>(<span class="hljs-params">mask</span>):</span>
&nbsp;&nbsp;&nbsp;&nbsp;mask = cv2.dilate(mask, np.ones((<span class="hljs-number">10</span>,<span class="hljs-number">10</span>), np.uint8) , iterations=<span class="hljs-number">1</span>)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;mask = cv2.blur(mask.astype(float), (<span class="hljs-number">30</span>,<span class="hljs-number">30</span>))
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span> mask<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">shift_image</span>(<span class="hljs-params">img, dx, dy</span>):</span>
&nbsp;&nbsp;&nbsp;&nbsp;img = np.roll(img, dy, axis=<span class="hljs-number">0</span>)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;img = np.roll(img, dx, axis=<span class="hljs-number">1</span>)
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span> dy&gt;<span class="hljs-number">0</span>:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;img[:dy, :] = <span class="hljs-number">0</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">elif</span> dy&lt;<span class="hljs-number">0</span>:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;img[dy:, :] = <span class="hljs-number">0</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span> dx&gt;<span class="hljs-number">0</span>:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;img[:, :dx] = <span class="hljs-number">0</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">elif</span> dx&lt;<span class="hljs-number">0</span>:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;img[:, dx:] = <span class="hljs-number">0</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span> img<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">hologram_effect</span>(<span class="hljs-params">img</span>):</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">#    </span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;holo = cv2.applyColorMap(img, cv2.COLORMAP_WINTER)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">#   </span>
&nbsp;&nbsp;&nbsp;&nbsp;bandLength, bandGap = <span class="hljs-number">2</span>, <span class="hljs-number">3</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">for</span> y <span class="hljs-keyword">in</span> range(holo.shape[<span class="hljs-number">0</span>]):
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span> y % (bandLength+bandGap) &lt; bandLength:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;holo[y,:,:] = holo[y,:,:] * np.random.uniform(<span class="hljs-number">0.1</span>, <span class="hljs-number">0.3</span>)
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">#  </span>
&nbsp;&nbsp;&nbsp;&nbsp;holo_blur = cv2.addWeighted(holo, <span class="hljs-number">0.2</span>, shift_image(holo.copy(), <span class="hljs-number">5</span>, <span class="hljs-number">5</span>), <span class="hljs-number">0.8</span>, <span class="hljs-number">0</span>)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;holo_blur = cv2.addWeighted(holo_blur, <span class="hljs-number">0.4</span>, shift_image(holo.copy(), <span class="hljs-number">-5</span>, <span class="hljs-number">-5</span>), <span class="hljs-number">0.6</span>, <span class="hljs-number">0</span>)
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">#     </span>
&nbsp;&nbsp;&nbsp;&nbsp;out = cv2.addWeighted(img, <span class="hljs-number">0.5</span>, holo_blur, <span class="hljs-number">0.6</span>, <span class="hljs-number">0</span>)
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span> out<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_frame</span>(<span class="hljs-params">cap, background_scaled</span>):</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;_, frame = cap.read()<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">#      (  ,   )</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">#       </span>
&nbsp;&nbsp;&nbsp;&nbsp;mask = <span class="hljs-literal">None</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">while</span> mask <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">try</span>:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mask = get_mask(frame)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">except</span> requests.RequestException:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print(<span class="hljs-string">"mask request failed, retrying"</span>)
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment"># -   </span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;mask = post_process_mask(mask)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;frame = hologram_effect(frame)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">#     </span>
&nbsp;&nbsp;&nbsp;&nbsp;inv_mask = <span class="hljs-number">1</span>-mask
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> range(frame.shape[<span class="hljs-number">2</span>]):<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;frame[:,:,c] = frame[:,:,c]*mask + background_scaled[:,:,c]*inv_mask<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span> frame<font></font>
<font></font>
<span class="hljs-comment">#     </span>
cap = cv2.VideoCapture(<span class="hljs-string">'/dev/video0'</span>)<font></font>
height, width = <span class="hljs-number">720</span>, <span class="hljs-number">1280</span><font></font>
cap.set(cv2.CAP_PROP_FRAME_WIDTH, width)<font></font>
cap.set(cv2.CAP_PROP_FRAME_HEIGHT, height)<font></font>
cap.set(cv2.CAP_PROP_FPS, <span class="hljs-number">60</span>)<font></font>
<font></font>
<span class="hljs-comment">#   </span>
fake = pyfakewebcam.FakeWebcam(<span class="hljs-string">'/dev/video20'</span>, width, height)<font></font>
<font></font>
<span class="hljs-comment">#    </span>
background = cv2.imread(<span class="hljs-string">"/data/background.jpg"</span>)<font></font>
background_scaled = cv2.resize(background, (width, height))<font></font>
<font></font>
<span class="hljs-comment">#    </span>
<span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;frame = get_frame(cap, background_scaled)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">#    RGB-</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;frame = cv2.cvtColor(frame, cv2.COLOR_BGR2RGB)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;fake.schedule_frame(frame)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç°åœ¨æ”¶é›†å›¾åƒï¼š</font></font><br>
<br>
<pre><code class="python hljs">docker build -t bodypix ./bodypix<font></font>
docker build -t fakecam ./fakecam<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿è¡Œå®ƒä»¬ï¼š</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment">#  </span><font></font>
docker network create --driver bridge fakecam<font></font>
<span class="hljs-comment">#   bodypix</span><font></font>
docker run -d \<font></font>
&nbsp;&nbsp;--name=bodypix \<font></font>
&nbsp;&nbsp;--network=fakecam \<font></font>
&nbsp;&nbsp;--gpus=all --shm-size=<span class="hljs-number">1</span>g --ulimit memlock=<span class="hljs-number">-1</span> --ulimit stack=<span class="hljs-number">67108864</span> \<font></font>
&nbsp;&nbsp;bodypix<font></font>
<span class="hljs-comment">#  ,  ,      ,  ,</span>
<span class="hljs-comment">#           </span>
<span class="hljs-comment"># ,     `sudo groupadd $USER video`</span><font></font>
docker run -d \<font></font>
&nbsp;&nbsp;--name=fakecam \<font></font>
&nbsp;&nbsp;--network=fakecam \<font></font>
&nbsp;&nbsp;-p <span class="hljs-number">8080</span>:<span class="hljs-number">8080</span> \<font></font>
&nbsp;&nbsp;-u <span class="hljs-string">"$$(id -u):$$(getent group video | cut -d: -f3)"</span> \<font></font>
&nbsp;&nbsp;$$(find /dev -name <span class="hljs-string">'video*'</span> -printf <span class="hljs-string">"--device %p "</span>) \<font></font>
&nbsp;&nbsp;fakecam<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åªéœ€è€ƒè™‘åœ¨ä½¿ç”¨ä»»ä½•åº”ç”¨ç¨‹åºæ—¶å¿…é¡»åœ¨æ‰“å¼€ç›¸æœºä¹‹å‰å°±å¼€å§‹æ­¤æ“ä½œã€‚</font><font style="vertical-align: inherit;">åœ¨Zoomæˆ–å…¶ä»–ä½ç½®ï¼Œæ‚¨éœ€è¦é€‰æ‹©ä¸€ä¸ªæ‘„åƒæœº</font></font><code>v4l2loopback</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ </font></font><code>/dev/video20</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ‘˜è¦</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿™æ˜¯æ¼”ç¤ºæˆ‘çš„å·¥ä½œæˆæœçš„å‰ªè¾‘ã€‚</font></font><br>
<br>
<div class="oembed"><div><div style="left: 0; width: 100%; height: 0; position: relative; padding-bottom: 56.25%;"><video controls="" style="top: 0; left: 0; width: 100%; height: 100%; position: absolute;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒHTML5è§†é¢‘ã€‚</font></font><source src="https://elder.dev/posts/open-source-virtual-background/holo-demo.webm" type="video/webm"></video></div></div></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">èƒŒæ™¯å˜åŒ–ç»“æœ</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
è§ï¼</font><font style="vertical-align: inherit;">æˆ‘æ˜¯ä»åƒç¦§çŒé¹°å·å¬é›†çš„ï¼Œä½¿ç”¨çš„æ˜¯å¼€æ”¾æºä»£ç æŠ€æœ¯å †æ ˆï¼Œå¯ä»¥ç”¨äºç›¸æœºï¼</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘æ‰€åšçš„ï¼Œæˆ‘çœŸçš„å¾ˆå–œæ¬¢ã€‚</font><font style="vertical-align: inherit;">åœ¨ä¸‹ä¸€æ¬¡è§†é¢‘ä¼šè®®ä¸Šï¼Œæˆ‘ä¸€å®šä¼šåˆ©ç”¨æ‰€æœ‰è¿™äº›ä¼˜åŠ¿ã€‚</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">äº²çˆ±çš„è¯»è€…ä»¬ï¼</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ‚¨æ˜¯å¦æ‰“ç®—å°†è§†é¢‘é€šè¯åçš„å¯è§å†…å®¹æ›´æ”¹ä¸ºå…¶ä»–å†…å®¹ï¼Ÿ</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><img src="https://habrastorage.org/webt/iq/fi/b4/iqfib45pgphfrxv--zfemt0qnmw.jpeg"></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN498446/index.html">å·¥ä½œé—®é¢˜ï¼šæƒ³è±¡ä¸­çš„ç¨³å®šæ€§ï¼Œé”™è¯¯çš„å¥‰çŒ®å’Œå®šä½</a></li>
<li><a href="../zh-CN498450/index.html">MultiSimå†—ä½™-å®ƒæ˜¯ä»€ä¹ˆä»¥åŠå®ƒå¦‚ä½•å·¥ä½œ</a></li>
<li><a href="../zh-CN498452/index.html">Djangoï¼šå›½é™…åŒ–å¿«é€ŸæŒ‡å—</a></li>
<li><a href="../zh-CN498454/index.html">æ‚¨æœ€å–œæ¬¢çš„æ¸¸æˆçš„å¼€å‘è€…çš„æ•…äº‹ï¼Œä»–ä»¬ä¸ºä¹‹æ„Ÿåˆ°éª„å‚²</a></li>
<li><a href="../zh-CN498456/index.html">CSSæ»šåŠ¨æ•æ‰å®è·µ</a></li>
<li><a href="../zh-CN498462/index.html">å¸¦æœ‰æ¨ªå¹…çš„æ— é™æ»šåŠ¨ï¼Œæˆ–è€…å¦‚ä½•å¤„ç†ä¸‰ä¸ªè§†å›¾</a></li>
<li><a href="../zh-CN498466/index.html">æ¿€å…‰å’Œä¼ æ„Ÿå™¨å¦‚ä½•å¸®åŠ©æ³•å®˜ä¿æŒç´§å¼ </a></li>
<li><a href="../zh-CN498472/index.html">å•é¡µåº”ç”¨ç¨‹åºDockeræ˜ åƒ</a></li>
<li><a href="../zh-CN498476/index.html">è¾…åŠ©åŠŸèƒ½ å¦‚ä½•ä½¿æ®‹éšœç”¨æˆ·å¯ä»¥è®¿é—®è¯¥åº”ç”¨ç¨‹åº</a></li>
<li><a href="../zh-CN498478/index.html">ä»€ä¹ˆæ˜¯Windows PowerShellï¼Ÿå®ƒåƒä»€ä¹ˆï¼Ÿç¬¬5éƒ¨åˆ†ï¼šè®¿é—®å¤–éƒ¨å¯¹è±¡</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>