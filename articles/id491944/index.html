<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸš ğŸ‘¨ğŸ¾â€ğŸ”¬ ğŸ§›ğŸ½ Cara menggabungkan dua platform menjadi satu dan tidak menyinggung pengguna. Pengalaman Pengembang Yandex.Kew ğŸ“‚ ğŸ‘¨ğŸ½â€ğŸ¨ ğŸ™ŒğŸ¾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Tahun lalu, layanan TheQuestion bergabung dengan Yandex. Pada saat itu, sudah ada layanan pertanyaan dan jawaban yang serupa - Yandex.Znatoki. Para pe...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Cara menggabungkan dua platform menjadi satu dan tidak menyinggung pengguna. Pengalaman Pengembang Yandex.Kew</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yandex/blog/491944/"><img src="https://habrastorage.org/webt/je/qm/jf/jeqmjfqycb2lqolmutp76tgjrem.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tahun lalu, layanan TheQuestion bergabung dengan Yandex. Pada saat itu, sudah ada layanan pertanyaan dan jawaban yang serupa - Yandex.Znatoki. Para penikmat memiliki audiensi yang besar dan banyak pertanyaan menarik, tetapi tidak ada cukup ahli yang bisa memberikan jawaban berkualitas tinggi untuk pertanyaan-pertanyaan ini. TheQuestion, sebaliknya, memiliki komunitas ahli yang kuat, tetapi tidak memiliki pertanyaan menarik. Langkah logisnya adalah menggabungkan dua layanan untuk mengambil yang terbaik dari masing-masing layanan. Tetapi bagaimana melakukan ini jika setiap layanan memiliki basis teknologi, konten, dan pengguna sendiri?</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hari ini saya akan berbicara tentang bagaimana tim kami memecahkan masalah ini dari sudut pandang teknologi. Anda akan menemukan opsi untuk menggabungkan yang telah kami pertimbangkan dan yang pada akhirnya telah dipilih. Saya akan memberi tahu Anda tentang "swap API", migrasi basis data, profil gabungan dan pengujian backend. Namun - tentang malam bergerak tanpa hak untuk melakukan kesalahan. Anda akan melihat bahwa kami tidak harus bosan.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tugas menggabungkan dua layanan menjadi satu bukanlah hal baru, tetapi ini tidak membuatnya lebih mudah. Sejarah tahu banyak contoh integrasi yang sukses (dan tidak begitu), tetapi, sayangnya, tidak ada "peluru perak" dan instruksi yang jelas "lakukan ini dan semuanya akan berhasil". Semuanya sangat tergantung pada spesifikasi layanan yang digabungkan dan hasil yang diinginkan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam kasus kami, tujuannya adalah ini: </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bahwa semua konten yang pernah ditulis pada masing-masing situs tersedia pada layanan terintegrasi, dan penulisnya dapat mengelolanya.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Jadi, bagaimana Anda menggabungkan dua layanan tanya jawab, yang tampaknya sangat mirip, tetapi pada dasarnya sangat berbeda? Mentransfer konten dan pengguna dari satu layanan ke layanan lainnya sangat mirip dengan pindah dari apartemen lama ke yang baru.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hanya dalam kasus kami, pengguna dapat hidup secara bersamaan di dua apartemen (Penikmat dan TheQuestion), dan Anda perlu dengan hati-hati memindahkannya ke apartemen ketiga. Anda perlu memindahkan semua perabotan, tanaman, kucing, dan bahkan wallpaper ke apartemen baru (yaitu, pertanyaan, jawaban, komentar, suka), dan kemudian undang dia untuk pindah. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bagaimana cara melakukannya? Beberapa opsi segera muncul di pikiran. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Opsi 1. Sangat buruk.</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Mari kita ambil salah satu layanan, transfer semua konten ke yang lain (walaupun ini pun tidak lagi mudah) dan tutup layanan yang asli.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Opsi ini sangat buruk dari sudut pandang pengguna layanan pertama. Kami baru saja menghancurkan rumah lamanya dan memaksanya pindah ke yang baru. Siapa pun tidak akan menyukai sikap ini, dan alih-alih bergerak, ia bisa pergi ke matahari terbenam. Bagi kami, nilai utama adalah komunitas pengguna, jadi kami tidak berencana menyinggung siapa pun. Dan dengan berani beralih ke opsi lain. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Opsi 2. Buruk.</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Mari kita tidak mengubah salah satu layanan, sebagai gantinya, meluncurkan yang baru, terintegrasi, dan kami akan secara berkala menambahkan konten dari dua lainnya untuk itu (misalnya, sekali sehari).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam hal ini, kami sepertinya tidak membuat pengguna lebih buruk, tetapi kami juga tidak melakukan yang lebih baik. Apartemen lamanya tetap tidak berubah, tetapi tidak ada gunanya pindah ke yang baru. Semua tetangga juga tinggal di rumah tua, bunga yang baru dibeli akan diangkut ke apartemen baru hanya setelah sehari. Layanan terpadu seperti itu tidak memiliki peluang untuk menjadi rumah baru. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Opsi 3. Bagus, tetapi kompleks.</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Jangan tutup salah satu layanan, kami akan segera menduplikasi konten dan profil pada layanan terintegrasi, dan orang-orang akan bergerak seiring waktu. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Semua tetangga pengguna (dan bahkan kucing) hidup serentak di rumah lama dan baru. Bunga yang baru saja Anda beli langsung muncul di apartemen baru. Persis apa yang dibutuhkan! Opsi ini adalah yang paling nyaman dari sudut pandang pengguna. Karena itu, kami memilihnya.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mulai bergerak</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apa yang akhirnya kami lakukan dapat dijelaskan dalam beberapa kalimat. </font><font style="vertical-align: inherit;">Kami sepenuhnya mengulangi seluruh backend TheQuestion API berdasarkan pada backend Connoisseurs, sehingga memperoleh backend tunggal yang dapat bekerja dengan dua (dan bahkan tiga) situs sekaligus. </font><font style="vertical-align: inherit;">Frontend TheQuestion tetap hampir tidak berubah, yang berarti bahwa dari sudut pandang pengguna, situs itu sendiri tidak banyak berubah. </font><font style="vertical-align: inherit;">Proyek ini telah menerima nama internal "swap API". </font><font style="vertical-align: inherit;">Tetapi hal pertama yang pertama.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apa yang kami miliki di pintu masuk: dua situs yang sepenuhnya independen. </font><font style="vertical-align: inherit;">Penikmat tinggal di awan bagian dalam Yandex. </font><font style="vertical-align: inherit;">Backend Connoisseurs ditulis dalam Python. </font><font style="vertical-align: inherit;">TheQuestion hidup di awan Microsoft Azure, backend TheQuestion ditulis dalam Go. </font><font style="vertical-align: inherit;">Layanan memiliki skema penyimpanan data yang sangat berbeda dalam database. </font><font style="vertical-align: inherit;">Selain itu, TheQuestion memiliki dua aplikasi seluler (untuk Android dan iOS) yang juga perlu didukung. </font><font style="vertical-align: inherit;">Secara umum, musuh tidak ingin menyatukan kebun binatang seperti itu.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/wh/i0/8z/whi08z8r9v_7vhg13ana4ku_nvu.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tahap 0. Berkendara ke awan Yandex</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sebenarnya, langkah ini tidak diperlukan untuk "plugin API", tetapi secara signifikan menyederhanakan langkah selanjutnya. </font><font style="vertical-align: inherit;">Pada tahap ini, kami sepenuhnya meninggalkan penyimpanan dan fasilitas eksternal. </font><font style="vertical-align: inherit;">TheQuestion mulai menggunakan server DNS Yandex. </font><font style="vertical-align: inherit;">Layanan rentme dipindahkan ke Yandex.Cloud. </font><font style="vertical-align: inherit;">Database dipindahkan ke Yandex Managed Database. </font><font style="vertical-align: inherit;">Selama pindah, kami juga dapat menemukan dan memperbaiki beberapa kesalahan di TheQuestion, misalnya, koneksi tidak tertutup ke Redis dalam kode 2015. </font><font style="vertical-align: inherit;">Sebagai bonus, kami juga menerima kekuatan tambahan untuk TheQuestion.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tahap 1. Migrasi Data</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Terlepas dari opsi mana yang Anda ingin gabungkan layanan, kami harus menggabungkan data dalam hal apa pun. Untuk satu basis data, mereka memutuskan untuk menggunakan PostgreSQL - DBMS ini telah digunakan di dalam Pakar dan TheQuestion. Agar tidak mempersulit proyek, mereka tidak mulai membuat basis ketiga untuk layanan terintegrasi, tetapi hanya mengambil basis data Znatokov dan memperluasnya sehingga bisa menerima semua data TheQuestion. Ini adalah tantangan teknologi besar pertama.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setiap entri di setiap tabel dari database TheQuestion harus dikonversi dan dimasukkan ke dalam Database Pakar. Kemudian - mengkorelasikan setiap kolom dari satu dan basis lainnya. Banyak bidang harus dikonversi secara nontrivial dari satu format ke format lainnya. Jadi, subtugas besar yang terpisah adalah konversi format penyimpanan teks (format aktual penyimpanan pertanyaan atau jawaban) dari QML (TheQuestion) ke Markdown (Experts).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami menyiapkan proses reguler (beberapa kali sehari) untuk mentransfer data baru dari satu basis data ke basis data yang lain, tetapi pada saat yang sama memastikan bahwa data dari TheQuestion tidak ditampilkan di mana pun hingga penyelesaian tahap berikutnya. </font><font style="vertical-align: inherit;">Karena "beberapa kali sehari" jauh dari yang dijanjikan "langsung", dan data bisa dalam keadaan tidak konsisten dengan data yang sama pada TheQuestion, yang akan menyesatkan pengguna. </font><font style="vertical-align: inherit;">Jadi mengapa kita mulai dengan migrasi data jika backend belum siap? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pertama, dengan cara ini kami menstabilkan proses. </font><font style="vertical-align: inherit;">Kedua, mereka mengurangi jumlah data baru yang perlu ditransfer di masa depan, dan ini penting, karena semua konten yang diimpor harus didorong melalui peningkatan kualitas, konten yang tidak pantas, spam, penipuan.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/gc/jp/ld/gcjpldkw8v-mv2fg_umevbosowo.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tahap 2. "Swapping API"</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi, kami memecahkan masalah pertama - kami belajar mengambil konten dari database TheQuestion dan bahkan menampilkannya jika Anda mau. Sekarang perlu untuk membuat konten ini masuk ke database terintegrasi secara instan, dan tidak beberapa kali sehari. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk melakukan ini, perlu menulis ulang seluruh backend TheQuestion dengan semua logika yang diperlukan. Nama proyek, "Swap API," secara tegas, tidak sepenuhnya mencerminkan esensi. Akan lebih tepat menyebutnya "Tukar backend." Faktanya adalah, di samping implementasi langsung semua "pena" yang diperlukan untuk berfungsinya front-end TheQuestion, kemungkinan lain harus diwujudkan. Kami menghadapi beberapa tugas besar. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Otorisasi</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Yandex memiliki sistem otorisasi pengguna terpusat - Yandex.Passport. Dan Penikmat, tentu saja, menggunakan Paspor. Untuk masuk, Anda harus memiliki akun di Yandex. Itu masalahnya. Tidak semua pengguna TheQuestion masuk ke situs melalui Yandex (meskipun ada peluang seperti itu). Banyak pengguna tidak memiliki login Yandex sama sekali dan pergi melalui jejaring sosial (VKontakte, Facebook ...). Secara alami, kami harus menjaga fungsi ini saat bergerak. Karena itu, kami menerapkan otorisasi "non-paspor". </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mencari situs.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TheQuestion menerapkan pencarian pada pertanyaan, jawaban, pengguna, dan topik. Untuk pencarian, solusi Sphinx pihak ketiga digunakan. Jelas, jika kita berbicara tentang satu layanan, maka pencariannya harus sama, yaitu, ia tidak dapat bekerja pada dua sistem sekaligus. Dengan demikian, Sphinx ditinggalkan demi mesin pencari internal dengan dukungan untuk fungsionalitas yang diperlukan dan pengindeksan semua konten TheQuestion. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pengiriman halaman dalam Zen dan Turbo</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Pada saat bergabung, TheQuestion sudah menggunakan teknologi Yandex. Halaman Turbo didukung, konten menarik jatuh ke dalam umpan Zen. Semua ini juga harus didukung dalam "API pengganti". </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pemberitahuan dalam layanan dan aplikasi, milis.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Segala sesuatu yang berkaitan dengan memberi tahu pengguna: langganan, buletin dengan konten yang menarik, dorong tentang suka dan komentar, lebih banyak lagi. Semua ini harus ditransfer dengan hati-hati dan tidak dilupakan. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sistem Administrasi Situs</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Paragraf ini mengacu pada segala sesuatu yang berkaitan dengan manajemen internal layanan: moderasi, analitik, dan sebagainya. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sistem peringkat pengguna terpadu.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tugas ini agak tidak teknis, tetapi logis. Secara formal, tidak perlu mengembangkan sistem peringkat terpadu untuk "swap API", tetapi sistem ini masih diperlukan untuk layanan terintegrasi di masa depan. Di kedua situs, pengguna diberi peringkat untuk kuantitas dan kualitas konten yang dibuat. Rincian peringkat tidak diungkapkan, tetapi semakin sering dan semakin baik Anda menjawab pertanyaan, semakin tinggi peringkat Anda. Prinsip penilaian adalah sama pada kedua layanan, tetapi formula itu sendiri dan faktor-faktornya sangat berbeda. Itu diperlukan tidak hanya untuk secara benar dan jujur â€‹â€‹membandingkan pengguna Znatokov dan TheQuestion di antara mereka, tetapi juga untuk belajar mempertimbangkan peringkat tunggal untuk para ahli yang menulis pada dua layanan sekaligus. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dan tulis ulang semua API.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Suka atau tidak, tugas ini adalah yang paling penting dan sulit. Banyak proses pada layanan serupa, jadi kami mengambilnya dari para Penikmat dan tidak menulis dari awal. Tetapi ada juga banyak hal baru, misalnya, garis lurus pengguna atau konsep jawaban. Sebagai hasilnya, kami menulis ulang lebih dari 100 "pena" di "swap API" dan menerapkan lebih dari 50 sumber daya REST. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah kami menerapkan semua fungsi yang dijelaskan di atas, dimungkinkan untuk mulai bergerak. Tetapi sebelum kita melakukan satu trik.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jelas bahwa sebelum beralih dan meluncurkan "swap API" dalam produksi, itu harus diuji dengan sangat baik. Pertama-tama, perlu mengujinya secara fungsional, yaitu, langsung memeriksa kinerja seluruh situs di API baru. Kedua, sangat menegangkan. Kami ingin 100% yakin bahwa desain kami tidak akan "berbohong" di bawah beban. Secara alami, kami secara rutin melakukan â€œload firingâ€, yang menunjukkan bahwa kami memiliki pasokan kinerja yang baik. Namun dalam hal kinerja layanan, selalu lebih baik bermain aman. Setiap, bahkan yang terbaik, tes beban sintetis entah bagaimana berbeda dari beban produksi. Oleh karena itu, kami memutuskan, sebelum beralih API, untuk mengisi beban produksi di stand kami.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk melakukan ini, di frontend TheQuestion, kami menerapkan duplikasi semua permintaan GET (yang berarti permintaan data, bukan modifikasi) menjadi dua API sekaligus: theQuestion "API lama", yang pada waktu itu adalah yang utama, dan yang kedua "swap API". </font><font style="vertical-align: inherit;">Pada saat yang sama, frontend tidak menunggu respons API minor dan tidak menangani kesalahan, tetapi dengan cara ini kami dapat menguji backend pada pengguna nyata.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/xh/xk/bu/xhxkbuuaimvplykay5--cdqbl30.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tahap 3. Dan kemudian kita ingat tentang aplikasi</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tidak, tentu saja, kami ingat tentang mereka selama ini, tetapi menghadapi satu masalah. Mereka yang bekerja dengan aplikasi seluler tahu bahwa kerumitan dengan mereka lebih dari pada situs. Ini terutama disebabkan oleh distribusi versi baru. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pertama, Anda harus bekerja dengan layanan eksternal dari App Store dan Google Play dan menunggu versi baru untuk lulus verifikasi (dan kadang-kadang verifikasi membutuhkan waktu yang cukup lama). Kedua, bahkan jika aplikasi Anda telah lulus tes dan muncul di toko, ini tidak berarti bahwa pengguna akan melakukan pembaruan.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam kasus frontend situs web, pengembang sendiri mengontrol kapan versi baru dirilis, dan mereka tahu pasti bahwa setelah itu semua pengguna akan menerima versi situs yang diperbarui. Dalam hal aplikasi, tidak ada jaminan seperti itu. Untuk mendapatkan jaminan seperti itu, mereka sering menggunakan "pembaruan paksa" aplikasi. Hanya sedikit orang yang menyukai metode ini, dan, tentu saja, selalu, jika memungkinkan, Anda perlu mempertahankan kompatibilitas mundur antara aplikasi dan backend. Oleh karena itu, kami mengambil jalur untuk membuat perubahan tepat di sisi backend dengan perubahan minimal pada frontend dalam aplikasi. Tetapi, seperti yang sering terjadi, rencana tersebut dihadapkan dengan kenyataan pahit.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beberapa perubahan lebih mudah dilakukan di sisi front-end daripada di back-end, oleh karena itu, dalam proses pengembangan "plug-in API", front-end sedikit, tetapi berubah. Secara khusus, database TheQuestion lama menggunakan ID 64-bit numerik. Database Penikmat dan, karenanya, database gabungan dan API baru untuk TheQuestion menggunakan string 128-bit ID. Secara umum, untuk frontend yang ditulis dalam Node.js, perbedaan ini tidak signifikan. Tetapi untuk aplikasi yang sangat diketik, ini berakibat fatal. Kami kehilangan kompatibilitas ke belakang, dan aplikasi yang lebih lama tidak dapat bekerja dengan "plugin API".</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pada titik tertentu, bahkan ada proyek yang disebut "plugin API untuk plugin API", yang intinya adalah untuk menulis lapisan kecil antara backend baru dan aplikasi yang akan mengubah semua data menjadi format lama. Namun, kami dengan cepat meninggalkan ide ini. Lapisan ini akan menjadi "penopang" yang sangat kaku, yang di masa depan pasti akan membawa kita banyak masalah. Misalnya, Anda tidak bisa hanya mengambil dan menerjemahkan ID 128-bit menjadi yang 64-bit. Saya harus menerjemahkan dengan kehilangan informasi dan, akibatnya, kemungkinan tabrakan dengan ID, atau mempertahankan tabel perantara dengan korespondensi ID lama dan baru (untuk semua elemen database). Baik itu, dan yang lain - bukan solusi arsitektur terbaik.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selain ID, ada sejumlah perubahan lain yang juga lebih mudah untuk didukung di sisi front-end dan aplikasi. </font><font style="vertical-align: inherit;">Akibatnya, kami memutuskan untuk menerapkan perubahan dalam aplikasi dan masih menggunakan pembaruan yang dipaksakan. </font><font style="vertical-align: inherit;">Dalam waktu singkat kami mengembangkan versi aplikasi baru yang kompatibel dengan "swap API", karena tidak ada begitu banyak perubahan dari ujung depan dan itu tidak terlalu serius. </font><font style="vertical-align: inherit;">Dikirim ke App Store dan Google Play, berhasil dimoderasi dan mulai menunggu.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tahap X. Ayo pergi!</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi semua kode ditulis. </font><font style="vertical-align: inherit;">Dudukan dengan "API pengganti" diuji dan dipecat. </font><font style="vertical-align: inherit;">Versi baru aplikasi telah diuji di toko-toko dan siap untuk dipublikasikan. </font><font style="vertical-align: inherit;">Sekarang semua ini harus diluncurkan ke produksi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Karena fakta bahwa menyalin data baru dari database lama ke yang baru terjadi secara tidak sinkron dan memakan waktu, Anda tidak dapat mengganti backend (dan database di bawahnya) di situs yang berfungsi. </font><font style="vertical-align: inherit;">Ini dapat menyebabkan hilangnya atau tidak konsistennya data pengguna. </font><font style="vertical-align: inherit;">Oleh karena itu, kami memilih tanggal, memperingatkan pengguna dan menyiapkan piring "Pekerjaan teknis sedang berlangsung". </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan kemudian jamnya tiba, atau lebih tepatnya malam X. Rencana peluncurannya terlihat seperti ini:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Di situs web TheQuestion, kami menutup tulisan rintisan "Pekerjaan sedang berlangsung". </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kami mentransfer aplikasi ke mode Readonly. </font><font style="vertical-align: inherit;">Pengguna dapat membaca konten dari database lama, tetapi tidak dapat membuat yang baru.</font></font></li>
<li>  TheQuestion   Readonly.    :           .   ,  ,      . </li>
<li>        .            ,     .</li>
<li>       .</li>
<li> ,      ,    API.</li>
<li> API  .  â€”     ,    API   .</li>
<li>,   ,   . </li>
<li>  Â« Â»,        API.</li>
<li>    .</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Yah, itu tidak terlihat menakutkan. Pada kenyataannya, semuanya berjalan dengan lancar. Dari kejutan yang kami temui, mungkin terlalu lama untuk menerbitkan aplikasi di App Store (aplikasi diperiksa terlebih dahulu, itu hanya tentang muncul di toko). Pada akhirnya, butuh beberapa jam, itulah sebabnya mengapa seluruh operasi sedikit tertunda. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selain itu, dalam proses switching, ada satu fitur utama yang merumitkan semuanya berkali-kali dan meningkatkan tanggung jawab. Faktanya adalah bahwa proses switching tidak dapat dibalik.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Meskipun proses menyalin dan mengonversi data dari database TheQuestion yang lama ke yang baru, yang terintegrasi telah disiapkan dan didebug untuk kami, tidak ada proses penyalinan terbalik (dari database baru ke yang lama). Ini berarti bahwa segera setelah kami membuka situs di "swap API" dan memulai lalu lintas pengguna, semua pertanyaan, jawaban, komentar, dan suka yang baru dibuat tidak dapat lagi dengan mudah masuk ke database TheQuestion yang lama. Jika terjadi kesalahan setelah membuka, misalnya, satu basis data tidak dapat mengatasi beban, maka tidak akan mungkin untuk dengan cepat memutar kembali semuanya. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Padahal, tentu saja, saya melebih-lebihkan. Bagaimanapun, kami tidak akan kehilangan data pengguna. Kami memiliki rencana B dan cara untuk membuat cadangan data secara manual dari database baru ke yang lama. Tapi itu masih akan memakan waktu, dan kemunduran tidak akan terjadi tanpa rasa sakit bagi pengguna.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untungnya, Rencana A berhasil, dan tidak ada yang harus dibatalkan.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/mj/wy/7g/mjwy7gbw8fyxtqvt0fp0cetrn_4.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Babak final</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi, backend diubah, database digabungkan, aplikasi mobile tidak dilupakan. </font><font style="vertical-align: inherit;">Untuk pengguna, tidak ada yang berubah, karena situs Yandex.Ku, yang seharusnya menggabungkan data dari kedua situs, belum diluncurkan pada waktu itu. </font><font style="vertical-align: inherit;">Dan untuk peluncurannya kami harus menyelesaikan satu masalah lagi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pada awalnya, saya menulis bahwa kami harus menggabungkan tidak hanya pertanyaan dan jawaban dari dua layanan dalam satu yang baru, tetapi juga pengguna. </font><font style="vertical-align: inherit;">Pengguna seharusnya tidak hanya dapat melihat konten mereka di Kew, tetapi juga mengelolanya di Kew. </font><font style="vertical-align: inherit;">Secara teknis, menggabungkan data dan mentransfer hak manajemen tidaklah sulit. </font><font style="vertical-align: inherit;">Adalah jauh lebih sulit untuk memastikan bahwa hak-hak tersebut dialihkan kepada orang yang kepadanya mereka harus dipindahkan.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saat pindah dari Znatokov ke Kew, semuanya sederhana: dalam kedua kasus, akun Yandex yang sama digunakan. </font><font style="vertical-align: inherit;">Tetapi TheQuestion memiliki akun sendiri, yang tidak dapat diotorisasi pada Kew. </font><font style="vertical-align: inherit;">Untungnya, kami memikirkan hal ini sebelumnya. </font><font style="vertical-align: inherit;">Jauh sebelum tindakan yang dijelaskan di atas, kami memungkinkan pengguna TheQuestion untuk menautkan profil Yandex mereka. </font><font style="vertical-align: inherit;">Dan pada saat konsolidasi fisik layanan, lebih dari 90% pengguna aktif telah melakukan ini. </font><font style="vertical-align: inherit;">Ini memungkinkan kami memulai migrasi konten dan pengguna tanpa rasa sakit.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Total</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ketika kami pindah, kami ingin menyelamatkan setiap pengguna, jadi kami dengan sadar pergi ke opsi yang paling memakan waktu dan berisiko menggabungkan platform. </font><font style="vertical-align: inherit;">Kami menciptakan basis teknologi terpadu, belajar cara mengirim konten dan profil secara instan. </font><font style="vertical-align: inherit;">Alih-alih penutupan yang tak terduga dan relokasi paksa, mereka mempertahankan fungsionalitas layanan lama, meluncurkan layanan baru dan menjelaskan kelebihannya. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/dq/1o/e9/dq1oe9ihp4u8tknser_ew3oxx2c.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami meluncurkan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Yandex.Kew</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tahun lalu. </font><font style="vertical-align: inherit;">Sekarang, lebih dari 80% penulis aktif TheQuestion dan Znatokov secara sukarela pindah ke rumah baru.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id491926/index.html">Pengembangan aplikasi mobile lintas platform pada tahun 2020</a></li>
<li><a href="../id491934/index.html">Profil psikologis investor saham: cara kerjanya</a></li>
<li><a href="../id491936/index.html">Tentang cara bakteri memakan zat besi dan menghilangkan pigmen berkualitas tinggi dari tempat pembuangan buatan manusia</a></li>
<li><a href="../id491938/index.html">5 alat desainer game untuk membantu game Anda</a></li>
<li><a href="../id491942/index.html">Bagaimana kami menggunakan item2vec untuk merekomendasikan produk serupa</a></li>
<li><a href="../id491946/index.html">Hukum pemrograman</a></li>
<li><a href="../id491948/index.html">Token desain dapat berbuat lebih banyak: membuat satu sumber informasi tentang komponen UI</a></li>
<li><a href="../id491956/index.html">Rilis Rust 1.42.0: template slice dan pesan panik yang lebih nyaman</a></li>
<li><a href="../id491958/index.html">Panduan Kompresi Animasi Kerangka</a></li>
<li><a href="../id491960/index.html">Era ketika sulit tersesat</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>