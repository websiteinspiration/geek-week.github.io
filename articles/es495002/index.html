<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🎺 ❣️ 🕧 Clasificación multiproceso utilizando un grupo de subprocesos en Java 🧙🏾 🍝 🧒🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Esta publicación explicará cómo implementar la ordenación en Java usando ExecutorService. La esencia general de la clasificación es la siguiente:
 
 
...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Clasificación multiproceso utilizando un grupo de subprocesos en Java</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/495002/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Esta publicación explicará cómo implementar la ordenación en Java usando ExecutorService. </font><font style="vertical-align: inherit;">La esencia general de la clasificación es la siguiente:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> La matriz se divide en partes.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Cada parte de la matriz está ordenada.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Pasamos por las matrices ordenadas, las fusionamos en una</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aquí se aplican las ideas de clasificación de fusión, pero la matriz se divide solo en dos partes (no se utiliza la recursión). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Puede usar la siguiente función para fusionar:</font></font><br>
<a name="habracut"></a><br>
<pre><code class="java hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String[] merge( String[] leftPart, String[] rightPart ) {
        <span class="hljs-keyword">int</span> cursorLeft = <span class="hljs-number">0</span>, cursorRight = <span class="hljs-number">0</span>, counter = <span class="hljs-number">0</span>;<font></font>
        String[] merged = <span class="hljs-keyword">new</span> String[leftPart.length + rightPart.length];
        <span class="hljs-keyword">while</span> ( cursorLeft &lt; leftPart.length &amp;&amp; cursorRight &lt; rightPart.length ) {
            <span class="hljs-keyword">if</span> (leftPart[cursorLeft].compareTo(rightPart[cursorRight] ) &lt; <span class="hljs-number">0</span> ) {<font></font>
                merged[counter] = leftPart[cursorLeft];<font></font>
                cursorLeft+=<span class="hljs-number">1</span>;<font></font>
            } <span class="hljs-keyword">else</span> {<font></font>
                merged[counter] = rightPart[cursorRight];<font></font>
                cursorRight+=<span class="hljs-number">1</span>;<font></font>
            }<font></font>
            counter++;<font></font>
        }<font></font>
        <span class="hljs-keyword">if</span> ( cursorLeft &lt; leftPart.length ) {<font></font>
            System.arraycopy( leftPart, cursorLeft, merged, counter, merged.length - counter );<font></font>
        }<font></font>
        <span class="hljs-keyword">if</span> ( cursorRight &lt; rightPart.length ) {<font></font>
            System.arraycopy( rightPart, cursorRight, merged, counter, merged.length - counter );<font></font>
        }<font></font>
        <span class="hljs-keyword">return</span> merged;<font></font>
    }</code></pre> <br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fusionar código de función tomado de aquí</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La esencia de la fusión es esta: al principio, los punteros están en el primer elemento para ambas matrices. A continuación, se comparan los valores de los elementos correspondientes a las posiciones del puntero y el puntero para el elemento más pequeño se desplaza al siguiente elemento, el elemento mismo se agrega a la matriz resultante. El ciclo continúa hasta llegar al final de una de las matrices, luego el resto de la segunda matriz se copiará al final de la matriz resultante. Por lo tanto, la salida es una matriz ordenada.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
También se creó una clase para la ordenación multiproceso; se creó un método de ejecución, que se ejecuta cuando el método start () se aplica a un objeto de tipo Thread. </font><font style="vertical-align: inherit;">En nuestro caso, ejecutorService será responsable de esto. </font><font style="vertical-align: inherit;">Aquí está el código de la clase de fusión, cuyos objetos se crearán para implementar la ordenación multiproceso:</font></font><br>
<br>
<pre><code class="java hljs">
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Merger</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Runnable</span></span>{
    <span class="hljs-keyword">private</span> String[] unsorted, sorted;
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Merger</span><span class="hljs-params">(String[] unsorted)</span> </span>{
        <span class="hljs-keyword">this</span>.unsorted = unsorted;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">int</span> middle;<font></font>
        String[] left, right;<font></font>
        <span class="hljs-comment">// array is sorted</span>
        <span class="hljs-keyword">if</span> ( unsorted.length &lt;= <span class="hljs-number">1</span> ) {<font></font>
            sorted = unsorted;<font></font>
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">//</span>
            middle = unsorted.length / <span class="hljs-number">2</span>;<font></font>
            left = <span class="hljs-keyword">new</span> String[middle];<font></font>
            right = <span class="hljs-keyword">new</span> String[unsorted.length - middle];
            <span class="hljs-comment">//split array on two</span>
            System.arraycopy(unsorted, <span class="hljs-number">0</span>, left, <span class="hljs-number">0</span>, middle);<font></font>
            System.arraycopy(unsorted, middle, right, <span class="hljs-number">0</span>, unsorted.length - middle);<font></font>
            SimpleMerger leftSort = <span class="hljs-keyword">new</span> SimpleMerger(left);<font></font>
            SimpleMerger rightSort = <span class="hljs-keyword">new</span> SimpleMerger(right);<font></font>
            leftSort.sort();<font></font>
            rightSort.sort();<font></font>
            <span class="hljs-comment">//sort and merge</span><font></font>
            sorted = SimpleMerger.merge(leftSort.getSorted(), rightSort.getSorted());<font></font>
         }<font></font>
        }<font></font>
    <span class="hljs-keyword">public</span> String[] getSorted() {
        <span class="hljs-keyword">return</span> sorted;<font></font>
    }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para ordenar las partes de la matriz, se utilizó la ordenación Java incorporada. </font><font style="vertical-align: inherit;">El siguiente es el código para ordenar usando un grupo de subprocesos. </font><font style="vertical-align: inherit;">Las mediciones de tiempo se llevan a cabo para versiones multihilo y convencionales (spoiler: multihilo da aceleración solo en una gran cantidad de datos):</font></font><br>
<br>
<pre><code class="java hljs">
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception </span>{
        <span class="hljs-keyword">int</span> arrSize = <span class="hljs-number">1_000_000_0</span>;<font></font>
        String[] unsorted = <span class="hljs-keyword">new</span> String[arrSize];<font></font>
        Random randomizer = <span class="hljs-keyword">new</span> Random();<font></font>
<font></font>
        <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; arrSize; i++ ) {<font></font>
            unsorted[i] = Integer.toString(randomizer.nextInt( <span class="hljs-number">100_000_0</span> ));<font></font>
        }<font></font>
<font></font>
        List&lt;Future&gt; futures = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();
        <span class="hljs-keyword">int</span> processorCount = Runtime.getRuntime().availableProcessors();
        <span class="hljs-keyword">int</span> batchSize = arrSize/processorCount;
        <span class="hljs-keyword">long</span> startTime = System.currentTimeMillis();
        <span class="hljs-comment">// create ExecutorService</span>
        <span class="hljs-keyword">final</span> ExecutorService executorService = Executors<font></font>
                .newFixedThreadPool(Runtime.getRuntime().availableProcessors());<font></font>
        ArrayList&lt;Merger&gt; mergers = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; processorCount; i++) {<font></font>
            String[] part = <span class="hljs-keyword">new</span> String[batchSize];<font></font>
            System.arraycopy( unsorted, i*batchSize, part, <span class="hljs-number">0</span>, batchSize );
            <span class="hljs-comment">// create merger</span>
            Merger merger = <span class="hljs-keyword">new</span> Merger(part);<font></font>
<font></font>
            futures.add(executorService.submit(merger));<font></font>
            <span class="hljs-comment">//add merger to list to get result in future</span><font></font>
            mergers.add(merger);<font></font>
        }<font></font>
        <span class="hljs-keyword">for</span> (Future&lt;Double&gt; future : futures) {<font></font>
            future.get();<font></font>
        }<font></font>
        executorService.shutdown();<font></font>
        <span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>;
        <span class="hljs-comment">// array to get result</span>
        String[] mergered = <span class="hljs-keyword">new</span> String[arrSize];
        <span class="hljs-comment">// sequential merge of all part of array</span>
        <span class="hljs-keyword">for</span> (Merger merger:mergers){
            <span class="hljs-keyword">if</span> (j == <span class="hljs-number">0</span>) {<font></font>
                mergered = merger.getSorted();<font></font>
                j+=<span class="hljs-number">1</span>;<font></font>
            }<font></font>
        <span class="hljs-keyword">else</span>{<font></font>
                String[] part = merger.getSorted();<font></font>
                mergered = SimpleMerger.merge( mergered, part);<font></font>
            }<font></font>
   }<font></font>
        <span class="hljs-keyword">long</span> timeSpent = System.currentTimeMillis() - startTime;<font></font>
        System.out.println(<span class="hljs-string">"Program execution time is "</span> + timeSpent + <span class="hljs-string">" milliseconds"</span>);
        <span class="hljs-keyword">if</span> (arrSize &lt; <span class="hljs-number">100</span>) {System.out.print(Arrays.toString(mergered));}<font></font>
        startTime = System.currentTimeMillis();<font></font>
        Arrays.sort(unsorted);<font></font>
        timeSpent = System.currentTimeMillis() - startTime;<font></font>
        System.out.println(<span class="hljs-string">"\n Program (non parallel )execution time is "</span> + timeSpent + <span class="hljs-string">" milliseconds"</span>);<font></font>
    }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al comienzo de la función principal, la matriz se llena con líneas arbitrarias que contienen números del 0 al 10,000,000. El número de hilos en el dispositivo se toma como el número de hilos. </font><font style="vertical-align: inherit;">La variable batchSize es responsable de la dimensión de las matrices para ordenar en paralelo. </font><font style="vertical-align: inherit;">Luego se crea un ejecutorService con un número fijo de subprocesos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para cada subproceso, se crea su propio objeto de fusión de clase, luego este coloca la tarea de clasificación en la cola para su ejecución. </font><font style="vertical-align: inherit;">Con la ayuda del futuro, esperamos hasta que todo se calcule, recopilamos todas las partes ordenadas de la matriz y las fusionamos en la matriz resultante. </font><font style="vertical-align: inherit;">Paramos el servicio ejecutor y podemos ver los costos de tiempo de una implementación en serie y paralela. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El codigo esta aqui</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es494990/index.html">Usar el tiempo correctamente: automatización de procesos en Tinder</a></li>
<li><a href="../es494992/index.html">Sobre Matemáticas, Pandemias y Cuarentenas, continúa</a></li>
<li><a href="../es494994/index.html">Una prueba significativa del teorema de la informática captura la física con las matemáticas.</a></li>
<li><a href="../es494998/index.html">Algoritmos para el examen en el SHAD</a></li>
<li><a href="../es495000/index.html">Inicio de datos: qué tipo de datos genera el ecosistema de cosas inteligentes</a></li>
<li><a href="../es495008/index.html">Wolf-Rayet Stars - Monstruos bajo el velo</a></li>
<li><a href="../es495010/index.html">Java es una aplicación web simple. Inicio de sesión y registro</a></li>
<li><a href="../es495012/index.html">Ahora sigues con emociones</a></li>
<li><a href="../es495014/index.html">Abrir contenido en línea del Centro de Ciencias de la Computación, Parte 2</a></li>
<li><a href="../es495022/index.html">Escribir un control deslizante de JavaScript complicado pero interesante</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>