<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏾‍🤝‍👨🏻 👨‍⚖️ ☎️ FFmpeg libav Handbuch 🕥 ♿️ 👃🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Lange suchte ich nach einem Buch, das gekaut werden sollte, um eine FFmpeg- ähnliche Bibliothek namens libav zu verwenden (der Name steht für lib rary...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>FFmpeg libav Handbuch</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/edison/blog/495614/"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><div style="text-align:center;"><img width="779" height="232" src="https://habrastorage.org/webt/yn/ed/vp/ynedvpoyntkab2ppkqxuqtrbwma.png"></div></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lange suchte ich nach einem Buch, das gekaut werden sollte, um eine </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FFmpeg-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ähnliche Bibliothek namens </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">libav zu verwenden</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (der Name steht für </font></font><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lib</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> rary </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> udio </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">v</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ideo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). Fand ein Lehrbuch " </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wie man einen Videoplayer schreibt und in weniger als tausend Zeilen passt</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ." Leider sind die Informationen dort veraltet, so dass ich selbst ein Handbuch erstellen musste. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der größte Teil des Codes befindet sich in C, aber keine Sorge: Sie werden alles leicht verstehen und können es in Ihrer Lieblingssprache anwenden. FFmpeg libav hat viele Bindungen zu vielen Sprachen (einschließlich Python und Go). Aber auch wenn Ihre Sprache nicht direkt kompatibel ist, können Sie dennoch über </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ffi</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> angehängt werden </font><font style="vertical-align: inherit;">(hier ein Beispiel mit</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lua</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beginnen wir mit einem kurzen Exkurs über Video, Audio, Codecs und Container. </font><font style="vertical-align: inherit;">Dann fahren wir mit der FFmpeg-Befehlszeile mit dem Crashkurs fort und schreiben schließlich den Code. </font><font style="vertical-align: inherit;">Gehen Sie direkt zum Abschnitt „Der dornige Weg zum Lernen von FFmpeg libav“. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es gibt eine Meinung (und nicht nur meine), dass das Streamen von Internetvideos bereits den Taktstock des traditionellen Fernsehens übernommen hat. </font><font style="vertical-align: inherit;">Wie dem auch sei, FFmpeg libav ist definitiv eine Erkundung wert.</font></font><a name="menu"></a><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Inhaltsverzeichnis</font></font></h3><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Einführung</font></font></a><ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Video ist was du siehst!</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Audio ist was Sie hören!</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Codec - Datenkomprimierung</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ein Container ist eine bequeme Möglichkeit, Audio / Video zu speichern</font></font></a></li>
</ul></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ffmpeg-Befehlszeile</font></font></a><ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Befehlszeilentool FFmpeg 101</font></font></a></li>
</ul></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Grundlegende Operationen auf Video</font></font></a><ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Transcodierung</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Transmultiplexing</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Übertretend</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Transizing</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bonus: adaptives Streaming</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Überschreiten</font></font></a></li>
</ul></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">   FFmpeg libav</a><ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="> 0 —  «Hello World»</a><ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">FFmpeg libav </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">, </a></li>
</ul></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="> 1 —    </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="> 2 — </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="> 3 — </a><ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="></a></li>
</ul></li>
</ul></li>
</ul><a name="intro"></a><a name="video"></a><a name="habracut"></a><blockquote><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" title="EDISON Software - Webentwicklung"><img align="left" width="153" height="75" src="https://habrastorage.org/webt/w0/zl/to/w0zltoxvysbr0yeinstkfvw1wbg.png" alt="EDISON Software - Webentwicklung"></a><br clear="right">
     EDISON.<br>
<br>
 <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">  ,  </a>,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">   </a>.<br>
<br>
     ! ;-)</blockquote><img align="right" width="210" height="280" src="https://habrastorage.org/webt/5k/lz/nu/5klznusfiwgawobmtbcrpdboscw.jpeg"><br clear="left">
<h2> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">↑</a></h2><br>
<h3> —  ,   ! <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">↑</a></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn die Bildfolge mit einer bestimmten Frequenz geändert wird (z. B. 24 Bilder pro Sekunde), entsteht eine Bewegungsillusion. </font><font style="vertical-align: inherit;">Dies ist die Hauptidee des Videos: eine Reihe von Bildern (Frames), die sich mit einer bestimmten Geschwindigkeit bewegen. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1886 Abbildung.</font></font></i><br>
<br>
<a name="audio"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Audio ist was Sie hören! </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">↑</font></font></a></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Obwohl stille Videos eine Vielzahl von Gefühlen hervorrufen können, erhöht das Hinzufügen von Ton den Grad des Vergnügens dramatisch. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Schall sind Schwingungswellen, die sich in Luft oder einem anderen Übertragungsmedium (wie Gas, Flüssigkeit oder Feststoff) ausbreiten. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In einem digitalen Audiosystem wandelt ein Mikrofon Ton in ein analoges elektrisches Signal um. </font><font style="vertical-align: inherit;">Dann </font><font style="vertical-align: inherit;">wandelt ein Analog </font><font style="vertical-align: inherit;">-Digital-Wandler ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ADC</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) - normalerweise unter Verwendung von Pulscodemodulation ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PCM</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) - ein analoges Signal in ein digitales um.</font></font><br>
<br>
<div style="text-align:center;"><img width="640" height="220" src="https://habrastorage.org/webt/eu/gb/_m/eugb_mwqa5x5yctawseum7qdtss.png"></div><br>
<a name="codec"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Codec - Datenkomprimierung </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">↑</font></font></a></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ein Codec ist eine elektronische Schaltung oder Software, die digitales Audio / Video komprimiert oder dekomprimiert. </font><font style="vertical-align: inherit;">Es konvertiert rohes (unkomprimiertes) digitales Audio / Video in ein komprimiertes Format (oder umgekehrt). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn wir uns jedoch dazu entschließen, Millionen von Bildern in eine Datei zu packen und sie als Film zu bezeichnen, können wir eine riesige Datei erhalten. </font><font style="vertical-align: inherit;">Berechnen </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
wir </font><font style="vertical-align: inherit;">: </font><font style="vertical-align: inherit;">Nehmen wir an, wir erstellen ein Video mit einer Auflösung von 1080 × 1920 (Höhe × Breite). </font><font style="vertical-align: inherit;">Wir geben 3 Bytes pro Pixel (der Mindestpunkt auf dem Bildschirm) für die Farbcodierung aus (24-Bit-Farbe, wodurch wir </font></font><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.777.216</font></font></nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> verschiedene Farben erhalten). </font><font style="vertical-align: inherit;">Dieses Video arbeitet mit einer Geschwindigkeit von 24 Bildern pro Sekunde und einer Gesamtdauer von 30 Minuten.</font></font><br>
<br>
<pre><code class="cpp hljs">toppf = <span class="hljs-number">1080</span> * <span class="hljs-number">1920</span> <span class="hljs-comment">//    </span>
cpp = <span class="hljs-number">3</span> <span class="hljs-comment">//  </span>
tis = <span class="hljs-number">30</span> * <span class="hljs-number">60</span> <span class="hljs-comment">//   </span>
fps = <span class="hljs-number">24</span> <span class="hljs-comment">//   </span><font></font>
<font></font>
required_storage = tis * fps * toppf * cpp</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dieses Video benötigt ungefähr 250,28 GB Speicher oder 1,11 Gbit / s! </font><font style="vertical-align: inherit;">Deshalb müssen Sie einen Codec verwenden.</font></font><br>
<br>
<a name="container"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ein Container ist eine bequeme Möglichkeit, Audio / Video </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">↑</font></a><font style="vertical-align: inherit;"> zu speichern</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"></font></a></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Containerformat (Wrapper) ist ein Metadateiformat, dessen Spezifikation beschreibt, wie verschiedene Daten- und Metadatenelemente in einer Computerdatei nebeneinander existieren. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dies ist eine einzelne Datei, die alle Streams (hauptsächlich Audio und Video) enthält, die Synchronisation ermöglicht und allgemeine Metadaten (wie Titel, Auflösung) usw. enthält. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In der Regel wird das Dateiformat durch seine Erweiterung bestimmt: Beispielsweise ist video.webm höchstwahrscheinlich ein Video, das den webm-Container verwendet.</font></font><br>
<br>
<div style="text-align:center;"><img width="621" height="328" src="https://habrastorage.org/webt/ay/du/qa/ayduqaajbhuh59tah4vdgcu2sj0.png"></div><br>
<a name="command_line"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Befehlszeile FFmpeg </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">↑</font></font></a></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unabhängige plattformübergreifende Lösung zum Aufzeichnen, Konvertieren und Streamen von Audio / Video. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Für die Arbeit mit Multimedia haben wir ein erstaunliches Tool - eine Bibliothek namens </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FFmpeg</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Auch wenn Sie es nicht in Ihrem Programmcode verwenden, verwenden Sie es dennoch (verwenden Sie Chrome?). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Bibliothek verfügt über ein Konsolenprogramm zur Eingabe einer Befehlszeile namens </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ffmpeg</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (in kleinen Buchstaben im Gegensatz zum Namen der Bibliothek selbst). </font><font style="vertical-align: inherit;">Dies ist eine einfache und leistungsstarke Binärdatei. </font><font style="vertical-align: inherit;">Sie können beispielsweise von mp4 nach avi konvertieren, indem Sie einfach diesen Befehl eingeben:</font></font><br>
<br>
<pre><code class="bash hljs">$ ffmpeg -i input.mp4 output.avi</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben gerade </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">neu gemischt</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - von einem Container in einen anderen konvertiert. </font><font style="vertical-align: inherit;">Technisch kann FFmpeg auch transkodieren, aber dazu später mehr.</font></font><br>
<br>
<a name="101"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Befehlszeilenprogramm FFmpeg 101 </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">↑</font></font></a></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FFmpeg hat eine </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dokumentation,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in der alles perfekt erklärt wird, wie was funktioniert. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Schematisch erwartet das FFmpeg-Befehlszeilenprogramm, dass das folgende Argumentformat seine Aufgabe erfüllt - </font></font><code><b>ffmpeg {1} {2} -i {3} {4} {5}</b></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wobei: </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{1}</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - globale Parameter </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{2}</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Parameter der Eingabedatei </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{3}</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - eingehende URL </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{4}</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Parameter der Ausgabedatei </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{5}</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - ausgehend Die URL- </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Teile {2}, {3}, {4}, {5} geben so viele Argumente wie nötig an. </font><font style="vertical-align: inherit;">Das Format der Übergabe von Argumenten lässt sich anhand eines Beispiels leichter verstehen: </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WARNUNG: Eine Referenzdatei wiegt 300 MB</font></font></b><br>
<br>
<pre><code class="bash hljs">$ wget -O bunny_1080p_60fps.mp4 http://distribution.bbb3d.renderfarming.net/video/mp4/bbb_sunflower_1080p_60fps_normal.mp4<font></font>
<font></font>
$ ffmpeg \<font></font>
-y \ <span class="hljs-comment">#  </span>
-c: libfdk_aac -c: v libx264 \ <span class="hljs-comment">#  </span>
-i bunny_1080p_60fps.mp4 \ <span class="hljs-comment">#  URL</span>
-c: v libvpx-vp9 -c: libvorbis \ <span class="hljs-comment">#  </span>
bunny_1080p_60fps_vp9.webm <span class="hljs-comment">#  URL</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dieser Befehl nimmt eine eingehende mp4-Datei mit zwei Streams (Audio, das mit dem aac-Codec codiert wurde, und Video, das mit dem h264-Codec codiert wurde) und konvertiert sie in webm, wobei auch die Audio- und Videocodecs geändert werden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie den obigen Befehl vereinfachen, sollten Sie berücksichtigen, dass FFmpeg anstelle von Ihnen die Standardwerte akzeptiert. </font><font style="vertical-align: inherit;">Zum Beispiel, wenn Sie einfach eingeben</font></font><br>
<br>
<pre><code class="bash hljs">ffmpeg -i input.avi output.mp4</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Welchen Audio- / Video-Codec wird zum Erstellen von output.mp4 verwendet? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Werner Robitz schrieb eine </font><font style="vertical-align: inherit;">Codierung und Bearbeitung </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Leitfaden</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> zum Lesen / Ausführen mit FFmpeg.</font></font><br>
<br>
<a name="operations"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Grundlegende Videobetriebe </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">↑</font></font></a></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bei der Arbeit mit Audio / Video führen wir normalerweise eine Reihe von Aufgaben im Zusammenhang mit Multimedia aus.</font></font><br>
<br>
<a name="transcoding"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Transcodierung (Transcodierung) </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">↑</font></font></a></h3><br>
<br>
<div style="text-align:center;"><img width="494" height="225" src="https://habrastorage.org/webt/uf/fl/cr/ufflcrik3ha4z6tt5axevtdfv9u.png"></div><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Was ist das? </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Prozess des Konvertierens von Streaming oder Audio oder Video (oder von beiden gleichzeitig) von einem Codec in einen anderen. </font><font style="vertical-align: inherit;">Das Dateiformat (Container) ändert sich nicht. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wofür? </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es kommt vor, dass einige Geräte (Fernseher, Smartphones, Konsolen usw.) das Audio- / Videoformat X nicht unterstützen, jedoch das Audio- / Videoformat Y. Oder neuere Codecs sind vorzuziehen, da sie ein besseres Komprimierungsverhältnis bieten. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wie? </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Konvertieren Sie beispielsweise Video H264 (AVC) in H265 (HEVC):</font></font><br>
<br>
<pre><code class="bash hljs">$ ffmpeg \<font></font>
-i bunny_1080p_60fps.mp4 \<font></font>
-c:v libx265 \<font></font>
bunny_1080p_60fps_h265.mp4</code></pre><br>
<a name="transmuxing"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Transmultiplexing </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">↑</font></font></a></h3><br>
<div style="text-align:center;"><img width="492" height="231" src="https://habrastorage.org/webt/es/vp/gm/esvpgmlkjcj38alzp2sbrdckpne.png"></div><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Was ist das? </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Konvertieren Sie von einem Format (Container) in ein anderes. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wofür? </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es kommt vor, dass einige Geräte (Fernseher, Smartphones, Konsolen usw.) das X-Dateiformat nicht unterstützen, aber das Y-Dateiformat. Oder neuere Container bieten im Gegensatz zu älteren die modernen erforderlichen Funktionen. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wie? </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Konvertieren Sie eine mp4 in webm:</font></font><br>
<br>
<pre><code class="bash hljs">$ ffmpeg \<font></font>
-i bunny_1080p_60fps.mp4 \<font></font>
-c copy \ <span class="hljs-comment"># just saying to ffmpeg to skip encoding</span>
bunny_1080p_60fps.webm</code></pre><br>
<a name="transrating"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Übertragen </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">↑</font></font></a></h3><br>
<div style="text-align:center;"><img width="437" height="235" src="https://habrastorage.org/webt/ev/hx/cp/evhxcp7a6y5fkjjq9s53hyfs3iq.png"></div><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Was ist das? </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ändern Sie die Datenrate oder erstellen Sie eine andere Ansicht. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wofür? </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Benutzer kann Ihr Video sowohl in einem 2G-Netzwerk auf einem Smartphone mit geringem Stromverbrauch als auch über eine Glasfaser-Internetverbindung auf einem 4K-Fernseher ansehen. </font><font style="vertical-align: inherit;">Daher sollten Sie mehr als eine Option zum Abspielen desselben Videos mit unterschiedlichen Datenraten anbieten. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wie? </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">erzeugt eine Wiedergabe mit einer Bitrate zwischen 3856K und 2000K.</font></font><br>
<br>
<pre><code class="bash hljs">$ ffmpeg \<font></font>
-i bunny_1080p_60fps.mp4 \<font></font>
-minrate 964K -maxrate 3856K -bufsize 2000K \<font></font>
bunny_1080p_60fps_transrating_964_3856.mp4</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Typischerweise erfolgt die Transrating in Verbindung mit einer Neukalibrierung. </font><font style="vertical-align: inherit;">Werner Robitz schrieb einen weiteren </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">obligatorischen Artikel</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> über Geschwindigkeitsregelung FFmpeg.</font></font><br>
<br>
<a name="transsizing"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Transizing (Neukalibrierung) </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">↑</font></font></a></h3><br>
<div style="text-align:center;"><img width="515" height="277" src="https://habrastorage.org/webt/gj/c2/4k/gjc24kcqli3iwwdkzbb70pbue-k.png"></div><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Was ist das? </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Auflösungsänderung. </font><font style="vertical-align: inherit;">Wie oben angegeben, wird das Transsizing häufig gleichzeitig mit dem Transrating durchgeführt. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wofür? </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aus den gleichen Gründen wie beim Übertragen. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wie? </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reduzieren Sie die Auflösung von 1080 auf 480:</font></font><br>
<br>
<pre><code class="bash hljs">$ ffmpeg \<font></font>
-i bunny_1080p_60fps.mp4 \<font></font>
-vf scale=480:-1 \<font></font>
bunny_1080p_60fps_transsizing_480.mp4</code></pre><br>
<a name="bonus"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bonus: adaptives Streaming </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">↑</font></font></a></h3><br>
<div style="text-align:center;"><img width="750" height="134" src="https://habrastorage.org/webt/3z/az/lg/3zazlgpe3wjx3zvvhapi0z3ur68.png"></div><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Was ist das? </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erstellung vieler Berechtigungen (Bitraten) und Aufteilung der Medien in Teile und deren Übertragung über das http-Protokoll. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wofür? </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um flexible Multimedia-Inhalte bereitzustellen, die auch auf einem preisgünstigen Smartphone oder sogar auf einem 4K-Plasma angezeigt werden können, kann es einfach skaliert und bereitgestellt werden (dies kann jedoch zu Verzögerungen führen). </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wie? </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erstellen Sie ein reaktionsfähiges WebM mit DASH:</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-comment"># video streams</span><font></font>
$ ffmpeg -i bunny_1080p_60fps.mp4 -c:v libvpx-vp9 -s 160x90 -b:v 250k -keyint_min 150 -g 150 -an -f webm -dash 1 video_160x90_250k.webm<font></font>
<font></font>
$ ffmpeg -i bunny_1080p_60fps.mp4 -c:v libvpx-vp9 -s 320x180 -b:v 500k -keyint_min 150 -g 150 -an -f webm -dash 1 video_320x180_500k.webm<font></font>
<font></font>
$ ffmpeg -i bunny_1080p_60fps.mp4 -c:v libvpx-vp9 -s 640x360 -b:v 750k -keyint_min 150 -g 150 -an -f webm -dash 1 video_640x360_750k.webm<font></font>
<font></font>
$ ffmpeg -i bunny_1080p_60fps.mp4 -c:v libvpx-vp9 -s 640x360 -b:v 1000k -keyint_min 150 -g 150 -an -f webm -dash 1 video_640x360_1000k.webm<font></font>
<font></font>
$ ffmpeg -i bunny_1080p_60fps.mp4 -c:v libvpx-vp9 -s 1280x720 -b:v 1500k -keyint_min 150 -g 150 -an -f webm -dash 1 video_1280x720_1500k.webm<font></font>
<font></font>
<span class="hljs-comment"># audio streams</span><font></font>
$ ffmpeg -i bunny_1080p_60fps.mp4 -c:a libvorbis -b:a 128k -vn -f webm -dash 1 audio_128k.webm<font></font>
<font></font>
<span class="hljs-comment"># the DASH manifest</span><font></font>
$ ffmpeg \<font></font>
 -f webm_dash_manifest -i video_160x90_250k.webm \<font></font>
 -f webm_dash_manifest -i video_320x180_500k.webm \<font></font>
 -f webm_dash_manifest -i video_640x360_750k.webm \<font></font>
 -f webm_dash_manifest -i video_640x360_1000k.webm \<font></font>
 -f webm_dash_manifest -i video_1280x720_500k.webm \<font></font>
 -f webm_dash_manifest -i audio_128k.webm \<font></font>
 -c copy -map 0 -map 1 -map 2 -map 3 -map 4 -map 5 \<font></font>
 -f webm_dash_manifest \<font></font>
 -adaptation_sets <span class="hljs-string">"id=0,streams=0,1,2,3,4 id=1,streams=5"</span> \<font></font>
 manifest.mpd</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PS: Ich habe dieses Beispiel aus den </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anweisungen zum Spielen von Adaptive WebM mit DASH gezogen</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<a name="beyond"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Über </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">↑</font></a><font style="vertical-align: inherit;"> hinausgehen</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"></font></a></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es gibt keine anderen Verwendungen für FFmpeg. </font><font style="vertical-align: inherit;">Ich benutze es mit </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iMovie</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , um einige YouTube-Videos zu erstellen / bearbeiten. </font><font style="vertical-align: inherit;">Und natürlich hindert Sie nichts daran, es professionell einzusetzen.</font></font><br>
<br>
<a name="hard_way"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der dornige Weg, FFmpeg libav zu lernen </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">↑</font></font></a></h2><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ist es nicht von Zeit zu Zeit erstaunlich, was durch Hören und Sehen wahrgenommen wird? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Biologe David Robert Jones</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FFmpeg ist äußerst nützlich als Befehlszeilentool zum Ausführen wichtiger Vorgänge mit Multimediadateien. </font><font style="vertical-align: inherit;">Vielleicht kann es auch in Programmen verwendet werden? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FFmpeg besteht aus mehreren Bibliotheken, die in unsere eigenen Programme integriert werden können. </font><font style="vertical-align: inherit;">Wenn Sie FFmpeg installieren, werden normalerweise alle diese Bibliotheken automatisch installiert. </font><font style="vertical-align: inherit;">Ich werde eine Reihe dieser Bibliotheken als </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FFmpeg libav bezeichnen</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Titel des Abschnitts ist eine Hommage an Zed Shaws Serie The </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Thorny Path of Learning [...]</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , insbesondere an sein Buch The Thorny Path of Learning C.</font></font><br>
<br>
<a name="chapter_0"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kapitel 0 - Die einfache Hallo Welt </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">↑</font></font></a></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In unserer </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hello World</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> werden Sie die Welt in Konsolensprache nicht wirklich begrüßen. </font><font style="vertical-align: inherit;">Drucken Sie stattdessen die folgenden Informationen zum Video aus: Format (Container), Dauer, Auflösung, Audiokanäle, und entschlüsseln Sie schließlich einige Frames und speichern Sie sie als Bilddateien.</font></font><br>
<br>
<a name="architecture"></a><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FFmpeg libav Architektur </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">↑</font></font></a></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bevor wir jedoch mit dem Schreiben des Codes beginnen, wollen wir uns ansehen, wie die FFmpeg libav-Architektur im Allgemeinen funktioniert und wie ihre Komponenten mit anderen interagieren. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hier ist ein Diagramm des Videodecodierungsprozesses:</font></font><br>
<div style="text-align:center;"><img width="750" height="424" src="https://habrastorage.org/webt/ej/1d/ek/ej1deksvwwqdctppaujla5v5tog.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zunächst wird die Mediendatei in eine Komponente namens </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AVFormatContext geladen</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (der Videocontainer ist auch ein Format). Tatsächlich wird nicht die gesamte Datei vollständig heruntergeladen: Oft wird nur der Header gelesen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sobald Sie den </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mindestheader unseres Containers</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> heruntergeladen haben </font><font style="vertical-align: inherit;">, können Sie auf dessen Streams zugreifen (diese können als elementare Audio- und Videodaten dargestellt werden). Jeder Stream ist in der </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AVStream-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Komponente verfügbar </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Angenommen, unser Video verfügt über zwei Streams: Audio, das mit dem </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AAC-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Codec </font><font style="vertical-align: inherit;">codiert wurde, und Video, das mit dem </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">H264-Codec</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AVC</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) </font><font style="vertical-align: inherit;">codiert wurde </font><font style="vertical-align: inherit;">. Aus jedem Stream können wir Daten extrahieren, die als </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pakete bezeichnet werden</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">die in Komponenten namens </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AVPacket</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> geladen werden </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Daten in den Paketen sind immer noch codiert (komprimiert) </font><font style="vertical-align: inherit;">. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> die Pakete zu decodieren, müssen sie an einen bestimmten </font><b><font style="vertical-align: inherit;">AVCodec übergeben werden</font></b><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AVCodec</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> decodiert sie in einen </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AVFrame</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , wodurch diese Komponente einen unkomprimierten Frame ergibt. </font><font style="vertical-align: inherit;">Beachten Sie, dass die Terminologie und der Prozess für Audio- und Videostreams gleich sind.</font></font><br>
<br>
<a name="requirements"></a><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anforderungen </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">↑</font></font></a></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Da es manchmal Probleme beim Kompilieren oder Ausführen von Beispielen gibt, verwenden wir </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Docker</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> als Entwicklungs- / Laufzeitumgebung. </font><font style="vertical-align: inherit;">Wir werden auch ein </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Video mit einem großen Kaninchen verwenden</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Wenn Sie es also nicht auf Ihrem lokalen Computer haben, führen Sie einfach den Befehl </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">make fetch_small_bunny_video</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in der Konsole aus </font><font style="vertical-align: inherit;">.</font></font><br>
<br>
<a name="code"></a><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eigentlich ist der Code </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">↑</font></font></a></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
TLDR </font><font style="vertical-align: inherit;">zeig mir ein Beispiel für ausführbaren Code, Bruder:</font></font><br>
<br>
<pre><code class="bash hljs">$ make run_hello</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir werden einige Details weglassen, aber keine Sorge: Der Quellcode </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ist</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> auf github </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">verfügbar</font></a><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir werden Speicher für die </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AVFormatContext-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Komponente </font><b><font style="vertical-align: inherit;">zuweisen</font></b><font style="vertical-align: inherit;"> , die Informationen über das Format (Container) enthält.</font></font><br>
<br>
<pre><code class="cpp hljs">AVFormatContext *pFormatContext = avformat_alloc_context();</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt öffnen wir die Datei, lesen den Header und füllen </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AVFormatContext mit</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> minimalen </font><b><font style="vertical-align: inherit;">Formatinformationen</font></b><font style="vertical-align: inherit;"> (beachten Sie, dass Codecs normalerweise nicht geöffnet werden). </font><font style="vertical-align: inherit;">Verwenden Sie dazu die Funktion </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">avformat_open_input</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Es werden </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AVFormatContext</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , ein Dateiname und zwei optionale Argumente </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">erwartet</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font><b><font style="vertical-align: inherit;">AVInputFormat</font></b><font style="vertical-align: inherit;"> (wenn Sie NULL übergeben, bestimmt FFmpeg das Format) und </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AVDictionary</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (Demultiplexer-Optionen).</font></font><br>
<br>
<pre><code class="cpp hljs">avformat_open_input(&amp;pFormatContext, filename, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sie können auch den Namen des Formats und die Dauer des Mediums drucken:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-built_in">printf</span>(<span class="hljs-string">"Format %s, duration %lld us"</span>, pFormatContext-&gt;iformat-&gt;long_name, pFormatContext-&gt;duration);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um auf die Streams zugreifen zu können, müssen wir die Daten von den Medien lesen. </font><font style="vertical-align: inherit;">Dies erfolgt über die Funktion </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">avformat_find_stream_info</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Jetzt enthält </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pFormatContext-&gt; nb_streams</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> die Anzahl der Threads, und </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pFormatContext-&gt; Streams [i]</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> geben uns den </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ten Fluss in einer Reihe ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AVStream</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).</font></font><br>
<br>
<pre><code class="cpp hljs">avformat_find_stream_info(pFormatContext,  <span class="hljs-literal">NULL</span>);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lassen Sie uns die Schleife in allen Threads durchgehen:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; pFormatContext-&gt;nb_streams; i++) {
  <span class="hljs-comment">//</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Für jeden Stream speichern wir </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AVCodecParameters</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , in dem die Eigenschaften des vom </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ten Stream </font><font style="vertical-align: inherit;">verwendeten Codecs beschrieben werden </font><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="cpp hljs">AVCodecParameters *pLocalCodecParameters = pFormatContext-&gt;streams[i]-&gt;codecpar;</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mithilfe der Eigenschaften der Codecs können wir den entsprechenden finden, indem </font><font style="vertical-align: inherit;">wir </font><font style="vertical-align: inherit;">die Funktion </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">avcodec_find_decoder</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> anfordern. </font><b><font style="vertical-align: inherit;">Außerdem</font></b><font style="vertical-align: inherit;"> können </font><font style="vertical-align: inherit;">wir den registrierten Decoder für die Codec- </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ID</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> finden und </font><b><font style="vertical-align: inherit;">AVCodec zurückgeben</font></b><font style="vertical-align: inherit;"> - eine Komponente, die weiß, wie der Stream codiert und decodiert wird:</font></font><br>
<br>
<pre><code class="cpp hljs">AVCodec *pLocalCodec = avcodec_find_decoder(pLocalCodecParameters-&gt;codec_id);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt können wir die Codec-Informationen drucken:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">// specific for video and audio</span>
<span class="hljs-keyword">if</span> (pLocalCodecParameters-&gt;codec_type == AVMEDIA_TYPE_VIDEO) {
  <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Video Codec: resolution %d x %d"</span>, pLocalCodecParameters-&gt;width, pLocalCodecParameters-&gt;height);<font></font>
} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (pLocalCodecParameters-&gt;codec_type == AVMEDIA_TYPE_AUDIO) {
  <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Audio Codec: %d channels, sample rate %d"</span>, pLocalCodecParameters-&gt;channels, pLocalCodecParameters-&gt;sample_rate);<font></font>
}<font></font>
<span class="hljs-comment">// general</span>
<span class="hljs-built_in">printf</span>(<span class="hljs-string">"\tCodec %s ID %d bit_rate %lld"</span>, pLocalCodec-&gt;long_name, pLocalCodec-&gt;id, pCodecParameters-&gt;bit_rate);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mit dem Codec weisen wir Speicher für </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AVCodecContext zu</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , der den Kontext für unseren Decodierungs- / Codierungsprozess enthält. </font><font style="vertical-align: inherit;">Aber dann müssen Sie diesen Codec-Kontext mit </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CODEC-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Parametern </font><b><font style="vertical-align: inherit;">füllen</font></b><font style="vertical-align: inherit;"> - wir tun dies mit </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">avcodec_parameters_to_context</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nachdem wir den Codec-Kontext ausgefüllt haben, müssen Sie den Codec öffnen. </font><font style="vertical-align: inherit;">Wir </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rufen die</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Funktion </font><b><font style="vertical-align: inherit;">avcodec_open2 auf</font></b><font style="vertical-align: inherit;"> und können sie dann verwenden:</font></font><br>
<br>
<pre><code class="cpp hljs">AVCodecContext *pCodecContext = avcodec_alloc_context3(pCodec);<font></font>
avcodec_parameters_to_context(pCodecContext, pCodecParameters);<font></font>
avcodec_open2(pCodecContext, pCodec, <span class="hljs-literal">NULL</span>);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt werden wir Pakete aus dem Stream lesen und in Frames dekodieren, aber zuerst müssen wir Speicher für beide Komponenten ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AVPacket</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AVFrame</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) </font><b><font style="vertical-align: inherit;">zuweisen</font></b><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<pre><code class="cpp hljs">AVPacket *pPacket = av_packet_alloc();<font></font>
AVFrame *pFrame = av_frame_alloc();</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lassen Sie uns unsere Pakete aus den Streams der Funktion </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">av_read_frame füttern</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font><font style="vertical-align: inherit;">während sie die Pakete enthält:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">while</span>(av_read_frame(pFormatContext, pPacket) &gt;= <span class="hljs-number">0</span>) {
  <span class="hljs-comment">//...</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt senden wir das Rohdatenpaket (komprimierter Frame) über den Codec-Kontext mit der Funktion </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">avcodec_send_packet</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> an den Decoder </font><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="cpp hljs">avcodec_send_packet(pCodecContext, pPacket);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und lassen Sie uns mit der Funktion </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">avcodec_receive_frame</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> einen Frame mit Rohdaten (einen unkomprimierten Frame) vom Decoder über denselben Codec-Kontext </font><b><font style="vertical-align: inherit;">abrufen</font></b><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="cpp hljs">avcodec_receive_frame(pCodecContext, pFrame);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir können die Rahmennummer, PTS, DTS, den Rahmentyp usw. Drucken:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-built_in">printf</span>(
    <span class="hljs-string">"Frame %c (%d) pts %d dts %d key_frame %d [coded_picture_number %d, display_picture_number %d]"</span>,<font></font>
    av_get_picture_type_char(pFrame-&gt;pict_type),<font></font>
    pCodecContext-&gt;frame_number,<font></font>
    pFrame-&gt;pts,<font></font>
    pFrame-&gt;pkt_dts,<font></font>
    pFrame-&gt;key_frame,<font></font>
    pFrame-&gt;coded_picture_number,<font></font>
    pFrame-&gt;display_picture_number<font></font>
);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und schließlich können wir unseren dekodierten Rahmen in einem einfachen grauen Bild speichern. </font><font style="vertical-align: inherit;">Der Prozess ist sehr einfach: Wir werden </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pFrame-&gt; Daten verwenden</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , wobei der Index den Farbräumen </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Y</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cb</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cr zugeordnet ist</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Wählen Sie einfach 0 (Y), um unser graues Bild zu speichern:</font></font><br>
<br>
<pre><code class="cpp hljs">save_gray_frame(pFrame-&gt;data[<span class="hljs-number">0</span>], pFrame-&gt;linesize[<span class="hljs-number">0</span>], pFrame-&gt;width, pFrame-&gt;height, frame_filename);<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">save_gray_frame</span><span class="hljs-params">(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> *buf, <span class="hljs-keyword">int</span> wrap, <span class="hljs-keyword">int</span> xsize, <span class="hljs-keyword">int</span> ysize, <span class="hljs-keyword">char</span> *filename)</span>
</span>{<font></font>
    FILE *f;<font></font>
    <span class="hljs-keyword">int</span> i;<font></font>
    f = fopen(filename,<span class="hljs-string">"w"</span>);
    <span class="hljs-comment">// writing the minimal required header for a pgm file format</span>
    <span class="hljs-comment">// portable graymap format -&gt; https://en.wikipedia.org/wiki/Netpbm_format#PGM_example</span>
    <span class="hljs-built_in">fprintf</span>(f, <span class="hljs-string">"P5\n%d %d\n%d\n"</span>, xsize, ysize, <span class="hljs-number">255</span>);<font></font>
<font></font>
    <span class="hljs-comment">// writing line by line</span>
    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; ysize; i++)<font></font>
        fwrite(buf + i * wrap, <span class="hljs-number">1</span>, xsize, f);<font></font>
    fclose(f);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und voila! </font><font style="vertical-align: inherit;">Jetzt haben wir ein 2 MB Graustufenbild:</font></font><br>
<br>
<div style="text-align:center;"><img width="750" height="413" src="https://habrastorage.org/webt/gk/tf/i9/gktfi9xb3ylqmmzu927uc7aon9w.png"></div><br>
<a name="chapter_1"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kapitel 1 - Audio und Video </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">synchronisieren ↑</font></font></a></h3><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Im Spiel zu sein ist, wenn ein junger JS-Entwickler einen neuen MSE-Videoplayer schreibt.</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bevor wir mit dem Schreiben von Transcodierungscode beginnen, sprechen wir über die Synchronisation oder darüber, wie der Videoplayer den richtigen Zeitpunkt zum Abspielen eines Frames findet. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im vorherigen Beispiel haben wir mehrere Frames gespeichert: </font></font><br>
<img width="194" height="110" src="https://habrastorage.org/webt/gj/yz/7h/gjyz7h4agcr6n2hdkmt9w9ko5ho.png"> <img width="194" height="110" src="https://habrastorage.org/webt/is/cl/yy/isclyy5ckz1_4w2mepv4msr2dba.png"> <img width="194" height="110" src="https://habrastorage.org/webt/7z/tr/mu/7ztrmukulalxo5qihbly0cpm_5w.png"> <img width="194" height="110" src="https://habrastorage.org/webt/u3/q8/pq/u3q8pqb2qxhroy1ycatplyeveco.png"> <img width="194" height="110" src="https://habrastorage.org/webt/uu/lh/ih/uulhihectxop1sphmmss_ipvfpc.png"> <img width="194" height="110" src="https://habrastorage.org/webt/9x/ss/bm/9xssbmfyxzra5frtcob9dirkxt8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn wir einen Videoplayer entwerfen, müssen wir jedes Frame in einem bestimmten Tempo abspielen. Andernfalls ist es schwierig, das Video zu genießen, da es zu schnell oder zu langsam abgespielt wird. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Daher müssen wir eine Logik für eine reibungslose Wiedergabe jedes Frames definieren. In dieser Hinsicht hat jeder Rahmen eine Zeitdarstellung Marke ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PTS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - aus </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> RÄSENTATION </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ime </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Stampf), die immer mehr in Betracht in den Variablen genommen ist</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zeitbasis</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , eine rationale Zahl (wobei der Nenner als Zeitskala - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zeitskala bezeichnet wird</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) geteilt durch die </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bildrate</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fps</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mit Beispielen ist es einfacher zu verstehen. </font><font style="vertical-align: inherit;">Lassen Sie uns einige Szenarien simulieren. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Für </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fps = 60/1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">timebase = 1/60000</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> erhöht </font><font style="vertical-align: inherit;">jedes </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PTS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> die </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zeitskala / fps = 1000</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , sodass die tatsächliche </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PTS-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Zeit </font><font style="vertical-align: inherit;">für jeden Frame </font><b><font style="vertical-align: inherit;">betragen</font></b><font style="vertical-align: inherit;"> kann (vorausgesetzt, sie beginnt bei 0):</font></font><br>
<br>
<pre><code class="cpp hljs">frame=<span class="hljs-number">0</span>, PTS = <span class="hljs-number">0</span>, PTS_TIME = <span class="hljs-number">0</span>
frame=<span class="hljs-number">1</span>, PTS = <span class="hljs-number">1000</span>, PTS_TIME = PTS * timebase = <span class="hljs-number">0.016</span>
frame=<span class="hljs-number">2</span>, PTS = <span class="hljs-number">2000</span>, PTS_TIME = PTS * timebase = <span class="hljs-number">0.033</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fast das gleiche Szenario, aber mit einer </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zeitskala</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> von 1/60:</font></font><br>
<br>
<pre><code class="cpp hljs">frame=<span class="hljs-number">0</span>, PTS = <span class="hljs-number">0</span>, PTS_TIME = <span class="hljs-number">0</span>
frame=<span class="hljs-number">1</span>, PTS = <span class="hljs-number">1</span>, PTS_TIME = PTS * timebase = <span class="hljs-number">0.016</span>
frame=<span class="hljs-number">2</span>, PTS = <span class="hljs-number">2</span>, PTS_TIME = PTS * timebase = <span class="hljs-number">0.033</span>
frame=<span class="hljs-number">3</span>, PTS = <span class="hljs-number">3</span>, PTS_TIME = PTS * timebase = <span class="hljs-number">0.050</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Für </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fps = 25/1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">timebase = 1/75</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> erhöht </font><font style="vertical-align: inherit;">jedes </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PTS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> die </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zeitskala / fps = 3</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , und die </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PTS-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Zeit </font><font style="vertical-align: inherit;">kann sein:</font></font><br>
<br>
<pre><code class="cpp hljs">frame=<span class="hljs-number">0</span>, PTS = <span class="hljs-number">0</span>, PTS_TIME = <span class="hljs-number">0</span>
frame=<span class="hljs-number">1</span>, PTS = <span class="hljs-number">3</span>, PTS_TIME = PTS * timebase = <span class="hljs-number">0.04</span>
frame=<span class="hljs-number">2</span>, PTS = <span class="hljs-number">6</span>, PTS_TIME = PTS * timebase = <span class="hljs-number">0.08</span>
frame=<span class="hljs-number">3</span>, PTS = <span class="hljs-number">9</span>, PTS_TIME = PTS * timebase = <span class="hljs-number">0.12</span><font></font>
...<font></font>
frame=<span class="hljs-number">24</span>, PTS = <span class="hljs-number">72</span>, PTS_TIME = PTS * timebase = <span class="hljs-number">0.96</span><font></font>
...<font></font>
frame=<span class="hljs-number">4064</span>, PTS = <span class="hljs-number">12192</span>, PTS_TIME = PTS * timebase = <span class="hljs-number">162.56</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">können</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> wir </font><font style="vertical-align: inherit;">mit </font><b><font style="vertical-align: inherit;">pts_time</font></b><font style="vertical-align: inherit;"> einen Weg finden, dies synchron mit dem Sound von </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pts_time</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> oder mit der Systemuhr </font><font style="vertical-align: inherit;">zu visualisieren </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">FFmpeg libav stellt diese Informationen über seine API bereit:</font></font><br>
<br>
<pre><code class="cpp hljs">fps = AVStream-&gt;avg_frame_rate<font></font>
tbr = AVStream-&gt;r_frame_rate<font></font>
tbn = AVStream-&gt;time_base</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aus Neugier wurden die von uns gespeicherten Frames in </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DTS-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Reihenfolge gesendet </font><font style="vertical-align: inherit;">(Frames: 1, 6, 4, 2, 3, 5), aber in </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PTS-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Reihenfolge reproduziert </font><font style="vertical-align: inherit;">(Frames: 1, 2, 3, 4, 5). </font><font style="vertical-align: inherit;">Beachten Sie auch, wie viel billiger </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">B-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Frames im Vergleich zu </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> oder </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Frames sind:</font></font><br>
<br>
<pre><code class="cpp hljs">LOG: AVStream-&gt;r_frame_rate <span class="hljs-number">60</span>/<span class="hljs-number">1</span>
LOG: AVStream-&gt;time_base <span class="hljs-number">1</span>/<span class="hljs-number">60000</span><font></font>
...<font></font>
LOG: Frame <span class="hljs-number">1</span> (type=I, size=<span class="hljs-number">153797</span> bytes) pts <span class="hljs-number">6000</span> key_frame <span class="hljs-number">1</span> [DTS <span class="hljs-number">0</span>]<font></font>
LOG: Frame <span class="hljs-number">2</span> (type=B, size=<span class="hljs-number">8117</span> bytes) pts <span class="hljs-number">7000</span> key_frame <span class="hljs-number">0</span> [DTS <span class="hljs-number">3</span>]<font></font>
LOG: Frame <span class="hljs-number">3</span> (type=B, size=<span class="hljs-number">8226</span> bytes) pts <span class="hljs-number">8000</span> key_frame <span class="hljs-number">0</span> [DTS <span class="hljs-number">4</span>]<font></font>
LOG: Frame <span class="hljs-number">4</span> (type=B, size=<span class="hljs-number">17699</span> bytes) pts <span class="hljs-number">9000</span> key_frame <span class="hljs-number">0</span> [DTS <span class="hljs-number">2</span>]<font></font>
LOG: Frame <span class="hljs-number">5</span> (type=B, size=<span class="hljs-number">6253</span> bytes) pts <span class="hljs-number">10000</span> key_frame <span class="hljs-number">0</span> [DTS <span class="hljs-number">5</span>]<font></font>
LOG: Frame <span class="hljs-number">6</span> (type=P, size=<span class="hljs-number">34992</span> bytes) pts <span class="hljs-number">11000</span> key_frame <span class="hljs-number">0</span> [DTS <span class="hljs-number">1</span>]</code></pre><br>
<a name="chapter_2"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kapitel 2 - Remultiplexing </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">↑</font></font></a></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Remultiplexing (Neuanordnung, Remuxing) - der Übergang von einem Format (Container) zu einem anderen. </font><font style="vertical-align: inherit;">Zum Beispiel können wir MPEG-4-Video mit FFmpeg einfach durch MPEG-TS ersetzen:</font></font><br>
<br>
<pre><code class="bash hljs">ffmpeg input.mp4 -c copy output.ts</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die MP4-Datei wird demultiplext, während die Datei nicht dekodiert oder codiert wird ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-c Kopie</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), und am Ende erhalten wir die mpegts-Datei. </font><font style="vertical-align: inherit;">Wenn Sie das </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-f-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Format nicht angeben </font><font style="vertical-align: inherit;">, versucht ffmpeg, es anhand der Dateierweiterung zu erraten. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die allgemeine Verwendung von FFmpeg oder libav folgt einem solchen Muster / einer solchen Architektur oder einem solchen Workflow:</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Protokollebene</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Akzeptieren von Eingabedaten (z. B. eine Datei, aber auch RTTP- oder HTTP-Download)</font></font></li>
<li><b> </b> —  , ,  ,   </li>
<li><b> </b> —       </li>
<li><b> </b> —         (,  ),  </li>
<li>…        :</li>
<li><b> </b> —  (    )  </li>
<li><b> </b> —  ( )   ( )</li>
<li><b> </b> — , ,      (   , ,    )</li>
</ul><br>
<img src="https://habrastorage.org/webt/u6/x4/g3/u6x4g3oijeetm1lpdvxnjo9hwls.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Dieses Diagramm ist stark von der Arbeit von </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Leixiaohua</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Slhck inspiriert.</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">Erstellen </font></a><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">wir</font></a></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
nun ein Beispiel mit libav, um den gleichen Effekt wie bei der Ausführung dieses Befehls zu erzielen:</font></font><br>
<br>
<pre><code class="bash hljs">ffmpeg input.mp4 -c copy output.ts</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir werden von der Eingabe ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">input_format_context</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) </font><font style="vertical-align: inherit;">lesen </font><font style="vertical-align: inherit;">und sie in eine andere Ausgabe ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">output_format_context</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) </font><b><font style="vertical-align: inherit;">ändern</font></b><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="cpp hljs">AVFormatContext *input_format_context = <span class="hljs-literal">NULL</span>;<font></font>
AVFormatContext *output_format_context = <span class="hljs-literal">NULL</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Normalerweise beginnen wir damit, Speicher zuzuweisen und das Eingabeformat zu öffnen. </font><font style="vertical-align: inherit;">In diesem speziellen Fall öffnen wir die Eingabedatei und weisen der Ausgabedatei Speicher zu:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">if</span> ((ret = avformat_open_input(&amp;input_format_context, in_filename, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>)) &lt; <span class="hljs-number">0</span>) {
  <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"Could not open input file '%s'"</span>, in_filename);
  <span class="hljs-keyword">goto</span> end;<font></font>
}<font></font>
<span class="hljs-keyword">if</span> ((ret = avformat_find_stream_info(input_format_context, <span class="hljs-literal">NULL</span>)) &lt; <span class="hljs-number">0</span>) {
  <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"Failed to retrieve input stream information"</span>);
  <span class="hljs-keyword">goto</span> end;<font></font>
}<font></font>
<font></font>
avformat_alloc_output_context2(&amp;output_format_context, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>, out_filename);
<span class="hljs-keyword">if</span> (!output_format_context) {
  <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"Could not create output context\n"</span>);<font></font>
  ret = AVERROR_UNKNOWN;<font></font>
  <span class="hljs-keyword">goto</span> end;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir werden nur Streams von Video, Audio und Untertiteln remultiplexen. </font><font style="vertical-align: inherit;">Daher legen wir fest, welche Flows in einem Array von Indizes verwendet werden:</font></font><br>
<br>
<pre><code class="cpp hljs">number_of_streams = input_format_context-&gt;nb_streams;<font></font>
streams_list = av_mallocz_array(number_of_streams, <span class="hljs-keyword">sizeof</span>(*streams_list));</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unmittelbar nachdem wir den erforderlichen Speicher zugewiesen haben, müssen wir alle Streams durchlaufen und für jeden einen neuen Ausgabestream in unserem Kontext des Ausgabeformats mit der Funktion </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">avformat_new_stream erstellen</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Bitte beachten Sie, dass wir alle Streams markieren, die keine Video-, Audio- oder Untertitel sind, damit wir sie überspringen können.</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; input_format_context-&gt;nb_streams; i++) {<font></font>
  AVStream *out_stream;<font></font>
  AVStream *in_stream = input_format_context-&gt;streams[i];<font></font>
  AVCodecParameters *in_codecpar = in_stream-&gt;codecpar;<font></font>
  <span class="hljs-keyword">if</span> (in_codecpar-&gt;codec_type != AVMEDIA_TYPE_AUDIO &amp;&amp;<font></font>
      in_codecpar-&gt;codec_type != AVMEDIA_TYPE_VIDEO &amp;&amp;<font></font>
      in_codecpar-&gt;codec_type != AVMEDIA_TYPE_SUBTITLE) {<font></font>
    streams_list[i] = <span class="hljs-number">-1</span>;
    <span class="hljs-keyword">continue</span>;<font></font>
  }<font></font>
  streams_list[i] = stream_index++;<font></font>
  out_stream = avformat_new_stream(output_format_context, <span class="hljs-literal">NULL</span>);
  <span class="hljs-keyword">if</span> (!out_stream) {
    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"Failed allocating output stream\n"</span>);<font></font>
    ret = AVERROR_UNKNOWN;<font></font>
    <span class="hljs-keyword">goto</span> end;<font></font>
  }<font></font>
  ret = avcodec_parameters_copy(out_stream-&gt;codecpar, in_codecpar);<font></font>
  <span class="hljs-keyword">if</span> (ret &lt; <span class="hljs-number">0</span>) {
    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"Failed to copy codec parameters\n"</span>);
    <span class="hljs-keyword">goto</span> end;<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Erstellen Sie nun die Ausgabedatei:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">if</span> (!(output_format_context-&gt;oformat-&gt;flags &amp; AVFMT_NOFILE)) {<font></font>
  ret = avio_open(&amp;output_format_context-&gt;pb, out_filename, AVIO_FLAG_WRITE);<font></font>
  <span class="hljs-keyword">if</span> (ret &lt; <span class="hljs-number">0</span>) {
    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"Could not open output file '%s'"</span>, out_filename);
    <span class="hljs-keyword">goto</span> end;<font></font>
  }<font></font>
}<font></font>
<font></font>
ret = avformat_write_header(output_format_context, <span class="hljs-literal">NULL</span>);
<span class="hljs-keyword">if</span> (ret &lt; <span class="hljs-number">0</span>) {
  <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"Error occurred when opening output file\n"</span>);
  <span class="hljs-keyword">goto</span> end;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Danach können Sie Streams Paket für Paket von unseren Eingaben in unsere Ausgabestreams kopieren. </font><font style="vertical-align: inherit;">Dies geschieht in einer Schleife, solange es Pakete ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">av_read_frame</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) gibt. Für jedes Paket müssen Sie </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PTS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DTS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> neu berechnen </font><font style="vertical-align: inherit;">, um es schließlich ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">av_interleaved_write_frame</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) in unseren Kontext des Ausgabeformats </font><font style="vertical-align: inherit;">zu schreiben </font><font style="vertical-align: inherit;">.</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>) {<font></font>
  AVStream *in_stream, *out_stream;<font></font>
  ret = av_read_frame(input_format_context, &amp;packet);<font></font>
  <span class="hljs-keyword">if</span> (ret &lt; <span class="hljs-number">0</span>)
    <span class="hljs-keyword">break</span>;<font></font>
  in_stream  = input_format_context-&gt;streams[packet.stream_index];<font></font>
  <span class="hljs-keyword">if</span> (packet.stream_index &gt;= number_of_streams || streams_list[packet.stream_index] &lt; <span class="hljs-number">0</span>) {<font></font>
    av_packet_unref(&amp;packet);<font></font>
    <span class="hljs-keyword">continue</span>;<font></font>
  }<font></font>
  packet.stream_index = streams_list[packet.stream_index];<font></font>
  out_stream = output_format_context-&gt;streams[packet.stream_index];<font></font>
  <span class="hljs-comment">/* copy packet */</span><font></font>
  packet.pts = av_rescale_q_rnd(packet.pts, in_stream-&gt;time_base, out_stream-&gt;time_base, AV_ROUND_NEAR_INF|AV_ROUND_PASS_MINMAX);<font></font>
  packet.dts = av_rescale_q_rnd(packet.dts, in_stream-&gt;time_base, out_stream-&gt;time_base, AV_ROUND_NEAR_INF|AV_ROUND_PASS_MINMAX);<font></font>
  packet.duration = av_rescale_q(packet.duration, in_stream-&gt;time_base, out_stream-&gt;time_base);<font></font>
  <span class="hljs-comment">// https://ffmpeg.org/doxygen/trunk/structAVPacket.html#ab5793d8195cf4789dfb3913b7a693903</span>
  packet.pos = <span class="hljs-number">-1</span>;<font></font>
<font></font>
  <span class="hljs-comment">//https://ffmpeg.org/doxygen/trunk/group__lavf__encoding.html#ga37352ed2c63493c38219d935e71db6c1</span><font></font>
  ret = av_interleaved_write_frame(output_format_context, &amp;packet);<font></font>
  <span class="hljs-keyword">if</span> (ret &lt; <span class="hljs-number">0</span>) {
    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"Error muxing packet\n"</span>);
    <span class="hljs-keyword">break</span>;<font></font>
  }<font></font>
  av_packet_unref(&amp;packet);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zum Abschluss müssen wir den Stream-Trailer mit der Funktion </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">av_write_trailer</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in die Ausgabemediendatei </font><b><font style="vertical-align: inherit;">schreiben</font></b><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="cpp hljs">av_write_trailer(output_format_context);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt können wir den Code testen. </font><font style="vertical-align: inherit;">Der erste Test ist die Konvertierung des Formats (Videocontainers) von MP4 in eine MPEG-TS-Videodatei. </font><font style="vertical-align: inherit;">Grundsätzlich erstellen wir eine Befehlszeile ffmpeg input.mp4 -c, um output.ts mit libav zu kopieren.</font></font><br>
<br>
<pre><code class="bash hljs">make run_remuxing_ts</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es klappt! </font><font style="vertical-align: inherit;">Glaube mir nicht ?! </font><font style="vertical-align: inherit;">Überprüfen Sie mit </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ffprobe</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="bash hljs">ffprobe -i remuxed_small_bunny_1080p_60fps.ts<font></font>
<font></font>
Input <span class="hljs-comment">#0, mpegts, from 'remuxed_small_bunny_1080p_60fps.ts':</span><font></font>
  Duration: 00:00:10.03, start: 0.000000, bitrate: 2751 kb/s<font></font>
  Program 1<font></font>
    Metadata:<font></font>
      service_name    : Service01<font></font>
      service_provider: FFmpeg<font></font>
    Stream <span class="hljs-comment">#0:0[0x100]: Video: h264 (High) ([27][0][0][0] / 0x001B), yuv420p(progressive), 1920x1080 [SAR 1:1 DAR 16:9], 60 fps, 60 tbr, 90k tbn, 120 tbc</span>
    Stream <span class="hljs-comment">#0:1[0x101]: Audio: ac3 ([129][0][0][0] / 0x0081), 48000 Hz, 5.1(side), fltp, 320 kb/s</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um zusammenzufassen, was wir getan haben, können wir jetzt zu unserer ursprünglichen Vorstellung zurückkehren, wie libav funktioniert. </font><font style="vertical-align: inherit;">Wir haben jedoch einen Teil des Codecs verpasst, der im Diagramm angezeigt wird.</font></font><br>
<br>
<div style="text-align:center;"><img width="750" height="415" src="https://habrastorage.org/webt/_i/vz/yw/_ivzywrkd4le_hfwqyf-7hhrcb8.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bevor wir dieses Kapitel beenden, möchte ich einen so wichtigen Teil des Remultiplexing-Prozesses zeigen, bei dem Sie Parameter an den Multiplexer übergeben können. </font><font style="vertical-align: inherit;">Angenommen, Sie möchten das MPEG-DASH-Format bereitstellen, sodass Sie fragmentiertes mp4 (manchmal auch als </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fmp4 bezeichnet</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) anstelle von MPEG-TS oder </font><b><font style="vertical-align: inherit;">normalem</font></b><font style="vertical-align: inherit;"> MPEG-4 verwenden müssen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Verwendung der Befehlszeile ist einfach:</font></font><br>
<br>
<pre><code class="bash hljs">ffmpeg -i non_fragmented.mp4 -movflags frag_keyframe+empty_moov+default_base_moof fragmented.mp4</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In der libav-Version ist dies fast so einfach. Wir übergeben die Optionen einfach beim Schreiben des Ausgabeheaders unmittelbar vor dem Kopieren der Pakete:</font></font><br>
<br>
<pre><code class="cpp hljs">AVDictionary* opts = <span class="hljs-literal">NULL</span>;<font></font>
av_dict_set(&amp;opts, <span class="hljs-string">"movflags"</span>, <span class="hljs-string">"frag_keyframe+empty_moov+default_base_moof"</span>, <span class="hljs-number">0</span>);<font></font>
ret = avformat_write_header(output_format_context, &amp;opts);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt können wir diese fragmentierte mp4-Datei generieren:</font></font><br>
<br>
<pre><code class="bash hljs">make run_remuxing_fragmented_mp4</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um sicherzustellen, dass alles fair ist, können Sie die erstaunliche </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tool-</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Site </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">gpac / mp4box.js</font></a><font style="vertical-align: inherit;"> oder </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://mp4parser.com/ verwenden</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , um die Unterschiede zu erkennen - laden Sie zuerst mp4 herunter.</font></font><br>
<br>
<img align="left" width="212" height="81" src="https://habrastorage.org/webt/x5/hw/9u/x5hw9uxcdgvl36yvns8hkquzlca.png"><div style="text-align:center;"><img width="750" height="1" src="https://habrastorage.org/webt/nz/x-/lg/nzx-lgxsv_fsqphsci0i8gabhfi.gif"></div><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wie Sie sehen können, hat es einen unteilbaren </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mdat-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Block </font><font style="vertical-align: inherit;">- dies ist der Ort, an dem sich die Video- und Audio-Frames befinden. </font><font style="vertical-align: inherit;">Laden Sie jetzt fragmentiertes mp4 herunter, um zu sehen, wie es mdat-Blöcke erweitert:</font></font><br>
<br>
<img align="left" width="184" height="140" src="https://habrastorage.org/webt/pu/bv/mm/pubvmm5ogancxewrdxfgdth1d34.png"><div style="text-align:center;"><img width="750" height="1" src="https://habrastorage.org/webt/nz/x-/lg/nzx-lgxsv_fsqphsci0i8gabhfi.gif"></div><a name="chapter_3"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kapitel 3 - Transcodierung </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">↑</font></font></a></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
TLDR </font><font style="vertical-align: inherit;">zeig mir den Code und die Ausführung:</font></font><br>
<br>
<pre><code class="bash hljs">$ make run_transcoding</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir werden einige Details überspringen, aber keine Sorge: Der Quellcode </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ist</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> auf github </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">verfügbar</font></a><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In diesem Kapitel erstellen wir einen in C geschriebenen minimalistischen Transcoder, der Videos mit den libav-Bibliotheken FFmpeg, insbesondere </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">libavcodec</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">libavformat</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">libavutil</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , von H264 nach H265 </font><b><font style="vertical-align: inherit;">konvertieren kann</font></b><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<div style="text-align:center;"><img width="750" height="396" src="https://habrastorage.org/webt/pw/zj/ys/pwzjys-eok7ggnpkztlv7n60njm.png"></div><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AVFormatContext</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ist eine Abstraktion für das Mediendateiformat, d. H. </font><font style="vertical-align: inherit;">Für einen Container (MKV, MP4, Webm, TS) </font><font style="vertical-align: inherit;">repräsentiert </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AVStream</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> jeden Datentyp für ein bestimmtes Format (z. B. Audio, Video, Untertitel, Metadaten). </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AVPacket</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ist ein Fragment komprimierter Daten, die von </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AVStream </font></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">empfangen werden</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und beispielsweise </font><font style="vertical-align: inherit;">mit </font><b><font style="vertical-align: inherit;">AVCodec</font></b><font style="vertical-align: inherit;"> decodiert werden </font><b><font style="vertical-align: inherit;">können</font></b><font style="vertical-align: inherit;"> : av1, h264, vp9, hevc) Generieren von Rohdaten namens </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AVFrame</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<a name="cahpter_3_transmuxing"></a><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Transmultiplexing </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">↑</font></font></a></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beginnen wir mit einer einfachen Konvertierung und laden dann die Eingabedatei.</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">// Allocate an AVFormatContext</span><font></font>
avfc = avformat_alloc_context();<font></font>
<span class="hljs-comment">// Open an input stream and read the header.</span>
avformat_open_input(avfc, in_filename, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>);
<span class="hljs-comment">// Read packets of a media file to get stream information.</span>
avformat_find_stream_info(avfc, <span class="hljs-literal">NULL</span>);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Konfigurieren Sie nun den Decoder. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mit AVFormatContext erhalten</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> wir Zugriff auf alle Komponenten von </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AVStream</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Für jede </font><font style="vertical-align: inherit;">Komponente </font><font style="vertical-align: inherit;">können wir ihren </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AVCodec abrufen</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und einen bestimmten </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AVCodecContext</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> erstellen </font><font style="vertical-align: inherit;">. Und schließlich können wir diesen Codec öffnen, um zum Dekodierungsprozess zu gelangen. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AVCodecContext</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> enthält Medienkonfigurationsdaten wie Datenrate, Bildrate, Abtastrate, Kanäle, Tonhöhe und viele andere.</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; avfc-&gt;nb_streams; i++) {<font></font>
  AVStream *avs = avfc-&gt;streams[i];<font></font>
  AVCodec *avc = avcodec_find_decoder(avs-&gt;codecpar-&gt;codec_id);<font></font>
  AVCodecContext *avcc = avcodec_alloc_context3(*avc);<font></font>
  avcodec_parameters_to_context(*avcc, avs-&gt;codecpar);<font></font>
  avcodec_open2(*avcc, *avc, <span class="hljs-literal">NULL</span>);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sie müssen auch die Ausgabemediendatei für die Konvertierung vorbereiten. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Weisen Sie zunächst</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Speicher für die Ausgabe </font><b><font style="vertical-align: inherit;">AVFormatContext zu</font></b><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Erstellen Sie jeden Stream im Ausgabeformat. </font><font style="vertical-align: inherit;">Kopieren Sie die Codec-Parameter vom Decoder, um den Stream ordnungsgemäß zu verpacken. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setzen Sie das Flag </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AV_CODEC_FLAG_GLOBAL_HEADER</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , das dem Encoder mitteilt, dass er globale Header verwenden kann, und öffnen Sie schließlich die Ausgabedatei zum Schreiben und Speichern der Header:</font></font><br>
<br>
<pre><code class="cpp hljs">avformat_alloc_output_context2(&amp;encoder_avfc, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>, out_filename);<font></font>
<font></font>
AVStream *avs = avformat_new_stream(encoder_avfc, <span class="hljs-literal">NULL</span>);<font></font>
avcodec_parameters_copy(avs-&gt;codecpar, decoder_avs-&gt;codecpar);<font></font>
<font></font>
<span class="hljs-keyword">if</span> (encoder_avfc-&gt;oformat-&gt;flags &amp; AVFMT_GLOBALHEADER)<font></font>
  encoder_avfc-&gt;flags |= AV_CODEC_FLAG_GLOBAL_HEADER;<font></font>
<font></font>
avio_open(&amp;encoder_avfc-&gt;pb, encoder-&gt;filename, AVIO_FLAG_WRITE);<font></font>
avformat_write_header(encoder-&gt;avfc, &amp;muxer_opts);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">erhalten AVPacket</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> vom Decoder, passen die Zeitstempel an und schreiben das Paket korrekt in die Ausgabedatei. </font><font style="vertical-align: inherit;">Trotz der Tatsache, dass die Funktion </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">av_interleaved_write_frame</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Write Frame</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " </font><font style="vertical-align: inherit;">meldet </font><font style="vertical-align: inherit;">, speichern wir das Paket. </font><font style="vertical-align: inherit;">Wir schließen den Permutationsprozess ab, indem wir den Stream-Trailer in eine Datei schreiben.</font></font><br>
<br>
<pre><code class="cpp hljs">AVFrame *input_frame = av_frame_alloc();<font></font>
AVPacket *input_packet = av_packet_alloc();<font></font>
<font></font>
<span class="hljs-keyword">while</span>(av_read_frame(decoder_avfc, input_packet) &gt;= <span class="hljs-number">0</span>) {<font></font>
  av_packet_rescale_ts(input_packet, decoder_video_avs-&gt;time_base, encoder_video_avs-&gt;time_base);<font></font>
  av_interleaved_write_frame(*avfc, input_packet) &lt; <span class="hljs-number">0</span>));<font></font>
}<font></font>
<font></font>
av_write_trailer(encoder_avfc);</code></pre><br>
<a name="cahpter_3_transcoding"></a><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Umcodierung </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">↑</font></font></a></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im vorherigen Abschnitt gab es ein einfaches Programm zur Konvertierung. Jetzt werden wir die Möglichkeit hinzufügen, Dateien zu codieren, insbesondere Videos von </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">h264</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nach </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">h265</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> zu </font><b><font style="vertical-align: inherit;">transkodieren</font></b><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Konfigurieren Sie den Encoder, nachdem der Decoder vorbereitet wurde, aber bevor Sie die Ausgabemediendatei organisieren.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erstellen Sie einen Video- </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AVStream</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> im Encoder </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">avformat_new_stream</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir verwenden </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AVCodec</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mit dem Namen </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">libx265</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">avcodec_find_encoder_by_name</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erstellen Sie einen </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AVCodecContext</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> basierend auf dem erstellten </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Codecode avcodec_alloc_context3</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Legen Sie die grundlegenden Attribute für eine Transcodierungssitzung fest und ...</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">... öffnen Sie den Codec und kopieren Sie die Parameter aus dem Kontext in den Stream ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">avcodec_open2</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">avcodec_parameters_from_context</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).</font></font></li>
</ul><br>
<pre><code class="cpp hljs">AVRational input_framerate = av_guess_frame_rate(decoder_avfc, decoder_video_avs, <span class="hljs-literal">NULL</span>);<font></font>
AVStream *video_avs = avformat_new_stream(encoder_avfc, <span class="hljs-literal">NULL</span>);<font></font>
<font></font>
<span class="hljs-keyword">char</span> *codec_name = <span class="hljs-string">"libx265"</span>;
<span class="hljs-keyword">char</span> *codec_priv_key = <span class="hljs-string">"x265-params"</span>;
<span class="hljs-comment">// we're going to use internal options for the x265</span>
<span class="hljs-comment">// it disables the scene change detection and fix then</span>
<span class="hljs-comment">// GOP on 60 frames.</span>
<span class="hljs-keyword">char</span> *codec_priv_value = <span class="hljs-string">"keyint=60:min-keyint=60:scenecut=0"</span>;<font></font>
<font></font>
AVCodec *video_avc = avcodec_find_encoder_by_name(codec_name);<font></font>
AVCodecContext *video_avcc = avcodec_alloc_context3(video_avc);<font></font>
<span class="hljs-comment">// encoder codec params</span>
av_opt_set(sc-&gt;video_avcc-&gt;priv_data, codec_priv_key, codec_priv_value, <span class="hljs-number">0</span>);<font></font>
video_avcc-&gt;height = decoder_ctx-&gt;height;<font></font>
video_avcc-&gt;width = decoder_ctx-&gt;width;<font></font>
video_avcc-&gt;pix_fmt = video_avc-&gt;pix_fmts[<span class="hljs-number">0</span>];
<span class="hljs-comment">// control rate</span>
video_avcc-&gt;bit_rate = <span class="hljs-number">2</span> * <span class="hljs-number">1000</span> * <span class="hljs-number">1000</span>;<font></font>
video_avcc-&gt;rc_buffer_size = <span class="hljs-number">4</span> * <span class="hljs-number">1000</span> * <span class="hljs-number">1000</span>;<font></font>
video_avcc-&gt;rc_max_rate = <span class="hljs-number">2</span> * <span class="hljs-number">1000</span> * <span class="hljs-number">1000</span>;<font></font>
video_avcc-&gt;rc_min_rate = <span class="hljs-number">2.5</span> * <span class="hljs-number">1000</span> * <span class="hljs-number">1000</span>;
<span class="hljs-comment">// time base</span><font></font>
video_avcc-&gt;time_base = av_inv_q(input_framerate);<font></font>
video_avs-&gt;time_base = sc-&gt;video_avcc-&gt;time_base;<font></font>
<font></font>
avcodec_open2(sc-&gt;video_avcc, sc-&gt;video_avc, <span class="hljs-literal">NULL</span>);<font></font>
avcodec_parameters_from_context(sc-&gt;video_avs-&gt;codecpar, sc-&gt;video_avcc);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es ist notwendig, den Decodierungszyklus zum Transcodieren eines Videostreams zu erweitern:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir senden ein leeres </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AVPacket an den</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Decoder ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">avcodec_send_packet</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).</font></font></li>
<li><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Holen Sie sich den</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> unkomprimierten </font><b><font style="vertical-align: inherit;">AVFrame</font></b><font style="vertical-align: inherit;"> ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">avcodec_receive_frame</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir beginnen mit der Neukodierung des Rohrahmens.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir senden den </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rohrahmen</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font><b><font style="vertical-align: inherit;">avcodec_send_frame</font></b><font style="vertical-align: inherit;"> ).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">erhalten eine</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Komprimierung basierend auf unserem </font><b><font style="vertical-align: inherit;">AVPacket-</font></b><font style="vertical-align: inherit;"> Codec </font><font style="vertical-align: inherit;">( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">avcodec_receive_packet</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).</font></font></li>
<li><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Legen</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Sie den Zeitstempel fest ( </font><b><font style="vertical-align: inherit;">av_packet_rescale_ts</font></b><font style="vertical-align: inherit;"> ).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir schreiben in die Ausgabedatei ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">av_interleaved_write_frame</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).</font></font></li>
</ul><br>
<pre><code class="cpp hljs">AVFrame *input_frame = av_frame_alloc();<font></font>
AVPacket *input_packet = av_packet_alloc();<font></font>
<font></font>
<span class="hljs-keyword">while</span> (av_read_frame(decoder_avfc, input_packet) &gt;= <span class="hljs-number">0</span>)<font></font>
{<font></font>
  <span class="hljs-keyword">int</span> response = avcodec_send_packet(decoder_video_avcc, input_packet);
  <span class="hljs-keyword">while</span> (response &gt;= <span class="hljs-number">0</span>) {<font></font>
    response = avcodec_receive_frame(decoder_video_avcc, input_frame);<font></font>
    <span class="hljs-keyword">if</span> (response == AVERROR(EAGAIN) || response == AVERROR_EOF) {
      <span class="hljs-keyword">break</span>;<font></font>
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (response &lt; <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">return</span> response;<font></font>
    }<font></font>
    <span class="hljs-keyword">if</span> (response &gt;= <span class="hljs-number">0</span>) {<font></font>
      encode(encoder_avfc, decoder_video_avs, encoder_video_avs, decoder_video_avcc, input_packet-&gt;stream_index);<font></font>
    }<font></font>
    av_frame_unref(input_frame);<font></font>
  }<font></font>
  av_packet_unref(input_packet);<font></font>
}<font></font>
av_write_trailer(encoder_avfc);<font></font>
<font></font>
<span class="hljs-comment">// used function</span>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">encode</span><span class="hljs-params">(AVFormatContext *avfc, AVStream *dec_video_avs, AVStream *enc_video_avs, AVCodecContext video_avcc <span class="hljs-keyword">int</span> index)</span> </span>{<font></font>
  AVPacket *output_packet = av_packet_alloc();<font></font>
  <span class="hljs-keyword">int</span> response = avcodec_send_frame(video_avcc, input_frame);<font></font>
<font></font>
  <span class="hljs-keyword">while</span> (response &gt;= <span class="hljs-number">0</span>) {<font></font>
    response = avcodec_receive_packet(video_avcc, output_packet);<font></font>
    <span class="hljs-keyword">if</span> (response == AVERROR(EAGAIN) || response == AVERROR_EOF) {
      <span class="hljs-keyword">break</span>;<font></font>
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (response &lt; <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<font></font>
    }<font></font>
<font></font>
    output_packet-&gt;stream_index = index;<font></font>
    output_packet-&gt;duration = enc_video_avs-&gt;time_base.den / enc_video_avs-&gt;time_base.num / dec_video_avs-&gt;avg_frame_rate.num * dec_video_avs-&gt;avg_frame_rate.den;<font></font>
<font></font>
    av_packet_rescale_ts(output_packet, dec_video_avs-&gt;time_base, enc_video_avs-&gt;time_base);<font></font>
    response = av_interleaved_write_frame(avfc, output_packet);<font></font>
  }<font></font>
  av_packet_unref(output_packet);<font></font>
  av_packet_free(&amp;output_packet);<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben den Medienstrom von </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">h264</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> auf </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">h265 konvertiert</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Wie erwartet ist die Version der h265-Mediendatei kleiner als die h264, während das Programm zahlreiche Möglichkeiten bietet:</font></font><br>
<br>
<pre><code class="cpp hljs">  <span class="hljs-comment">/*
   * H264 -&gt; H265
   * Audio -&gt; remuxed (untouched)
   * MP4 - MP4
   */</span>
  StreamingParams sp = {<span class="hljs-number">0</span>};<font></font>
  sp.copy_audio = <span class="hljs-number">1</span>;<font></font>
  sp.copy_video = <span class="hljs-number">0</span>;<font></font>
  sp.video_codec = <span class="hljs-string">"libx265"</span>;<font></font>
  sp.codec_priv_key = <span class="hljs-string">"x265-params"</span>;<font></font>
  sp.codec_priv_value = <span class="hljs-string">"keyint=60:min-keyint=60:scenecut=0"</span>;<font></font>
<font></font>
  <span class="hljs-comment">/*
   * H264 -&gt; H264 (fixed gop)
   * Audio -&gt; remuxed (untouched)
   * MP4 - MP4
   */</span>
  StreamingParams sp = {<span class="hljs-number">0</span>};<font></font>
  sp.copy_audio = <span class="hljs-number">1</span>;<font></font>
  sp.copy_video = <span class="hljs-number">0</span>;<font></font>
  sp.video_codec = <span class="hljs-string">"libx264"</span>;<font></font>
  sp.codec_priv_key = <span class="hljs-string">"x264-params"</span>;<font></font>
  sp.codec_priv_value = <span class="hljs-string">"keyint=60:min-keyint=60:scenecut=0:force-cfr=1"</span>;<font></font>
<font></font>
  <span class="hljs-comment">/*
   * H264 -&gt; H264 (fixed gop)
   * Audio -&gt; remuxed (untouched)
   * MP4 - fragmented MP4
   */</span>
  StreamingParams sp = {<span class="hljs-number">0</span>};<font></font>
  sp.copy_audio = <span class="hljs-number">1</span>;<font></font>
  sp.copy_video = <span class="hljs-number">0</span>;<font></font>
  sp.video_codec = <span class="hljs-string">"libx264"</span>;<font></font>
  sp.codec_priv_key = <span class="hljs-string">"x264-params"</span>;<font></font>
  sp.codec_priv_value = <span class="hljs-string">"keyint=60:min-keyint=60:scenecut=0:force-cfr=1"</span>;<font></font>
  sp.muxer_opt_key = <span class="hljs-string">"movflags"</span>;<font></font>
  sp.muxer_opt_value = <span class="hljs-string">"frag_keyframe+empty_moov+default_base_moof"</span>;<font></font>
<font></font>
  <span class="hljs-comment">/*
   * H264 -&gt; H264 (fixed gop)
   * Audio -&gt; AAC
   * MP4 - MPEG-TS
   */</span>
  StreamingParams sp = {<span class="hljs-number">0</span>};<font></font>
  sp.copy_audio = <span class="hljs-number">0</span>;<font></font>
  sp.copy_video = <span class="hljs-number">0</span>;<font></font>
  sp.video_codec = <span class="hljs-string">"libx264"</span>;<font></font>
  sp.codec_priv_key = <span class="hljs-string">"x264-params"</span>;<font></font>
  sp.codec_priv_value = <span class="hljs-string">"keyint=60:min-keyint=60:scenecut=0:force-cfr=1"</span>;<font></font>
  sp.audio_codec = <span class="hljs-string">"aac"</span>;<font></font>
  sp.output_extension = <span class="hljs-string">".ts"</span>;<font></font>
<font></font>
  <span class="hljs-comment">/* WIP :P  -&gt; it's not playing on VLC, the final bit rate is huge
   * H264 -&gt; VP9
   * Audio -&gt; Vorbis
   * MP4 - WebM
   */</span>
  <span class="hljs-comment">//StreamingParams sp = {0};</span>
  <span class="hljs-comment">//sp.copy_audio = 0;</span>
  <span class="hljs-comment">//sp.copy_video = 0;</span>
  <span class="hljs-comment">//sp.video_codec = "libvpx-vp9";</span>
  <span class="hljs-comment">//sp.audio_codec = "libvorbis";</span>
  <span class="hljs-comment">//sp.output_extension = ".webm";</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hand aufs Herz, ich gestehe, dass es etwas komplizierter war, als es am Anfang schien. </font><font style="vertical-align: inherit;">Ich musste den FFmpeg-Befehlszeilen-Quellcode auswählen und viel testen. </font><font style="vertical-align: inherit;">Wahrscheinlich habe ich irgendwo etwas verpasst, weil ich </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">force-cfr</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> für </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">h264 verwenden</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> musste und immer noch einige Warnmeldungen </font><b><font style="vertical-align: inherit;">angezeigt</font></b><font style="vertical-align: inherit;"> werden, zum Beispiel, dass der Rahmentyp (5) zwangsweise in den Rahmentyp (3) geändert wurde.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Übersetzungen im Edison Blog:</font></font></h3><div class="scrollable-table"><table>
<tbody><tr>
<td align="center"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><img width="360" height="180" src="https://habrastorage.org/webt/fr/yz/q7/fryzq72v0ik0irt2q4orchflxvs.jpeg"></a></td>
<td align="center"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><img width="360" height="180" src="https://habrastorage.org/webt/jv/3k/-f/jv3k-f5vi9drztohsh-e0t-puru.jpeg"></a></td>
</tr>
<tr>
<th align="center"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Top 50 Gaming-Franchise-Unternehmen </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mit über einer Milliarde Einnahmen</font></font></a></th>
<th align="center"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">  Airbnb ?<br>
[: ]</a></th>
</tr>
</tbody></table></div></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de495604/index.html">Temporäre Lokalisierung auf Symfony 4 + Twig</a></li>
<li><a href="../de495606/index.html">"Soziale Überwachung." Ergebnis 1: 0 zu unseren Gunsten</a></li>
<li><a href="../de495608/index.html">[Infografik] Visualisierung von Pandemien in der Geschichte der Menschheit</a></li>
<li><a href="../de495610/index.html">Warum die Zukunft nicht für Python ist</a></li>
<li><a href="../de495612/index.html">Wird Airbnb das Coronavirus überleben? [Spoiler: ja]</a></li>
<li><a href="../de495618/index.html">Quarantäne führt zu Verlusten. Wie lebe ich ohne Quarantäne?</a></li>
<li><a href="../de495620/index.html">Montierte einen Videokonferenz-Harvester bei Jabra Panacast, Vor- und Nachteile für Büro und Zuhause</a></li>
<li><a href="../de495622/index.html">Flugzeuge mit digitaler Doppelklimaanlage (SLE)</a></li>
<li><a href="../de495624/index.html">Warum die Xbox Series X der Hauptkauf von 2020 sein wird</a></li>
<li><a href="../de495634/index.html">Jeder tut es: Warum Mitarbeiter die Hauptbedrohung für die Informationssicherheit von Unternehmen darstellen und wie damit umzugehen ist</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>