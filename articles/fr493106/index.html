<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üò† ‚òùüèø üîµ Quelle est la nouveaut√© de la Devil's Dozen? üåØ üíó üë®üèΩ‚Äçüíº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Nous ne parlons que de PostgreSQL 13. Le 8 avril, un ¬´gel¬ª a eu lieu - le gel des fonctionnalit√©s de PostgreSQL , d√©sormais seules les fonctionnalit√©s...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Quelle est la nouveaut√© de la Devil's Dozen?</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/postgrespro/blog/493106/"><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous ne parlons que de PostgreSQL 13. Le 8 avril, un ¬´gel¬ª a eu lieu - le </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gel des fonctionnalit√©s de</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> PostgreSQL </font><font style="vertical-align: inherit;">, d√©sormais seules les fonctionnalit√©s accept√©es avant cette date seront incluses dans cette version. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il est difficile de nommer une version r√©volutionnaire de cela. </font><font style="vertical-align: inherit;">Il n'y a aucun changement conceptuel cardinal. </font><font style="vertical-align: inherit;">De plus, des correctifs aussi importants que Table et Fonctions pour la norme JSON / SQL, que je voulais voir dans PG12 √† c√¥t√© du correctif JSONPath, n'ont pas eu le temps de le saisir; </font><font style="vertical-align: inherit;">le stockage int√©gr√© pr√™t √† l'emploi n'appara√Æt pas - seule l'interface est en cours de finalisation. </font><font style="vertical-align: inherit;">Mais la liste des am√©liorations est toujours impressionnante. </font><font style="vertical-align: inherit;">Nous avons pr√©par√© un r√©sum√© assez complet des correctifs inclus dans la Devil's Dozen.</font></font></i><br>
<br>
<hr><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Modifications des commandes SQL</font></font></h3><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE DATABASE ... LOCALE</font></font></b></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Utilities</font></font><code>initdb</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font><code>createdb</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et l'√©quipe</font></font><code>CREATE COLLATION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ont un param√®tre</font></font><code>LOCALE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qui vous permet de sp√©cifier des valeurs pour le droit</font></font><code>LC_CTYPE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et</font></font><code>LC_COLLATE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Maintenant, la m√™me opportunit√© est apparue dans l'√©quipe</font></font><code>CREATE DATABASE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">DATABASE</span> db_koi8r <span class="hljs-keyword">TEMPLATE</span> template0 
    <span class="hljs-keyword">ENCODING</span> <span class="hljs-string">'KOI8R'</span> LOCALE <span class="hljs-string">'ru_RU.KOI8R'</span>;</code></pre><a name="habracut"></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ALTER VIEW ... RENAME COLUMN</font></font></b></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Le nom de la colonne dans la vue peut maintenant √™tre modifi√© avec la commande</font></font><code>ALTER VIEW</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Auparavant, cela n√©cessitait de recr√©er la vue. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Supposons que vous ayez oubli√© de donner un nom √† la colonne:</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">VIEW</span> uptime <span class="hljs-keyword">AS</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">current_timestamp</span>, <span class="hljs-built_in">current_timestamp</span> - pg_postmaster_start_time();
<span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> uptime;</code></pre><br>
<pre><code class="plaintext hljs">       current_timestamp       |    ?column?     <font></font>
-------------------------------+-----------------<font></font>
 2020-03-23 15:37:00.088824+03 | 04:18:24.897856</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il peut √™tre corrig√©:</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">VIEW</span> uptime <span class="hljs-keyword">RENAME</span> <span class="hljs-keyword">COLUMN</span> "?column?" <span class="hljs-keyword">TO</span> uptime;
<span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> uptime;</code></pre><br>
<pre><code class="plaintext hljs">       current_timestamp       |     uptime      <font></font>
-------------------------------+-----------------<font></font>
 2020-03-23 15:37:40.726516+03 | 04:19:05.535548</code></pre><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ALTER TABLE ... ALTER COLUMN ... DROP EXPRESSION</font></font></b></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
La colonne g√©n√©r√©e de la table peut maintenant √™tre rendue normale, c'est-√†-dire supprimer l'expression pour l'√©valuer:</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> payments (<font></font>
    id <span class="hljs-type">integer</span> <span class="hljs-keyword">PRIMARY KEY</span>,<font></font>
    amount <span class="hljs-type">numeric</span>(<span class="hljs-number">18</span>,<span class="hljs-number">2</span>),<font></font>
    income_tax <span class="hljs-type">numeric</span>(<span class="hljs-number">18</span>,<span class="hljs-number">2</span>) <span class="hljs-keyword">GENERATED</span> <span class="hljs-keyword">ALWAYS</span> <span class="hljs-keyword">AS</span> (amount*<span class="hljs-number">0.13</span>) STORED<font></font>
);<font></font>
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> payments(id, amount) <span class="hljs-keyword">VALUES</span>(<span class="hljs-number">1</span>, <span class="hljs-number">42</span>);<font></font>
\d payments</code></pre><br>
<pre><code class="plaintext hljs">                                     Table "public.payments"<font></font>
   Column   |     Type      | Collation | Nullable |                   Default            <font></font>
        <font></font>
------------+---------------+-----------+----------+--------------------------------------<font></font>
 id         | integer       |           | not null |<font></font>
 amount     | numeric(18,2) |           |          |<font></font>
 income_tax | numeric(18,2) |           |          | generated always as ((amount * 0.13))<font></font>
 stored<font></font>
Indexes:<font></font>
    "payments_pkey" PRIMARY KEY, btree (id)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par la suite, ils ont d√©cid√© que la taxe sur le revenu devrait √™tre explicitement d√©finie. </font><font style="vertical-align: inherit;">Supprimez l'expression:</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> payments <span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">COLUMN</span> income_tax <span class="hljs-keyword">DROP</span> EXPRESSION;<font></font>
\d payments</code></pre><br>
<pre><code class="plaintext hljs">                   Table "public.payments"<font></font>
   Column   |     Type      | Collation | Nullable | Default<font></font>
------------+---------------+-----------+----------+---------<font></font>
 id         | integer       |           | not null |<font></font>
 amount     | numeric(18,2) |           |          |<font></font>
 income_tax | numeric(18,2) |           |          |<font></font>
Indexes:<font></font>
    "payments_pkey" PRIMARY KEY, btree (id)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bien s√ªr, les donn√©es existantes de la colonne n'ont pas disparu:</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> payments;</code></pre><br>
<pre><code class="plaintext hljs"> id | amount | income_tax<font></font>
----+--------+------------<font></font>
  1 |  42.00 |       5.46</code></pre><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DROP DATABASE ... FORCE</font></font></b></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Si vous souhaitez supprimer une base de donn√©es sans attendre la d√©connexion de tous les utilisateurs, vous pouvez utiliser la nouvelle option de</font></font><code>FORCE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">commande</font></font><code>DROP DATABASE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">DATABASE</span> db;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Connectez-vous √† la nouvelle base de donn√©es:</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">EXTENSION</span> <span class="hljs-keyword">IF</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> dblink;
<span class="hljs-keyword">SELECT</span> dblink_connect(<span class="hljs-string">'dbname=db'</span>);</code></pre><br>
<pre><code class="plaintext hljs"> dblink_connect<font></font>
----------------<font></font>
 OK</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et maintenant, nous allons supprimer, interrompant de force √©galement </font></font><code>pg_terminate_backend</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, les connexions ouvertes:</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">DATABASE</span> db <span class="hljs-keyword">WITH</span> (FORCE);</code></pre><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ALTER TYPE ... SET STORAGE</font></font></b></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
La commande</font></font><code>ALTER TYPE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">permet aux types de donn√©es de base de modifier diverses propri√©t√©s, en particulier la strat√©gie de stockage. </font><font style="vertical-align: inherit;">Auparavant, vous ne pouviez le d√©finir qu'en √©quipe</font></font><code>CREATE TYPE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour la d√©monstration, nous ne cr√©erons pas de nouveau type de base, mais utiliserons le -</font></font><code>tsquery</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Mais d'abord, cr√©ez une base de donn√©es distincte et connectez-vous √† celle-ci:</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">DATABASE</span> db;<font></font>
\c db</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une strat√©gie de stockage est utilis√©e pour le type de donn√©es tsquery </font></font><code>plain</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, donc les colonnes de tables de ce type ont la m√™me strat√©gie:</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">SELECT</span> typname,typstorage <span class="hljs-keyword">FROM</span> pg_type <span class="hljs-keyword">WHERE</span> typname = <span class="hljs-string">'tsquery'</span>;</code></pre><br>
<pre><code class="plaintext hljs"> typname | typstorage<font></font>
---------+------------<font></font>
 tsquery | p</code></pre><br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> queries (query <span class="hljs-type">tsquery</span>);
<span class="hljs-keyword">SELECT</span> attname, attstorage <span class="hljs-keyword">FROM</span> pg_attribute <span class="hljs-keyword">WHERE</span> attrelid = <span class="hljs-string">'queries'</span>::<span class="hljs-type">regclass</span> <span class="hljs-keyword">AND</span> attname = <span class="hljs-string">'query'</span>;</code></pre><br>
<pre><code class="plaintext hljs"> attname | attstorage<font></font>
---------+------------<font></font>
 query   | p</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous devez utiliser une strat√©gie diff√©rente pour les nouvelles tables, vous pouvez modifier le type de base:</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TYPE</span> <span class="hljs-type">tsquery</span> <span class="hljs-keyword">SET</span> (storage=<span class="hljs-keyword">external</span>);
<span class="hljs-keyword">SELECT</span> typname,typstorage <span class="hljs-keyword">FROM</span> pg_type <span class="hljs-keyword">WHERE</span> typname = <span class="hljs-string">'tsquery'</span>;</code></pre><br>
<pre><code class="plaintext hljs"> typname | typstorage<font></font>
---------+------------<font></font>
 tsquery | e</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le type de stockage dans les nouvelles tables changera √©galement:</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> new_queries (query <span class="hljs-type">tsquery</span>);
<span class="hljs-keyword">SELECT</span> attname, attstorage <span class="hljs-keyword">FROM</span> pg_attribute <span class="hljs-keyword">WHERE</span> attrelid = <span class="hljs-string">'new_queries'</span>::<span class="hljs-type">regclass</span> <span class="hljs-keyword">AND</span> attname = <span class="hljs-string">'query'</span>;</code></pre><br>
<pre><code class="plaintext hljs"> attname | attstorage<font></font>
---------+------------<font></font>
 query   | e</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il convient de garder √† l'esprit que le changement d'une strat√©gie impliquant l'utilisation de TOAST </font></font><code>plain</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ne peut pas √™tre </font><font style="vertical-align: inherit;">chang√© en </font><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TYPE</span> <span class="hljs-type">tsquery</span> <span class="hljs-keyword">SET</span> (storage=plain);</code></pre><br>
<pre><code class="plaintext hljs">ERROR:  cannot change type's storage to PLAIN</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par cons√©quent, les exp√©riences ont √©t√© r√©alis√©es dans une base de donn√©es distincte, ce qui n'est pas dommage √† supprimer. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ALTER STATISTICS ... SET STATISTICS La</font></font></b></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
commande </font></font><code>CREATE STATISTICS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vous permet de collecter des listes des valeurs les plus courantes pour les combinaisons s√©lectionn√©es de colonnes de tableau. </font><font style="vertical-align: inherit;">Le nombre de valeurs les plus courantes collect√©es est d√©termin√© par le param√®tre </font></font><code>default_statistics_target</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">La valeur de statistiques sp√©cifiques peut maintenant √™tre modifi√©e avec la commande:</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">STATISTICS</span>  <span class="hljs-keyword">SET</span> <span class="hljs-keyword">STATISTICS</span> _;</code></pre><br>
<b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FETCH FIRST avec l'option WITH TIES</font></font></a></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Comme vous le savez,</font></font><code>SELECT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">au lieu de sp√©cifier une</font><font style="vertical-align: inherit;">commande</font><font style="vertical-align: inherit;">,</font></font><code>LIMIT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vous pouvez utiliser la syntaxe d√©finie dans le standard SQL:</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">SELECT</span> *
<span class="hljs-keyword">FROM</span> (<span class="hljs-keyword">VALUES</span> (<span class="hljs-number">1</span>,<span class="hljs-string">'1.1'</span>), (<span class="hljs-number">2</span>,<span class="hljs-string">'2.1'</span>), (<span class="hljs-number">2</span>,<span class="hljs-string">'2.2'</span>), (<span class="hljs-number">3</span>,<span class="hljs-string">'3.1'</span>)) t(a,b)
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> a
<span class="hljs-keyword">FETCH FIRST</span> <span class="hljs-number">2</span> <span class="hljs-keyword">ROWS</span> <span class="hljs-keyword">ONLY</span>;</code></pre><br>
<pre><code class="plaintext hljs"> a |  b  <font></font>
---+-----<font></font>
 1 | 1.1<font></font>
 2 | 2.1<font></font>
(2 rows)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, il </font></font><code>FETCH</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">prend </font><font style="vertical-align: inherit;">en </font><font style="vertical-align: inherit;">charge la phrase </font></font><code>WITH TIES</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, qui ajoute √† la sortie toutes les lignes "li√©es" (lignes √©gales √† celles d√©j√† s√©lectionn√©es, si seule la condition de tri est prise en compte):</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">SELECT</span> *
<span class="hljs-keyword">FROM</span> (<span class="hljs-keyword">VALUES</span> (<span class="hljs-number">1</span>,<span class="hljs-string">'1.1'</span>), (<span class="hljs-number">2</span>,<span class="hljs-string">'2.1'</span>), (<span class="hljs-number">2</span>,<span class="hljs-string">'2.2'</span>), (<span class="hljs-number">3</span>,<span class="hljs-string">'3.1'</span>)) t(a,b)
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> a
<span class="hljs-keyword">FETCH FIRST</span> <span class="hljs-number">2</span> <span class="hljs-keyword">ROWS</span> <span class="hljs-keyword">WITH</span> TIES;</code></pre><br>
<pre><code class="plaintext hljs"> a |  b  <font></font>
---+-----<font></font>
 1 | 1.1<font></font>
 2 | 2.1<font></font>
 2 | 2.2<font></font>
(3 rows)</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fonctions et types de donn√©es int√©gr√©s</font></font></h3><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">get_random_uuid La</font></font></b></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
nouvelle fonction</font></font><code>get_random_uuid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">renvoie la valeur UUID de la version 4 (valeur al√©atoire):</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">SELECT</span> gen_random_uuid();</code></pre><br>
<pre><code class="plaintext hljs">           gen_random_uuid            <font></font>
--------------------------------------<font></font>
 25e02793-80c0-438c-be07-c94b966c43ab</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La fonction est utile pour g√©n√©rer des valeurs UUID uniques dans des syst√®mes distribu√©s. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Auparavant, vous deviez utiliser les biblioth√®ques uuid-ossp ou pgcrypto. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">min_scale et trim_scale pour les valeurs de type num√©rique</font></font></b></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
La fonction </font></font><code>min_scale</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d√©termine le nombre de chiffres significatifs dans la partie fractionnaire du nombre et la fonction </font></font><code>trim_scale</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">supprime </font><font style="vertical-align: inherit;">les </font><font style="vertical-align: inherit;">z√©ros </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><b><font style="vertical-align: inherit;">non</font></b></a><font style="vertical-align: inherit;"> significatifs </font><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">SELECT</span> n, min_scale(n), trim_scale(n) <span class="hljs-keyword">FROM</span> (<span class="hljs-keyword">VALUES</span>(<span class="hljs-number">42.42000</span>)) <span class="hljs-keyword">as</span> t(n);</code></pre><br>
<pre><code class="plaintext hljs">    n     | min_scale | trim_scale<font></font>
----------+-----------+------------<font></font>
 42.42000 |         2 |      42.42</code></pre><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gcd et lcm</font></font></b></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Reconstitution dans la section des fonctions math√©matiques. </font><font style="vertical-align: inherit;">Vous pouvez maintenant trouver rapidement le plus grand diviseur commun (</font></font><code>gcm</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) et le plus petit multiple commun (</font></font><code>lcm</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">):</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">SELECT</span> gcd(<span class="hljs-number">54</span>,<span class="hljs-number">24</span>), lcm(<span class="hljs-number">54</span>,<span class="hljs-number">24</span>);</code></pre><br>
<pre><code class="plaintext hljs"> gcd | lcm<font></font>
-----+-----<font></font>
   6 | 216</code></pre><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fonctions d'agr√©gation min et max pour le type pg_lsn Des</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fonctions d'agr√©gation ont √©t√© ajout√©es pour le</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
type de donn√©es</font><font style="vertical-align: inherit;">et</font><font style="vertical-align: inherit;">cela vous permet d'effectuer des requ√™tes du formulaire:</font></font><code>pg_lsn</code><font style="vertical-align: inherit;"></font><code>min</code><font style="vertical-align: inherit;"></font><code>max</code><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">SELECT</span> min(restart_lsn) <span class="hljs-keyword">FROM</span> pg_replication_slots;
<span class="hljs-keyword">SELECT</span> min(sent_lsn) <span class="hljs-keyword">FROM</span> pg_stat_replication;</code></pre><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V√©rification du modificateur de type de la valeur de retour d'une fonction</font></font></b></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Dans les versions pr√©c√©dentes, le modificateur de type n'√©tait pas v√©rifi√© pour la valeur de retour de la fonction. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Supposons qu'il existe un type de stockage des unit√©s mon√©taires et une fonction qui renvoie le montant de l'imp√¥t sur le revenu:</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TYPE</span> currency <span class="hljs-keyword">AS</span> (<font></font>
    amount <span class="hljs-type">numeric</span>(<span class="hljs-number">18</span>,<span class="hljs-number">2</span>),<font></font>
    code   <span class="hljs-type">text</span><font></font>
);<font></font>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">FUNCTION</span> income_tax(quantity currency) <span class="hljs-keyword">RETURNS</span> currency
    <span class="hljs-keyword">AS</span> <span class="hljs-string">'SELECT quantity.amount * 0.13, quantity.code'</span> <span class="hljs-keyword">LANGUAGE</span> <span class="hljs-keyword">SQL</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En appelant la fonction, nous nous attendons √† obtenir deux d√©cimales, cependant, nous en obtenons quatre. </font><font style="vertical-align: inherit;">M√™me la conversion explicite apr√®s un appel de fonction n'aide pas (troisi√®me colonne):</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">SELECT</span> amount, code, amount::<span class="hljs-type">numeric</span>(<span class="hljs-number">18</span>,<span class="hljs-number">2</span>)
<span class="hljs-keyword">FROM</span> income_tax(<span class="hljs-keyword">ROW</span>(<span class="hljs-number">42.42</span>, <span class="hljs-string">''</span>))\gx</code></pre><br>
<pre><code class="plaintext hljs">-[ RECORD 1 ]--<font></font>
amount | 5.5146<font></font>
code   | <font></font>
amount | 5.5146</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans la version 13, le r√©sultat est correct:</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">SELECT</span> amount, code, amount::<span class="hljs-type">numeric</span>(<span class="hljs-number">18</span>,<span class="hljs-number">2</span>)
<span class="hljs-keyword">FROM</span> income_tax(<span class="hljs-keyword">ROW</span>(<span class="hljs-number">42.42</span>, <span class="hljs-string">''</span>))\gx</code></pre><br>
<pre><code class="plaintext hljs">-[ RECORD 1 ]<font></font>
amount | 5.51<font></font>
code   | <font></font>
amount | 5.51</code></pre><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les noms localis√©s dans to_date () et to_timestamp ()</font></font></b></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Fonctions</font></font><code>to_date</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aussi</font></font><code>to_timestamp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">appris √† comprendre les noms localis√©s des mois et</font><font style="vertical-align: inherit;">jours de la semaine. </font><font style="vertical-align: inherit;">Auparavant, seuls les noms anglais pouvaient √™tre utilis√©s:</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">SELECT</span> to_date(<span class="hljs-string">', 24  2020'</span>, <span class="hljs-string">'TMDay, DD TMMonth YYYY'</span>);</code></pre><br>
<pre><code class="plaintext hljs">  to_date   <font></font>
------------<font></font>
 2020-03-24</code></pre><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">normaliser et EST NORMALIS√â</font></font></b></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Pour se conformer √† la norme SQL, la fonction normalize () a √©t√© ajout√©e pour normaliser une cha√Æne Unicode, et le pr√©dicat IS NORMALIZED pour v√©rifier si une cha√Æne est normalis√©e.</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">SELECT</span> str, normalize(str, NFC) <span class="hljs-keyword">AS</span> nfc,<font></font>
       str <span class="hljs-keyword">IS</span> NFC NORMALIZED <span class="hljs-keyword">AS</span> is_nfc_normalized,<font></font>
       normalize(str, NFKC) <span class="hljs-keyword">AS</span> nfkc,<font></font>
       str <span class="hljs-keyword">IS</span> NFKC NORMALIZED <span class="hljs-keyword">AS</span> is_nfkc_normalized
<span class="hljs-keyword">FROM</span> (<span class="hljs-keyword">VALUES</span>(<span class="hljs-string">U&amp;'\0032\2075'</span>)) <span class="hljs-keyword">AS</span> vals(str)\gx</code></pre><br>
<pre><code class="plaintext hljs">-[ RECORD 1 ]------+---<font></font>
str                | 2‚Åµ<font></font>
nfc                | 2‚Åµ<font></font>
is_nfc_normalized  | t<font></font>
nfkc               | 25<font></font>
is_nfkc_normalized | f</code></pre><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En savoir plus</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sur les formulaires de normalisation UNICODE. </font></font><br>
<br>
<b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Type Xid8 et fonction xid8_current () pour les num√©ros de transaction 64 bits</font></font></a></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Ajout d'un nouveau type de donn√©es xid8 pour le num√©ro de transaction 64 bits. Mais non, cela ne signifie pas que PostgreSQL est pass√© aux transactions 64 bits: tout fonctionne exactement comme avant. Mais certaines fonctions renvoient un nouveau type, par exemple, est maintenant recommand√© pour une </font><font style="vertical-align: inherit;">utilisation √† la </font><font style="vertical-align: inherit;">place des anciennes fonctions pg_current_xact_id txid_current, qui sont </font><font style="vertical-align: inherit;">retourn√©s int8, et ainsi de </font><font style="vertical-align: inherit;">suite. N. De </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nouveaux types de donn√©es polymorphes famille anycompatible</font></font></b></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
types ajout√© </font></font><code>anycompatible</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>anycompatiblearray</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>anycompatiblenonarray</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>anycompatiblerange</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Contrairement aux types de famille </font></font><code>anyelement</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, les nouveaux types vous permettent d'utiliser non pas exactement les m√™mes, mais des types r√©ellement compatibles. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans l'exemple suivant, la fonction</font></font><code>maximum</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">comme arguments d√©finis comme </font></font><code>anycompatible</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sont pass√©s </font></font><code>integer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code>numeric</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">La valeur de retour est convertie en une valeur commune pour ces deux types:</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">FUNCTION</span> maximum(a anycompatible, b anycompatible) <span class="hljs-keyword">RETURNS</span> anycompatible
	<span class="hljs-keyword">AS</span> <span class="hljs-string">'SELECT CASE WHEN a &gt; b THEN a ELSE b END'</span> <span class="hljs-keyword">LANGUAGE</span> <span class="hljs-keyword">SQL</span>;<font></font>
<font></font>
<span class="hljs-keyword">SELECT</span> f, pg_typeof(f) <span class="hljs-keyword">FROM</span> maximum(<span class="hljs-number">42</span>, <span class="hljs-number">42.42</span>) f;</code></pre><br>
<pre><code class="plaintext hljs">   f   | pg_typeof<font></font>
-------+-----------<font></font>
 42.42 | numeric</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De plus, les types anycompatible- et any- sont deux ensembles de types ind√©pendants:</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">FUNCTION</span> first_elems(a <span class="hljs-type">anyarray</span>, b anycompatiblearray)
    <span class="hljs-keyword">RETURNS</span> <span class="hljs-keyword">TABLE</span>(a <span class="hljs-type">anyelement</span>, b anycompatible) <span class="hljs-keyword">AS</span> $$<span class="pgsql">
        <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">ROW</span>(a[array_lower(a,<span class="hljs-number">1</span>)], b[array_lower(b,<span class="hljs-number">1</span>)]);
    $$</span> <span class="hljs-keyword">LANGUAGE</span> <span class="hljs-keyword">sql</span>;
<span class="hljs-keyword">SELECT</span> first_elems(<span class="hljs-keyword">ARRAY</span>[<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>], <span class="hljs-keyword">ARRAY</span>[<span class="hljs-string">'a'</span>,<span class="hljs-string">'b'</span>,<span class="hljs-string">'c'</span>]) <span class="hljs-keyword">AS</span> str, <font></font>
       first_elems(<span class="hljs-keyword">ARRAY</span>[<span class="hljs-number">1.1</span>,<span class="hljs-number">2.2</span>,<span class="hljs-number">3.3</span>],<span class="hljs-keyword">ARRAY</span>[<span class="hljs-keyword">true</span>,<span class="hljs-keyword">false</span>]) <span class="hljs-type">bool</span>;</code></pre><br>
<pre><code class="plaintext hljs">  str  |  bool   <font></font>
-------+---------<font></font>
 (1,a) | (1.1,t)</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Langues proc√©durales</font></font></h3><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Transformation pour le type bool en PL / Perl</font></font></b></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Plus r√©cemment, TRANSFORM d'Ivan Panchenko (Postgres Professional) -</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> bool_plperl a √©t√© commis</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Postgres transmet des valeurs bool√©ennes √†</font></font><code>t</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou</font><font style="vertical-align: inherit;">en PL / Perl comme</font></font><code>f</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, mais pour Perl ce</font></font><code>f</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n'est pas un</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> faux</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> bool√©en</font><font style="vertical-align: inherit;">, mais juste la lettre f, c'est-√†-dire </font><font style="vertical-align: inherit;">dans un contexte logique, la</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> v√©rit√©</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Ce probl√®me peut √™tre r√©solu de diff√©rentes mani√®res (voir la</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> correspondance</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), mais la cr√©ation de TRANSFORM pour bool, selon Tom Lane, est la plus pratique. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ex√©cution rapide d'expressions simples en PL / pgSQL</font></font></b></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les expressions simples (au moins ne contenant pas d'appels de table et ne n√©cessitant pas de verrous) seront plus rapides. </font><font style="vertical-align: inherit;">Auparavant, dans ces cas, le temps consacr√© √† contacter le programmateur √† chaque cycle √©tait improductif.</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">OR REPLACE</span> <span class="hljs-keyword">FUNCTION</span> slow_pi() <span class="hljs-keyword">RETURNS</span> <span class="hljs-type">double</span> <span class="hljs-type">precision</span> <span class="hljs-keyword">AS</span> $$<span class="pgsql">
    <span class="hljs-keyword">DECLARE</span>
        a <span class="hljs-type">double</span> <span class="hljs-type">precision</span> := <span class="hljs-number">1</span>;
        s <span class="hljs-type">double</span> <span class="hljs-type">precision</span> := <span class="hljs-number">1</span>;
        r <span class="hljs-type">double</span> <span class="hljs-type">precision</span> := <span class="hljs-number">0</span>;
    <span class="hljs-keyword">BEGIN</span>
        <span class="hljs-keyword">FOR</span> i <span class="hljs-keyword">IN</span> <span class="hljs-number">1</span> .. <span class="hljs-number">10000000</span> <span class="hljs-keyword">LOOP</span>
            r := r + s/a; a := a + <span class="hljs-number">2</span>; s := -s;
        <span class="hljs-keyword">END</span> <span class="hljs-keyword">LOOP</span>;
        <span class="hljs-keyword">RETURN</span> <span class="hljs-number">4</span>*r;
    <span class="hljs-keyword">END</span>;
    $$</span> <span class="hljs-keyword">LANGUAGE</span> plpgsql;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Appelez slow_pi () dans PG12:</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">SELECT</span> slow_pi();</code></pre><br>
<pre><code class="plaintext hljs">          slow_pi      <font></font>
    --------------------<font></font>
     3.1415925535898497<font></font>
    (1 row)<font></font>
    Time: 13060,650 ms (00:13,061)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant en PG13:</font></font><br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">SELECT</span> slow_pi();</code></pre><br>
<pre><code class="plaintext hljs">          slow_pi      <font></font>
    --------------------<font></font>
     3.1415925535897915<font></font>
    (1 row)<font></font>
    Time: 2108,464 ms (00:02,108)</code></pre><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Extensions approuv√©es au lieu de pg_pltemplate</font></font></b></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Le r√©pertoire syst√®me a diminu√© d'une table. </font><font style="vertical-align: inherit;">Supprim√©</font></font><code>pg_pltemplate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Il stockait les propri√©t√©s des langages proc√©duraux n√©cessaires lors de l'ex√©cution</font></font><code>CREATE LANGUAGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Nous avons maintenant d√©cid√© d'enregistrer les propri√©t√©s dans les scripts des extensions des langages correspondants</font></font><code>pg_pltemplate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et de nous d√©barrasser de la table elle-m√™me. </font><font style="vertical-align: inherit;">Mais pour mettre en ≈ìuvre le plan, il est n√©cessaire de pr√©voir la possibilit√© pour le propri√©taire de la base de donn√©es (sans droits de superutilisateur) de cr√©er une langue de confiance √† partir du script d'extension. </font><font style="vertical-align: inherit;">En effet, maintenant pour cr√©er, par exemple, plpgsql, le propri√©taire de la base de donn√©es n'a pas besoin d'√™tre superutilisateur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Re√ßu comme suit. </font><font style="vertical-align: inherit;">Un nouveau param√®tre logique est apparu dans le fichier de contr√¥le des extensions</font></font><code>trusted</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Si les deux param√®tres</font></font><code>trusted</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et</font></font><code>superuser</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">inclus, l'extension peut √™tre cr√©√©e non seulement par le superutilisateur, mais aussi par l'utilisateur ayant le droit </font></font><code>CREATE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sur la base de donn√©es actuelle (et donc son propri√©taire). </font><font style="vertical-align: inherit;">Lors de l'ex√©cution d'un script d'une telle extension, les droits de superutilisateur qui ont initialis√© le cluster seront utilis√©s. </font><font style="vertical-align: inherit;">Les objets cr√©√©s par l'extension lui appartiendront, bien que le propri√©taire de l'extension lui-m√™me soit l'utilisateur cr√©ateur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cons√©quences importantes de ces changements:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les extensions de confiance ouvrent la voie aux d√©veloppeurs tiers pour cr√©er d'autres langues de confiance. </font><font style="vertical-align: inherit;">Maintenant, nous sommes limit√©s uniquement √† plpgsql, plperl et pltcl.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il </font></font><code>pg_pltemplate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√©tait bien √©crit que plpython se r√©f√®re √† la deuxi√®me version du langage. </font><font style="vertical-align: inherit;">Ne pas le </font></font><code>pg_pltemplate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">faire est une √©tape (n√©cessaire, mais pas suffisante) pour la transition vers python 3.</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Indices</font></font></h3><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Compression de l'arbre B</font></font></b></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Un patch important et attendu depuis longtemps (les travaux ont d√©j√† commenc√© en 2015) √©crit par Anastasia Lubennikova (Postgres Professional) et Peter Geigan (Peter Geoghegan) est finalement communiqu√© par Peter. Nastya a r√©ussi √† en</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> parler √† PGconf India</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Postgres a appris √† r√©duire consid√©rablement la taille des index B-tree gr√¢ce √† la d√©duplication, c'est-√†-dire des √©conomies sur les cl√©s d'index en double. Ces index ont √©t√© s√©rieusement repens√©s afin que la compression soit possible sans perte de compatibilit√© avec les versions pr√©c√©dentes des index. L'id√©e de d√©duplication est issue d'une architecture plus flexible d'index comme</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> GIN</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (reverse indexes - Generalized Inverted Index).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans ces indices plus souvent que dans l'</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> arbre B</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, il existe une situation o√π une cl√© correspond √† un grand nombre d'enregistrements. Dans le cas du traitement de texte, par exemple, le m√™me jeton se trouve g√©n√©ralement dans plusieurs documents. Et il n'est stock√© dans l'index qu'une seule fois. Jusqu'√† r√©cemment, les index B-tree ne savaient pas comment proc√©der. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les index B-tree diff√®rent des index GIN principalement dans les pages feuilles. Selon le nombre d'enregistrements associ√©s √† la m√™me valeur de cl√©, des options sont possibles: la page ne contient qu'une liste de publication - une liste de TID (identificateurs d'enregistrements index√©s), si la liste est petite et s'il y a beaucoup de TID, alors au lieu d'une liste de valeurs sont stock√©es nouvelles ¬´branches d'arbre¬ª ‚Äã‚Äã- liens vers d'autres pages comme la liste de publication ou d'autres branches d'arbre (elles sont appel√©es arbre de publication).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une telle arborescence est similaire √† une arborescence B, mais diff√®re dans les d√©tails essentiels: par exemple, les listes permettant de parcourir des pages du m√™me niveau d'arborescence dans le GIN sont unidirectionnelles et non bidirectionnelles. Par cons√©quent (y compris) une bonne compatibilit√© des nouveaux index d√©dupliqu√©s avec les anciennes versions n'est pas facile √† r√©aliser. Et les am√©liorations ont vraiment pris plus de 3 ans. Il a √©galement √©t√© n√©cessaire de travailler sur le m√©canisme de nettoyage (micro-vide) et d'autres nuances. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans les tests de performances, tous les index auxquels la d√©duplication est applicable ont diminu√© d'environ 3 fois. La compression des doublons aide √©galement les index uniques, √©liminant le probl√®me de gonflement d'index √† un taux √©lev√© de changements de table. Un nouveau comportement peut √™tre connect√© et d√©connect√© au niveau des param√®tres d'index. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'analyse compl√®te par index GIN n'est pas effectu√©e l√† o√π elle n'est pas n√©cessaire</font></font></b></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce patch permet dans certains cas d'√©viter un passage complet √† travers l'index GIN complet. </font><font style="vertical-align: inherit;">Certaines op√©rations, bien que prises en charge par l'index GIN, sont effectu√©es par une analyse compl√®te de l'index. </font><font style="vertical-align: inherit;">Prenons, par exemple, l'index pour la recherche de colonnes en texte int√©gral </font></font><code>tsvector</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Si la requ√™te de recherche a la forme ¬´tout sauf un mot donn√©¬ª, alors l'index entier devra √™tre lu dans son int√©gralit√©. </font><font style="vertical-align: inherit;">Si, cependant, une autre condition est pr√©sente dans la demande qui ne n√©cessite pas une analyse compl√®te de l'index, alors l'index sera toujours analys√© compl√®tement. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Avec la nouvelle optimisation, une condition plus pr√©cise sera utilis√©e en premier, permettant d'obtenir un gain de l'indice, puis les r√©sultats seront rev√©rifi√©s pour prendre en compte une autre limitation. </font><font style="vertical-align: inherit;">Comparez le nombre de pages lues dans la version 12 (tampons):</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">EXPLAIN</span> (<span class="hljs-keyword">ANALYZE</span>, <span class="hljs-keyword">BUFFERS</span>, <span class="hljs-keyword">COSTS</span> <span class="hljs-keyword">OFF</span>, <span class="hljs-keyword">TIMING</span> <span class="hljs-keyword">OFF</span>)
<span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> mail_messages <span class="hljs-keyword">WHERE</span> tsv @@ to_tsquery(<span class="hljs-string">'!vacuum'</span>) <span class="hljs-keyword">AND</span> tsv @@ to_tsquery(<span class="hljs-string">'analyze'</span>);</code></pre><br>
<pre><code class="plaintext hljs">                                             QUERY PLAN                                             <font></font>
------------------------------------------------------------------<font></font>
Bitmap Heap Scan on mail_messages (actual rows=5864 loops=1)<font></font>
   Recheck Cond: ((tsv @@ to_tsquery('!vacuum'::text)) AND (tsv @@ to_tsquery('analyze'::text)))<font></font>
   Heap Blocks: exact=5167<font></font>
   Buffers: shared hit=24 read=27405<font></font>
   -&gt;  Bitmap Index Scan on mail_messages_tsv_idx (actual rows=5864 loops=1)<font></font>
         Index Cond: ((tsv @@ to_tsquery('!vacuum'::text)) AND (tsv @@ to_tsquery('analyze'::text)))<font></font>
         Buffers: shared hit=24 read=22238<font></font>
 Planning Time: 0.283 ms<font></font>
 Execution Time: 3258.234 ms</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
avec le nombre de tampons dans la nouvelle version:</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">EXPLAIN</span> (<span class="hljs-keyword">ANALYZE</span>, <span class="hljs-keyword">BUFFERS</span>, <span class="hljs-keyword">COSTS</span> <span class="hljs-keyword">OFF</span>, <span class="hljs-keyword">TIMING</span> <span class="hljs-keyword">OFF</span>)
<span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> mail_messages <span class="hljs-keyword">WHERE</span> tsv @@ to_tsquery(<span class="hljs-string">'!vacuum'</span>) <span class="hljs-keyword">AND</span> tsv @@ to_tsquery(<span class="hljs-string">'analyze'</span>);</code></pre><br>
<pre><code class="plaintext hljs">                                             QUERY PLAN                                             <font></font>
---------------------------------------------------------------------------<font></font>
Bitmap Heap Scan on mail_messages (actual rows=5864 loops=1)<font></font>
   Recheck Cond: ((tsv @@ to_tsquery('!vacuum'::text)) AND (tsv @@ to_tsquery('analyze'::text)))<font></font>
   Heap Blocks: exact=5156<font></font>
   Buffers: shared hit=5179<font></font>
   -&gt;  Bitmap Index Scan on mail_messages_tsv_idx (actual rows=5864 loops=1)<font></font>
         Index Cond: ((tsv @@ to_tsquery('!vacuum'::text)) AND (tsv @@ to_tsquery('analyze'::text)))<font></font>
         Buffers: shared hit=23<font></font>
 Planning Time: 0.250 ms<font></font>
 Execution Time: 8.779 ms</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une situation similaire peut √™tre rencontr√©e lors de l'utilisation de trigrammes et lors de la v√©rification de l'occurrence de tableaux. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Param√®tres des classes d'op√©rateurs</font></font></b></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Dans PostgreSQL, de nombreuses m√©thodes d'acc√®s aux index sont un ¬´framework¬ª qui prend en charge une impl√©mentation de haut niveau de l'algorithme de recherche, travaillant avec des pages et des verrous, et le journal WAL. Et la liaison √† des types de donn√©es et des op√©rateurs sp√©cifiques est effectu√©e √† l'aide de classes d'op√©rateurs. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jusqu'√† pr√©sent, les classes d'op√©rateurs ne pouvaient pas avoir de param√®tres. Par exemple, pour une recherche en texte int√©gral, un index GiST avec une classe d'op√©rateurs peut √™tre utilis√© </font></font><code>tsvector_ops</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(√† propos des classes d'op√©rateurs GiST </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) Cette classe d'op√©rateurs utilise un arbre de signature, et la longueur de signature a √©t√© fix√©e (124 octets). Vous pouvez maintenant sp√©cifier la longueur explicitement, ce qui vous permet de contr√¥ler l'√©quilibre entre la taille de l'index et l'efficacit√© (le nombre de collisions de hachage):</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">INDEX</span> <span class="hljs-keyword">ON</span> mail_messages <span class="hljs-keyword">USING</span> gist(tsv tsvector_ops(siglen=<span class="hljs-number">1024</span>));</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Des modifications similaires ont √©t√© apport√©es aux d√©marreurs pour d'autres classes d'op√©rateurs GiST qui utilisent un arbre de signature, qui s'applique aux extensions hstore, intarray, ltree et pg_trgm. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais l'id√©e principale pour laquelle cette modification a √©t√© con√ßue est la possibilit√© de passer l'expression JSONPath √† l'index GIN afin que tout le document JSON ne soit pas index√©, mais seulement la partie n√©cessaire de celui-ci. Dans de nombreux cas, cela r√©duira radicalement la taille des index. Mais ce travail reste √† faire. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'id√©e d'Oleg Bartunov, la mise en ≈ìuvre de Nikita Glukhov et Alexander Korotkov (tous les trois Postgres Professional). </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'op√©rateur &lt;-&gt; (case, point) a √©t√©</font></font></b></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ajout√©. L'op√©ration manquante a √©t√© ajout√©e pour √™tre utilis√©e dans kNN pour </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GiST</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SP-GiST</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Dans PG12 lorsque vous travaillez avec des types g√©om√©triques </font></font><code>point</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et</font></font><code>box</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vous pouvez utiliser l'op√©rateur de distance </font></font><code>&lt;-&gt;(point, box)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, et cela acc√©l√©rera la recherche avec les index GiST et SP-GiST. </font><font style="vertical-align: inherit;">Mais l'op√©rateur sym√©trique pour lui </font></font><code>&lt;-&gt;(box, point)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n'a pas √©t√© impl√©ment√©, bien qu'il </font></font><code>box</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">comprenne d√©j√† les distances √† des types plus complexes - polygones et cercles.</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> points(<span class="hljs-type">point</span> <span class="hljs-type">point</span>);
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> boxes(<span class="hljs-type">box</span> <span class="hljs-type">box</span>);
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> points <span class="hljs-keyword">VALUES</span>(<span class="hljs-string">'1,2'</span>,<span class="hljs-string">'3,4'</span>);
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> boxes <span class="hljs-keyword">VALUES</span>(box(<span class="hljs-type">point</span>(<span class="hljs-number">3</span>,<span class="hljs-number">4</span>),<span class="hljs-type">point</span>(<span class="hljs-number">5</span>,<span class="hljs-number">6</span>)), box(<span class="hljs-type">point</span>(<span class="hljs-number">13</span>,<span class="hljs-number">14</span>),<span class="hljs-type">point</span>(<span class="hljs-number">15</span>,<span class="hljs-number">16</span>)));</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans PG12:</font></font><br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">SELECT</span> p.point, b.box, b.box  &lt;-&gt; p.point distance <span class="hljs-keyword">FROM</span> points <span class="hljs-keyword">AS</span> p, boxes <span class="hljs-keyword">AS</span> b <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> distance;</code></pre><br>
<pre><code class="plaintext hljs">:    : box &lt;-&gt; point</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vice versa, alors tout va bien:</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">SELECT</span> p.point, b.box, p.point  &lt;-&gt; b.box distance <span class="hljs-keyword">FROM</span> points <span class="hljs-keyword">AS</span> p, boxes <span class="hljs-keyword">AS</span> b <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> distance;</code></pre><br>
<pre><code class="plaintext hljs"> point |       box       |      distance<font></font>
-------+-----------------+--------------------<font></font>
 (1,2) | (5,6),(3,4)     | 2.8284271247461903<font></font>
 (2,1) | (5,6),(3,4)     | 3.1622776601683795<font></font>
 (1,2) | (15,16),(13,14) | 16.970562748477143<font></font>
 (2,1) | (15,16),(13,14) | 17.029386365926403</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et en PG13:</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">SELECT</span> p.point, b.box, b.box  &lt;-&gt; p.point distance <span class="hljs-keyword">FROM</span> points <span class="hljs-keyword">AS</span> p, boxes <span class="hljs-keyword">AS</span> b <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> distance;</code></pre><br>
<pre><code class="plaintext hljs"> point |       box       |      distance<font></font>
-------+-----------------+--------------------<font></font>
 (1,2) | (5,6),(3,4)     | 2.8284271247461903<font></font>
 (2,1) | (5,6),(3,4)     | 3.1622776601683795<font></font>
 (1,2) | (15,16),(13,14) | 16.970562748477143<font></font>
 (2,1) | (15,16),(13,14) | 17.029386365926403</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les indices GiST et SP-GiST seront acc√©l√©r√©s dans cette op√©ration. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Notez que dans PG13, si vous demandez:</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">SELECT</span> count(*) <span class="hljs-keyword">FROM</span> pg_operator <span class="hljs-keyword">WHERE</span> oprname = <span class="hljs-string">'&lt;-&gt;'</span>;</code></pre><pre><code class="plaintext hljs"> count <font></font>
-------<font></font>
    28</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
et si nous faisons de m√™me en PG12, nous obtenons 20 entr√©es: dans la 13e version, la liste a √©t√© remplie avec jusqu'√† 8 op√©rateurs.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Json</font></font></h3><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prise en charge de la m√©thode .datetime () pour jsonpath</font></font></b></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Il s'agit de l'un des correctifs infructueux d'une grande s√©rie de</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> correctifs JSONPath que PG12</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> n'a pas eu le temps de terminer. Fait partie de la norme JSON / SQL. Le probl√®me √©tait que toutes les fonctions de la s√©rie de correctifs JSONPath sont immuables, mais la comparaison de date prend en compte le fuseau horaire actuel, qui peut changer pendant la session.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans de tels cas, nous permettons aux fonctions immuables existantes de g√©n√©rer une erreur sur les comparaisons non immuables. Dans le m√™me temps, ce patch a des fonctions avec le suffixe _tz qui fonctionnent de mani√®re stable dans les op√©rations avec le fuseau horaire.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Nouvelle fonction - fonction jsonb_set_lax</font></font></b></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En g√©n√©ral, lax est un mode de fonctionnement non strict (contrairement √† strict) des fonctions avec jsonb. Dans ce cas, cette fonction sera op√©rationnelle dans une situation o√π l'un des arguments qu'elle prend est NULL. Contrairement √† la version stricte - jsonb_set () - elle a un argument suppl√©mentaire qui indique des actions dans le cas de NULL. Options: use_json_null / raise_exception / return_target / delete_key. Options sugg√©r√©es par les utilisateurs int√©ress√©s. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Optimis√© certaines fonctions jsonb.</font></font></b></a><font style="vertical-align: inherit;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"> Beaucoup</font></a></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
optimis√© </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, principalement gr√¢ce aux efforts de Nikita Glukhov (Postgres Professional). </font><font style="vertical-align: inherit;">Mais analyser chaque point dans ce cas est inutile: premi√®rement, leur abondance fera gonfler un article d√©j√† court; </font><font style="vertical-align: inherit;">et deuxi√®mement, les modifications concernent le p√©riph√©rique interne et tous les utilisateurs ne sont pas int√©ress√©s. </font><font style="vertical-align: inherit;">Par cons√©quent, nous n'en √©num√©rerons que la plupart:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fonction optimis√©e JsonbExtractScalar ();</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Op√©rateur optimis√© # &gt;&gt;, fonctions jsonb_each_text (), jsonb_array_elements_text ();</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La reconnaissance du type JsonbContainer dans get_jsonb_path_all () est optimis√©e;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La r√©cup√©ration du premier jeton de l'it√©rateur JsonbIterator est remplac√©e par la macro l√©g√®re JsonbContainerIsXxx ();</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Extraction de cl√©s plus pratique - findJsonbKeyInObject ();</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Stockage optimis√© des r√©sultats findJsonbValueFromContainer () et getIthJsonbValueFromContainer ();</font></font></li>
<li>  get_jsonb_path_all(),     ;<br>
  JsonbValueAsText.</li>
</ol><br>
<i> ,        SQL/JSON: JSON_TABLE  SQL/JSON: functions.       . ,   .      .     PG14.   JSONPath   .</i><br>
<br>
<h3>  </h3><br>
<h4>pgbench</h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'utilitaire permettant d'ex√©cuter des tests de performances a re√ßu une s√©rie d'am√©liorations. </font><font style="vertical-align: inherit;">Il y avait des </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">statistiques sur l'ex√©cution des</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> t√¢ches lors de la phase d'initialisation, une </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">conclusion</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> plus </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">visuelle</font></a><font style="vertical-align: inherit;"> , la possibilit√© de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">voir le code des scripts int√©gr√©s</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , des tests </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sur une table de</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> comptes </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">partitionn√©e</font></a><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De plus, nous avons ajout√© une commande </font></font><code>\aset</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">similaire √† </font></font><code>\gset</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, mais permettant de d√©finir des valeurs pour les variables de plusieurs requ√™tes envoy√©es √† la fois. </font><font style="vertical-align: inherit;">La ligne suivante, envoy√©e au serveur pour ex√©cution, d√©finit les deux variables </font></font><code>one</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code>two</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">SELECT</span> <span class="hljs-number">1</span> <span class="hljs-keyword">AS</span> one \; <span class="hljs-keyword">SELECT</span> <span class="hljs-number">2</span> <span class="hljs-keyword">AS</span> two \aset</code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pg_dump</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
pg_dump a appris √† </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d√©charger les donn√©es des tables tierces</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Gr√¢ce au param√®tre, </font></font><code>--include-foreign-data</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vous pouvez sp√©cifier une liste de serveurs tiers, dont les donn√©es des tables seront d√©charg√©es. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Utilisez ce d√©chargement avec pr√©caution. </font><font style="vertical-align: inherit;">Loin du fait que les donn√©es doivent √™tre t√©l√©charg√©es sur un serveur tiers. </font><font style="vertical-align: inherit;">De plus, il est tout √† fait possible qu'un serveur tiers ne soit pas disponible pendant la r√©cup√©ration. </font><font style="vertical-align: inherit;">Ou un serveur tiers ne peut autoriser que la lecture, mais pas l'√©criture de donn√©es.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">psql</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une s√©rie de petits correctifs rend le psql plus confortable:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Am√©lioration de la terminaison des onglets pour plusieurs √©quipes.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En plus d' </font></font><code>\echo</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">envoyer une cha√Æne √† STDOUT, une nouvelle commande </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>\warn</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">envoie une cha√Æne √† la sortie d'erreur standard (STDERR).</font></font></li>
<li> <code>\d</code> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> toast-</a>       .        <code>\d+</code>        .</li>
<li>  <code>\dt+</code> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">  ¬´Persistence¬ª</a>      (unlogged)   (permanent).</li>
<li>  <code>\e</code>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">  </a>,       <code>;</code> (  <code>\g*</code>). ,       psql      .</li>
<li>         .     <code>PROMPT1</code>  <code>PROMPT2</code> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> </a> <code>%x</code>.</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De nouvelles commandes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour plus d' </font><font style="vertical-align: inherit;">informations sur les </font><font style="vertical-align: inherit;">m√©thodes d'acc√®s: </font></font><code>\dAc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>\dAf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>\dAo</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font><code>\dAp</code></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vous </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">pouvez</font></a></font><code>\g</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> maintenant </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sp√©cifier</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> entre parenth√®ses toutes les options prises en charge </font></font><code>\pset</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Ils n'agiront que sur l'√©quipe actuelle.</font></font></li>
</ul><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">libpq</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Modifications mineures par rapport √† PostgreSQL:</font></font><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'inexactitude</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dans la description des param√®tres host et hostadr et l'incoh√©rence qui en r√©sulte dans la sortie de la </font></font><code>\conninfo</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">commande utilitaire psql ont √©t√© corrig√©es.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si la cl√© de certificat client est stock√©e sous forme crypt√©e, vous ne pouvez entrer le mot de passe qu'en mode interactif. </font><font style="vertical-align: inherit;">Le nouveau param√®tre </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sslpassword vous permet</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de d√©crypter la cl√© de mani√®re non interactive.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Deux nouveaux param√®tres, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sslminprotocolversion et sslmaxprotocolversion,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> vous permettent de sp√©cifier une restriction sur la version du protocole SSL / TCL avec laquelle la connexion est autoris√©e.</font></font></li>
</ul><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">reindexdb</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le nouveau param√®tre </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--jobs</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de l' </font><font style="vertical-align: inherit;">utilitaire </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">reindexdb</font></a><font style="vertical-align: inherit;"> d√©finit le nombre de connexions √† la base de donn√©es dans lesquelles les index seront reconstruits en m√™me temps.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pg_rewind</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les limites de l'utilitaire disparaissent progressivement et les possibilit√©s augmentent. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Premi√®rement, pg_rewind </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">peut maintenant</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> enregistrer des informations pour la r√©cup√©ration (comme pg_basebackup peut le faire), ainsi que d√©marrer la r√©cup√©ration et l'arr√™t ult√©rieur d'une instance si elle n'a pas √©t√© arr√™t√©e via un point de contr√¥le (cela devait √™tre fait manuellement auparavant). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et deuxi√®mement, pg_rewind a appris √† </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">travailler avec l'archive WAL</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une fois que l'utilitaire a trouv√© le point de divergence WAL entre les deux serveurs, il doit cr√©er une liste de toutes les pages qui doivent √™tre copi√©es dans le cluster cible afin d'√©liminer les diff√©rences. </font><font style="vertical-align: inherit;">Pour cela, l'utilitaire requiert tous les fichiers WAL, √† partir du point trouv√©. </font><font style="vertical-align: inherit;">Si les fichiers WAL n√©cessaires ne sont pas disponibles sur le cluster cible, l'utilitaire n'a pas pu effectuer son travail auparavant. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Avec ce patch d'Alexey Kondratov (Postgres Professional), pg_rewind pourra lire les segments WAL manquants de l'archive des fichiers journaux en utilisant le param√®tre restore_command si un nouveau commutateur -c ou --restore-target-wal est sp√©cifi√©.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pg_waldump</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
pg_waldump </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d√©cryptera</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> l' </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">enregistrement de</font></a><font style="vertical-align: inherit;"> transaction pr√©par√©.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">amcheck</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'extension amcheck a appris √† </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mieux reconna√Ætre les dommages</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dans les index B-tree. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Soit dit en passant, les messages du journal du serveur concernant les pages endommag√©es </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">diff√®rent</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> d√©sormais </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">pour les index et les tables</font></a><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pageinspect</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La </font></font><code>heap_tuple_infomask_flags</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fonction d'extension pageinspect </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d√©chiffre les valeurs des champs</font></font></a> <code>infomask</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><code>infomask2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">renvoy√©es par la fonction </font></font><code>heap_page_items</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Utile pour enqu√™ter sur des situations de corruption de donn√©es.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">postgres_fdw</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le superutilisateur au niveau du mappage de nom d'utilisateur peut </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">permettre aux utilisateurs r√©guliers d'</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> utiliser une connexion sans mot de passe:</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">USER</span> <span class="hljs-keyword">MAPPING</span> <span class="hljs-keyword">FOR</span>  <span class="hljs-keyword">SERVER</span> 
    <span class="hljs-keyword">OPTIONS</span> (<span class="hljs-keyword">ADD</span> password_required <span class="hljs-string">'false'</span>);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cela se fait, entre autres, afin que </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sslkey et sslcert</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> puissent √™tre utilis√©s comme param√®tres de connexion </font><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">adminpack</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'extension adminpack a une nouvelle fonctionnalit√© - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>pg_file_sync</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">En l'utilisant, vous pouvez faire fsync pour les fichiers √©crits par le serveur sur le disque, par exemple via </font></font><code>pg_file_write</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou </font></font><code>COPY TO</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">surveillance</font></font></h3><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pg_stat_slru</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans la m√©moire partag√©e du serveur, il y a non seulement un grand cache tampon, mais √©galement un certain nombre d'autres caches plus simples (par exemple, pour le statut des transactions). </font><font style="vertical-align: inherit;">Ils utilisent un algorithme simple pour √©vincer les pages les moins fr√©quemment utilis√©es (simple moins r√©cemment utilis√© ou SLRU). </font><font style="vertical-align: inherit;">Jusqu'√† pr√©sent, de tels caches ¬´fonctionnaient juste¬ª, mais il fallait les surveiller, tout d'abord pour que les d√©veloppeurs du noyau PostgreSQL sachent si quelque chose devait y √™tre chang√©. </font><font style="vertical-align: inherit;">Pour cela et dans un but, une nouvelle vue de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pg_stat_slru est apparue</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pg_stat_activity</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans la vue, la </font></font><code>pg_stat_activity</code> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nouvelle colonne</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est </font></font><code>leader_id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Pour les processus participant √† des demandes parall√®les, il est renseign√© avec le num√©ro du processus principal. </font><font style="vertical-align: inherit;">Et le processus principal </font></font><code>leader_id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">est un num√©ro de processus </font></font><code>pid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La requ√™te suivante montre quelles requ√™tes et quels processus s'ex√©cutent actuellement en parall√®le:</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">SELECT</span> query, leader_pid, <font></font>
    array_agg(pid) <span class="hljs-keyword">filter</span>(<span class="hljs-keyword">WHERE</span> leader_pid != pid) <span class="hljs-keyword">AS</span> members
  <span class="hljs-keyword">FROM</span> pg_stat_activity
 <span class="hljs-keyword">WHERE</span> leader_pid <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>
 <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> query, leader_pid;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Des modifications ont √©t√© apport√©es √† la liste des √©v√©nements en attente. </font><font style="vertical-align: inherit;">Ajout de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">deux nouveaux √©v√©nements</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><code>BackupWaitWalArchive</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code>RecoveryPause</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Et les deux autres ont re√ßu des noms plus pr√©cis: </font></font><code>RecoveryWalStream -&gt; RecoveryRetrieveRetryInterval</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>RecoveryWalAll -&gt; RecoveryWalStream</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">deux autres nouveaux √©v√©nements d'attente se produisant sur la r√©plique</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><code>RecoveryConflictSnapshot</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(conflit avec VACUUM, qui a supprim√© la version n√©cessaire des lignes) et </font></font><code>RecoveryConflictTablespace</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(conflit li√© √† la suppression de l'espace table).</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pg_stat_statements</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jusqu'√† pr√©sent, l'extension a </font></font><code>pg_stat_statements</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">trait√© les demandes avec </font></font><code>FOR UPDATE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et sans expression comme la m√™me demande. Les demandes avec </font></font><code>FOR UPDATE</code> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sont</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> d√©sormais </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">enregistr√©es s√©par√©ment</font></a><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La quantit√© d'informations collect√©es a augment√©. D√©sormais, non seulement les informations sur les ressources pour l'ex√©cution des commandes sont enregistr√©es, mais aussi les </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">statistiques sur les √©critures de journal g√©n√©r√©es</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Nouvelles colonnes de pr√©sentation: </font></font><code>wal_bytes</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- volume d'enregistrements g√©n√©r√©s, </font></font><code>wal_records</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- nombre d'enregistrements g√©n√©r√©s, </font></font><code>wal_num_fpw</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- nombre d'images pleine page (√©critures pleine page). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cela a √©t√© rendu possible gr√¢ce √† l' </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">infrastructure pr√©par√©e</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour suivre l'utilisation du WAL. Par cons√©quent, maintenant </font></font><code>EXPLAIN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">avec une nouvelle option, il </font></font><code>WAL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">affichera le volume des enregistrements g√©n√©r√©s:</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> t (id <span class="hljs-type">int</span>);
<span class="hljs-keyword">EXPLAIN</span> (<span class="hljs-keyword">ANALYZE</span>, WAL, <span class="hljs-keyword">COSTS</span> <span class="hljs-keyword">OFF</span>, <span class="hljs-keyword">TIMING</span> <span class="hljs-keyword">OFF</span>, <span class="hljs-keyword">SUMMARY</span> <span class="hljs-keyword">OFF</span>)
    <span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> t <span class="hljs-keyword">VALUES</span>(<span class="hljs-number">1</span>);</code></pre><br>
<pre><code class="plaintext hljs">              QUERY PLAN              <font></font>
--------------------------------------<font></font>
 Insert on t (actual rows=0 loops=1)<font></font>
   WAL:  records=1  bytes=59<font></font>
   -&gt;  Result (actual rows=1 loops=1)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Extension </font></font><code>auto_explain</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>VACUUM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s </font></font><code>VERBOSE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, et </font></font><code>autovacuum</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√©galement utiliser l'infrastructure cr√©√©e et produira des volumes de WAL. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Revenons √† </font></font><code>pg_stat_statements</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Si le nouveau param√®tre </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pg_stat_statements.track_planning est activ√©</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , des statistiques suppl√©mentaires li√©es au planificateur seront enregistr√©es pour chaque op√©rateur: nombre de builds de plan; </font><font style="vertical-align: inherit;">temps total de planification; </font><font style="vertical-align: inherit;">temps minimum et maximum d'une planification, ainsi que la moyenne et l'√©cart type. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La prise en compte des ressources allou√©es au planificateur se refl√®te dans un autre correctif qui n'est pas li√© √† </font></font><code>pg_stat_statements</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><code>EXPLAIN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">avec l'option </font></font><code>BUFFERS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">signalera le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nombre de tampons utilis√©s au stade de la planification</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">EXPLAIN</span> (<span class="hljs-keyword">ANALYZE</span>, <span class="hljs-keyword">BUFFERS</span>, <span class="hljs-keyword">COSTS</span> <span class="hljs-keyword">OFF</span>, <span class="hljs-keyword">TIMING</span> <span class="hljs-keyword">OFF</span>) 
    <span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> pg_class;</code></pre><br>
<pre><code class="plaintext hljs">                   QUERY PLAN                   <font></font>
------------------------------------------------<font></font>
 Seq Scan on pg_class (actual rows=386 loops=1)<font></font>
   Buffers: shared hit=9 read=4<font></font>
 Planning Time: 0.782 ms<font></font>
   Buffers: shared hit=103 read=11<font></font>
 Execution Time: 0.219 ms</code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Magazine</font></font></h4><br>
<ul>
<li> <code>log_statement_sample_rate</code>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">   SQL,   </a>,      <code>log_min_duration_sample</code>( ).<br>
,    <code>log_min_duration_statement</code>    , ..  <code>log_min_duration_statement</code> ,  <code>log_min_duration_sample</code>,       ,      <code>log_statement_sample_rate</code>.<br>
 ,   <code>log_transaction_sample_rate</code>    ,       ,      .</li>
<li>  ,   (   log_min_error_statement),         .          <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>log_parameter_max_length_on_error</code></a>.     0,   .<br>
 <code>log_parameter_max_length_on_error</code>          SQL,    ,      .<br>
    (     <code>log_statements</code>  <code>log_duration</code>)   ,  : <code>log_parameter_max_length</code>,     ,   .</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vous pouvez maintenant </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√©crire le type de processus</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font></font><code>pg_stat_activity.backend_type</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) dans le </font><font style="vertical-align: inherit;">journal </font><font style="vertical-align: inherit;">du </font><font style="vertical-align: inherit;">serveur </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Pour cela </font></font><code>log_line_prefix</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, un symbole sp√©cial est fourni </font><font style="vertical-align: inherit;">dans le param√®tre </font></font><code>%b</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Et si le journal est √©crit au format csv ( </font></font><code>log_destination=csvlog</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), la colonne y est </font></font><code>backend_type</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d√©j√† incluse.</font></font></li>
</ul><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le progr√®s</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De nouvelles vues </font><font style="vertical-align: inherit;">vous permettent </font></font><code>pg_stat_progress_analyze</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√©galement </font></font><code>pg_stat_progress_basebackup</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de suivre la progression de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">la collecte</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">statistiques</font></a><font style="vertical-align: inherit;"> par l'√©quipe </font></font><code>ANALYZE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cr√©er une copie de sauvegarde de l'</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> utilitaire, </font></font><code>pg_basebackup</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">respectivement.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Optimisation</font></font></h3><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Calcul des fonctions immuables dans la clause FROM au stade de la planification</font></font></b></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Le patch d'Aleksandr Kuzmenkov et Aleksandr Parfyonov (tous deux de Postgres Professional) aide dans les cas o√π l'</font></font><code>FROM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">appel contient un appel de fonction qui est en fait une constante. </font><font style="vertical-align: inherit;">Dans ce cas, au lieu d'√©tablir la connexion, la valeur constante est substitu√©e aux endroits n√©cessaires de la demande. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici comment cela se produit avec un exemple de requ√™te li√©e √† la recherche en texte int√©gral:</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">EXPLAIN</span> (<span class="hljs-keyword">COSTS</span> <span class="hljs-keyword">OFF</span>)
<span class="hljs-keyword">SELECT</span> subject, ts_rank_cd(tsv, q) <span class="hljs-keyword">AS</span> rank
<span class="hljs-keyword">FROM</span> mail_messages, to_tsquery(<span class="hljs-string">'english'</span>, <span class="hljs-string">'tuple'</span>) q
<span class="hljs-keyword">WHERE</span> tsv @@ q
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> rank <span class="hljs-keyword">DESC</span>;</code></pre><br>
<pre><code class="plaintext hljs">                              QUERY PLAN                              <font></font>
------------------------------------------------------------------<font></font>
 Sort<font></font>
   Sort Key: (ts_rank_cd(mail_messages.tsv, '''tuple'''::tsquery)) DESC<font></font>
   -&gt;  Bitmap Heap Scan on mail_messages<font></font>
         Recheck Cond: (tsv @@ '''tuple'''::tsquery)<font></font>
         -&gt;  Bitmap Index Scan on mail_messages_tsv_idx<font></font>
               Index Cond: (tsv @@ '''tuple'''::tsquery)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il n'y a pas de connexion et la valeur 'tuple' :: tsquery est substitu√©e dans la requ√™te d√©j√† au stade de la planification. </font><font style="vertical-align: inherit;">La version 12 avait une image compl√®tement diff√©rente:</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">EXPLAIN</span> (<span class="hljs-keyword">COSTS</span> <span class="hljs-keyword">OFF</span>)
<span class="hljs-keyword">SELECT</span> subject, ts_rank_cd(tsv, q) <span class="hljs-keyword">AS</span> rank                            
<span class="hljs-keyword">FROM</span> mail_messages, to_tsquery(<span class="hljs-string">'english'</span>, <span class="hljs-string">'tuple'</span>) q
<span class="hljs-keyword">WHERE</span> tsv @@ q                            
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> rank <span class="hljs-keyword">DESC</span>;</code></pre><br>
<pre><code class="plaintext hljs">                          QUERY PLAN                         <font></font>
-----------------------------------------------------<font></font>
 Sort<font></font>
   Sort Key: (ts_rank_cd(mail_messages.tsv, q.q)) DESC<font></font>
   -&gt;  Nested Loop<font></font>
         -&gt;  Function Scan on q<font></font>
         -&gt;  Bitmap Heap Scan on mail_messages<font></font>
               Recheck Cond: (tsv @@ q.q)<font></font>
               -&gt;  Bitmap Index Scan on mail_messages_tsv_idx<font></font>
                     Index Cond: (tsv @@ q.q)</code></pre><br>
<br>
<b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tri incr√©mentiel</font></font></a></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Lorsqu'un tri par plusieurs cl√©s est n√©cessaire (k1, k2, k3 ...), l'ordonnanceur peut d√©sormais profiter du fait que les donn√©es sont d√©j√† tri√©es par plusieurs des premi√®res cl√©s (par exemple, k1 et k2). Dans ce cas, vous ne pouvez pas trier √† nouveau toutes les donn√©es, mais les diviser en groupes cons√©cutifs avec les m√™mes valeurs k1 et k2 et ¬´trier¬ª par la cl√© k3.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainsi, le tri entier se divise en plusieurs sortes cons√©cutives de plus petite taille. Cela r√©duit la quantit√© de m√©moire n√©cessaire et vous permet √©galement de fournir les premi√®res donn√©es avant la fin du tri.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par exemple, dans la base de donn√©es de la table tickets, il y a un index dans la colonne ticket_id. </font><font style="vertical-align: inherit;">Les donn√©es re√ßues de l'index seront tri√©es par ticket_id, donc la requ√™te suivante utilisera le tri incr√©mentiel:</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">EXPLAIN</span> (<span class="hljs-keyword">analyze</span>, <span class="hljs-keyword">costs</span> <span class="hljs-keyword">off</span>, <span class="hljs-keyword">timing</span> <span class="hljs-keyword">off</span>)
<span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> tickets <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> ticket_no, passenger_id;</code></pre><br>
<pre><code class="plaintext hljs">                                  QUERY PLAN                                  <font></font>
------------------------------------------------------------------------------<font></font>
 Incremental Sort (actual rows=2949857 loops=1)<font></font>
   Sort Key: ticket_no, passenger_id<font></font>
   Presorted Key: ticket_no<font></font>
   Full-sort Groups: 92184 Sort Method: quicksort Memory: avg=31kB peak=31kB<font></font>
   -&gt;  Index Scan using tickets_pkey on tickets (actual rows=2949857 loops=1)<font></font>
 Planning Time: 2.137 ms<font></font>
 Execution Time: 2230.019 ms</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La fonctionnalit√© de tri incr√©mentiel peut √™tre d√©sactiv√©e avec le param√®tre enable_incrementalsort. </font><font style="vertical-align: inherit;">Dans ce cas, le tri prendra sensiblement plus de temps:</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">SET</span> enable_incrementalsort = <span class="hljs-keyword">off</span>;
<span class="hljs-keyword">EXPLAIN</span> (<span class="hljs-keyword">analyze</span>, <span class="hljs-keyword">costs</span> <span class="hljs-keyword">off</span>, <span class="hljs-keyword">timing</span> <span class="hljs-keyword">off</span>)
<span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> tickets <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> ticket_no, passenger_id;</code></pre><br>
<pre><code class="plaintext hljs">                              QUERY PLAN                               <font></font>
-----------------------------------------------------------------------<font></font>
 Gather Merge (actual rows=2949857 loops=1)<font></font>
   Workers Planned: 2<font></font>
   Workers Launched: 2<font></font>
   -&gt;  Sort (actual rows=983286 loops=3)<font></font>
         Sort Key: ticket_no, passenger_id<font></font>
         Sort Method: external merge  Disk: 107024kB<font></font>
         Worker 0:  Sort Method: external merge  Disk: 116744kB<font></font>
         Worker 1:  Sort Method: external merge  Disk: 107200kB<font></font>
         -&gt;  Parallel Seq Scan on tickets (actual rows=983286 loops=3)<font></font>
 Planning Time: 3.994 ms<font></font>
 Execution Time: 12291.844 ms</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'id√©e du tri incr√©mental a √©t√© propos√©e en 2013 par Alexander Korotkov (Postgres Professional), et maintenant, sept ans plus tard, le patch a √©t√© port√© par James Coleman dans un √©tat accept√© par la communaut√©. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Acc√©l√©ration TRUNCATE</font></font></b></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Lorsque l' </font></font><code>TRUNCATE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">analyse se produit </font></font><code>shared_buffers</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour supprimer les tampons de table de la m√©moire partag√©e. Auparavant, l'analyse √©tait effectu√©e trois fois, pour chaque couche de table: MAIN (couche de donn√©es principale), FSM (carte d'espace libre), VM (carte de visibilit√©). Maintenant, la logique a chang√©, au lieu d'une triple op√©ration, les tampons ne sont analys√©s qu'une seule fois. Avec de grandes valeurs, </font></font><code>shared_buffers</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cela donne un gain tangible. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D√©compression partielle TOAST</font></font></b></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsqu'il n'est pas n√©cessaire de lire compl√®tement TOAST, en le limitant √† une tranche au d√©but ou pr√®s du d√©but, il n'est pas logique de le desserrer compl√®tement. </font><font style="vertical-align: inherit;">TOAST compress√© est lu par it√©rations: lisez un morceau, s'il n'y a pas de donn√©es n√©cessaires, puis d√©veloppez-le et lisez la suite. </font><font style="vertical-align: inherit;">Sugg√©r√© par un √©tudiant de Google Summer of Code, Binguo Bao, qui donne un exemple:</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> slicingtest (<font></font>
     id <span class="hljs-type">serial</span> <span class="hljs-keyword">PRIMARY KEY</span>,<font></font>
     a <span class="hljs-type">text</span><font></font>
);<font></font>
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> slicingtest (a) <span class="hljs-keyword">SELECT</span>
    repeat(<span class="hljs-string">'1234567890-=abcdefghijklmnopqrstuvwxyz'</span>, <span class="hljs-number">1000000</span>) <span class="hljs-keyword">AS</span> a <span class="hljs-keyword">FROM</span>
    generate_series(<span class="hljs-number">1</span>,<span class="hljs-number">100</span>);<font></font>
\<span class="hljs-keyword">timing</span>
<span class="hljs-keyword">SELECT</span> sum(length(substr(a, <span class="hljs-number">0</span>, <span class="hljs-number">20</span>))) <span class="hljs-keyword">FROM</span> slicingtest;</code></pre><br>
<pre><code class="plaintext hljs">Time: 28.123 ms</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Avec le patch, un ordre de grandeur plus rapide:</font></font><br>
<br>
<pre><code class="plaintext hljs">Time: 2.306 ms</code></pre><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parallel VACUUM</font></font></b></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Dans son</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> article sur ce sujet,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Yegor Rogov explique en d√©tail cette √©tape importante de la parall√©lisation. En bref: ¬´Patch Masahiko Sawada, qui vous permet d'effectuer un nettoyage en parall√®le. La table elle-m√™me est toujours effac√©e par un processus (principal), mais pour nettoyer les index, elle peut d√©sormais d√©marrer des workflows en arri√®re-plan, un pour chaque index. En mode manuel, cela vous permet d'acc√©l√©rer le nettoyage de grandes tables avec plusieurs index; le nettoyage automatique n'utilise pas encore cette fonction. ¬ª</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Nettoyage automatique une fois coll√© dans une table</font></font></b></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour ce correctif (√©galement connu sous le nom d'aspirateur automatique Berserk), nous devons remercier Dorofei Proleskovsky, qui a propos√© une solution au probl√®me suivant: le nettoyage automatique ne vient pas √† la table en annexe uniquement, car ils n'ont pas de versions ¬´mortes¬ª des rang√©es. Pour cette raison, la carte de visibilit√© n'est pas mise √† jour, rendant les analyses uniquement index√©es inefficaces, et lorsque le nettoyage emp√™che les d√©bordements du compteur de transactions, il doit faire beaucoup de travail √† la fois. Maintenant, cette situation a √©t√© corrig√©e: l'autonettoyage fonctionnera √©galement sur l'ajout de lignes. Deux nouveaux param√®tres de serveur ( </font></font><code>autovacuum_vacuum_insert_threshold</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code>autovacuum_vacuum_insert_scale_factor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) sont apparus, similaires √† ceux des modifications ( </font></font><code>autovacuum_vacuum_threshold</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code>autovacuum_vacuum_scale_factor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hash Aggregate Memory Management</font></font></b></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'agr√©gation de hachage peut n√©cessiter plus de RAM que le planificateur ne le pensait et que ce qui est indiqu√© dans </font></font><code>work_mem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Auparavant, une telle erreur de planificateur entra√Ænait le fait que la taille √©tait </font></font><code>work_mem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ignor√©e et que la m√©moire √©tait allou√©e autant que n√©cessaire pour le fonctionnement ou l'arriv√©e de OOM Killer. Maintenant, l'algorithme ne va pas plus loin </font></font><code>work_mem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et, si n√©cessaire, utilise des fichiers temporaires sur le disque. Pour contr√¥ler le comportement du planificateur, les param√®tres suivants sont apparus: </font></font><code>enable_groupingsets_hash_disk</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code>enable_hashagg_disk</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Optimisation de UPDATE pour les tables avec les colonnes g√©n√©r√©es</font></font></b></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans la version 12, les colonnes g√©n√©r√©es √©taient recalcul√©es lors de toute mise √† jour de ligne, m√™me si cette modification ne les affectait en aucune fa√ßon. Maintenant, ils ne seront recalcul√©s que lorsque cela est vraiment n√©cessaire (si leurs colonnes de base ont chang√©). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cette optimisation, par exemple, peut acc√©l√©rer consid√©rablement la mise √† jour des tables avec une colonne de type g√©n√©r√©e </font></font><code>tsvector</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, car la fonction est </font></font><code>to_tsvector()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">assez co√ªteuse. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Acc√®s depuis le d√©clencheur √† la liste des colonnes modifi√©es</font></font></b></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Un petit patch qui ajoute un </font></font><code>TriggerData</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bitmap des colonnes modifi√©es </font><font style="vertical-align: inherit;">√† la structure </font><font style="vertical-align: inherit;">. Ces informations peuvent √™tre utilis√©es par des fonctions de d√©clenchement g√©n√©rales, telles que </font></font><code>tsvector_update_trigger()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou </font></font><code>lo_manage()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, afin de ne pas faire de travail inutile. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Utilisation de plusieurs statistiques avanc√©es lors de l'√©valuation</font></font></b></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans PG12, le planificateur n'√©tait pas en mesure d'utiliser plusieurs statistiques avanc√©es pour la m√™me table en m√™me temps. Par exemple, imaginez une situation dans laquelle deux statistiques avanc√©es sont construites pour diff√©rents ensembles de colonnes et les colonnes d'un ensemble et d'un autre participent √† la requ√™te. Le planificateur a d√©sormais acc√®s √† toutes les informations disponibles. </font></font><br>
<br>
<b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Infrastructure de parall√©lisation et COPY</font></font></a></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (voir aussi </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ce patch.</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La concurrence PostgreSQL fonctionne toujours pour les requ√™tes en lecture seule. </font><font style="vertical-align: inherit;">Il y a des difficult√©s avec les √©crivains, et l'un d'eux bloque les processus qui effectuent simultan√©ment une t√¢che (inclus dans un groupe parall√®le commun). </font><font style="vertical-align: inherit;">On pense que les verrous de ces processus n'entrent pas en conflit - par exemple, plusieurs processus peuvent contenir un verrou exclusif sur la m√™me table. </font><font style="vertical-align: inherit;">Cela n√©cessite une attention particuli√®re de la part des d√©veloppeurs du noyau, mais sinon ils auraient constamment des blocages. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais il y a deux exceptions:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">verrou d'extension de relation, qui est captur√© lorsque de nouvelles pages sont ajout√©es √† la fin du fichier de donn√©es, et</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">verrou de page, qui est utilis√© lors du d√©placement des √©l√©ments d'index GIN de la liste d'attente vers l'arborescence principale.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(Vous pouvez en savoir plus </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dans cet article.</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De tels verrous devraient entrer en conflit m√™me entre les processus du m√™me groupe parall√®le - qui impl√©mente ce correctif. </font><font style="vertical-align: inherit;">Mais ces verrous ne peuvent jamais conduire √† des blocages, ils sont donc exclus de l'analyse. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour l'utilisateur, en g√©n√©ral, rien ne change, mais ce correctif est important car, d'une part, il ouvre la voie √† INSERT et COPY parall√®les, et d'autre part, il √©limine l'un des goulots d'√©tranglement de PostgreSQL dans des conditions de charge √©lev√©e (ce qui peut √™tre entendu </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dans le rapport HL ++</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s√©curit√©</font></font></h3><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Primes SKH PRH remplac√©es Primes</font></font></b></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
EDH</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><b><font style="vertical-align: inherit;"> remplac√©es</font></b></a><font style="vertical-align: inherit;"> (cl√©s √©ph√©m√®res Diffie-Hellman) en utilisant le protocole SKIP, aujourd'hui disparu.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> initdb: les param√®tres par d√©faut pour l'authentification</font></font></b></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ont chang√© Les param√®tres d'acc√®s par d√©faut pour les connexions locales et r√©seau ont chang√© au d√©marrage d'initdb. Maintenant,</font></font><code>pg_hba.conf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour les connexions locales au lieu de la m√©thode d'authentification</font></font><code>trust</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sera</font></font><code>peer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(ou md5 si l'homologue n'est pas pris en charge), et</font></font><code>md5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour les connexions r√©seau. Dans un premier temps, des mesures plus lib√©rales ont √©t√© discut√©es: avertissement dans la documentation. Puis plus difficile:</font></font><code>scram-sha-256</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. En cons√©quence, nous avons d√©cid√© de nous limiter √†</font></font><code>peer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et</font></font><code>md5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Utilisation de explicit_bzero</font></font></b></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Patch important. Les fonctions du syst√®me d'exploitation bzero () et explicit_bzero () √©crivent des octets contenant dans les zones de m√©moire indiqu√©es </font></font><code>'\0'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(voir, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">par exemple</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , Linux). Ces correctifs ne sont qu'un d√©but: il existe de nombreuses sections de m√©moire dans lesquelles les mots de passe et autres informations sensibles peuvent rester. Nous avons d√©cid√© de partir d'endroits comme libpq, dans lesquels l'int√©gralit√© du fichier contenant les mots de passe peut rester en m√©moire apr√®s la lecture de .pgpass, et du nettoyage apr√®s la fermeture de la connexion. Dans be-secure-common.c, il y a maintenant un √©crasement de la phrase secr√®te entr√©e dans SSL, qui appara√Æt dans la ligne (chemin) de l'erreur. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ajout du param√®tre "password_protocol" √† libpq</font></font></b></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce patch permet √† libpq de contr√¥ler le protocole de transfert de mot de passe utilis√© lors de la connexion. Apr√®s avoir re√ßu ce param√®tre, libpq refusera l'authentification si le protocole est plus faible que celui sp√©cifi√©. Par d√©faut, ce param√®tre </font></font><code>plaintext</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, c'est-√†-dire que tous les protocoles conviennent. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Acc√®s obligatoire pour TRUNCATE</font></font></b></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Ce correctif permet aux extensions d'incorporer le contr√¥le d'acc√®s obligatoire (MAC) pour une op√©ration TRUNCATE. Les droits seront d√©sormais v√©rifi√©s par l'extension </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sepgsql</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La politique de r√©f√©rence SELinux</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et les distributions Linux bas√©es sur Redhat ne prennent pas en charge la v√©rification SELinux sur db_table {truncate}. Dans ce cas, sepgsql sera utilis√© avec 'deny_unknown' √©gal √† 1 et TRUNCATE √©chouera. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Disponibilit√© de GUC ssl_passphrase_command</font></font></b></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un patch simple mais utile. </font><font style="vertical-align: inherit;">D√©sormais, la valeur du param√®tre ssl_passphrase_command ne sera vue que par le superutilisateur. </font><font style="vertical-align: inherit;">Le param√®tre sp√©cifie une commande externe qui est appel√©e lorsqu'un mot de passe est requis pour d√©chiffrer un fichier SSL, par exemple, une cl√© priv√©e.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Localisation</font></font></h3><br>
<b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Versionnement des r√®gles de classement libc</font></font></a></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Pour les</font><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"> r√®gles de classement</font></a></b><font style="vertical-align: inherit;"> ICU, les num√©ros de version sont stock√©s dans la base de donn√©es. Chaque fois que la r√®gle est utilis√©e (tri, comparaison de caract√®res), le num√©ro de version enregistr√© est v√©rifi√© avec la version actuelle dans la biblioth√®que ICU du syst√®me d'exploitation, et en cas de divergences, un avertissement est √©mis. Cela vous permet de constater que certains index construits selon les r√®gles de tri modifi√©es peuvent √™tre incorrects et doivent √™tre reconstruits. En reconstruisant les index avec la commande</font></font><code>ALTER COLLATION ... REFRESH VERSION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, la version de la r√®gle de tri dans la base de donn√©es est mise √† jour et les avertissements ne sont plus √©mis.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais c'√©tait uniquement pour l'ICU. Maintenant, le num√©ro de version est √©galement stock√© pour les r√®gles de tri libc:</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">SELECT</span> collname, collversion <span class="hljs-keyword">FROM</span> pg_collation <span class="hljs-keyword">WHERE</span> collname = <span class="hljs-string">'ru_RU'</span>;</code></pre><br>
<pre><code class="plaintext hljs"> collname | collversion<font></font>
----------+-------------<font></font>
 ru_RU    | 2.27</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce qui permet d'√©mettre des avertissements lorsqu'une biblioth√®que change dans l'OS. </font><font style="vertical-align: inherit;">Tr√®s pertinent √† la lumi√®re de la transition vers la glibc 2.28, o√π de nombreuses r√®gles de tri ont chang√© et les index correspondants doivent √™tre reconstruits. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais jusqu'√† ce qu'ils passent √† la version 2.28, tout est calme:</font></font><br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">COLLATION</span> "ru_RU" <span class="hljs-keyword">REFRESH</span> <span class="hljs-keyword">VERSION</span>;</code></pre><br>
<pre><code class="plaintext hljs">NOTICE:  version has not changed<font></font>
ALTER COLLATION</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Recherche en texte int√©gral</font></font></h3><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Recherche plein texte pour la langue grecque</font></font></b></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Pas de commentaires. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dict_int a appris √† g√©rer les valeurs absolues.</font></font></b></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Le dictionnaire de mod√®les dict_int (aka extension) a ajout√© la possibilit√© de supprimer le signe d'un nombre.</font></font><br>
<br>
<pre><code class="pgsql hljs">
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">EXTENSION</span> dict_int;
<span class="hljs-keyword">SELECT</span> ts_lexize(<span class="hljs-string">'intdict'</span>, <span class="hljs-string">'-123'</span>);</code></pre><br>
<pre><code class="plaintext hljs">ts_lexize<font></font>
-----------<font></font>
 {-123}<font></font>
(1 row)</code></pre><br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TEXT SEARCH</span> <span class="hljs-keyword">DICTIONARY</span> intdict (ABSVAL = <span class="hljs-keyword">true</span>);
<span class="hljs-keyword">SELECT</span> ts_lexize(<span class="hljs-string">'intdict'</span>, <span class="hljs-string">'-123'</span>);</code></pre><br>
<pre><code class="plaintext hljs">ts_lexize<font></font>
-----------<font></font>
 {123}<font></font>
(1 row)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Autrement dit, cette fois, la valeur absolue a √©t√© reconnue.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Partitionnement</font></font></h4><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AVANT les</font></font></b></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
d√©clencheurs de ligne</font></font><code>BEFORE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sur une table partitionn√©e</font><font style="vertical-align: inherit;">Dans la version 12, vous ne pouvez pas cr√©er de d√©clencheurs de ligne</font><font style="vertical-align: inherit;">sur une table partitionn√©e. Sur des sections s√©par√©es - s'il vous pla√Æt, mais pas sur toute la table √† la fois. D√©sormais, un</font></font><code>BEFORE FOR EACH ROW</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d√©clencheur cr√©√© sur une table partitionn√©e sera automatiquement h√©rit√© et fonctionnera pour toutes les sections. Mais √† la condition que si un d√©clencheur est activ√©</font></font><code>UPDATE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, la cl√© de partition ne peut √™tre modifi√©e que dans la section actuelle.</font></font><br>
<br>
<b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Prise en charge des tables partitionn√©es dans la r√©plication logique</font></font></a></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Auparavant, l'inclusion d'une table partitionn√©e dans une publication provoquait une erreur:</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">PUBLICATION</span> pub <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">TABLE</span> p;</code></pre><br>
<pre><code class="plaintext hljs">ERROR:  "p" is a partitioned table<font></font>
DETAIL:  Adding partitioned tables to publications is not supported.<font></font>
HINT:  You can add the table partitions individually.</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant √ßa marche. </font></font><br>
<br>
<b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Am√©lioration de l'algorithme JOIN sectionnel</font></font></a></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
√Ä partir de la 11e version, le planificateur peut joindre les tables partitionn√©es section par section, mais uniquement si les limites des sections correspondent exactement. </font><font style="vertical-align: inherit;">Maintenant, l'algorithme a √©t√© am√©lior√©: il fonctionnera si la section d'une table est compl√®tement incluse dans la section d'une autre, m√™me si leurs tailles ne correspondent pas (par exemple, si une table est partitionn√©e par jour et l'autre par mois). </font><font style="vertical-align: inherit;">Le nouvel algorithme fonctionne pour le partitionnement par plages et par listes. </font></font><br>
<br>
<b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sectional FULL OUTER JOIN La jointure sectionn√©e</font></font></a></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
fonctionne maintenant pour les jointures externes compl√®tes enregistr√©es avec une phrase </font></font><code>USING</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tableam</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans ce domaine attrayant et prometteur, mais difficile, il n'y a pas d'avanc√©es radicales concernant PostgreSQL 12. Il n'y a pas de stockages de plug-ins pr√™ts √† l'emploi tels </font></font><code>zheap</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que des tas), mais le travail continue sur l'API. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un niveau d'abstraction plus √©lev√© pour d√©terminer la taille de la table</font></font></b></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Robert Haas a r√©√©crit le code, changeant son architecture en faveur des couches abstraites, afin de ne pas dupliquer le code √† l'avenir. Cette pi√®ce fait r√©f√©rence √† </font></font><code>estimate_rel_size</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- la taille des couches (fourches) de la table. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vous pouvez utiliser les m√©thodes d'acc√®s aux tables avec relcache.</font></font></b></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Ce correctif apporte les capacit√©s de gestion de la m√©moire des m√©thodes d'acc√®s aux tables aux capacit√©s des m√©thodes d'indexation. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tableam et TOAST</font></font></b></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
TOAST sont largement con√ßus pour le stockage</font></font><code>heap</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Par cons√©quent, lors de la cr√©ation de nouvelles </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m√©thodes d'acc√®s aux tables,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> vous pouvez proc√©der de deux mani√®res: aider les d√©veloppeurs de nouvelles m√©thodes √† y ins√©rer, mettre √† jour et supprimer des enregistrements TOAST ou d√©l√©guer le travail avec TOAST au code √† l'aide du stockage traditionnel PostgreSQL - heap. </font><font style="vertical-align: inherit;">Une s√©rie de 5 correctifs utilise des emplacements de tuple pour impl√©menter les op√©rations d'insertion / mise √† jour / suppression et peut aider ceux qui vont dans les deux sens.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fsync</font></font></h4><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gestion des erreurs fsync dans pg_receivewal et pg_recvlogical</font></font></b></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
La lutte contre</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fsync ()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> continue. PostgreSQL estime qu'un appel fsync () r√©ussi signifie que toutes les donn√©es du fichier ont √©t√© vid√©es sur le disque, mais cela ne se produit pas toujours (en fonction du syst√®me d'exploitation) et peut entra√Æner une perte de donn√©es. PG13 a d√©cid√© qu'il √©tait n√©cessaire de traiter avec les services publics</font></font><code>pg_receivewal</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et</font></font><code>pg_recvlogical</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Actuellement, le comportement par d√©faut est le suivant: ces utilitaires √©criront des erreurs fsync dans les journaux, restaureront la connexion et continueront comme si de rien n'√©tait. Par cons√©quent, le WAL contient des informations sur les fichiers qui ont √©t√© copi√©s avec succ√®s et qui, en fait, n'ont pas √©t√© correctement vid√©s sur le disque. Il est donc pr√©f√©rable d'interrompre l'utilitaire. Le sort de pg_dump, pg_basebackup, pg_rewind et pg_checksums a √©galement √©t√© discut√©, mais jusqu'√† pr√©sent, ils se sont limit√©s √† ces deux.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Protection contre la d√©finition d'indicateurs incorrects pour fsync ()</font></font></b></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Ce correctif v√©rifie si les indicateurs sont d√©finis correctement lors de la r√©ception du descripteur de fichier pour fsync () - les r√©pertoires sont ouverts uniquement en lecture et les fichiers en √©criture ou les deux.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sauvegarde et r√©plication</font></font></h3><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pause pendant la r√©cup√©ration avant d'atteindre le point de r√©cup√©ration</font></font></b></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Si, pendant la r√©cup√©ration, les WAL sont termin√©s</font></font><code>recovery_target_time</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et n'ont pas atteint celui</font><font style="vertical-align: inherit;">sp√©cifi√©</font><font style="vertical-align: inherit;">, le serveur termine la r√©cup√©ration et passe en mode de fonctionnement normal. Maintenant, il n'en sera plus ainsi. Le processus de r√©cup√©ration s'arr√™tera, comme indiqu√© dans le journal, et l'administrateur aura la possibilit√© d'ins√©rer les segments WAL manquants et de poursuivre la r√©cup√©ration.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Le param√®tre ignore_invalid_pages</font></font></b></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Lorsque le processus de r√©cup√©ration sur une r√©plique trouve un lien vers une page non valide dans l'enregistrement WAL,</font></font><code>panic</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-a</font><font style="vertical-align: inherit;">se produit</font><font style="vertical-align: inherit;">. L'inclusion du param√®tre aidera √† le surmonter.</font></font><code>ignore_invalid_pages</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. La r√©cup√©ration se poursuivra avec une perte possible d'int√©grit√©, de donn√©es et d'autres cons√©quences les plus graves. Le param√®tre est destin√© aux d√©veloppeurs de serveurs et doit √™tre utilis√© dans les cas o√π vous devez encore essayer de terminer la r√©cup√©ration et de d√©marrer la r√©plique. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Changer primary_conninfo sans red√©marrer</font></font></b></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
le patch de Sergey Kornilov, qui vous permet de changer les param√®tres </font></font><code>primary_conninfo</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>primary_slot_name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code>wal_receiver_create_temp_slot</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sans red√©marrer le serveur. En fait, pour cela, ils ont abandonn√© le fichier </font></font><code>recovery.conf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dans la 12e version. </font><font style="vertical-align: inherit;">
Les manifestes de </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sauvegarde</font></font></b></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Pg_basebackup cr√©ent maintenant un ¬´manifeste¬ª - un fichier JSON contenant des informations sur la sauvegarde effectu√©e (noms et tailles des fichiers, fichiers WAL n√©cessaires, ainsi que des sommes de contr√¥le pour tout et tout).</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le nouvel utilitaire pg_validatebackup v√©rifie la conformit√© des sauvegardes avec le manifeste et v√©rifie √©galement la disponibilit√© et l'exactitude des fichiers WAL n√©cessaires √† la r√©cup√©ration √† l'aide de l'utilitaire pg_waldump (cela s'applique uniquement aux fichiers WAL √† l'int√©rieur de la sauvegarde elle-m√™me, et non dans l'archive). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cela vous permettra de d√©tecter les situations o√π les fichiers de sauvegarde ont √©t√© endommag√©s ou ont disparu, ou lorsque la r√©cup√©ration est devenue impossible en raison du manque de fichiers journaux n√©cessaires. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Limitation de l'emplacement de r√©plication des donn√©es non lues L'emplacement de r√©plication</font></font></b></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
est un m√©canisme pratique mais dangereux: si le client ne lit pas les donn√©es de l'emplacement √† temps, les enregistrements WAL non lus peuvent occuper tout l'espace du serveur. Maintenant en utilisant le param√®tre</font></font><code>max_slot_wal_keep_size</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vous pouvez d√©finir une limite sur la quantit√© maximale d'espace disque pouvant √™tre occup√©e par des donn√©es non lues. </font><font style="vertical-align: inherit;">Si au prochain point de contr√¥le, il s'av√®re que la taille est d√©pass√©e, la fente est d√©sactiv√©e et la place est lib√©r√©e.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">les fen√™tres</font></font></h3><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prise en charge des sockets Unix sur Windows Les</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
sockets de domaine Unix sont pris en charge sur Windows 10, bien qu'ils soient d√©sactiv√©s par d√©faut.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Documentation</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il y a deux nouvelles applications dans la documentation. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apr√®s une longue </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">discussion</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , l' </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">annexe M. Glossaire est apparue</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Le glossaire compte actuellement 101 termes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La possibilit√© de mettre en √©vidence la couleur des messages de diagnostic des utilitaires de console √† l'aide d'une variable </font></font><code>PG_COLOR</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√©tait ant√©rieure. </font><font style="vertical-align: inherit;">Ceci est maintenant </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">document√©</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dans l' </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">annexe N. Prise en charge des couleurs</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">L'intention originale de Peter Eisentrout dans ce patch √©tait de rendre la sortie coloris√©e activ√©e par d√©faut. </font><font style="vertical-align: inherit;">Et pour ceux qui ne le voulaient pas, il a √©t√© propos√© de d√©finir explicitement la variable</font></font><code>NO_COLOR</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Mais il y avait plus d'opposants √† la diff√©renciation des couleurs des messages parmi ceux qui discutaient du patch. </font><font style="vertical-align: inherit;">Par cons√©quent, ils ont d√©cid√© de documenter uniquement les opportunit√©s disponibles. </font><font style="vertical-align: inherit;">Et nous avons obtenu une nouvelle section du premier niveau dans la documentation.</font></font><br>
<br>
<hr><br>
<i>        PG13,  ,  PG14     . ,   . .</i></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr493094/index.html">Les employ√©s d'entrep√¥t d'Amazon sonnent l'alarme suite √† la propagation du coronavirus</a></li>
<li><a href="../fr493096/index.html">Ajouter un th√®me sombre dans iOS</a></li>
<li><a href="../fr493098/index.html">D√©ployer le cluster d'√©quilibrage de charge VPN ASA</a></li>
<li><a href="../fr493100/index.html">Comment trouver des moyens simples aide les startups √† atteindre une croissance agressive</a></li>
<li><a href="../fr493102/index.html">Tendances mondiales de l'automatisation: d√©veloppement RPA</a></li>
<li><a href="../fr493108/index.html">Cloudflare s√©lectionne des processeurs AMD pour les serveurs Edge de dixi√®me g√©n√©ration</a></li>
<li><a href="../fr493110/index.html">Comment d√©l√©guer dans le travail √† distance - un guide pour le chef d'√©quipe et plus</a></li>
<li><a href="../fr493112/index.html">Comment d√©marrer une nouvelle entreprise en 6 mois au lieu de 3 ans</a></li>
<li><a href="../fr493114/index.html">Comment Data Engineer a regard√© les donn√©es</a></li>
<li><a href="../fr493116/index.html">"Plus d'interactivit√©!" ou comment √©tait TeamLead Conf 2020</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>