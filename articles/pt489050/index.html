<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üîÇ üëî üë©‚Äçüë©‚Äçüëß Windows vs Sysmon üí™ üéπ üôáüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Na √∫ltima confer√™ncia do ZeroNights, no curso da comunica√ß√£o informal com nossos colegas no sistema de monitoramento, nos fizeram uma pergunta simples...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Windows vs Sysmon</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/489050/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/yy/x6/_z/yyx6_zfwsrw0m-c8zx_yr5bimqs.jpeg"></div><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Na √∫ltima confer√™ncia do ZeroNights, no curso da comunica√ß√£o informal com nossos colegas no sistema de monitoramento, nos fizeram uma pergunta simples √† primeira vista - acreditava-se amplamente que o Sysmon deveria ser usado para monitorar completamente o endpoint no sistema operacional Windows, √© isso? </font><font style="vertical-align: inherit;">E se sim, por que motivos espec√≠ficos (ol√° Seryozha!)? </font><font style="vertical-align: inherit;">N√£o conseguimos encontrar uma resposta abrangente e inequ√≠voca em nossa bagagem de conhecimento ou uma compara√ß√£o correspondente na Internet; portanto, antes de tudo, para n√≥s mesmos e n√£o menos importante, para que no futuro tal fonte ainda estivesse dispon√≠vel na comunidade, decidimos explorar este t√≥pico. e compare os eventos presenciais do Windows e do Sysmon. </font><font style="vertical-align: inherit;">Como diz o ditado, "1 ... 2 ... 3 ... Lute!".</font></font><a name="habracut"></a></p><br>
<a name="stage1"></a><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Introdu√ß√£o</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Qualquer especialista no campo da seguran√ßa da informa√ß√£o √© for√ßado a trabalhar dentro de uma determinada estrutura. Por exemplo, dentro de um or√ßamento limitado, a seguran√ßa, com raras exce√ß√µes, n√£o √© a principal maneira de uma organiza√ß√£o obter lucro ou executar outras fun√ß√µes em seu neg√≥cio principal. Portanto, em condi√ß√µes de recursos limitados que a organiza√ß√£o possui, apenas uma pequena parte deles √© frequentemente alocada ao setor de seguran√ßa, a fim de manter essa dire√ß√£o no n√≠vel m√≠nimo suficiente (de acordo com certos requisitos). Mesmo com recursos ilimitados, sempre haver√° outras restri√ß√µes que n√£o permitem elevar o n√≠vel de seguran√ßa ao absoluto. Essas s√£o as vulnerabilidades not√≥rias do dia zero ou normal (gerenciamento sem fim de patches) e a corrida armamentista constante de hackers e seguran√ßas,e o dinamismo do desenvolvimento da infraestrutura de TI e muito, muito mais.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sob esse prisma, mais do que nunca, a quest√£o de priorizar os meios e m√©todos de prote√ß√£o √© urgente, inclusive na dire√ß√£o do monitoramento. Nesta √°rea, de acordo com estat√≠sticas baseadas nos dados da matriz </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MITRE ATT &amp; CK</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , que j√° </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">escrevemos</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sobre a √∫ltima vez, as prioridades s√£o as seguintes: o primeiro lugar incondicional √© tomado por uma </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fonte de eventos de seguran√ßa</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> como pontos de extremidade.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/hr/9p/it/hr9piteihbc4qv4qgsff55qu2iq.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Essa fonte leva ao n√∫mero de t√©cnicas de matriz que podem ser identificadas com base nos eventos registrados nela. O sistema operacional mais comum para terminais continua sendo o Microsoft Windows. A coleta exata de seus logs na maioria das infra-estruturas corporativas fornecer√° o melhor resultado na propor√ß√£o de todos os tipos de custos para a cobertura de dispositivos de rede e a cobertura de t√©cnicas maliciosas. Isso √© confirmado pelas estat√≠sticas dos mesmos autores. Os lugares 1-3, 5, 7, 8, 10 e parte 4 ocupam apenas os chamados eventos b√°sicos.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/gh/7q/7o/gh7q7otidvmpw_ibo6fqnaxmsuw.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas, como na famosa piada, h√° uma ressalva. Nos √∫ltimos anos, tornou-se amplamente aceito que os logs do Windows precisam ser complementados, se n√£o substitu√≠dos, pelos eventos Sysmon - eles dizem que s√£o mais completos, melhores e mais adaptados como uma ferramenta de monitoramento do ponto de vista da seguran√ßa da informa√ß√£o. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al√©m disso, essa abordagem atende de alguma forma ao conceito de minimalismo. Cada produto de software que voc√™ est√° tentando adicionar aos seus ou voluntariamente dado a voc√™ por um cliente corporativo √© um aumento na √°rea de ataque, custos de administra√ß√£o e atualiza√ß√£o e pontos de falha. E muitas vezes - e apenas o tempo antes da implementa√ß√£o do seu sistema de monitoramento, enquanto sua abordagem passa na aprova√ß√£o.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O Sysmon foi desenvolvido por especialistas da Microsoft e recentemente absorvido por esta corpora√ß√£o, o que fornece um certo n√≠vel de confian√ßa por parte da TI. Al√©m disso, os logs s√£o gravados na forma de um log .evtx, que permite colet√°-los e process√°-los usando as mesmas ferramentas e m√©todos que os logs regulares do Windows.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fa√ßa imediatamente uma reserva de que o artigo acabou sendo grande, embora tentemos duplicar e compactar o material minimamente. O leitor, √© claro, pode dizer, nos referindo √† piada sobre Lenin: "Mas ele poderia ter cortado ...". Ou que "a publica√ß√£o pode ser dividida em duas ou tr√™s partes para maior legibilidade". Mas pareceu-nos que, apesar do volume do material preparado, devemos fornecer uma resposta completa √† pergunta de nossos colegas da loja, e a pesquisa ser√° mais conveniente. Portanto, para n√£o perder nada, recomendamos que voc√™ leia o artigo 1 completamente, talvez fa√ßa anota√ß√µes para si mesmo e s√≥ depois retorne a grupos espec√≠ficos de eventos e os examine detalhadamente.</font></font><br>
<br>
<a name="stage2"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por conveni√™ncia, n√≥s adicionamos uma tabela de conte√∫do: </font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Introdu√ß√£o </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√çndice </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">formato Compara√ß√£o </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">criar um processo </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conex√µes de rede </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Terminar um processo de </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">baixar um driver </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de acesso a um processo de </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cria√ß√£o de um arquivo de </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a√ß√µes de registro </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WMI configura√ß√£o </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">consultas DNS </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exclusivo SYSMON </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">eventos Filtrando Eventos </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Outros provedores de eventos base livre </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de sa√≠da Geral</font></font></a><br>
<br>
<a name="stage3"></a><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Formato de compara√ß√£o</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por que e o que foi comparado, parece claro. E como isso foi feito e por que exatamente? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Decidimos fazer uma compara√ß√£o na forma de uma tabela para cada um dos grupos de eventos que refletem uma determinada atividade no sistema. Por exemplo, eventos com o ID (ID do evento, EID) 12, 13 e 14 no Sysmon, refletindo a atividade com o registro, nem sequer s√£o filtrados separadamente, embora falem de a√ß√µes at√¥micas diferentes. Pela mesma l√≥gica, o restante do agrupamento foi feito. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esses grupos inclu√≠ram apenas eventos semelhantes. Por exemplo, um an√°logo do evento Sysmon EID 6 √© o evento Windows EID 6. Ao mesmo tempo, existem pelo menos 219 e 7036 eventos do Windows sobre o carregamento de drivers. Mas eles surgem em caso de falha. Essa. n√£o carregam a mesma carga sem√¢ntica e, se necess√°rio, podem complementar os eventos do Sysmon ou Windows, dependendo do que decidimos coletar.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para grupos de eventos refletidos na tabela, os campos informativos (que usamos para fins de monitoramento) contidos nos eventos s√£o apresentados na forma de cadeias. Para cada um desses campos, seu nome √© indicado. No Windows, s√£o poss√≠veis 2 op√ß√µes, para visualiza√ß√µes em XML e em revistas (quem pensaria que corresponderiam?) Se diferirem mais do que por espa√ßos. Isso √© feito porque o nome do campo que cair√° no sistema de monitoramento pode depender do m√©todo de coleta. As linhas tamb√©m cont√™m dados do evento (para entender seu formato) e um coment√°rio (se em nossa opini√£o isso for necess√°rio). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os campos com a mesma carga sem√¢ntica para ambas as fontes s√£o combinados em uma linha. Na aus√™ncia de um campo com carga sem√¢ntica semelhante para uma das fontes, tra√ßos ("-") s√£o indicados nos campos correspondentes a ele.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Linhas contendo informa√ß√µes sobre uma entidade espec√≠fica, por exemplo, o sujeito que est√° executando a a√ß√£o, s√£o combinadas em um grupo sem√¢ntico. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A compara√ß√£o foi feita para vers√µes do Windows Kernel 6.3 (Windows 2012R2) e 10.0 (Windows 10, 2016, 2019). As vers√µes anteriores n√£o foram consideradas, pois, embora ainda sejam difundidas, est√£o desaparecendo gradualmente. Se os eventos para diferentes vers√µes do kernel n√£o diferirem, as colunas foram combinadas em uma para reduzir a duplica√ß√£o. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como a taxa √© de tempo integral, as colunas s√£o organizadas na seguinte ordem, do centro √†s bordas: dados, nome do campo, coment√°rio. Isso torna a compara√ß√£o mais visual. Para a separa√ß√£o visual das colunas de acordo com as fontes √†s quais elas se referem, s√£o usadas cores.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Exclusivo do Sysmon EID (uma vez que, neste caso, √© uma ferramenta complementar, a grava√ß√£o de logs do SO est√° inclu√≠da na funcionalidade b√°sica do SO) √© fornecida em uma se√ß√£o separada. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A se√ß√£o com a tabela mostra as configura√ß√µes de GPO que devem ser feitas para habilitar a grava√ß√£o no log de eventos do grupo, como </font><font style="vertical-align: inherit;">o n√∫mero de op√ß√µes poss√≠veis de auditoria √© geralmente bastante grande. </font><font style="vertical-align: inherit;">Para Sysmon, essas configura√ß√µes n√£o s√£o mostradas porque </font><font style="vertical-align: inherit;">todos eles est√£o contidos em um √∫nico arquivo de configura√ß√£o.</font></font><br>
<br>
<a name="stage4"></a><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cria√ß√£o de processo</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Paradoxalmente, eles decidiram come√ßar do come√ßo. E eles tamb√©m n√£o eram originais e estavam em ordem - aumentando o EID Sysmon. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O registro de dados do evento no Windows √© ativado da seguinte maneira: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
‚Ä¢ Configura√ß√£o do computador - Diretivas - Configura√ß√µes do Windows - Configura√ß√µes de seguran√ßa - Configura√ß√£o avan√ßada da diretiva de auditoria - Diretivas de auditoria - Acompanhamento detalhado - Cria√ß√£o do processo de auditoria - O √™xito permite o registro do pr√≥prio evento; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
‚Ä¢ Configura√ß√£o do computador - Diretivas - Modelos administrativos - Sistema - Cria√ß√£o de processos de auditoria - Incluir linha de comando nos eventos de cria√ß√£o de processo - adiciona a linha de comando do processo iniciado ao evento, o que geralmente possibilita distinguir uma partida leg√≠tima de uma partida ileg√≠tima. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A compara√ß√£o no formato descrito acima √© apresentada na tabela a seguir.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><div style="text-align:center;"><img src="https://habrastorage.org/webt/rs/dw/nm/rsdwnmsmgurjif--9gck7phggee.png"></div></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A seguir, todas as tabelas s√£o representadas por figuras e s√£o clic√°veis. Como, em primeiro lugar, n√£o encontramos uma boa maneira de transferir tabelas para Markdown ou HTML, preservando a largura ou hifeniza√ß√£o da coluna de acordo com a vers√£o existente no Excel. E segundo, o conte√∫do deles n√£o √© muito valioso para indexa√ß√£o, exceto para coment√°rios. Muito mais valioso nas tabelas √© a composi√ß√£o dos campos discutidos neste artigo e o formato de dados com o qual voc√™ precisar√° trabalhar se essas fontes de eventos forem usadas.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Considere-o em ordem, mas n√£o linha por linha - cada um far√° uma an√°lise detalhada por si mesmo. </font><font style="vertical-align: inherit;">Nesta se√ß√£o e abaixo, abordaremos apenas as informa√ß√µes encontradas pela primeira vez. </font><font style="vertical-align: inherit;">Comece imediatamente com um exemplo desse comportamento. </font><font style="vertical-align: inherit;">Os campos da se√ß√£o Sistema est√£o presentes em todos os eventos que caem no log, independentemente da origem - Sysmon ou Windows. </font><font style="vertical-align: inherit;">Eles incluem informa√ß√µes gerais:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O nome do provedor de eventos.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EID</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A hora em que o evento foi registrado.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O nome da revista de onde recebemos esse evento.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O host no qual o evento ocorreu.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O nome do provedor e o log ap√≥s a conex√£o geralmente n√£o s√£o usados ‚Äã‚Äãpelo analista. Mas eles possibilitam entender onde e quem grava os logs, o que √© importante se o processo de coleta ainda n√£o tiver sido iniciado. Tempo, host e EID s√£o os principais beacons pelos quais a filtragem prim√°ria de eventos √© realizada. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al√©m disso, entre os campos que eu particularmente gostaria de observar - o GUID da sess√£o do usu√°rio e dos processos filho e pai existe apenas nos logs do Sysmon. E para o mesmo cofrinho, por esquisitices - o ID do processo (novo e pai) nos eventos do Windows √© gravado em hexadecimal, embora seja exibido em nota√ß√£o decimal no mesmo Gerenciador de Tarefas. Como diz o ditado, depura√ß√£o feliz ("-Quer melhorar? -Github") ...</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A linha de comando ao iniciar um processo nos eventos do Windows tem um formato diferente, dependendo do utilit√°rio usado para inici√°-lo. Mas em Sysmon, os autores queriam e podiam - o formato n√£o depende de outras informa√ß√µes. N√£o vou julgar os motivos, mas os criadores do conte√∫do do SIEM n√£o escrever√£o gra√ßas a Microsoft sobre isso, com certeza. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O principal recurso distintivo do Sysmon para isso, assim como para outros eventos que cont√™m esse campo, eu chamaria o hash do arquivo execut√°vel. O formato hash √© selecionado na configura√ß√£o do Sysmon.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Novamente, dos b√¥nus adicionais interessantes de Sysmon - o campo Nome da regra. </font><font style="vertical-align: inherit;">Essa √©, de fato, uma tag que √© conveniente para marcar certos filtros no arquivo de configura√ß√£o e us√°-la na an√°lise de eventos. </font><font style="vertical-align: inherit;">Por exemplo, podemos dizer que o processo inicial X se refere √†s t√°ticas Y ou t√©cnica Z. Essa abordagem √© interessante tanto do ponto de vista do analista quanto do desenvolvedor de conte√∫do SIEM ou Sysmon - nos permite entender o motivo pelo qual decidimos coletar esse evento.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclus√£o</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sysmon √© muito melhor para corrigir esse grupo de eventos:</font></font><br>
<br>
<ul>
<li> GUID       ,          , ,     ,      ID         (    ).  , ,           .         .    ID           , , SIEM,         .  GUID,  ‚Äî  .</li>
<li>  ‚Äî                 ‚Äî  ,            ,    .    ‚Äî  Sysmon    ,      SIEM ( ).   -    ‚Äî   ,        .    ,   SIEM     .   , ,  IBM QRadar. , -     .   , ,     ‚Äî  Windows  ,    ,    .</li>
<li>  Rule Name    .</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A aplicabilidade dos campos exclusivos restantes, nos eventos do Windows e nos eventos Sysmon, desempenha um papel, como se costuma dizer em ingl√™s, caso a caso. </font><font style="vertical-align: inherit;">Portanto, para decidir sobre a escolha de um log espec√≠fico, ou em geral combin√°-los, tamb√©m √© necess√°rio caso a caso.</font></font></li>
</ul><a name="stage5"></a><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conex√µes de rede</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gravando esses eventos no Windows: Configura√ß√£o do computador - Diretivas - Configura√ß√µes do Windows - Configura√ß√µes de seguran√ßa - Configura√ß√£o avan√ßada da diretiva de auditoria - Diretivas de auditoria - Acesso a objetos - Conex√£o da plataforma de filtragem de auditoria</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por que voc√™ decidiu se concentrar nos eventos da Plataforma de Filtragem do Windows (WFP), e n√£o no Firewall do Windows? A resposta √© simples. Com base em nossa pr√°tica, os pontos de extremidade na forma de antiv√≠rus j√° est√£o nos hosts de qualquer maneira. Embora eles n√£o sejam projetados para monitorar os eventos b√°sicos do sistema (√© por isso que n√£o s√£o adequados para nossos prop√≥sitos), no entanto, nas realidades modernas, eles sempre incluem um firewall de host. Por esse motivo, para evitar duplica√ß√£o, o Firewall do Windows geralmente √© simplesmente cancelado. Dessa forma, ningu√©m escreve para o coronel ... no entanto, embora ele possa filtrar o tr√°fego, n√≥s o usamos apenas para monitoramento. Portanto, a duplica√ß√£o est√° ausente.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><div style="text-align:center;"><img src="https://habrastorage.org/webt/nq/59/ba/nq59banogevpo2koyntusv8dtfo.png"></div></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A tabela mostra que, se tentarmos confiar nos eventos do Windows, o ultrassom do usu√°rio e o FQDN dos hosts em intera√ß√£o precisar√£o ser restaurados pelo enriquecimento do evento. Embora, se voc√™ pensar bem, √© mais importante sabermos qual processo estabeleceu a conex√£o e n√£o qual usu√°rio. Por exemplo, o malware vai para o seu centro de C&amp;C. De qualquer forma, queremos descobrir quem iniciou o processo ou criar um incidente com base no entendimento de que o bloco de notas n√£o vai para a pr√≥pria Internet (ou seja, com base nas informa√ß√µes dispon√≠veis no evento).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E com o FQDN √© ainda mais simples - todos os sistemas modernos incluem o componente CMDB como uma funcionalidade b√°sica ou adicional. </font><font style="vertical-align: inherit;">Se n√£o, definitivamente vale a pena estocar uma solu√ß√£o de terceiros. </font><font style="vertical-align: inherit;">Conhecer sua infraestrutura √© a base da seguran√ßa da informa√ß√£o em geral. </font><font style="vertical-align: inherit;">Portanto, as informa√ß√µes est√£o dispon√≠veis por meio de enriquecimento ou por meio de um cart√£o de ativos, o que permitir√° seu uso em correla√ß√£o. </font><font style="vertical-align: inherit;">O principal √©, se poss√≠vel, n√£o esquecer de conectar os logs do DHCP para que as informa√ß√µes estejam atualizadas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todos os outros campos exclusivos n√£o s√£o t√£o significativos, por exemplo:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Portos famosos. </font><font style="vertical-align: inherit;">N√£o confiar√≠amos nesse campo - n√£o √© em v√£o que existem meios para detectar anomalias no tr√°fego quando, por exemplo, o t√∫nel ssh passa pela porta 80 em vez de HTTP.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dire√ß√£o de tr√°fego. </font><font style="vertical-align: inherit;">Conhecendo o ID do host (IP ou FQDN) e a origem \ destino da conex√£o, voc√™ pode calcular facilmente a dire√ß√£o.</font></font></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclus√£o</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E, nesse caso, o Sysmon vence, mas menos significativamente - o GUID, o FQDN, o usu√°rio fornece uma conveni√™ncia que √© bem poss√≠vel de se obter usando SIEM ou solu√ß√µes de terceiros. </font><font style="vertical-align: inherit;">No entanto, pequenos esfor√ßos n√£o significam zero.</font></font><br>
<a name="stage6"></a><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclus√£o do processo</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em geral, o evento, como j√° mencionado acima, n√£o √© muito usado, mas ...</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><div style="text-align:center;"><img src="https://habrastorage.org/webt/lq/0e/x0/lq0ex02swhhs39noycfzb1m2wog.png"></div></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se for necess√°rio, h√° uma vit√≥ria clara do lado do Windows. </font><font style="vertical-align: inherit;">N√≥s adicionamos apenas como habilitar o log e vamos direto √†s conclus√µes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Configura√ß√£o do computador - Pol√≠ticas - Configura√ß√µes do Windows - Configura√ß√µes de seguran√ßa - Configura√ß√£o avan√ßada da pol√≠tica de auditoria - Pol√≠ticas de auditoria - Rastreamento detalhado - Encerramento do processo de auditoria - Sucesso</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclus√£o</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nesse caso, a vantagem do log do SO nativo √© obtida por:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exibe o usu√°rio que concluiu o processo.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A presen√ßa do c√≥digo de sa√≠da, que pode falar sobre a conclus√£o regular do processo, bem como erros.</font></font></li>
</ul><a name="stage7"></a><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Download do driver</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esse evento do Windows, diferente dos outros, √© ativado por padr√£o e entra no log do sistema. </font><font style="vertical-align: inherit;">N√£o h√° muitos campos informativos nesses eventos.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><div style="text-align:center;"><img src="https://habrastorage.org/webt/a3/hd/4k/a3hd4kpimlddce6uu5az5mzn_dw.png"></div></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E, novamente, imediatamente para as conclus√µes.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclus√£o</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nesse grupo, os eventos Sysmon fornecem ao analista informa√ß√µes muito mais √∫teis. </font><font style="vertical-align: inherit;">Por exemplo, de acordo com os eventos do Windows, ainda n√£o est√° claro qual arquivo de driver foi usado. </font><font style="vertical-align: inherit;">Portanto, neste grupo de Windows em estranhos expl√≠citos.</font></font><br>
<a name="stage8"></a><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Acesso ao processo</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N√£o classificamos esse grupo de eventos como b√°sico, mas como um n√≠vel ligeiramente avan√ßado. Do ponto de vista da seguran√ßa, o evento pode ser de grande interesse. H√° muitas </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">maneiras pelas quais um</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> processo malicioso pode tornar seu leg√≠timo pouco "melhor". Obviamente, n√£o pelo altru√≠smo, mas por a√ß√µes maliciosas. E os eventos em considera√ß√£o nos ajudar√£o a descobrir muitas op√ß√µes para essa criatividade. Esses logs s√£o ativados em Configura√ß√£o do Computador - Diretivas - Configura√ß√µes do Windows - Configura√ß√µes de Seguran√ßa - Configura√ß√£o Avan√ßada da Pol√≠tica de Auditoria - Diretivas de Auditoria - Acesso a Objetos - Objeto do Kernel de Auditoria - Sucesso</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><div style="text-align:center;"><img src="https://habrastorage.org/webt/g5/3x/xm/g53xxmsrxfjnuq5dy-hxfatsq2g.png"></div></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O Windows tem duas vantagens. Primeiramente, o mapeamento do usu√°rio do qual o processo de origem est√° trabalhando. Como observamos acima, a vantagem √© geralmente insignificante. E, em segundo lugar, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HandleID</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e direitos de acesso. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se o interesse nos direitos de acesso for claro, o HandleID ser√° √∫til apenas para pesquisar eventos relacionados. √â necess√°rio organizar a intera√ß√£o do usu√°rio por meio de processos com objetos do SO - os mesmos processos (seus encadeamentos), arquivos etc. Consequentemente, eventos adicionais podem mostrar como, como resultado, e para quem foi emitido e quando o identificador necess√°rio para o acesso foi revogado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tocando pela primeira vez nos t√≥picos de objetos e manuseio, al√©m de registrar a√ß√µes com eles, √© importante observar duas coisas.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Primeiro, para registrar as etapas adicionais acima, √© importante habilitar configura√ß√µes adicionais para pol√≠ticas de auditoria, em particular Configura√ß√£o do Computador - Pol√≠ticas - Configura√ß√µes do Windows - Configura√ß√µes de Seguran√ßa - Configura√ß√£o Avan√ßada da Pol√≠tica de Auditoria - Pol√≠ticas de Auditoria - Acesso a Objetos - Manipula√ß√£o de Identificador de Auditoria - Sucesso. Vale lembrar que o volume desses eventos pode ser muito grande. O identificador √© emitido ap√≥s o recebimento de uma solicita√ß√£o, respectivamente, reflete os direitos reivindicados. Mas por que n√£o podemos esperar o mesmo volume de eventos diretamente da auditoria de acesso a objetos?</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Isso ocorre porque, em segundo lugar, √© necess√°rio ativar a SACL no objeto planejado para ser controlado. De fato, esta √© uma lista semelhante √† lista de direitos de acesso DACL, que determina se o assunto ou objeto criado com seu token receber√° √™xito ou falha ao tentar acessar o objeto. Mas a SACL determina aproximadamente da mesma forma n√£o os direitos de interagir com o objeto, mas se os eventos de seguran√ßa ser√£o gerados ao solicitar e exercer determinados direitos. Esses eventos incluir√£o ainda n√£o solicitados, mas realmente usaram direitos de acesso.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como resultado, obtemos um filtro que permite registrar apenas o acesso a objetos cr√≠ticos para n√≥s e apenas os tipos de acesso que s√£o importantes para n√≥s. Mas, em troca, devemos anexar uma SACL diretamente a cada objeto ou indicar que a SACL √© herdada do objeto pai. Obviamente, isso pode ser automatizado por v√°rios m√©todos. Por√©m, √© improv√°vel que seja conveniente manter a configura√ß√£o dessas ferramentas de automa√ß√£o. Ao contr√°rio de uma lista Sysmon simples, que tamb√©m pode incluir caracteres curinga, embora sejam peculiares. Falaremos sobre a filtragem no Sysmon em uma se√ß√£o separada. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Felizmente, para objetos do tipo, um processo SACL j√° existe por padr√£o para a vers√£o 6.3 e superior do kernel. Se algu√©m puder especificar uma maneira de receber essa SACL (recomenda√ß√µes deste </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">artigo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">falhamos em cumprir), ser√° interessante ouvir / discutir. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No lado do Sysmon, al√©m dos GUIDs e nomes de regras j√° discutidos, existem v√°rios campos mais interessantes. </font><font style="vertical-align: inherit;">Primeiro, o PID do processo de destino. </font><font style="vertical-align: inherit;">Isso permitir√° que voc√™ monitore a atividade subseq√ºente do objeto infectado, porque pode haver v√°rias inst√¢ncias de um arquivo execut√°vel. </font><font style="vertical-align: inherit;">Em segundo lugar, o campo CallTrace, que captura as a√ß√µes da fonte de eventos no destino. </font><font style="vertical-align: inherit;">Olhe para isso e perceba que "truque de m√£o e nenhuma fraude" n√£o s√£o apenas palavras. </font><font style="vertical-align: inherit;">Por outro lado, uma an√°lise t√£o detalhada j√° √© o destino da per√≠cia. </font><font style="vertical-align: inherit;">E quem tem um forense dedicado provavelmente n√£o est√° no in√≠cio do caminho para a constru√ß√£o de um sistema de monitoramento.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclus√£o</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nesse grupo, os eventos diferem em um n√∫mero bastante grande de campos. </font><font style="vertical-align: inherit;">Por√©m, se nos eventos do Windows essas informa√ß√µes provavelmente fornecerem a conveni√™ncia da an√°lise inicial, o Sysmon captura dados exclusivos que s√£o dif√≠ceis de obter de qualquer outra maneira. </font><font style="vertical-align: inherit;">Portanto, a vantagem permanece com o Sysmon.</font></font><br>
<a name="stage9"></a><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cria√ß√£o de arquivo</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esta categoria est√° inclu√≠da no Windows da seguinte maneira: Configura√ß√£o do computador - Diretivas - Configura√ß√µes do Windows - Configura√ß√µes de seguran√ßa - Configura√ß√£o avan√ßada da diretiva de auditoria - Diretivas de auditoria - Acesso a objetos - Sistema de arquivos de auditoria - Sucesso</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><div style="text-align:center;"><img src="https://habrastorage.org/webt/wu/qp/wy/wuqpwygxyngiqa8db58gvoenmiu.png"></div></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como pode ser visto na tabela, todos os pr√≥s e contras desse grupo s√£o semelhantes aos j√° descritos acima. A inclus√£o de pr√≥s e contras da SACL (para arquivos e pastas para todos os usu√°rios), inclui Propriedades - Seguran√ßa - Avan√ßado - Auditoria - Adicionar - Todos - Sucesso - Grava√ß√£o (para arquivos) ou Modifica√ß√£o (para um diret√≥rio)). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voc√™ tamb√©m pode definir SACL em arquivos globalmente, definindo-o em Configura√ß√£o do computador - Diretivas - Configura√ß√µes do Windows - Configura√ß√µes de seguran√ßa - Configura√ß√£o avan√ßada da diretiva de auditoria - Diretivas de auditoria - Acesso a objetos - Auditoria global de acesso a objetos - Sistema de arquivos. Mas o n√∫mero de eventos, especialmente com arquivos tempor√°rios, aumentar√° proporcionalmente ao volume de opera√ß√µes. Eu n√£o diria que esta √© uma abordagem eficaz, s√≥ √© poss√≠vel para uma pequena parte das opera√ß√µes.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gostaria de observar as peculiaridades dos registros que come√ßam aqui. </font><font style="vertical-align: inherit;">Para este grupo n√£o √© fixo de eventos do Windows quando um arquivo √© criado atrav√©s do PowerShell, por exemplo, </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o New-Item C: \ FORTEST \ test.t</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Ao mesmo tempo, a mesma a√ß√£o √© exibida perfeitamente nos logs do Sysmon.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclus√£o</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esse grupo de eventos √© melhor gravado usando o Sysmon.</font></font><br>
<a name="stage10"></a><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A√ß√µes do Registro</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
At√© agora, falando do grupo, inclu√≠mos apenas um evento nele. </font><font style="vertical-align: inherit;">Esta tend√™ncia vai mudar aqui.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><div style="text-align:center;"><img src="https://habrastorage.org/webt/kl/wm/b0/klwmb01kl6o_14omabn-qdhjh-c.png"></div></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O log desses eventos √© configurado da seguinte maneira: Configura√ß√£o do computador - diretivas - configura√ß√µes do Windows - configura√ß√µes de seguran√ßa - configura√ß√£o avan√ßada da diretiva de auditoria - diretivas de auditoria - acesso a objetos - registro de auditoria - √™xito. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A SACL para todos os usu√°rios (Todos) √© definida da seguinte forma: regedit.exe - ramifica√ß√£o do registro - Permiss√µes - Avan√ßado - Auditoria - Todos - Sucesso - Permiss√µes avan√ßadas - Controle total ou Valor definido, Criar subchave, Criar link, Excluir link, Excluir DAC de grava√ß√£o. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voc√™ tamb√©m pode definir SACL em arquivos globalmente, definindo-o em Configura√ß√£o do computador - Diretivas - Configura√ß√µes do Windows - Configura√ß√µes de seguran√ßa - Configura√ß√£o avan√ßada da diretiva de auditoria - Diretivas de auditoria - Acesso a objetos - Auditoria global de acesso a objetos - Registro. Os contras da abordagem s√£o semelhantes √†s mesmas opera√ß√µes de arquivo.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Concentre-se imediatamente nas limita√ß√µes. </font><font style="vertical-align: inherit;">Para Sysmon, todas as opera√ß√µes (criar, modificar, excluir) com eventos de valor ou aumento de chave (exceto para renomear valor). </font><font style="vertical-align: inherit;">Para Windows:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Todas as opera√ß√µes com valor aumentam eventos. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Criar uma chave n√£o gera eventos. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Renomear chave gera apenas o evento Access, o novo nome da chave n√£o √© exibido; </font><font style="vertical-align: inherit;">os direitos solicitados especificados no evento n√£o t√™m uma correspond√™ncia intuitivamente inequ√≠voca com a opera√ß√£o. </font><font style="vertical-align: inherit;">Assim, a opera√ß√£o de renomea√ß√£o s√≥ pode ser determinada pelo m√©todo de exce√ß√£o - n√£o h√° evento de exclus√£o 4660 com este HandleID.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A remo√ß√£o da chave gera o evento 4663 seguido por 4660.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al√©m dos campos discutidos nas se√ß√µes anteriores, √© importante observar que os eventos do Windows cont√™m dados antigos e novos de nomes e valores de chave e valor, que durante a investiga√ß√£o podem ajudar a entender o motivo do invasor. </font><font style="vertical-align: inherit;">Especialmente se os valores iniciais n√£o forem padr√£o ou t√≠picos, e a configura√ß√£o, incluindo os dados do registro da m√°quina sob investiga√ß√£o, n√£o for armazenada em nenhum lugar fora do host.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclus√£o</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como podemos ver, existem restri√ß√µes mais rigorosas no log do Windows. </font><font style="vertical-align: inherit;">E para corrigir alguns fatos, √© necess√°ria uma "correla√ß√£o", embora a mais simples. </font><font style="vertical-align: inherit;">No entanto, √© capaz de fornecer uma quantidade maior de informa√ß√µes realmente √∫teis. </font><font style="vertical-align: inherit;">√â dif√≠cil dar prefer√™ncia a um dos participantes para este grupo de eventos.</font></font><br>
<a name="stage11"></a><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configura√ß√£o WMI</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Passamos ao pen√∫ltimo grupo de eventos. Estes s√£o eventos WMI. Um invasor pode criar um filtro (filtro) que recebe eventos sobre uma altera√ß√£o no estado do sistema; em nosso exemplo, uma altera√ß√£o no estado de um servi√ßo. E realizar determinadas a√ß√µes com base nos eventos recebidos desse filtro, criando um consumidor. No nosso caso, esta √© uma entrada no arquivo de log. Em seguida, ele deve conectar a sa√≠da do filtro √† entrada do consumidor, criando uma liga√ß√£o entre o filtro e o consumidor. Ele resultar√° em um sistema que funciona sob determinadas condi√ß√µes. Geralmente usado para t√°ticas de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">persist√™ncia</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . √â precisamente na ordem descrita que os eventos 19-21 Sysmon s√£o registrados.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√â importante entender que a cria√ß√£o de um filtro ou consumidor por si s√≥ n√£o representa uma amea√ßa, mas, √© claro, pode fazer parte de um ataque. Al√©m disso, para atividades maliciosas, um filtro existente, um consumidor ou ambos podem ser usados. Aqui √© como com uma faca, ou, mais perto do t√≥pico do recurso, com mensageiros criptografados. A quest√£o n√£o est√° na ferramenta, mas em seu uso. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos dar uma olhada mais de perto na mesa.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><div style="text-align:center;"><img src="https://habrastorage.org/webt/f9/bo/br/f9bobr7pus2gf7lnaxgoxcirosq.png"></div></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um ponto importante que deve ser observado antes de tudo - o evento 5861 √© gerado no log especificado apenas no fato da cria√ß√£o ou modifica√ß√£o subsequente (incluindo em termos de filtro e consumidor) do pacote configur√°vel. Por um lado, isso facilita o rastreamento de atividades supostamente maliciosas (n√£o √© necess√°ria nenhuma correla√ß√£o entre dois ou tr√™s eventos) se n√£o apenas um grupo for criado dentro dela. Por outro lado, perdemos o hor√°rio de in√≠cio dessa atividade se o filtro ou consumidor for criado precisamente dentro da estrutura dele e antes do tempo.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Isso √© cr√≠tico? Caso a caso. Se come√ßarmos a desenrolar a sequ√™ncia de um incidente e vermos que um filtro ou consumidor at√≠pico e supostamente malicioso foi criado h√° dois anos, percebemos imediatamente que os atacantes est√£o em casa conosco h√° mais de dois anos. E tra√ßos do ataque devem ser procurados pelo menos at√© essa profundidade. Quantas vezes isso acontece? Esta √© a quest√£o principal. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por√©m, se forem feitas altera√ß√µes no filtro ou no consumidor do pacote existente, veremos a imagem inteira em um √∫nico evento. Enquanto Sysmon refletir√° apenas as altera√ß√µes (esse objeto) que foram feitas.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entre outras diferen√ßas: nos eventos Sysmon, os dados s√£o refletidos de uma forma mais estruturada e em um formato mais conveniente. Por exemplo, em vez do SID em um formato at√≠pico, o logon do usu√°rio √© apresentado imediatamente. Mas os dados s√£o um pouco menos. Talvez isso seja cr√≠tico para o seu caso. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Conclu√≠mos com restri√ß√µes. Em primeiro lugar, apesar de esta revista estar presente desde o Windows 2012 (kernel 6.2), n√£o conseguimos obter esses eventos nem para o kernel 6.3 (2012R2), que √© estudado no artigo. Talvez isso se deva √† aus√™ncia de quaisquer corre√ß√µes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Segundo, de acordo com o autor </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">deste</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">artigos, o filtro para eventos de timer n√£o √© corrigido pelo Sysmon. </font><font style="vertical-align: inherit;">Seria poss√≠vel n√£o tomar uma palavra, mas verificar. </font><font style="vertical-align: inherit;">Al√©m disso, a vers√£o do Sysmon √© antiga. </font><font style="vertical-align: inherit;">Mas aqui um precedente √© importante - n√£o existem alguns tipos de filtros e consumidores de WMI. </font><font style="vertical-align: inherit;">A partir desse estudo, complementado por detalhes, um artigo separado poderia ser elaborado. </font><font style="vertical-align: inherit;">Apenas teste os tipos de destino para entender exatamente o que eles ser√£o registrados.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclus√£o</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nesse caso, estamos mais confort√°veis ‚Äã‚Äãcom o uso de eventos do Windows. </font><font style="vertical-align: inherit;">Do ponto de vista da conveni√™ncia: mais dados, n√£o h√° necessidade de correla√ß√£o prim√°ria. </font><font style="vertical-align: inherit;">Portanto, do ponto de vista da defini√ß√£o de objetivos - ele corrige a cria√ß√£o de um mecanismo (baseado em partes novas, modificadas ou existentes), e n√£o em suas partes individuais.</font></font><br>
<a name="stage12"></a><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Consultas DNS</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ent√£o, passamos para o grupo final sendo comparado, mas ainda longe da conclus√£o de nosso artigo. </font><font style="vertical-align: inherit;">Esse tipo e o conjunto de eventos correspondente s√£o recentes n√£o apenas pela apar√™ncia em nosso artigo, mas tamb√©m pela adi√ß√£o de Sysmon ao kit de ferramentas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nos √∫ltimos anos, o t√≥pico de usar o DNS para outros fins, por exemplo, para receber comandos da C&amp;C ou roubar informa√ß√µes por esse canal, tornou-se popular. </font><font style="vertical-align: inherit;">Provavelmente n√£o por si s√≥ - remeter√≠amos as hist√≥rias sobre esse uso dos canais ICMP e DNS a zero. </font><font style="vertical-align: inherit;">Naquela √©poca, estudantes familiares eram sofisticados no encapsulamento do tr√°fego de brinquedos, a fim de alcan√ßar os servidores de jogos cobi√ßados da rede do instituto pelos √∫nicos canais permitidos (Ol√°, Zhenya</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tumbochko</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">!). Isso tornou poss√≠vel, de alguma forma, passar o tempo chato ou dominar rapidamente seus laborat√≥rios. E dificilmente foi ideia deles. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas h√° pouco tempo, um conceito como DoH foi adicionado a esse canal de vazamento, o que complicou a detec√ß√£o de tr√°fego DNS suspeito no n√≠vel da rede. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ou talvez tenha sido apenas uma jogada de marketing - vender uma nova, que tamb√©m √© antiga. Ou o in√≠cio da ocorr√™ncia generalizada desses canais em atividades maliciosas detect√°veis. N√£o nos aprofundamos nessa quest√£o, preparados para coletar gr√£os - de repente, um dos leitores decide deixar um pouco de sabedoria nos coment√°rios. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ent√£o, mais perto do assunto. Ative o Visualizador de Eventos - Logs de Aplicativos e Servi√ßos - Microsoft - Windows - Eventos de Cliente DNS - Operacional - Menu de contexto - Ativar Log.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><div style="text-align:center;"><img src="https://habrastorage.org/webt/4o/oz/9m/4ooz9mm2kjdsagzhnxcymt5_mpq.png"></div></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tudo o mesmo que j√° discutido. Quanto √†s informa√ß√µes sobre o assunto, prestamos aten√ß√£o √† indica√ß√£o expl√≠cita da imagem do arquivo execut√°vel que executou a solicita√ß√£o no evento Sysmon. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se falamos sobre o objeto - h√° muito mais informa√ß√µes nos logs do Windows. Mas existem v√°rios "buts" importantes. Em primeiro lugar, a informa√ß√£o √© distribu√≠da por v√°rios eventos com todas as consequ√™ncias.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em segundo lugar, as informa√ß√µes s√£o apresentadas de maneira n√£o intuitiva. </font><font style="vertical-align: inherit;">Decifrar a maior parte do conhecimento requer conhecimento de como os campos do pacote s√£o formados e a capacidade de transformar esses dados novamente em fatos que facilitam a decis√£o do analista. </font><font style="vertical-align: inherit;">Podemos dizer que, de fato, o analista n√£o √© em v√£o recebendo um sal√°rio e por que n√£o sentar e descobrir isso. </font><font style="vertical-align: inherit;">Sim est√° certo. </font><font style="vertical-align: inherit;">Mas deixe-me lembr√°-lo, estamos falando de uma pequena equipe sem especialistas de perfil restrito, antes da qual n√£o h√° fim para as tarefas de seguran√ßa da informa√ß√£o. </font><font style="vertical-align: inherit;">E se para cada evento analisado pelo SIEM essa tarefa incumbir a ele, ele n√£o os alcan√ßar√° em alguns anos.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclus√£o</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para este grupo, o vencedor √© dif√≠cil de determinar. </font><font style="vertical-align: inherit;">O Sysmon oferece uma vers√£o lac√¥nica, da qual voc√™ pode facilmente extrair uma boa por√ß√£o de informa√ß√µes √∫teis. </font><font style="vertical-align: inherit;">O Windows oferece uma op√ß√£o avan√ßada. </font><font style="vertical-align: inherit;">Resta costur√°-lo, lidar com o conte√∫do e se perguntar se era hora de apresentar o NTA?</font></font><br>
<a name="stage13"></a><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eventos Sysmon exclusivos</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Atribu√≠mos o seguinte aos eventos √∫nicos de Sysmon:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EID 4, 16. Embora possa ser rastreado atrav√©s dos logs do Windows, eles apenas nos informam sobre os eventos no pr√≥prio Sysmon. </font><font style="vertical-align: inherit;">Consequentemente, na sua aus√™ncia, eles n√£o fazem sentido.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O EID 2 - EID 4663 pode ser considerado um an√°logo, mas mesmo levando em considera√ß√£o as listas de direitos de acesso fornecidas, o evento n√£o √© t√£o granular quanto o EID2 e n√£o √© enriquecido para esse estado com outros eventos do Windows.</font></font></li>
<li>EID 7-9, 17 ‚Äî   .      ETW.  ,   ,      .</li>
<li>EID 15 ‚Äî   ,    ETW.       ,      ‚Äî .</li>
<li>EID 18 ‚Äî      (named pipes)       . , -,   .  -,      ,        .       ETW.</li>
</ul><a name="stage14"></a><br>
<h1> </h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Existem tr√™s op√ß√µes para filtrar eventos no lado da fonte. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O primeiro est√° dispon√≠vel apenas para eventos do Windows e apenas para monitorar o acesso e as opera√ß√µes com objetos. Implementado usando SACL. Entre as desvantagens dessa abordagem est√° a complexidade das configura√ß√µes granulares (por exemplo, voc√™ n√£o pode monitorar apenas arquivos existentes ou criados com a extens√£o .exe). Entre as vantagens est√° a capacidade de limitar a lista de usu√°rios para quem as opera√ß√µes com o objeto s√£o registradas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O segundo est√° dispon√≠vel para eventos do Windows e Sysmon: usando o Xpath, levando em conta as restri√ß√µes impostas pela grande Microsoft. Como o m√©todo est√° dispon√≠vel para as duas fontes, a descri√ß√£o est√° al√©m do escopo deste artigo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E o terceiro √© a configura√ß√£o do Sysmon. Existem muitas op√ß√µes:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Emula√ß√£o curinga - cont√©m (qualquer | tudo), exclui (qualquer | tudo), termina com, come√ßa com. </font><font style="vertical-align: inherit;">O uso de contains | exclui all permite que voc√™ emule express√µes como "C: \ Windows \ *. Exe".</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Correspond√™ncia exata - √©, n√£o √©, imagem.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aritm√©tica - menos que, mais que.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Note-se que essa filtragem n√£o est√° dispon√≠vel para todos os campos. </font><font style="vertical-align: inherit;">Por exemplo, voc√™ n√£o pode colocar na lista branca os hashes de software padr√£o, a cria√ß√£o de processos pelos quais n√£o estamos interessados. </font><font style="vertical-align: inherit;">Um exemplo de nossa experi√™ncia - o processo leg√≠timo git.exe criou dezenas de milhares de eventos de inicializa√ß√£o por dia nos hosts de nossos desenvolvedores. </font><font style="vertical-align: inherit;">Talvez, especificamente neste caso, seu comportamento possa ser mais r√≠gido, reduzindo assim esse eixo de eventos. </font><font style="vertical-align: inherit;">Mas excluir arquivos execut√°veis ‚Äã‚Äãpelo nome da imagem n√£o √© uma boa ideia. </font><font style="vertical-align: inherit;">Bem, talvez apenas um antiv√≠rus com autodefesa ativada.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O Sysmon tamb√©m est√° apenas a caminho de uma filtragem sofisticada, combinando condi√ß√µes de diferentes campos. </font><font style="vertical-align: inherit;">Voc√™ pode criar apenas um grupo de regras para cada EID combinado por relacionamentos AND e apenas um com relacionamentos OR. </font><font style="vertical-align: inherit;">Consequentemente, as condi√ß√µes do formul√°rio (A e B) ou (C e D) n√£o podem mais ser escritas. </font><font style="vertical-align: inherit;">Dependendo do fluxo filtrado, esse fato pode n√£o oferecer nenhuma vantagem significativa, mas tamb√©m um resultado tang√≠vel.</font></font><br>
<a name="stage15"></a><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Outros provedores de eventos gratuitos</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nesta se√ß√£o, antes de tudo, gostaria de falar sobre o mecanismo </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ETW</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (Event Trace for Windows). Os logs internos do Windows e do Sysmon registram eventos usando esse mecanismo. De fato, para cada a√ß√£o no sistema, podemos obter um evento. A maneira mais f√°cil de analisar o volume potencial de tais eventos √© ativando a op√ß√£o Visualizador de Eventos - Exibir - Mostrar An√°lise e Depura√ß√£o. Para que os eventos n√£o preencham seu sistema imediatamente, cada log √© ativado separadamente em seu menu de contexto. Voc√™ olha para essa bondade e involuntariamente se faz uma pergunta - por que precisamos do Sysmon com um volume t√£o grande de eventos?</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O fato √© que, primeiramente, esses logs foram originalmente projetados para depura√ß√£o e n√£o para fins de seguran√ßa. Portanto, sua cole√ß√£o centralizada n√£o √© fornecida. Em particular, voc√™ n√£o encontrar√° o FQDN do host no qual eles foram criados em nenhum lugar. A quest√£o, √© claro, pode ser resolvida por utilit√°rios de terceiros, de pequenos a grandes, de scripts a servi√ßos de registro de pleno direito. Mas √© preciso lembrar que esse √© um software adicional em uma grande empresa e, portanto, uma tarefa separada. Deixe-me lembr√°-lo que, na introdu√ß√£o, partimos do princ√≠pio do minimalismo em atividades adicionais para a instala√ß√£o de software.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em segundo lugar, esses logs relatam com tantos detalhes sobre cada espirro que eles tamb√©m precisam selecionar as informa√ß√µes pouco a pouco. Os lan√ßamentos no di√°rio s√£o realmente at√¥micos e exigir√£o correla√ß√£o ou enriquecimento pr√©vio para o analista trabalhar produtivamente. Afinal, um programador que depura sua cria√ß√£o usando esses eventos sabe como tudo deve funcionar. E um guarda de seguran√ßa, especialmente de perfil amplo, pensa em n√≠veis muito mais altos de abstra√ß√£o. Sim, al√©m disso, ele procura atividades ileg√≠timas desconhecidas. Essa declara√ß√£o do problema leva a um m√≥dulo de software adicional que realizar√° o pr√©-processamento. Isso novamente complicar√° nosso conceito.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Embora n√£o tenhamos ido muito longe do log usando o Windows, n√£o esqueceremos de mencionar o WMI. Essa ferramenta basicamente captura altera√ß√µes de estado sem exibir sua fonte. Como exemplo de uma exce√ß√£o, carregar uma DLL: exibe o pr√≥prio m√≥dulo DLL e o processo que est√° sendo carregado. Mas, por quest√µes de seguran√ßa, esse evento tamb√©m requer enriquecimento, pois √© onde suas informa√ß√µes s√£o esgotadas. Em geral, aus√™ncia de peixe e c√¢ncer s√£o peixes. Mas a ferramenta s√≥ pode ser usada como um extra. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Outra op√ß√£o popular, mas n√£o abordada no artigo, √© a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">osquery.</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Os dois principais motivos pelos quais n√£o consideramos essa solu√ß√£o aqui s√£o a baixa frequ√™ncia de atualiza√ß√µes do produto (menos em termos de seguran√ßa e funcionalidade) e o aumento do uso dos recursos do sistema em compara√ß√£o com outras op√ß√µes (um banco de dados completo est√° inclu√≠do). </font><font style="vertical-align: inherit;">Presumivelmente, a solu√ß√£o √© adequada para servidores para os quais foi desenvolvida. </font><font style="vertical-align: inherit;">Mas para esta√ß√µes de trabalho, possivelmente com hardware desatualizado - dificilmente.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Recentemente, surgiram v√°rias outras ferramentas que n√£o s√£o t√£o difundidas quanto as consideradas. </font><font style="vertical-align: inherit;">Isso inclui o Velociraptor e o SilkETW. </font><font style="vertical-align: inherit;">Eles n√£o inventam uma bicicleta e tamb√©m trabalham em cima do padr√£o do Windows - ETW. </font><font style="vertical-align: inherit;">Em vista do volume de material j√° citado, decidiu-se separar essas ferramentas em uma publica√ß√£o separada (conforme tempo e esfor√ßo dispon√≠veis, bem como um senso de demanda).</font></font><br>
<a name="stage16"></a><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclus√£o geral</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No decorrer da compara√ß√£o, foi mostrado que os eventos Sysmon, tendo an√°logos, geralmente superam os eventos do Windows em suas caracter√≠sticas funcionais. </font><font style="vertical-align: inherit;">Alguns eventos de Sysmon simplesmente n√£o t√™m alternativas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No entanto, n√£o esque√ßa que, em primeiro lugar, a solu√ß√£o deve ser escolhida com base nas suas tarefas. </font><font style="vertical-align: inherit;">Se voc√™ est√° apenas criando um sistema de monitoramento e, no primeiro ano, planeja implementar m√©todos para detectar sete a dez incidentes, como o Gartner legou, ent√£o voc√™ deve ter eventos suficientes no Windows. </font><font style="vertical-align: inherit;">E talvez muito mais que um ano.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em segundo lugar, o sistema de log de eventos do Windows tamb√©m √© atualizado constantemente e, durante a reda√ß√£o deste artigo, apareceram os EIDs do Windows, como 4798 e 4799. Tamb√©m √© poss√≠vel que o conjunto de campos seja complementado. Portanto, essa compara√ß√£o, embora seja a mais completa, com base nas informa√ß√µes que possu√≠mos, n√£o √© talhada em pedra. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E em terceiro lugar, o Sysmon ainda √© uma ferramenta externa, o que implica uma s√©rie de riscos. Por exemplo, tivemos casos em que o log de EIDs individuais foi encerrado sem declarar um motivo. Nesse caso, a grava√ß√£o de outros eventos foi como de costume. Colegas mais eminentes afirmam que o problema estava relacionado a vazamentos de mem√≥ria na vers√£o 10.41. Mas a vers√£o 10.42, na qual esse problema √© encerrado total ou parcialmente (no changelog de Sysmon, tudo n√£o √© t√£o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">detalhado</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), n√£o resolveu nossos problemas nessa dire√ß√£o. </font><font style="vertical-align: inherit;">Somente o componente de desinstala√ß√£o e instala√ß√£o ajuda. </font><font style="vertical-align: inherit;">Toda a seguran√ßa e tenha um bom dia! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gra√ßas a Timur</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zinint</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para obter ajuda na prepara√ß√£o da publica√ß√£o. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UPD1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : √â realmente dif√≠cil manter um registro de altera√ß√µes normal ou adicionar novos recursos √† descri√ß√£o principal, como descobrimos (obrigado, tio Dim</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shudv</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), um caminh√£o com nishtyaks j√° virou na nossa rua </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">h√° 9 meses</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ... Resumo: em Sysmon voc√™ pode fazer (A e B) ou (C e D), apenas shh ...</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt489040/index.html">AI do Contact Center: boa conversa com terceiros</a></li>
<li><a href="../pt489042/index.html">Grande reabertura da loja: carregamento de dados no Android usando corotina</a></li>
<li><a href="../pt489044/index.html">F√≠sica do texto. Parte 1. S√≠mbolos</a></li>
<li><a href="../pt489046/index.html">Monster Truck GAZ66 aut√¥nomo 1/16</a></li>
<li><a href="../pt489048/index.html">Log e rastreamento de consultas s√£o pr√°ticas recomendadas. Relat√≥rio Yandex</a></li>
<li><a href="../pt489058/index.html">Conjuntos de redes neurais com PyTorch e Sklearn</a></li>
<li><a href="../pt489060/index.html">An√°lise: qual a diferen√ßa entre investimentos de alto e baixo risco</a></li>
<li><a href="../pt489062/index.html">Incr√≠vel desempenho paralelo de E / S do Apache Parquet em Python</a></li>
<li><a href="../pt489068/index.html">Imortalidade digital - uma abordagem de engenharia</a></li>
<li><a href="../pt489070/index.html">Vai custar 354 pares de meias. Uma sele√ß√£o de presentes para 23 de fevereiro</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>