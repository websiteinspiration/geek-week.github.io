<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤞🏾 👊🏼 👋🏼 在Web项目中使用现代图形格式 👰🏼 🅰️ 🧓🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Eddie Osmani在“ 2018年JavaScript的价格 ”一文中表达了一个宝贵的想法：处理200 KB大小的脚本和处理具有相同大小的图像所需的时间差异很大。事实是，在处理代码时，浏览器需要比准备使用图像做更多的工作。这是文章所说的：
 
 JPEG图像需要解码，光栅化和显示。 JS包是必...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>在Web项目中使用现代图形格式</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/494710/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eddie Osmani在“ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2018年JavaScript</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">价格</font></a><font style="vertical-align: inherit;"> ”一文中表达了一个宝贵的想法：处理200 KB大小的脚本和处理具有相同大小的图像所需的时间差异很大。事实是，在处理代码时，浏览器需要比准备使用图像做更多的工作。这是文章所说的：</font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JPEG图像需要解码，光栅化和显示。 JS包是必要的，如果我们简单地考虑它，则可以加载，解析，编译，执行。实际上，引擎在处理JS代码的过程中必须解决其他问题。总的来说，应该记住，处理JavaScript代码需要花费更多的系统资源，而JavaScript代码的大小（以字节为单位）与其他材料的大小相当。</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
这些词写于2018年，但仍不公平。的确，鉴于当前的情况，今天在这里表达的想法有些不同。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><img src="https://habrastorage.org/webt/8f/9m/t0/8f9mt0mjuf4ivefgknhgl8ykpge.png"></a><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
考虑到现在世界上已爆发大流行，我注意到我的Internet连接已经变得不稳定。幸运的是，由于Internet受到不受疲劳影响的优秀专家的保护，因此大多数Internet仍然可以正常工作。但是在Internet上肯定正在发生某些事情。我使用100 Mbps的连接，但是我感觉自己坐在3G调制解调器上。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这对上述推理进行了一些更改。事实是，我们的设备可以像几周前一样的速度解析和编译JavaScript。但是，数据现在在网络中传输的速度更慢。结果，当加载该资源时，目前在网络上传输多少表示某种资源的数据非常重要。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
而且站点通常具有超过200 KB的图像。通常情况下，页面包含数兆字节的图片。通常，许多开发人员（我也是！）根本不考虑媒体材料的大小。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
但是，这非常好，优化网页上使用的图像并不是那么困难。</font><font style="vertical-align: inherit;">在本文中，我们将讨论如何使用WebP等现代图形格式。</font><font style="vertical-align: inherit;">用这种格式保存的图像通常比每个人都使用的旧的和众所周知的旧格式（如JPG和PNG）小2-3倍。</font><font style="vertical-align: inherit;">使用新格式会严重改变这种状况。</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现代图形格式概述</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
为了改进Web图形的工作，我们可以使用以下三种格式：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JPEG 2000是一种格式，是常规JPG的改进版本。</font><font style="vertical-align: inherit;">该格式于1997年开发，主要用于电影院和医学领域。</font><font style="vertical-align: inherit;">它使您可以压缩比JPEG更强的图像，但失真更少。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JPEG XR是与JPEG 2000相关的格式。它由Microsoft在2009年开发。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WebP是Google在2010年为网络创建的一种格式。</font><font style="vertical-align: inherit;">其开发的主要目标是使用高级方法来优化图像，以减小文件大小。</font><font style="vertical-align: inherit;">WebP支持透明甚至动画。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在这里，我们将主要讨论WebP。</font><font style="vertical-align: inherit;">与JPEG相关的格式，我们将讨论在哪里出现浏览器兼容性问题。</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用其他图形格式可以赢多少钱？</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
几个月前，我在一种材质中使用了以下图片。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ebb/257/a61/ebb257a61229023d8aee7651708966c8.jpg"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
考虑到使用JPG和PNG格式存储原始图像，我</font><i><font color="#999999"><font style="vertical-align: inherit;">在一种材料中使用的图像</font></font></i><font style="vertical-align: inherit;">进行了一些实验。</font><font style="vertical-align: inherit;">我使用</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> imagemin</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">优化了图像选项</font><font style="vertical-align: inherit;">，以便找出WebP可以给我的东西，而不是这些“复古”格式。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
结果令人难以置信。</font></font><br>
<div class="scrollable-table"><table>
<tbody><tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图片功能</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">原版的</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Webp</font></font></th>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.Png文件（来自Photoshop）</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">742 Kb</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">61 Kb！</font><font style="vertical-align: inherit;">（少92％）</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">优化的.png文件（在Imagemin之后）</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">178 Kb</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">58 Kb！</font><font style="vertical-align: inherit;">（少67％）</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.jpg格式的文件（来自Photoshop）</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">242 Kb</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">50 Kb！</font><font style="vertical-align: inherit;">（减少79％）</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.jpg格式的优化文件（在imagemin之后）</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">151 Kb</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">50 Kb！</font><font style="vertical-align: inherit;">（少67％）</font></font></td>
</tr>
</tbody></table></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我对许多图像进行了类似的实验。</font><font style="vertical-align: inherit;">几乎总是发现，WebP文件比其他格式的图形文件的优化版本还要小30-70％。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这可能引发一个问题，即转换为WebP会如何影响SVG图像。</font><font style="vertical-align: inherit;">我没有使用SVG进行此类实验。</font><font style="vertical-align: inherit;">SVG是矢量格式。</font><font style="vertical-align: inherit;">这意味着其中的图像是基于数学指令构建的，而不是基于有关各个像素颜色的信息构建的。</font><font style="vertical-align: inherit;">将SVG图像转换为WebP意味着放弃缩放SVG图像的功能，我认为这是不可接受的。</font><font style="vertical-align: inherit;">另外，我怀疑在大多数情况下，这种转换会导致文件大小增加。</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">浏览器兼容性</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
要了解浏览器如何支持某些图形格式，请访问</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">caniuse.com</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
大多数浏览器都支持WebP格式。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b8d/e47/094/b8de470941379e70ba194f35566deb05.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">浏览器对WebP格式</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
的支持尽管该格式的支持水平很高，但Safari和Internet Explorer不支持它是非常糟糕的。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这是有关JPEG 2000支持的信息。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f50/5b6/1e3/f505b61e34cd89c8e5ae6c336396f5ee.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">浏览器对JPEG 2000格式的支持</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
因此，现在我们</font><i><font color="#999999"><font style="vertical-align: inherit;">支持</font></font></i><font style="vertical-align: inherit;"> Safari，但是Internet Explorer再次无法使用。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
JPEG XR呢？</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c39/c5c/ba1/c39c5cba1bb76927dee034cd17a893e6.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">浏览器对JPEG XR格式的支持</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
在此Internet Explorer成为了区别。</font><font style="vertical-align: inherit;">结果，使用这三种格式，我们会覆盖所有现有的浏览器（KaiOS浏览器不支持任何一种格式，我为他的无视向他表示歉意，但我什至不知道它是什么浏览器）</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在让我们谈谈如何选择为不同浏览器设计的不同图像格式。</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">抢救的像素</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
HTML有两个用于输出图像的元素。第一个可以与像麦当娜这样的国际流行歌星相提并论。是的</font></font><code>img</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。第二个就像是一支新乐队，仅在狭窄的音乐爱好者圈子中广为人知。这是一个要素</font></font><code>picture</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
该元素</font></font><code>picture</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">出现在HTML中的时间比早得多</font></font><code>img</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。这个新元素的主要目的是允许开发人员根据屏幕分辨率或浏览器是否支持某种图形格式来下载各种图形资源。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
使用该元素的HTML代码如下所示</font></font><code>picture</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="html hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">picture</span>&gt;</span>
&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">source</span> <span class="hljs-attr">srcset</span>=<span class="hljs-string">"/images/cereal-box.webp"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"image/webp"</span> /&gt;</span>
&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">source</span> <span class="hljs-attr">srcset</span>=<span class="hljs-string">"/images/cereal-box.jp2"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"image/jp2"</span> /&gt;</span>
&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/images/cereal-box.jxr"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"image/vnd.ms-photo"</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">picture</span>&gt;</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一个元素</font></font><code>picture</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以包括许多子元素</font></font><code>source</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和一个元素</font></font><code>img</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。浏览器顺序地解析这些元件，选择，基于所述属性</font></font><code>type</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（一个或多个</font></font><code>media</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），它们中的一个，可以使用它。找到这样的元素后，浏览器将使用属性找到图像的地址</font></font><code>srcset</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，然后使用元素显示该图像</font></font><code>img</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
该属性</font></font><code>srcset</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">具有比通常的功能大得多的功能</font></font><code>src</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，但幸运的是，我们可以将其视为类似物</font></font><code>src</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。通常，元素</font></font><code>source</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">就像是与不同图像对应的设置。该</font></font><code>img</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图像是最好的，其中包括在浏览网页的环境匹配。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
例如，在Chrome中，在处理完上述标记后，浏览器将或多或少地等效于以下代码：</font></font><br>
<br>
<pre><code class="html hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">picture</span>&gt;</span>
&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/images/cereal-box.webp"</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">picture</span>&gt;</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
使用一组连续的元素</font></font><code>source</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">意味着它们中的至少一个将适合每个浏览器。</font><font style="vertical-align: inherit;">因此，大多数浏览器使用webp图像，Safari会加载jp2图像，即jxr图像。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
记得Internet Explorer不支持该元素</font></font><code>picture</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">此项对于该浏览器来说太新了。</font><font style="vertical-align: inherit;">但是，尽管如此，IE中的上述标记片段仍将按预期工作。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
事实是，当浏览器偶然发现一个未知元素时，会将其视为元素</font></font><code>div</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">结果，在解析我们的代码时，IE会看到许多元素</font></font><code>div</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以及一个标签</font></font><code>&lt;img&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其中包含jxr图片的路径。</font><font style="vertical-align: inherit;">事实证明，这就是Internet Explorer支持的格式。</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">简化的替代方案</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
上面的代码片段非常好，因为它允许您在所有当前浏览器中使用现代图形格式。</font><font style="vertical-align: inherit;">但是，此类代码的使用是基于存在与之链接的图像的假设。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果您自己创建此类图像，则必须在其中投入大量的体力劳动。</font><font style="vertical-align: inherit;">如果自动生成它们，则可能会大大增加项目的构建时间。</font><font style="vertical-align: inherit;">如您所知，在处理大量图像时，图形处理变得非常缓慢。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我博客的访问者很少使用Internet Explorer（在过去的7天中，只有3个使用IE的人试图查看它，占访问量的0.02％）。</font><font style="vertical-align: inherit;">因此，我决定使用上述解决方案的简化版本：</font></font><br>
<br>
<pre><code class="html hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">picture</span>&gt;</span>
&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">source</span> <span class="hljs-attr">srcset</span>=<span class="hljs-string">"/images/cereal-box.webp"</span> /&gt;</span>
&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/images/cereal-box.jpg"</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">picture</span>&gt;</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
对于支持这种格式的浏览器（Chrome，Firefox，Edge）和不支持这种格式的浏览器（IE，Safari），我提供了一个紧凑的webp图像，我提供了过去的遗产-jpeg图像。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在我看来，这是一个逐步改进的例子。</font><font style="vertical-align: inherit;">尽管加载图像需要更长的时间，但该项目仍可在旧版浏览器上运行。</font><font style="vertical-align: inherit;">这是适合我的折衷方案。</font><font style="vertical-align: inherit;">（确实，我希望WebP支持也将很快出现在Apple的浏览器中）。</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查解决方案的运行状况</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
开发人员工具将始终假定图像包含最初写入</font></font><code>src</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tag </font><font style="vertical-align: inherit;">属性的图像</font></font><code>img</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果使用选项卡检查项目</font></font><code>Elements</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则可以看到页面使用的是jpg图像。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在我看来，为了检查所有这些文件的可操作性，最好是右键单击图片并</font></font><code>  …</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在执行命令时</font><font style="vertical-align: inherit;">选择</font><font style="vertical-align: inherit;">Chrome中</font><font style="vertical-align: inherit;">的项目</font><font style="vertical-align: inherit;">，系统应提供以扩展名保存文件</font></font><code>.webp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">但是在Safari中，它将是jpeg文件。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
为了准确地找到页面加载时从服务器接收到的图形文件，可以参考开发人员工具栏</font></font><code>Network</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将图像文件转换为WebP格式</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Google已经创建了一套旨在处理webp文件的工具。</font><font style="vertical-align: inherit;">一种这样的工具称为</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cwebp</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">它允许您将其他格式的图形文件转换为WebP。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果您使用的是MacOS，则可以使用Homebrew安装此工具包：</font></font><br>
<br>
<pre><code class="plaintext hljs">brew install webp
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在其他平台上，我认为有必要</font><font style="vertical-align: inherit;">从存储库</font><font style="vertical-align: inherit;">下载适当的</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">libwebp</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">软件包。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
安装工具后，可以像这样使用它们：</font></font><br>
<br>
<pre><code class="plaintext hljs">cwebp -q 80 cereal.png -o cereal.webp
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
考虑以下命令：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该标志</font></font><code>-q 80</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">允许您设置图像质量。</font><font style="vertical-align: inherit;">它的值从1（最差的质量）到100（最佳）不等。</font><font style="vertical-align: inherit;">您可以尝试不同的值。</font><font style="vertical-align: inherit;">我发现最好问70-80左右的问题。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件名</font></font><code>cereal.jpg</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是需要转换为webp的原始图像。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">构造</font></font><code>-o cereal.webp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将路径设置为输出文件。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
没有人愿意浪费时间手动输入此类命令。</font><font style="vertical-align: inherit;">幸运的是，该任务可以自动化。</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在React应用程序中使用现代图像格式</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
组件是忽略某些元素奇数的好方法</font></font><code>&lt;picture&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">我为此使用React组件。</font><font style="vertical-align: inherit;">我认为这非常方便。</font><font style="vertical-align: inherit;">看起来是这样的：</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> ImgWithFallback = ({<font></font>
&nbsp;&nbsp;src,<font></font>
&nbsp;&nbsp;fallback,<font></font>
&nbsp;&nbsp;type = <span class="hljs-string">'image/webp'</span>,<font></font>
&nbsp;&nbsp;...delegated<font></font>
}) =&gt; {<font></font>
&nbsp;&nbsp;<span class="hljs-keyword">return</span> (
&nbsp;&nbsp;&nbsp;&nbsp;<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">picture</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">source</span> <span class="hljs-attr">srcSet</span>=<span class="hljs-string">{src}</span> <span class="hljs-attr">type</span>=<span class="hljs-string">{type}</span> /&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">{fallback}</span> {<span class="hljs-attr">...delegated</span>} /&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;/<span class="hljs-name">picture</span>&gt;</span></span><font></font>
&nbsp;&nbsp;);<font></font>
};<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
使用该组件</font></font><code>ImgWithFallback</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与使用常规标签非常相似</font></font><code>img</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="javascript hljs">&lt;ImgWithFallback<font></font>
&nbsp;&nbsp;src=<span class="hljs-string">"/images/cereal.webp"</span>
&nbsp;&nbsp;fallback=<span class="hljs-string">"/images/cereal.png"</span>
&nbsp;&nbsp;alt=<span class="hljs-string">"A photo showing the expiration date on a box of Lucky Charms"</span><font></font>
/&gt;<font></font>
</code></pre><br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将现代图形格式与风格化组件结合使用</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果您使用库，</font></font><code>styled-components</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或者</font></font><code>emotion</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可能习惯于特殊的图像设计：</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> FancyImg = styled.img<span class="hljs-string">`
&nbsp;&nbsp;whatever: stuff;
`</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
很好的是，它可以与我们的组件一起使用</font></font><code>ImgWithFallback</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">您可以像其他任何组件一样将其包装在适当的包装中：</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> FancyImg = styled(ImgWithFallback)<span class="hljs-string">`
&nbsp;&nbsp;whatever: stuff;
`</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
该设计可操作性的原因是辅助结构的工作原理</font></font><code>styled</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">它生成一个类并将其嵌入到文档样式表中。</font><font style="vertical-align: inherit;">然后，将生成的类的名称作为属性传递给组件：</font></font><br>
<br>
<pre><code class="css hljs">&lt;<span class="hljs-selector-tag">ImgWithFallback</span> <span class="hljs-selector-tag">className</span>="<span class="hljs-selector-tag">sc-some-generated-thing</span>" /&gt;
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们将所有属性委派给child标记</font></font><code>&lt;img&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，因此，通常会在图像上应用正确的样式。</font><font style="vertical-align: inherit;">一切都按照您的预期工作。</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用gatsby-image软件包</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果您使用的是Gatsby，请注意，</font></font><code>gatsby-image</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正常使用</font><font style="vertical-align: inherit;">该软件包</font><font style="vertical-align: inherit;">时，已经使用了许多图像优化功能。</font><font style="vertical-align: inherit;">这包括将图像转换为webp格式（尽管如此，您需要启用适当的选项）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
该包装</font></font><code>gatsby-image</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并不声称是替代品</font></font><code>img</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">它的使用可能不是那么简单，它的内部机制可能会导致意外，给开发人员带来麻烦。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果您对此软件包感兴趣，请查看其</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文档</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WebP的缺点</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我设法找到的webp的唯一真正缺点是，使用这种格式的文件非常不方便。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
大多数桌面映像程序包尚不支持它。</font><font style="vertical-align: inherit;">例如，我无法在MacOS上的“预览”中打开webp文件。</font><font style="vertical-align: inherit;">这意味着，如果我从网页保存了Webp图像，将无法在计算机上查看它！</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
将webp文件转换为jpeg文件是一个相当简单的过程。</font><font style="vertical-align: inherit;">在Internet上，您可以找到许多执行这种转换的免费服务。</font><font style="vertical-align: inherit;">但是，这又不如使用传统图形格式方便。</font><font style="vertical-align: inherit;">如果您的站点允许用户从中下载图形文件，则可以决定不需要切换到webp。</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">摘要</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我非常喜欢使用webp能够将博客上的图片大小减少约50％的事实。除了在困难时期改善了与他一起工作的用户体验这一事实外，我还希望这将使我节省一些交通费用。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
当然，手动将图像文件转换为Webp格式的想法似乎是不切实际的。我已经在研究如何自动将jpg和png文件转换为这种格式的问题。理想情况下，在现场组装过程中，开发人员完全不会注意到此过程。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Web项目的创建者通常对使用新图像格式的功能并不特别感兴趣。</font><font style="vertical-align: inherit;">但是我认为了解这个问题非常有用。</font><font style="vertical-align: inherit;">毕竟，使用WebP可能是将Web项目的大小减少数百千字节的最简单方法。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">亲爱的读者们！</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您是否使用WebP格式？</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><img src="https://habrastorage.org/webt/iq/fi/b4/iqfib45pgphfrxv--zfemt0qnmw.jpeg"></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN494690/index.html">人工智能与冠状病毒</a></li>
<li><a href="../zh-CN494692/index.html">4D针无痛注射</a></li>
<li><a href="../zh-CN494700/index.html">基于俄罗斯各地人员流动数据集的特定城市中的感染场景</a></li>
<li><a href="../zh-CN494702/index.html">上周第408期（2020年3月23日至29日）来自前端世界的新鲜材料摘要</a></li>
<li><a href="../zh-CN494704/index.html">CMI5，或SCORM之后的生活</a></li>
<li><a href="../zh-CN494712/index.html">在生产中使用React钩子的5个最佳实践</a></li>
<li><a href="../zh-CN494714/index.html">关于可变字体对Web项目性能的积极影响</a></li>
<li><a href="../zh-CN494716/index.html">有关CSS中的auto关键字的所有信息</a></li>
<li><a href="../zh-CN494718/index.html">来自OpenStreetMap 504世界的新闻（10.03.2020-16.03.2020）</a></li>
<li><a href="../zh-CN494720/index.html">我的熊猫备忘单</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>