<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🏕️ 💅 🔻 Unityでローグライクをゼロから作成する 💜 ☔️ 😇</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Unityでローグライクを作成するためのチュートリアルはあまりないので、私はそれを書くことにしました。自慢するのではなく、私がすでにかなり前にいた段階にいる人々と知識を共有することです。
 
 注：これがUnityでローグライクを作成する唯一の方法であるとは言っていません。彼はの1人です。おそらく最...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Unityでローグライクをゼロから作成する</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/490828/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ad4/093/6ab/ad40936ab0dff25fd3214571faf9aa61.png" alt="画像"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unityでローグライクを作成するためのチュートリアルはあまりないので、私はそれを書くことにしました。自慢するのではなく、私がすでにかなり前にいた段階にいる人々と知識を共有することです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注：これが</font><font style="vertical-align: inherit;">Unityでローグライクを作成する</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">唯一の</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法であると</font><font style="vertical-align: inherit;">は言っていません</font><font style="vertical-align: inherit;">。彼はの</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1人です</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。おそらく最良で最も効果的ではないでしょう。私は試行錯誤を通して学びました。チュートリアルを作成する過程で、いくつかのことを学びます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
あなた</font><strong><font style="vertical-align: inherit;">は少なくともUnityの基本</font></strong><font style="vertical-align: inherit;">を</font><strong><font style="vertical-align: inherit;">知っている</font></strong><font style="vertical-align: inherit;">としましょう</font></font><strong><font style="vertical-align: inherit;"></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">たとえば、プレハブやスクリプトの作成方法など。</font><font style="vertical-align: inherit;">スプライトシートの作成方法を教えてくれるとは思わないでください。これについては多くのすばらしいチュートリアルがあります。</font><font style="vertical-align: inherit;">エンジンの研究ではなく、一緒に作成するゲームの実装方法に焦点を当てます。</font><font style="vertical-align: inherit;">問題が発生した場合は、Discordの素晴らしいコミュニティのいずれかに向かい、助けを求めてください：</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unity Developer Community </font></font></a><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Roguelikes</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
それでは、始めましょう！</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ステージ0-計画</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
はい、そうです。最初に作成するのは計画です。あなたがゲームを計画することは私にとっても良いでしょう-私がチュートリアルを計画することはしばらくの間私たちがトピックから気を取られないようにするためです。ローグライクダンジョンと同じように、ゲームの機能も簡単に混乱します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ローグライクを書きます。ここでは、主にCogmind開発者のJosh Geの賢明なアドバイスに従い</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。リンクをたどって、投稿を読むかビデオを見てから、戻ってきてください。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このチュートリアルの目的は何ですか？しっかりとしたシンプルで基本的なローグライクを取得し、それを使って実験できます。ダンジョン生成、マップ上を移動するプレイヤー、視界の霧、敵、オブジェクトが必要です。最も必要なものだけ。したがって、プレイヤーは階段を数階下る必要があります。たとえば、5ずつレベルを上げ、上達させ、最後にボスとの戦いで彼を倒すとしましょう。または死ぬ。それは、実際には、すべてです。</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Josh Geのアドバイスに従い、ゲームの機能を構築して、目標に導くようにします。</font><font style="vertical-align: inherit;">したがって、さらに拡張できるローグライクなフレームワークを取得し、独自のチップを追加して、独自性を作成します。</font><font style="vertical-align: inherit;">または、バスケットにすべてを投入し、得られた経験を活用して、最初からやり直します。</font><font style="vertical-align: inherit;">とにかく素晴らしいでしょう。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
グラフィックリソースは提供しません。</font><font style="vertical-align: inherit;">自分で描くか、無料のタイルセットを使用してください。タイルセットは、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ここ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ここ、</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">またはGoogleで検索して</font><font style="vertical-align: inherit;">ダウンロードでき</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">ゲームのグラフィックの作者について言及することを忘れないでください。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、ローグライクに含まれるすべての関数を、実装順にリストします。</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ダンジョンマップの生成</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プレイヤーキャラクターと彼の動き</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可視領域</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">敵</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">道を探す</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">戦い、健康、そして死</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プレイヤーレベルアップ</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アイテム（武器とポーション）</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コンソールチート（テスト用）</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ダンジョンの床</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">保存と読み込み</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最終ボス</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらすべてを実装すると、ローグライクのようなものが強くなり、ゲーム開発スキルが大幅に向上します。</font><font style="vertical-align: inherit;">実際、それは</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私の</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スキルを向上させるための</font><em><font style="vertical-align: inherit;">私の</font></em><font style="vertical-align: inherit;">方法でした。コードの作成と関数の実装です。</font><font style="vertical-align: inherit;">だから、きっとこれも扱えると思います。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ステージ1-MapManagerクラス</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これが最初に作成するスクリプトで、ゲームのバックボーンになります。</font><font style="vertical-align: inherit;">シンプルですが、ゲームの重要な情報の大部分が含まれています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、MapManagerという.csスクリプトを作成して開きます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
"：MonoBehaviour"は継承されず、どのGameObjectにもアタッチされないため、削除してください。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Start（）およびUpdate（）関数を削除します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MapManagerクラスの最後に、Tileという新しいパブリッククラスを作成します。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/431/54e/4c2/43154e4c2708a580bc3838b1fbee573b.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tileクラスには、単一のタイルのすべての情報が含まれます。</font><font style="vertical-align: inherit;">これまでのところ、xとyの位置だけでなく、マップのこの位置にあるゲームオブジェクトも必要ありません。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/405/21e/cd9/40521ecd9e1292e813391181e523b6dc.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、基本的なタイル情報があります。</font><font style="vertical-align: inherit;">このタイルからマップを作成しましょう。</font><font style="vertical-align: inherit;">それは簡単で、必要なのはTileオブジェクトの2次元配列だけです。</font><font style="vertical-align: inherit;">複雑に聞こえますが、特別なことは何もありません。</font><font style="vertical-align: inherit;">Tile [、]変数をMapManagerクラスに追加するだけです。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f44/2e8/806/f442e88061e77cbbb4c1aa904c73bdfd.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
出来上がり！</font><font style="vertical-align: inherit;">地図があります！</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
はい、空です。</font><font style="vertical-align: inherit;">しかし、これは地図です。</font><font style="vertical-align: inherit;">マップ上で何かが移動したり状態を変更するたびに、このマップの情報が更新されます。</font><font style="vertical-align: inherit;">つまり、たとえば、プレーヤーが新しいタイルに切り替えようとした場合、クラスはマップ上の宛先タイルアドレス、敵の存在、およびその開通性をチェックします。</font><font style="vertical-align: inherit;">これにより、毎ターン数千の衝突をチェックする必要がなくなり、ゲームオブジェクトごとにコライダーが不要になるため、ゲームでの作業が容易になり簡素化されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
結果のコードは次のようになります。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">using</span> System.Collections;
<span class="hljs-keyword">using</span> System.Collections.Generic;
<span class="hljs-keyword">using</span> UnityEngine;<font></font>
<font></font>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">MapManager</span> <font></font>
{<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Tile[,] map; <span class="hljs-comment">// the 2-dimensional map with the information for all the tiles</span><font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Tile</span> { <span class="hljs-comment">//Holds all the information for each tile on the map</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> xPosition; <span class="hljs-comment">// the position on the x axis</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> yPosition; <span class="hljs-comment">// the position on the y axis</span>
    <span class="hljs-keyword">public</span> GameObject baseObject; <span class="hljs-comment">// the map game object attached to that position: a floor, a wall, etc.</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
第1段階が完了したら、カードへの入力に移りましょう。</font><font style="vertical-align: inherit;">次に、ダンジョンジェネレータの作成を開始します。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ステージ2-データ構造に関するいくつかの単語</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、始める前に、最初の部分の公開後に受け取ったフィードバックのおかげで生じたヒントを共有させてください。データ構造を作成するときは、最初からゲームの状態を維持する方法を考える必要があります。そうでなければ、後でそれははるかに無秩序になります。 Star Shaped Bagel（このゲームは</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ここ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で無料</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">で</font></a><font style="vertical-align: inherit;">プレイできます）の開発者であるDiscord st33dのユーザーは</font><font style="vertical-align: inherit;">、最初はゲームを作成し、状態をまったく保存しないと考えていたと述べています。徐々にゲームは大きくなり始め、彼女のファンは保存されたマップのサポートを求めました。しかし、データ構造を作成するために選択された方法のために、データを保存するのは非常に困難でしたので、彼はこれを実行できませんでした。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/82c/b02/858/82cb02858af686ef409ad8a6c0496135.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちは間違いから本当に学びます。チュートリアルの最後に保存/ロードの部分を置いたという事実にもかかわらず、私はそれらを最初からよく考え、まだ説明していません。この部分では、それらについて少しお話しますが、経験の浅い開発者に過負荷をかけないようにしています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このようなものを、マップが格納されているTileクラスの変数の配列として保存します。 Tileクラス内にあるGameObjectクラスの変数を除いて、このすべてのデータを保存します。どうして？ UnityでGameObjectsを保存されたデータにシリアル化できないからです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、実際には、GameObjects内に格納されているデータを保存する必要はありません。すべてのデータはTileなどのクラスに保存され、後でPlayer、Enemyなどにも保存されます。次に、画面にスプライトを描画するだけでなく、可視性や動きなどの計算を簡素化するGameObjectsを用意します。したがって、クラス内にはGameObject変数がありますが、これらの変数の値は保存およびロードされません。ロード時に、保存されたデータ（位置、スプライトなど）からGameObjectを強制的に再生成します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
では、今何をする必要がありますか？さて、既存のTileクラスに2行、スクリプトの先頭に1行追加するだけです。まず、「システムを使用して」を追加します。をスクリプトタイトルに追加し、[Serializable]をクラス全体の前に配置し、[NonSerialized]をGameObject変数の直前に配置します。このような：</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bfd/931/aa3/bfd931aa3a4a1b2b7792650cc25cba07.png"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a2e/178/9d3/a2e1789d3663b1530d64d3d900c7f047.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これについては、チュートリアルの保存/ロードの部分に進んだときに詳しく説明します。</font><font style="vertical-align: inherit;">とりあえず、すべてを残して次に進みましょう。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ステージ3-データ構造についてもう少し</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここで共有したいデータ構造に関する別のレビューを得ました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実際、ゲームにデータを実装するには多くの方法があります。私が最初に使用するもので、このチュートリアルで実装されます。すべてのタイルデータはTileクラスにあり、それらはすべて配列に格納されます。このアプローチには多くの利点があります。読みやすく、必要なものがすべて1か所にあり、データの操作と保存ファイルへのエクスポートが簡単です。しかし、メモリの観点からは、それほど効果的ではありません。ゲームで使用されない変数には、多くのメモリを割り当てる必要があります。たとえば、後でEnemy GameObject変数をTileクラスに配置して、マップからこのタイルに立っている敵のGameObjectを直接ポイントして、戦闘に関連するすべての計算を簡略化できるようにします。しかし、これはゲーム内の各タイルがメモリ内のGameObject変数にスペースを割り当てていることを意味しますこのタイルに敵がいなくても。 2500タイルのマップに10人の敵がいる場合、2490は空ですが、割り当てられたGameObject変数があります-どれだけのメモリが浪費されているかを確認できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
別の方法は、構造を使用してタイルの基本データ（たとえば、位置とタイプ）を格納することです。その他のすべてのデータは、必要な場合にのみ生成されるhashmap-sに格納されます。</font><font style="vertical-align: inherit;">これは多くのメモリを節約しますが、回収はやや複雑な実装になります。</font><font style="vertical-align: inherit;">実際には、このチュートリアルよりも少し進んでいますが、必要に応じて、今後、より詳細な投稿を書くことができます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに、このトピックの説明を読みたい場合は</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、Reddit</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で行うことができます</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ステージ4-ダンジョン生成アルゴリズム</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
はい、これは私が話す別のセクションであり、私たちは何もプログラムし始めません。しかし、これは重要です。アルゴリズムを注意深く計画することで、将来、多くの作業時間を節約できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ダンジョンジェネレーターを作成するにはいくつかの方法があります。私たちが一緒に実装するものは、最良ではなく、最も効果的でもありません...それは、簡単で最初の方法にすぎません。非常にシンプルですが、結果は非常に良好です。主な問題は多くの行き止まりの廊下です。その後、必要に応じて、より優れたアルゴリズムに関する別のチュートリアルを公開できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一般に、使用するアルゴリズムは次のように機能します。たとえば、マップ全体がゼロの値（石で構成されるレベル）で満たされているとします。</font><font style="vertical-align: inherit;">最初は中央の部屋を切り取りました。</font><font style="vertical-align: inherit;">この部屋から廊下を一方向に突破し、他の廊下と部屋を追加します。最初に指定した廊下/部屋の最大数に達するまで、既存の部屋または廊下から常にランダムに開始します。</font><font style="vertical-align: inherit;">または、アルゴリズムが新しい部屋/廊下を追加するための新しい場所を見つけるまで、どちらか早い方になります。</font><font style="vertical-align: inherit;">そしてダンジョンを取得します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それでは、これをよりアルゴリズムに似た方法で段階的に説明しましょう。</font><font style="vertical-align: inherit;">便宜上、マップの各詳細（廊下または部屋）を要素と呼ぶので、毎回「部屋/廊下」と言う必要はありません。</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">地図の中央にある部屋を切り取ります</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">壁の1つをランダムに選択します</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">この壁の廊下を突破</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">既存の要素の1つをランダムに選択します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">この要素の壁の1つをランダムに選択します</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最後に選択したアイテムが部屋の場合、廊下を生成します。</font><font style="vertical-align: inherit;">廊下の場合、次の要素が部屋か別の廊下かをランダムに選択します</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">選択した方向に、必要なアイテムを作成するのに十分なスペースがあるかどうかを確認します</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">場所がある場合は要素を作成し、ない場合は手順4に戻ります。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">手順4から繰り返す</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それで全部です。</font><font style="vertical-align: inherit;">部屋と廊下だけがあり、ドアや特別な要素がない、ダンジョンの簡単なマップを取得しますが、これが私たちの始まりです。</font><font style="vertical-align: inherit;">後で、チェスト、敵、トラップで埋めます。</font><font style="vertical-align: inherit;">また、カスタマイズすることもできます。必要な興味深い要素を追加する方法を学習します。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ステージ5-部屋を切り取る</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最後にコーディングに進んでください！</font><font style="vertical-align: inherit;">最初の部屋を切りましょう。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まず、新しいスクリプトを作成し、DungeonGeneratorと呼びます。</font><font style="vertical-align: inherit;">これはMonobehaviourから継承されるため、後でGameObjectにアタッチする必要があります。</font><font style="vertical-align: inherit;">次に、クラスでいくつかのパブリック変数を宣言して、インスペクターからダンジョンのパラメーターを設定できるようにする必要があります。</font><font style="vertical-align: inherit;">これらの変数は、マップの幅と高さ、部屋の最小と最大の高さと幅、廊下の最大長、およびマップ上にある必要のある要素の数になります。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/120/331/04d/12033104d1f3fcf270fdc5fd64ffb6bb.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、ダンジョンジェネレータを初期化する必要があります。これは、世代によって入力される変数を初期化するために行われます。これまでのところ、それはマップのみになります。また、Unityが新しいスクリプト用に生成するStart（）およびUpdate（）関数も削除します。これらの関数は必要ありません。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f92/a8f/e5d/f92a8fe5dc2ea241284fe95b8758c289.png"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ad7/841/44b/ad784144b6aeea6aee3967caedaa37eb.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここでは、前の手順で作成したMapManagerクラスのマップ変数を初期化し、上記の変数で定義されたマップの幅と高さを配列の2次元のパラメーターとして渡しました。これにより、水平xサイズ（幅）と垂直yサイズ（高さ）のマップが作成され、MapManager.map [x、y]と入力することで、マップ内の任意のセルにアクセスできます。これは、オブジェクトの位置を操作するときに非常に役立ちます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、最初の部屋をレンダリングする関数を作成します。これをFirstRoom（）と呼びます。 InitializeDungeon（）をパブリック関数にしました。これは、別のスクリプト（すぐに作成するゲームマネージャ、ゲームの起動プロセス全体の管理を一元化する）によって起動されるためです。 FirstRoom（）にアクセスするのに外部スクリプトは必要ないため、公開しません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、続行するために、MapManagerスクリプトに3つの新しいクラスを作成して、部屋を作成できるようにします。これらは、Feature、Wall、およびPositionクラスです。 Positionクラスには、すべてがどこにあるかを追跡できるように、x位置とy位置が含まれます。壁には、位置のリスト、部屋の中心（北、南、東、または西）を基準にして「見える」方向、長さ、およびそこから作成された新しい要素の存在があります。要素には、要素で構成されるすべての位置、要素のタイプ（部屋または廊下）、Wall変数の配列、およびその幅と高さのリストが含まれます。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3b7/abe/924/3b7abe9241bb1442f3224048384263ff.png"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/938/8bc/8d7/9388bc8d7dd523b45013fa80d918d8a2.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それでは、FirstRoom（）関数を見てみましょう。</font><font style="vertical-align: inherit;">DungeonGeneratorスクリプトに戻り、InitializeDungeonのすぐ下に関数を作成します。</font><font style="vertical-align: inherit;">彼女はパラメータを受け取る必要がないので、単純なままにします（）。</font><font style="vertical-align: inherit;">次に、関数内で、最初にRoom変数とそのPosition変数のリストを作成して初期化する必要があります。</font><font style="vertical-align: inherit;">これは次のように行います。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/164/b81/b5d/164b81b5dde06f8e996e22a75bf0b947.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、部屋のサイズを設定します。</font><font style="vertical-align: inherit;">スクリプトの最初に宣言された高さと幅の最小値と最大値の間のランダムな値を受け取ります。</font><font style="vertical-align: inherit;">これらは空ですが、インスペクターで値を設定しなかったため、心配しないで、すぐに設定します。</font><font style="vertical-align: inherit;">次のようにランダムな値を設定します：</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d77/bbd/389/d77bbd3896dc4c60d93a9e6b1c006729.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、部屋の開始点が配置される場所、つまり、部屋0.0の点がマップグリッド内のどこに配置されるかを宣言する必要があります。マップの中央（幅と高さの半分）から開始するようにしますが、</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正確</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">には中央</font><em><font style="vertical-align: inherit;">に配置</font></em><font style="vertical-align: inherit;">し</font><font style="vertical-align: inherit;">ない場合</font><font style="vertical-align: inherit;">があります。小さなランダマイザーを追加して、少し左と下に移動することをお勧めします。したがって、xStartingPointをマップの幅の半分として設定し、yStartingPointをマップの高さの半分として設定してから、指定されたroomWidthとroomHeightを取得して、0からこの幅/高さまでのランダムな値を取得し、初期のxとyから減算します。このような：</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/50f/3f2/f0e/50f3f2f0ecb267d5283dcd4684019708.png"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8eb/0e7/f2b/8eb0e7f2bff7d3d08b1b0691885e89cd.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、同じ関数で壁を追加します。新しく作成された部屋変数にある壁の配列を初期化してから、この配列内の各壁変数を初期化する必要があります。次に、各位置リストを初期化し、壁の長さを0に設定して、各壁が「見える」方向を入力します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
配列が初期化されたら、for（）ループで配列の各要素をループし、各壁の変数を初期化してから、各壁の方向を指定するスイッチを使用します。それは任意に選ばれます、彼らが何を意味するかを覚えておけばよいだけです。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d3a/f8f/9da/d3af8f9da1ee8f317452d52f9f905536.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、壁を配置した直後に2つのネストされたforループを実行します。</font><font style="vertical-align: inherit;">外側のループでは、部屋のすべてのy値と、ネストされたループではすべてのx値を処理します。</font><font style="vertical-align: inherit;">このように、行yの各セルxをチェックして、実装できるようにします。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3ee/cb3/695/3eecb3695c59d199fb32064501ce1009.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、最初に行うことは、部屋の位置からマップ縮尺上のセル位置の実際の値を見つけることです。</font><font style="vertical-align: inherit;">これは非常に単純です。開始点xとyがあります。</font><font style="vertical-align: inherit;">それらは部屋のグリッドの0,0の位置になります。</font><font style="vertical-align: inherit;">次に、ローカルx、yからx、yの実際の値を取得する必要がある場合は、ローカルxとyを初期位置xとyに追加します。</font><font style="vertical-align: inherit;">次に、これらの実際のx、y値を（以前に作成したクラスからの）位置変数に保存し、部屋の位置のリスト&lt;&gt;に追加します。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0b2/cc4/4a0/0b2cc44a0ae9953a3d49ac0b3c01a6c9.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次のステップは、この情報をマップに追加することです。</font><font style="vertical-align: inherit;">値を変更する前に、Tile変数を必ず初期化してください。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1aa/fe5/a43/1aafe5a43a8c30f2c343472ad7f157ca.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、Tileクラスに変更を加えます。</font><font style="vertical-align: inherit;">MapManagerスクリプトに移動して、Tileクラスの定義に「public string type;」という1行を追加します。</font><font style="vertical-align: inherit;">これにより、x、yのタイルが壁、床、またはその他のものであることを宣言することにより、タイルクラスを追加できます。</font><font style="vertical-align: inherit;">次に、作業を行ったサイクルに戻り、大きなif-else構成を追加します。これにより、各壁、その長さ、およびこの壁内のすべての位置を特定できるだけでなく、特定のタイルが何であるかをグローバルマップで指定できます-壁または性別。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7c3/276/28c/7c327628cea73dafe9319a01ac10b72b.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、私たちはすでに何かをしました。変数y（外側のループの変数の制御）が0の場合、タイルは部屋のセルの最も下の行に属しています。つまり、タイルは南壁です。 x（内部ループ変数の制御）が0の場合、タイルはセルの左端の列に属しています。つまり、タイルは西壁です。そしてそれが一番上の線にあるなら、それは北の壁に属し、そして一番右にある-東の壁に属します。これらの値は1から計算され、サイクルのx変数とy変数は0から開始されるため、変数roomWidthとroomHeightから1を減算します。したがって、この違いを考慮する必要があります。そして、条件を満たさないすべてのセルは壁ではなく、つまり床です。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/258/4a6/2c9/2584a62c91fc46205f903cb4283bd1ce.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すばらしい、最初の部屋はほぼ完了です。</font><font style="vertical-align: inherit;">ほとんど準備ができています。作成した変数Featureに最後の値を入れるだけです。</font><font style="vertical-align: inherit;">ループを終了し、次のように関数を終了します。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2bd/aaf/a47/2bdaafa47adb2694f360eea850341920.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
いいね！</font><font style="vertical-align: inherit;">部屋があります！</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、すべてが機能することをどのように理解できますか？</font><font style="vertical-align: inherit;">テストする必要があります。</font><font style="vertical-align: inherit;">しかし、どのようにテストするのですか？</font><font style="vertical-align: inherit;">このために時間を費やしてアセットを追加することはできますが、これは時間の浪費であり、アルゴリズムの完了を妨げてしまいます。</font><font style="vertical-align: inherit;">うーん、これはASCIIを使用して実行できます！</font><font style="vertical-align: inherit;">はい、素晴らしいアイデアです！</font><font style="vertical-align: inherit;">ASCIIは、テストできるようにマップを描画する簡単で低コストの方法です。</font><font style="vertical-align: inherit;">また、必要に応じて、後で検討するスプライトと視覚効果のある部分をスキップして、ゲーム全体をASCIIで作成することもできます。</font><font style="vertical-align: inherit;">これがどのように行われるか見てみましょう。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ステージ6-最初の部屋を描く</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ASCIIカードを実装するときに最初に考えることは、どのフォントを選択するかです。 ASCIIのフォントを選択するときに考慮すべき主な要素は、フォントがプロポーショナル（可変幅）であるか、等幅（固定幅）であるかです。カードが必要に応じて見えるように、モノスペースフォントが必要です（下の例を参照）。デフォルトでは、新しいUnityプロジェクトはArialフォントを使用し、等幅フォントではないため、別のフォントを見つける必要があります。 Windows 10には通常、等幅フォントCourier New、Consolas、Lucida Consoleがあります。これら3つのうち1つを選択するか、必要な場所にダウンロードして、プロジェクトのAssetsフォルダー内のFontsフォルダーに配置します。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ff4/beb/f23/ff4bebf23a4523f4dd348524ac6b0a9f.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ASCII出力用にシーンを準備しましょう。まず、シーンのメインカメラの背景色を黒にします。次に、Canvasオブジェクトをシーンに追加し、Textオブジェクトをそれに追加します。テキスト長方形の変換を中央の中央と位置0,0,0に設定します。選択したフォントと白色、水平および垂直オーバーフロー（水平/垂直オーバーフロー）を使用するようにTextオブジェクトを設定し、[オーバーフロー]を選択して、垂直および水平方向の配置を中央揃えにします。次に、Textオブジェクトの名前を「ASCIITest」または同様の名前に変更します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コードに戻りましょう。 DungeonGeneratorスクリプトで、DrawMapという新しい関数を作成します。どのカードを生成するかを伝えるパラメーター（ASCIIまたはスプライト）を取得してもらいたいので、ブールパラメーターを作成してisASCIIと呼びます。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/387/67a/957/38767a9575270115821d6be36ce97293.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、レンダリングされたマップがASCIIかどうかを確認します。</font><font style="vertical-align: inherit;">はいの場合（ここではこのケースのみを考慮します）、シーン内のテキストオブジェクトを検索し、それに与えられた名前をパラメーターとして渡して、そのテキストコンポーネントを取得します。</font><font style="vertical-align: inherit;">ただし、最初に、UIを操作することをUnityに通知する必要があります。</font><font style="vertical-align: inherit;">UnityEngine.UIを使用する行をスクリプトヘッダーに追加します。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/17c/e18/c24/17ce18c24ec7c286b4390159dc98dab1.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
いいよ </font><font style="vertical-align: inherit;">これで、オブジェクトのテキストコンポーネントを取得できます。</font><font style="vertical-align: inherit;">マップは巨大な線になり、テキストとして画面に反映されます。</font><font style="vertical-align: inherit;">そのため、セットアップが非常に簡単です。</font><font style="vertical-align: inherit;">それでは、文字列を作成して、値 ""で初期化しましょう。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6d2/7f2/92c/6d27f292c1f519a7b351d7b8d80a8f84.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
いいね。したがって、DrawMapが呼び出されるたびに、カードがASCIIかどうかを通知する必要があります。これがそうである場合（そして、常にこのようにする場合は、後で別の方法で作業します）、関数は「ASCIITest」というゲームオブジェクトを検索してシーン階層を検索します。含まれている場合は、Textコンポーネントを受け取り、それを画面変数に保存します。この変数にマップを簡単に書き込むことができます。次に、値が最初は空の文字列を作成します。この行を記号でマークされたマップで埋めます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
通常は、0から始まり、その長さの終わりまでループしてマップを一周します。</font><font style="vertical-align: inherit;">しかし、行を埋めるために、テキストの最初の行、つまり一番上の行から始めます。</font><font style="vertical-align: inherit;">したがって、y軸上では、ループの反対方向に、配列の最後から最初に向かって移動する必要があります。</font><font style="vertical-align: inherit;">しかし、配列のx軸はテキストと同じように左から右に移動するため、これが適しています。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/536/019/f47/536019f479ea1af260d551f342ed46aa.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このサイクルでは、マップの各セルをチェックして、その中に何があるかを調べます。</font><font style="vertical-align: inherit;">これまでのところ、セルを新しいTile（）として初期化しているだけです。これを部屋用に切り取ったので、他のすべてのユーザーがアクセスしようとするとエラーが返されます。</font><font style="vertical-align: inherit;">したがって、最初</font><font style="vertical-align: inherit;">にこのセルに何か</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">がある</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">か</font><font style="vertical-align: inherit;">どうか</font><font style="vertical-align: inherit;">を確認</font><font style="vertical-align: inherit;">する</font><font style="vertical-align: inherit;">必要があり</font><font style="vertical-align: inherit;">ます。これを行うには、セルのnullを確認します。</font><font style="vertical-align: inherit;">nullでない場合は作業を続けますが、nullの場合は内部に何もないため、マップに空のスペースを追加できます。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3f3/f56/5d9/3f3f565d9e9f7886c3baa600cd1ab99f.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、空でない各セルについて、そのタイプをチェックしてから、対応するシンボルを追加します。</font><font style="vertical-align: inherit;">壁は記号「＃」で示され、床は「。」で示されます。</font><font style="vertical-align: inherit;">そして、この2つのタイプしかありません。</font><font style="vertical-align: inherit;">その後、プレイヤー、モンスター、トラップを追加すると、すべてが少し複雑になります。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f9f/a24/ef0/f9fa24ef002860f5331479f9ac07a6e8.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに、配列の行の終わりに達したときに改行を実行する必要があるため、同じx位置のセルは互いに直下になります。</font><font style="vertical-align: inherit;">ループの各反復で、セルが行の最後かどうかを確認し、特殊文字「\ n」を使用して改行を追加します。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c14/7b8/1eb/c147b81eb1f4efa01bafdfa8a4aa092d.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それで全部です。</font><font style="vertical-align: inherit;">次に、ループを終了して、完了後にこの行をシーン内のテキストオブジェクトに追加できるようにします。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/20f/8bb/f4d/20f8bbf4d1c8e5b59afc3163a97d57bb.png"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fcb/83f/a7f/fcb83fa7f923ec53e33696bb8962a1d9.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
おめでとう！ルームを作成して画面に表示するスクリプトが完成しました。これらの行を実行する必要があるだけです。 DungeonGeneratorスクリプトではStart（）を使用しません。これは、マップの生成を含む、ゲームの開始時に実行されるすべてのことだけでなく、プレーヤーの設定や敵なども制御するための個別のスクリプトが必要だからです。したがって、この他のスクリプトにはStart（）関数が含まれ、必要に応じてスクリプトの関数を呼び出します。 DungeonGeneratorスクリプトには、パブリックであるInitialize関数があり、FirstRoomとDrawMapはパブリックではありません。 Initializeは、ダンジョン生成プロセスを構成するために変数を初期化するだけなので、生成プロセスを呼び出す別の関数が必要です。これは、他のスクリプトから呼び出すことができるようにパブリックでなければなりません。今のところ、彼女はFirstRoom（）関数を呼び出し、次にDrawMap（）関数を呼び出して、True値を渡して、ASCIIマップを描画します。ああ、そうでない方がいいでしょう。インスペクタに含めることができるパブリック変数isASCIIを作成し、この変数をパラメータとして関数に渡します。いいね。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c58/288/502/c58288502f107440def4f803d602662b.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それでは、GameManagerスクリプトを作成しましょう。</font><font style="vertical-align: inherit;">これは、マップの作成や移動のコースなど、ゲームのすべての高レベルの要素を制御するまさにスクリプトになります。</font><font style="vertical-align: inherit;">その中のUpdate（）関数を削除し、dungeonGeneratorと呼ばれるDungeonGeneratorタイプの変数を追加して、Start（）関数でこの変数のインスタンスを作成します。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e5b/8da/424/e5b8da4243c91f887c08213b9ec14953.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その後、我々は単に、dungeonGeneratorからInitializeDungeon（）とGenerateDungeon（）関数を呼び出して</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">その順序で</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">これは重要です-最初に変数を初期化する必要があります。その後、変数に基づいて構築を開始します。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/158/7e6/781/1587e6781595d0ee6661aea7898aa6e4.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この部分でコードが完成します。</font><font style="vertical-align: inherit;">階層パネルで空のゲームオブジェクトを作成し、名前をGameManagerに変更して、GameManagerおよびDungeonGeneratorスクリプトをそれにアタッチする必要があります。</font><font style="vertical-align: inherit;">そして、インスペクターでダンジョンジェネレーターの値を設定します。</font><font style="vertical-align: inherit;">あなたはジェネレーターのために異なるスキームを試すことができます、そして私はこれに落ち着きました：</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a11/41f/495/a1141f4953a6fdeac32cc978ac4a0b05.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
今すぐプレイをクリックして、魔法を見てください！</font><font style="vertical-align: inherit;">ゲーム画面に同様のものが表示されるはずです。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ad4/093/6ab/ad40936ab0dff25fd3214571faf9aa61.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
おめでとうございます、これで部屋ができました！</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プレイヤーのキャラクターをそこに置いて動かしてほしかったのですが、ポストはもうかなり長くなりました。</font><font style="vertical-align: inherit;">したがって、次のパートでは、ダンジョンアルゴリズムの残りの部分の実装に直接進むか、プレイヤーをその中に配置して、移動方法を教えることができます。</font><font style="vertical-align: inherit;">元の記事へのコメントで、気に入ったものに投票してください。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MapManager.cs：</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">using</span> System.Collections;
<span class="hljs-keyword">using</span> System; <span class="hljs-comment">// So the script can use the serialization commands</span>
<span class="hljs-keyword">using</span> System.Collections.Generic;
<span class="hljs-keyword">using</span> UnityEngine;<font></font>
<font></font>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">MapManager</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Tile[,] map; <span class="hljs-comment">// the 2-dimensional map with the information for all the tiles</span><font></font>
}<font></font>
<font></font>
[<span class="hljs-meta">Serializable</span>] <span class="hljs-comment">// Makes the class serializable so it can be saved out to a file</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Tile</span> { <span class="hljs-comment">// Holds all the information for each tile on the map</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> xPosition; <span class="hljs-comment">// the position on the x axis</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> yPosition; <span class="hljs-comment">// the position on the y axis</span>
    [<span class="hljs-meta">NonSerialized</span>]
    <span class="hljs-keyword">public</span> GameObject baseObject; <span class="hljs-comment">// the map game object attached to that position: a floor, a wall, etc.</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> type; <span class="hljs-comment">// The type of the tile, if it is wall, floor, etc</span><font></font>
}<font></font>
<font></font>
[<span class="hljs-meta">Serializable</span>]
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Position</span> { <span class="hljs-comment">//A class that saves the position of any cell</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> x;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> y;<font></font>
}<font></font>
<font></font>
[<span class="hljs-meta">Serializable</span>]
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Wall</span> { <span class="hljs-comment">// A class for saving the wall information, for the dungeon generation algorithm</span>
    <span class="hljs-keyword">public</span> List&lt;Position&gt; positions;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> direction;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> length;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">bool</span> hasFeature = <span class="hljs-literal">false</span>;<font></font>
}<font></font>
<font></font>
[<span class="hljs-meta">Serializable</span>]
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Feature</span> { <span class="hljs-comment">// A class for saving the feature (corridor or room) information, for the dungeon generation algorithm</span>
    <span class="hljs-keyword">public</span> List&lt;Position&gt; positions;
    <span class="hljs-keyword">public</span> Wall[] walls;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> type;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> width;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> height;<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DungeonGenerator.cs：</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">using</span> System.Collections;
<span class="hljs-keyword">using</span> System.Collections.Generic;
<span class="hljs-keyword">using</span> UnityEngine;
<span class="hljs-keyword">using</span> UnityEngine.UI;<font></font>
<font></font>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">DungeonGenerator</span> : <span class="hljs-title">MonoBehaviour</span><font></font>
{<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> mapWidth;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> mapHeight;<font></font>
<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> widthMinRoom;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> widthMaxRoom;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> heightMinRoom;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> heightMaxRoom;<font></font>
<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> maxCorridorLength;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> maxFeatures;<font></font>
<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">bool</span> isASCII;<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">InitializeDungeon</span>(<span class="hljs-params"></span>)</span> {<font></font>
        MapManager.map = <span class="hljs-keyword">new</span> Tile[mapWidth, mapHeight];<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">GenerateDungeon</span>(<span class="hljs-params"></span>)</span> {<font></font>
        FirstRoom();<font></font>
        DrawMap(isASCII);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">FirstRoom</span>(<span class="hljs-params"></span>)</span> {<font></font>
        Feature room = <span class="hljs-keyword">new</span> Feature();<font></font>
        room.positions = <span class="hljs-keyword">new</span> List&lt;Position&gt;();<font></font>
<font></font>
        <span class="hljs-keyword">int</span> roomWidth = Random.Range(widthMinRoom, widthMaxRoom);
        <span class="hljs-keyword">int</span> roomHeight = Random.Range(heightMinRoom, heightMaxRoom);<font></font>
<font></font>
        <span class="hljs-keyword">int</span> xStartingPoint = mapWidth / <span class="hljs-number">2</span>;
        <span class="hljs-keyword">int</span> yStartingPoint = mapHeight / <span class="hljs-number">2</span>;<font></font>
<font></font>
        xStartingPoint -= Random.Range(<span class="hljs-number">0</span>, roomWidth);<font></font>
        yStartingPoint -= Random.Range(<span class="hljs-number">0</span>, roomHeight);<font></font>
<font></font>
        room.walls = <span class="hljs-keyword">new</span> Wall[<span class="hljs-number">4</span>];<font></font>
<font></font>
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; room.walls.Length; i++) {<font></font>
            room.walls[i] = <span class="hljs-keyword">new</span> Wall();<font></font>
            room.walls[i].positions = <span class="hljs-keyword">new</span> List&lt;Position&gt;();<font></font>
            room.walls[i].length = <span class="hljs-number">0</span>;<font></font>
<font></font>
            <span class="hljs-keyword">switch</span> (i) {
                <span class="hljs-keyword">case</span> <span class="hljs-number">0</span>:<font></font>
                    room.walls[i].direction = <span class="hljs-string">"South"</span>;
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:<font></font>
                    room.walls[i].direction = <span class="hljs-string">"North"</span>;
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:<font></font>
                    room.walls[i].direction = <span class="hljs-string">"West"</span>;
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:<font></font>
                    room.walls[i].direction = <span class="hljs-string">"East"</span>;
                    <span class="hljs-keyword">break</span>;<font></font>
            }<font></font>
        }<font></font>
<font></font>
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> y = <span class="hljs-number">0</span>; y &lt; roomHeight; y++) {
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> x = <span class="hljs-number">0</span>; x &lt; roomWidth; x++) {<font></font>
                Position position = <span class="hljs-keyword">new</span> Position();<font></font>
                position.x = xStartingPoint + x;<font></font>
                position.y = yStartingPoint + y;<font></font>
<font></font>
                room.positions.Add(position);<font></font>
<font></font>
                MapManager.map[position.x, position.y] = <span class="hljs-keyword">new</span> Tile();<font></font>
                MapManager.map[position.x, position.y].xPosition = position.x;<font></font>
                MapManager.map[position.x, position.y].yPosition = position.y;<font></font>
<font></font>
                <span class="hljs-keyword">if</span> (y == <span class="hljs-number">0</span>) {<font></font>
                    room.walls[<span class="hljs-number">0</span>].positions.Add(position);<font></font>
                    room.walls[<span class="hljs-number">0</span>].length++;<font></font>
                    MapManager.map[position.x, position.y].type = <span class="hljs-string">"Wall"</span>;<font></font>
                }<font></font>
                <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (y == (roomHeight - <span class="hljs-number">1</span>)) {<font></font>
                    room.walls[<span class="hljs-number">1</span>].positions.Add(position);<font></font>
                    room.walls[<span class="hljs-number">1</span>].length++;<font></font>
                    MapManager.map[position.x, position.y].type = <span class="hljs-string">"Wall"</span>;<font></font>
                }<font></font>
                <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (x == <span class="hljs-number">0</span>) {<font></font>
                    room.walls[<span class="hljs-number">2</span>].positions.Add(position);<font></font>
                    room.walls[<span class="hljs-number">2</span>].length++;<font></font>
                    MapManager.map[position.x, position.y].type = <span class="hljs-string">"Wall"</span>;<font></font>
                }<font></font>
                <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (x == (roomWidth - <span class="hljs-number">1</span>)) {<font></font>
                    room.walls[<span class="hljs-number">3</span>].positions.Add(position);<font></font>
                    room.walls[<span class="hljs-number">3</span>].length++;<font></font>
                    MapManager.map[position.x, position.y].type = <span class="hljs-string">"Wall"</span>;<font></font>
                }<font></font>
                <span class="hljs-keyword">else</span> {<font></font>
                    MapManager.map[position.x, position.y].type = <span class="hljs-string">"Floor"</span>;<font></font>
                }<font></font>
            }<font></font>
        }<font></font>
<font></font>
        room.width = roomWidth;<font></font>
        room.height = roomHeight;<font></font>
        room.type = <span class="hljs-string">"Room"</span>;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">DrawMap</span>(<span class="hljs-params"><span class="hljs-keyword">bool</span> isASCII</span>)</span> {
        <span class="hljs-keyword">if</span> (isASCII) {<font></font>
            Text screen = GameObject.Find(<span class="hljs-string">"ASCIITest"</span>).GetComponent&lt;Text&gt;();<font></font>
<font></font>
            <span class="hljs-keyword">string</span> asciiMap = <span class="hljs-string">""</span>;<font></font>
<font></font>
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> y = (mapHeight - <span class="hljs-number">1</span>); y &gt;= <span class="hljs-number">0</span>; y--) {
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> x = <span class="hljs-number">0</span>; x &lt; mapWidth; x++) {
                    <span class="hljs-keyword">if</span> (MapManager.map[x,y] != <span class="hljs-literal">null</span>) {
                        <span class="hljs-keyword">switch</span> (MapManager.map[x, y].type) {
                            <span class="hljs-keyword">case</span> <span class="hljs-string">"Wall"</span>:<font></font>
                                asciiMap += <span class="hljs-string">"#"</span>;
                                <span class="hljs-keyword">break</span>;
                            <span class="hljs-keyword">case</span> <span class="hljs-string">"Floor"</span>:<font></font>
                                asciiMap += <span class="hljs-string">"."</span>;
                                <span class="hljs-keyword">break</span>;<font></font>
                        }<font></font>
                    } <span class="hljs-keyword">else</span> {<font></font>
                        asciiMap += <span class="hljs-string">" "</span>;<font></font>
                    }<font></font>
<font></font>
                    <span class="hljs-keyword">if</span> (x == (mapWidth - <span class="hljs-number">1</span>)) {<font></font>
                        asciiMap += <span class="hljs-string">"\n"</span>;<font></font>
                    }<font></font>
                }<font></font>
            }<font></font>
<font></font>
            screen.text = asciiMap;<font></font>
        }<font></font>
    }<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GameManager.cs：</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">using</span> System.Collections;
<span class="hljs-keyword">using</span> System.Collections.Generic;
<span class="hljs-keyword">using</span> UnityEngine;<font></font>
<font></font>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">GameManager</span> : <span class="hljs-title">MonoBehaviour</span><font></font>
{<font></font>
    DungeonGenerator dungeonGenerator;<font></font>
    <font></font>
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Start</span>(<span class="hljs-params"></span>)</span> {<font></font>
        dungeonGenerator = GetComponent&lt;DungeonGenerator&gt;();<font></font>
<font></font>
        dungeonGenerator.InitializeDungeon();<font></font>
        dungeonGenerator.GenerateDungeon();<font></font>
    }<font></font>
}</code></pre></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja490816/index.html">eコマースサイトはAuthBotsボットネットにどのように抵抗しますか？</a></li>
<li><a href="../ja490820/index.html">1つの拠点内のすべてのハブ</a></li>
<li><a href="../ja490822/index.html">DEF CON 2019-2020で車をハッキングするための最良の資料</a></li>
<li><a href="../ja490824/index.html">Java開発者の目から見たPostgreSQLインデックスの状態</a></li>
<li><a href="../ja490826/index.html">生産効率の源泉</a></li>
<li><a href="../ja490830/index.html">Zimbra Collaboration Suite Open-Source Editionのパスワード管理</a></li>
<li><a href="../ja490832/index.html">靴のマーキング：200万のマーキングコード「1C」+「正直な​​サイン」を流通させたとき</a></li>
<li><a href="../ja490836/index.html">コメントを開いてスパムに溺れない方法</a></li>
<li><a href="../ja490838/index.html">WiFi 6が登場：市場が提供するものと、なぜこのテクノロジーが必要なのか</a></li>
<li><a href="../ja490840/index.html">リソースプランニング。パート4.1。リソース計画を立てる前に</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>