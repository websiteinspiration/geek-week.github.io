<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🔼 🤱🏼 👩🏾‍⚕️ Comment améliorer le travail avec Microsoft Remote Desktop 👩🏿‍🎨 🙊 👠</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Je veux partager quelques conseils sur la configuration d'une connexion à distance aux postes de travail via RDP. Je vais vous dire comment mettre à n...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Comment améliorer le travail avec Microsoft Remote Desktop</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/501132/"><img src="https://habrastorage.org/webt/dx/s8/wi/dxs8wiugrbhaov1gzied15gldk8.png" align="left"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Je veux partager quelques conseils sur la configuration d'une connexion à distance aux postes de travail via RDP. Je vais vous dire comment mettre à niveau l'ancien RPC-HTTP vers UDP, louer et réprimander Windows 10 et AVC, je trouverai une solution à plusieurs problèmes typiques. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous pensons que la passerelle Bureau à distance (RDGW) est utilisée pour la connexion et les postes de travail agissent comme des serveurs. L'utilisation de RDGW est très pratique car la passerelle devient un point d'entrée commun pour tous les clients. Cela permet de mieux contrôler l'accès, de conserver des enregistrements des connexions et de leur durée. Même si le VPN vous permet de vous connecter directement aux machines qui fonctionnent, ce n'est pas la meilleure option. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
RDGW est rapide, facile à configurer et Let's Encrypt et win-acme résolvent facilement le problème avec un certificat de confiance.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il existe trois protocoles de transport sur lesquels le client peut se connecter au serveur: </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RPC-HTTP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font></font><font color="red"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mauvais</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HTTP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font></font><font color="orange"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">meilleur</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HTTP + UDP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font></font><font color="green"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">excellent</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par serveur, nous entendons une machine qui fonctionne, par un client - la maison. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La première chose à faire est de transformer «mauvais» en «excellent».</font></font><br>
<a name="habracut"></a><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mettre à niveau RPC-HTTP vers HTTP</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La connexion à une session à l'aide de RPC-HTTP est facile à déterminer par l'apparence de la bande de connexion. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/7w/-0/aa/7w-0aativt247pvbumddqkf4epg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il n'y a pas d'icône de qualité de connexion (à ce sujet ci-dessous), ce qui signifie que nous utilisons l'ancien RPC enveloppé dans TLS - c'est très lent. </font><font style="vertical-align: inherit;">Le point, bien sûr, n'est pas seulement dans le wrapper - le protocole lui-même change avec chaque version du système d'exploitation, les codecs, les algorithmes de compression d'image changent. </font><font style="vertical-align: inherit;">Plus le protocole est frais, mieux c'est. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Que faire?</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows XP ou Vista</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sous XP, vous pouvez augmenter le protocole de 5.1 à 7. Le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">correctif windowsxp-kb969084-x86.exe.</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Sous Vista, de 6 à 7. Le correctif a le même numéro, les </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fichiers windows6.0-kb969084-x64.msu ou Windows6.0-KB969084-x86. .msu</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Mais RDP 7 ne fonctionne pas sur HTTP et UDP. Seule la mise à niveau du client et du serveur vers Windows 7 et versions ultérieures vous aidera. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows 7</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Vous devez d'abord mettre à niveau le protocole vers RDP 8.1, puis l'activer. La prise en charge est ajoutée par des mises à jour regroupées dans un seul package de téléchargement: </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">www.microsoft.com/en-US/download/details.aspx?id=40986</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Windows6.1-KB2574819-v2-x64.msu </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
windows6.1-kb2592687-x64.msu </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Windows6.1-KB2830477-x64.msu </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Windows6.1-KB2857650-x64.msu </font></font><br>
<s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows6.1-KB2913751-x64.msu</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (remplacé par kb2923545)</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">windows6.1-kb2923545-x64.msu</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Vous obtenez donc à la fois le nouveau client mstsc.exe et la prise en charge de RDP 8.1 pour le côté serveur du système d'exploitation. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'était: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yx/37/pl/yx37plxdymw73eubymzh1v0zgzm.png"><br>
<br>
<img src="https://habrastorage.org/webt/r1/kh/ip/r1khiphuyrmxmmodab_ecjiktiq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il est devenu: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/rt/9v/dj/rt9vdjdnfmus27h9nyn7ctpyp7g.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Après cela, le protocole doit être activé avec la clé de registre (pour cela, vous pouvez utiliser le modèle adm fourni avec Windows 7).</font></font><br>
<br>
<pre><code class="powershell hljs">[<span class="hljs-type">HKEY_LOCAL_MACHINE</span>\<span class="hljs-type">SOFTWARE</span>\<span class="hljs-type">Policies</span>\<span class="hljs-type">Microsoft</span>\<span class="hljs-type">Windows</span> <span class="hljs-type">NT</span>\<span class="hljs-type">Terminal</span> <span class="hljs-type">Services</span>]
<span class="hljs-string">"fServerEnableRDP8"</span>=dword:<span class="hljs-number">00000001</span><font></font>
 <font></font>
[<span class="hljs-type">HKEY_LOCAL_MACHINE</span>\<span class="hljs-type">SOFTWARE</span>\<span class="hljs-type">Wow6432Node</span>\<span class="hljs-type">Policies</span>\<span class="hljs-type">Microsoft</span>\<span class="hljs-type">Windows</span> <span class="hljs-type">NT</span>\<span class="hljs-type">Terminal</span> <span class="hljs-type">Services</span>]
<span class="hljs-string">"fServerEnableRDP8"</span>=dword:<span class="hljs-number">00000001</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Activez la prise en charge du transport UDP dans la stratégie de groupe. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/bg/_t/ds/bg_tdse5uudrekmylffvhh_gqzq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous redémarrons le serveur avec Windows 7. Le même cas où vous devrez peut-être redémarrer deux fois - la valeur dans le registre doit être définie avant que RDP soit activé et la stratégie de groupe est appliquée plus tard. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si tout a </font><font style="vertical-align: inherit;">
fonctionné </font><font style="vertical-align: inherit;">, alors lorsque vous vous connectez au serveur, une icône de qualité de connexion (comme dans un téléphone pour un réseau mobile) apparaîtra dans la barre de session: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/8b/_0/ok/8b_0okltugyxpizhhcydchtsve8.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows 8 et plus récent Le</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> protocole fonctionne hors de la boîte.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mettre à niveau HTTP vers HTTP + UDP</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si votre réseau n'est pas sujet à la perte de paquets, UDP améliore considérablement (pour la CAO - considérablement) la réactivité du serveur en utilisant </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FEC</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour réduire la retransmission, ainsi qu'en commutant la confirmation de livraison de paquets de la pile système TCP / IP au niveau du protocole RDP-UDP. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une session de contrôle principale via HTTP est connectée à partir de chaque client (un clavier / souris est également transmis dans ce canal), plus une ou plusieurs sessions UDP pour transmettre une image ou d'autres canaux virtuels.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous ne toucherons que la pointe de l'iceberg. Il existe 3 versions différentes du protocole RDP-UDP. De plus, UDP lui-même peut fonctionner en deux modes: UDP-R (fiable) et UDP-L (avec perte). Rien ne se passe avec Microsoft. Mais puisque rien ne dépend de nous ici, gardez à l'esprit - plus le système d'exploitation est récent, le sujet utilise un protocole plus moderne. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
À l'extérieur, RDP-UDP est enveloppé dans la sécurité de couche de transport de datagrammes (DTLS) RFC4347, comme vous pouvez le voir en ouvrant Wireshark. </font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Plus de </font><font style="vertical-align: inherit;">détails dans les documents: </font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[MS-RDPEMT]: Remote Desktop Protocol: multitransport Extension </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[MS-RDPEUDP]: Remote Desktop Protocol: UDP Transport Extension </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[MS-RDPEUDP2]: Remote Desktop Protocol: UDP Transport Extension Version 2</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Où mal, correct vous êtes les bienvenus.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De quoi avez-vous besoin pour activer UDP? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
RDP-UDP est pris en charge à partir de RDP 8. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le port udp / 3389 doit être ouvert sur le client. Si vous l'avez fermé avec un pare-feu local, ACL sur le commutateur ou un pare-feu externe - le port doit être ouvert. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour le serveur de passerelle Bureau à distance vers le port tcp / 443, ouvrez udp / 3391. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le port peut être modifié, voici comment il est configuré: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/o6/n0/w3/o6n0w3fmookrhmxaqomyx8wretk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour Windows 7, NLA (Network Level Authentication) doit être activé. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/nt/kz/ny/ntkznyeqsvsh3msad2u59_rxcck.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Peut être activé dans la stratégie de groupe </font></font><br>
<br>
<img src="https://habrastorage.org/webt/my/hj/sw/myhjswie2h7znzjoamnhf6clzq4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ou via le registre</font></font><br>
<br>
<pre><code class="powershell hljs">[<span class="hljs-type">HKEY_LOCAL_MACHINE</span>\<span class="hljs-type">SYSTEM</span>\<span class="hljs-type">CurrentControlSet</span>\<span class="hljs-type">Control</span>\<span class="hljs-type">Terminal</span> <span class="hljs-type">Server</span>\<span class="hljs-type">WinStations</span>\<span class="hljs-type">RDP</span>-<span class="hljs-type">Tcp</span>]
<span class="hljs-string">"SecurityLayer"</span>=dword:<span class="hljs-number">00000001</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quelle est la connexion n'est pas claire. Mais sans NLA sur 7-ke ne fonctionne pas, sur les versions plus récentes de NLA pour le travail, UDP n'est pas requis. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Après avoir établi une session sur HTTP, le client et le serveur </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tentent de</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> négocier une connexion UDP. En cas de perte ou de retard de paquets, la session UDP ne démarre pas. L'algorithme d'échec de négociation UDP exact n'est pas entièrement compris. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si tout est configuré, puis après la connexion, cliquez sur le bouton de qualité du lien. La fenêtre indiquera que l'UDP est négocié. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/d7/y4/jx/d7y4jx5ubs4i9zop5myyzg21oyo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sur la passerelle, cela ressemble à ceci: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/oc/ld/7n/ocld7nbslu8dt_fjahnvd-zqvso.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows 10</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous avez Windows 10 sur le serveur et sur le client, c'est l'option la plus rapide et la plus sans problème. Microsoft finalise activement RDP, et dans les dernières versions 10, vous pouvez compter sur une bonne vitesse. Les collègues n'ont pas pu détecter la différence entre Citrix et Windows 10 RDP dans la vitesse d'AutoCAD. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il existe un bon article sur l'évolution des codecs RDP basés sur AVC dans Windows 10 </font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Remote Desktop Protocol (RDP) 10 Améliorations AVC / H.264 dans Windows 10 et Windows Server 2016 Aperçu technique La</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
correspondance d'AVC avec l'encodage matériel peut être consultée dans le journal des événements (voir l'article ci-dessus pour plus de détails) ):</font></font><br>
<br>
<img src="https://habrastorage.org/webt/kf/4_/_n/kf4__nmejj4amr9nctpufhwfb6a.png"><br>
<br>
<img src="https://habrastorage.org/webt/ld/rn/ld/ldrnldvgbclldmcr2f8pxoztfxo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je note seulement qu'il y a toujours un problème de distorsion même en h.264 4: 4: 4. </font><font style="vertical-align: inherit;">Il attire immédiatement votre attention si vous travaillez dans PowerShell ISE - le texte d'erreur s'affiche avec une distorsion désagréable. </font><font style="vertical-align: inherit;">De plus, tout va bien dans la capture d'écran et la photo. </font><font style="vertical-align: inherit;">La magie. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un signe indirect du travail d'AVC apparaît également de temps en temps des carrés verts dans les coins. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AVC et le codage matériel dans les nouvelles versions devraient fonctionner dès le départ, mais la stratégie de groupe n'est jamais superflue: étant </font></font><br>
<br>
<img src="https://habrastorage.org/webt/pn/hc/uo/pnhcuobl3frw-p4pfodd9xr_tsa.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
donné qu'AVC est codé matériel avec une carte vidéo, la mise à jour des pilotes vidéo est une bonne idée.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">À propos des problèmes</font></font></h1><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XP et Vista</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Si le problème se produit sous Windows XP ou Vista, essayez d'abord de mettre à jour le protocole vers la version 7 (écrit au début de l'article). Assurez-vous d'activer la prise en charge de CredSSP. Microsoft a déjà supprimé des articles sur le site, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mais Internet se souvient</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si cela n'aide pas, "le médecin parle à la morgue, puis à la morgue". Ce que le système d'exploitation a connu au cours des 15 dernières années est préférable de ne même pas y penser. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NLA</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Parfois, il est utile de désactiver NLA sur le serveur. Cela n'a pas fonctionné, les voitures d'origine sont toutes différentes. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NTLM</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Certains clients tentent de se connecter à l'aide de NTLMv1. Les raisons sont différentes, mais vous pouvez le corriger sur le client comme ceci:</font></font><br>
<br>
<pre><code class="powershell hljs">[<span class="hljs-type">HKEY_LOCAL_MACHINE</span>\<span class="hljs-type">SYSTEM</span>\<span class="hljs-type">CurrentControlSet</span>\<span class="hljs-type">Control</span>\<span class="hljs-type">Lsa</span>]
<span class="hljs-string">"LmCompatibilityLevel"</span>=dword:<span class="hljs-number">00000003</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le redémarrage est requis. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">êtes jeune et que</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> vous n'avez </font><font style="vertical-align: inherit;">peur de rien, alors il existe une solution plus radicale: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">désactiver la liaison de canaux</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sur la passerelle Bureau à distance</font></font><br>
<br>
<pre><code class="powershell hljs">HKLM\Software\Microsoft\Windows NT\CurrentVersion\TerminalServerGateway\Config\Core
<span class="hljs-built_in">Type</span>: REG_DWORD<font></font>
Name: EnforceChannelBinding<font></font>
Value: <span class="hljs-number">0</span> (Decimal)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous n’avez pas à le faire. </font><font style="vertical-align: inherit;">Mais nous l'avons fait. </font><font style="vertical-align: inherit;">:-) Pour un client qui a insisté (pas de mal, a insisté) que NTLMv1 sur les postes de travail dont il avait besoin. </font><font style="vertical-align: inherit;">Je ne sais pas, peut-être que des serveurs sur NT4 sans SP fonctionnent toujours. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Désactivation de RDP 8+ dans Windows 10</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Si tout le reste échoue et que les idées s'épuisent, vous pouvez utiliser la clé non documentée pour rétrograder le protocole RDP vers la version 7.</font></font><br>
<br>
<pre><code class="powershell hljs">[<span class="hljs-type">HKEY_CURRENT_USER</span>\<span class="hljs-type">Software</span>\<span class="hljs-type">Microsoft</span>\<span class="hljs-type">Terminal</span> <span class="hljs-type">Server</span> <span class="hljs-type">Client</span>]
<span class="hljs-string">"RDGClientTransport"</span>=dword:<span class="hljs-number">00000001</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je ne l'ai pas fait moi-même et je ne vous conseille pas. Mais à quelqu'un, ils écrivent que cela aide. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
composant </font><b><font style="vertical-align: inherit;">DrWeb</font></b><font style="vertical-align: inherit;"> Dr.Web SpIDerGate peut interdire la connexion. Dans ce cas, une erreur est renvoyée: </font></font><br>
<img src="https://habrastorage.org/webt/fs/76/zj/fs76zj-otc0v-v_qxkkwa0gviwo.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans les statistiques Dr.Web, il y aura une entrée: </font></font><br>
<img src="https://habrastorage.org/webt/ik/fe/qy/ikfeqyljaepzhnieksw4qsomh6y.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans les commentaires sur cet article, un employé Dr.Web m'a contacté et notre problème a été résolu dans la prochaine mise à jour des bases de données antivirus. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous avez la même erreur, il est préférable de contacter le support. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme solution temporaire, vous pouvez ajouter l'URL de votre RDGW aux exceptions: </font></font><br>
<img src="https://habrastorage.org/webt/7c/do/k-/7cdok-2f6-4f2jj-bhlmjwqd2tq.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et seulement si cela n'a pas aidé à </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">désactiver complètement le composant SpIDer Gate</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Proxy système J'ai</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
rencontré un ordinateur mis hors service d'une entreprise où un TMG local était enregistré en tant que proxy système et la connexion à RDGW ne fonctionnait pas. Cela peut être résolu comme ceci:</font></font><br>
<br>
<pre><code class="powershell hljs">netsh winhttp show proxy &amp;&amp; netsh winhttp reset proxy</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Changer de disposition de clavier</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Parfois, des dispositions supplémentaires viennent. </font><font style="vertical-align: inherit;">Vous pouvez désactiver le transfert de mise en page à partir du client</font></font><br>
<pre><code class="powershell hljs">[<span class="hljs-type">HKLM</span>\<span class="hljs-type">System</span>\<span class="hljs-type">CurrentControlSet</span>\<span class="hljs-type">Control</span>\<span class="hljs-type">Keyboard</span> <span class="hljs-type">Layout</span>]
<span class="hljs-string">"IgnoreRemoteKeyboardLayout"</span>=dword:<span class="hljs-number">00000001</span></code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Problèmes DPI La</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
mise à l'échelle provient de la machine cliente, et si elle coûte 125% sur un ordinateur portable domestique, elle sera la même sur une machine fonctionnelle. </font><font style="vertical-align: inherit;">Sur les serveurs, cela peut être désactivé, mais sur les postes de travail, je n'ai pas pu trouver comment. </font><font style="vertical-align: inherit;">Mais l'App Store de Windows 10 a un </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">client «moderne»</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez y configurer DPI:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ig/dz/sm/igdzsmxjjsxc7bsmrixgkbachpm.png"><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comment surveiller une passerelle avec RDGW</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il existe un compteur de performances «TS Gateway \ Current Connections», qui est un peu bogué s'il n'y a pas de connexion ou si le serveur n'a pas redémarré depuis longtemps. Il montre exactement le nombre de connexions, mais comme nous nous en souvenons, pour HTTP + UDP, il y en a au moins deux, et peut-être plus. Par conséquent, ce n'est pas un indicateur complètement objectif du nombre de connexions des employés. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il existe une classe WMI Win32_TSGatewayConnection. Son contenu correspond à ce que vous voyez dans la section Surveillance de la passerelle Bureau à distance. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Avec lui, le nombre de connexions peut être calculé plus précisément:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-built_in">Get-WmiObject</span> <span class="hljs-literal">-class</span> <span class="hljs-string">"Win32_TSGatewayConnection"</span> <span class="hljs-literal">-namespace</span> <span class="hljs-string">"root\cimv2\TerminalServices"</span> 
|?{<span class="hljs-variable">$_</span>.transportprotocol <span class="hljs-operator">-ne</span> <span class="hljs-number">2</span>}|<span class="hljs-built_in">select</span> username,connectedresource|<span class="hljs-built_in">sort</span> username|<span class="hljs-built_in">Get-Unique</span> <span class="hljs-literal">-AsString</span>| <span class="hljs-built_in">measure</span>|<span class="hljs-built_in">select</span> <span class="hljs-literal">-ExpandProperty</span> count
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour le plaisir, il existe un utilitaire </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Analyseur d'affichage à distance</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">La version gratuite ne m'a rien montré d'utile, mais tout à coup, elle sera utile pour quelqu'un. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mais qu'en est-il du réglage fin, du réglage de quelques dizaines de paramètres de session? </font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le principe de Pareto est ici approprié: 20% des efforts donnent 80% du résultat. </font><font style="vertical-align: inherit;">Si vous êtes prêt à investir votre temps dans les 20% restants du résultat - excellent. </font><font style="vertical-align: inherit;">Gardez à l'esprit que lorsque vous lisez un article sur la configuration d'un protocole dans Windows 7, vous ne savez pas de quel protocole l'auteur a parlé - 7, 8 ou 8.1. </font><font style="vertical-align: inherit;">Lorsque vous lisez à propos de Windows 10 sans spécifier de version, les problèmes sont les mêmes. </font><font style="vertical-align: inherit;">Par exemple, ils écrivent que dans les nouvelles versions de Windows 10, le codec AVC / h.264 a changé pour RDPGFX_CODECID_AVC444 </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V2</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , et dans Windows Server 2016, RDPGFX_CODECID_AVC444 reste.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De tous ces conseils, nous utilisons seulement deux paramètres:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Couleur 16 bits, vous pouvez en lire plus dans l'article </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS RDP Performance / Bandwidth Usage</font></font></a></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Désactivation du </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lissage des polices lissage des polices: i: 0</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dans l'article ci-dessus ou </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hôtes de session Bureau à distance de réglage des performances</font></font></a></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je doute qu'ils donnent un résultat tangible. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous sommes donc arrivés à la fin de l'article. </font><font style="vertical-align: inherit;">Je voulais être plus petit, mais il s'est avéré comme toujours. </font><font style="vertical-align: inherit;">Je suis heureux si ces conseils aident quelqu'un à gagner du temps ou à améliorer la configuration de son infrastructure.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr501118/index.html">Hourra (Oh non) - Udalenka</a></li>
<li><a href="../fr501120/index.html">Qu'est-ce qu'un hub de données Google Ads</a></li>
<li><a href="../fr501126/index.html">Numéro 38: Formation informatique - problèmes et défis actuels des grandes entreprises</a></li>
<li><a href="../fr501128/index.html">Pourquoi le développement VR ne vous convient pas</a></li>
<li><a href="../fr501130/index.html">Halt and Catch Fire - une équipe qui mérite une adaptation</a></li>
<li><a href="../fr501134/index.html">Comment l'équipe GitLab QA utilise l'outil de performance GitLab</a></li>
<li><a href="../fr501138/index.html">10 événements en ligne auxquels vous pouvez assister le 2 mai</a></li>
<li><a href="../fr501140/index.html">Augmenter la fidélité de l'analyseur de données du serveur dans iOS</a></li>
<li><a href="../fr501142/index.html">Utilisez-vous un pavé numérique?</a></li>
<li><a href="../fr501144/index.html">Est-il possible de pirater le cerveau avec du son</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>