<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ…ğŸ½ ğŸ’£ ğŸ¤³ğŸ» ãƒªãƒƒãƒã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®éåŒæœŸTypescriptã¨ãã‚Œã¨æˆ¦ã†ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ ğŸ“‘ ğŸ‘¨â€ğŸ‘§â€ğŸ‘¦ ğŸ™…</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Typescriptã«async/ awaitãŒå°å…¥ã•ã‚Œã¦ä»¥æ¥ã€é–‹ç™ºã«ãŠã‘ã‚‹ã“ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’ç§°è³›ã™ã‚‹è¨˜äº‹ãŒæ•°å¤šãã‚ã‚Šã¾ã™ï¼ˆhackernoonã€blog.bitsrc.ioã€habr.comï¼‰ã€‚ç§ãŸã¡ã¯ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§æœ€åˆã‹ã‚‰ãã‚Œã‚‰ã‚’ä½¿ç”¨ã—ã¾ã™ï¼ˆES6ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼ãŒã‚µãƒãƒ¼ãƒˆã™ã‚‹ãƒ–ãƒ©ã‚¦ã‚¶ãƒ¼ã®50ï¼…æœª...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>ãƒªãƒƒãƒã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®éåŒæœŸTypescriptã¨ãã‚Œã¨æˆ¦ã†ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/464773/"><p><font style="vertical-align: inherit;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">Typescript</font></a><font style="vertical-align: inherit;">ã«</font></font><code>async</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ </font></font><code>await</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãŒ</font><font style="vertical-align: inherit;">å°å…¥ã•ã‚Œã¦ä»¥æ¥ã€</font><font style="vertical-align: inherit;">é–‹ç™ºã«ãŠã‘ã‚‹ã“ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’ç§°è³›ã™ã‚‹è¨˜äº‹ãŒæ•°å¤šãã‚ã‚Šã¾ã™ï¼ˆ</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hackernoon</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">blog.bitsrc.io</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">habr.com</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼‰ã€‚</font><font style="vertical-align: inherit;">ç§ãŸã¡ã¯ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§æœ€åˆã‹ã‚‰ãã‚Œã‚‰ã‚’ä½¿ç”¨ã—ã¾ã™ï¼ˆES6ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼ãŒã‚µãƒãƒ¼ãƒˆã™ã‚‹ãƒ–ãƒ©ã‚¦ã‚¶ãƒ¼ã®50ï¼…æœªæº€ã®å ´åˆï¼‰ã€‚</font><font style="vertical-align: inherit;">ãã—ã¦ã€ç§ã¯è‡ªåˆ†ã®çµŒé¨“ã‚’å…±æœ‰ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚ãªãœãªã‚‰ã€</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸¦åˆ—å®Ÿè¡Œ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¯</font><font style="vertical-align: inherit;">ã€</font><font style="vertical-align: inherit;">ã“ã®ãƒ‘ã‚¹ã«æ²¿ã£ã¦çŸ¥ã‚‹ã®ã¯è‰¯ã„ã“ã¨ã§ã¯ãªã„ã‹ã‚‰ã§ã™ã€‚</font></font></p><a name="habracut"></a><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ€å¾Œã®è¨˜äº‹ã¯ã‚ã¾ã‚Šå¥½ãã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ä½•ã‹ãŒç†è§£ã§ããªã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚</font><font style="vertical-align: inherit;">ç‹¬å çš„ãªã‚³ãƒ¼ãƒ‰ã‚’æä¾›ã§ããªã„ã¨ã„ã†äº‹å®Ÿã‚‚ã‚ã£ã¦ã€ä¸€èˆ¬çš„ãªã‚¢ãƒ—ãƒ­ãƒ¼ãƒã®æ¦‚è¦ã®ã¿ã§ã™ã€‚</font><font style="vertical-align: inherit;">ã—ãŸãŒã£ã¦ï¼š</font></font></p><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">èª­ã‚€ã“ã¨ãªãã‚¿ãƒ–ã‚’é–‰ã˜ã‚‹ã“ã¨ã‚’èºŠèº‡ã—ãªã„ã§ãã ã•ã„ </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç®¡ç†ã—ã¦ã„ã‚‹å ´åˆã¯ã€ä¸æ˜ç¢ºãªè©³ç´°ã‚’å°‹ã­ã¾ã™</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç§ã¯æœ€ã‚‚æ°¸ç¶šçš„ã§å¾¹åº•çš„ã«æ˜ã‚Šä¸‹ã’ãŸã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚„æ‰¹åˆ¤ã‚’å–œã‚“ã§å—ã‘å…¥ã‚Œã¾ã™ã€‚</font></font></li>
</ul><br>
<p><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚³ã‚¢ãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼ã®ãƒªã‚¹ãƒˆï¼š</font></font></strong></p><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ä¸»ã«ã„ãã¤ã‹ã®JavaScriptãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨ã—ã¦Typescriptã§è¨˜è¿°ã•ã‚Œã¦ã„ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ãƒ¡ã‚¤ãƒ³ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯ExtJSã§ã™ã€‚</font><font style="vertical-align: inherit;">Reactã‚ˆã‚Šã‚‚ãƒ•ã‚¡ãƒƒã‚·ãƒ§ãƒŠãƒ“ãƒªãƒ†ã‚£ã¯åŠ£ã‚Šã¾ã™ãŒã€è±Šå¯Œãªã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’å‚™ãˆãŸã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºè£½å“ã«æœ€é©ã§ã™ã€‚å¤šãã®æ—¢è£½ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã€å„ªã‚ŒãŸè¨­è¨ˆã®ãƒ†ãƒ¼ãƒ–ãƒ«ã€ç®±ã‹ã‚‰å‡ºã—ã¦ã™ãã«ä½¿ãˆã‚‹ã€é–‹ç™ºã‚’ç°¡ç´ åŒ–ã™ã‚‹é–¢é€£è£½å“ã®è±Šå¯Œãªã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ ã€‚</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">éåŒæœŸãƒãƒ«ãƒã‚¹ãƒ¬ãƒƒãƒ‰ã‚µãƒ¼ãƒãƒ¼ã€‚</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Websocketã‚’ä»‹ã—ãŸRPCã¯ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¨ã‚µãƒ¼ãƒãƒ¼é–“ã®ãƒˆãƒ©ãƒ³ã‚¹ãƒãƒ¼ãƒˆã¨ã—ã¦ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚</font><font style="vertical-align: inherit;">å®Ÿè£…ã¯.NET WCFã«ä¼¼ã¦ã„ã¾ã™ã€‚</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯ã™ã¹ã¦ã‚µãƒ¼ãƒ“ã‚¹ã§ã™ã€‚</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯ã€å€¤ã¨å‚ç…§ã®ä¸¡æ–¹ã§é€ä¿¡ã§ãã¾ã™ã€‚</font></font></li>
</ul></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ‡ãƒ¼ã‚¿ã‚¯ã‚¨ãƒªã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ã‚¤ã‚¹ã¯ã€Typescriptã§ã®ã¿ã€Facebookã®GraphQLã«ä¼¼ã¦ã„ã¾ã™ã€‚</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åŒæ–¹å‘é€šä¿¡ï¼šãƒ‡ãƒ¼ã‚¿æ›´æ–°ã®åˆæœŸåŒ–ã¯ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¨ã‚µãƒ¼ãƒãƒ¼ã®ä¸¡æ–¹ã‹ã‚‰èµ·å‹•ã§ãã¾ã™ã€‚</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">éåŒæœŸã‚³ãƒ¼ãƒ‰ã¯ã€</font></font><code>async</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ </font></font><code>await</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Typesrciptã®é–¢æ•°ã‚’</font><font style="vertical-align: inherit;">ä½¿ç”¨ã—ã¦é †ç•ªã«è¨˜è¿°ã•ã‚Œ</font><font style="vertical-align: inherit;">ã¾ã™ã€‚</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚µãƒ¼ãƒãƒ¼APIã¯Typescriptã§ç”Ÿæˆã•ã‚Œã¾ã™ã€‚å¤‰æ›´ã•ã‚ŒãŸå ´åˆã€ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸå ´åˆã€ãƒ“ãƒ«ãƒ‰ã¯ã™ãã«ãã‚Œã‚’è¡¨ç¤ºã—ã¾ã™ã€‚</font></font></li>
</ul><br>
<p><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‡ºåŠ›ã¯ä½•ã§ã™ã‹</font></font></strong></p><br>
<p>,             :   Typesrcipt,   .      race condition   ,     . </p><br>
<h2 id="kak-strukturirovany-dannye-poluchaemye-s-servera">  ,   </h2><br>
<p>   ,       ( ,  ,  etc.)   .       : </p><br>
<ul>
<li>     /ML   -. </li>
<li>         </li>
<li>  :    "",    ""   .</li>
</ul><br>
<p>              GraphQL,   ,       .</p><br>
<p>  :</p><br>
<pre><code class="javascript hljs"><span class="hljs-comment">//  </span><font></font>
interface IParent {<font></font>
    <span class="hljs-attr">ServerId</span>: string;<font></font>
    Nodes: INodes; <span class="hljs-comment">// INodes -     INode</span><font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//    </span><font></font>
interface INodes&lt;TNode extends INode&gt; extends ICollection {<font></font>
    IndexOf(item: TNode): number;<font></font>
    Item(index: number): TNode;<font></font>
    <span class="hljs-comment">// ...    </span><font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//   </span><font></font>
interface INode extends IItem {<font></font>
    <span class="hljs-attr">Guid</span>: string;<font></font>
    Name: string;<font></font>
    DisplayName: string;<font></font>
    Links: ILinks; <span class="hljs-comment">// ILinks -   </span>
    Info: INodeInfo; <span class="hljs-comment">//    - </span><font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//     </span><font></font>
interface ILink {<font></font>
    <span class="hljs-attr">Guid</span>: string;<font></font>
    DisplayName: string;<font></font>
    SourceNode: INode; <span class="hljs-comment">//   - </span>
    TargetNode: INode; <span class="hljs-comment">//   ,  </span><font></font>
}<font></font>
<font></font>
interface INodeInfo {<font></font>
    <span class="hljs-attr">Component</span>: IComponent;<font></font>
    ConfigData: IData;<font></font>
}<font></font>
</code></pre><br>
<h2 id="kak-klient-poluchaet-dannye">   </h2><br>
<p> :   -     RPC  <code>Promise</code>:</p><br>
<pre><code class="javascript hljs">
<span class="hljs-keyword">let</span> Nodes = Parent.Nodes; <span class="hljs-comment">// Nodes -&gt; Promise&lt;INodes&gt;</span>
</code></pre><br>
<h3 id="asinhronnost-bez-callback-hell">  "Callback Hell".</h3><br>
<p>  ""    <code>async</code>/<code>await</code>  Typescript:</p><br>
<pre><code class="javascript hljs">
<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ShowNodes</span>(<span class="hljs-params">parent: IParent</span>): <span class="hljs-title">Promise</span>&lt;<span class="hljs-title">void</span>&gt; </span>{
    <span class="hljs-comment">//   </span>
    <span class="hljs-keyword">let</span> Nodes = <span class="hljs-keyword">await</span> parent.Nodes;<font></font>
<font></font>
    <span class="hljs-comment">//      </span>
    <span class="hljs-keyword">await</span> Nodes.forEachParallel(<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">node</span>): <span class="hljs-title">Promise</span>&lt;<span class="hljs-title">void</span>&gt; </span>{
        <span class="hljs-keyword">await</span> RenderNode(node); <span class="hljs-comment">//         </span><font></font>
    });<font></font>
}<font></font>
</code></pre><br>
<p>     ,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a>.    Typescript   2016 .       ,     feature   Typescript,         .       production. </p><br>
<p>   ,      :</p><br>
<p>        <code>async</code>,     <code>Promise&lt;_&gt;</code>.   :</p><br>
<ul>
<li>  <code>async</code>   <code>await</code> (  <code>Promise</code>)          <code>Promise</code>. </li>
<li>    <code>async</code> ,  <code>Promise</code>     .</li>
<li>   Javascript   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a>   ES6 ( <code>function*</code>  <code>async function</code>  <code>yield</code>  <code>await</code>)      <code>switch</code>  ES5 ( ). <code>await</code> â€”   ,    .         <code>ShowNodes</code> ,      Javascript   -  .</li>
</ul><br>
<p>       <code>forEachParallel</code>,        .   <code>await</code>  <code>Nodes.forEachParallel</code>   .   â€” <code>Promise.all</code>:</p><br>
<pre><code class="javascript hljs">
<span class="hljs-comment">/**
 *           
 * <span class="hljs-doctag">@param </span>items 
 * <span class="hljs-doctag">@param </span>callbackfn 
 * <span class="hljs-doctag">@param </span>[thisArg]   ,      this  callbackfn
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">forEachParallel</span>&lt;<span class="hljs-title">T</span>&gt;(<span class="hljs-params">items: IItemArray&lt;T&gt;, callbackfn: (value: T, index: int, items: IItemArray&lt;T&gt;</span>) =&gt; <span class="hljs-title">Promise</span>&lt;<span class="hljs-title">void</span> | <span class="hljs-title">any</span>&gt;, <span class="hljs-title">thisArg</span>?: <span class="hljs-title">any</span>): <span class="hljs-title">Promise</span>&lt;<span class="hljs-title">void</span>&gt; </span>{
    <span class="hljs-keyword">let</span> xCount = items ? <span class="hljs-keyword">await</span> items.Count : <span class="hljs-number">0</span>;
    <span class="hljs-keyword">if</span> (!xCount)
        <span class="hljs-keyword">return</span>;
    <span class="hljs-keyword">let</span> xActions = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span>&lt;<span class="hljs-built_in">Promise</span>&lt;<span class="hljs-keyword">void</span> | any&gt;&gt;(xCount);
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; xCount; i++) {
        <span class="hljs-keyword">let</span> xItem = items.Item(i);<font></font>
        xActions[i] = ExecuteCallback(xItem, callbackfn, i, items, thisArg);<font></font>
    }<font></font>
    <span class="hljs-keyword">await</span> <span class="hljs-built_in">Promise</span>.all(xActions);<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">/**   item   callbackfn */</span>
<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ExecuteCallback</span>&lt;<span class="hljs-title">T</span>&gt;(<span class="hljs-params">item: Promise&lt;T&gt; | T, callbackfn: (value: T, index: int, items: IItemArray&lt;T&gt;</span>) =&gt; <span class="hljs-title">Promise</span>&lt;<span class="hljs-title">void</span> | <span class="hljs-title">any</span>&gt;, <span class="hljs-title">index</span>: <span class="hljs-title">int</span>, <span class="hljs-title">items</span>: <span class="hljs-title">IItemArray</span>&lt;<span class="hljs-title">T</span>&gt;, <span class="hljs-title">thisArg</span>?: <span class="hljs-title">any</span>): <span class="hljs-title">Promise</span>&lt;<span class="hljs-title">void</span>&gt; </span>{
    <span class="hljs-keyword">let</span> xItem = <span class="hljs-keyword">await</span> item;
    <span class="hljs-keyword">await</span> callbackfn.call(thisArg, xItem, index, items);<font></font>
}<font></font>
</code></pre><br>
<p>  :         ,       Javascript'.</p><br>
<p> <code>ShowNodes</code>   :         .    ,      ,       .             .</p><br>
<h2 id="yazyk-zaprosov"> </h2><br>
<p>  ,    ""    .  "" ,        :</p><br>
<pre><code class="javascript hljs">
<span class="hljs-comment">/**
 *       item    Promise  ,
 *      properties
 */</span>
selectAsync&lt;T extends IItem&gt;<span class="hljs-function">(<span class="hljs-params">item: T, properties: (</span>) =&gt;</span> any[]): <span class="hljs-built_in">Promise</span>&lt;T&gt;;<font></font>
<font></font>
<span class="hljs-comment">/**
 *   items,       properties
 */</span>
selectAsyncAll&lt;T extends ICollection&gt;<span class="hljs-function">(<span class="hljs-params">items: T[], properties: (</span>) =&gt;</span> any[]): <span class="hljs-built_in">Promise</span>&lt;T[]&gt;;<font></font>
<font></font>
<span class="hljs-comment">/**    selectAsync     */</span>
select&lt;T&gt;<span class="hljs-function">(<span class="hljs-params">item: T, properties: (</span>) =&gt;</span> any[]): T;<font></font>
<font></font>
<span class="hljs-comment">/**    selectAsync     */</span>
selectAll&lt;T&gt;<span class="hljs-function">(<span class="hljs-params">items: T[], properties: (</span>) =&gt;</span> any[]): T[];
</code></pre><br>
<p>              :</p><br>
<pre><code class="javascript hljs">
<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ShowNodes</span>(<span class="hljs-params">parentPoint: IParent</span>): <span class="hljs-title">Promise</span>&lt;<span class="hljs-title">void</span>&gt; </span>{
    <span class="hljs-comment">//       IParent -    selectAsync (</span>
    <span class="hljs-comment">// Promise,  ).</span>
    <span class="hljs-keyword">let</span> Parent = <span class="hljs-keyword">await</span> selectAsync(parentPoint, parent =&gt; [
        <span class="hljs-comment">//          </span>
        selectAll(parent.Nodes, nodes =&gt; [node.Name, node.DisplayName]) <span class="hljs-comment">// [node.Name, node.DisplayName] -       </span><font></font>
    ]);<font></font>
<font></font>
    <span class="hljs-comment">//      Parent.Nodes</span><font></font>
    ...<font></font>
}<font></font>
</code></pre><br>
<p>         :</p><br>
<pre><code class="javascript hljs">
    <span class="hljs-comment">//     parent.Nodes  selectAsyncAll,   </span>
    <span class="hljs-keyword">let</span> Parent = <span class="hljs-keyword">await</span> selectAsyncAll(parent.Nodes, nodes =&gt; [
        <span class="hljs-comment">//    :</span><font></font>
        select(node, node =&gt; [<font></font>
            node.Name,<font></font>
            node.DisplayName,<font></font>
            selectAll(node.Links, link =&gt; [<font></font>
                link.Guid,<font></font>
                link.DisplayName,<font></font>
                select(link.TargetNode, targetNode =&gt; [targetNode.Guid])<font></font>
            ]),<font></font>
            select(node.Info, info =&gt; [info.Component]) <span class="hljs-comment">//    IInfo    IComponent,   ,   ,       </span><font></font>
        ])<font></font>
    ]);<font></font>
</code></pre><br>
<p>       .      ,          ,  , race condition. </p><br>
<h2 id="race-condition-i-puti-resheniya">Race Condition   </h2><br>
<p>              ,     ,  <code>async</code>  <code>FuncOne</code> ,  <code>Promise</code>.        (    ) ,  ,    .  <code>FuncOne</code>     , ,    .</p><br>
<p>    :   <code>IParent</code>    <code>Parent.OnSynchronize</code>.</p><br>
<pre><code class="javascript hljs"><span class="hljs-comment">/**   */</span>
Parent.OnSynchronize.AddListener(<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>): <span class="hljs-title">Promise</span>&lt;<span class="hljs-title">void</span>&gt; </span>{
    <span class="hljs-comment">//   .   ,  .</span><font></font>
});<font></font>
</code></pre><br>
<p>      <code>INodes</code>  .       :</p><br>
<ol>
<li>     ,      <br>
<pre><code class="javascript hljs"><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">OnClickRemoveNode</span>(<span class="hljs-params">node: INode</span>): <span class="hljs-title">Promise</span>&lt;<span class="hljs-title">void</span>&gt; </span>{
<span class="hljs-keyword">let</span> removedOnServer: boolean = <span class="hljs-keyword">await</span> Parent.RemoveNode(node);
<span class="hljs-comment">//    </span>
<span class="hljs-keyword">if</span> (removedOnServer) ....<font></font>
}</code></pre></li>
<li> <code>Parent.OnSynchronize</code>     .</li>
<li><code>Parent.OnSynchronize</code>     .</li>
<li><code>async OnClickRemoveNode()</code>     <code>await</code>        .</li>
</ol><br>
<p>   <code>OnClickRemoveNode</code>    .         â€” .      ?       <code>await</code> â€”  :</p><br>
<ul>
<li>        . </li>
<li>   ,  :    <code>OnClickRemoveNode</code>,         .       ,    .</li>
<li>  :   -  ,   .     ,             ,        â€”  .</li>
<li>  ,     ,   ?   <code>await</code>   ?</li>
</ul><br>
<p>   : ,     ? ,   :</p><br>
<ul>
<li> </li>
<li> </li>
<li>/ </li>
<li>   </li>
<li>  :            .</li>
</ul><br>
<p>  ,       - race condition,     ..            â€”      .    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> Typescript</a>        .</p><br>
<p><strong>      :</strong></p><br>
<ol>
<li>       .                    .</li>
<li>         .     ,       View,    .</li>
<li>      (,  <code>IsDestroyed</code>).           .</li>
<li> View                  .</li>
<li>     <code>Promise.done()</code>.      <code>handler</code>  .   : <br>
<ul>
<li>,   <code>Promise</code>-,      (, ,      stak trace'),      (       ).       â€”   . :        <code>unhandledrejection</code>,         Chrome  Edge:<br>
<br>
<pre><code class="javascript hljs"><span class="hljs-built_in">window</span>.addEventListener(<span class="hljs-string">'unhandledrejection'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) </span>{ 
<span class="hljs-comment">// handling... </span>
});</code></pre></li>
<li>       <code>async</code> - ,    stack trace . </li>
</ul></li>
</ol><br>
<p>          ,     .</p><br>
<pre><code class="javascript hljs">
<span class="hljs-comment">/**
 * :
 * 1.     
 * 2.      ,   .
 * 
 *  ,  :   ,        
 */</span><font></font>
@Lock<font></font>
<font></font>
<span class="hljs-comment">/**
 * :
 *     ,     .
 * 
 *  ,     :   ,   .
 */</span><font></font>
@LockQueue<font></font>
<font></font>
<span class="hljs-comment">/**
 *  LockQueue .  -        
 * 
 *   ,       . ,   .
 */</span><font></font>
@LockBetween<font></font>
<font></font>
<span class="hljs-comment">/**
 * :  
 *       ,   . 
 *     . :     ,     300 .       . 
 */</span>
@LockDeferred(<span class="hljs-number">300</span>)<font></font>
<font></font>
<span class="hljs-comment">// ,    ,     :</span><font></font>
<font></font>
interface ILockTarget {<font></font>
<font></font>
    <span class="hljs-comment">/**
     * ,   View,   .   ,        ,     ,       
     */</span><font></font>
    GetControllerView?(): IView;<font></font>
    <span class="hljs-comment">/**  true      */</span><font></font>
    IsDestroyed: boolean;<font></font>
<font></font>
}<font></font>
</code></pre><br>
<p>  ,         ,   :</p><br>
<pre><code class="javascript hljs">
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GraphController</span> <span class="hljs-title">implements</span> <span class="hljs-title">ILockTarget</span> </span>{<font></font>
<font></font>
    <span class="hljs-comment">/** ,      .      */</span><font></font>
    private View: IView;<font></font>
<font></font>
    public GetControllerView(): IView {<font></font>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.View;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">/**      . */</span><font></font>
    @Lock<font></font>
    private <span class="hljs-keyword">async</span> OnClickRemoveNode(): <span class="hljs-built_in">Promise</span>&lt;<span class="hljs-keyword">void</span>&gt; {<font></font>
        ...<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">/**     . */</span><font></font>
    @Lock<font></font>
    private <span class="hljs-keyword">async</span> OnClickRemoveLink(): <span class="hljs-built_in">Promise</span>&lt;<span class="hljs-keyword">void</span>&gt; {<font></font>
        ...<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">/**     */</span><font></font>
    @Lock<font></font>
    private <span class="hljs-keyword">async</span> OnClickAddNewNode(): <span class="hljs-built_in">Promise</span>&lt;<span class="hljs-keyword">void</span>&gt; {<font></font>
        ...<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">/**    " " */</span><font></font>
    @LockQueue<font></font>
    private <span class="hljs-keyword">async</span> OnServerUpdateNode(): <span class="hljs-built_in">Promise</span>&lt;<span class="hljs-keyword">void</span>&gt; {<font></font>
        ...<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">/**    " " */</span><font></font>
    @LockQueue<font></font>
    private <span class="hljs-keyword">async</span> OnServerAddLink(): <span class="hljs-built_in">Promise</span>&lt;<span class="hljs-keyword">void</span>&gt; {<font></font>
        ...<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">/**    " " */</span><font></font>
    @LockQueue<font></font>
    private <span class="hljs-keyword">async</span> OnServerAddNode(): <span class="hljs-built_in">Promise</span>&lt;<span class="hljs-keyword">void</span>&gt; {<font></font>
        ...<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">/**    -   */</span><font></font>
    @LockQueue<font></font>
    private <span class="hljs-keyword">async</span> OnServerRemoveNode(): <span class="hljs-built_in">Promise</span>&lt;<span class="hljs-keyword">void</span>&gt; {<font></font>
        ...<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">/**    -       */</span><font></font>
    @LockBetween<font></font>
    private <span class="hljs-keyword">async</span> OnServerSynchronize(): <span class="hljs-built_in">Promise</span>&lt;<span class="hljs-keyword">void</span>&gt; {<font></font>
        ...<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">/**    -    (/warning/error/...) */</span><font></font>
    @LockQueue<font></font>
    private <span class="hljs-keyword">async</span> OnServerUpdateNodeStatus(): <span class="hljs-built_in">Promise</span>&lt;<span class="hljs-keyword">void</span>&gt; {<font></font>
        ...<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">/**        */</span>
    @LockDeferred(<span class="hljs-number">300</span>)<font></font>
    private <span class="hljs-keyword">async</span> OnSearchFieldChange(): <span class="hljs-built_in">Promise</span>&lt;<span class="hljs-keyword">void</span>&gt; {<font></font>
        ...<font></font>
    }<font></font>
<font></font>
}<font></font>
</code></pre><br>
<p>          :</p><br>
<ol>
<li>  - : <code>OnClickRemoveNode</code>, <code>OnClickRemoveLink</code>.    ,         (    ).  , ,  : <br>
<ul>
<li>        </li>
<li>      (     <code>OnServerSynchronize</code>).         â€”            .<br>
  ,  ,  <code>Lock</code>             .   ,   ,   . , Websocket   ,     ,    .</li>
</ul></li>
<li>  : <code>OnClickAddNewNode</code>.     <code>OnServerSynchronize</code>, <code>OnServerAddNode</code>. <br>
<ul>
<li><code>OnClickAddNewNode</code>   (    - ,  <code>Lock</code>     )</li>
<li><code>OnServerSynchronize</code>, <code>OnServerAddNode</code>   ,    <code>OnClickAddNewNode</code>,    .</li>
</ul></li>
<li>    <code>OnServerSynchronize</code>  <code>OnServerUpdateNode</code>. ,        <code>GraphController</code>.    <code>OnServerUpdateNode</code>     ,       ,     .     <code>ILockTarget</code>  <code>IsDestroyed</code> â€”   ,      .<br>
Profit:     <code>await</code>  <code>if (!this.IsDestroyed())</code>.</li>
<li>   .     <code>OnServerSynchronize</code>, <code>OnServerUpdateNode</code>.       .  ..       <code>LockQueue</code>  <code>LockBetween</code>,   .</li>
<li>,         .  <code>GraphController #1</code>,       â€”   <code>GraphController #2</code>. , <code>GraphController</code>-    ,   (  â€”         ), ..     .  :<br>
<ul>
<li></li>
<li>  </li>
<li>   <code>GraphController #2</code>,     ,    . </li>
</ul></li>
<li><code>OnSearchFieldChange</code>   ,       .         -  .  <code>@LockDeferred(300)</code>     300 :         ,     ,    300 .  ,       .  :<br>
<ul>
<li>  ,   500 ,         .     â€”        <code>OnSearchFieldChange</code>,     .</li>
<li>     <code>OnSearchFieldChange</code>    â€”        ,   . </li>
</ul></li>
</ol><br>
<h2 id="chto-nuzhno-znat-pri-ispolzovanii-dekoratorov">     </h2><br>
<ol>
<li> Deadlock:     <code>Handler1</code>,    ,   <code>await</code>   <code>Handler2</code>,  <code>LockQueue</code>,    <code>Handler2</code> â€” <code>Handler1</code>    .</li>
<li> ,     View      . :            ,      â€”                .</li>
</ol><br>
<h2 id="profilirovanie-zaprosov-k-serveru">   </h2><br>
<p>   ,     ,        .  :</p><br>
<ul>
<li>      - <code>&lt;Class&gt;</code>.<code>&lt;Method&gt;</code> =&gt; <code>&lt;Time&gt;</code> (  ). </li>
<li>      .</li>
<li>       .</li>
</ul><br>
<h2 id="desert"></h2><br>
<p>,    ,           ,    .        ?         ?  :</p><br>
<pre><code class="javascript hljs">
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GraphController</span> <span class="hljs-title">implements</span> <span class="hljs-title">ILockTarget</span> </span>{<font></font>
<font></font>
    private View: IView;<font></font>
<font></font>
    public GetControllerView(): IView {<font></font>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.View;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">/**     . */</span><font></font>
    @Lock<font></font>
    private <span class="hljs-keyword">async</span> RunBigDataCalculations(): <span class="hljs-built_in">Promise</span>&lt;<span class="hljs-keyword">void</span>&gt; {
        <span class="hljs-keyword">await</span> Start();
        <span class="hljs-keyword">await</span> UpdateSmth();
        <span class="hljs-keyword">await</span> End();
        <span class="hljs-keyword">await</span> CleanUp();<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">/**   . */</span><font></font>
    @LockQueue<font></font>
    private <span class="hljs-keyword">async</span> OnChangeNodeState(node: INode): <span class="hljs-built_in">Promise</span>&lt;<span class="hljs-keyword">void</span>&gt; {
        <span class="hljs-keyword">await</span> GetNodeData(node);
        <span class="hljs-keyword">await</span> UpdateNode(node);<font></font>
    }<font></font>
<font></font>
}<font></font>
</code></pre><br>
<p>  :</p><br>
<ol>
<li> <code>RunBigDataCalculations</code>. </li>
<li> <code>await Start();</code></li>
<li>  /  (  )</li>
<li>  <code>await Start();</code>,   <code>await UpdateSmth();</code>      .</li>
</ol><br>
<p>:</p><br>
<ol>
<li> <code>RunBigDataCalculations</code>. </li>
<li>   <code>OnChangeNodeState</code>,          (..  ). </li>
<li>  <code>await GetNodeData(node);</code></li>
<li>  /  (  )</li>
<li>  <code>await GetNodeData(node);</code>,   <code>await UpdateNode(node);</code>      .</li>
</ol><br>
<p>     - .  :</p><br>
<ul>
<li>  :</li>
</ul><br>
<pre><code class="javascript hljs"><span class="hljs-comment">/**
 *       ,     
 */</span>
<span class="hljs-keyword">export</span> interface IQueuedDisposableLockTarget extends ILockTarget {
    <span class="hljs-comment">/**     . Lock          IsDisposing() === true */</span><font></font>
    IsDisposing(): boolean;<font></font>
    SetDisposing(): <span class="hljs-keyword">void</span>;<font></font>
}</code></pre><br>
<ul>
<li>       :</li>
</ul><br>
<pre><code class="javascript hljs">
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">QueuedDispose</span>(<span class="hljs-params">controller: IQueuedDisposableLockTarget</span>): <span class="hljs-title">void</span> </span>{
    <span class="hljs-comment">//     </span>
    <span class="hljs-keyword">let</span> xQueue = GetQueue(controller);
    <span class="hljs-comment">// 1. ,     -,   -  </span>
    <span class="hljs-keyword">if</span> (xQueue.Empty) {<font></font>
        controller.Dispose();<font></font>
        <span class="hljs-keyword">return</span>;<font></font>
    }<font></font>
    <span class="hljs-comment">// 2.  ,     " ",     ,   .  </span><font></font>
    controller.SetDisposing();<font></font>
    <span class="hljs-comment">// 3.   finally  </span>
    xQueue.finally(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {<font></font>
        debug.assert(!IsDisposed(controller), <span class="hljs-string">"-      ,  "</span>);<font></font>
        controller.Dispose();<font></font>
    });<font></font>
}<font></font>
</code></pre><br>
<p> ,          .    <code>QueuedDispose</code>     :</p><br>
<ul>
<li>        .       . </li>
<li>  <code>QueuedDispose</code>     <code>controller</code>.         â€”  ExtJS     .</li>
</ul><br>
<p><strong></strong></p><br>
<p> ,          , ..         . ,      ?    ,  .</p><br>
<p>   ,      :</p><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">    vk.com</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">    Telegram</a></p></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja464759/index.html">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ãŒ2020å¹´ã«å¿…è¦ã¨ã™ã‚‹æ•°åã®ã‚¢ã‚¸ãƒ£ã‚¤ãƒ«ãƒ–ãƒƒã‚¯</a></li>
<li><a href="../ja464761/index.html">å°ã•ãªæ”¹é€ ã¯ãƒ†ã‚¹ãƒ©ã‚’ãƒ“ãƒ‡ã‚ªç›£è¦–ã‚¹ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã«å¤‰ãˆã¾ã™</a></li>
<li><a href="../ja464763/index.html">Linuxä¸Šã®ã‚µãƒ¼ãƒãƒ¼ã®ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ï¼šã‚ªãƒ¼ãƒ—ãƒ³ãƒ„ãƒ¼ãƒ«ã®é¸æŠ</a></li>
<li><a href="../ja464765/index.html">FreePBX + GoIPã®æ§‹æˆ</a></li>
<li><a href="../ja464769/index.html">BadooãŒæ¯ç§’20ä¸‡æšã®å†™çœŸã‚’æä¾›ã™ã‚‹ã“ã¨ã‚’å¯èƒ½ã«ã—ãŸæ–¹æ³•</a></li>
<li><a href="../ja464775/index.html">9æœˆ21æ—¥Badoo PHPãƒŸãƒ¼ãƒˆã‚¢ãƒƒãƒ—ï¼ƒ3ï¼šãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹</a></li>
<li><a href="../ja464777/index.html">constãŒC / C ++ã‚³ãƒ¼ãƒ‰ã‚’é«˜é€ŸåŒ–ã—ãªã„ã®ã¯ãªãœã§ã™ã‹ï¼Ÿ</a></li>
<li><a href="../ja464779/index.html">å¿«æ¥½ä¸»ç¾©ã®ãƒŸãƒ„ãƒãƒã«ã¤ã„ã¦ã€äººã€…ãŒå½¼ã‚‰ã‚’åƒã‹ã›ã‚‹æ–¹æ³•ã¨ãƒ‰ãƒ­ãƒ¼ãƒ³</a></li>
<li><a href="../ja464781/index.html">ã‚¹ãƒãƒ¼ãƒˆTVï¼šCRTã‹ã‚‰HDR</a></li>
<li><a href="../ja464785/index.html">ç«¶äº‰åŠ›ã®ãªã„ãƒ“ãƒ¼ãƒ©ã‚¤ãƒ³ã®ãƒ¡ãƒªãƒƒãƒˆ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>