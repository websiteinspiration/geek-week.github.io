<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üå∂Ô∏è ü§úüèº üèÖ Asynchronous programming with async / await üêÇ ‚õπüèΩ üç°</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day, friends! 
 
 Relatively new JavaScript additions are asynchronous functions and the await keyword. These features are basically syntactic su...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Asynchronous programming with async / await</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/491012/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Good day, friends! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Relatively new JavaScript additions are asynchronous functions and the await keyword. </font><font style="vertical-align: inherit;">These features are basically syntactic sugar over promises (promises), making it easy to write and read asynchronous code. </font><font style="vertical-align: inherit;">They make asynchronous code look like synchronous. </font><font style="vertical-align: inherit;">This article will help you figure out what's what. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Conditions: basic computer literacy, knowledge of the basics of JS, understanding the basics of asynchronous code and promises. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Purpose: To understand how promises are made and how they are used.</font></font><br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Async / await basics</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Using async / await has two parts.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Async keyword</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
First of all, we have the async keyword, which we put before the function declaration to make it asynchronous. </font><font style="vertical-align: inherit;">An asynchronous function is a function that anticipates the ability to use the await keyword to run asynchronous code. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Try typing the following in the browser console:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">hello</span>(<span class="hljs-params"></span>)</span>{ <span class="hljs-keyword">return</span> <span class="hljs-string">'Hello'</span> }<font></font>
hello()<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The function will return 'Hello'. </font><font style="vertical-align: inherit;">Nothing unusual, right? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But what if we turn it into an asynchronous function? </font><font style="vertical-align: inherit;">Try the following:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">hello</span>(<span class="hljs-params"></span>)</span>{ <span class="hljs-keyword">return</span> <span class="hljs-string">'Hello'</span> }<font></font>
hello()<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now a function call returns a promise. </font><font style="vertical-align: inherit;">This is one of the features of asynchronous functions - they return values ‚Äã‚Äãthat are guaranteed to be converted to promises. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You can also create asynchronous functional expressions, like so:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">let</span> hello = <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{ <span class="hljs-keyword">return</span> hello() }<font></font>
hello()<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You can also use arrow functions:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">let</span> hello = <span class="hljs-keyword">async</span> () =&gt; { <span class="hljs-keyword">return</span> <span class="hljs-string">'Hello'</span> }
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
All these functions do the same thing. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In order to get the value of a completed promise, we can use the .then () block:</font></font><br>
<br>
<pre><code class="javascript hljs">hello().then(<span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> <span class="hljs-built_in">console</span>.log(value))
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
... or even so:</font></font><br>
<br>
<pre><code class="javascript hljs">hello().then(<span class="hljs-built_in">console</span>.log)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Thus, adding the async keyword causes the function to return a promise instead of a value. </font><font style="vertical-align: inherit;">In addition, it allows synchronous functions to avoid any overhead associated with running and supporting the use of await. </font><font style="vertical-align: inherit;">A simple addition of async in front of the function enables automatic code optimization by the JS engine. </font><font style="vertical-align: inherit;">Cool!</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Keyword await</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The benefits of asynchronous functions become even more apparent when you combine them with the await keyword. </font><font style="vertical-align: inherit;">It can be added before any promise-based function to make it wait for the promise to complete, and then return the result. </font><font style="vertical-align: inherit;">After that, the next block of code is executed. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You can use await when calling any function that returns a promise, including Web API functions. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Here is a trivial example:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">hello</span>(<span class="hljs-params"></span>)</span>{
    <span class="hljs-keyword">return</span> greeting = <span class="hljs-keyword">await</span> <span class="hljs-built_in">Promise</span>.resolve(<span class="hljs-string">'Hello'</span>)<font></font>
}<font></font>
<font></font>
hello().then(alert)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Of course, the above code is useless, it only serves as a demonstration of the syntax. </font><font style="vertical-align: inherit;">Let's move on and look at a real example.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rewriting code on promises using async / await</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Take the fetch example from the previous article:</font></font><br>
<br>
<pre><code class="javascript hljs">fetch(<span class="hljs-string">'coffee.jpg'</span>)<font></font>
.then(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> response.blob())<font></font>
.then(<span class="hljs-function"><span class="hljs-params">myBlob</span> =&gt;</span> {
    <span class="hljs-keyword">let</span> objectURL = URL.createObjectURL(myBlob)
    <span class="hljs-keyword">let</span> image = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'img'</span>)<font></font>
    image.src = objectURL<font></font>
    <span class="hljs-built_in">document</span>.body.appendChild(image)<font></font>
})<font></font>
.catch(<span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> {
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'There has been a problem with your fetch operation: '</span> + e.message)<font></font>
})<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You should already have an understanding of what promises are and how they work, but let's rewrite this code using async / await to see how simple it is:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">myFetch</span>(<span class="hljs-params"></span>)</span>{
    <span class="hljs-keyword">let</span> response = <span class="hljs-keyword">await</span> fetch(<span class="hljs-string">'coffee.jpg'</span>)
    <span class="hljs-keyword">let</span> myBlob = <span class="hljs-keyword">await</span> response.blob()<font></font>
<font></font>
    <span class="hljs-keyword">let</span> objectURL = URL.createObjectURL(myBlob)
    <span class="hljs-keyword">let</span> image = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'img'</span>)<font></font>
    image.src = objectURL<font></font>
    <span class="hljs-built_in">document</span>.body.appendChild(image)<font></font>
}<font></font>
<font></font>
myFetch().catch(<span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> {
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'There has been a problem with your fetch operation: '</span> + e.message)<font></font>
})<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This makes the code much simpler and easier to understand - no .then () blocks! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Using the async keyword turns a function into a promise, so we can use a mixed approach from promises and await, highlighting the second part of the function in a separate block in order to increase flexibility:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">myFetch</span>(<span class="hljs-params"></span>)</span>{
    <span class="hljs-keyword">let</span> response = <span class="hljs-keyword">await</span> fetch(<span class="hljs-string">'coffee.jpg'</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> response.blob()<font></font>
}<font></font>
<font></font>
myFetch().then(<span class="hljs-function">(<span class="hljs-params">blob</span>) =&gt;</span> {
    <span class="hljs-keyword">let</span> objectURL = URL.createObjectURL(blob)
    <span class="hljs-keyword">let</span> image = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'image'</span>)<font></font>
    image.src = objectURL<font></font>
    <span class="hljs-built_in">document</span>.body.appendChild(image)<font></font>
}).catch(<span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> <span class="hljs-built_in">console</span>.log(e))
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You can rewrite the example or run our </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">live demo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (see also the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">source code</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">But how does it work?</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We wrapped the code inside the function and added the async keyword before the function keyword. You need to create an asynchronous function to determine the code block in which the asynchronous code will run; await only works inside asynchronous functions. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Once again: await only works in asynchronous functions.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Inside the myFetch () function, the code is very much like the version on promises, but with some differences. Instead of using the .then () block after each promise-based method, just add the await keyword before calling the method and assign a value to the variable. The await keyword causes the JS engine to pause code execution on a given line, allowing another code to execute until the asynchronous function returns a result. Once it is executed, the code will continue execution from the next line. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For instance:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">let</span> response = <span class="hljs-keyword">await</span> fetch(<span class="hljs-string">'coffee.jpg'</span>)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The value returned by the fetch () promise is assigned to the response variable when the given value becomes available, and the parser stops at that line until the promise is completed. </font><font style="vertical-align: inherit;">As soon as the value becomes available, the parser moves on to the next line of code that creates the Blob. </font><font style="vertical-align: inherit;">This line also calls the promise-based asynchronous method, so here we also use await. </font><font style="vertical-align: inherit;">When the result of the operation returns, we return it from the myFetch () function. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This means that when we call the myFetch () function, it returns a promise, so we can add .then () to it, inside which we handle the display of the image on the screen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You probably think ‚ÄúThat's great!‚Äù And you're right - fewer .then () blocks for wrapping the code, it all looks like synchronous code, so it is intuitive.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Add error handling</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you want to add error handling, you have several options. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You can use the synchronous try ... catch structure with async / await. </font><font style="vertical-align: inherit;">This example is an extended version of the code above:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">myFetch</span>(<span class="hljs-params"></span>)</span>{
    <span class="hljs-keyword">try</span>{
        <span class="hljs-keyword">let</span> response = <span class="hljs-keyword">await</span> fetch(<span class="hljs-string">'coffee.jpg'</span>)
        <span class="hljs-keyword">let</span> myBlob = <span class="hljs-keyword">await</span> response.blob()<font></font>
<font></font>
        <span class="hljs-keyword">let</span> objectURL = URL.createObjectURL(myBlob)
        <span class="hljs-keyword">let</span> image = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'img'</span>)<font></font>
        image.src = objectURL<font></font>
        <span class="hljs-built_in">document</span>.body.appendChild(image)<font></font>
    } <span class="hljs-keyword">catch</span>(e){
        <span class="hljs-built_in">console</span>.log(e)<font></font>
    }<font></font>
}<font></font>
<font></font>
myFetch()<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The catch () {} block accepts an error object, which we named "e"; </font><font style="vertical-align: inherit;">Now we can output it to the console, this will allow us to receive a message about where the error occurred in the code. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you want to use the second version of the code shown above, you should simply continue to use the hybrid approach and add the .catch () block to the end of the .then () call, as follows:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">myFetch</span>(<span class="hljs-params"></span>)</span>{
    <span class="hljs-keyword">let</span> response = <span class="hljs-keyword">await</span> fecth(<span class="hljs-string">'coffee.jpg'</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> response.blob()<font></font>
}<font></font>
<font></font>
myFetch().then(<span class="hljs-function">(<span class="hljs-params">blob</span>) =&gt;</span> {
    <span class="hljs-keyword">let</span> objectURL = URL.createObjectURL
    <span class="hljs-keyword">let</span> image = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'img'</span>)<font></font>
    image.src = objectURL<font></font>
    <span class="hljs-built_in">document</span>.body.appendChild(image)<font></font>
}).catch(<span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> <span class="hljs-built_in">console</span>.log(e))
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This is possible because the .catch () block will catch errors that occur both in the asynchronous function and in the promise chain. </font><font style="vertical-align: inherit;">If you use the try / catch block here, you will not be able to handle errors that occur when the myFetch () function is called. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You can find both examples on GitHub: </font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">simple-fetch-async-await-try-catch.html</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (see </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">source</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">simple-fetch-async-await-promise-catch.html</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (see </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">source</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Waiting for Promise.all ()</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Async / await is based on promises, so you can take full advantage of the latter. </font><font style="vertical-align: inherit;">These include Promise.all () in particular - you can easily add await to Promise.all () to write all the return values ‚Äã‚Äãin a way similar to synchronous code. </font><font style="vertical-align: inherit;">Again, take the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">example from the previous article</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Keep a tab open with it to compare with the code shown below. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
With async / await (see </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">live demo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">source code</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) it looks like this:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fetchAndDecode</span>(<span class="hljs-params">url, type</span>)</span>{
    <span class="hljs-keyword">let</span> repsonse = <span class="hljs-keyword">await</span> fetch(url)<font></font>
<font></font>
    <span class="hljs-keyword">let</span> content<font></font>
<font></font>
    <span class="hljs-keyword">if</span>(type === <span class="hljs-string">'blob'</span>){<font></font>
        content = <span class="hljs-keyword">await</span> response.blob()<font></font>
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(type === <span class="hljs-string">'text'</span>){<font></font>
        content = <span class="hljs-keyword">await</span> response.text()<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">return</span> content<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">displayContent</span>(<span class="hljs-params"></span>)</span>{
    <span class="hljs-keyword">let</span> coffee = fetchAndDecode(<span class="hljs-string">'coffee.jpg'</span>, <span class="hljs-string">'blob'</span>)
    <span class="hljs-keyword">let</span> tea = fetchAndDecode(<span class="hljs-string">'tea.jpg'</span>, <span class="hljs-string">'blob'</span>)
    <span class="hljs-keyword">let</span> description = fetchAndDecode(<span class="hljs-string">'description.txt'</span>, <span class="hljs-string">'text'</span>)<font></font>
<font></font>
    <span class="hljs-keyword">let</span> values = <span class="hljs-keyword">await</span> <span class="hljs-built_in">Promise</span>.all([coffee, tea, description])<font></font>
<font></font>
    <span class="hljs-keyword">let</span> objectURL1 = URL.createObjectURL(values[<span class="hljs-number">0</span>])
    <span class="hljs-keyword">let</span> objectURL2 = URL.createObjectURL(values[<span class="hljs-number">1</span>])
    <span class="hljs-keyword">let</span> descText = values[<span class="hljs-number">2</span>]<font></font>
<font></font>
    <span class="hljs-keyword">let</span> image1 = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'img'</span>)
    <span class="hljs-keyword">let</span> image2 = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'img'</span>)<font></font>
    image1.src = objectURL1<font></font>
    image2.src = objectURL2<font></font>
    <span class="hljs-built_in">document</span>.body.appendChild(image1)
    <span class="hljs-built_in">document</span>.body.appendChild(image2)<font></font>
<font></font>
    <span class="hljs-keyword">let</span> para = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'p'</span>)<font></font>
    para.textContent = descText<font></font>
    <span class="hljs-built_in">document</span>.body.appendChild(para)<font></font>
}<font></font>
<font></font>
displayContent()<font></font>
.catch(<span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> <span class="hljs-built_in">console</span>.log(e))
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We easily made the fetchAndDecode () function asynchronous with a couple of changes. </font><font style="vertical-align: inherit;">Pay attention to the line:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">let</span> values = <span class="hljs-keyword">await</span> <span class="hljs-built_in">Promise</span>.all([coffee, tea, description])
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Using await, we get the results of three promises in the values ‚Äã‚Äãvariable, in a way similar to synchronous code. </font><font style="vertical-align: inherit;">We must wrap the entire function in a new asynchronous function, displayContent (). </font><font style="vertical-align: inherit;">We did not achieve a strong code reduction, but were able to extract most of the code from the .then () block, which provides useful simplification and makes the code more readable. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To handle errors, we added a .catch () block to our call to displayContent (); </font><font style="vertical-align: inherit;">It handles errors of both functions. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Remember: you can also use the .finally () block to get a report on the operation ‚Äî you can see it in action in our </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">live demo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (see also the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">source code</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Async / await disadvantages</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Async / await has a couple of flaws. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Async / await makes the code look like synchronous and, in a sense, makes it behave more synchronously. The await keyword blocks the execution of the code following it until the promise is completed, as happens in a synchronous operation. This allows you to perform other tasks, but your own code is locked. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This means that your code can be slowed down by a large number of pending promises following one after another. Each await will wait for the completion of the previous one, while we would like the promises to be fulfilled simultaneously, as if we were not using async / await.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There is a design pattern to mitigate this problem - disabling all promise processes by storing Promise objects in variables and then waiting them. </font><font style="vertical-align: inherit;">Let's look at how this is implemented. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We have two examples at our disposal: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">slow-async-await.html</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (see </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">source code</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) and </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fast-async-await.html</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (see </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">source code</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">Both examples start with a promise function that mimics an asynchronous operation using setTimeout ():</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">timeoutPromise</span>(<span class="hljs-params">interval</span>)</span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {<font></font>
        setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{<font></font>
            resolve(<span class="hljs-string">'done'</span>)<font></font>
        }, interval)<font></font>
    })<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Then follows the asynchronous function timeTest (), which expects three calls to timeoutPromise ():</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">timeTest</span>(<span class="hljs-params"></span>)</span>{<font></font>
    ...<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Each of the three calls to timeTest () ends with a record of the time it took to fulfill the promise, then the time it takes to complete the whole operation is recorded:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">let</span> startTime = <span class="hljs-built_in">Date</span>.now()<font></font>
timeTest().then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
    <span class="hljs-keyword">let</span> finishTime = <span class="hljs-built_in">Date</span>.now()
    <span class="hljs-keyword">let</span> timeTaken = finishTime - startTime<font></font>
    alert(<span class="hljs-string">'Time taken in milliseconds: '</span> + timeTaken)<font></font>
})<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In each case, the timeTest () function is different. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In slow-async-await.html timeTest () looks like this:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">timeTest</span>(<span class="hljs-params"></span>)</span>{
    <span class="hljs-keyword">await</span> timeoutPromise(<span class="hljs-number">3000</span>)
    <span class="hljs-keyword">await</span> timeoutPromise(<span class="hljs-number">3000</span>)
    <span class="hljs-keyword">await</span> timeoutPromise(<span class="hljs-number">3000</span>)<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Here we just expect three calls to timeoutPromise, each time setting a delay of 3 seconds. </font><font style="vertical-align: inherit;">Each call waits for the completion of the previous one - if you run the first example, you will see a modal window in about 9 seconds. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In fast-async-await.html timeTest () looks like this:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">timeTest</span>(<span class="hljs-params"></span>)</span>{
    <span class="hljs-keyword">const</span> timeoutPromise1 = timeoutPromise(<span class="hljs-number">3000</span>)
    <span class="hljs-keyword">const</span> timeoutPromise2 = timeoutPromise(<span class="hljs-number">3000</span>)
    <span class="hljs-keyword">const</span> timeoutPromise3 = timeoutPromise(<span class="hljs-number">3000</span>)<font></font>
<font></font>
    <span class="hljs-keyword">await</span> timeoutPromise1
    <span class="hljs-keyword">await</span> timeoutPromise2
    <span class="hljs-keyword">await</span> timeoutPromise3<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Here we save three Promise objects in variables, which causes the processes associated with it to run simultaneously. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Further, we expect their results - as promises begin to be fulfilled simultaneously, promises will also be completed at the same time; </font><font style="vertical-align: inherit;">when you run the second example, you will see a modal window in about 3 seconds! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You should carefully test the code and keep this in mind while reducing performance. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Another minor inconvenience is the need to wrap the expected promises in an asynchronous function.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Using async / await with classes</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In conclusion, we note that you can add async even in methods for creating classes so that they return promises and wait for promises inside them. </font><font style="vertical-align: inherit;">Take the code from the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">article about object-oriented JS</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and compare it with the version modified using async:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Person</span></span>{
    <span class="hljs-keyword">constructor</span>(first, last, age, gender, interests){
        <span class="hljs-keyword">this</span>.name = {<font></font>
            first,<font></font>
            last<font></font>
        }<font></font>
        <span class="hljs-keyword">this</span>.age = age
        <span class="hljs-keyword">this</span>.gender = gender
        <span class="hljs-keyword">this</span>.interests = interests<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">async</span> greeting(){
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> <span class="hljs-built_in">Promise</span>.resolve(<span class="hljs-string">`Hi! I'm <span class="hljs-subst">${<span class="hljs-keyword">this</span>.name.first}</span>`</span>)<font></font>
    }<font></font>
<font></font>
    farewell(){<font></font>
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-keyword">this</span>.name.first}</span> has left the building. Bye for now!`</span>)<font></font>
    }<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">let</span> han = <span class="hljs-keyword">new</span> Person(<span class="hljs-string">'Han'</span>, <span class="hljs-string">'Solo'</span>, <span class="hljs-number">25</span>, <span class="hljs-string">'male'</span>, [<span class="hljs-string">'Smuggling'</span>])
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The class method can be used as follows:</font></font><br>
<br>
<pre><code class="javascript hljs">han.greeting().then(<span class="hljs-built_in">console</span>.log)
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Browser support</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
One of the obstacles to using async / await is the lack of support for older browsers. </font><font style="vertical-align: inherit;">This feature is available in almost all modern browsers, as well as promises; </font><font style="vertical-align: inherit;">Some problems exist in Internet Explorer and Opera Mini. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you want to use async / await, but need the support of older browsers, you can use the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BabelJS</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> library </font><font style="vertical-align: inherit;">- it allows you to use the latest JS, converting it to a suitable one for a particular browser.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Async / await allows you to write asynchronous code that is easy to read and maintain. </font><font style="vertical-align: inherit;">Although async / await is worse supported than other ways to write asynchronous code, it is definitely worth exploring. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Thank you for attention. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Happy coding!</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en490998/index.html">Hardware testing in SIBUR</a></li>
<li><a href="../en491000/index.html">Styling Select-Option (almost) without JavaScript</a></li>
<li><a href="../en491006/index.html">Intel NUC as a pass in Unity3D</a></li>
<li><a href="../en491008/index.html">Well forgotten old</a></li>
<li><a href="../en491010/index.html">A selection of articles on machine learning: cases, guides and studies for February 2020</a></li>
<li><a href="../en491016/index.html">Issue # 32: IT training - current issues and challenges from leading companies</a></li>
<li><a href="../en491018/index.html">Creating an Online Store on Nuxt.js 2 Walkthrough Part 2</a></li>
<li><a href="../en491028/index.html">–ü–æ–≤–µ–ª–∏—Ç–µ–ª—å –º—É—Ö</a></li>
<li><a href="../en491030/index.html">Deploying Mediawiki on Debian (it's very easy)</a></li>
<li><a href="../en491032/index.html">‚ÄúRTFM, dude!‚Äù, Or how free cheese cost me $ 5. And it could have been at $ 80 +</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>