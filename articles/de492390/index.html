<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚úçÔ∏è üí¥ üöÆ Krieg auf den Bremsen. Optimieren der Anzahl der Komponenten-Renderings in React Native ü§ò ü•å ‚ú°Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo Habr! Mein Name ist Kamo Spertsyan, ich bin bei Profi.ru in der Entwicklung von React Native t√§tig. Wenn Sie sich f√ºr die Verwendung der React N...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Krieg auf den Bremsen. Optimieren der Anzahl der Komponenten-Renderings in React Native</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/492390/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hallo Habr! Mein Name ist Kamo Spertsyan, ich bin bei Profi.ru in der Entwicklung von React Native t√§tig. Wenn Sie sich f√ºr die </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Verwendung der React Native-Technologie</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> entscheiden, </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">um</font></a><font style="vertical-align: inherit;"> schnell Produktfunktionen </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">bereitzustellen</font></a><font style="vertical-align: inherit;"> und sich auf die Entwicklungsgeschwindigkeit zu konzentrieren, treten wahrscheinlich Leistungsprobleme auf. Zumindest ist uns das passiert. Nach sechs Monaten aktiver Entwicklung fiel die Leistung unserer Anwendung unter ein kritisches Niveau - alles war extrem langsam. Daher haben wir die Optimierung aufgenommen - alle ‚ÄûBremsen‚Äú w√§hrend des Startvorgangs, √úberg√§nge zwischen Bildschirmen, Rendern von Bildschirmen, Reaktionen auf Benutzeraktionen entfernt. Infolgedessen haben sie in drei Monaten die Benutzererfahrung auf das native Niveau gebracht. In diesem Artikel m√∂chte ich dar√ºber sprechen, wie wir die Anwendung auf React Native optimiert und das Problem des Renderns mehrerer Komponenten gel√∂st haben.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/tv/qy/9b/tvqy9bo_jyqc4cz044_gneepvmw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich habe Empfehlungen zusammengestellt, die dazu beitragen, die Anzahl sinnloser Neuzeichnungen von Komponenten zu minimieren. </font><font style="vertical-align: inherit;">Zur Verdeutlichung vergleiche ich in den Beispielen die "schlechten" und "guten" Implementierungen. </font><font style="vertical-align: inherit;">Der Artikel ist n√ºtzlich f√ºr diejenigen, die bereits mit einer schlechten Anwendungsleistung konfrontiert sind, und f√ºr diejenigen, die dies in Zukunft nicht zulassen m√∂chten. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir verwenden React Native gepaart mit Redux. </font><font style="vertical-align: inherit;">Einige der Tipps beziehen sich auf diese Bibliothek. </font><font style="vertical-align: inherit;">Auch im Beispiel verwende ich die Redux-Thunk-Bibliothek, um die Arbeit mit dem Netzwerk zu simulieren.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wann sollte man √ºber Leistung nachdenken?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In der Tat lohnt es sich, sich von Anfang an an die Arbeit an der Anwendung zu erinnern. Aber wenn Ihre Anwendung bereits langsamer wird - verzweifeln Sie nicht, alles kann repariert werden. </font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jeder wei√ü es, aber f√ºr alle F√§lle m√∂chte ich erw√§hnen: Es ist besser, die Leistung auf schwachen Ger√§ten zu √ºberpr√ºfen. Wenn Sie auf leistungsstarken Ger√§ten entwickeln, sind Sie sich der ‚ÄûBremsen‚Äú der Endbenutzer m√∂glicherweise nicht bewusst. Entscheiden Sie selbst, von welchen Ger√§ten Sie gef√ºhrt werden. Messen Sie die Zeit oder den </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FPS</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in Kontrollkurven, um sie nach der Optimierung mit den Ergebnissen zu vergleichen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
React Native von der Stange bietet die M√∂glichkeit, FPS-Anwendungen √ºber Entwicklertools ‚Üí Perf-Monitor anzeigen zu messen. </font><font style="vertical-align: inherit;">Der Referenzwert betr√§gt 60 Bilder pro Sekunde. </font><font style="vertical-align: inherit;">Je niedriger dieser Indikator ist, desto st√§rker "verlangsamt" sich die Anwendung - reagiert nicht oder reagiert nicht mit einer Verz√∂gerung auf Benutzeraktionen. </font><font style="vertical-align: inherit;">Einer der Haupteffekte auf FPS ist die Anzahl der Renderings, deren ‚ÄûSchweregrad‚Äú von der Komplexit√§t der Komponenten abh√§ngt.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beispielbeschreibung</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich zeige alle Empfehlungen am Beispiel einer einfachen Anwendung mit einer Liste von Nachrichten. </font><font style="vertical-align: inherit;">Die Anwendung verf√ºgt √ºber einen Bildschirm, auf dem sich </font></font><code>FlatList</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">die Nachrichten befinden. </font><font style="vertical-align: inherit;">Eine Nachricht ist eine Komponente </font></font><code>NewsItem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, die aus zwei kleineren Komponenten besteht - der √úberschrift ( </font></font><code>NewsItemTitle</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) und dem Text ( </font></font><code>NewsItemBody</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font><font style="vertical-align: inherit;">Das gesamte Beispiel zu sehen ist </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hier</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Weiter im Text finden Sie Links zu verschiedenen Zweigen des Repositorys f√ºr spezifische Beispiele. </font><font style="vertical-align: inherit;">Das Repository wird f√ºr Leser verwendet, die Beispiele genauer untersuchen m√∂chten. </font><font style="vertical-align: inherit;">Der Code im Repository und in den folgenden Beispielen erhebt keinen Anspruch auf Perfektion - er wird ausschlie√ülich zu Demonstrationszwecken ben√∂tigt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im Folgenden werden alle Komponenten mit Links und Requisiten schematisch dargestellt.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/d9/ng/z6/d9ngz6hldmphbkjky1a-7-38nlq.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bei der Rendermethode jeder Komponente habe ich der Konsole die Ausgabe eindeutiger Informationen hinzugef√ºgt: </font></font><br>
<br>
<pre><code class="plaintext hljs">SCREEN<font></font>
ITEM_{no}<font></font>
ITEM_TITLE_{no}<font></font>
ITEM_BODY_{no}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wo </font></font><code>{no}</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ist die Seriennummer der Nachrichten, um zwischen verschiedenen Nachrichten-Renderings und mehreren Renderings derselben zu unterscheiden? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zum Testen jeder </font></font><code>refresh</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nachrichtenliste </font><font style="vertical-align: inherit;">werden am </font><font style="vertical-align: inherit;">Anfang zus√§tzliche Nachrichten hinzugef√ºgt. </font><font style="vertical-align: inherit;">Gleichzeitig wird in der Konsole folgende Meldung angezeigt:</font></font><br>
<br>
<pre><code class="plaintext hljs">--------------[ REFRESHING ]--------------</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Diese Datens√§tze helfen zu verstehen, ob es ein Problem in einer bestimmten Komponente gibt, und sp√§ter festzustellen, ob es m√∂glich war, es zu optimieren. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bei korrekter Implementierung sollten unser Protokoll nach dem Start und mehrere Updates folgenderma√üen aussehen:</font></font><br>
<br>
<pre><code class="plaintext hljs">SCREEN<font></font>
ITEM_2<font></font>
ITEM_TITLE_2<font></font>
ITEM_BODY_2<font></font>
ITEM_1<font></font>
ITEM_TITLE_1<font></font>
ITEM_BODY_1<font></font>
--------------[ REFRESHING ]--------------<font></font>
SCREEN<font></font>
ITEM_3<font></font>
ITEM_TITLE_3<font></font>
ITEM_BODY_3<font></font>
--------------[ REFRESHING ]--------------<font></font>
SCREEN<font></font>
ITEM_4<font></font>
ITEM_TITLE_4<font></font>
ITEM_BODY_4</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beim ersten Start werden der Bildschirm selbst und zwei erste Nachrichten gezeichnet. </font><font style="vertical-align: inherit;">Beim Aktualisieren der Karte wird der Bildschirm erneut gerendert, da sich seine Daten wirklich ge√§ndert haben. </font><font style="vertical-align: inherit;">Weitere Neuigkeiten kommen auf. </font><font style="vertical-align: inherit;">Alle vorherigen Nachrichten werden nicht neu gezeichnet, da sich ihre Daten nicht ge√§ndert haben.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wann wird eine Komponente gerendert?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In React und React Native gibt es zwei Bedingungen zum Rendern einer Komponente:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">seine Requisiten / Zustand √§ndern,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Render der √ºbergeordneten Komponente.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eine Funktion kann in einer Komponente neu definiert werden </font></font><code>shouldComponentUpdate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- sie empf√§ngt neue Requisiten und Status als Eingabe und gibt an, ob die Komponente gerendert werden soll. Um unn√∂tige Renderings zu vermeiden, reicht h√§ufig ein </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">flacher Vergleich</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> von Requisiten und Statusobjekten aus. Dies eliminiert beispielsweise unn√∂tige Renderings, wenn sich die √ºbergeordnete Komponente √§ndert, wenn sie die untergeordnete Komponente nicht beeinflussen. Um nicht jedes Mal manuell einen Oberfl√§chenvergleich zu schreiben, k√∂nnen Sie eine Komponente erben </font></font><code>React.PureComponent</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, die diese Pr√ºfung einschlie√üt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn wir die Connect Link-Funktion verwenden, erstellt die Redux-Bibliothek eine neue Komponente, die mit dem globalen Status ‚Äûverbunden‚Äú ist. √Ñnderungen an diesem Status l√∂sen eine Methode aus</font></font><code>mapStateToProps</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">das gibt neue Requisiten zur√ºck. </font><font style="vertical-align: inherit;">Als n√§chstes beginnt ein Vergleich von alten und neuen Requisiten, unabh√§ngig davon, ob die Komponente als deklariert wurde </font></font><code>PureComponent</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">oder nicht. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Betrachten Sie diese Nuancen in unserem Beispiel. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir </font></font><code>NewsItem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lassen die </font><font style="vertical-align: inherit;">Komponente </font><font style="vertical-align: inherit;">durch </font></font><code>connect</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>NewsItemTitle</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">erben von </font></font><code>React.Component</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und </font></font><code>NewsItemBody</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- von </font></font><code>React.PureComponent</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
‚Üí </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vollst√§ndiger Beispielcode</font></font></a><br>
<br>
<pre><code class="plaintext hljs">export class NewsItemTitle extends React.Component<font></font>
export class NewsItemBody extends React.PureComponent</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So sieht das Protokoll nach einem Board-Update aus:</font></font><br>
<br>
<pre><code class="plaintext hljs">SCREEN<font></font>
ITEM_2<font></font>
ITEM_TITLE_2<font></font>
ITEM_BODY_2<font></font>
ITEM_1<font></font>
ITEM_TITLE_1<font></font>
ITEM_BODY_1<font></font>
--------------[ REFRESHING ]--------------<font></font>
SCREEN<font></font>
ITEM_3<font></font>
ITEM_TITLE_3<font></font>
ITEM_BODY_3<font></font>
ITEM_2<font></font>
ITEM_TITLE_2<font></font>
ITEM_1<font></font>
ITEM_TITLE_1</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sie k√∂nnen sehen, dass die Nachrichten- und √úberschriftenkomponenten neu gezeichnet werden. </font><font style="vertical-align: inherit;">Wir werden sie der Reihe nach betrachten. </font></font><br>
<br>
<code>NewsItem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">deklariert mit </font></font><code>connect</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Als Requisiten erh√§lt diese Komponente eine Kennung, √ºber die sie anschlie√üend Nachrichten erh√§lt in </font></font><code>mapStateToProps</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="plaintext hljs">const mapStateToProps = (state, ownProps) =&gt; ({<font></font>
  item: state.newsMap[ownProps.itemKey],<font></font>
});</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Da beim Aktualisieren der Karte alle Nachrichten erneut heruntergeladen werden, wird das Objekt </font></font><code>item</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aktualisiert und verweist anschlie√üend auf verschiedene Speicherzellen. Mit anderen Worten, es handelt sich um unterschiedliche Objekte, auch wenn alle enthaltenen Felder gleich sind. Daher wird ein Vergleich der vorherigen und der neuen State'ov-Komponente zur√ºckgegeben </font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Die Komponente wird neu gerendert, obwohl sich die Daten nicht ge√§ndert haben. </font></font><br>
<br>
<code>NewsItemTitle</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wird von geerbt </font></font><code>React.Component</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und wird daher jedes Mal neu gerendert, wenn die √ºbergeordnete Komponente gerendert wird. Dies geschieht unabh√§ngig von den Werten alter und neuer Requisiten. </font></font><br>
<br>
<code>NewsItemBody</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">geerbt von </font></font><code>React.PureComponent</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, so vergleicht es alte und neue Requisiten. In den Nachrichten 1 und 2 sind ihre Werte √§quivalent, daher wird die Komponente nur f√ºr Nachrichten 3 gerendert. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um die Renderings zu optimieren</font></font><code>NewsItemTitle</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">deklariere es einfach als </font></font><code>React.PureComponent</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Im Fall von m√ºssen Sie </font></font><code>NewsItem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">die Funktion neu definieren </font></font><code>shouldComponentUpdate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="plaintext hljs">shouldComponentUpdate(nextProps) {<font></font>
  return !shallowEqual(this.props.item, nextProps.item);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
‚Üí </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vollst√§ndiger Beispielcode</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Hier </font></font><code>shallowEqual</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ist eine Funktion zum Oberfl√§chenvergleich von Objekten, die Redux bereitstellt. </font><font style="vertical-align: inherit;">Sie k√∂nnen so schreiben:</font></font><br>
<br>
<pre><code class="plaintext hljs">shouldComponentUpdate(nextProps) {<font></font>
  return (<font></font>
    this.props.item.title !== nextProps.item.title ||<font></font>
    this.props.item.body !== nextProps.item.body<font></font>
  );<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So wird unser Protokoll danach aussehen: </font></font><br>
<br>
<pre><code class="plaintext hljs">SCREEN<font></font>
ITEM_2<font></font>
ITEM_TITLE_2<font></font>
ITEM_BODY_2<font></font>
ITEM_1<font></font>
ITEM_TITLE_1<font></font>
ITEM_BODY_1<font></font>
--------------[ REFRESHING ]--------------<font></font>
SCREEN<font></font>
ITEM_3<font></font>
ITEM_TITLE_3<font></font>
ITEM_BODY_3</code></pre><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hinweis</font></font></b><div class="spoiler_text"> <code>shouldComponentUpdate</code>  <code>NewsItem</code> ,  <code>NewsItemTitle</code>   .        . <code>NewsItemTitle</code>    -         <code>NewsItem</code>,     .<br>
</div></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">React.memo und Funktionskomponenten</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es ist </font></font><code>shouldComponentUpdate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nicht m√∂glich, eine Funktionskomponente zu </font><font style="vertical-align: inherit;">√ºberschreiben </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Dies bedeutet jedoch nicht, dass Sie eine Funktionskomponente zur Optimierung in eine Klasse 1 umschreiben m√ºssen. </font><font style="vertical-align: inherit;">In solchen F√§llen wird die </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Memo-</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Funktion </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">React.memo bereitgestellt</font></a><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Es akzeptiert eine Komponenteneingabe und eine optionale Vergleichsfunktion </font></font><code>areEqual</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Wenn es aufgerufen wird, </font></font><code>areEqual</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">erh√§lt es alte und neue Requisiten und sollte das Ergebnis des Vergleichs zur√ºckgeben. </font><font style="vertical-align: inherit;">Der Unterschied zu dem, </font></font><code>shouldComponentUpdate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">was zur√ºckkehren </font></font><code>areEqual</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sollte, </font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wenn die Requisiten gleich sind und nicht umgekehrt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beispielsweise kann das </font></font><code>NewsItemTitle</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Auswendiglernen folgenderma√üen aussehen:</font></font><br>
<br>
<pre><code class="plaintext hljs">areEqual(prevProps, nextProps) {<font></font>
  return shallowEqual(prevProps, nextProps);<font></font>
}<font></font>
export OptimizedNewsItemTitle = React.memo(NewsItemTitle, areEqual)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie nicht passieren </font></font><code>areEqual</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in </font></font><code>React.memo</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, dann ein oberfl√§chlicher Vergleich der Requisiten werden gemacht, so dass unser Beispiel vereinfacht werden kann:</font></font><br>
<br>
<pre><code class="plaintext hljs">export OptimizedNewsItemTitle = React.memo(NewsItemTitle)</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lambda funktioniert in Requisiten</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um Komponentenereignisse zu verarbeiten, k√∂nnen Funktionen an die Requisiten √ºbergeben werden. </font><font style="vertical-align: inherit;">Das auff√§lligste Beispiel ist die Implementierung </font></font><code>onPress</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Oft werden daf√ºr anonyme Lambda-Funktionen verwendet. </font><font style="vertical-align: inherit;">Angenommen, </font></font><code>NewsItemBody</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wir m√∂chten nur die Vorschau anzeigen, und wenn Sie darauf klicken, den gesamten Text. </font><font style="vertical-align: inherit;">Um dies zu tun </font></font><code>NewsItem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, werden </font></font><code>NewsItemBody</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wir </font><font style="vertical-align: inherit;">beim Rendern </font><font style="vertical-align: inherit;">die folgende Requisite √ºbergeben:</font></font><br>
<br>
<pre><code class="plaintext hljs">&lt;NewsItemBody<font></font>
  ...<font></font>
  onPress={() =&gt; this.props.expandBody()}<font></font>
  ...<font></font>
/&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hier ist , </font><font style="vertical-align: inherit;">was das Protokoll wie bei dieser Implementierung aussieht , </font><font style="vertical-align: inherit;">wenn das Verfahren </font></font><code>shouldComponentUpdate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wird </font></font><code>NewsItem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gestrichen:</font></font><br>
<br>
<pre><code class="plaintext hljs">SCREEN<font></font>
ITEM_2<font></font>
ITEM_TITLE_2<font></font>
ITEM_BODY_2<font></font>
ITEM_1<font></font>
ITEM_TITLE_1<font></font>
ITEM_BODY_1<font></font>
--------------[ REFRESHING ]--------------<font></font>
SCREEN<font></font>
ITEM_3<font></font>
ITEM_TITLE_3<font></font>
ITEM_BODY_3<font></font>
ITEM_2<font></font>
ITEM_TITLE_2<font></font>
ITEM_BODY_2<font></font>
ITEM_1<font></font>
ITEM_TITLE_1<font></font>
ITEM_BODY_1</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Nachrichtentexte 1 und 2 werden gerendert, obwohl sich ihre Daten nicht ge√§ndert haben, sondern </font></font><code>NewsItemBody</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sind </font></font><code>PureComponent</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Dies liegt daran, dass f√ºr jeden Render der </font></font><code>NewsItem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wert von Requisiten </font></font><code>onPress</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">neu erstellt wird. </font><font style="vertical-align: inherit;">Technisch gesehen zeigt es </font></font><code>onPress</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bei jedem Rendern auf einen neuen Bereich im Speicher, sodass ein oberfl√§chlicher Vergleich der Requisiten in </font></font><code>NewsItemBody</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">false zur√ºckgibt. </font><font style="vertical-align: inherit;">Das Problem wird durch den folgenden Eintrag behoben:</font></font><br>
<br>
<pre><code class="plaintext hljs">&lt;NewsItemBody<font></font>
  ...<font></font>
  onPress={this.props.expandBody}<font></font>
  ...<font></font>
/&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Log: </font></font><br>
<br>
<pre><code class="plaintext hljs">SCREEN<font></font>
ITEM_2<font></font>
ITEM_TITLE_2<font></font>
ITEM_BODY_2<font></font>
ITEM_1<font></font>
ITEM_TITLE_1<font></font>
ITEM_BODY_1<font></font>
--------------[ REFRESHING ]--------------<font></font>
SCREEN<font></font>
ITEM_3<font></font>
ITEM_TITLE_3<font></font>
ITEM_BODY_3<font></font>
ITEM_2<font></font>
ITEM_TITLE_2<font></font>
ITEM_1<font></font>
ITEM_TITLE_1</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
‚Üí </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vollst√§ndiger Beispielcode</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Leider kann eine anonyme Funktion keinesfalls immer als Methode oder Klassenfeld f√ºr einen solchen Datensatz umgeschrieben werden. Der h√§ufigste Fall ist, wenn innerhalb der Lambda-Funktion die Bereichsvariablen der Funktion verwendet werden, in der sie deklariert ist. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Betrachten Sie diesen Fall in unserem Beispiel. Um von der allgemeinen Liste zum Bildschirm einer Nachricht zu wechseln, f√ºgen wir die Verarbeitung des Klickens auf den Nachrichtentext hinzu. Die </font></font><code>renderItem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Komponentenmethode </font></font><code>FlatList</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sieht folgenderma√üen aus:</font></font><br>
<br>
<pre><code class="plaintext hljs">const renderItem = ({item}) =&gt; (<font></font>
  &lt;NewsItem<font></font>
    itemKey={item}<font></font>
    onBodyPress={() =&gt; this.onItemBodyPress(item)}<font></font>
  /&gt;<font></font>
);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eine anonyme Funktion </font></font><code>onBodyPress</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kann in einer Klasse nicht deklariert werden, da dann die Variable </font></font><code>item</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, die zum Aufrufen einer bestimmten Nachricht ben√∂tigt </font><font style="vertical-align: inherit;">wird, aus dem Bereich verschwindet </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die einfachste L√∂sung f√ºr das Problem besteht darin, die Signatur der </font></font><code>onBodyPress</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Komponenten- </font><font style="vertical-align: inherit;">Requisiten </font></font><code>NewsItem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">so </font><font style="vertical-align: inherit;">zu √§ndern </font><font style="vertical-align: inherit;">, dass der erforderliche Parameter beim Aufruf an die Funktion √ºbergeben wird. </font><font style="vertical-align: inherit;">In diesem Fall ist dies die Nachrichten-ID.</font></font><br>
<br>
<pre><code class="plaintext hljs">const renderItem = ({item}) =&gt; (<font></font>
  &lt;NewsItem<font></font>
    itemKey={item}<font></font>
    onBodyPress={item =&gt; this.onItemBodyPress(item)}<font></font>
  /&gt;<font></font>
);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In diesem Fall k√∂nnen wir die anonyme Funktion bereits in der Komponentenklassenmethode entfernen.</font></font><br>
<br>
<pre><code class="plaintext hljs">const renderItem = ({item}) =&gt; (<font></font>
  &lt;NewsItem<font></font>
    itemKey={item}<font></font>
    onBodyPress={this.onItemBodyPress}<font></font>
  /&gt;<font></font>
);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
F√ºr eine solche L√∂sung m√ºssen wir jedoch die Komponente √§ndern </font></font><code>NewsItem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<pre><code class="plaintext hljs">class NewsItemComponent extends React.Component {<font></font>
render() {<font></font>
  ...<font></font>
  return (<font></font>
      ...<font></font>
      &lt;NewsItemBody<font></font>
        ...<font></font>
        onPress={() =&gt; this.props.onBodyPress(this.props.item)}<font></font>
        ...<font></font>
      /&gt;<font></font>
      ...<font></font>
  );<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und wieder kehren wir zum angegebenen Problem zur√ºck - wir √ºbergeben der untergeordneten Komponente f√ºr jedes Rendering des √ºbergeordneten Elements eine neue Lambda-Funktion. </font><font style="vertical-align: inherit;">Erst jetzt sind wir ein Level gesunken. </font><font style="vertical-align: inherit;">Log:</font></font><br>
<br>
<pre><code class="plaintext hljs">SCREEN<font></font>
ITEM_2<font></font>
ITEM_TITLE_2<font></font>
ITEM_BODY_2<font></font>
ITEM_1<font></font>
ITEM_TITLE_1<font></font>
ITEM_BODY_1<font></font>
--------------[ REFRESHING ]--------------<font></font>
SCREEN<font></font>
ITEM_3<font></font>
ITEM_TITLE_3<font></font>
ITEM_BODY_3<font></font>
ITEM_2<font></font>
ITEM_TITLE_2<font></font>
ITEM_BODY_2<font></font>
ITEM_1<font></font>
ITEM_TITLE_1<font></font>
ITEM_BODY_1</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um dieses Problem im Stammverzeichnis zu beheben, k√∂nnen Sie den </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">useCallback-</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Hook verwenden </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Es erm√∂glicht das Speichern eines Funktionsaufrufs durch √úbergeben eines Arguments. </font><font style="vertical-align: inherit;">Wenn sich das Argument der Funktion nicht √§ndert, zeigt das Ergebnis des Aufrufs </font></font><code>useCallback</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">auf denselben Speicherbereich. </font><font style="vertical-align: inherit;">In unserem Beispiel bedeutet dies , </font><font style="vertical-align: inherit;">dass , </font><font style="vertical-align: inherit;">wenn die gleiche Nachricht neu zu </font><font style="vertical-align: inherit;">zeichnen, die prop </font></font><code>onPress</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Komponente </font></font><code>NewsItemBody</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wird sich </font><font style="vertical-align: inherit;">nicht √§ndern. </font><font style="vertical-align: inherit;">Haken k√∂nnen nur in Funktionskomponenten verwendet werden, daher sieht die Komponente </font></font><code>NewsItem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wie folgt aus:</font></font><br>
<br>
<pre><code class="plaintext hljs">function NewsItemComponent(props) {<font></font>
  ...<font></font>
  const {itemKey, onBodyPress} = props.item;<font></font>
  const onPressBody = useCallback(() =&gt; onBodyPress(itemKey), [itemKey, onBodyPress]);<font></font>
  return (<font></font>
    &lt;View&gt;<font></font>
      ...<font></font>
      &lt;NewsItemBody<font></font>
        ...<font></font>
        onPress={onPressBody}<font></font>
        ...<font></font>
      /&gt;<font></font>
    &lt;/View&gt;<font></font>
  );<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und das Protokoll: </font></font><br>
<br>
<pre><code class="plaintext hljs">SCREEN<font></font>
ITEM_2<font></font>
ITEM_TITLE_2<font></font>
ITEM_BODY_2<font></font>
ITEM_1<font></font>
ITEM_TITLE_1<font></font>
ITEM_BODY_1<font></font>
--------------[ REFRESHING ]--------------<font></font>
SCREEN<font></font>
ITEM_3<font></font>
ITEM_TITLE_3<font></font>
ITEM_BODY_3<font></font>
ITEM_2<font></font>
ITEM_TITLE_2<font></font>
ITEM_1<font></font>
ITEM_TITLE_1</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
‚Üí </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vollst√§ndiger Beispielcode</font></font></a><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Arrays und Objekte</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In JavaScript werden Funktionen zusammen mit Arrays als Objekte dargestellt. </font><font style="vertical-align: inherit;">Daher ist das Beispiel aus dem vorherigen Block ein Sonderfall zum Erstellen eines neuen Objekts in Requisiten. </font><font style="vertical-align: inherit;">Es ist ziemlich h√§ufig, deshalb habe ich es in einen separaten Absatz eingef√ºgt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jede Erstellung neuer Funktionen, Arrays oder Objekte in Requisiten f√ºhrt zu einem Komponenten-Renderer. </font><font style="vertical-align: inherit;">Betrachten Sie diese Regel im folgenden Beispiel. </font><font style="vertical-align: inherit;">Lassen Sie uns einen </font></font><code>NewsItemBody</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kombinierten Stil aus zwei Werten √ºbergeben:</font></font><br>
<br>
<pre><code class="plaintext hljs">&lt;NewsItemBody<font></font>
  ...<font></font>
  style={[styles.body, styles.item]}<font></font>
  ...<font></font>
/&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Protokoll zeigt erneut die zus√§tzlichen Komponentenrenderer:</font></font><br>
<br>
<pre><code class="plaintext hljs">SCREEN<font></font>
ITEM_2<font></font>
ITEM_TITLE_2<font></font>
ITEM_BODY_2<font></font>
ITEM_1<font></font>
ITEM_TITLE_1<font></font>
ITEM_BODY_1<font></font>
--------------[ REFRESHING ]--------------<font></font>
SCREEN<font></font>
ITEM_3<font></font>
ITEM_TITLE_3<font></font>
ITEM_BODY_3<font></font>
ITEM_2<font></font>
ITEM_TITLE_2<font></font>
ITEM_BODY_2<font></font>
ITEM_1<font></font>
ITEM_TITLE_1<font></font>
ITEM_BODY_1</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um dieses Problem zu l√∂sen, k√∂nnen Sie einen separaten Stil ausw√§hlen </font><font style="vertical-align: inherit;">, der die Deklaration des Arrays </font><font style="vertical-align: inherit;">kombiniert </font></font><code>body</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und </font></font><code>item</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">beispielsweise </font></font><code>[styles.body, styles.item]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in eine globale Variable verschiebt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
‚Üí </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vollst√§ndiger Beispielcode</font></font></a><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Array-Reduzierungen</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Betrachten Sie eine weitere beliebte Quelle f√ºr ‚ÄûBremsen‚Äú, die mit der Verwendung verbunden sind </font></font><code>FlatList</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Eine klassische Anwendung, die eine lange Liste von Elementen vom Server enth√§lt, implementiert die Paginierung. </font><font style="vertical-align: inherit;">Das hei√üt, es wird eine begrenzte Anzahl von Elementen in Form der ersten Seite geladen. Wenn die Liste der aktuellen Elemente endet, wird die n√§chste Seite geladen und so weiter. </font><font style="vertical-align: inherit;">Ein Reduzierer der Artikelliste k√∂nnte folgenderma√üen aussehen:</font></font><br>
<br>
<pre><code class="plaintext hljs">const newsIdList = (state = [], action) =&gt; {<font></font>
  if (action.type === 'GOT_NEWS') {<font></font>
    return action.news.map(item =&gt; item.key);<font></font>
  } else if (action.type === 'GOT_OLDER_NEWS') {<font></font>
    return [...state, ...action.news.map(item =&gt; item.key)];<font></font>
  }<font></font>
  return state;<font></font>
};</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn jede n√§chste Seite im Stil der Anwendung geladen wird, wird ein neues Array von Bezeichnern erstellt. </font><font style="vertical-align: inherit;">Wenn wir dieses Array sp√§ter </font></font><code>FlatList</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">an </font><font style="vertical-align: inherit;">Requisiten </font><font style="vertical-align: inherit;">√ºbergeben, sehen die Komponenten-Renderprotokolle folgenderma√üen aus:</font></font><br>
<br>
<pre><code class="plaintext hljs">SCREEN<font></font>
ITEM_&lt;1..10&gt;<font></font>
--------------[ LOADING NEXT PAGE ]--------------<font></font>
SCREEN<font></font>
ITEM_&lt;1..10&gt;<font></font>
ITEM_&lt;1..20&gt;<font></font>
--------------[ LOADING NEXT PAGE ]--------------<font></font>
SCREEN<font></font>
ITEM_&lt;1..20&gt;<font></font>
ITEM_&lt;1..30&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In diesem Beispiel habe ich einige √Ñnderungen an der Testanwendung vorgenommen.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Stellen Sie die Seitengr√∂√üe auf 10 Nachrichten ein.</font></font></li>
<li>   <code>item</code>   <code>NewsItem</code>  <code>FlatList</code>-,        connect. <code>NewsItem</code>    <code>React.Component</code>    .</li>
<li>     .</li>
<li>       .       ‚Ññ1     .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Beispiel zeigt, dass beim Laden jeder n√§chsten Seite alle alten Elemente erneut gerendert werden und die alten Elemente und die Elemente der neuen Seite erneut gerendert werden. F√ºr Mathematikliebhaber: Wenn die Seitengr√∂√üe gleich ist </font></font><code>X</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, werden beim Laden der </font></font><code>i</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i-ten Seite </font></font><code>X</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">die Elemente gerendert </font><font style="vertical-align: inherit;">, </font><font style="vertical-align: inherit;">anstatt nur </font><font style="vertical-align: inherit;">neue Elemente zu </font><font style="vertical-align: inherit;">rendern </font></font><code>(i - 1) * X + i * X</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
‚ÄûOk‚Äú, sagen Sie, ‚Äûich verstehe, warum alle Elemente nach dem Hinzuf√ºgen einer neuen Seite gezeichnet werden: Der Reduzierer hat ein neues Array zur√ºckgegeben, einen neuen Speicherbereich, all das. Aber warum m√ºssen wir die alte Liste rendern, bevor wir neue Elemente hinzuf√ºgen? ‚Äú "Gute Frage", werde ich Ihnen antworten. Dies ist eine Folge der Arbeit mit dem Zustand der Komponente, </font></font><code>VirtualizedList</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">auf deren Basis</font></font><code>FlatList</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Ich werde nicht auf Details eingehen, da sie auf einen separaten Artikel zur√ºckgreifen. </font><font style="vertical-align: inherit;">Wen k√ºmmert es, ich rate Ihnen, sich mit der </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dokumentation</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und der Quelle </font><font style="vertical-align: inherit;">zu befassen </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie kann man eine solche Nichtoptimalit√§t loswerden? </font><font style="vertical-align: inherit;">Wir schreiben den Reduzierer neu, damit er nicht f√ºr jede Seite ein neues Array zur√ºckgibt, sondern dem vorhandenen Elemente hinzuf√ºgt:</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beachtung! </font><font style="vertical-align: inherit;">Antipattern!</font></font></b><div class="spoiler_text">          .     ,    , ,  <code>PureComponent</code>,          .      ,             .      .     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"> Redux</a>.<br>
</div></div><br>
<pre><code class="plaintext hljs">const newsIdList = (state = [], action) =&gt; {<font></font>
  if (action.type === 'GOT_NEWS') {<font></font>
    return action.news.map(item =&gt; item.key);<font></font>
  } else if (action.type === 'GOT_OLDER_NEWS') {<font></font>
    action.news.forEach(item =&gt; state.push(item.key));<font></font>
    return state;<font></font>
    // return [...state, ...action.news.map(item =&gt; item.key)];<font></font>
  }<font></font>
  return state;<font></font>
};</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Danach sieht unser Protokoll folgenderma√üen aus:</font></font><br>
<br>
<pre><code class="plaintext hljs">SCREEN<font></font>
ITEM_&lt;1..10&gt;<font></font>
--------------[ LOADING NEXT PAGE ]--------------<font></font>
SCREEN<font></font>
ITEM_&lt;1..20&gt;<font></font>
--------------[ LOADING NEXT PAGE ]--------------<font></font>
SCREEN<font></font>
ITEM_&lt;1..30&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben das Rendern alter Elemente </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vor dem</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Hinzuf√ºgen von Elementen zu einer neuen Seite entfernt, aber alte Elemente werden </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nach dem</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Aktualisieren der Liste </font><font style="vertical-align: inherit;">immer noch gezeichnet </font><font style="vertical-align: inherit;">. Die Anzahl der Renderings f√ºr die n√§chste Seite ist jetzt gleich </font></font><code>i * X</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Die Formel ist einfacher geworden, aber wir werden hier nicht aufh√∂ren. Wir haben nur </font></font><code>X</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">neue Elemente und wir wollen nur </font></font><code>X</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">neue Renderings. Wir werden die bereits bekannten Tricks verwenden, um Nachrichten-Renderings zu entfernen, bei denen die Requisiten nicht ge√§ndert wurden. Zur√ºck verbinden mit </font></font><code>NewsItem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="plaintext hljs">SCREEN<font></font>
ITEM_&lt;1..10&gt;<font></font>
--------------[ LOADING NEXT PAGE ]--------------<font></font>
SCREEN<font></font>
ITEM_&lt;11..20&gt;<font></font>
--------------[ LOADING NEXT PAGE ]--------------<font></font>
SCREEN<font></font>
ITEM_&lt;21..30&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fein! Jetzt k√∂nnen wir mit uns selbst zufrieden sein. Es gibt keinen Ort zur Optimierung. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
‚Üí </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vollst√§ndiger Beispielcode</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Ein aufmerksamer Leser zeigt an, dass es nach dem Anwenden der Verbindung zum </font></font><code>NewsItem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Protokoll wie im letzten Beispiel aussieht, unabh√§ngig davon, wie Sie den Reduzierer implementieren. Und es wird richtig sein - wenn die Nachrichtenkomponente ihre Requisiten vor dem Rendern √ºberpr√ºft, spielt es keine Rolle, ob das alte Array vom Reduzierer verwendet wird oder ein neues erstellt. Es werden nur neue Elemente gezeichnet und nur einmal. Um </font><font style="vertical-align: inherit;">jedoch das alte Array zu </font><font style="vertical-align: inherit;">√§ndern , </font><font style="vertical-align: inherit;">anstatt einen neuen zu erstellen erspart uns unn√∂tigen Renderings der Komponente </font></font><code>FlatList</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">darin verwendet </font></font><code>VirtualizedList</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und unn√∂tige Wiederholungen von Requisiten √Ñquivalenzpr√ºfungen </font></font><code>NewsItem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Dies f√ºhrt bei einer Vielzahl von Elementen auch zu einer Leistungssteigerung.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Verwendung von ver√§nderlichen Arrays und Objekten in Reduzierst√ºcken sollte mit √§u√üerster Vorsicht erfolgen. </font><font style="vertical-align: inherit;">In diesem Beispiel ist dies gerechtfertigt. Wenn Sie jedoch beispielsweise normal </font></font><code>PureComponent</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sind, werden die Komponenten beim Hinzuf√ºgen von Elementen zum ver√§nderlichen Array nicht gerendert. </font><font style="vertical-align: inherit;">Die Requisiten bleiben in der Tat unver√§ndert, da vor und nach der Aktualisierung des Arrays auf denselben Speicherbereich verweist. </font><font style="vertical-align: inherit;">Dies kann zu unerwarteten Folgen f√ºhren. </font><font style="vertical-align: inherit;">Kein Wunder, dass das beschriebene Beispiel die </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prinzipien von Redux</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> verletzt </font><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Und etwas anderes...</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie Bibliotheken auf Pr√§sentationsebene verwenden, empfehle ich Ihnen, sicherzustellen, dass Sie genau verstehen, wie sie implementiert werden. </font><font style="vertical-align: inherit;">In unserer Anwendung verwenden wir eine Komponente </font></font><code>Swipeable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aus der Bibliothek </font></font><code>react-native-gesture-handler</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Sie k√∂nnen einen Block zus√§tzlicher Aktionen implementieren, wenn Sie eine Karte aus der Liste ziehen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im Code sieht es so aus:</font></font><br>
<br>
<pre><code class="plaintext hljs">&lt;Swipeable<font></font>
  ...<font></font>
  renderRightActions={this.renderRightActions}<font></font>
  ...<font></font>
&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Methode </font></font><code>renderRightActions</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">oder </font></font><code>renderLeftActions</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gibt die Komponente zur√ºck, die nach dem Wischen angezeigt wird. Wir haben die H√∂he der Platte w√§hrend des Komponentenwechsels ermittelt und ge√§ndert, um sie an den erforderlichen Inhalt anzupassen. Dies ist ein ressourcenintensiver Prozess. Wenn er jedoch w√§hrend der Wischanimation auftritt, sieht der Benutzer keine Interferenzen.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/wz/n1/vg/wzn1vghiy6-wjclqcy8itdy1fns.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Problem ist, dass die Komponente </font></font><code>Swipeable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">die Methode </font></font><code>renderRightActions</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zum Zeitpunkt des Renderns der </font><font style="vertical-align: inherit;">Hauptkomponente </font><font style="vertical-align: inherit;">aufruft </font><font style="vertical-align: inherit;">. Alle Berechnungen und sogar das Rendern der Aktionsleiste, die vor dem Wischen nicht sichtbar sind, erfolgen im Voraus. Alle diese Aktionen werden also f√ºr alle Karten in der Liste gleichzeitig ausgef√ºhrt. Dies verursachte beim Scrollen des Boards erhebliche ‚ÄûBremsen‚Äú. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Problem wurde folgenderma√üen gel√∂st. Wenn das Aktionsfenster zusammen mit der Hauptkomponente und nicht als Ergebnis des Wischens gezeichnet wird, gibt die Methode </font></font><code>renderRightActions</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">eine leere in der </font></font><code>View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gr√∂√üe der Hauptkomponente zur√ºck. Ansonsten zeichnen wir das Panel mit zus√§tzlichen Aktionen wie zuvor.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich gebe dieses Beispiel, weil unterst√ºtzende Bibliotheken nicht immer wie erwartet funktionieren. </font><font style="vertical-align: inherit;">Wenn es sich um Bibliotheken auf Pr√§sentationsebene handelt, sollten Sie sicherstellen, dass keine unn√∂tigen Ressourcen verschwendet werden.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ergebnisse</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nachdem wir die im Artikel beschriebenen Probleme beseitigt hatten, haben wir die Anwendung auf React Native erheblich beschleunigt. </font><font style="vertical-align: inherit;">Jetzt ist es schwierig, die Leistung von einer √§hnlichen zu unterscheiden, die nativ implementiert wurde. </font><font style="vertical-align: inherit;">√úbersch√ºssiges Rendern verlangsamte sowohl das Laden einzelner Bildschirme als auch die Reaktion auf Benutzeraktionen. </font><font style="vertical-align: inherit;">Vor allem auf den Listen, auf denen Dutzende von Komponenten gleichzeitig gezeichnet werden, fiel dies auf. </font><font style="vertical-align: inherit;">Wir haben nicht alles optimiert, aber die Hauptbildschirme der Anwendung werden nicht l√§nger langsamer. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Hauptpunkte des Artikels sind nachstehend kurz aufgef√ºhrt.</font></font><br>
<br>
<ol>
<li> React Native      :  Props/State-     .</li>
<li>,   <code>React.PureComponent</code>,     ,       .</li>
<li>    ,    <code>shouldComponentUpdate</code>      <code>React.Memo</code>   .</li>
<li>-        .      ,         (shallow compare).               ,     .</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Unterst√ºtzung von Bibliotheken auf Pr√§sentationsebene kann zu unerwarteter Verschwendung von Ressourcen f√ºhren. </font><font style="vertical-align: inherit;">Es lohnt sich, bei der Anwendung vorsichtig zu sein.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das ist alles. </font><font style="vertical-align: inherit;">Ich hoffe, Sie finden die Informationen hilfreich. </font><font style="vertical-align: inherit;">Ich freue mich √ºber jedes Feedback!</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N√ºtzliche Quellen</font></font></h2><br>
<ol>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Grundlegendes zum Rendern in React + Redux</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Objekte in JavaScript vergleichen</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Verbessern der Leistung in reaktiven Funktionskomponenten mit React.memo ()</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wie Discord mit React Native eine native iOS-Leistung erzielt</font></font></a></li>
</ol></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de492374/index.html">Experiment: Redux aus der OOP-Welt</a></li>
<li><a href="../de492376/index.html">So machen Sie Ihren Artikel oder Ihre Dokumentation schnell und genau verst√§ndlich</a></li>
<li><a href="../de492378/index.html">Reactjs, Material-UI mit JSS. Kurzanleitung</a></li>
<li><a href="../de492384/index.html">Hack The Box - Postbote Walkthrough Redis und WebMin</a></li>
<li><a href="../de492386/index.html">Wie der IT-Sektor der Welt hilft, weniger Lebensmittel zu werfen</a></li>
<li><a href="../de492398/index.html">Wir konfigurieren unsere Ger√§te f√ºr Remote-Arbeit, Podcasting, Video und Streaming</a></li>
<li><a href="../de492404/index.html">Flattern + Arduino Nano 33 BLE sense = sehr einfacher BLE Sensor</a></li>
<li><a href="../de492406/index.html">Podcasts f√ºr den Geek: einige bew√§hrte Programme zu Projektmanagement, Technologieanalyse und GTD</a></li>
<li><a href="../de492408/index.html">Die Besucherzahlen f√ºr Yandex-Desktops sind gesunken: Was ist im Jahr 2019 passiert und wie wird es sich im Jahr 2020 auswirken?</a></li>
<li><a href="../de492410/index.html">C ++ ist schneller und sicherer als Rust, Yandex hat Messungen durchgef√ºhrt</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>