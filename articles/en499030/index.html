<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üè¥Û†ÅßÛ†Å¢Û†Å∑Û†Å¨Û†Å≥Û†Åø üî§ ‚öúÔ∏è Monitoring MySQL performance for Grafana on isic in 20 minutes üë©üèª‚Äçüéì üè¥‚Äç‚ò†Ô∏è üóª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello, dear habryanin and another recipe for this tasty and healthy monitoring! 
 
 My name is Mikhail Andrianov and I have been working as a Technica...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Monitoring MySQL performance for Grafana on isic in 20 minutes</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/499030/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hello, dear habryanin and another recipe for this tasty and healthy monitoring! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
My name is Mikhail Andrianov and I have been working as a Technical Director for 7 years at Emarsys. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We often work with client and our databases, so we often need to watch them so that our clients and we can live and work peacefully.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And so the idea was born to me to share with you a recipe for deploying a monitoring system that is quite common in the world of MySQL. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Here's how roughly this beauty might look: </font></font><br>
<br>
<img src="http://suite16.emarsys.net/custloads/765018014/md_894868.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
All Dashboards are already included in the recipe, and you don‚Äôt have to sculpt them. </font><font style="vertical-align: inherit;">In fact, you just need to configure everything correctly and plunge headlong into the world of chic graphs and tables. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So, for preparation we need: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mysql&gt; 5.6 (you can do it even younger, but have to fix something in the queries) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Grafana&gt; 6.7.1 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ubuntu / MS Windows to your taste</font></font><br>
<br>
<hr><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Stage one</font></font></h3><br>
 <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We set up the log storage base.</font></font></b> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
The basis of the service base I included a convenient and easy-to-prepare </font></font><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">my2Collector</font></font></a> </b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> from the master of Italian </font><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;">MeSql</font></a></b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"> Meo</font></a><font style="vertical-align: inherit;"> cuisine</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"></font></a><br>
<br>
<pre><code class="bash hljs">mysql --user=root -pXXX &lt; my2.sql
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
* I will use the commands of my beloved Ubuntu 16. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">You can‚Äôt give the user my2 admin rights - it will be seen later that this can get you sideways.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
When the database is out of the dump, I recommend that you familiarize yourself with the procedures that update the data in it. </font><font style="vertical-align: inherit;">In particular, the procedure</font></font><br>
<br>
<pre><code class="plaintext hljs"> `collect_stats`()</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It is advisable to increase the frequency of the request to 5 minutes. </font><font style="vertical-align: inherit;">So you will have more relevant data on the state of the database. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now that the statistics collection engine is running, you can move on to connecting this source to Grafana.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Stage Two</font></font></h3><br>
 <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We connect Grafana to the database with logs.</font></font></b> <br>
<br>
<img src="https://suite16.emarsys.net/custloads/765018014/md_894879.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Everything is standard. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Choose </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL Data Source</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Next ... </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
URL, user, password </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
** </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">You can see that the user we use to collect logs and restrict only read access performance.schema and write to my2 database, we use the same in Grafana </font><font style="vertical-align: inherit;">So you can avoid compromising your base if you lose access to Grafana.</font></font><br>
</i><br>
<br>
<hr><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Stage Three</font></font></h3><br>
 <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configuring Dashboards</font></font></b> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
I deliberately chose the fastest and most convenient way to configure, so as not to be patient. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Again, turn to Meo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
His dashboard is called </font></font><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2MySQL Simple Dashboard.</font></font></a></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
The most convenient way to set dashboards in Grafana is, of course, import the JSON settings object. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To complete this straightforward step:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Download </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;">JSON</font></a><font style="vertical-align: inherit;"> itself</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"></font></a> </li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Let's go into the management of dashboards Dashaboards -&gt; Manage</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Select Import and load the object from the downloaded file.</font></font></li>
</ol><br>
<img src="http://suite16.emarsys.net/custloads/765018014/md_894885.png" alt="image"><br>
<br>
<img src="http://suite16.emarsys.net/custloads/765018014/md_894886.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now we have a ready-made beautiful panel with very efficient data visualizations. </font></font><br>
<br>
<hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The flexibility of Grafana makes it possible to conveniently modify each panel, and the built-in variables in 2MySQL Simple Dashboard help to immediately adjust the panels to those users and processes that may be most interesting, for example, to track specific database users on separate panels or dashboards. </font></font><br>
<br>
<img src="http://suite16.emarsys.net/custloads/765018014/md_894897.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The next step is to set up alerts for the created dashboard. </font><font style="vertical-align: inherit;">I will omit this process, leaving it to the discretion of everyone who decides to go along the described path. </font><font style="vertical-align: inherit;">All alerts are configured at the level of each specific panel. </font></font><br>
<br>
<img src="http://suite16.emarsys.net/custloads/765018014/md_894898.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As promised, the deployment takes place quite quickly and without dancing with a tambourine. </font><font style="vertical-align: inherit;">I will be glad to additions to my recipe from experienced habrovtsev, especially regarding alerts'ov.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en499010/index.html">We study the Mediastreamer2 VoIP engine. Part 11</a></li>
<li><a href="../en499014/index.html">23 difficult questions for JavaScript interviews</a></li>
<li><a href="../en499016/index.html">Integration with ESIA for .Net: easier than it sounds</a></li>
<li><a href="../en499018/index.html">6 home sports apps</a></li>
<li><a href="../en499020/index.html">A study of one vague behavior</a></li>
<li><a href="../en499032/index.html">How to use Prometheus to detect anomalies in GitLab</a></li>
<li><a href="../en499034/index.html">How to roll out dangerous refactoring to prod with a million users?</a></li>
<li><a href="../en499036/index.html">Provider's work: a selection of materials on protocols, IT and network infrastructure</a></li>
<li><a href="../en499038/index.html">My experience using a vertical monitor</a></li>
<li><a href="../en499040/index.html">Read on the weekend: a selection of materials on the history of DNS, IT regulation and hardware 1cloud.ru</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>