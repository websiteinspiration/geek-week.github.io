<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🎸 🙌🏿 🧓🏻 Pythonを使用してフィスカルプリンターでゲームオブスローンズのタペストリーを印刷する 🚕 🔄 👩🏿‍🏫</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="かつて、プロジェクトの1つで、フィスカルプリンターが私の手に落ちました。毎日店舗で支払いをするときにこれらのデバイスに出会いますが、実際に何であるかを理解する人はほとんどいません。私は彼らの仕事の詳細には触れません。これらは特別な感熱紙に購入データが入ったレシートを印刷するものです（そうです、ほとん...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Pythonを使用してフィスカルプリンターでゲームオブスローンズのタペストリーを印刷する</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/465485/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">かつて、プロジェクトの1つで、フィスカルプリンターが私の手に落ちました。毎日店舗で支払いをするときにこれらのデバイスに出会いますが、実際に何であるかを理解する人はほとんどいません。私は彼らの仕事の詳細には触れません。これらは特別な感熱紙に購入データが入ったレシートを印刷するものです（そうです、ほとんどすべてのフィスカルプリンターにはインクがありません！）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
フィスカルプリンターの機能状態と内部設定をどうやって取得するかを考えなければなりませんでした。タスクは長い間完了しており、フィスカルプリンターは遠くの隅に長い間置き去りにされていました...アイデアがいくつかの仕事をするために私の頭に浮かぶまで：D</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このようなプリンタを使用すると、モノクロ画像を印刷できます。</font><font style="vertical-align: inherit;">シール、エンブレム、同僚の写真のプリントが十分にあるときに</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、「冬は近い」という言葉で誰かを絶えず殺したシリーズに基づい</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">た</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">長いタペストリーの</font></a><font style="vertical-align: inherit;">プリントに手を</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">振ることにしました</font></a><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
出力はそのようなビデオでした：</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/D2Nch_KXD4U" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下の猫の下の</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">python</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で</font><font style="vertical-align: inherit;">
タペストリーを印刷するための詳細な手順</font><font style="vertical-align: inherit;">。</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この記事では、出力がいくつかの実用的なスキルを持つトレーニング記事であると仮定して、詳細なコメントを付けて手順を簡単に説明します。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">YouTubeからタペストリービデオをダウンロード</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フィスカルプリンターで印刷するための長いモノクロのタペストリー画像を作成する</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フィスカルプリンターに接続する</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会計プリンターでタペストリーを印刷する</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結果のビデオクリップをソーシャルネットワークで公開するためにマウントします</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">YouTubeからタペストリーのビデオをダウンロードする</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pytube</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ライブラリを使用して非常に簡単に行われ</font><font style="vertical-align: inherit;">ます。ダウンロードするビデオストリームのインデックスを特定するだけです。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">YouTubeからビデオをダウンロードするための機能：</font></font></b><div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword">import</span> time, pytube<font></font>
<font></font>
<span class="hljs-comment">#        </span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">load_bmp_from_video</span>(<span class="hljs-params">video_url, filename</span>):</span><font></font>
    t1 = time.clock()<font></font>
<font></font>
    <span class="hljs-comment">#    </span><font></font>
    video = pytube.YouTube(video_url)<font></font>
<font></font>
    <span class="hljs-comment">#       </span><font></font>
    streams = video.streams.all()<font></font>
    <span class="hljs-keyword">for</span> stream <span class="hljs-keyword">in</span> streams: print(stream)<font></font>
<font></font>
    <span class="hljs-comment">#       ,  18: 360p mp4</span>
    video.streams.get_by_itag(<span class="hljs-number">18</span>).download(<span class="hljs-string">"./"</span>, filename = filename )<font></font>
    t2 = time.clock()<font></font>
<font></font>
    <span class="hljs-comment">#     </span>
    print(<span class="hljs-string">'download done'</span>, t2-t1)<font></font>
<font></font>
<span class="hljs-comment">#       got.mp4   360x640</span>
load_bmp_from_video(video_url = <span class="hljs-string">'https://www.youtube.com/watch?v=aZV4PclhHeA&amp;'</span>, <font></font>
                     filename = <span class="hljs-string">'got'</span>)
</code></pre><br>
   <code>for stream in streams: print(stream)</code>       ,   :<br>
<br>
<pre>&lt;Stream: itag="22" mime_type="video/mp4" res="720p" fps="30fps" vcodec="avc1.64001F" acodec="mp4a.40.2"&gt;<font></font>
&lt;Stream: itag="43" mime_type="video/webm" res="360p" fps="30fps" vcodec="vp8.0" acodec="vorbis"&gt;<font></font>
&lt;Stream: itag="18" mime_type="video/mp4" res="360p" fps="30fps" vcodec="avc1.42001E" acodec="mp4a.40.2"&gt;<font></font>
&lt;Stream: itag="137" mime_type="video/mp4" res="1080p" fps="30fps" vcodec="avc1.640028"&gt;<font></font>
&lt;Stream: itag="248" mime_type="video/webm" res="1080p" fps="30fps" vcodec="vp9"&gt;<font></font>
&lt;Stream: itag="136" mime_type="video/mp4" res="720p" fps="30fps" vcodec="avc1.4d401f"&gt;<font></font>
&lt;Stream: itag="247" mime_type="video/webm" res="720p" fps="30fps" vcodec="vp9"&gt;<font></font>
&lt;Stream: itag="135" mime_type="video/mp4" res="480p" fps="30fps" vcodec="avc1.4d401e"&gt;<font></font>
&lt;Stream: itag="244" mime_type="video/webm" res="480p" fps="30fps" vcodec="vp9"&gt;<font></font>
&lt;Stream: itag="134" mime_type="video/mp4" res="360p" fps="30fps" vcodec="avc1.4d401e"&gt;<font></font>
&lt;Stream: itag="243" mime_type="video/webm" res="360p" fps="30fps" vcodec="vp9"&gt;<font></font>
&lt;Stream: itag="133" mime_type="video/mp4" res="240p" fps="30fps" vcodec="avc1.4d4015"&gt;<font></font>
&lt;Stream: itag="242" mime_type="video/webm" res="240p" fps="30fps" vcodec="vp9"&gt;<font></font>
&lt;Stream: itag="160" mime_type="video/mp4" res="144p" fps="30fps" vcodec="avc1.4d400c"&gt;<font></font>
&lt;Stream: itag="278" mime_type="video/webm" res="144p" fps="30fps" vcodec="vp9"&gt;<font></font>
&lt;Stream: itag="140" mime_type="audio/mp4" abr="128kbps" acodec="mp4a.40.2"&gt;<font></font>
&lt;Stream: itag="249" mime_type="audio/webm" abr="50kbps" acodec="opus"&gt;<font></font>
&lt;Stream: itag="250" mime_type="audio/webm" abr="70kbps" acodec="opus"&gt;<font></font>
&lt;Stream: itag="251" mime_type="audio/webm" abr="160kbps" acodec="opus"&gt;<font></font>
</pre><br>
     18 ..    —        ,    ))<br>
</div></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フィスカルプリンターで印刷するための長いモノクロのタペストリー画像を作成する</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ビデオ処理には、よく知られている</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OpenCV</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ライブラリと</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pillow（PILの最新フォーク）が必要です</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（ただし、ここではOpenCVの代わりに</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">libav</font></a><font style="vertical-align: inherit;">ツールの</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">avconv</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ユーティリティ</font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">使用でき</font><font style="vertical-align: inherit;">ます</font><font style="vertical-align: inherit;">。詳細については、この記事の最後のセクションで説明します）。</font><font style="vertical-align: inherit;">PIPを介してインストールされ、OpenCV自体をインストールする必要がないpythonホイールである</font><font style="vertical-align: inherit;">pythonまたは</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">python-opencv</font></a><font style="vertical-align: inherit;">を作成してくれた作者に感謝し</font><font style="vertical-align: inherit;">ます（</font><b><font style="vertical-align: inherit;">フーレイ！</font></b><font style="vertical-align: inherit;">）。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
フィスカルプリンターは、特殊な画像のみを印刷できます-528ピクセルの固定幅のモノクロbmpファイル（長さは無制限ですが、ho-ho-ho！）。</font><font style="vertical-align: inherit;">さらに、ビデオクリップのタペストリー画像は常に動いているので、フレームを慎重にカットして、1つの長い画像を取得する必要があります。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">これはすべて、次の関数によって行われます。</font></font></b><div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword">import</span> os, cv2, numpy <span class="hljs-keyword">as</span> np
<span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Image <font></font>
<font></font>
<span class="hljs-comment">#           </span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">save_frames_from_vide</span>(<span class="hljs-params">filename</span>):</span><font></font>
    <font></font>
    <span class="hljs-comment">#         </span>
    real_filename = filename.rsplit(<span class="hljs-string">'.'</span>, <span class="hljs-number">1</span>)[<span class="hljs-number">0</span>]<font></font>
    <font></font>
    <span class="hljs-comment">#        </span>
    <span class="hljs-keyword">for</span> file <span class="hljs-keyword">in</span> os.listdir(<span class="hljs-string">'./'</span>): 
        <span class="hljs-keyword">if</span> file.startswith(<span class="hljs-string">'frame'</span>):<font></font>
            os.remove(<span class="hljs-string">'./'</span> + file)<font></font>
    <font></font>
    <span class="hljs-comment">#        </span><font></font>
    frames_list = []<font></font>
    vidcap = cv2.VideoCapture(filename)<font></font>
    <span class="hljs-keyword">try</span>:<font></font>
        success, frame = vidcap.read()<font></font>
        count = <span class="hljs-number">1</span>
        <span class="hljs-keyword">while</span> success: <span class="hljs-comment"># and count &lt; 500: #   </span>
             <span class="hljs-comment">#     1  100,    </span>
            <span class="hljs-keyword">if</span> count <span class="hljs-keyword">in</span> [<span class="hljs-number">1</span>, <span class="hljs-number">100</span>, <span class="hljs-number">30945</span>, <span class="hljs-number">31000</span>] <span class="hljs-keyword">or</span> count % <span class="hljs-number">370</span> == <span class="hljs-number">0</span>: 
                <span class="hljs-comment">#      (  )</span><font></font>
                mono_frame = frame<font></font>
                <span class="hljs-keyword">if</span> count == <span class="hljs-number">370</span>:<font></font>
                    mono_frame = mono_frame[<span class="hljs-number">0</span>:mono_frame.shape[<span class="hljs-number">0</span>], 
                                            <span class="hljs-number">172</span>:mono_frame.shape[<span class="hljs-number">1</span>]]
                <span class="hljs-keyword">if</span> count == <span class="hljs-number">30710</span>:<font></font>
                    mono_frame = mono_frame[<span class="hljs-number">0</span>:mono_frame.shape[<span class="hljs-number">0</span>], 
                                            <span class="hljs-number">0</span>:mono_frame.shape[<span class="hljs-number">1</span>] - <span class="hljs-number">200</span>]<font></font>
                mono_frame = mono_frame[<span class="hljs-number">20</span>:<span class="hljs-number">-20</span>, :]<font></font>
                frames_list.append(mono_frame)<font></font>
                print(<span class="hljs-string">'read a new frame: '</span>, success, count)<font></font>
            success, frame = vidcap.read()<font></font>
            count += <span class="hljs-number">1</span>
    <span class="hljs-keyword">finally</span>: vidcap.release()<font></font>
<font></font>
    <span class="hljs-comment">#    </span>
    gobelin = np.concatenate((frames_list), axis = <span class="hljs-number">1</span>)<font></font>
    <font></font>
    <span class="hljs-comment">#   -   </span>
    cv2.imwrite(<span class="hljs-string">'%s.png'</span> % real_filename, gobelin)<font></font>
    <font></font>
    <span class="hljs-comment">#       </span>
    image = Image.open(<span class="hljs-string">'%s.png'</span> % real_filename)<font></font>
    <font></font>
    <span class="hljs-comment">#  1        bmp</span>
    fn = <span class="hljs-keyword">lambda</span> x : <span class="hljs-number">255</span> <span class="hljs-keyword">if</span> x &gt; <span class="hljs-number">135</span> <span class="hljs-keyword">else</span> <span class="hljs-number">0</span>
    image = image.convert(<span class="hljs-string">'L'</span>).point(fn, mode = <span class="hljs-string">'1'</span>)<font></font>
    <font></font>
    <span class="hljs-comment">#       528 </span>
    coef = <span class="hljs-number">528.</span> / image.height<font></font>
    new_w = int(image.width * coef)<font></font>
    new_h = int(image.height * coef)<font></font>
    image = image.resize((new_w, new_h))<font></font>
    <font></font>
    <span class="hljs-comment">#    270        </span><font></font>
    image = image.transpose(Image.ROTATE_270)<font></font>
    image.save(<span class="hljs-string">'%s_for_print.bmp'</span> % real_filename)<font></font>
<font></font>
<span class="hljs-comment">#       'got.png'  'got_for_print.bmp'</span>
save_frames_from_vide(<span class="hljs-string">'got.mp4'</span>)
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
出力では、タペストリー全体の画像を含む長い画像が得られます。以下に示すのはフラグメントのみです。元の画像の幅は55,000ピクセルで、公開の規則に従っていません。</font><font style="vertical-align: inherit;">
ただし、このような画像は、回転なしで、モノクロ変換後に取得されます。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><img src="https://habrastorage.org/webt/yr/kj/b6/yrkjb6b5mtmmmo0w9d_4amiye6q.png"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><img src="https://habrastorage.org/webt/dh/ik/k3/dhikk3rlit92sc_zvhee0vadzem.png"></a><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">タペストリーをフィスカルプリンターで印刷します</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Atol fprint-22モデルの特定のフィスカルプリンターを自由に使用できますが、他のフィスカルプリンターモデルには一般的なルールが適用されます。さらに、私の会計帳簿はかなり古く、FZ-54の新たな複雑な要件をまだサポートしていません（この法律の施行後、すべての会計担当者はOFDを通じて税務署にデータを送信する義務があり、そのために痛みや苦しみを伴いました-各デバイスの点滅）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
会計プリンタに関する小さな余談。それらはPOSデバイスに関連しています。これは、PCに接続され、単一の会計および支払いシステムに統合された、貿易のニーズに対応するあらゆる種類の周辺機器です。これらのよく知られているデバイスの中で、バーコードスキャナーやクレジットカード決済端末は間違いなく目にしました。これらすべてのデバイスに対して、統一されたUnifiedPOS対話プロトコルが発明されました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
要するに、これは別のトピックであり、POSデバイスに関わる専門家の非常に狭い輪です。</font><font style="vertical-align: inherit;">これらのデバイスのほとんどは、COMオブジェクトを介してWindowsでの操作専用に設計されているため、状況は複雑です。</font><font style="vertical-align: inherit;">FreeBSDで動作するキャッシュシステムについて聞いたことがありますが、POSデバイスを操作しているときにこのようなものを見たことはありませんが、小売POSビジネスプロセスの世界に詳細に没頭する必要がなかったのは良いことです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、これらのデバイスのほとんどを操作する手順は次のとおりです。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ドライバーはメーカーからインストールされます</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メーカーのユーティリティを介したデバイスへの接続が構成されている</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目的のデバイスで目的のレジストリキーを探す</font></font></li>
<li>      <br>
(      RS-232)</li>
<li>     COM   </li>
<li>     API COM </li>
<li>  COM      <br>
(<b> </b>)</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私は自由に古代の会計帳を持っているので、そのためのドライバーは正確に第8バージョンを使用しています。</font><font style="vertical-align: inherit;">現在、メーカーは10番目のバージョンのドライバーを追加しています。これにより、別のpythonラッパーモジュールを使用して会計プリンターでの作業が大幅に簡略化されます。これは朗報です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次のコードは、上記のアルゴリズムを使用してフィスカルプリンターに接続し、ビープ音を鳴らし、以前に受信したモノクロのタペストリー画像を印刷する関数を示しています。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pywin32</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">をインストールする必要があり</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コードは非常に長く退屈なものであることが判明したため、スポイラーの下に配置しました。</font></font></b><div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword">import</span> win32com.client
<span class="hljs-keyword">from</span> _winreg <span class="hljs-keyword">import</span> HKEY_CURRENT_USER, OpenKey, EnumValue<font></font>
<font></font>
<span class="hljs-comment">#        </span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FiscallError</span>(<span class="hljs-params">Exception</span>)

#     <span class="hljs-title">COM</span>  , 
#  <span class="hljs-title">COM</span>    
<span class="hljs-title">def</span> <span class="hljs-title">fiscal_print</span>(<span class="hljs-params">filename</span>):</span><font></font>
    <font></font>
    driver = <span class="hljs-literal">None</span>
    <span class="hljs-keyword">try</span>:
        <span class="hljs-comment">#      </span>
        <span class="hljs-comment">#         8.16.</span>
        <span class="hljs-keyword">try</span>: <font></font>
            hKey = OpenKey(HKEY_CURRENT_USER, <font></font>
                           <span class="hljs-string">r"Software\Atol\Drivers\8.0\KKM\Devices"</span>)
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> err: 
            <span class="hljs-keyword">raise</span> FiscallError(<span class="hljs-string">'      '</span> +
                               <span class="hljs-string">'  '</span> +
                               <span class="hljs-string">'   FPrint22-'</span>)<font></font>
<font></font>
        <span class="hljs-comment">#       , </span>
        <span class="hljs-comment">#       com </span>
        <span class="hljs-keyword">try</span>: <font></font>
            device_name,device_connect_params,device_connect_dt=EnumValue(hKey,<span class="hljs-number">0</span>)
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> err: 
            <span class="hljs-keyword">raise</span> FiscallError(<span class="hljs-string">'     '</span> +
                               <span class="hljs-string">'     '</span> +
                               <span class="hljs-string">'  FPrint22-'</span>)<font></font>
        <font></font>
        <span class="hljs-comment">#      </span>
        <span class="hljs-keyword">try</span>: <font></font>
            connect_dir = dict([tup.split(<span class="hljs-string">u'='</span>) <span class="hljs-keyword">for</span> tup <span class="hljs-keyword">in</span> device_connect_params])
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> err: 
            <span class="hljs-keyword">raise</span> FiscallError(<span class="hljs-string">'     '</span> +
                               <span class="hljs-string">'    FPrint22-'</span>)<font></font>
        <font></font>
        <span class="hljs-comment">#    COM </span>
        <span class="hljs-keyword">try</span>: driver = win32com.client.Dispatch(<span class="hljs-string">"AddIn.FPrnM8"</span>)
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> err: 
            <span class="hljs-keyword">raise</span> FiscallError(<span class="hljs-string">' COM  AddIn.FPrnM8   '</span> +
                               <span class="hljs-string">' FPrint22-    , '</span> +
                               <span class="hljs-string">'    '</span>)<font></font>
<font></font>
        <span class="hljs-comment">#         </span><font></font>
        add_code = driver.AddDevice()<font></font>
        <span class="hljs-keyword">if</span> driver.ResultCode != <span class="hljs-number">0</span>: 
            <span class="hljs-keyword">raise</span> FiscallError(<span class="hljs-string">'     FPrint22-'</span> +
                               <span class="hljs-string">' [ %s] - %s'</span>% (driver.ResultCode,<font></font>
                                                  driver.ResultDescription))<font></font>
<font></font>
        <span class="hljs-comment">#       COM </span>
        driver.Model             = connect_dir[<span class="hljs-string">'Model'</span>]<font></font>
        driver.PortNumber        = connect_dir[<span class="hljs-string">'PortNumber'</span>]<font></font>
        driver.UseAccessPassword = connect_dir[<span class="hljs-string">'UseAccessPassword'</span>]<font></font>
        driver.DefaultPassword   = connect_dir[<span class="hljs-string">'UseAccessPassword'</span>]<font></font>
        driver.PortNumber        = connect_dir[<span class="hljs-string">'PortNumber'</span>]<font></font>
        driver.BaudRate          = connect_dir[<span class="hljs-string">'BaudRate'</span>]
        <span class="hljs-comment">#         </span>
        <span class="hljs-comment">#       COM </span>
        driver.DeviceEnabled     = <span class="hljs-number">1</span><font></font>
<font></font>
        <span class="hljs-comment">#         GetStatus, </span>
        <span class="hljs-comment">#       . 61    v8.0</span><font></font>
        res = driver.GetStatus()<font></font>
        <span class="hljs-keyword">if</span> driver.ResultCode != <span class="hljs-number">0</span>: 
            <span class="hljs-keyword">raise</span> FiscallError(<span class="hljs-string">'     FPrint22- '</span> + 
                               <span class="hljs-string">'[ %s] - %s'</span> % (driver.ResultCode, <font></font>
                                                  driver.ResultDescription))<font></font>
        <font></font>
        <span class="hljs-comment">###  </span><font></font>
        <font></font>
        <span class="hljs-comment">#  ,       </span>
        <span class="hljs-comment">#   ,      </span><font></font>
        driver.Beep()<font></font>
        <font></font>
        <span class="hljs-comment">#  ,      (528)</span>
        print(<span class="hljs-string">'driver.PixelLineLength:'</span>, driver.PixelLineLength) <font></font>
        <font></font>
        <span class="hljs-comment"># !!!       </span>
        <span class="hljs-comment">#     (    COM )</span>
        driver.Alignment    = <span class="hljs-number">0</span>
        driver.LeftMargin   = <span class="hljs-number">0</span>
        driver.PrintPurpose = <span class="hljs-number">1</span>
        driver.AutoSize     = <span class="hljs-literal">False</span>
        driver.Scale        = <span class="hljs-number">100</span>
        <span class="hljs-comment">#     </span><font></font>
        driver.FileName     = filename<font></font>
        <font></font>
        <span class="hljs-comment">#    bmp </span><font></font>
        driver.PrintBitmapFromFile<font></font>
        <span class="hljs-comment">#        10 </span>
        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">10</span>): driver.PrintString()
        <span class="hljs-comment">#     </span><font></font>
        driver.FullCut()<font></font>
        <font></font>
        <span class="hljs-comment"># !</span><font></font>
    <font></font>
    <span class="hljs-keyword">except</span> FiscallError <span class="hljs-keyword">as</span> err: 
        <span class="hljs-keyword">raise</span> err
    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> err: 
        <span class="hljs-keyword">raise</span> FiscallError(<span class="hljs-string">'    '</span> + 
                           <span class="hljs-string">'   FPrint22- - %s'</span> % str(err))
    <span class="hljs-keyword">finally</span>: 
        <span class="hljs-keyword">if</span> driver: driver.DeviceEnabled = <span class="hljs-number">0</span><font></font>
<font></font>
fiscal_print(<span class="hljs-string">'got_for_print.bmp'</span>)
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
出力はそのような原稿であり、「氷と炎の歌」のパフォーマンスでした。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/kv/cl/21/kvcl21w306fwxuqqbu1hawqqyhm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プリンターは最終的に遠吠えし、ゆっくりと鈍く印刷し、最後のシーンのみを完全に印刷しました-単一の会計用プリンターはこれほどの負荷を見たことはありません：D </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ビデオを準備するため</font><font style="vertical-align: inherit;">に</font><font style="vertical-align: inherit;">残っていますソーシャルネットワークに投稿します。</font><font style="vertical-align: inherit;">オーディオ</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">シリーズ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">として、</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">シリーズのタイトルテーマである8ビット</font></a><font style="vertical-align: inherit;">ネットワークで</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">アマチュア作品</font></a><font style="vertical-align: inherit;">を見つけました</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">ビデオエディタをまったく使用せずに互いに重ね合わせるというアイデアでした。これについては、記事の最後の部分で後で説明します。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結果のビデオクリップをソーシャルネットワークで公開するためにマウントします</font></font></h3><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">これらの目的のために、ビデオエディター全体を置き換える非常に便利で強力なコンソールツール-libavがあり</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">ビデオおよびオーディオファイルを操作するためのavconfおよびffmpegユーティリティが含まれています。</font><font style="vertical-align: inherit;">正直なところ、私にとってこのツールは本当に発見されたので、皆さんにお勧めします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
インストールの基本的な考え方：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スマートフォンのビデオショットの最初の部分と最後の部分を切り取り</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ます（8ビットの音楽を含むmp3ファイルを3つの再生に合わせるため）</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1つのファイルに3つのオーディオファイルの損失を書き込む</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ビデオファイルとオーディオファイルを新しいビデオファイルにオーバーレイ</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">動画ファイルをmov形式からmp4形式に変換します</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（私のスマートフォンは拡張子movの動画を撮影します）</font></font></li>
</ul><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">これらの目的のために、コマンドラインで実行するスクリプトを記述しました。これは、Linuxのbashとwinのbatの両方で実行できます（違いはスクリプトのコメントに示されています）。</font></font></b><div class="spoiler_text"><pre><code class="plaintext hljs">#    <font></font>
avconv -ss 00:00:10 -i got_print.mov -t 00:06:00 -c:v copy got_print_tmp.mov<font></font>
<font></font>
#      ( win)<font></font>
(echo file 'got_8bit.mp3' &amp; echo file 'got_8bit.mp3' &amp; echo file 'got_8bit.mp3') &gt; list.txt<font></font>
<font></font>
#      ( linux)<font></font>
# cat list.txt<font></font>
# file 'got_8bit.mp3'<font></font>
# file 'got_8bit.mp3'<font></font>
# file 'got_8bit.mp3'<font></font>
<font></font>
#     3 <font></font>
ffmpeg -f concat -i list.txt -acodec copy got_8bit_3.mp3<font></font>
<font></font>
#        <font></font>
avconv -i got_print_tmp.mov -i got_8bit_3.mp3 -c copy got_print_final.mov<font></font>
<font></font>
#       mp4<font></font>
avconv -i got_print_final.mov -c:v libx264 got_print_final.mp4<font></font>
<font></font>
#    (windows)<font></font>
del got_8bit_3.mp3<font></font>
del got_print_tmp.mov<font></font>
<font></font>
#    (linux)<font></font>
# rm got_8bit_3.mp3<font></font>
# rm got_print_tmp.mov<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以上で、ビデオが作成されました。</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/D2Nch_KXD4U" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PS：ハブレに関する私の最初の記事は、最初に短い記事を書くつもりでしたが、できる限りカットしました）リーディングが楽しく、私の仕事の結果が面白いことを願っています-興味深いです）</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja465471/index.html">Roskomnadzorでネットワークパブリケーションとしてサイトを登録しようとしましたか？</a></li>
<li><a href="../ja465475/index.html">Oleg Anastasievとのミニインタビュー：Apache Cassandraのフォールトトレランス</a></li>
<li><a href="../ja465477/index.html">Q-Networkを使用して蛇を再生するように教えた方法</a></li>
<li><a href="../ja465479/index.html">UnityのPixel Lo-fi</a></li>
<li><a href="../ja465483/index.html">骨董品：Windows 3.1およびスタートボタンのない生活</a></li>
<li><a href="../ja465487/index.html">Pinterestでkubernetesプラットフォームを構築する</a></li>
<li><a href="../ja465489/index.html">生産準備チェックリスト</a></li>
<li><a href="../ja465491/index.html">Zabbix + Voximplant：通話によるモニタリング、または心配をやめて迅速にセットアップする方法</a></li>
<li><a href="../ja465493/index.html">Raspberry Pi上のSwiftプログラミング言語</a></li>
<li><a href="../ja465495/index.html">新しいドメインに移動するときにトラフィックを失わないようにする方法：ケース「Vse10」</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>