<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏾‍✈️ 🧘🏽 🛳️ Mempercepat subsistem disk Qemu KVM di Linux 😘 👩‍🎨 💯</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Kadang-kadang saya mengambil berbagai tugas untuk menyiapkan server. Beberapa waktu lalu, pemilik perusahaan hosting kecil mendekati saya dengan masal...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Mempercepat subsistem disk Qemu KVM di Linux</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/493696/"><img src="https://habrastorage.org/webt/gx/ub/i1/gxubi1ucfhq7jujnimizriacaqa.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kadang-kadang saya mengambil berbagai tugas untuk menyiapkan server. </font><font style="vertical-align: inherit;">Beberapa waktu lalu, pemilik perusahaan hosting kecil mendekati saya dengan masalah yang menarik. </font><font style="vertical-align: inherit;">Dia ingin menjalankan mesin virtual Windows di bawah KVM di server-nya, di mana Ubuntu 18.04 sudah diinstal. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Namun, pengujiannya menunjukkan bahwa sistem disk KVM dengan sopan tertinggal di belakang indikator yang ia miliki di bawah Hyper-V. </font><font style="vertical-align: inherit;">Dia ingin melepaskan qemu di server Ubuntu-nya untuk menghindari membeli lisensi server Windows yang mahal (versi gratis dari Microsoft Hyper-V Server tidak berhasil karena keterbatasannya).</font></font><br>
<a name="habracut"></a><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0. Disposisi</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk pengujian, kami menggunakan SSD Samsung 970 Pro 1TB. </font><font style="vertical-align: inherit;">Pelanggan memeriksa hasil pekerjaan di CrystalDiskMark, jadi lebih jauh dalam artikel semua grafik dari itu.</font></font><br>
<br>
<div class="scrollable-table"><table>
<tbody><tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows 10 LTSC</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hyper-V </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2 CPU</font></font></th>
<th><font style="vertical-align: inherit;"></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CPU </font><font style="vertical-align: inherit;">KVM </font><font style="vertical-align: inherit;">2</font></font></th>
</tr>
<tr>
<td><img src="https://habrastorage.org/webt/h_/-8/n1/h_-8n1bwsgaovljitrm1wztowbi.png"></td>
<td><img src="https://habrastorage.org/webt/to/eh/ft/toehft7m0vaghk2a3vdlmkxdwq8.png"></td>
<td><img src="https://habrastorage.org/webt/-i/na/am/-inaamktv9beteru7huusvcktmo.png"></td>
</tr>
</tbody></table></div><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Langkah pertama adalah meningkatkan kinerja I / O acak. </font><font style="vertical-align: inherit;">Jenis beban ini tipikal untuk mesin virtual, terutama yang menggunakan berbagai basis data. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ubuntu (16.04 LTS dan 18.04) masih menggunakan qemu versi 2.11. </font><font style="vertical-align: inherit;">Karenanya, beberapa roti qemu terbaru tidak dipertimbangkan dalam artikel ini. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami memutuskan bahwa kami perlu menghindari mengikat besi ke mesin virtual, karena ini mempersulit portabilitas mesin virtual, sehingga opsi untuk melempar SSD / disk fisik / partisi ke mesin virtual dianggap tidak diinginkan.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tentang ukuran file uji untuk CrystalDiskMark</font></font></b><div class="spoiler_text">   ,          100  4.   ,         :   ,    .<br>
<br>
,        ,  Windows       .    100  4    ,     40  .<br>
<br>
       ,      ,         100-1.         4.<br>
</div></div><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. Kami menggunakan volume LVM, bukan file untuk menyimpan disk mesin virtual.</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Logikanya adalah ini. File dengan disk virtual disimpan dalam sistem file Linux, NTFS terletak di dalam file itu sendiri. Setiap sistem file mengkonsumsi sumber daya selama operasi disk. Oleh karena itu, semakin kecil kedalaman boneka, semakin cepat input / output. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika kita berbicara tentang file qcow2, namanya adalah “Qemu Copy-On-Write” dan, pada kenyataannya, mereka memiliki tabel terjemahan sendiri di dalam yang bertanggung jawab atas blok mana yang sibuk, mana yang tidak dan di mana yang berada. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lapisan LVM mengkonsumsi sumber daya prosesor jauh lebih sedikit daripada sistem file. Salah satu alasan untuk ini adalah bahwa blok di dalamnya jauh lebih besar daripada blok sistem file khas (4KB). Semakin besar blok (luas) pada perangkat LVM fisik, semakin cepat IO terjadi dan semakin sedikit fragmentasi.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tetapi bahkan untuk SSD acak I / O jauh lebih lambat daripada serial. Karenanya, saat membuat Grup Volume, kami akan menentukan tingkat yang sangat besar: 256MB. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Baca di depan pada volume logis harus dimatikan, karena menghabiskan IO tanpa kemenangan, karena sekarang tidak ada yang defragmenting disk di Windows pada SSD. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
LVM cukup nyaman digunakan untuk hosting mesin virtual. Volume LVM mudah dibawa-bawa antara disk fisik, ada snapshot dan pengubahan ukuran online. Selain itu, virt-manager (libvirt) dapat membuat volume logis di luar kotak untuk disk mesin virtual dari grup Volume.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kemampuan untuk membuat volume yang tipis juga terlihat menarik, tetapi mengingat bahwa volume yang tipis adalah lapisan tambahan abstraksi, jelas bahwa itu akan menurunkan kinerja IO. </font><font style="vertical-align: inherit;">Selain itu, libvirt tidak memiliki cara yang elegan untuk secara otomatis membuat disk untuk mesin virtual dalam kumpulan tipis.</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-comment">#    SSD    (volume group)</span><font></font>
pvcreate /dev/nvme1n1p1<font></font>
<font></font>
<span class="hljs-comment">#    win    (extent) 256.</span><font></font>
vgcreate -s 256M win_pool /dev/nvme1n1p1<font></font>
<font></font>
<span class="hljs-comment">#    vm1.    C</span><font></font>
lvcreate -n vm1 -L 100G win_pool<font></font>
<font></font>
<span class="hljs-comment">#      (read ahead)</span><font></font>
lvchange -r none /dev/win_pool/vm1<font></font>
</code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.1. </font><font style="vertical-align: inherit;">Volume tipis sebagai disk dan / atau pengaturan volume logis untuk foto</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika Anda ingin menggunakan kumpulan tipis di mana Anda akan membuat volume tipis, maka masuk akal untuk mengatur ukuran potongan kumpulan menjadi 4MB, yang jauh lebih besar dari ukuran default 64KB. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Yang akan memerlukan pekerjaan lebih cepat dari lapisan abstraksi ini. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mekanisme snapshot dalam LVM bekerja hampir pada kode yang sama dengan volume yang tipis, sehingga pengaturannya akan sama untuk meningkatkan kecepatan snapshot.</font></font><br>
<br>
<pre><code class="bash hljs">lvcreate -c 4m -L 300G -T -Zn win_pool/thin</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Opsi ini </font></font><code>-Zn</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">menonaktifkan menimpa potongan dengan nol saat menyorot, yang meningkatkan kecepatan kerja. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pengaturan untuk lvm.conf atau file serupa (mis. Lvmlocal.conf):</font></font><br>
<br>
<pre><code class="bash hljs">thin_pool_chunk_size = 4096<font></font>
thin_pool_zero = n</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anda dapat menentukan ukuran optimal bongkahan dengan menyelesaikan tes dengan perintah berikut, memilih nilainya </font></font><code>--blocksize</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="bash hljs">fio --name=randwrite --filename=/dev/nvme0n1p9 --size=10G --ioengine=libaio --iodepth=1 --buffered=0 --direct=1 --rw=randwrite --blocksize=4m</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anda dapat melihat ukuran chunk saat ini dengan perintah:</font></font><br>
<br>
<pre><code class="bash hljs">lvs -ao name,chunksize</code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. Meningkatkan jumlah prosesor logis yang dialokasikan untuk setiap mesin virtual KVM meningkatkan kinerja disk</font></font></h4><br>
<div class="scrollable-table"><table>
<tbody><tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10 CPU</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8 CPU</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4 CPU</font></font></th>
</tr>
<tr>
<td><img src="https://habrastorage.org/webt/rk/d5/pp/rkd5pphdlwmwx0ykk_mszbtcxjc.png"></td>
<td><img src="https://habrastorage.org/webt/o6/0s/u-/o60su-evqzflfsjh4v0wl7ih8sa.png"></td>
<td><img src="https://habrastorage.org/webt/gv/0x/jf/gv0xjf7ky6xkidam9duclsztowo.png"></td>
</tr>
</tbody></table></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jelas bahwa hampir tidak ada orang yang akan mengalokasikan 10 prosesor ke mesin virtual, tetapi menarik untuk melihat kasus ekstrim. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Itu sudah tergantung pada jumlah prosesor gratis. </font><font style="vertical-align: inherit;">Menurut pendapat saya, tidak tepat untuk mengalokasikan lebih dari 4. </font><font style="vertical-align: inherit;">Dengan jumlah utas sama dengan 8, kami mendapat kinerja baca dan tulis acak maksimum. </font><font style="vertical-align: inherit;">Ini adalah kekhususan CrystalDiskMark 6.0.2, di mana tes kedua melakukan 8 utas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dari mana kita dapat menyimpulkan bahwa itu baik untuk memiliki satu prosesor logis untuk setiap tugas yang secara aktif menggunakan IO.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. Kami menggunakan halaman besar memori akses acak (hugepage) untuk menghindari penurunan kinerja karena fragmentasi RAM</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Paket ini dapat berguna ketika kita membutuhkan berbagai informasi tentang hugepage selama operasi.</font></font><br>
<br>
<pre><code class="bash hljs">apt install hugepages</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Edit </font></font><code>/etc/default/grub</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="bash hljs">GRUB_CMDLINE_LINUX=<span class="hljs-string">"default_hugepagesz=1GB hugepagesz=1G hugepages=64"</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam hal ini, memori 64GB dialokasikan untuk semua mesin virtual sebagai hugepage. </font><font style="vertical-align: inherit;">Dalam kasus Anda mungkin ada lebih sedikit / lebih banyak. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami menerapkan pengaturan ini ke GRUB sehingga pada saat sistem melakukan boot, mereka menjadi aktif:</font></font><br>
<br>
<pre><code class="bash hljs">grub-mkconfig -o /boot/grub/grub.cfg
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mengedit konfigurasi mesin virtual:</font></font><br>
<br>
<pre><code class="bash hljs">virsh edit vm_name</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Menambahkan:</font></font><br>
<br>
<pre><code class="xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">memoryBacking</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">hugepages</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">memoryBacking</span>&gt;</span></code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4. Tambahkan aliran khusus ke setiap mesin virtual untuk melayani IO</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anda perlu menambahkan apa yang disorot dalam huruf tebal. </font><font style="vertical-align: inherit;">Kami menggunakan </font></font><code>virsh</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, seperti pada paragraf sebelumnya.</font></font><br>
<br>
<blockquote><b>&lt;iothreads&gt;1&lt;/iothreads&gt;</b><br>
<br>
&lt;disk type='block' device='disk'&gt;<br>
&lt;driver name='qemu' type='raw' cache='none' io='threads' <b>iothread='1'</b>/&gt;<br>
&lt;source dev='/dev/win/terminal'/&gt;<br>
&lt;target dev='vda' bus='virtio'/&gt;<br>
&lt;boot order='2'/&gt;<br>
&lt;address type='pci' domain='0x0000' bus='0x04' slot='0x00' function='0x0'/&gt;<br>
&lt;/disk&gt;</blockquote><br>
<br>
<h4>4.1.       writeback</h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk mempercepat penulisan yang tidak disengaja ke disk, tetapi dengan peningkatan risiko kehilangan data, Anda dapat menggunakan </font></font><code>cache=writeback</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">paragraf sebelumnya. </font><font style="vertical-align: inherit;">Ini dapat digunakan hanya jika ada kepercayaan besar pada kualitas dan cadangan daya dan keberadaan cadangan.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5. Pengaturan subsistem disk di Virt Manager</font></font></h4><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Disk bus: VirtIO </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Format penyimpanan: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mode Cache </font><font style="vertical-align: inherit;">mentah </font><font style="vertical-align: inherit;">: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mode IO </font><font style="vertical-align: inherit;">writeback </font><font style="vertical-align: inherit;">: utas</font></font></blockquote><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.1. </font><font style="vertical-align: inherit;">Mengkonfigurasi subsistem disk melalui file konfigurasi</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Qemu 2.11 (yang saat ini digunakan oleh Ubuntu) mendukung dua jenis perangkat virtual disk: virtio-blk dan virtio-scsi. </font><font style="vertical-align: inherit;">Ketika ditentukan dalam Virt Manager </font></font><code>Disk bus: VirtIO</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, ini berarti menggunakan perangkat virtio-blk. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam semua kasus, kecepatan virtio-blk lebih baik, terlepas dari kenyataan bahwa dalam versi qemu yang diuji, masih tidak mendukung TRIM, tidak seperti virtio-scsi ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sudah mendukungnya</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sejak versi 5.x </font><font style="vertical-align: inherit;">). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dari sudut pandang kecepatan IO disk, virtio-scsi hanya masuk akal dalam kasus-kasus eksotis, misalnya, ketika Anda perlu menghubungkan ratusan disk ke mesin virtual.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6. Selama instalasi Windows, instal driver VirtIO</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika tidak, disk tidak akan tersedia untuk OS. </font><font style="vertical-align: inherit;">Untuk melakukan ini, gunakan gambar driver, yang kami sambungkan sebelumnya ke mesin virtual.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7. Hasil setelah menerapkan semua tweak</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sebenarnya, tweak 4.1 tidak digunakan, karena saya tidak yakin keandalan catu daya dari klien.</font></font><br>
<div class="scrollable-table"><table>
<tbody><tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hyper-V </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2 CPU</font></font></th>
<th><font style="vertical-align: inherit;"></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CPU </font><font style="vertical-align: inherit;">KVM </font><font style="vertical-align: inherit;">2</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">KVM </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4 CPU</font></font></th>
</tr>
<tr>
<td><img src="https://habrastorage.org/webt/to/eh/ft/toehft7m0vaghk2a3vdlmkxdwq8.png"></td>
<td><img src="https://habrastorage.org/webt/4a/la/5s/4ala5snjmars3uaepsbb63lcgqm.png"></td>
<td><img src="https://habrastorage.org/webt/fu/tt/0k/futt0kedtld37khc96igkyks1zq.png"></td>
</tr>
</tbody></table></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anda perlu memahami bahwa hasil ini memiliki konvensi tertentu, karena setiap kali Anda memulai CrystalDiskMark nilainya sedikit berbeda.</font></font><br>
<br>
<div class="scrollable-table"><table>
<tbody><tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">KVM keluar dari kotak </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2 CPU</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">KVM setelah tweak </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2 CPU</font></font></th>
</tr>
<tr>
<td><img src="https://habrastorage.org/webt/-i/na/am/-inaamktv9beteru7huusvcktmo.png"></td>
<td><img src="https://habrastorage.org/webt/4a/la/5s/4ala5snjmars3uaepsbb63lcgqm.png"></td>
</tr>
</tbody></table></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami melihat bahwa kami berhasil mempercepat kerja subsistem disk di qemu (kvm) dengan jumlah core yang sama. </font><font style="vertical-align: inherit;">Menulis dipercepat rata-rata 58%, dan membaca 25%. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Elemen kunci keberhasilan</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : menggunakan volume LVM alih-alih file qcow2, pisahkan I / O, dan hugepage. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Arahkan kesalahan yang diketahui ke PM. </font><font style="vertical-align: inherit;">Saya meningkatkan karma untuk ini.</font></font></i><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS vhost-user-blk dan vhost-user-nvme</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selama percobaan, Qemu 2.12 dan versi 3 juga dikompilasi. </font><font style="vertical-align: inherit;">Opsi vhost-user-blk untuk disk telah diuji. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pada akhirnya, itu bekerja lebih buruk daripada virtio-blk.</font></font><br>
<br>
<div class="scrollable-table"><table>
<tbody><tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vhost-user-blk </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4 CPU</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">virtio-blk </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4 CPU</font></font></th>
</tr>
<tr>
<td><img src="https://habrastorage.org/webt/x_/zw/04/x_zw04o-k8gq4so3yvyp66ddyga.png"></td>
<td><img src="https://habrastorage.org/webt/fu/tt/0k/futt0kedtld37khc96igkyks1zq.png"></td>
</tr>
</tbody></table></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk menggunakan vhost-user-nvme yang diperlukan untuk menambal qemu, opsi ini mempersulit pembaruan otomatis server dalam produksi, jadi itu tidak diuji.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PPS SPDK</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Intel merancang </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kerangka kerja ini</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> untuk mencapai indikator kinerja yang luar biasa untuk sistem disk di mesin virtual yang harus dijalankan pada prosesornya. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk membuat spdk bekerja dengan baik, mereka melakukan banyak trik - mereka mengalokasikan kernel yang terpisah untuk itu, tempatkan spdk dan kernel mesin virtual dalam satu soket. Muat mesin virtual ke dalam memori yang berdekatan. Jika Anda menerapkan langkah-langkah tersebut ke virtio-blk biasa, maka itu juga akan bekerja lebih cepat. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SPDK dapat bekerja dalam 3 mode: vhost-user-scsi, vhost-user-blk dan vhost-user-nvme. Mode kedua hanya tersedia di qemu dari 2.12, yang belum tersedia di ubuntu. Mode vhost-user-nvme umumnya mega-eksperimental - Anda perlu menambal qemu untuknya. Saat ini, hanya emulasi scsi yang berfungsi dan lambat.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ada satu lagi batasan serius untuk mode vhost-user-scsi - spdk tidak dapat di-boot.</font></font><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pastikan bootindex = 2 opsi Qemu diberikan ke perangkat vhost-user-scsi-pci.</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Catatan ditetapkan ketika mereka menggunakan driver mereka untuk berbagi SSD pada banyak perangkat dan meneruskannya sebagai vhost-user-nvme. </font><font style="vertical-align: inherit;">Pendekatan menusuk besi tidak cocok untuk kita. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kesannya adalah bahwa itu normal untuk menggunakan SPDK hanya dengan implementasi mereka dari disk logis (yang sama sekali berbeda dari standar lvm). </font><font style="vertical-align: inherit;">Ini adalah sepeda buatan sendiri dengan gambar dan kloningnya. </font><font style="vertical-align: inherit;">Semua tim berbeda dari LVM. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kesulitan dalam mengkonfigurasi SPDK, dukungan dan portabilitas mesin virtual, serta keterikatan dengan prosesor Intel, berpaling dari penggunaannya.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ucapan Terima Kasih</font></font></h4><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Terima kasih atas gambar </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TripletConcept</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Lebih baik melihatnya dalam ukuran penuh di jendela terpisah. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk izin berbagi bahan kerja -</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">st_neon</font></font></a></i><br>
<br>
<hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anda dapat memesan mesin virtual dengan SSD dari </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RUVDS</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> untuk kupon di bawah ini. </font><b><i><font style="vertical-align: inherit;">Arahkan kesalahan yang diketahui ke PM. </font></i></b><b><i><font style="vertical-align: inherit;">Saya meningkatkan karma untuk ini.</font></i></b></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a><br>
<br>
<b><i><font style="vertical-align: inherit;"></font></i></b></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id493680/index.html">10 trik bagaimana untuk tidak menggabungkan konfu online</a></li>
<li><a href="../id493686/index.html">Asal misterius papan permainan tentang kode peretasan Mastermind</a></li>
<li><a href="../id493688/index.html">Kami membuat Tim Microsoft bebas - tetap berhubungan dengan rekan di saat yang sulit ini</a></li>
<li><a href="../id493690/index.html">20 tips untuk pilot DJI Mavic Mini untuk melindungi drone Anda dari kecelakaan dan kehilangan</a></li>
<li><a href="../id493692/index.html">Struktur data teoritis dan aplikasinya dalam JavaScript. P1. Pasangan</a></li>
<li><a href="../id493700/index.html">Menggunakan malware di Azure untuk mendapatkan akses ke penyewa Microsoft 365</a></li>
<li><a href="../id493702/index.html">Transisi besar-besaran ke pekerjaan jarak jauh: masalah teknis dan ancaman terhadap keamanan</a></li>
<li><a href="../id493704/index.html">Menggunakan TypeScript dalam JavaScript tanpa menulis TypeScript</a></li>
<li><a href="../id493706/index.html">Ketahui musuh Anda: buat backdoor Node.js</a></li>
<li><a href="../id493708/index.html">Anatomi kluster Kubernetes rumah saya</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>