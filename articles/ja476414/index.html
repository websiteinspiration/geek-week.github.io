<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👏 🐴 🙄 Linuxのディスクアクティビティを特定する 🧑🏽‍🤝‍🧑🏽 🙆🏿 🥔</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="TL; DR：この記事では、ディスクにデータを書き込むLinuxベースのプログラムを特定するための便利で高速かつ信頼性の高い方法について説明しています。これは、PC上のSSD、EMMC、およびシングルボードコンピュータ上のフラッシュメモリに特に当てはまります。
 記事の執筆中に、数キロバイトのデータ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Linuxのディスクアクティビティを特定する</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/476414/"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TL; DR</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：この記事では、ディスクにデータを書き込むLinuxベースのプログラムを特定するための便利で高速かつ信頼性の高い方法について説明しています。</font><font style="vertical-align: inherit;">これは、PC上のSSD、EMMC、およびシングルボードコンピュータ上のフラッシュメモリに特に当てはまります。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
記事の執筆中に、数キロバイトのデータをBTRFSファイルシステムに書き込むと、3メガバイトの実際のデータがディスクに書き込まれることになりました。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前書き</font></font></h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「ああ、ナンセンスな最新のSSDのメモリセルは、数十年の通常の使用後に故障します。これについて心配する必要はありません。さらに、スワップ、仮想マシン、およびブラウザプロファイルフォルダをHDDに転送します」-SSDの信頼性に関する典型的な答え保証≈150と</font></font><abbr title="ディスクの保証期間が過ぎていなくても保証が失われる記録テラバイト数。"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TBW</font></font></abbr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。典型的なソフトウェアがデータを書き込むことができる量を見積もると、1日あたり10〜20 GBはすでに大きな数字であるように思われますが、最大値は40 GB以上とします。そのような数で、答えはかなり合理的です- </font><font style="vertical-align: inherit;">毎日40 GBの記録されたデータで、上書きセルの数の</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">保証</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">値</font><font style="vertical-align: inherit;">を達成するのに10年かかり</font><font style="vertical-align: inherit;">ます。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、6年間私は3番目のSSDを使用してきました。最初のSSDはコントローラーの故障、2番目のSSDは1日に数回セル間でデータの移動を開始したため、記録のメンテナンスに30秒の遅延が発生しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
新しいSSDを7か月使用した後、ディスク自体がSMARTを介してレポートするため、記録されたデータの量を確認することにしました。</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">19.7 TB。</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
わずか7か月で、保証された記録データ量の13％を使用しましたが、パーティションの調整とFSのセットアップに関する推奨事項に従って構成されているにもかかわらず、ほとんど使用していません。仮想マシンのディスクはHDDにあります！</font></font><a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは異常に高い数値であり、そのようなペースでは、5年間のドライブ保証期間に達する前にTBW保証を超えます。</font><font style="vertical-align: inherit;">そして、私のコンピューターは1日あたり93ギガバイトを書き込めません！</font><font style="vertical-align: inherit;">10分間にディスクに書き込まれるデータ量を確認する必要があります...</font></font><blockquote><code>Total:<br>
Writes Queued: 24,712, 2,237MiB<br>
<b>Writes Completed: 25,507, 2,237MiB</b><br>
Write Merges: 58, 5,472KiB</code></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.2 GiB、すごい！</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ディスクデバイスに書き込まれたデータの量を確認する</font></font></h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">デバイスが</font></font><abbr title="英語から  自己監視、分析、レポート技術"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SMART</font></font></abbr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（SSD、EMMC、一部の産業用MicroSD）を</font><font style="vertical-align: inherit;">サポートしている場合</font><font style="vertical-align: inherit;">、最初に行うことは、プログラムを使用してドライブから</font></font><code>smartctl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><code>skdump</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">または</font></font><code>mmc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（mmc-utilsから）</font><font style="vertical-align: inherit;">データを要求することです</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Smartctlのサンプル出力</font></font></b><div class="spoiler_text"><pre><code class="plaintext hljs">$ sudo smartctl -a /dev/sdb<font></font>
smartctl 7.0 2019-03-31 r4903 [x86_64-linux-5.3.11-200.fc30.x86_64] (local build)<font></font>
Copyright (C) 2002-18, Bruce Allen, Christian Franke, www.smartmontools.org<font></font>
<font></font>
=== START OF INFORMATION SECTION ===<font></font>
Model Family:     Samsung based SSDs<font></font>
Device Model:     Samsung SSD 860 EVO mSATA 250GB<font></font>
Serial Number:    S41MNC0KA13477K<font></font>
LU WWN Device Id: 5 002538 e700fa64b<font></font>
Firmware Version: RVT41B6Q<font></font>
User Capacity:    250 059 350 016 bytes [250 GB]<font></font>
Sector Size:      512 bytes logical/physical<font></font>
Rotation Rate:    Solid State Device<font></font>
Form Factor:      mSATA<font></font>
Device is:        In smartctl database [for details use: -P show]<font></font>
ATA Version is:   ACS-4 T13/BSR INCITS 529 revision 5<font></font>
SATA Version is:  SATA 3.1, 6.0 Gb/s (current: 3.0 Gb/s)<font></font>
Local Time is:    Tue Nov 19 01:48:50 2019 MSK<font></font>
SMART support is: Available - device has SMART capability.<font></font>
SMART support is: Enabled<font></font>
<font></font>
=== START OF READ SMART DATA SECTION ===<font></font>
SMART overall-health self-assessment test result: PASSED<font></font>
<font></font>
General SMART Values:<font></font>
Offline data collection status:  (0x00) Offline data collection activity<font></font>
                                        was never started.<font></font>
                                        Auto Offline Data Collection: Disabled.<font></font>
Self-test execution status:      (   0) The previous self-test routine completed<font></font>
                                        without error or no self-test has ever <font></font>
                                        been run.<font></font>
Total time to complete Offline <font></font>
data collection:                (    0) seconds.<font></font>
Offline data collection<font></font>
capabilities:                    (0x53) SMART execute Offline immediate.<font></font>
                                        Auto Offline data collection on/off support.<font></font>
                                        Suspend Offline collection upon new<font></font>
                                        command.<font></font>
                                        No Offline surface scan supported.<font></font>
                                        Self-test supported.<font></font>
                                        No Conveyance Self-test supported.<font></font>
                                        Selective Self-test supported.<font></font>
SMART capabilities:            (0x0003) Saves SMART data before entering<font></font>
                                        power-saving mode.<font></font>
                                        Supports SMART auto save timer.<font></font>
Error logging capability:        (0x01) Error logging supported.<font></font>
                                        General Purpose Logging supported.<font></font>
Short self-test routine <font></font>
recommended polling time:        (   2) minutes.<font></font>
Extended self-test routine<font></font>
recommended polling time:        (  85) minutes.<font></font>
SCT capabilities:              (0x003d) SCT Status supported.<font></font>
                                        SCT Error Recovery Control supported.<font></font>
                                        SCT Feature Control supported.<font></font>
                                        SCT Data Table supported.<font></font>
<font></font>
SMART Attributes Data Structure revision number: 1<font></font>
Vendor Specific SMART Attributes with Thresholds:<font></font>
ID# ATTRIBUTE_NAME          FLAG     VALUE WORST THRESH TYPE      UPDATED  WHEN_FAILED RAW_VALUE<font></font>
  5 Reallocated_Sector_Ct   0x0033   100   100   010    Pre-fail  Always       -       0<font></font>
  9 Power_On_Hours          0x0032   098   098   000    Old_age   Always       -       5171<font></font>
 12 Power_Cycle_Count       0x0032   099   099   000    Old_age   Always       -       459<font></font>
177 Wear_Leveling_Count     0x0013   096   096   000    Pre-fail  Always       -       62<font></font>
179 Used_Rsvd_Blk_Cnt_Tot   0x0013   100   100   010    Pre-fail  Always       -       0<font></font>
181 Program_Fail_Cnt_Total  0x0032   100   100   010    Old_age   Always       -       0<font></font>
182 Erase_Fail_Count_Total  0x0032   100   100   010    Old_age   Always       -       0<font></font>
183 Runtime_Bad_Block       0x0013   100   100   010    Pre-fail  Always       -       0<font></font>
187 Uncorrectable_Error_Cnt 0x0032   100   100   000    Old_age   Always       -       0<font></font>
190 Airflow_Temperature_Cel 0x0032   058   039   000    Old_age   Always       -       42<font></font>
195 ECC_Error_Rate          0x001a   200   200   000    Old_age   Always       -       0<font></font>
199 CRC_Error_Count         0x003e   100   100   000    Old_age   Always       -       0<font></font>
235 POR_Recovery_Count      0x0012   099   099   000    Old_age   Always       -       29<font></font>
241 Total_LBAs_Written      0x0032   099   099   000    Old_age   Always       -       38615215765<font></font>
<font></font>
SMART Error Log Version: 1<font></font>
No Errors Logged<font></font>
<font></font>
SMART Self-test log structure revision number 1<font></font>
No self-tests have been logged.  [To run self-tests, use: smartctl -t]<font></font>
<font></font>
SMART Selective self-test log data structure revision number 1<font></font>
 SPAN  MIN_LBA  MAX_LBA  CURRENT_TEST_STATUS<font></font>
    1        0        0  Not_testing<font></font>
    2        0        0  Not_testing<font></font>
    3        0        0  Not_testing<font></font>
    4        0        0  Not_testing<font></font>
    5        0        0  Not_testing<font></font>
Selective self-test flags (0x0):<font></font>
  After scanning selected spans, do NOT read-scan remainder of disk.<font></font>
If Selective self-test is pending on power-up, resume after 0 minute delay.</code></pre></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SSDは、パラメーター241 Total_LBAs_Writtenに書き込まれたデータの量を、バイト単位ではなく、論理単位（LBA）で保存します。私の場合の論理ブロックのサイズは512バイトです（セクターサイズのsmartctlの出力で確認できます）。バイトを取得するには、パラメーターの値に512を掛ける必要があります。</font></font><br>
<pre><code class="plaintext hljs">38615215765 × 512 ÷ 1000 ÷ 1000 ÷ 1000 ÷ 1000 = 19,770 <font></font>
38615215765 × 512 ÷ 1024 ÷ 1024 ÷ 1024 ÷ 1024 = 17,981 </code></pre><br>
<br><font style="vertical-align: inherit;"></font><code>skdump</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SSD上</font><font style="vertical-align: inherit;">
のプログラム</font><font style="vertical-align: inherit;">は、Total_LBAs_Writtenの値を独自の方法で何らかの方法で解釈しようとしています。そのため、表示されますが</font></font><code>1296217.695 TB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、これは明らかに正しくありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
デバイスレベルで記録された情報の量を確認するには</font></font><code>btrace</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、パッケージの</font><font style="vertical-align: inherit;">プログラムを使用</font><font style="vertical-align: inherit;">します</font></font><code>blktrace</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">プログラムの全期間の一般的な統計と、記録を実行した個々のプロセスとスレッド（カーネルを含む）の両方が表示されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次のコマンドを実行して、10分で情報を収集します。ここで、/ dev / sdbはディスクです。</font></font><br>
<pre><code class="plaintext hljs"># btrace -w 600 -a write /dev/sdb</code></pre><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">典型的なコマンド出力</font></font></b><div class="spoiler_text"><pre><code class="plaintext hljs">…<font></font>
  8,16   0     3253    50.085433192     0  C  WS 125424240 + 64 [0]<font></font>
  8,16   0     3254    50.085550024     0  C  WS 193577744 + 64 [0]<font></font>
  8,16   0     3255    50.085685165     0  C  WS 197246976 + 64 [0]<font></font>
  8,16   0     3256    50.085936852     0  C  WS 125736264 + 128 [0]<font></font>
  8,16   0     3257    50.086060780     0  C  WS 96261752 + 64 [0]<font></font>
  8,16   0     3258    50.086195031     0  C  WS 94948640 + 64 [0]<font></font>
  8,16   0     3259    50.086327355     0  C  WS 124656144 + 64 [0]<font></font>
  8,16   0     3260    50.086843733 15368  C WSM 310218496 + 32 [0]<font></font>
  8,16   0     3261    50.086975238   753  A WSM 310218368 + 32 &lt;- (8,20) 291339904<font></font>
  8,16   0     3262    50.086975560   753  Q WSM 310218368 + 32 [dmcrypt_write/2]<font></font>
  8,16   0     3263    50.086977345   753  G WSM 310218368 + 32 [dmcrypt_write/2]<font></font>
  8,16   0     3264    50.086978072   753  I WSM 310218368 + 32 [dmcrypt_write/2]<font></font>
  8,16   0     3265    50.086979159   753  D WSM 310218368 + 32 [dmcrypt_write/2]<font></font>
  8,16   0     3266    50.087055685     0  C WSM 310218368 + 32 [0]<font></font>
  8,16   0     3267    50.087060168   753  A WSM 310218592 + 160 &lt;- (8,20) 291340128<font></font>
  8,16   0     3268    50.087060367   753  Q WSM 310218592 + 160 [dmcrypt_write/2]<font></font>
  8,16   0     3269    50.087061242   753  G WSM 310218592 + 160 [dmcrypt_write/2]<font></font>
  8,16   0     3270    50.087061698   753  I WSM 310218592 + 160 [dmcrypt_write/2]<font></font>
  8,16   0     3271    50.087062361   753  D WSM 310218592 + 160 [dmcrypt_write/2]<font></font>
  8,16   0     3272    50.087386179     0  C WSM 310218592 + 160 [0]<font></font>
  8,16   0     3273    50.087436417 15368  A FWS 0 + 0 &lt;- (253,1) 0<font></font>
  8,16   0     3274    50.087437471 15368  Q FWS [LS Thread]<font></font>
  8,16   0     3275    50.087440862 15368  G FWS [LS Thread]<font></font>
  8,16   0     3276    50.088300047     0  C  WS 0 [0]<font></font>
  8,16   0     3277    50.088470917   753  A WFSM 18882688 + 8 &lt;- (8,20) 4224<font></font>
  8,16   0     3278    50.088471091   753  Q WFSM 18882688 + 8 [dmcrypt_write/2]<font></font>
  8,16   0     3279    50.088471688   753  G WFSM 18882688 + 8 [dmcrypt_write/2]<font></font>
  8,16   0     3280    50.088474334 32254  D WSM 18882688 + 8 [kworker/0:2H]<font></font>
  8,16   0     3281    50.088515572     0  C WSM 18882688 + 8 [0]<font></font>
  8,16   0     3282    50.089229069     0  C WSM 18882688 [0]<font></font>
CPU0 (8,16):<font></font>
 Reads Queued:           0,        0KiB  Writes Queued:         345,   25,932KiB<font></font>
 Read Dispatches:        0,        0KiB  Write Dispatches:      331,   25,788KiB<font></font>
 Reads Requeued:         0               Writes Requeued:         0<font></font>
 Reads Completed:        0,        0KiB  Writes Completed:    1,597,  117,112KiB<font></font>
 Read Merges:            0,        0KiB  Write Merges:            1,       16KiB<font></font>
 Read depth:             0               Write depth:           177<font></font>
 IO unplugs:             0               Timer unplugs:           0<font></font>
CPU1 (8,16):<font></font>
 Reads Queued:           0,        0KiB  Writes Queued:         502,   39,948KiB<font></font>
 Read Dispatches:        0,        0KiB  Write Dispatches:      495,   40,076KiB<font></font>
 Reads Requeued:         0               Writes Requeued:         0<font></font>
 Reads Completed:        0,        0KiB  Writes Completed:        0,        0KiB<font></font>
 Read Merges:            0,        0KiB  Write Merges:            0,        0KiB<font></font>
 Read depth:             0               Write depth:           177<font></font>
 IO unplugs:             0               Timer unplugs:           0<font></font>
CPU2 (8,16):<font></font>
 Reads Queued:           0,        0KiB  Writes Queued:         297,   26,800KiB<font></font>
 Read Dispatches:        0,        0KiB  Write Dispatches:      287,   26,800KiB<font></font>
 Reads Requeued:         0               Writes Requeued:         0<font></font>
 Reads Completed:        0,        0KiB  Writes Completed:        0,        0KiB<font></font>
 Read Merges:            0,        0KiB  Write Merges:            0,        0KiB<font></font>
 Read depth:             0               Write depth:           177<font></font>
 IO unplugs:             0               Timer unplugs:           0<font></font>
CPU3 (8,16):<font></font>
 Reads Queued:           0,        0KiB  Writes Queued:         418,   24,432KiB<font></font>
 Read Dispatches:        0,        0KiB  Write Dispatches:      408,   24,448KiB<font></font>
 Reads Requeued:         0               Writes Requeued:         0<font></font>
 Reads Completed:        0,        0KiB  Writes Completed:        0,        0KiB<font></font>
 Read Merges:            0,        0KiB  Write Merges:            2,      272KiB<font></font>
 Read depth:             0               Write depth:           177<font></font>
 IO unplugs:             0               Timer unplugs:           0<font></font>
<font></font>
Total (8,16):<font></font>
 Reads Queued:           0,        0KiB  Writes Queued:       1,562,  117,112KiB<font></font>
 Read Dispatches:        0,        0KiB  Write Dispatches:    1,521,  117,112KiB<font></font>
 Reads Requeued:         0               Writes Requeued:         0<font></font>
 Reads Completed:        0,        0KiB  Writes Completed:    1,597,  117,112KiB<font></font>
 Read Merges:            0,        0KiB  Write Merges:            3,      288KiB<font></font>
 IO unplugs:             0               Timer unplugs:           0<font></font>
<font></font>
Throughput (R/W): 0KiB/s / 2,338KiB/s<font></font>
Events (8,16): 9,287 entries<font></font>
Skips: 0 forward (0 -   0.0%)</code></pre></div></div><br>
<code>btrace</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 実際に記録されたデータの量を視覚的に確認できますが、どのプログラムが記録しているかを把握することは困難です。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ドライブに記録するプログラムの定義</font></font></h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プログラム</font></font><code>iotop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、ディスクに書き込まれたプロセス、および記録されたデータのサイズを表示します。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最も便利な出力は、次のパラメーターによって提供されます。</font></font><br>
<pre><code class="plaintext hljs"># iotop -obPat</code></pre><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プログラム出力例</font></font></b><div class="spoiler_text"><pre><code class="plaintext hljs">02:55:47 Total DISK READ :       0.00 B/s | Total DISK WRITE :      30.65 K/s<font></font>
02:55:47 Actual DISK READ:       0.00 B/s | Actual DISK WRITE:       0.00 B/s<font></font>
    TIME  PID  PRIO  USER     DISK READ  DISK WRITE  SWAPIN      IO    COMMAND<font></font>
b'02:55:47   753 be/4 root          0.00 B      0.00 B  0.00 %  0.04 % [dmcrypt_write/2]'<font></font>
b'02:55:47   788 be/4 root         72.00 K     18.27 M  0.00 %  0.02 % [btrfs-transacti]'<font></font>
b'02:55:47 15057 be/4 valdikss    216.00 K    283.05 M  0.00 %  0.01 % firefox'<font></font>
b'02:55:47  1588 ?dif root          0.00 B      0.00 B  0.00 %  0.00 % Xorg -nolisten tcp -auth /var/run/sddm/{398f030f-9667-4dff-b371-81eaae48dfdf} -background none -noreset -displayfd 18 -seat seat0 vt1'<font></font>
b'02:55:47 15692 be/4 valdikss    988.00 K      9.41 M  0.00 %  0.00 % python3 /usr/bin/gajim'<font></font>
b'02:55:47 15730 ?dif valdikss      9.07 M      0.00 B  0.00 %  0.00 % telegram-desktop --'<font></font>
b'02:55:47  2174 ?dif valdikss   1840.00 K      2.47 M  0.00 %  0.00 % yakuake'<font></font>
b'02:55:47 19827 be/4 root         16.00 K    896.00 K  0.00 %  0.00 % [kworker/u16:7-events_unbound]'<font></font>
b'02:55:47 19074 be/4 root         16.00 K    480.00 K  0.00 %  0.00 % [kworker/u16:4-btrfs-endio-write]'<font></font>
b'02:55:47 19006 be/4 root         16.00 K   1872.00 K  0.00 %  0.00 % [kworker/u16:1-events_unbound]'<font></font>
b'02:55:47  1429 be/4 root        484.00 K      0.00 B  0.00 %  0.00 % accounts-daemon'<font></font>
b'02:55:47 15820 be/4 valdikss    312.00 K      0.00 B  0.00 %  0.00 % firefox -contentproc -childID 6 -isForBrowser -prefsLen 7894 -prefMapSize 223880 -parentBuildID 20191022164834 -greomni /usr/lib64/firefox/omni.ja -appomni /usr/lib64/firefox/browser/omni.ja -appdir /usr/lib64/firefox/browser 15057 tab'<font></font>
b'02:55:47  2125 ?dif valdikss      0.00 B     92.00 K  0.00 %  0.00 % plasmashell'<font></font>
b'02:55:47  1268 be/3 root          0.00 B      4.00 K  0.00 %  0.00 % auditd'<font></font>
b'02:55:47  1414 be/4 root          0.00 B      4.00 K  0.00 %  0.00 % sssd_nss --uid 0 --gid 0 --logger=files'<font></font>
b'02:55:47 15238 be/4 valdikss      0.00 B      4.00 K  0.00 %  0.00 % thunderbird'<font></font>
b'02:55:47 18605 be/4 root          0.00 B      3.19 M  0.00 %  0.00 % [kworker/u16:0-btrfs-endio-write]'<font></font>
b'02:55:47 18867 be/4 root          0.00 B     96.00 K  0.00 %  0.00 % [kworker/u16:5-btrfs-endio-meta]'<font></font>
b'02:55:47 19070 be/4 root          0.00 B    160.00 K  0.00 %  0.00 % [kworker/u16:2-btrfs-freespace-write]'<font></font>
b'02:55:47 19645 be/4 root          0.00 B      2.17 M  0.00 %  0.00 % [kworker/u16:3-events_unbound]'<font></font>
b'02:55:47 19982 be/4 root          0.00 B    496.00 K  0.00 %  0.00 % [kworker/u16:6-btrfs-endio-write]'</code></pre></div></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
数分のiotopで283メガバイトを記録したFirefoxがあなたの目を引きます。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">記録するファイルの定義</font></font></h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ディスクをレイプするプロセスに関する情報は良好であり、ディスクの記録方法はさらに優れています。</font><font style="vertical-align: inherit;">ファイルシステムへの変更を追跡する</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プログラム</font></font><code>fatrace</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">使用</font><font style="vertical-align: inherit;">します。</font></font><br>
<pre><code class="plaintext hljs"># fatrace -f W</code></pre><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プログラム出力例</font></font></b><div class="spoiler_text"><pre><code class="plaintext hljs">firefox(15057): CW /home/valdikss/.mozilla/firefox/xyf4vqh2.default/storage/default/moz-extension+++e5c304fb-af40-498a-9ba8-47eb0416e933^userContextId=4294967295/idb/3647222921wleabcEoxlt-eengsairo.sqlite-wal<font></font>
firefox(15057): CW /home/valdikss/.mozilla/firefox/xyf4vqh2.default/storage/default/moz-extension+++e5c304fb-af40-498a-9ba8-47eb0416e933^userContextId=4294967295/idb/3647222921wleabcEoxlt-eengsairo.sqlite<font></font>
firefox(15057): W /home/valdikss/.mozilla/firefox/xyf4vqh2.default/storage/default/https+++habr.com/ls/data.sqlite-journal<font></font>
firefox(15057): W /home/valdikss/.mozilla/firefox/xyf4vqh2.default/storage/default/https+++habr.com/ls/data.sqlite-journal<font></font>
firefox(15057): W /home/valdikss/.mozilla/firefox/xyf4vqh2.default/storage/default/https+++habr.com/ls/data.sqlite-journal<font></font>
firefox(15057): W /home/valdikss/.mozilla/firefox/xyf4vqh2.default/storage/default/https+++habr.com/ls/data.sqlite-journal<font></font>
firefox(15057): W /home/valdikss/.mozilla/firefox/xyf4vqh2.default/storage/default/https+++habr.com/ls/data.sqlite-journal<font></font>
firefox(15057): W /home/valdikss/.mozilla/firefox/xyf4vqh2.default/storage/default/https+++habr.com/ls/data.sqlite-journal<font></font>
firefox(15057): W /home/valdikss/.mozilla/firefox/xyf4vqh2.default/storage/default/https+++habr.com/ls/data.sqlite-journal<font></font>
firefox(15057): CW /home/valdikss/.mozilla/firefox/xyf4vqh2.default/storage/default/https+++habr.com/ls/usage-journal<font></font>
firefox(15057): W /home/valdikss/.mozilla/firefox/xyf4vqh2.default/storage/default/https+++habr.com/ls/usage<font></font>
firefox(15057): CW /home/valdikss/.mozilla/firefox/xyf4vqh2.default/storage/default/https+++habr.com/ls/usage<font></font>
firefox(15057): W /home/valdikss/.mozilla/firefox/xyf4vqh2.default/storage/default/https+++habr.com/ls/data.sqlite-journal<font></font>
firefox(15057): W /home/valdikss/.mozilla/firefox/xyf4vqh2.default/storage/default/https+++habr.com/ls/data.sqlite<font></font>
firefox(15057): W /home/valdikss/.mozilla/firefox/xyf4vqh2.default/storage/default/https+++habr.com/ls/data.sqlite<font></font>
firefox(15057): W /home/valdikss/.mozilla/firefox/xyf4vqh2.default/storage/default/https+++habr.com/ls/data.sqlite<font></font>
firefox(15057): W /home/valdikss/.mozilla/firefox/xyf4vqh2.default/webappsstore.sqlite-wal<font></font>
firefox(15057): W /home/valdikss/.mozilla/firefox/xyf4vqh2.default/webappsstore.sqlite-wal<font></font>
firefox(15057): W /home/valdikss/.mozilla/firefox/xyf4vqh2.default/webappsstore.sqlite-wal<font></font>
firefox(15057): W /home/valdikss/.mozilla/firefox/xyf4vqh2.default/webappsstore.sqlite-wal<font></font>
firefox(15057): W /home/valdikss/.mozilla/firefox/xyf4vqh2.default/webappsstore.sqlite-wal<font></font>
firefox(15057): W /home/valdikss/.mozilla/firefox/xyf4vqh2.default/webappsstore.sqlite-wal<font></font>
firefox(15057): W /home/valdikss/.mozilla/firefox/xyf4vqh2.default/webappsstore.sqlite-wal<font></font>
firefox(15057): CW /home/valdikss/.mozilla/firefox/xyf4vqh2.default/storage/default/https+++habr.com/ls/data.sqlite-journal<font></font>
firefox(15057): W /home/valdikss/.mozilla/firefox/xyf4vqh2.default/webappsstore.sqlite<font></font>
firefox(15057): W /home/valdikss/.mozilla/firefox/xyf4vqh2.default/webappsstore.sqlite<font></font>
firefox(15057): W /home/valdikss/.mozilla/firefox/xyf4vqh2.default/webappsstore.sqlite</code></pre></div></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fatraceは、inotifyを介してファイルにアクセスするという事実をかなり単純に追跡しているため、記録されたデータの量を表示できません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、Habrが記事を書いているときにブラウザのローカルストレージに記事を保存する出力と、Fatraceを使用して発見されたため、30秒ごとにデータを読み取るグループスピードダイヤル拡張から確認できます。</font><font style="vertical-align: inherit;">書き込みではなく読み取り：</font><font style="vertical-align: inherit;">ファイルの前の</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CW</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、ファイルが読み取りおよび書き込み用に開かれていることを示しますが、ファイルがない場合はファイルを作成します（openatはO_RDWR | O_CREATフラグで呼び出されます）。あらゆる情報。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
念のため、これを確認するために、ファイルシステム呼び出し用のフィルターを備えたstraceを使用します。</font></font><br>
<pre><code class="plaintext hljs">strace -yy -e trace=open,openat,close,write -f -p 15057 2&gt;&amp;1 | grep extension</code></pre><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">チーム出力</font></font></b><div class="spoiler_text"><pre><code class="plaintext hljs">[pid 20352] openat(AT_FDCWD, "/home/valdikss/.mozilla/firefox/xyf4vqh2.default/storage/default/moz-extension+++e5c304fb-af40-498a-9ba8-47eb0416e933^userContextId=4294967295/idb/3647222921wleabcEoxlt-eengsairo.sqlite", O_RDWR|O_CREAT|O_CLOEXEC, 0644) = 153&lt;/home/valdikss/.mozilla/firefox/xyf4vqh2.default/storage/default/moz-extension+++e5c304fb-af40-498a-9ba8-47eb0416e933^userContextId=4294967295/idb/3647222921wleabcEoxlt-eengsairo.sqlite&gt;<font></font>
[pid 20352] read(153&lt;/home/valdikss/.mozilla/firefox/xyf4vqh2.default/storage/default/moz-extension+++e5c304fb-af40-498a-9ba8-47eb0416e933^userContextId=4294967295/idb/3647222921wleabcEoxlt-eengsairo.sqlite&gt;, "SQLite format 3\0\20\0\2\2\0@  \0\0\0d\0\0\0\23"..., 100) = 100<font></font>
[pid 20352] read(153&lt;/home/valdikss/.mozilla/firefox/xyf4vqh2.default/storage/default/moz-extension+++e5c304fb-af40-498a-9ba8-47eb0416e933^userContextId=4294967295/idb/3647222921wleabcEoxlt-eengsairo.sqlite&gt;, "SQLite format 3\0\20\0\2\2\0@  \0\0\0d\0\0\0\23"..., 4096) = 4096<font></font>
[pid 20352] openat(AT_FDCWD, "/home/valdikss/.mozilla/firefox/xyf4vqh2.default/storage/default/moz-extension+++e5c304fb-af40-498a-9ba8-47eb0416e933^userContextId=4294967295/idb/3647222921wleabcEoxlt-eengsairo.sqlite-wal", O_RDWR|O_CREAT|O_CLOEXEC, 0644) = 166&lt;/home/valdikss/.mozilla/firefox/xyf4vqh2.default/storage/default/moz-extension+++e5c304fb-af40-498a-9ba8-47eb0416e933^userContextId=4294967295/idb/3647222921wleabcEoxlt-eengsairo.sqlite-wal&gt;<font></font>
…<font></font>
[pid 20352] read(54&lt;/home/valdikss/.mozilla/firefox/xyf4vqh2.default/storage/default/moz-extension+++e5c304fb-af40-498a-9ba8-47eb0416e933^userContextId=4294967295/idb/3647222921wleabcEoxlt-eengsairo.sqlite&gt;, "\0\0\0\r\4\30\4\36\4\35\4\35\4\36\4-\0 \4\20\4!\4'\4\1\4\"\0250 &amp;"..., 4096) = 4096<font></font>
[pid 20352] read(54&lt;/home/valdikss/.mozilla/firefox/xyf4vqh2.default/storage/default/moz-extension+++e5c304fb-af40-498a-9ba8-47eb0416e933^userContextId=4294967295/idb/3647222921wleabcEoxlt-eengsairo.sqlite&gt;, "\0\0\0\0\1\36P\t\226\250\4\0O\245\320\16:\"\16.\27\0r\245\306&gt;\246\1\t\1q\370"..., 4096) = 4096<font></font>
[pid 20352] close(77&lt;/home/valdikss/.mozilla/firefox/xyf4vqh2.default/storage/default/moz-extension+++e5c304fb-af40-498a-9ba8-47eb0416e933^userContextId=4294967295/idb/3647222921wleabcEoxlt-eengsairo.sqlite-wal&gt;) = 0<font></font>
[pid 20352] close(54&lt;/home/valdikss/.mozilla/firefox/xyf4vqh2.default/storage/default/moz-extension+++e5c304fb-af40-498a-9ba8-47eb0416e933^userContextId=4294967295/idb/3647222921wleabcEoxlt-eengsairo.sqlite&gt;) = 0</code></pre></div></div><br><font style="vertical-align: inherit;"></font><code>write()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイルへの書き込みがないことを示す</font><font style="vertical-align: inherit;">
呼び出しはありません</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイルシステムのオーバーヘッドの決定</font></font></h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">証言に大きな差</font></font><code>iotop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><code>btrace</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイル内のデータを手動で記録することにより、テスト用のファイルシステムへのアイデアを提案し、btraceの証言を追跡します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
systemd緊急モードにロードし</font><font style="vertical-align: inherit;">て既存のファイル</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に数バイトの</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データを</font><font style="vertical-align: inherit;">手動で書き込むことにより、ディスクへの書き込みを完全に除外する</font><font style="vertical-align: inherit;">と、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">btrfs</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を使用するSSDのbtraceは、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3メガバイトの</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">実際のデータ</font><font style="vertical-align: inherit;">が書き込まれていること</font><b><font style="vertical-align: inherit;">を</font></b><font style="vertical-align: inherit;">報告し</font><font style="vertical-align: inherit;">ます。 8 GBフラッシュドライブに新しく作成されたファイルシステムは、1バイトを記録するときに最低264 KiBを記録します。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
比較のために、ext4上のファイルに1組のバイトを書き込むと、24キロバイトのデータがディスクに書き込まれます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2017年、Jayashree Mohan、Rohan Kadekodi、Vijay Chidambaram </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、さまざまなファイルシステムの増幅の記録に関する調査を実施しました。</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、4 KBを書き込んだときのbtrfsとext4の結果は私のものと一致します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/s2/o1/pa/s2o1parvcsurvjl5rkpiijc1fgo.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結論と結論</font></font></h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">説明された操作により、それが発見されました：</font></font><br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CUPS印刷デーモンによって、</font><font style="vertical-align: inherit;">毎分</font><font style="vertical-align: inherit;">、/ var / </font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cache</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> / cupsに</font><font style="vertical-align: inherit;">プリンターのジョブステータスを頻繁に記録します</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">この問題は、/ var / </font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">spool</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> / cupsを</font><font style="vertical-align: inherit;">クリーニングすることで修正されました</font><font style="vertical-align: inherit;">（ただし、印刷ジョブはありません）。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Firefoxの拡張機能Group Speed Dialを使用してデータベースを30秒ごとに読み取ること。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fedoraのさまざまなパフォーマンス追跡サービスによる定期的なロギング。これにより、btrfsに数メガバイトのデータが記録されました。pmcd.service、pmie.service、pmlogger.service;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">btrfsを使用して少量のデータを記録する場合の巨大な増幅。</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
結論：プログラムが頻繁に少量のデータ（数キロバイト）を書き込む場合は、btrfsを使用しないでください。そうでない場合、メガバイトの記録データになります。</font><font style="vertical-align: inherit;">特に、MicroSDにOSを搭載したシングルボードコンピュータに当てはまります。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja476398/index.html">ReduxはSwiftUIの状態コンテナーのようなものです。基礎</a></li>
<li><a href="../ja476404/index.html">Security Week 47：重要な脆弱性</a></li>
<li><a href="../ja476406/index.html">デートのニューラルネットワーク</a></li>
<li><a href="../ja476408/index.html">本の引き出し</a></li>
<li><a href="../ja476412/index.html">ハネス・リンデマン対アラン・ボンバード：神話を暴く？</a></li>
<li><a href="../ja476416/index.html">Windows管理センターからのWindowsサーバーの管理</a></li>
<li><a href="../ja476424/index.html">フレームワーク-プラスよりもマイナス</a></li>
<li><a href="../ja476428/index.html">Nginx VTS Stats、Mockify-モックAPI、WiremockおよびMockifyの比較</a></li>
<li><a href="../ja476430/index.html">完璧な技術ポートフォリオを作成する方法</a></li>
<li><a href="../ja476434/index.html">放棄されたデバイス用のUSBドライバーの作成</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>