<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ“Ÿ ğŸ“¶ ğŸ‡ğŸ¼ AbfragezÃ¤hlung: Grundlegende Django-Leistungstests ğŸ‘“ ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘§ ğŸ‘ğŸ¼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo alle zusammen. Wir haben eine Ãœbersetzung eines weiteren nÃ¼tzlichen Materials fÃ¼r Studenten des Kurses "Webentwickler in Python" vorbereitet , d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>AbfragezÃ¤hlung: Grundlegende Django-Leistungstests</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/490202/"><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hallo alle zusammen. </font><font style="vertical-align: inherit;">Wir haben eine Ãœbersetzung eines weiteren nÃ¼tzlichen Materials fÃ¼r Studenten des Kurses </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Webentwickler in Python"</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> vorbereitet </font><font style="vertical-align: inherit;">, der gestern begonnen hat.</font></font><br>
</b></i><br>
<br>
<img src="https://habrastorage.org/webt/-i/l9/rg/-il9rgpfjconn-on4udsprg5vyi.png"><br>
<hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sie kÃ¶nnen hÃ¤ufig Informationen zu Testmethoden wie TDD und zum Testen der GeschÃ¤ftslogik einer Anwendung erhalten. Das Testen der Anwendungsleistung ist jedoch eine vÃ¶llig andere Aufgabe. Es gibt viele verschiedene MÃ¶glichkeiten, aber der hÃ¤ufigste Ansatz besteht darin, eine Umgebung zu erstellen, in der Sie einen DDoS-Angriff auf Ihre Anwendung durchfÃ¼hren und deren Verhalten beobachten kÃ¶nnen. Dies ist ein sehr interessantes Thema, aber darÃ¼ber mÃ¶chte ich heute nicht sprechen. Heute sehen wir uns einen einfacheren Test an, den Sie mit den Standard-Django-Komponententests durchfÃ¼hren kÃ¶nnen: Testen Sie, wie oft Ihre Anwendung auf die Datenbank zugreift.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Testen ist sehr einfach, und genau dieser Aspekt kann die Anwendungsleistung in einem frÃ¼hen Stadium beeintrÃ¤chtigen. Dieser Aspekt ist der erste, der getestet wird, wenn etwas langsam zu arbeiten beginnt. Die gute Nachricht ist, dass Sie nur eines wissen mÃ¼ssen, um Tests dieser Art zu schreiben: die </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">assertNumQueries-</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Methode </font><font style="vertical-align: inherit;">, die recht einfach zu verwenden ist. Hier ist ein Beispiel:</font></font><br>
<br>
<pre><code class="django hljs"><span class="xml">from django.test import TestCase, Client
from django.urls import reverse
from trucks.models import Truck

class TrucksTestCase(TestCase):
    def test_list_trucks_view_performance(self):
        client = Client()

        Truck.objects.create(...)

        with self.assertNumQueries(6):
            response = client.get(reverse("trucks:list_trucks"))

        self.assertEqual(response.context["trucks_list"], 1)</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der obige Code besagt, dass die </font></font><code>"trucks:list_trucks"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anwendung </font><font style="vertical-align: inherit;">wÃ¤hrend der Ansicht </font><font style="vertical-align: inherit;">nur sechsmal auf die Datenbank zugreift. Beachten Sie jedoch, dass wir vor dem Start zunÃ¤chst ein neues Objekt erstellen </font></font><code>Truck</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und anschlieÃŸend sagen, dass die Kontextdaten der Ansicht </font></font><code>trucks_list</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mindestens ein Objekt enthalten. Bei dieser Art von Tests ist dies wichtig, da Sie eine Garantie benÃ¶tigen, dass Sie nicht an einem leeren Datensatz testen. Es ist wichtig zu verstehen, dass es </font></font><code>Truck</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nicht ausreicht </font><font style="vertical-align: inherit;">, nur eine Klasse zu instanziieren </font><font style="vertical-align: inherit;">. Sie mÃ¼ssen Ã¼berprÃ¼fen, ob es in den Kontext aufgenommen wurde. MÃ¶glicherweise filtern Sie die LKW-Liste, sodass Ihre Instanz wahrscheinlich </font></font><code>Truck</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nicht im Ergebnis enthalten ist.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nachdem wir all das getan haben, haben wir bereits bedeutende Fortschritte erzielt, aber es gibt noch einen weiteren wichtigen Schritt, der leicht zu vergessen ist. Wenn wir mÃ¶chten, dass unsere Ansichten skaliert werden, mÃ¼ssen wir sicherstellen, dass die Leistung nicht abnimmt, wenn die Anzahl der zurÃ¼ckgegebenen Artikel steigt. Am Ende haben wir immer noch ein Leistungsproblem, wenn wir uns nicht sechsmal an die Datenbank wenden, um einen Artikel zu erhalten, sondern 106, wenn wir 100 Artikel haben. Wir benÃ¶tigen eine konstante Anzahl von Datenbankaufrufen, die nicht von der Anzahl der zurÃ¼ckgegebenen Artikel abhÃ¤ngt. GlÃ¼cklicherweise ist dieses Problem auch sehr einfach gelÃ¶st. Wir mÃ¼ssen der Datenbank ein weiteres (oder mehrere) Elemente hinzufÃ¼gen und erneut die Anzahl der Treffer zÃ¤hlen. So wird der Test in der endgÃ¼ltigen Version aussehen:</font></font><br>
<br>
<pre><code class="django hljs"><span class="xml">from django.test import TestCase, Client
from django.urls import reverse
from trucks.models import Truck

class TrucksTestCase(TestCase):
    def test_list_trucks_view_performance(self):
        client = Client()

        Truck.objects.create(...)

        with self.assertNumQueries(6):
            response = client.get(reverse("trucks:list_trucks"))

        self.assertEqual(response.context["trucks_list"], 1)

        Truck.objects.create(...)

        with self.assertNumQueries(6):
            response = client.get(reverse("trucks:list_trucks"))

        self.assertEqual(response.context["trucks_list"], 2)</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beachten Sie, dass wir die Anzahl der im Kontext zurÃ¼ckgegebenen Artikel erneut Ã¼berprÃ¼fen, aber beim zweiten Durchlauf erwarten wir 2 LKWs ( </font></font><code>Truck</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font><font style="vertical-align: inherit;">Der Grund fÃ¼r dieses Verhalten ist Ã¤hnlich wie im ersten Fall. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Sicherstellen einer konstanten Anzahl von Aufrufen an die Datenbank beim HinzufÃ¼gen neuer Daten hat mehr PrioritÃ¤t als das Sicherstellen einer kleinen Anzahl von Aufrufen im Allgemeinen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Als letztes mÃ¼ssen Sie sicherstellen, dass Ihre Daten so hydratisiert wie mÃ¶glich sind. </font><font style="vertical-align: inherit;">Dies bedeutet, dass Sie verwandte Daten erstellen mÃ¼ssen, die wÃ¤hrend der Verarbeitung Ihrer Ansicht verwendet werden. </font><font style="vertical-align: inherit;">Wenn Sie dies nicht tun, besteht das Risiko, dass Ihre Anwendung in der Produktion hÃ¤ufiger auf die Datenbank zugreift als im Test (obwohl dies mÃ¶glicherweise erfolgreich ist). </font><font style="vertical-align: inherit;">In unserem Beispiel mussten wir </font></font><code>TruckDriver</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ein Unternehmen fÃ¼r unsere </font><font style="vertical-align: inherit;">erstellen</font></font><code>Truck</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<pre><code class="django hljs"><span class="xml">from trucks.models import Truck, TruckDriver
...
        truck = Truck.objects.create(...)
        TruckDriver.objects.create(name="Alex", truck=truck)</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn die Anzahl der Datenbankaufrufe nach AusfÃ¼hrung der oben beschriebenen Schritte nicht mehr konstant ist, suchen Sie nach weiteren Informationen zu den Methoden </font></font><i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">select_related</font></font></a> </i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">prefetch_related</font></font></a></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das ist alles fÃ¼r heute. Ich hoffe, dass Sie ab diesem Moment zu Beginn des Projekts die Anzahl der Abfragen Ã¼berprÃ¼fen, die Ihre Anwendung fÃ¼r die Datenbank hat. </font><font style="vertical-align: inherit;">Dies nimmt nicht viel Zeit in Anspruch, verhindert jedoch Probleme, die bei der ErhÃ¶hung der Anzahl der Benutzer Ihrer Anwendung auftreten kÃ¶nnen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ãœbrigens kÃ¶nnen Sie </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">den Kurs</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> noch </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">fangen</font></a><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Auf Wiedersehen.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de490186/index.html">Woraus wir JET BI gemacht haben. Architektur Business Intelligence System ohne lyrische Abweichungen</a></li>
<li><a href="../de490190/index.html">Ich werde suchen: Host-Geopositionierung nach IP-Adresse im globalen Internet am Beispiel des Binance-Krypto-Austauschs</a></li>
<li><a href="../de490194/index.html">Verwenden von RabbitMQ mit MonsterMQ Teil 4</a></li>
<li><a href="../de490196/index.html">[Flipper Zero] lehne Raspberry Pi ab, mache unser eigenes Board von Grund auf neu. Den richtigen WiFi-Chip finden</a></li>
<li><a href="../de490198/index.html">Vertrauen, aber Ã¼berprÃ¼fen! Demo-Zone mit Epson-Projektoren fÃ¼r Heimkino in der Demo-Halle Pult.ru</a></li>
<li><a href="../de490204/index.html">Die Zusammenfassung der Ereignisse fÃ¼r Personal- und IT-Personalvermittler im MÃ¤rz 2020</a></li>
<li><a href="../de490208/index.html">Backend-Bereich auf DUMP2020: Banter, Fan, Fail</a></li>
<li><a href="../de490210/index.html">Das Frontend beschleunigen. Wenn viele Serveranforderungen gut sind</a></li>
<li><a href="../de490222/index.html">Standardbibliothek zum Todestag</a></li>
<li><a href="../de490224/index.html">Modische Stealth</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>