<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🌨️ 🦏 😴 Übertragen von Dateien mit Pipes und anderen kleinen Dingen auf Delphi 🎦 🤹🏼 🍪</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Irgendwie haben sie mir die Aufgabe gestellt, mehrere Einheiten in Delphi zu schreiben , die Zugriff auf die folgenden Windows-Funktionen bieten:
 
 
...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Übertragen von Dateien mit Pipes und anderen kleinen Dingen auf Delphi</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/505568/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Irgendwie haben sie mir die Aufgabe gestellt, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mehrere Einheiten in Delphi zu</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> schreiben </font><font style="vertical-align: inherit;">, die Zugriff auf die folgenden Windows-Funktionen bieten:</font></font><br>
<br>
<ol>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gemeinsamer Speicher</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rohre</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
</ol><a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es war unmöglich, Komponenten von Drittanbietern zu verwenden. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Shared Memory</font></font></i></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sollte zum Sortieren großer Textdateien verwendet werden - mehrere zehn oder sogar Hunderte von Megabyte, auf die die </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TStringList</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> von </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EOutOfMemory</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fiel </font><font style="vertical-align: inherit;">. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pipes</font></font></i></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - zum Übertragen von Dateien von einer Anwendung zu einer anderen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Umschreiben des Beispielcodes aus der Microsoft-Dokumentation von C nach Delphi war nicht einmal die halbe Miete, sondern 10 Prozent. Die Hauptsache war, alles zusammenzubinden, bei Bedarf zusätzliche Funktionen hinzuzufügen und alles zum Laufen zu bringen und nicht nur als Quellcode zu existieren. </font><font style="vertical-align: inherit;">Infolgedessen wurde ein so hässliches Monster geboren, dass es niemandem gezeigt werden konnte, aber es war beängstigend, ihn nur anzusehen. </font><font style="vertical-align: inherit;">Vielleicht findet jemand etwas Nützliches in seinem Darm (was wäre wenn?), Also habe ich beschlossen, es hier zu posten. </font><font style="vertical-align: inherit;">Für allgemeinen Vorwurf. </font><font style="vertical-align: inherit;">Der vollständige Quellcode für diesen </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gräuel</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ist auf </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitHub</font></font></b></i></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> verfügbar </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Der Text des Artikels enthält die </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Namen der Dateien, in</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> denen Sie den einen oder anderen Teil der Implementierung sehen können. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die erste Aufgabe besteht darin, </font><i><font style="vertical-align: inherit;">die Textdatei</font></i><font style="vertical-align: inherit;"> zu </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sortieren</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - wurde so entschieden:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Öffnen Sie die Datei ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CreateFile</font></font></i></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir verwenden </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CreateFileMapping</font></font></i></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MapViewOfFile</font></font></i></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (common \ MemoryMappedFileUnit.pas).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir bestimmen die Kodierung der Datei. </font><font style="vertical-align: inherit;">Hier habe ich mich tatsächlich auf nur zwei Codierungen beschränkt: </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UTF-16</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ACP</font></font></i></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - eine Einzelbyte-Codierung mit einer Standardcodepage. </font><font style="vertical-align: inherit;">In russischsprachigen Windows </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wird</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> normalerweise </font><i><font style="vertical-align: inherit;">Windows-1251</font></i><font style="vertical-align: inherit;"> verwendet </font><font style="vertical-align: inherit;">.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir brechen den Text in Zeilen. </font><font style="vertical-align: inherit;">Das heißt, wir suchen nach Zeilenende-Markierungen und betrachten dementsprechend den Text von Markierung zu Markierung als eine Zeile.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sortieren Sie das resultierende Array von Zeichenfolgen (SortingTest \ MergeSorterUnit.pas).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir schreiben das sortierte Array von Strings zurück in die Datei.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PROFITIEREN!</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Kunde wollte die Sortierung auf jeden Fall multithreaded machen, daher wurde </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Merge Sort</font></font></i></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> als Sortieralgorithmus verwendet </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">(Dank an den Guru, der die funktionierende Implementierung erstellt und auf </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Stackoverflow veröffentlicht hat</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die zweite Aufgabe - das </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Übertragen der Datei von einer Anwendung in eine andere</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - erwies sich als viel schwieriger. </font><font style="vertical-align: inherit;">Die Implementierung </font><font style="vertical-align: inherit;">von </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pipes</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in Delphi anhand von Microsoft-Beispielen ist eine Sache, aber eine funktionierende Dateiübertragung daraus ist eine andere. </font><font style="vertical-align: inherit;">Als Serverprogramm bietet Microsoft mehrere Optionen:</font></font><br>
<br>
<ol>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Multithreaded Pipe Server</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pipe - </font><font style="vertical-align: inherit;">Server mit Namen überlappen I / O</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Named Pipe Server unter Verwendung von Abschlussroutinen</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie sich nach zweiwöchiger Qual herausstellte, ist die Implementierung des Dateiübertragungsmechanismus basierend auf der ersten Version des Servers ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Multithreaded Pipe Server</font></font></i></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) zu kompliziert. </font><font style="vertical-align: inherit;">Es ist sinnvoller, die zweite Option ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Named Pipe Server mit überlappenden E / A</font></font></i></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) zu verwenden. Damit ist die Implementierung viel einfacher (obwohl der Kunde aus irgendeinem Grund wirklich die </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">erste Version des Servers</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> wollte </font><font style="vertical-align: inherit;">). </font><font style="vertical-align: inherit;">Trotzdem musste ich mich quälen, um mich an diese ganze Sache zu erinnern. </font><font style="vertical-align: inherit;">Als Ergebnis wurde ein </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pipe-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> basierter </font><i><font style="vertical-align: inherit;">Dateisender</font></i><font style="vertical-align: inherit;"> geboren: </font><i><font style="vertical-align: inherit;">TCommunicationEndpointBase</font></i><font style="vertical-align: inherit;"> (CommunicationTest \ SimpleCommunicationUnit.pas). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kurz gesagt, die Dateiübertragung funktioniert folgendermaßen:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir erstellen einen Server, dh eine </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Named Pipe</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
<li> ,     <i>named pipe</i>.</li>
<li>  «  –   –  »     .</li>
<li>          .</li>
<li>     .</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alle Nuancen der Implementierung können auf </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitHub</font></font></b></i></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> angezeigt werden </font><font style="vertical-align: inherit;">, wo der vollständige Code für alle oben genannten Elemente veröffentlicht wird. </font><font style="vertical-align: inherit;">Alles ist als eine einzige Anwendung (BlitzTest \ BlitzTest.dproj) konzipiert. Laden Sie sie einfach herunter, bauen Sie sie zusammen und führen Sie sie aus. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ja, es gibt noch eine optimierte Implementierung der </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">StringReplace-</font></font></i></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Funktion </font><font style="vertical-align: inherit;">(BlitzTest \ StringReplaceCustomUnit.pas) </font><font style="vertical-align: inherit;">auf dem Heap </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Vielleicht wird jemand nützlich sein. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kommentare (einschließlich regelrechtes Fluchen) sind willkommen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn plötzlich (na ja, was wäre wenn?) Meine anderen Repositories für jemanden von Interesse sind, kann ich ein paar Worte darüber schreiben. </font><font style="vertical-align: inherit;">Es sei denn natürlich, dieser Text wird überhaupt veröffentlicht.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de505548/index.html">Ohne Registrierung und SMS: „sozial bedeutende“ Websites und eine Liste des Ministeriums für digitale Angelegenheiten</a></li>
<li><a href="../de505554/index.html">Beim Wettbewerb „Junge Techniker und Erfinder“ werden echte junge Erfinder nicht benötigt</a></li>
<li><a href="../de505556/index.html">Apple verfolgt geplünderte iPhones und gibt Plünderer der Polizei</a></li>
<li><a href="../de505558/index.html">Amazon DeepLens Deep Learning Kamera. Ein Projekt entpacken, verbinden und bereitstellen</a></li>
<li><a href="../de505560/index.html">Der zweite Satz für ein Produktmanagementprogramm im CS-Center: Was die Schüler sagen</a></li>
<li><a href="../de505574/index.html">Verstärktes Lernen durch wettbewerbsfähige neuronale Netze</a></li>
<li><a href="../en486014/index.html">SLAC Tour: US Department of Energy National Accelerator Laboratory at Stanford</a></li>
<li><a href="../en486018/index.html">Session Survey Results</a></li>
<li><a href="../en486024/index.html">Really simple graphics in R for science and journalism</a></li>
<li><a href="../en486028/index.html">Neural networks in the production of dentures</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>