<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üçì ‚ö™Ô∏è üêØ MVCC als eine M√∂glichkeit, die Transaktionsisolation sicherzustellen üí´ ü¶â üçâ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo Habr. Ich hei√üe Vladislav Rodin. Derzeit bin ich Leiter des High Load Architect-Kurses bei OTUS und unterrichte auch Kurse zur Softwarearchitekt...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>MVCC als eine M√∂glichkeit, die Transaktionsisolation sicherzustellen</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/504190/"><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hallo Habr. </font><font style="vertical-align: inherit;">Ich hei√üe Vladislav Rodin. </font><font style="vertical-align: inherit;">Derzeit bin ich Leiter des High Load Architect-Kurses bei OTUS und unterrichte auch Kurse zur Softwarearchitektur. </font></font></i><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Speziell f√ºr den Start eines neuen Sets f√ºr den Kurs </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Architekt hoher Lasten" habe</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ich ein kleines Material geschrieben, das ich gerne mit Ihnen teile.</font></font></b><br>
<br>
<img src="https://habrastorage.org/webt/hv/fy/ll/hvfyllpmp4nnso0wztz_u0ju278.png"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Einf√ºhrung</font></font></h2><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Letztes Mal haben</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> wir mit Ihnen √ºber die Folgen einer Schw√§chung der Transaktionsisolation in Datenbanken gesprochen. </font><font style="vertical-align: inherit;">Heute werden wir einen der Wege, um diese Isolation und Vermeidung der betrachteten Anomalien sicherzustellen, genauer diskutieren. </font><font style="vertical-align: inherit;">Wie Sie vielleicht bemerkt haben, wurden im letzten Artikel h√§ufig zwei Ans√§tze unterschieden: Einer beruhte auf der Tatsache, dass die Datens√§tze einige </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Versionen haben</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , und der zweite auf der Tatsache, dass wir </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">die</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Aufzeichnung auf die eine oder andere Weise </font><b><font style="vertical-align: inherit;">blockieren werden</font></b><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Somit werden zwei Klassen von Datenbanken unterschieden: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">versioniert und Blocker</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Heute werden wir dar√ºber sprechen, was Versionscontroller sind, und beim n√§chsten Mal die Ber√ºcksichtigung von Blockern verlassen.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Versionionisten</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie gesagt, einer der Ans√§tze basiert auf der Versionierung. </font><font style="vertical-align: inherit;">Es wird auch als </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">optimistischer</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ansatz oder </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MVCC (Multiversion Concurrency Control) bezeichnet</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Tats√§chlich erfolgt ein Versionsspeicher f√ºr aktive Transaktionen.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wo sind die Versionen gespeichert?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Implementierung des Mechanismus h√§ngt von der Datenbank ab. </font><font style="vertical-align: inherit;">Ich werde einige Beispiele nennen.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PostgreSQL</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jede Transaktion ist durch ein id-shnik gekennzeichnet. Id-shnik-Transaktionen wachsen monoton. Jede Zeile verf√ºgt √ºber zwei Attribute, die Metainformationen f√ºr die Bereitstellung eines Mechanismus darstellen: updated_by_id - ID der Transaktion, die diesen Datensatz zuletzt aktualisiert hat, und delete_by_id - ID der Transaktion, die diesen Datensatz gel√∂scht hat. Wenn eine neue Transaktion eintrifft, ermittelt die Datenbank die ID-Nicks der aktuell ausgef√ºhrten Transaktionen. Die durch diese Transaktionen vorgenommenen √Ñnderungen werden in der eingehenden Transaktion ignoriert. Es stellt sich heraus, dass die eingehende Transaktion wie mit ihrer Version der Daten funktioniert. Alte Versionen von Daten werden am selben Ort wie aktuelle gespeichert. Wenn Update eintrifft, wird eine weitere Zeile hinzugef√ºgt und dieser Datensatz wird aktiv. Es ist auch klar, dass f√ºr den korrekten Betrieb dieses Schemas ein "Garbage Collector" erforderlich ist:Wenn ein Datensatz "delete_by_id = 100" hat und die minimale ID-shnik unter den aktuellen Transaktionen 150 betr√§gt, muss dieser Datensatz gel√∂scht werden.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL (InnoDB-Engine)</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In der MySQL-Datenbank wird nur die aktuelle Version gespeichert. </font><font style="vertical-align: inherit;">Wenn Update eintrifft, werden die Daten in der Tabellendatei korrigiert. </font><font style="vertical-align: inherit;">Nach dem Anpassen der Daten befindet sich die vorherige Version im Rollback-Protokoll. </font><font style="vertical-align: inherit;">In MySQL gibt es mehrere Rollback-Protokolle (sie unterscheiden sich f√ºr insert'ov und update'ov). </font><font style="vertical-align: inherit;">Wenn f√ºr eine Transaktion eine fr√ºhere Version der Zeile erforderlich ist, macht das System das Protokoll r√ºckg√§ngig und stellt die erforderliche Version wieder her. </font><font style="vertical-align: inherit;">Die Version wird auch durch die Transaktions-ID bestimmt.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Orakel</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Schema √§hnelt MySQL: Die aktuellen Versionen werden in der Datendatei gespeichert, alte Versionen werden dank R√ºckg√§ngig-Protokoll wiederhergestellt. </font><font style="vertical-align: inherit;">Das R√ºckg√§ngig-Protokoll in Oracle wird zyklisch neu geschrieben. </font><font style="vertical-align: inherit;">Daher ist eine Situation m√∂glich, in der eine Transaktion eine sehr alte Version des Datensatzes ben√∂tigt, diese jedoch im R√ºckg√§ngig-Protokoll nicht mehr vorhanden ist. </font><font style="vertical-align: inherit;">In diesem Fall schl√§gt die Transaktion fehl.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS SQL</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MS SQL erm√∂glicht die Einbeziehung von Versionierungs- und Blockermodi. Um den versionierten Modus in den Datenbankeinstellungen zu aktivieren, m√ºssen Sie Snapshots aktivieren. In MS SQL gibt es eine Systemtabelle (tempdb), in der tempor√§re Tabellen gespeichert werden. Es ist Tempdb, das zum Speichern alter Versionen verwendet wird, w√§hrend die Tabelle die aktuellen Versionen enth√§lt. Der Systemprozess √ºberwacht, dass es in Tempdb Versionen gibt, auf die sich niemand bezieht. Sie k√∂nnen gel√∂scht werden. Wenn die Transaktion lange dauert, werden Versionen daf√ºr gespeichert. Tempdb w√§chst, erreicht seine maximale Gr√∂√üe, MS SQL reserviert ein wenig Speicherplatz. Wenn es endet, k√∂nnen Transaktionen mit Snapshot-Isolation nicht ausgef√ºhrt werden. Wenn diese Betriebsart verwendet wird, m√ºssen lange Transaktionen √ºberwacht werden.weil das Rollback einer solchen Transaktion in der Zeit so viel kosten kann, wie es funktioniert, und vielleicht ein bisschen mehr.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Konflikte</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dieser Ansatz wird als optimistisch bezeichnet, da wir hoffen, dass es keinen Konflikt gibt, wenn parallele Daten√§nderungstransaktionen ausgef√ºhrt werden. </font><font style="vertical-align: inherit;">Was passiert im Konfliktfall? </font><font style="vertical-align: inherit;">Angenommen, die Transaktion T1 √§ndert 10.000 Datens√§tze und die Transaktion T2 √§ndert 1 Datensatz parallel. </font><font style="vertical-align: inherit;">Wenn dieser 1 Datensatz in diesen 10.000 enthalten ist, wird eine der Transaktionen zur√ºckgesetzt: Wenn T1 zuerst ausgef√ºhrt wird, wird T2 zur√ºckgesetzt, andernfalls umgekehrt.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rollback-Mechanismus</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Mechanismus des Transaktions-Rollbacks in versionierten Versionen h√§ngt von der Implementierung ab. </font><font style="vertical-align: inherit;">In PostgreSQL wird beispielsweise eine Transaktion als evakuiert markiert und durch Vakuum wird Speicherplatz freigegeben. </font><font style="vertical-align: inherit;">Ein solcher Mechanismus ist schnell genug. </font><font style="vertical-align: inherit;">In Oracle werden f√ºr das Rollback Daten aus dem R√ºckg√§ngig-Protokoll wiederhergestellt. </font><font style="vertical-align: inherit;">In diesem Fall erh√∂ht sich die Betriebszeit, sie ist jedoch immer noch viel schneller als in Schlie√üf√§chern. </font><font style="vertical-align: inherit;">MySQL funktioniert genauso wie Oracle.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fazit</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der optimistische Ansatz ist gut, da der Autor den Leser nicht blockiert, sondern einfach seine Version der Daten liest. </font><font style="vertical-align: inherit;">Daher ist die Versionierung von Vorteil, wenn die Hauptlast eher beim Lesen als beim Schreiben liegt (Blog, Berichterstellung und andere F√§lle, in denen Sie h√§ufig und h√§ufig lesen m√ºssen).</font></font><br>
<br>
<hr><br>
<b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erfahren Sie hier mehr √ºber den Kurs.</font></font></a></b><br>
<br>
<hr></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de504180/index.html">Die Geschichte, wie wir BigQuery gez√§hmt haben</a></li>
<li><a href="../de504182/index.html">Reviewix Solution500 C500 3D-Scanner</a></li>
<li><a href="../de504184/index.html">Erstellen eines Handelsbots mithilfe von maschinellem Lernen in der Zeitreihenanalyse</a></li>
<li><a href="../de504186/index.html">Paul Graham: Wie man n√ºtzliche Texte schreibt (vollst√§ndig)</a></li>
<li><a href="../de504188/index.html">Quarant√§ne, Online-Systeme und Datenwissenschaft. Wer denkt an Kundenbindung?</a></li>
<li><a href="../de504194/index.html">Das Ergebnis einer Umfrage unter Entwicklern zu Stack Overflow 2020 (+ Habraopros)</a></li>
<li><a href="../de504196/index.html">NFC: Analyse der Nahfeldkommunikationstechnologie</a></li>
<li><a href="../de504198/index.html">SwiftUI in den Regalen: Animation. Teil 1</a></li>
<li><a href="../de504204/index.html">IBM Workshops: Quarkus (ultraschnelles Java f√ºr Microservices), Jakarta EE und OpenShift</a></li>
<li><a href="../de504208/index.html">So automatisieren Sie ein Shared Service Center</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>