<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ’º ğŸ’´ ğŸ‘… Afficher les rÃ©sultats de recherche et les problÃ¨mes de performances ğŸ’– ğŸ§€ ğŸ‘¨ğŸ»â€ğŸ­</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="L'un des scÃ©narios typiques dans toutes les applications courantes consiste Ã  rechercher des donnÃ©es selon certains critÃ¨res et Ã  les afficher sous un...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Afficher les rÃ©sultats de recherche et les problÃ¨mes de performances</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/epam_systems/blog/493438/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'un des scÃ©narios typiques dans toutes les applications courantes consiste Ã  rechercher des donnÃ©es selon certains critÃ¨res et Ã  les afficher sous une forme facile Ã  lire. </font><font style="vertical-align: inherit;">Il peut Ã©galement y avoir des possibilitÃ©s supplÃ©mentaires de tri, de regroupement, de pagination. </font><font style="vertical-align: inherit;">La tÃ¢che, en thÃ©orie, est insignifiante, mais lors de sa rÃ©solution, de nombreux dÃ©veloppeurs font un certain nombre d'erreurs, qui souffrent alors des performances. </font><font style="vertical-align: inherit;">Essayons d'envisager diffÃ©rentes solutions Ã  ce problÃ¨me et formulons des recommandations pour choisir la mise en Å“uvre la plus efficace.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ms/kc/-s/mskc-s_1t4wcxa9w7i04zg4cjjq.jpeg" alt="image"><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Option de pagination n Â° 1</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'option la plus simple qui vous vient Ã  l'esprit est de paginer les rÃ©sultats de la recherche sous sa forme la plus classique.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/rd/xx/vs/rdxxvst5xhcdfxzvlgrob1csxdk.png" width="498" height="232"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Supposons qu'une application utilise une base de donnÃ©es relationnelle. </font><font style="vertical-align: inherit;">Dans ce cas, pour afficher les informations sous cette forme, vous devrez exÃ©cuter deux requÃªtes SQL:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Obtenez des lignes pour la page actuelle.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Calculez le nombre total de lignes qui correspondent aux critÃ¨res de recherche - cela est nÃ©cessaire pour afficher les pages.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ConsidÃ©rez la premiÃ¨re requÃªte en utilisant le </font><font style="vertical-align: inherit;">serveur de </font><font style="vertical-align: inherit;">base de donnÃ©es MS SQL test </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AdventureWorks</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour 2016 </font><font style="vertical-align: inherit;">comme exemple </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Pour cela, nous utiliserons la table Sales.SalesOrderHeader:</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> Sales.SalesOrderHeader
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> OrderDate <span class="hljs-keyword">DESC</span>
<span class="hljs-keyword">OFFSET</span> <span class="hljs-number">0</span> <span class="hljs-keyword">ROWS</span>
<span class="hljs-keyword">FETCH</span> <span class="hljs-keyword">NEXT</span> <span class="hljs-number">50</span> <span class="hljs-keyword">ROWS</span> <span class="hljs-keyword">ONLY</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La requÃªte ci-dessus affichera les 50 premiÃ¨res commandes d'une liste triÃ©e par ordre dÃ©croissant par date d'ajout, en d'autres termes, les 50 derniÃ¨res commandes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il s'exÃ©cute rapidement sur une base de test, mais regardons le plan d'exÃ©cution et les statistiques d'E / S:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/rw/e8/u8/rwe8u8un-1t5bm3yttan4qsfqrg.png" width="624" height="144"></div><br>
<pre><code class="plaintext hljs">Table 'SalesOrderHeader'. Scan count 1, logical reads 698, physical reads 0, read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob read-ahead reads 0.</code></pre><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vous pouvez obtenir des statistiques d'E / S pour chaque demande en exÃ©cutant la commande SET STATISTICS IO ON dans l'exÃ©cution de la requÃªte. </font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme vous pouvez le voir dans le plan d'exÃ©cution, le plus gourmand en ressources consiste Ã  trier toutes les lignes de la table source en fonction de la date Ã  laquelle elles ont Ã©tÃ© ajoutÃ©es. </font><font style="vertical-align: inherit;">Et le problÃ¨me est que plus il y a de lignes dans le tableau, plus le tri sera Â«difficileÂ». </font><font style="vertical-align: inherit;">Dans la pratique, de telles situations doivent Ãªtre Ã©vitÃ©es, alors ajoutez l'index Ã  la date d'ajout et voyez si la consommation des ressources a changÃ©:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/7y/so/g1/7ysog13xd9kalhv9fakieghj4je.png" width="720" height="148"></div><br>
<pre><code class="plaintext hljs">Table 'SalesOrderHeader'. Scan count 1, logical reads 165, physical reads 0, read-ahead reads 5, lob logical reads 0, lob physical reads 0, lob read-ahead reads 0.
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De toute Ã©vidence, cela s'est beaucoup amÃ©liorÃ©. </font><font style="vertical-align: inherit;">Mais tous les problÃ¨mes ont-ils Ã©tÃ© rÃ©solus? </font><font style="vertical-align: inherit;">Modifions la demande de recherche pour les commandes dont le coÃ»t total des marchandises dÃ©passe 100 $:</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> Sales.SalesOrderHeader
<span class="hljs-keyword">WHERE</span> SubTotal &gt; <span class="hljs-number">100</span>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> OrderDate <span class="hljs-keyword">DESC</span>
<span class="hljs-keyword">OFFSET</span> <span class="hljs-number">0</span> <span class="hljs-keyword">ROWS</span>
<span class="hljs-keyword">FETCH</span> <span class="hljs-keyword">NEXT</span> <span class="hljs-number">50</span> <span class="hljs-keyword">ROWS</span> <span class="hljs-keyword">ONLY</span>
</code></pre><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/yn/_c/7s/yn_c7stdebp1utx8_ck4fbrvxjq.png" width="800" height="137"></div><br>
<pre><code class="plaintext hljs">Table 'SalesOrderHeader'. Scan count 1, logical reads 1081, physical reads 0, read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob read-ahead reads 0.</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons une situation amusante: le plan de requÃªte est lÃ©gÃ¨rement pire que le prÃ©cÃ©dent, mais le nombre rÃ©el de lectures logiques est presque deux fois plus qu'avec une analyse complÃ¨te de la table. </font><font style="vertical-align: inherit;">Il existe un moyen de sortir - si nous Ã©tablissons le prix composite Ã  partir de l'indice existant et ajoutons le prix total des marchandises comme deuxiÃ¨me champ, nous obtenons alors 165 lectures logiques:</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">INDEX</span> IX_SalesOrderHeader_OrderDate_SubTotal <span class="hljs-keyword">on</span> Sales.SalesOrderHeader(OrderDate, SubTotal);
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cette sÃ©rie d'exemples peut Ãªtre poursuivie pendant longtemps, mais les deux principales pensÃ©es que je veux exprimer ici sont:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'ajout de tout nouveau critÃ¨re ou ordre de tri Ã  la requÃªte de recherche peut affecter considÃ©rablement la vitesse de son exÃ©cution.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mais si nous devons soustraire seulement une partie des donnÃ©es, et pas tous les rÃ©sultats qui correspondent aux conditions de recherche, il existe de nombreuses faÃ§ons d'optimiser une telle requÃªte.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Passons maintenant Ã  la deuxiÃ¨me requÃªte, mentionnÃ©e au tout dÃ©but - Ã  celle qui compte le nombre d'enregistrements qui rÃ©pondent aux critÃ¨res de recherche. </font><font style="vertical-align: inherit;">Prenons le mÃªme exemple - trouver des commandes qui coÃ»tent plus de 100 $:</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">COUNT</span>(<span class="hljs-number">1</span>) <span class="hljs-keyword">FROM</span> Sales.SalesOrderHeader
<span class="hljs-keyword">WHERE</span> SubTotal &gt; <span class="hljs-number">100</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En prÃ©sence de l'indice composite indiquÃ© ci-dessus, on obtient:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/nb/tg/yz/nbtgyzsg7her2lswpnfq2jbmotk.png" width="517" height="197"></div><br>
<pre><code class="plaintext hljs">Table 'SalesOrderHeader'. Scan count 1, logical reads 698, physical reads 0, read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob read-ahead reads 0.</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le fait que la requÃªte passe Ã  travers l'index entier n'est pas surprenant, car le champ SubTotal n'est pas en premiÃ¨re position, donc la requÃªte ne peut pas l'utiliser. Le problÃ¨me est rÃ©solu en ajoutant un autre index au champ SubTotal et, par consÃ©quent, ne donne dÃ©jÃ  que 48 lectures logiques. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez donner quelques autres exemples de demandes de comptage de la quantitÃ©, mais l'essentiel reste le mÃªme: la </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rÃ©ception d'une partie des donnÃ©es et le comptage de la quantitÃ© totale sont deux demandes fondamentalement diffÃ©rentes</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , et chacune nÃ©cessite ses propres mesures d'optimisation. Dans le cas gÃ©nÃ©ral, vous ne pouvez pas trouver une combinaison d'index qui fonctionne aussi bien pour les deux requÃªtes.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par consÃ©quent, l'une des exigences importantes qui doit Ãªtre clarifiÃ©e lors du dÃ©veloppement d'une telle solution de recherche est de savoir s'il est vraiment important pour l'entreprise de voir le nombre total d'objets trouvÃ©s. </font><font style="vertical-align: inherit;">Il arrive souvent que non. </font><font style="vertical-align: inherit;">Et la navigation vers des numÃ©ros de page spÃ©cifiques, Ã  mon avis, est une solution avec une portÃ©e trÃ¨s Ã©troite, car la plupart des scÃ©narios de pagination ressemblent Ã  "aller Ã  la page suivante".</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Option de pagination n Â° 2</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Supposons que les utilisateurs ne souhaitent pas connaÃ®tre le nombre total d'objets trouvÃ©s. </font><font style="vertical-align: inherit;">Essayons de simplifier la page de recherche:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/tc/pr/1t/tcpr1teevrkdz8tcwsbjmx_dl5i.png" width="498" height="230"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En fait, seul le fait qu'il n'y ait aucun moyen d'accÃ©der Ã  des numÃ©ros de page spÃ©cifiques a changÃ©, et maintenant ce tableau n'a plus besoin de savoir combien d'entre eux peuvent Ãªtre affichÃ©s. Mais la question se pose - comment le tableau sait-il s'il existe des donnÃ©es pour la page suivante (afin d'afficher correctement le lien Â«SuivantÂ»)? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La rÃ©ponse est trÃ¨s simple: vous pouvez soustraire de la base de donnÃ©es un enregistrement de plus que ce dont vous avez besoin pour afficher, et la prÃ©sence de cet enregistrement "supplÃ©mentaire" montrera s'il y a la partie suivante. Ainsi, pour obtenir une page de donnÃ©es, vous devrez effectuer une seule requÃªte, ce qui amÃ©liore considÃ©rablement les performances et facilite la prise en charge de cette fonctionnalitÃ©. Dans ma pratique, il y a eu un cas oÃ¹ le refus de compter le nombre total d'enregistrements a accÃ©lÃ©rÃ© la sortie des rÃ©sultats de 4 Ã  5 fois.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour cette approche, il existe plusieurs options pour l'interface utilisateur: les commandes Â«retourÂ» et Â«avantÂ», comme dans l'exemple ci-dessus, le bouton Â«charger plusÂ», qui ajoute simplement une nouvelle portion aux rÃ©sultats affichÃ©s, Â«dÃ©filement infiniÂ», qui fonctionne sur le principe de Â«charger plusÂ» ", Mais le signal pour obtenir la portion suivante est que l'utilisateur fasse dÃ©filer tous les rÃ©sultats affichÃ©s jusqu'Ã  la fin. </font><font style="vertical-align: inherit;">Quelle que soit la solution visuelle, le principe de l'Ã©chantillonnage des donnÃ©es reste le mÃªme.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les nuances de la mise en Å“uvre de la pagination</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans tous les exemples de requÃªtes ci-dessus, l'approche Â«offset + numÃ©roÂ» est utilisÃ©e, lorsque la requÃªte elle-mÃªme indique dans quel ordre les lignes de rÃ©sultat et combien de lignes doivent Ãªtre retournÃ©es. </font><font style="vertical-align: inherit;">Tout d'abord, rÃ©flÃ©chissez Ã  la meilleure faÃ§on d'organiser le transfert des paramÃ¨tres dans ce cas. </font><font style="vertical-align: inherit;">En pratique, j'ai rencontrÃ© plusieurs faÃ§ons:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NumÃ©ro de sÃ©rie de la page demandÃ©e (pageIndex), taille de la page (pageSize).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le numÃ©ro de sÃ©rie du premier enregistrement Ã  renvoyer (startIndex), le nombre maximal d'enregistrements en consÃ©quence (count).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le numÃ©ro de sÃ©rie du premier enregistrement Ã  renvoyer (startIndex), le numÃ©ro de sÃ©rie du dernier enregistrement Ã  renvoyer (endIndex).</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ã€ premiÃ¨re vue, il peut sembler que c'est si Ã©lÃ©mentaire qu'il n'y a pas de diffÃ©rence. </font><font style="vertical-align: inherit;">Mais ce n'est pas le cas - l'option la plus pratique et universelle est la seconde (startIndex, count). </font><font style="vertical-align: inherit;">Il y a plusieurs raisons Ã  cela:</font></font><br>
<br>
<ul>
<li>    +1 ,  ,    pageIndex  pageSize  . ,    50   .    ,      ,  .   Â«+1Â»    , ,          1  51,   â€”  51  101  ..     51   pageIndex,      52  102  .. ,             â€”     Â«Â» ,     .</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La troisiÃ¨me option n'a aucun sens, car pour exÃ©cuter des requÃªtes dans la plupart des bases de donnÃ©es, vous devrez toujours transfÃ©rer la quantitÃ©, pas l'index du dernier enregistrement. </font><font style="vertical-align: inherit;">Soit la soustraction de startIndex de endIndex et une opÃ©ration arithmÃ©tique Ã©lÃ©mentaire, mais c'est superflu ici.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DÃ©crivons maintenant les dÃ©fauts de l'implÃ©mentation de la pagination via "offset + quantitÃ©":</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Obtenir chaque page suivante sera plus coÃ»teux et plus lent que la prÃ©cÃ©dente, car la base de donnÃ©es devra toujours parcourir tous les enregistrements Â«depuis le dÃ©butÂ» en fonction des critÃ¨res de recherche et de tri, puis s'arrÃªter au fragment souhaitÃ©.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tous les SGBD ne peuvent pas prendre en charge cette approche.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il existe des alternatives, mais elles sont Ã©galement imparfaites. </font><font style="vertical-align: inherit;">La premiÃ¨re de ces approches est appelÃ©e Â«pagination par jeu de clÃ©sÂ» ou Â«mÃ©thode de rechercheÂ» et consiste en ce qui suit: aprÃ¨s avoir reÃ§u une partie, vous pouvez vous souvenir des valeurs des champs du dernier enregistrement de la page, puis les utiliser pour obtenir la partie suivante. </font><font style="vertical-align: inherit;">Par exemple, nous avons effectuÃ© la demande suivante:</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> Sales.SalesOrderHeader
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> OrderDate <span class="hljs-keyword">DESC</span>
<span class="hljs-keyword">OFFSET</span> <span class="hljs-number">0</span> <span class="hljs-keyword">ROWS</span>
<span class="hljs-keyword">FETCH</span> <span class="hljs-keyword">NEXT</span> <span class="hljs-number">50</span> <span class="hljs-keyword">ROWS</span> <span class="hljs-keyword">ONLY</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et dans le dernier enregistrement, nous avons obtenu la valeur de la date de commande '2014-06-29'. </font><font style="vertical-align: inherit;">Ensuite, pour obtenir la page suivante, vous pouvez essayer de faire ceci:</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> Sales.SalesOrderHeader
<span class="hljs-keyword">WHERE</span> OrderDate &lt; <span class="hljs-string">'2014-06-29'</span>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> OrderDate <span class="hljs-keyword">DESC</span>
<span class="hljs-keyword">OFFSET</span> <span class="hljs-number">0</span> <span class="hljs-keyword">ROWS</span>
<span class="hljs-keyword">FETCH</span> <span class="hljs-keyword">NEXT</span> <span class="hljs-number">50</span> <span class="hljs-keyword">ROWS</span> <span class="hljs-keyword">ONLY</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le problÃ¨me est que OrderDate est un champ non unique et la condition mentionnÃ©e ci-dessus est susceptible d'ignorer un grand nombre des lignes requises. </font><font style="vertical-align: inherit;">Pour rendre cette demande sans ambiguÃ¯tÃ©, vous devez ajouter un champ unique Ã  la condition (supposons que 75074 est la derniÃ¨re valeur de la clÃ© primaire de la premiÃ¨re partie):</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> Sales.SalesOrderHeader
<span class="hljs-keyword">WHERE</span> (OrderDate = <span class="hljs-string">'2014-06-29'</span> <span class="hljs-keyword">AND</span> SalesOrderID &lt; <span class="hljs-number">75074</span>)
   <span class="hljs-keyword">OR</span> (OrderDate &lt; <span class="hljs-string">'2014-06-29'</span>)
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> OrderDate <span class="hljs-keyword">DESC</span>, SalesOrderID <span class="hljs-keyword">DESC</span>
<span class="hljs-keyword">OFFSET</span> <span class="hljs-number">0</span> <span class="hljs-keyword">ROWS</span>
<span class="hljs-keyword">FETCH</span> <span class="hljs-keyword">NEXT</span> <span class="hljs-number">50</span> <span class="hljs-keyword">ROWS</span> <span class="hljs-keyword">ONLY</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cette option fonctionnera correctement, mais dans le cas gÃ©nÃ©ral, elle sera difficile Ã  optimiser, car la condition contient l'opÃ©rateur OU. Si la valeur de la clÃ© primaire augmente avec la croissance de OrderDate, la condition peut Ãªtre simplifiÃ©e en ne laissant que le filtre par SalesOrderID. Mais s'il n'y a pas de corrÃ©lation stricte entre les valeurs de la clÃ© primaire et le champ selon lequel le rÃ©sultat est triÃ© - dans la plupart des SGBD, ce OU ne peut pas Ãªtre Ã©vitÃ©. L'exception que je connais est PostgreSQL, oÃ¹ la comparaison de tuple est entiÃ¨rement prise en charge, et la condition ci-dessus peut Ãªtre Ã©crite comme Â«WHERE (OrderDate, SalesOrderID) &lt;('2014-06-29', 75074). Si vous avez une clÃ© composite avec ces deux champs, une demande similaire devrait Ãªtre assez simple. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La deuxiÃ¨me approche alternative peut Ãªtre trouvÃ©e, par exemple, dans l' </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API ElasticSearch scroll</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ou</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cosmos DB</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - lorsqu'une requÃªte en plus des donnÃ©es renvoie un identifiant spÃ©cial avec lequel vous pouvez obtenir le prochain lot de donnÃ©es. </font><font style="vertical-align: inherit;">Si cet identifiant a une durÃ©e de vie illimitÃ©e (comme dans Comsos DB), alors c'est un excellent moyen d'implÃ©menter la pagination avec une transition sÃ©quentielle entre les pages (option n Â° 2 mentionnÃ©e ci-dessus). </font><font style="vertical-align: inherit;">Ses inconvÃ©nients possibles: tous les SGBD ne sont pas pris en charge; </font><font style="vertical-align: inherit;">l'identifiant reÃ§u pour la partie suivante peut avoir une durÃ©e de vie limitÃ©e, ce qui n'est gÃ©nÃ©ralement pas appropriÃ© pour implÃ©menter une interaction utilisateur (comme l'API ElasticSearch scroll).</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Filtrage complexe</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous compliquons encore la tÃ¢che. </font><font style="vertical-align: inherit;">Supposons qu'il soit nÃ©cessaire d'implÃ©menter la recherche dite Ã  facettes, familiÃ¨re Ã  tout le monde dans les magasins en ligne. </font><font style="vertical-align: inherit;">Les exemples ci-dessus basÃ©s sur la table de commande ne sont pas trÃ¨s indicatifs dans ce cas, nous allons donc passer Ã  la table Product de la base de donnÃ©es AdventureWorks:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/di/ws/13/diws13cm-qjxoy3igxslnbvizca.png" width="595" height="234"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quelle est l'idÃ©e de la recherche Ã  facettes? </font><font style="vertical-align: inherit;">En ce que, pour chaque Ã©lÃ©ment de filtre, le nombre d'enregistrements correspondant Ã  ce critÃ¨re est affichÃ© </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">en tenant compte des filtres sÃ©lectionnÃ©s dans toutes les autres catÃ©gories</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par exemple, si nous sÃ©lectionnons la catÃ©gorie VÃ©los et la couleur Noir dans cet exemple, le tableau n'affichera que les vÃ©los noirs, mais en mÃªme temps:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour chaque critÃ¨re du groupe Â«CatÃ©goriesÂ», le nombre de produits de cette catÃ©gorie en noir sera affichÃ©.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour chaque critÃ¨re du groupe Couleurs, le nombre de vÃ©los de cette couleur sera affichÃ©.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici un exemple de sortie du rÃ©sultat pour de telles conditions:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/y8/v2/q2/y8v2q2j76mcfnmjmirzu8jrnhyu.png" width="605" height="234"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si en plus de marquer la catÃ©gorie Â«VÃªtementsÂ», le tableau indiquera Ã©galement les vÃªtements noirs disponibles. </font><font style="vertical-align: inherit;">Le nombre de produits noirs dans la section "Couleur" sera Ã©galement recalculÃ© en fonction des nouvelles conditions, seulement dans la section "CatÃ©gories" rien ne changera ... J'espÃ¨re que ces exemples suffisent pour comprendre l'algorithme de recherche Ã  facettes familier. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Imaginez maintenant comment cela peut Ãªtre mis en Å“uvre sur une base relationnelle. </font><font style="vertical-align: inherit;">Chaque groupe de critÃ¨res, tels que la catÃ©gorie et la couleur, nÃ©cessitera une demande distincte:</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> pc.ProductCategoryID, pc.Name, <span class="hljs-keyword">COUNT</span>(<span class="hljs-number">1</span>) <span class="hljs-keyword">FROM</span> Production.Product p
  <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> Production.ProductSubcategory ps <span class="hljs-keyword">ON</span> p.ProductSubcategoryID = ps.ProductSubcategoryID
  <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> Production.ProductCategory pc <span class="hljs-keyword">ON</span> ps.ProductCategoryID = pc.ProductCategoryID
<span class="hljs-keyword">WHERE</span> p.Color = <span class="hljs-string">'Black'</span>
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> pc.ProductCategoryID, pc.Name
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">COUNT</span>(<span class="hljs-number">1</span>) <span class="hljs-keyword">DESC</span>
</code></pre><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/mf/79/az/mf79azaflzgu-1gatq4gtbhcdzw.png" width="331" height="90"></div><br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> Color, <span class="hljs-keyword">COUNT</span>(<span class="hljs-number">1</span>) <span class="hljs-keyword">FROM</span> Production.Product p
  <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> Production.ProductSubcategory ps <span class="hljs-keyword">ON</span> p.ProductSubcategoryID = ps.ProductSubcategoryID
<span class="hljs-keyword">WHERE</span> ps.ProductCategoryID = <span class="hljs-number">1</span> <span class="hljs-comment">--Bikes</span>
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> Color
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">COUNT</span>(<span class="hljs-number">1</span>) <span class="hljs-keyword">DESC</span>
</code></pre><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/cf/ec/r5/cfecr5njjmi93lsdrei1teygmhi.png" width="190" height="110"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quel est le problÃ¨me avec cette dÃ©cision? </font><font style="vertical-align: inherit;">TrÃ¨s simple - il n'Ã©volue pas bien. </font><font style="vertical-align: inherit;">Chaque section de filtre nÃ©cessite une requÃªte distincte pour compter les quantitÃ©s, et ces requÃªtes ne sont pas les plus simples. </font><font style="vertical-align: inherit;">Dans les magasins en ligne, dans certaines sections, il peut y avoir plusieurs dizaines de sections du filtre, ce qui peut Ãªtre un grave problÃ¨me de performances. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Habituellement, aprÃ¨s ces dÃ©clarations, ils m'offrent quelques solutions, Ã  savoir:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Combinez tous les comptages de quantitÃ© en une seule requÃªte. </font><font style="vertical-align: inherit;">Techniquement, cela est possible en utilisant le mot-clÃ© UNION, mais cela n'aidera pas beaucoup dans les performances - de toute faÃ§on, la base de donnÃ©es devra exÃ©cuter chaque fragment Ã  partir de zÃ©ro.</font></font></li>
<li> .      ,    .   ,      . ,   10 Â«Â»,     5 .   Â«Â»    ,       -.         9- ,  ,        .     50 ,    ,     2<sup>50</sup>.         ,  .     ,            5-10 . ,          ,  -  ,      ,                (     ).</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Heureusement, une telle tÃ¢che a depuis longtemps des solutions suffisamment efficaces qui fonctionnent de maniÃ¨re prÃ©visible sur de grandes quantitÃ©s de donnÃ©es. Pour l'une de ces options, il est logique de diviser le recomptage de facette et d'obtenir la page de rÃ©sultats en deux appels parallÃ¨les au serveur et d'organiser l'interface utilisateur de telle sorte que le chargement des donnÃ©es sur les facettes "n'interfÃ¨re pas" avec l'affichage des rÃ©sultats de la recherche.</font></font><br>
<br>
<ul>
<li>   Â«Â»   . ,        ,       ,   ,      â€” Â«1425  , ?Â»       ,    Â«Â».                 Â«Â».  ,   ,             .        -. ,       ,        .</li>
<li> search engine      ,   Solr, ElasticSearch, Sphinx  .      Â«Â»         .    ,          ,       â€”     .      ,  search engine       ,    :     ,    ,    ;       search engine      .       â€”     .      Â« Â».          Â«Â»    ,   ,            .      ,   -  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">transactional outbox</a>      .</li>
</ul><br>
<h2></h2><br>
<ol>
<li>     â€”  ,             .   Â«Â»  Â«Â» â€”    ,      :<br>
<ul>
<li>                   â€”       .</li>
<li>   ,         ,    ,     .  -          â€”    .</li>
</ul></li>
<li>                ,          â€”         #2.</li>
<li>     faceted search,        :<br>
<ul>
<li>        .</li>
<li> search engine   Solr, ElasticSearch, Sphinx  .   ,         ,            . </li>
</ul></li>
<li>   faceted search              .      ,   ,        .</li>
<li>   SQL   ,   ,    ,           (   Â«Â» ).           ,   â€”  Â«Â».           ,        .</li>
</ol></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr493426/index.html">Organisation du code dans les microservices et mon approche de l'utilisation de l'architecture hexagonale et du DDD</a></li>
<li><a href="../fr493428/index.html">"Nous ne donnerons pas lieu Ã  des thÃ©ories du complot." Parlez de confÃ©rences ML avec des gens des sociÃ©tÃ©s scientifiques et informatiques</a></li>
<li><a href="../fr493430/index.html">Architecture nette pour les applications Web</a></li>
<li><a href="../fr493432/index.html">Pourquoi ne pas commencer une carriÃ¨re dans une petite entreprise non informatique</a></li>
<li><a href="../fr493436/index.html">Programme pour changer les droits d'accÃ¨s et enregistrer les noms de fichiers / rÃ©pertoires sur Bash</a></li>
<li><a href="../fr493440/index.html">Marketing d'influence en Chine: sur quoi il se base et ce que les influenceurs peuvent offrir dans le contexte des urgences</a></li>
<li><a href="../fr493442/index.html">Rappel EPI</a></li>
<li><a href="../fr493444/index.html">Le projet "Verre". Tasses Ã  thÃ© / cafÃ© jetables d'efficacitÃ© Ã©nergÃ©tique</a></li>
<li><a href="../fr493446/index.html">Week-end de lecture: 10 histoires sonores inhabituelles - Des jeux d'espionnage et des thÃ©ories du complot Ã  l'ASMR relaxant</a></li>
<li><a href="../fr493448/index.html">Spring - routage efficace</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>