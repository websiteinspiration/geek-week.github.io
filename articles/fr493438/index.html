<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üí∫ üí¥ üëÖ Afficher les r√©sultats de recherche et les probl√®mes de performances üíñ üßÄ üë®üèª‚Äçüè≠</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="L'un des sc√©narios typiques dans toutes les applications courantes consiste √† rechercher des donn√©es selon certains crit√®res et √† les afficher sous un...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Afficher les r√©sultats de recherche et les probl√®mes de performances</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/epam_systems/blog/493438/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'un des sc√©narios typiques dans toutes les applications courantes consiste √† rechercher des donn√©es selon certains crit√®res et √† les afficher sous une forme facile √† lire. </font><font style="vertical-align: inherit;">Il peut √©galement y avoir des possibilit√©s suppl√©mentaires de tri, de regroupement, de pagination. </font><font style="vertical-align: inherit;">La t√¢che, en th√©orie, est insignifiante, mais lors de sa r√©solution, de nombreux d√©veloppeurs font un certain nombre d'erreurs, qui souffrent alors des performances. </font><font style="vertical-align: inherit;">Essayons d'envisager diff√©rentes solutions √† ce probl√®me et formulons des recommandations pour choisir la mise en ≈ìuvre la plus efficace.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ms/kc/-s/mskc-s_1t4wcxa9w7i04zg4cjjq.jpeg" alt="image"><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Option de pagination n ¬∞ 1</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'option la plus simple qui vous vient √† l'esprit est de paginer les r√©sultats de la recherche sous sa forme la plus classique.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/rd/xx/vs/rdxxvst5xhcdfxzvlgrob1csxdk.png" width="498" height="232"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Supposons qu'une application utilise une base de donn√©es relationnelle. </font><font style="vertical-align: inherit;">Dans ce cas, pour afficher les informations sous cette forme, vous devrez ex√©cuter deux requ√™tes SQL:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Obtenez des lignes pour la page actuelle.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Calculez le nombre total de lignes qui correspondent aux crit√®res de recherche - cela est n√©cessaire pour afficher les pages.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Consid√©rez la premi√®re requ√™te en utilisant le </font><font style="vertical-align: inherit;">serveur de </font><font style="vertical-align: inherit;">base de donn√©es MS SQL test </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AdventureWorks</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour 2016 </font><font style="vertical-align: inherit;">comme exemple </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Pour cela, nous utiliserons la table Sales.SalesOrderHeader:</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> Sales.SalesOrderHeader
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> OrderDate <span class="hljs-keyword">DESC</span>
<span class="hljs-keyword">OFFSET</span> <span class="hljs-number">0</span> <span class="hljs-keyword">ROWS</span>
<span class="hljs-keyword">FETCH</span> <span class="hljs-keyword">NEXT</span> <span class="hljs-number">50</span> <span class="hljs-keyword">ROWS</span> <span class="hljs-keyword">ONLY</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La requ√™te ci-dessus affichera les 50 premi√®res commandes d'une liste tri√©e par ordre d√©croissant par date d'ajout, en d'autres termes, les 50 derni√®res commandes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il s'ex√©cute rapidement sur une base de test, mais regardons le plan d'ex√©cution et les statistiques d'E / S:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/rw/e8/u8/rwe8u8un-1t5bm3yttan4qsfqrg.png" width="624" height="144"></div><br>
<pre><code class="plaintext hljs">Table 'SalesOrderHeader'. Scan count 1, logical reads 698, physical reads 0, read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob read-ahead reads 0.</code></pre><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vous pouvez obtenir des statistiques d'E / S pour chaque demande en ex√©cutant la commande SET STATISTICS IO ON dans l'ex√©cution de la requ√™te. </font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme vous pouvez le voir dans le plan d'ex√©cution, le plus gourmand en ressources consiste √† trier toutes les lignes de la table source en fonction de la date √† laquelle elles ont √©t√© ajout√©es. </font><font style="vertical-align: inherit;">Et le probl√®me est que plus il y a de lignes dans le tableau, plus le tri sera ¬´difficile¬ª. </font><font style="vertical-align: inherit;">Dans la pratique, de telles situations doivent √™tre √©vit√©es, alors ajoutez l'index √† la date d'ajout et voyez si la consommation des ressources a chang√©:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/7y/so/g1/7ysog13xd9kalhv9fakieghj4je.png" width="720" height="148"></div><br>
<pre><code class="plaintext hljs">Table 'SalesOrderHeader'. Scan count 1, logical reads 165, physical reads 0, read-ahead reads 5, lob logical reads 0, lob physical reads 0, lob read-ahead reads 0.
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De toute √©vidence, cela s'est beaucoup am√©lior√©. </font><font style="vertical-align: inherit;">Mais tous les probl√®mes ont-ils √©t√© r√©solus? </font><font style="vertical-align: inherit;">Modifions la demande de recherche pour les commandes dont le co√ªt total des marchandises d√©passe 100 $:</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> Sales.SalesOrderHeader
<span class="hljs-keyword">WHERE</span> SubTotal &gt; <span class="hljs-number">100</span>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> OrderDate <span class="hljs-keyword">DESC</span>
<span class="hljs-keyword">OFFSET</span> <span class="hljs-number">0</span> <span class="hljs-keyword">ROWS</span>
<span class="hljs-keyword">FETCH</span> <span class="hljs-keyword">NEXT</span> <span class="hljs-number">50</span> <span class="hljs-keyword">ROWS</span> <span class="hljs-keyword">ONLY</span>
</code></pre><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/yn/_c/7s/yn_c7stdebp1utx8_ck4fbrvxjq.png" width="800" height="137"></div><br>
<pre><code class="plaintext hljs">Table 'SalesOrderHeader'. Scan count 1, logical reads 1081, physical reads 0, read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob read-ahead reads 0.</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons une situation amusante: le plan de requ√™te est l√©g√®rement pire que le pr√©c√©dent, mais le nombre r√©el de lectures logiques est presque deux fois plus qu'avec une analyse compl√®te de la table. </font><font style="vertical-align: inherit;">Il existe un moyen de sortir - si nous √©tablissons le prix composite √† partir de l'indice existant et ajoutons le prix total des marchandises comme deuxi√®me champ, nous obtenons alors 165 lectures logiques:</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">INDEX</span> IX_SalesOrderHeader_OrderDate_SubTotal <span class="hljs-keyword">on</span> Sales.SalesOrderHeader(OrderDate, SubTotal);
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cette s√©rie d'exemples peut √™tre poursuivie pendant longtemps, mais les deux principales pens√©es que je veux exprimer ici sont:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'ajout de tout nouveau crit√®re ou ordre de tri √† la requ√™te de recherche peut affecter consid√©rablement la vitesse de son ex√©cution.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mais si nous devons soustraire seulement une partie des donn√©es, et pas tous les r√©sultats qui correspondent aux conditions de recherche, il existe de nombreuses fa√ßons d'optimiser une telle requ√™te.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Passons maintenant √† la deuxi√®me requ√™te, mentionn√©e au tout d√©but - √† celle qui compte le nombre d'enregistrements qui r√©pondent aux crit√®res de recherche. </font><font style="vertical-align: inherit;">Prenons le m√™me exemple - trouver des commandes qui co√ªtent plus de 100 $:</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">COUNT</span>(<span class="hljs-number">1</span>) <span class="hljs-keyword">FROM</span> Sales.SalesOrderHeader
<span class="hljs-keyword">WHERE</span> SubTotal &gt; <span class="hljs-number">100</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En pr√©sence de l'indice composite indiqu√© ci-dessus, on obtient:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/nb/tg/yz/nbtgyzsg7her2lswpnfq2jbmotk.png" width="517" height="197"></div><br>
<pre><code class="plaintext hljs">Table 'SalesOrderHeader'. Scan count 1, logical reads 698, physical reads 0, read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob read-ahead reads 0.</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le fait que la requ√™te passe √† travers l'index entier n'est pas surprenant, car le champ SubTotal n'est pas en premi√®re position, donc la requ√™te ne peut pas l'utiliser. Le probl√®me est r√©solu en ajoutant un autre index au champ SubTotal et, par cons√©quent, ne donne d√©j√† que 48 lectures logiques. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez donner quelques autres exemples de demandes de comptage de la quantit√©, mais l'essentiel reste le m√™me: la </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r√©ception d'une partie des donn√©es et le comptage de la quantit√© totale sont deux demandes fondamentalement diff√©rentes</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , et chacune n√©cessite ses propres mesures d'optimisation. Dans le cas g√©n√©ral, vous ne pouvez pas trouver une combinaison d'index qui fonctionne aussi bien pour les deux requ√™tes.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par cons√©quent, l'une des exigences importantes qui doit √™tre clarifi√©e lors du d√©veloppement d'une telle solution de recherche est de savoir s'il est vraiment important pour l'entreprise de voir le nombre total d'objets trouv√©s. </font><font style="vertical-align: inherit;">Il arrive souvent que non. </font><font style="vertical-align: inherit;">Et la navigation vers des num√©ros de page sp√©cifiques, √† mon avis, est une solution avec une port√©e tr√®s √©troite, car la plupart des sc√©narios de pagination ressemblent √† "aller √† la page suivante".</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Option de pagination n ¬∞ 2</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Supposons que les utilisateurs ne souhaitent pas conna√Ætre le nombre total d'objets trouv√©s. </font><font style="vertical-align: inherit;">Essayons de simplifier la page de recherche:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/tc/pr/1t/tcpr1teevrkdz8tcwsbjmx_dl5i.png" width="498" height="230"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En fait, seul le fait qu'il n'y ait aucun moyen d'acc√©der √† des num√©ros de page sp√©cifiques a chang√©, et maintenant ce tableau n'a plus besoin de savoir combien d'entre eux peuvent √™tre affich√©s. Mais la question se pose - comment le tableau sait-il s'il existe des donn√©es pour la page suivante (afin d'afficher correctement le lien ¬´Suivant¬ª)? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La r√©ponse est tr√®s simple: vous pouvez soustraire de la base de donn√©es un enregistrement de plus que ce dont vous avez besoin pour afficher, et la pr√©sence de cet enregistrement "suppl√©mentaire" montrera s'il y a la partie suivante. Ainsi, pour obtenir une page de donn√©es, vous devrez effectuer une seule requ√™te, ce qui am√©liore consid√©rablement les performances et facilite la prise en charge de cette fonctionnalit√©. Dans ma pratique, il y a eu un cas o√π le refus de compter le nombre total d'enregistrements a acc√©l√©r√© la sortie des r√©sultats de 4 √† 5 fois.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour cette approche, il existe plusieurs options pour l'interface utilisateur: les commandes ¬´retour¬ª et ¬´avant¬ª, comme dans l'exemple ci-dessus, le bouton ¬´charger plus¬ª, qui ajoute simplement une nouvelle portion aux r√©sultats affich√©s, ¬´d√©filement infini¬ª, qui fonctionne sur le principe de ¬´charger plus¬ª ", Mais le signal pour obtenir la portion suivante est que l'utilisateur fasse d√©filer tous les r√©sultats affich√©s jusqu'√† la fin. </font><font style="vertical-align: inherit;">Quelle que soit la solution visuelle, le principe de l'√©chantillonnage des donn√©es reste le m√™me.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les nuances de la mise en ≈ìuvre de la pagination</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans tous les exemples de requ√™tes ci-dessus, l'approche ¬´offset + num√©ro¬ª est utilis√©e, lorsque la requ√™te elle-m√™me indique dans quel ordre les lignes de r√©sultat et combien de lignes doivent √™tre retourn√©es. </font><font style="vertical-align: inherit;">Tout d'abord, r√©fl√©chissez √† la meilleure fa√ßon d'organiser le transfert des param√®tres dans ce cas. </font><font style="vertical-align: inherit;">En pratique, j'ai rencontr√© plusieurs fa√ßons:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Num√©ro de s√©rie de la page demand√©e (pageIndex), taille de la page (pageSize).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le num√©ro de s√©rie du premier enregistrement √† renvoyer (startIndex), le nombre maximal d'enregistrements en cons√©quence (count).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le num√©ro de s√©rie du premier enregistrement √† renvoyer (startIndex), le num√©ro de s√©rie du dernier enregistrement √† renvoyer (endIndex).</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√Ä premi√®re vue, il peut sembler que c'est si √©l√©mentaire qu'il n'y a pas de diff√©rence. </font><font style="vertical-align: inherit;">Mais ce n'est pas le cas - l'option la plus pratique et universelle est la seconde (startIndex, count). </font><font style="vertical-align: inherit;">Il y a plusieurs raisons √† cela:</font></font><br>
<br>
<ul>
<li>    +1 ,  ,    pageIndex  pageSize  . ,    50   .    ,      ,  .   ¬´+1¬ª    , ,          1  51,   ‚Äî  51  101  ..     51   pageIndex,      52  102  .. ,             ‚Äî     ¬´¬ª ,     .</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La troisi√®me option n'a aucun sens, car pour ex√©cuter des requ√™tes dans la plupart des bases de donn√©es, vous devrez toujours transf√©rer la quantit√©, pas l'index du dernier enregistrement. </font><font style="vertical-align: inherit;">Soit la soustraction de startIndex de endIndex et une op√©ration arithm√©tique √©l√©mentaire, mais c'est superflu ici.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
D√©crivons maintenant les d√©fauts de l'impl√©mentation de la pagination via "offset + quantit√©":</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Obtenir chaque page suivante sera plus co√ªteux et plus lent que la pr√©c√©dente, car la base de donn√©es devra toujours parcourir tous les enregistrements ¬´depuis le d√©but¬ª en fonction des crit√®res de recherche et de tri, puis s'arr√™ter au fragment souhait√©.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tous les SGBD ne peuvent pas prendre en charge cette approche.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il existe des alternatives, mais elles sont √©galement imparfaites. </font><font style="vertical-align: inherit;">La premi√®re de ces approches est appel√©e ¬´pagination par jeu de cl√©s¬ª ou ¬´m√©thode de recherche¬ª et consiste en ce qui suit: apr√®s avoir re√ßu une partie, vous pouvez vous souvenir des valeurs des champs du dernier enregistrement de la page, puis les utiliser pour obtenir la partie suivante. </font><font style="vertical-align: inherit;">Par exemple, nous avons effectu√© la demande suivante:</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> Sales.SalesOrderHeader
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> OrderDate <span class="hljs-keyword">DESC</span>
<span class="hljs-keyword">OFFSET</span> <span class="hljs-number">0</span> <span class="hljs-keyword">ROWS</span>
<span class="hljs-keyword">FETCH</span> <span class="hljs-keyword">NEXT</span> <span class="hljs-number">50</span> <span class="hljs-keyword">ROWS</span> <span class="hljs-keyword">ONLY</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et dans le dernier enregistrement, nous avons obtenu la valeur de la date de commande '2014-06-29'. </font><font style="vertical-align: inherit;">Ensuite, pour obtenir la page suivante, vous pouvez essayer de faire ceci:</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> Sales.SalesOrderHeader
<span class="hljs-keyword">WHERE</span> OrderDate &lt; <span class="hljs-string">'2014-06-29'</span>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> OrderDate <span class="hljs-keyword">DESC</span>
<span class="hljs-keyword">OFFSET</span> <span class="hljs-number">0</span> <span class="hljs-keyword">ROWS</span>
<span class="hljs-keyword">FETCH</span> <span class="hljs-keyword">NEXT</span> <span class="hljs-number">50</span> <span class="hljs-keyword">ROWS</span> <span class="hljs-keyword">ONLY</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le probl√®me est que OrderDate est un champ non unique et la condition mentionn√©e ci-dessus est susceptible d'ignorer un grand nombre des lignes requises. </font><font style="vertical-align: inherit;">Pour rendre cette demande sans ambigu√Øt√©, vous devez ajouter un champ unique √† la condition (supposons que 75074 est la derni√®re valeur de la cl√© primaire de la premi√®re partie):</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> Sales.SalesOrderHeader
<span class="hljs-keyword">WHERE</span> (OrderDate = <span class="hljs-string">'2014-06-29'</span> <span class="hljs-keyword">AND</span> SalesOrderID &lt; <span class="hljs-number">75074</span>)
   <span class="hljs-keyword">OR</span> (OrderDate &lt; <span class="hljs-string">'2014-06-29'</span>)
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> OrderDate <span class="hljs-keyword">DESC</span>, SalesOrderID <span class="hljs-keyword">DESC</span>
<span class="hljs-keyword">OFFSET</span> <span class="hljs-number">0</span> <span class="hljs-keyword">ROWS</span>
<span class="hljs-keyword">FETCH</span> <span class="hljs-keyword">NEXT</span> <span class="hljs-number">50</span> <span class="hljs-keyword">ROWS</span> <span class="hljs-keyword">ONLY</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cette option fonctionnera correctement, mais dans le cas g√©n√©ral, elle sera difficile √† optimiser, car la condition contient l'op√©rateur OU. Si la valeur de la cl√© primaire augmente avec la croissance de OrderDate, la condition peut √™tre simplifi√©e en ne laissant que le filtre par SalesOrderID. Mais s'il n'y a pas de corr√©lation stricte entre les valeurs de la cl√© primaire et le champ selon lequel le r√©sultat est tri√© - dans la plupart des SGBD, ce OU ne peut pas √™tre √©vit√©. L'exception que je connais est PostgreSQL, o√π la comparaison de tuple est enti√®rement prise en charge, et la condition ci-dessus peut √™tre √©crite comme ¬´WHERE (OrderDate, SalesOrderID) &lt;('2014-06-29', 75074). Si vous avez une cl√© composite avec ces deux champs, une demande similaire devrait √™tre assez simple. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La deuxi√®me approche alternative peut √™tre trouv√©e, par exemple, dans l' </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API ElasticSearch scroll</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ou</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cosmos DB</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - lorsqu'une requ√™te en plus des donn√©es renvoie un identifiant sp√©cial avec lequel vous pouvez obtenir le prochain lot de donn√©es. </font><font style="vertical-align: inherit;">Si cet identifiant a une dur√©e de vie illimit√©e (comme dans Comsos DB), alors c'est un excellent moyen d'impl√©menter la pagination avec une transition s√©quentielle entre les pages (option n ¬∞ 2 mentionn√©e ci-dessus). </font><font style="vertical-align: inherit;">Ses inconv√©nients possibles: tous les SGBD ne sont pas pris en charge; </font><font style="vertical-align: inherit;">l'identifiant re√ßu pour la partie suivante peut avoir une dur√©e de vie limit√©e, ce qui n'est g√©n√©ralement pas appropri√© pour impl√©menter une interaction utilisateur (comme l'API ElasticSearch scroll).</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Filtrage complexe</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous compliquons encore la t√¢che. </font><font style="vertical-align: inherit;">Supposons qu'il soit n√©cessaire d'impl√©menter la recherche dite √† facettes, famili√®re √† tout le monde dans les magasins en ligne. </font><font style="vertical-align: inherit;">Les exemples ci-dessus bas√©s sur la table de commande ne sont pas tr√®s indicatifs dans ce cas, nous allons donc passer √† la table Product de la base de donn√©es AdventureWorks:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/di/ws/13/diws13cm-qjxoy3igxslnbvizca.png" width="595" height="234"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quelle est l'id√©e de la recherche √† facettes? </font><font style="vertical-align: inherit;">En ce que, pour chaque √©l√©ment de filtre, le nombre d'enregistrements correspondant √† ce crit√®re est affich√© </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">en tenant compte des filtres s√©lectionn√©s dans toutes les autres cat√©gories</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par exemple, si nous s√©lectionnons la cat√©gorie V√©los et la couleur Noir dans cet exemple, le tableau n'affichera que les v√©los noirs, mais en m√™me temps:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour chaque crit√®re du groupe ¬´Cat√©gories¬ª, le nombre de produits de cette cat√©gorie en noir sera affich√©.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour chaque crit√®re du groupe Couleurs, le nombre de v√©los de cette couleur sera affich√©.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici un exemple de sortie du r√©sultat pour de telles conditions:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/y8/v2/q2/y8v2q2j76mcfnmjmirzu8jrnhyu.png" width="605" height="234"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si en plus de marquer la cat√©gorie ¬´V√™tements¬ª, le tableau indiquera √©galement les v√™tements noirs disponibles. </font><font style="vertical-align: inherit;">Le nombre de produits noirs dans la section "Couleur" sera √©galement recalcul√© en fonction des nouvelles conditions, seulement dans la section "Cat√©gories" rien ne changera ... J'esp√®re que ces exemples suffisent pour comprendre l'algorithme de recherche √† facettes familier. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Imaginez maintenant comment cela peut √™tre mis en ≈ìuvre sur une base relationnelle. </font><font style="vertical-align: inherit;">Chaque groupe de crit√®res, tels que la cat√©gorie et la couleur, n√©cessitera une demande distincte:</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> pc.ProductCategoryID, pc.Name, <span class="hljs-keyword">COUNT</span>(<span class="hljs-number">1</span>) <span class="hljs-keyword">FROM</span> Production.Product p
  <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> Production.ProductSubcategory ps <span class="hljs-keyword">ON</span> p.ProductSubcategoryID = ps.ProductSubcategoryID
  <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> Production.ProductCategory pc <span class="hljs-keyword">ON</span> ps.ProductCategoryID = pc.ProductCategoryID
<span class="hljs-keyword">WHERE</span> p.Color = <span class="hljs-string">'Black'</span>
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> pc.ProductCategoryID, pc.Name
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">COUNT</span>(<span class="hljs-number">1</span>) <span class="hljs-keyword">DESC</span>
</code></pre><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/mf/79/az/mf79azaflzgu-1gatq4gtbhcdzw.png" width="331" height="90"></div><br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> Color, <span class="hljs-keyword">COUNT</span>(<span class="hljs-number">1</span>) <span class="hljs-keyword">FROM</span> Production.Product p
  <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> Production.ProductSubcategory ps <span class="hljs-keyword">ON</span> p.ProductSubcategoryID = ps.ProductSubcategoryID
<span class="hljs-keyword">WHERE</span> ps.ProductCategoryID = <span class="hljs-number">1</span> <span class="hljs-comment">--Bikes</span>
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> Color
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">COUNT</span>(<span class="hljs-number">1</span>) <span class="hljs-keyword">DESC</span>
</code></pre><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/cf/ec/r5/cfecr5njjmi93lsdrei1teygmhi.png" width="190" height="110"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quel est le probl√®me avec cette d√©cision? </font><font style="vertical-align: inherit;">Tr√®s simple - il n'√©volue pas bien. </font><font style="vertical-align: inherit;">Chaque section de filtre n√©cessite une requ√™te distincte pour compter les quantit√©s, et ces requ√™tes ne sont pas les plus simples. </font><font style="vertical-align: inherit;">Dans les magasins en ligne, dans certaines sections, il peut y avoir plusieurs dizaines de sections du filtre, ce qui peut √™tre un grave probl√®me de performances. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Habituellement, apr√®s ces d√©clarations, ils m'offrent quelques solutions, √† savoir:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Combinez tous les comptages de quantit√© en une seule requ√™te. </font><font style="vertical-align: inherit;">Techniquement, cela est possible en utilisant le mot-cl√© UNION, mais cela n'aidera pas beaucoup dans les performances - de toute fa√ßon, la base de donn√©es devra ex√©cuter chaque fragment √† partir de z√©ro.</font></font></li>
<li> .      ,    .   ,      . ,   10 ¬´¬ª,     5 .   ¬´¬ª    ,       -.         9- ,  ,        .     50 ,    ,     2<sup>50</sup>.         ,  .     ,            5-10 . ,          ,  -  ,      ,                (     ).</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Heureusement, une telle t√¢che a depuis longtemps des solutions suffisamment efficaces qui fonctionnent de mani√®re pr√©visible sur de grandes quantit√©s de donn√©es. Pour l'une de ces options, il est logique de diviser le recomptage de facette et d'obtenir la page de r√©sultats en deux appels parall√®les au serveur et d'organiser l'interface utilisateur de telle sorte que le chargement des donn√©es sur les facettes "n'interf√®re pas" avec l'affichage des r√©sultats de la recherche.</font></font><br>
<br>
<ul>
<li>   ¬´¬ª   . ,        ,       ,   ,      ‚Äî ¬´1425  , ?¬ª       ,    ¬´¬ª.                 ¬´¬ª.  ,   ,             .        -. ,       ,        .</li>
<li> search engine      ,   Solr, ElasticSearch, Sphinx  .      ¬´¬ª         .    ,          ,       ‚Äî     .      ,  search engine       ,    :     ,    ,    ;       search engine      .       ‚Äî     .      ¬´ ¬ª.          ¬´¬ª    ,   ,            .      ,   -  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">transactional outbox</a>      .</li>
</ul><br>
<h2></h2><br>
<ol>
<li>     ‚Äî  ,             .   ¬´¬ª  ¬´¬ª ‚Äî    ,      :<br>
<ul>
<li>                   ‚Äî       .</li>
<li>   ,         ,    ,     .  -          ‚Äî    .</li>
</ul></li>
<li>                ,          ‚Äî         #2.</li>
<li>     faceted search,        :<br>
<ul>
<li>        .</li>
<li> search engine   Solr, ElasticSearch, Sphinx  .   ,         ,            . </li>
</ul></li>
<li>   faceted search              .      ,   ,        .</li>
<li>   SQL   ,   ,    ,           (   ¬´¬ª ).           ,   ‚Äî  ¬´¬ª.           ,        .</li>
</ol></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr493426/index.html">Organisation du code dans les microservices et mon approche de l'utilisation de l'architecture hexagonale et du DDD</a></li>
<li><a href="../fr493428/index.html">"Nous ne donnerons pas lieu √† des th√©ories du complot." Parlez de conf√©rences ML avec des gens des soci√©t√©s scientifiques et informatiques</a></li>
<li><a href="../fr493430/index.html">Architecture nette pour les applications Web</a></li>
<li><a href="../fr493432/index.html">Pourquoi ne pas commencer une carri√®re dans une petite entreprise non informatique</a></li>
<li><a href="../fr493436/index.html">Programme pour changer les droits d'acc√®s et enregistrer les noms de fichiers / r√©pertoires sur Bash</a></li>
<li><a href="../fr493440/index.html">Marketing d'influence en Chine: sur quoi il se base et ce que les influenceurs peuvent offrir dans le contexte des urgences</a></li>
<li><a href="../fr493442/index.html">Rappel EPI</a></li>
<li><a href="../fr493444/index.html">Le projet "Verre". Tasses √† th√© / caf√© jetables d'efficacit√© √©nerg√©tique</a></li>
<li><a href="../fr493446/index.html">Week-end de lecture: 10 histoires sonores inhabituelles - Des jeux d'espionnage et des th√©ories du complot √† l'ASMR relaxant</a></li>
<li><a href="../fr493448/index.html">Spring - routage efficace</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>