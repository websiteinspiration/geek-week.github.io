<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚õ™Ô∏è üóìÔ∏è ü§∏üèæ HighLoad ++, Mikhail Raichenko (ManyChat): quase sem m√°gica, ou como √© f√°cil distribuir stream de v√≠deo terabit ‚úåÔ∏è üë©üèø‚Äçü§ù‚Äçüë®üèæ üñïüèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A pr√≥xima confer√™ncia HighLoad ++ ser√° realizada nos dias 6 e 7 de abril de 2020 em S√£o Petersburgo. Detalhes e ingressos aqui . HighLoad ++ Moscow 20...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>HighLoad ++, Mikhail Raichenko (ManyChat): quase sem m√°gica, ou como √© f√°cil distribuir stream de v√≠deo terabit</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ua-hosting/blog/488148/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A pr√≥xima confer√™ncia HighLoad ++ ser√° realizada nos dias 6 e 7 de abril de 2020 em S√£o Petersburgo. </font><font style="vertical-align: inherit;">Detalhes e ingressos </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqui</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">HighLoad ++ Moscow 2018. Sal√£o "Delhi + Calcutta". </font><font style="vertical-align: inherit;">8 de novembro, 14h </font><font style="vertical-align: inherit;">Resumos e </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apresenta√ß√£o</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ym/ji/ba/ymjiba---vkcs5ibbqbk9kcz8ny.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Trabalho na equipe VKontakte e estou desenvolvendo um sistema de transmiss√£o de v√≠deo. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No relat√≥rio, compartilharei os recursos do desenvolvimento de back-end, a maneira como nosso sistema evoluiu e as solu√ß√µes t√©cnicas para as quais chegamos:‚Ä®</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">como fizemos o backend da transmiss√£o de v√≠deo e o processo de evolu√ß√£o como ele √©;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o impacto dos requisitos comerciais e operacionais na arquitetura;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Aguarde" e "tente novamente" falhar√£o;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">como as tarefas mais simples s√£o complicadas pelo n√∫mero de usu√°rios;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">como reduzir a lat√™ncia sem UDP;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Realizamos testes de estresse 2 vezes ao dia, ou com o que Clover nos ajudou.</font></font></li>
</ul><a name="habracut"></a><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mikhail Raichenko (a seguir - MR):</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Uma pequena excurs√£o. </font><font style="vertical-align: inherit;">Vou falar sobre as pessoas que transmitem para n√≥s, ao vivo (ao vivo), sobre quais plataformas recebemos o fluxo de v√≠deo e quais distribu√≠mos. </font><font style="vertical-align: inherit;">No final, falarei sobre a arquitetura atual do live, sobre suas limita√ß√µes e capacidades, bem como sobre como a arquitetura atual sobreviveu a um efeito como "Clover".</font></font><br>
<br>
<img src="https://habrastorage.org/webt/_h/bm/lt/_hbmlt0c2ek74zfr89jdff3wtsw.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sobre transmiss√µes ao vivo. </font><font style="vertical-align: inherit;">Esbo√ßo do relat√≥rio</font></font></h3><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Primeiro, falarei um pouco sobre as pr√≥prias transmiss√µes e transmiss√µes ao vivo, enviando-nos o conte√∫do de v√≠deo que mostramos a outros espectadores.</font></font></li>
<li>         .    ?     ,     , , ,   -  - , - , .   ,        :   ,  ‚Äì .</li>
<li>    . ,      .     .     ,      ,     .</li>
<li>  ,     ,   .   ,         .  ,   ,   ,  , ,   2014-2015 .     ,      .</li>
<li>       .  ,                    .</li>
<li>,    .          ,    . ,    .</li>
<li>    ,    .      .</li>
<li>  ,    ,      ¬´¬ª,    .</li>
</ul><br>
<img src="https://habrastorage.org/webt/lz/mm/jw/lzmmjwth6qvdlryupzhegpftal0.jpeg"><br>
<br>
<h3>     </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todos os servi√ßos de transmiss√£o s√£o mais ou menos assim: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/dt/2r/va/dt2rvaddozkmjrcp-1ojlaixmr0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
temos um pouco de streamer, ele envia um fluxo RTMP para n√≥s e mostramos ao p√∫blico - nada surpreendente, nada sobrenatural. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ee/fx/kq/eefxkq8vknyi57vz-y-_ekw5pd0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De onde vem o fluxo de v√≠deo? Uma fonte significativa de tr√°fego para n√≥s √© o nosso aplicativo m√≥vel VKlife. O que h√° de bom nele? Nele, podemos controlar totalmente como codificamos o v√≠deo. Podemos fazer muitas otimiza√ß√µes no lado do cliente, para que mais tarde, com atrasos m√≠nimos, mostrem aos nossos espectadores. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das desvantagens: aplicativos m√≥veis funcionam em cima de redes. Pode ser 3G ... De qualquer forma, s√£o quase sempre redes m√≥veis, o que apresenta alguns atrasos - voc√™ precisa armazenar em buffer adicionalmente os dados no lado do aplicativo, para que o fluxo funcione da maneira mais suave poss√≠vel.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A segunda fonte s√£o streamers com OBS, Wirecast ou aqueles que transmitem a partir de outros aplicativos de desktop. </font><font style="vertical-align: inherit;">Esta √© uma audi√™ncia bastante grande. </font><font style="vertical-align: inherit;">√Äs vezes, s√£o semin√°rios, √†s vezes - fluxos de jogos (existem muitos deles em tais aplicativos). </font><font style="vertical-align: inherit;">Do ponto positivo: existem poucas aplica√ß√µes desse tipo, podemos oferecer boas recomenda√ß√µes de ajuste √†s nossas serpentinas. </font><font style="vertical-align: inherit;">Mas, ao mesmo tempo, h√° muitas configura√ß√µes e n√£o enviamos exatamente o fluxo que queremos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A terceira categoria √© o fluxo RTMP dos servidores de m√≠dia. </font><font style="vertical-align: inherit;">Estes podem ser servidores de m√≠dia muito pequenos, ou seja, um formato dom√©stico: uma pessoa transmite uma vis√£o da rua ou qualquer outra coisa. </font><font style="vertical-align: inherit;">Ou transmiss√µes bastante s√©rias de nossos parceiros: pode haver qualquer coisa, n√£o existem muitos desses fluxos, mas basicamente s√£o muito importantes para n√≥s.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quem est√° assistindo?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Novamente, esta √© uma aplica√ß√£o m√≥vel - tudo est√° claro aqui. O maior problema √© a lat√™ncia da rede. Dos profissionais: podemos personalizar o player - √© conveniente para n√≥s, bom, mas n√£o em todos os lugares onde fica 100%. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Web player em vk.com. Aqui tamb√©m tudo √© simples - √© um reprodutor de web comum que voc√™ pode abrir para assistir. Uma audi√™ncia suficientemente grande no vk.com, muitos espectadores nas transmiss√µes. Algumas transmiss√µes est√£o suspensas em nossa se√ß√£o "V√≠deo" - pode haver dezenas de milhares (√†s vezes sem PR), especialmente se esse for um conte√∫do interessante. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Assim, os canais s√£o grandes o suficiente para os espectadores que est√£o sentados em um web player. Portanto, h√° muito tr√°fego, inclusive para uma transmiss√£o.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O terceiro √© o web player VKontakte em algum site de terceiros. </font><font style="vertical-align: inherit;">Voc√™ pode come√ßar a transmitir tudo o que quiser e pendurar um web player VKontakte no seu site. </font><font style="vertical-align: inherit;">Voc√™ pode se tornar nosso parceiro se tiver um conte√∫do interessante: voc√™ pode pendur√°-lo por conta pr√≥pria, pode pendurar conosco - como desejar. </font><font style="vertical-align: inherit;">Voc√™ pode organizar suas transmiss√µes dessa maneira e tudo funcionar√°.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Compara√ß√£o com videochamadas</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nas videochamadas, algumas distor√ß√µes da imagem ser√£o perdoadas. As videochamadas s√£o mais simples: podemos degradar significativamente a imagem, mas, ao mesmo tempo, precisamos manter uma lat√™ncia muito boa. Com um longo atraso, o servi√ßo ser√° absolutamente imposs√≠vel de usar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nas transmiss√µes nesse sentido, √© um pouco vice-versa: precisamos manter alta qualidade de imagem, mas, ao mesmo tempo, podemos aumentar a lat√™ncia devido a muitos fatores. Por exemplo, o player armazena em buffer o fluxo de uma maneira ou de outra (pode ser um segundo, dois para sobreviver √† degrada√ß√£o da rede, por exemplo); portanto, na maioria dos casos, n√£o √© necess√°rio um segundo atraso de milissegundos. Voc√™ pode se esfor√ßar para isso, mas a comida n√£o √© um pr√©-requisito.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/j0/7o/o6/j07oo6ceqiizh_lzdgjsgvgfwtq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No v√≠deo comum, a situa√ß√£o √© exatamente o oposto. </font><font style="vertical-align: inherit;">Precisamos de muito boa qualidade. </font><font style="vertical-align: inherit;">Ao mesmo tempo, √© desej√°vel minimizar o tamanho do v√≠deo, a taxa de bits e a qualidade, para que, com o fluxo m√≠nimo, forne√ßa a melhor solu√ß√£o. </font><font style="vertical-align: inherit;">Dos profissionais: n√£o temos tempo limitado: no momento do download do v√≠deo, temos tempo suficiente para otimizar o v√≠deo, ver como compact√°-lo da melhor maneira, fazer alguma coisa, arrast√°-lo para caches, se necess√°rio - em geral, tudo √© suficiente EST√Å BEM. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/jf/r-/cc/jfr-cco9dozhxgqqnuw57opkqjk.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ao vivo, a situa√ß√£o √©, novamente, o oposto: temos muito pouco tempo para transcodificar. </font><font style="vertical-align: inherit;">Ao mesmo tempo, existem poucas oportunidades, mas n√£o h√° expectativas para a transmiss√£o. </font><font style="vertical-align: inherit;">O p√∫blico nos perdoar√° se tivermos apoio ou se a qualidade n√£o for muito boa.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Primeira vers√£o</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√â bastante esperado: na </font></font><br>
<br>
<img src="https://habrastorage.org/webt/3f/gt/bw/3fgtbwzvl3uf680sfzsf8kjette.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
verdade, √© um pouco diferente: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vu/9r/zu/vu9rzujgkidpvrb66qzgbvapljo.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
"Streamer - servidor de m√≠dia - n√≠vel de cache - visualizadores". </font><font style="vertical-align: inherit;">Em princ√≠pio, esta vers√£o permite escalar com bastante for√ßa. </font><font style="vertical-align: inherit;">Eu diria que j√° deveria suportar dezenas de milhares de espectadores. </font><font style="vertical-align: inherit;">Tem outras desvantagens ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por exemplo, se voc√™ olhar para este circuito (slide anterior), poder√° ver que ele n√£o √© tolerante a falhas. </font><font style="vertical-align: inherit;">Devemos adivinhar com o servidor de m√≠dia para equilibrar bem o p√∫blico. </font><font style="vertical-align: inherit;">N√£o podemos pendurar muitos caches em cada servidor - √© simplesmente caro. </font><font style="vertical-align: inherit;">Portanto, vimos, percebemos que era simples e claro, havia algumas possibilidades de dimensionamento, mas obviamente algo estava faltando ... E come√ßamos a formular requisitos.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Requisitos de infraestrutura</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O que √© importante?</font></font><br>
<br>
<ul>
<li> .     , ,    .            (       ).       (,  ).</li>
<li>.     : -,    (,    )      ; -,     ‚Äì      ,    ,       .</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Entrega para as regi√µes. </font><font style="vertical-align: inherit;">Tamb√©m √© um ponto importante! </font><font style="vertical-align: inherit;">√â est√∫pido arrastar todo o conte√∫do de v√≠deo de Petersburgo ou Moscou para algum tipo de Novosibirsk, Ecaterimburgo ou mesmo de S√£o Petersburgo para Moscou. </font><font style="vertical-align: inherit;">Isso n√£o √© muito bom, pois o atraso da rede ser√° longo - haver√° atrasos, tudo ficar√° lento e isso n√£o ser√° bom. </font><font style="vertical-align: inherit;">Portanto, nossa infraestrutura deve levar em conta que entregamos conte√∫do para as regi√µes.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conveni√™ncia de opera√ß√£o e monitoramento. </font><font style="vertical-align: inherit;">Uma propriedade importante. </font><font style="vertical-align: inherit;">Como o sistema √© grande, h√° muitos visualizadores, √© importante enviar alertas aos administradores a tempo, em caso de problemas, incluindo o monitoramento de m√©tricas t√©cnicas e do produto.</font></font></li>
</ul><br>
<img src="https://habrastorage.org/webt/km/n1/e_/kmn1e_0ii74m9xilh_5rsic9l5a.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como √© a infraestrutura de transmiss√£o agora?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como resultado, chegamos a uma infraestrutura bastante simples, mas eficaz ...</font></font><br>
<br>
<ul>
<li> ‚Äì ,       ( ,  ).   RTMP-,    .        ,  .</li>
<li> ,      ,     ,  ,   .       .  ,   ,   ,   ‚Äì : , -,  (. .       ); -,     .</li>
<li>      .     ‚Äì    ,   .        ,    ,    .      ,         (    ,  ).</li>
<li>         ,         (edge-).     ,  .    !</li>
<li>   ‚Äì  edge-,      ,   .   :      ,   ‚Äì    .</li>
</ul><br>
<img src="https://habrastorage.org/webt/2e/cu/qp/2ecuqpdeldwtxd6qjyi-x4q0_ke.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Curiosamente? </font><font style="vertical-align: inherit;">Balanceamento! </font><font style="vertical-align: inherit;">Nesse esquema, escolhemos o balanceamento, tentamos enviar espectadores que assistem o mesmo fluxo para cada servidor de borda. </font><font style="vertical-align: inherit;">A localidade do cache √© muito importante aqui, porque pode haver muitos servidores de borda; </font><font style="vertical-align: inherit;">e se n√£o observarmos o local tempor√°rio e o cache do ponto de vista do fluxo, sobrecarregaremos a camada interna. </font><font style="vertical-align: inherit;">Tamb√©m n√£o gostar√≠amos disso.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Portanto, equilibramos da seguinte maneira: selecionamos um determinado servidor de borda para a regi√£o para a qual enviamos visualizadores e enviamos at√© come√ßarmos a entender que ocorreu algum preenchimento e que deve ser enviado para outro servidor. </font><font style="vertical-align: inherit;">O circuito √© simples e funciona com muita confiabilidade. </font><font style="vertical-align: inherit;">Naturalmente, para fluxos diferentes, voc√™ escolhe uma sequ√™ncia diferente de servidores de borda (a sequ√™ncia na qual enviamos espectadores). </font><font style="vertical-align: inherit;">Consequentemente, o balanceamento funciona de maneira bastante simples.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tamb√©m fornecemos ao cliente um link para um servidor de borda dispon√≠vel. </font><font style="vertical-align: inherit;">Isso √© feito para que, em caso de falha do servidor de borda, possamos redirecionar o visualizador para outro. </font><font style="vertical-align: inherit;">Ou seja, quando o espectador assiste √† transmiss√£o, ele recebe um link para o servidor desejado uma vez a cada poucos segundos. </font><font style="vertical-align: inherit;">Se ele entender que o link deve ser diferente, ele alterna (o player alterna) e continua a assistir √† transmiss√£o de outro servidor. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Outro papel importante dos servidores de borda √© a prote√ß√£o de conte√∫do. </font><font style="vertical-align: inherit;">Toda a prote√ß√£o de conte√∫do ocorre basicamente l√°. </font><font style="vertical-align: inherit;">N√≥s temos nosso pr√≥prio m√≥dulo nginx para isso. </font><font style="vertical-align: inherit;">√â um pouco semelhante ao Security Link.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dimensionamento e balanceamento</font></font></h3><br>
<ul>
<li>   . ,        :     ,       .          edge-,        .     .     .    ‚Ä¶   ,     ‚Äì    ,  --    ‚Äì ,  ‚Äì , , ,   ‚Äì  !   ‚Äì        .</li>
<li>      .  ,  ,         ,    ,       :     .       (   )    ,    ‚Äì   ,   . ,    ,     ,      edge-.</li>
<li>   ,   ,       ,     .</li>
</ul><br>
<img src="https://habrastorage.org/webt/19/nj/i8/19nji8vwkh_kjrrsm9d698hf5ji.jpeg"><br>
<br>
<h3>   ?</h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um dos principais protocolos que t√≠nhamos era o RTMP (n√£o apenas para entrada, mas tamb√©m para distribui√ß√£o de conte√∫do). A principal vantagem √© a baixa lat√™ncia. Pode demorar meio segundo, segundo, dois segundos. De fato, os benef√≠cios terminam a√≠ ... </font></font><br>
<br>
<img src="https://habrastorage.org/webt/u7/fv/al/u7fvaloyunlxmyavp5rjemer4sw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esse protocolo de streaming √© dif√≠cil de monitorar - √© fechado em certo sentido, apesar do fato de haver uma especifica√ß√£o. O Flash player n√£o funciona mais (na verdade, j√° √© "tudo"). Precisa de suporte no n√≠vel da CDN - voc√™ precisa de m√≥dulos nginx especiais ou de seu pr√≥prio software para transferir o fluxo normalmente. H√° tamb√©m algumas dificuldades com os clientes m√≥veis. Pronto para uso em clientes m√≥veis, o suporte √© p√©ssimo - s√£o necess√°rias melhorias especiais e tudo isso √© muito dif√≠cil.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O segundo protocolo que usamos √© o HLS. </font><font style="vertical-align: inherit;">Parece bem simples: √© um arquivo de texto, o chamado arquivo de √≠ndice. </font><font style="vertical-align: inherit;">Ele cont√©m links para arquivos de √≠ndice com permiss√µes diferentes e os pr√≥prios arquivos cont√™m links para segmentos de m√≠dia. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/w-/hl/vf/w-hlvfylbcsu1n6ksqlv7uy5e5a.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como ele est√° bem? </font><font style="vertical-align: inherit;">√â muito simples, apesar de ser um pouco velho. </font><font style="vertical-align: inherit;">Ele permite que voc√™ use CDN, ou seja, voc√™ s√≥ precisa do nginx para distribuir o protocolo HLS. </font><font style="vertical-align: inherit;">√â compreens√≠vel em termos de monitoramento. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui est√£o suas vantagens:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">facilidade de opera√ß√£o - nginx como servidor proxy;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√© f√°cil monitorar e obter m√©tricas (basta monitorar o mesmo que o monitor em seu site);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agora, este protocolo √© o principal para entrega de conte√∫do.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Menos significativo:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alta lat√™ncia.</font></font></li>
</ul><br>
<img src="https://habrastorage.org/webt/fa/ko/2_/fako2_ysvwvhaguijmddcna20eu.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A lat√™ncia do HLS √© realmente aninhada no pr√≥prio protocolo; </font><font style="vertical-align: inherit;">como √© necess√°rio um longo tempo de buffer, o player √© for√ßado a esperar pelo menos quando um peda√ßo √© carregado, mas, de uma maneira boa, ele deve esperar at√© que dois peda√ßos (dois segmentos de m√≠dia) sejam carregados; caso contr√°rio, no caso de um atraso, o cliente ter√° o player carregado e isso n√£o afetar√° muito bem experi√™ncia de usu√°rio. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O segundo ponto que atrasa o HLS √© o cache. </font><font style="vertical-align: inherit;">A lista de reprodu√ß√£o √© armazenada em cache na camada interna e nos servidores de borda. </font><font style="vertical-align: inherit;">Mesmo se armazenamos em cache, relativamente falando, por um segundo ou meio segundo, isso representa aproximadamente mais 2-3 segundos de atraso. </font><font style="vertical-align: inherit;">No total, acontece de 12 a 18 segundos - isso n√£o √© muito agrad√°vel, obviamente √© melhor.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Melhorando o HLS</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Com esses pensamentos, come√ßamos a melhorar o HLS. Melhoramos de uma maneira bastante simples: vamos dar o √∫ltimo segmento de m√≠dia ainda n√£o gravado da playlist um pouco antes. Ou seja, assim que come√ßamos a escrever o √∫ltimo segmento de m√≠dia, o anunciamos imediatamente na playlist. O que est√° acontecendo neste momento? .. O </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
tempo de buffer nos jogadores √© reduzido. O jogador acredita que j√° baixou tudo e come√ßa a baixar com calma os segmentos desejados. Dessa forma, "enganamos" o player dessa maneira, mas se monitorarmos bem o "a√ßo" (cargas no player), isso n√£o nos assusta - podemos parar de fornecer o segmento com anteced√™ncia e tudo voltar√° ao normal.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O segundo ponto: ganhamos um total de cerca de 5-8 segundos. De onde eles v√™m? O tempo desse segmento √© de 2 a 4 segundos por segmento, mais o tempo para armazenar em cache a lista de reprodu√ß√£o (s√£o outros 2 ou 3 segundos). Al√©m disso, nosso atraso est√° diminuindo significativamente. O atraso √© reduzido de 12 a 15 segundos para 5-7. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O que mais h√° de bom nessa abordagem? √â realmente gr√°tis! S√≥ precisamos verificar se os jogadores s√£o compat√≠veis com essa abordagem. Aqueles que s√£o incompat√≠veis, enviamos para os URLs antigos e enviamos players compat√≠veis para os novos URLs. N√£o precisamos atualizar clientes antigos que suportam isso, o que tamb√©m √© importante. Na verdade, n√£o precisamos modificar, liberar players em clientes m√≥veis. N√£o precisamos desenvolver um web player. Parece bom o suficiente!</font></font><br>
<br>
<img src="https://habrastorage.org/webt/0f/gm/tt/0fgmttjysv2w8rg8bmzdgzcdtz4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dos pontos negativos - a necessidade de controlar o fluxo de v√≠deo recebido. </font><font style="vertical-align: inherit;">No caso de um cliente m√≥vel, podemos fazer isso com bastante facilidade (quando o fluxo vem de um cliente m√≥vel) ou transcodific√°-lo sem falhas, pois o player deve saber quanto tempo leva para um segmento de m√≠dia. </font><font style="vertical-align: inherit;">E como o anunciamos antes de realmente ser gravado, precisamos saber quanto tempo levar√° para grav√°-lo.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M√©tricas de qualidade</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Assim, melhoramos o HLS. </font><font style="vertical-align: inherit;">Agora, quero dizer como monitoramos e quais m√©tricas de qualidade captamos: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/3h/_y/iz/3h_yizx3clxbb18dzi-urr-oylq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Uma das principais m√©tricas de qualidade √© o hor√°rio de in√≠cio. </font><font style="vertical-align: inherit;">Idealmente, √© quando voc√™ percorre o cliente m√≥vel antes da transmiss√£o, pressiona o bot√£o e ele inicia imediatamente. </font><font style="vertical-align: inherit;">Seria ideal se ele fosse iniciado antes de voc√™ pressionar o bot√£o, mas, infelizmente, somente quando voc√™ pressionar.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O segundo ponto √© o atraso do sinal. Acreditamos que alguns segundos s√£o muito bons, 10 segundos s√£o toler√°veis, 20-30 segundos s√£o muito ruins. Por que isso √© importante? Por exemplo, para shows e alguns eventos p√∫blicos, essa √© uma m√©trica absolutamente sem import√¢ncia, n√£o h√° feedback; apenas mostramos o fluxo - √© melhor n√£o ficar atrasado do que um pequeno atraso. E para um fluxo em que algum tipo de confer√™ncia est√° acontecendo ou uma pessoa diz algo e faz perguntas, isso come√ßa a ser importante, porque eles fazem muitas perguntas nos coment√°rios e eu quero que o p√∫blico receba feedback o mais r√°pido poss√≠vel.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Outra m√©trica importante √© o buffer e as defasagens. </font><font style="vertical-align: inherit;">De fato, essa m√©trica √© importante n√£o apenas do ponto de vista do cliente e da qualidade, mas do ponto de vista de quanto podemos "esticar" a entrega do HLS, quanto podemos extrair dados de nossos servidores. </font><font style="vertical-align: inherit;">Portanto, monitoramos o tempo m√©dio do buffer nos players e o "a√ßo". </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A escolha da qualidade nos jogadores √© compreens√≠vel: mudan√ßas inesperadas s√£o sempre irritantes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Portanto, essa tamb√©m √© uma m√©trica importante.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Monitoramento</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Temos muitas m√©tricas de monitoramento, mas aqui eu escolhi aquelas m√©tricas que sempre funcionam se algo der errado:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ir/wy/me/irwymelifaedclj13razr83a85i.jpeg"><br>
<br>
<ul>
<li>-,    .   -   ,    .  ,  ‚Äì ,              ( ,  ‚Äì  ).</li>
<li> /     .  , ,  ,      ,        ,    .     .</li>
<li>  edge-.  ,       ,     edge-       .</li>
</ul><br>
<br>
<h3>  ¬´¬ª,       ?</h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora, mostrarei como lidamos com um aplicativo como o "Player" quando usamos nossa infraestrutura para transmitir um fluxo de v√≠deo com perguntas e respostas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Clover √© um question√°rio online. O anfitri√£o diz algo, pergunta: perguntas caem - voc√™ responde. 12 perguntas, 10 minutos do jogo, no final - algum tipo de pr√™mio. O que √© t√£o complicado? Isso √© crescimento! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√Ä direita, este gr√°fico: O </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hw/i8/_e/hwi8_er_sdcw_gxczrgk3z41en0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
pico [no gr√°fico] √© a carga nos servidores em termos da API no momento do in√≠cio do "Clover". O resto do tempo √© o fluxo usual de transmiss√µes. Isso n√£o pode ser equiparado ao n√∫mero de espectadores. Talvez este seja o n√∫mero de solicita√ß√µes e a carga.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√â dif√≠cil: em 5 minutos, um milh√£o de espectadores chegou at√© n√≥s no pico. </font><font style="vertical-align: inherit;">Eles come√ßam a assistir √† transmiss√£o, registrar-se, executar algum tipo de a√ß√£o, solicitar um v√≠deo ... Parece um jogo muito simples, mas isso acontece em um per√≠odo muito curto de tempo (todas as a√ß√µes, incluindo o jogo final) - isso gera uma carga bastante alta.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Que perguntas e desafios enfrentamos?</font></font></h3><br>
<img src="https://habrastorage.org/webt/pd/ci/xh/pdcixhln_tmsracssi9qfy5ra5y.jpeg"><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Crescimento r√°pido. </font><font style="vertical-align: inherit;">√Äs vezes, era de + 50% por semana. </font><font style="vertical-align: inherit;">Se, por exemplo, voc√™ tem 200 mil pessoas na quarta-feira, ent√£o no s√°bado ou domingo j√° pode haver 300. Isso √© muito! </font><font style="vertical-align: inherit;">Come√ßam a surgir problemas que n√£o eram vis√≠veis anteriormente.</font></font></li>
<li>    2   .       .      ,  .       ,  , ,          ,         ,    .<br>
 12         . ,    ,     ,    , ,    -      ,     ,  ‚Ä¶</li>
<li>      ,       .     , ,  200-300 ,         400-500.</li>
<li>- ,    ,   ,           3-5 .   ?    ¬´¬ª,    ,    ,         ,     .<br>
<br>
       (   3   ,   ),          ,       3-5 .    ?  ‚Äì  ,  ‚Äì     exponential backoff,        .<br>
<br>
  exponential on backoff:  ‚Äì ,       2 ,   4,  8.             backend-.</li>
</ul><br>
<h3>    ¬´¬ª?</h3><br>
<img src="https://habrastorage.org/webt/-h/c_/gn/-hc_gnjjd-m7ujstbxa9edwnoms.jpeg"><br>
<ul>
<li>-,         .      ,    ‚Äì   .</li>
<li>   ¬´ ¬ª.  ,     ,    ,      ,     ¬´¬ª.      ,   , -,    ,  -,     .</li>
<li> ,         ‚Äì   ,     ¬´¬ª    .      ¬´¬ª.     ,  ,   ,    ‚Ä¶     ‚Äì . 10% ¬´¬ª ‚Äì , 10% ¬´¬ª  100  ‚Äì  .</li>
<li> ¬´¬ª   ,     ,    ¬´¬ª      .       ‚Äì     -  .    100    ‚Äì  ,  1    15  ‚Äì   .</li>
<li>   .  ¬´¬ª   , , ,  .   ,      ,     .</li>
<li>   .                   ,    .         ,   latency,    .</li>
<li>   .    ‚Äì     ,       .</li>
<li>  ¬´¬ª       1           . ,  ,   .      .    ,     ,     .      .</li>
</ul><br>
<h3>  ?</h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A arquitetura nos conv√©m completamente, e eu posso recomend√°-la com seguran√ßa. A HLS permanecer√° conosco o protocolo principal para pelo menos o site e pelo menos o protocolo de backup para todo o resto. Talvez possamos mudar para MPEG-DASH. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
RTMP abandonado. Apesar de apresentar um atraso menor, decidimos ajustar o HLS. Talvez considere outros ve√≠culos de entrega, incluindo o DASH como uma alternativa. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qz/ut/oq/qzutoqnu3adqhxx0rivblxx9izq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos melhorar o saldo de entrada. Tamb√©m queremos fazer um failover cont√≠nuo para o balanceamento de entrada, para que, em caso de problemas em um dos servidores de m√≠dia do cliente, a comuta√ß√£o seja completamente invis√≠vel. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Talvez desenvolvamos sistemas de entrega de servidores de borda para o cliente. Provavelmente, ser√° algum tipo de UDP. Qual deles - agora estamos pensando e estamos na fase de pesquisa.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na verdade, √© tudo. </font><font style="vertical-align: inherit;">Obrigado a todos!</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quest√µes</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pergunta da plat√©ia (doravante - A): - Muito obrigado pelo relat√≥rio! </font><font style="vertical-align: inherit;">Apenas o orador do Odnoklassniki falou e ele disse que eles tinham que reescrever a serpentina, o codificador, o codificador ... Voc√™ usa essas solu√ß√µes ou usa as que est√£o no mercado (como Harmonic, etc.)? </font></font><br>
<br>
<img src="https://habrastorage.org/webt/1_/mt/qb/1_mtqbmuiapdtajkn5at3emzwtm.jpeg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MR:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Agora temos solu√ß√µes de terceiros girat√≥rias. </font><font style="vertical-align: inherit;">Das solu√ß√µes de c√≥digo aberto que usamos, tivemos o nginx, o m√≥dulo RTMP (por um longo tempo). </font><font style="vertical-align: inherit;">Por um lado, ele nos agradou porque trabalhou, bastante simples. </font><font style="vertical-align: inherit;">Lutamos por muito tempo para que ele trabalhasse de forma est√°vel. </font><font style="vertical-align: inherit;">Agora ele est√° passando do Nginx-RTMP para sua pr√≥pria solu√ß√£o. </font><font style="vertical-align: inherit;">Estamos pensando com um transcodificador agora. </font><font style="vertical-align: inherit;">O receptor, ou seja, a parte receptora, tamb√©m foi reescrito do Nginx-RTMP para sua solu√ß√£o. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Eu queria fazer uma pergunta sobre fatiar o RTMP no HLS, mas pelo que entendi, voc√™ j√° respondeu ... Diga-me, suas solu√ß√µes s√£o de c√≥digo aberto? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MR:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Estamos considerando lan√ß√°-lo em c√≥digo aberto. N√≥s preferimos lan√ß√°-lo, mas a quest√£o √© o momento do lan√ßamento em c√≥digo aberto. Basta colocar a fonte na Internet - isso n√£o √© suficiente. Voc√™ precisa pensar, fazer alguns exemplos de implanta√ß√£o. E com que finalidade voc√™ est√° perguntando? Deseja usar? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Porque eu tamb√©m me deparei com o Nginx-RTMP! √â, para dizer o m√≠nimo, que n√£o √© suportado por muito tempo. O autor nem sequer responde a perguntas particularmente ... </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MR:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Se voc√™ quiser, pode escrever para o correio. Dar para uso pr√≥prio? N√≥s podemos concordar. N√≥s realmente planejamos abri-lo. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Voc√™ tamb√©m disse que pode passar do HLS para o DASH. HLS n√£o combina? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MR:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Esta √© uma pergunta sobre o que podemos, ou talvez n√£o. Depende muito do que chegaremos em termos de pesquisa de m√©todos de entrega alternativos (ou seja, UDP). Se encontrarmos algo ‚Äúcompletamente‚Äù bom, provavelmente n√£o tocaremos no HLS. Se parece que o MPEG-DASH √© mais confort√°vel, talvez possamos mudar isso. N√£o parece ser muito dif√≠cil, mas n√£o temos certeza se √© necess√°rio ou n√£o. A sincroniza√ß√£o entre fluxos, entre qualidades e outras coisas √© claramente melhor l√°. Existem vantagens. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Em rela√ß√£o aos alertas. Voc√™ falou sobre o fato de que, se os fluxos param de transmitir, isso √© imediatamente um alerta. E voc√™ n√£o percebeu algo independente: o provedor caiu, Megafon caiu e as pessoas pararam de transmitir? .. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MR:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Digamos que algo independente de n√≥s √© basicamente todos os tipos de feriados e assim por diante. Sim eles fizeram. Bem, eles fizeram sim. Os administradores olharam - hoje s√£o as f√©rias, o restante das caracter√≠sticas est√£o bem - eles se acalmaram. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - E sobre dimensionamento. Em que n√≠vel ele escala? Por exemplo, solicitei um fluxo do telefone - receberei imediatamente um determinado link com o servidor ash correto? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MR:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Um link ser√° enviado imediatamente e, se necess√°rio, ser√° alternado (se houver problemas em um servidor espec√≠fico). </font></font><br>
<br>
<img src="https://habrastorage.org/webt/xz/tn/rq/xztnrqvvbr73gu61lqgpvdt5c-e.jpeg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Quem trocar√°? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MR:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - player m√≥vel ou web player. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Ele ir√° reiniciar o stream ou o qu√™? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MR:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Um novo link chegar√° at√© ele, onde ele deve ir ao vivo. Ele vai l√° e pede novamente o fluxo. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Em que n√≠vel voc√™ tem caches? E playlists e peda√ßos, ou apenas isso? .. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MR:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - E playlists, peda√ßos! Ele armazena em cache de maneira um pouco diferente, tanto em termos de tempo quanto em termos de retorno do tempo, mas os armazenamos em cache. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Em rela√ß√£o √† cria√ß√£o de servidores de cinzas? Voc√™ teve uma situa√ß√£o dessas que assiste a 2 milh√µes de telespectadores em uma transmiss√£o, n√£o tem tempo para algo e pega rapidamente algum servidor ash? Ou voc√™ eleva tudo antecipadamente com uma margem? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Senhor:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Talvez n√£o tenha sido. Em primeiro lugar, o estoque √© sempre pequeno ou grande - isso n√£o importa. Em segundo lugar, n√£o acontece que uma transmiss√£o repentinamente se torne super popular. Podemos prever bem o n√∫mero de espectadores. Basicamente, para termos muitas pessoas, precisamos fazer um esfor√ßo. Dessa forma, podemos ajustar o n√∫mero de espectadores da transmiss√£o, dependendo de quais esfor√ßos s√£o feitos. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Voc√™ disse que mede atrasos instrumentais por parte do player. Qu√£o? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MR:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Muito simples. Nos trechos (nos segmentos de m√≠dia), temos um registro de data e hora, no nome do segmento de m√≠dia - no player, apenas o retornamos. Se ele n√£o √© explicitamente, ele retorna. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Lembro de tentar executar o peering no WebRTC. Por que recusou? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Senhor:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Eu n√£o posso responder a esta pergunta para voc√™ - aconteceu sem mim." N√£o sei dizer por que tentei e n√£o sei por que me recusei. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Em rela√ß√£o ao receptor e ao servidor de m√≠dia. Pelo que entendi, voc√™ costumava ter o Nginx-RTMP, agora, l√° e ali, voc√™ tem solu√ß√µes criadas por voc√™. Na verdade, este √© um servidor de m√≠dia que proxies outros servidores de m√≠dia, e eles j√° est√£o no cache e na borda. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MR:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Ent√£o, na verdade n√£o. Essa √© uma solu√ß√£o criada por voc√™, mas √© diferente em termos de servidor de m√≠dia e de receptor. Nginx-RTMP - era algum tipo de colheitadeira que podia fazer as duas coisas. Nossos interiores do receptor e do servidor de m√≠dia s√£o muito diferentes - tanto por c√≥digo quanto por toda parte. A √∫nica coisa que os une √© o processamento RTMP. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Em rela√ß√£o ao equil√≠brio entre as arestas. Como isso acontece?</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MR:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Medimos o tr√°fego, enviamos para o servidor desejado. N√£o entendi um pouco a pergunta ... </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Explico: o usu√°rio solicita uma lista de reprodu√ß√£o atrav√©s do player - ele retorna os caminhos relativos a manifestos e partes ou caminhos absolutos, por exemplo, por IP ou dom√≠nio? .. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MR:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Os caminhos s√£o relativos. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Ou seja, n√£o h√° balanceamento ao visualizar um fluxo por um usu√°rio? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MR:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Isso acontece. Complicado o suficiente. Podemos usar o redirecionamento 301 ao sobrecarregar o servidor. Se percebermos que tudo est√° completamente ruim por l√°, para segmentos, podemos envi√°-lo para outro servidor. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Mas deve estar ligado √† l√≥gica do jogador? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Senhor:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- N√£o, apenas esta parte n√£o deve ser costurada. Redirecionamento 301! Simplesmente, o jogador deve conseguir sair do 301¬∫ link. Podemos envi√°-lo para outro servidor do lado do servidor no momento da sobrecarga. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Ou seja, ele pergunta ao servidor, e o servidor entrega a ele? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MR:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Sim. Isso n√£o √© muito bom, portanto, a l√≥gica do jogador √© usada para retuitar links para o caso de falha de um dos servidores - isso j√° est√° na l√≥gica do jogador. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - E voc√™ n√£o tentou trabalhar n√£o de forma relativa, mas de maneiras absolutas: quando voc√™ pede ao jogador que fa√ßa alguma m√°gica, descubra onde existem recursos e onde n√£o existem e j√° fornece listas de reprodu√ß√£o indicando um servidor espec√≠fico? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Senhor:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Na verdade, parece uma solu√ß√£o funcional. </font><font style="vertical-align: inherit;">Se voc√™ tivesse vindo ent√£o, ter√≠amos pesado os dois! </font><font style="vertical-align: inherit;">Mas a solu√ß√£o atual tamb√©m est√° funcionando, ent√£o n√£o quero realmente pular de uma para outra, embora, talvez, isso tamb√©m pare√ßa uma solu√ß√£o funcional. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Diga-me, isso √© de alguma forma amig√°vel com o multicast? </font><font style="vertical-align: inherit;">HLS, pelo que entendi, absolutamente nada ... </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MR:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Na implementa√ß√£o atual, provavelmente n√£o temos nada no sistema com o multicast ao vivo. </font><font style="vertical-align: inherit;">N√£o inclu√≠mos o conceito de multicast aqui. </font><font style="vertical-align: inherit;">Talvez em algum lugar nas profundezas da magia administrativa, haja algo dentro da rede, mas esteja oculto a todos e ningu√©m saiba ...</font></font><br>
<br>
<img src="https://habrastorage.org/webt/qr/va/s2/qrvas2mhyryhgck9t6n8ffc1pai.jpeg"><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/bA-Y_BfTZZY" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um pouco de publicidade :)</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Obrigado por ficar com a gente. Voc√™ gosta dos nossos artigos? Deseja ver materiais mais interessantes? Ajude-nos fazendo um pedido ou recomendando aos seus amigos o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VPS baseado em nuvem para desenvolvedores a partir de US $ 4,99</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , um </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">anal√≥gico exclusivo de servidores </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">b√°sicos </font></font></a><font style="vertical-align: inherit;"><b><font style="vertical-align: inherit;">que foi inventado por n√≥s para voc√™: </font></b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">Toda a verdade sobre o VPS (KVM) E5-2697 v3 (6 n√∫cleos) 10GB DDR4 480GB SSD 1Gbps de 10GB de US $ 19 ou como dividir o servidor?</font></a><font style="vertical-align: inherit;"> (as op√ß√µes est√£o dispon√≠veis com RAID1 e RAID10, at√© 24 n√∫cleos e at√© 40GB DDR4). </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dell R730xd 2 vezes mais barato no data center Equinix Tier IV em Amsterd√£?</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Somente n√≥s temos </font></font><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 TVs Intel TetraDeca-Core Xeon 2x E5-2697v3 2.6GHz 14C 64GB DDR4 4x960GB SSD 1Gbps 100 TV a partir de US $ 199</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> na Holanda!</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dell R420 - 2x E5-2430 2.2Ghz 6C 128GB DDR3 2x960GB SSD 1Gbps 100TB - a partir de US $ 99! </font></font></b></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Leia sobre</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> como construir infraestrutura </font><font style="vertical-align: inherit;">classe c usando servidores Dell R730xd E5-2650 v4 que custam 9.000 euros por um centavo?</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt488136/index.html">Como o rob√¥ Atlas aprendeu a fazer acrobacias, insuport√°veis ‚Äã‚Äãpara uma pessoa comum?</a></li>
<li><a href="../pt488138/index.html">Medi√ß√µes de capacit√¢ncia pequena (sensor capacitivo anal√≥gico)</a></li>
<li><a href="../pt488140/index.html">Como simplificar a vida com a ajuda da lei de Pareto</a></li>
<li><a href="../pt488142/index.html">Avalonia pensativa</a></li>
<li><a href="../pt488146/index.html">[Discuss√£o]: S√£o engenheiros de TI, s√£o engenheiros de TI?</a></li>
<li><a href="../pt488150/index.html">Antiguidades: ThinkPad X200 e c√≥digo fechado</a></li>
<li><a href="../pt488152/index.html">Um prot√≥tipo de jogo multiplayer para as 15h?</a></li>
<li><a href="../pt488154/index.html">Entramos no lugar do gerente do escrit√≥rio. Algoritmos b√°sicos de suprimento</a></li>
<li><a href="../pt488160/index.html">Windows Server 2019 vs. Instant√¢neos VMware com desativa√ß√£o: uma solu√ß√£o elegante para o problema</a></li>
<li><a href="../pt488162/index.html">Quanto maior a classifica√ß√£o, mais dinheiro e vice-versa</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>