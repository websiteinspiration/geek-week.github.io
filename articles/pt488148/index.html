<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>⛪️ 🗓️ 🤸🏾 HighLoad ++, Mikhail Raichenko (ManyChat): quase sem mágica, ou como é fácil distribuir stream de vídeo terabit ✌️ 👩🏿‍🤝‍👨🏾 🖕🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A próxima conferência HighLoad ++ será realizada nos dias 6 e 7 de abril de 2020 em São Petersburgo. Detalhes e ingressos aqui . HighLoad ++ Moscow 20...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>HighLoad ++, Mikhail Raichenko (ManyChat): quase sem mágica, ou como é fácil distribuir stream de vídeo terabit</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ua-hosting/blog/488148/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A próxima conferência HighLoad ++ será realizada nos dias 6 e 7 de abril de 2020 em São Petersburgo. </font><font style="vertical-align: inherit;">Detalhes e ingressos </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqui</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">HighLoad ++ Moscow 2018. Salão "Delhi + Calcutta". </font><font style="vertical-align: inherit;">8 de novembro, 14h </font><font style="vertical-align: inherit;">Resumos e </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apresentação</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ym/ji/ba/ymjiba---vkcs5ibbqbk9kcz8ny.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Trabalho na equipe VKontakte e estou desenvolvendo um sistema de transmissão de vídeo. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No relatório, compartilharei os recursos do desenvolvimento de back-end, a maneira como nosso sistema evoluiu e as soluções técnicas para as quais chegamos: </font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">como fizemos o backend da transmissão de vídeo e o processo de evolução como ele é;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o impacto dos requisitos comerciais e operacionais na arquitetura;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Aguarde" e "tente novamente" falharão;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">como as tarefas mais simples são complicadas pelo número de usuários;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">como reduzir a latência sem UDP;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Realizamos testes de estresse 2 vezes ao dia, ou com o que Clover nos ajudou.</font></font></li>
</ul><a name="habracut"></a><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mikhail Raichenko (a seguir - MR):</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Uma pequena excursão. </font><font style="vertical-align: inherit;">Vou falar sobre as pessoas que transmitem para nós, ao vivo (ao vivo), sobre quais plataformas recebemos o fluxo de vídeo e quais distribuímos. </font><font style="vertical-align: inherit;">No final, falarei sobre a arquitetura atual do live, sobre suas limitações e capacidades, bem como sobre como a arquitetura atual sobreviveu a um efeito como "Clover".</font></font><br>
<br>
<img src="https://habrastorage.org/webt/_h/bm/lt/_hbmlt0c2ek74zfr89jdff3wtsw.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sobre transmissões ao vivo. </font><font style="vertical-align: inherit;">Esboço do relatório</font></font></h3><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Primeiro, falarei um pouco sobre as próprias transmissões e transmissões ao vivo, enviando-nos o conteúdo de vídeo que mostramos a outros espectadores.</font></font></li>
<li>         .    ?     ,     , , ,   -  - , - , .   ,        :   ,  – .</li>
<li>    . ,      .     .     ,      ,     .</li>
<li>  ,     ,   .   ,         .  ,   ,   ,  , ,   2014-2015 .     ,      .</li>
<li>       .  ,                    .</li>
<li>,    .          ,    . ,    .</li>
<li>    ,    .      .</li>
<li>  ,    ,      «»,    .</li>
</ul><br>
<img src="https://habrastorage.org/webt/lz/mm/jw/lzmmjwth6qvdlryupzhegpftal0.jpeg"><br>
<br>
<h3>     </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todos os serviços de transmissão são mais ou menos assim: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/dt/2r/va/dt2rvaddozkmjrcp-1ojlaixmr0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
temos um pouco de streamer, ele envia um fluxo RTMP para nós e mostramos ao público - nada surpreendente, nada sobrenatural. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ee/fx/kq/eefxkq8vknyi57vz-y-_ekw5pd0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De onde vem o fluxo de vídeo? Uma fonte significativa de tráfego para nós é o nosso aplicativo móvel VKlife. O que há de bom nele? Nele, podemos controlar totalmente como codificamos o vídeo. Podemos fazer muitas otimizações no lado do cliente, para que mais tarde, com atrasos mínimos, mostrem aos nossos espectadores. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das desvantagens: aplicativos móveis funcionam em cima de redes. Pode ser 3G ... De qualquer forma, são quase sempre redes móveis, o que apresenta alguns atrasos - você precisa armazenar em buffer adicionalmente os dados no lado do aplicativo, para que o fluxo funcione da maneira mais suave possível.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A segunda fonte são streamers com OBS, Wirecast ou aqueles que transmitem a partir de outros aplicativos de desktop. </font><font style="vertical-align: inherit;">Esta é uma audiência bastante grande. </font><font style="vertical-align: inherit;">Às vezes, são seminários, às vezes - fluxos de jogos (existem muitos deles em tais aplicativos). </font><font style="vertical-align: inherit;">Do ponto positivo: existem poucas aplicações desse tipo, podemos oferecer boas recomendações de ajuste às nossas serpentinas. </font><font style="vertical-align: inherit;">Mas, ao mesmo tempo, há muitas configurações e não enviamos exatamente o fluxo que queremos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A terceira categoria é o fluxo RTMP dos servidores de mídia. </font><font style="vertical-align: inherit;">Estes podem ser servidores de mídia muito pequenos, ou seja, um formato doméstico: uma pessoa transmite uma visão da rua ou qualquer outra coisa. </font><font style="vertical-align: inherit;">Ou transmissões bastante sérias de nossos parceiros: pode haver qualquer coisa, não existem muitos desses fluxos, mas basicamente são muito importantes para nós.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quem está assistindo?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Novamente, esta é uma aplicação móvel - tudo está claro aqui. O maior problema é a latência da rede. Dos profissionais: podemos personalizar o player - é conveniente para nós, bom, mas não em todos os lugares onde fica 100%. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Web player em vk.com. Aqui também tudo é simples - é um reprodutor de web comum que você pode abrir para assistir. Uma audiência suficientemente grande no vk.com, muitos espectadores nas transmissões. Algumas transmissões estão suspensas em nossa seção "Vídeo" - pode haver dezenas de milhares (às vezes sem PR), especialmente se esse for um conteúdo interessante. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Assim, os canais são grandes o suficiente para os espectadores que estão sentados em um web player. Portanto, há muito tráfego, inclusive para uma transmissão.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O terceiro é o web player VKontakte em algum site de terceiros. </font><font style="vertical-align: inherit;">Você pode começar a transmitir tudo o que quiser e pendurar um web player VKontakte no seu site. </font><font style="vertical-align: inherit;">Você pode se tornar nosso parceiro se tiver um conteúdo interessante: você pode pendurá-lo por conta própria, pode pendurar conosco - como desejar. </font><font style="vertical-align: inherit;">Você pode organizar suas transmissões dessa maneira e tudo funcionará.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comparação com videochamadas</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nas videochamadas, algumas distorções da imagem serão perdoadas. As videochamadas são mais simples: podemos degradar significativamente a imagem, mas, ao mesmo tempo, precisamos manter uma latência muito boa. Com um longo atraso, o serviço será absolutamente impossível de usar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nas transmissões nesse sentido, é um pouco vice-versa: precisamos manter alta qualidade de imagem, mas, ao mesmo tempo, podemos aumentar a latência devido a muitos fatores. Por exemplo, o player armazena em buffer o fluxo de uma maneira ou de outra (pode ser um segundo, dois para sobreviver à degradação da rede, por exemplo); portanto, na maioria dos casos, não é necessário um segundo atraso de milissegundos. Você pode se esforçar para isso, mas a comida não é um pré-requisito.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/j0/7o/o6/j07oo6ceqiizh_lzdgjsgvgfwtq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No vídeo comum, a situação é exatamente o oposto. </font><font style="vertical-align: inherit;">Precisamos de muito boa qualidade. </font><font style="vertical-align: inherit;">Ao mesmo tempo, é desejável minimizar o tamanho do vídeo, a taxa de bits e a qualidade, para que, com o fluxo mínimo, forneça a melhor solução. </font><font style="vertical-align: inherit;">Dos profissionais: não temos tempo limitado: no momento do download do vídeo, temos tempo suficiente para otimizar o vídeo, ver como compactá-lo da melhor maneira, fazer alguma coisa, arrastá-lo para caches, se necessário - em geral, tudo é suficiente ESTÁ BEM. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/jf/r-/cc/jfr-cco9dozhxgqqnuw57opkqjk.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ao vivo, a situação é, novamente, o oposto: temos muito pouco tempo para transcodificar. </font><font style="vertical-align: inherit;">Ao mesmo tempo, existem poucas oportunidades, mas não há expectativas para a transmissão. </font><font style="vertical-align: inherit;">O público nos perdoará se tivermos apoio ou se a qualidade não for muito boa.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Primeira versão</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
É bastante esperado: na </font></font><br>
<br>
<img src="https://habrastorage.org/webt/3f/gt/bw/3fgtbwzvl3uf680sfzsf8kjette.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
verdade, é um pouco diferente: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vu/9r/zu/vu9rzujgkidpvrb66qzgbvapljo.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
"Streamer - servidor de mídia - nível de cache - visualizadores". </font><font style="vertical-align: inherit;">Em princípio, esta versão permite escalar com bastante força. </font><font style="vertical-align: inherit;">Eu diria que já deveria suportar dezenas de milhares de espectadores. </font><font style="vertical-align: inherit;">Tem outras desvantagens ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por exemplo, se você olhar para este circuito (slide anterior), poderá ver que ele não é tolerante a falhas. </font><font style="vertical-align: inherit;">Devemos adivinhar com o servidor de mídia para equilibrar bem o público. </font><font style="vertical-align: inherit;">Não podemos pendurar muitos caches em cada servidor - é simplesmente caro. </font><font style="vertical-align: inherit;">Portanto, vimos, percebemos que era simples e claro, havia algumas possibilidades de dimensionamento, mas obviamente algo estava faltando ... E começamos a formular requisitos.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Requisitos de infraestrutura</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O que é importante?</font></font><br>
<br>
<ul>
<li> .     , ,    .            (       ).       (,  ).</li>
<li>.     : -,    (,    )      ; -,     –      ,    ,       .</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Entrega para as regiões. </font><font style="vertical-align: inherit;">Também é um ponto importante! </font><font style="vertical-align: inherit;">É estúpido arrastar todo o conteúdo de vídeo de Petersburgo ou Moscou para algum tipo de Novosibirsk, Ecaterimburgo ou mesmo de São Petersburgo para Moscou. </font><font style="vertical-align: inherit;">Isso não é muito bom, pois o atraso da rede será longo - haverá atrasos, tudo ficará lento e isso não será bom. </font><font style="vertical-align: inherit;">Portanto, nossa infraestrutura deve levar em conta que entregamos conteúdo para as regiões.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conveniência de operação e monitoramento. </font><font style="vertical-align: inherit;">Uma propriedade importante. </font><font style="vertical-align: inherit;">Como o sistema é grande, há muitos visualizadores, é importante enviar alertas aos administradores a tempo, em caso de problemas, incluindo o monitoramento de métricas técnicas e do produto.</font></font></li>
</ul><br>
<img src="https://habrastorage.org/webt/km/n1/e_/kmn1e_0ii74m9xilh_5rsic9l5a.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como é a infraestrutura de transmissão agora?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como resultado, chegamos a uma infraestrutura bastante simples, mas eficaz ...</font></font><br>
<br>
<ul>
<li> – ,       ( ,  ).   RTMP-,    .        ,  .</li>
<li> ,      ,     ,  ,   .       .  ,   ,   ,   – : , -,  (. .       ); -,     .</li>
<li>      .     –    ,   .        ,    ,    .      ,         (    ,  ).</li>
<li>         ,         (edge-).     ,  .    !</li>
<li>   –  edge-,      ,   .   :      ,   –    .</li>
</ul><br>
<img src="https://habrastorage.org/webt/2e/cu/qp/2ecuqpdeldwtxd6qjyi-x4q0_ke.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Curiosamente? </font><font style="vertical-align: inherit;">Balanceamento! </font><font style="vertical-align: inherit;">Nesse esquema, escolhemos o balanceamento, tentamos enviar espectadores que assistem o mesmo fluxo para cada servidor de borda. </font><font style="vertical-align: inherit;">A localidade do cache é muito importante aqui, porque pode haver muitos servidores de borda; </font><font style="vertical-align: inherit;">e se não observarmos o local temporário e o cache do ponto de vista do fluxo, sobrecarregaremos a camada interna. </font><font style="vertical-align: inherit;">Também não gostaríamos disso.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Portanto, equilibramos da seguinte maneira: selecionamos um determinado servidor de borda para a região para a qual enviamos visualizadores e enviamos até começarmos a entender que ocorreu algum preenchimento e que deve ser enviado para outro servidor. </font><font style="vertical-align: inherit;">O circuito é simples e funciona com muita confiabilidade. </font><font style="vertical-align: inherit;">Naturalmente, para fluxos diferentes, você escolhe uma sequência diferente de servidores de borda (a sequência na qual enviamos espectadores). </font><font style="vertical-align: inherit;">Consequentemente, o balanceamento funciona de maneira bastante simples.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Também fornecemos ao cliente um link para um servidor de borda disponível. </font><font style="vertical-align: inherit;">Isso é feito para que, em caso de falha do servidor de borda, possamos redirecionar o visualizador para outro. </font><font style="vertical-align: inherit;">Ou seja, quando o espectador assiste à transmissão, ele recebe um link para o servidor desejado uma vez a cada poucos segundos. </font><font style="vertical-align: inherit;">Se ele entender que o link deve ser diferente, ele alterna (o player alterna) e continua a assistir à transmissão de outro servidor. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Outro papel importante dos servidores de borda é a proteção de conteúdo. </font><font style="vertical-align: inherit;">Toda a proteção de conteúdo ocorre basicamente lá. </font><font style="vertical-align: inherit;">Nós temos nosso próprio módulo nginx para isso. </font><font style="vertical-align: inherit;">É um pouco semelhante ao Security Link.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dimensionamento e balanceamento</font></font></h3><br>
<ul>
<li>   . ,        :     ,       .          edge-,        .     .     .    …   ,     –    ,  --    – ,  – , , ,   –  !   –        .</li>
<li>      .  ,  ,         ,    ,       :     .       (   )    ,    –   ,   . ,    ,     ,      edge-.</li>
<li>   ,   ,       ,     .</li>
</ul><br>
<img src="https://habrastorage.org/webt/19/nj/i8/19nji8vwkh_kjrrsm9d698hf5ji.jpeg"><br>
<br>
<h3>   ?</h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um dos principais protocolos que tínhamos era o RTMP (não apenas para entrada, mas também para distribuição de conteúdo). A principal vantagem é a baixa latência. Pode demorar meio segundo, segundo, dois segundos. De fato, os benefícios terminam aí ... </font></font><br>
<br>
<img src="https://habrastorage.org/webt/u7/fv/al/u7fvaloyunlxmyavp5rjemer4sw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esse protocolo de streaming é difícil de monitorar - é fechado em certo sentido, apesar do fato de haver uma especificação. O Flash player não funciona mais (na verdade, já é "tudo"). Precisa de suporte no nível da CDN - você precisa de módulos nginx especiais ou de seu próprio software para transferir o fluxo normalmente. Há também algumas dificuldades com os clientes móveis. Pronto para uso em clientes móveis, o suporte é péssimo - são necessárias melhorias especiais e tudo isso é muito difícil.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O segundo protocolo que usamos é o HLS. </font><font style="vertical-align: inherit;">Parece bem simples: é um arquivo de texto, o chamado arquivo de índice. </font><font style="vertical-align: inherit;">Ele contém links para arquivos de índice com permissões diferentes e os próprios arquivos contêm links para segmentos de mídia. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/w-/hl/vf/w-hlvfylbcsu1n6ksqlv7uy5e5a.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como ele está bem? </font><font style="vertical-align: inherit;">É muito simples, apesar de ser um pouco velho. </font><font style="vertical-align: inherit;">Ele permite que você use CDN, ou seja, você só precisa do nginx para distribuir o protocolo HLS. </font><font style="vertical-align: inherit;">É compreensível em termos de monitoramento. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui estão suas vantagens:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">facilidade de operação - nginx como servidor proxy;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é fácil monitorar e obter métricas (basta monitorar o mesmo que o monitor em seu site);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agora, este protocolo é o principal para entrega de conteúdo.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Menos significativo:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alta latência.</font></font></li>
</ul><br>
<img src="https://habrastorage.org/webt/fa/ko/2_/fako2_ysvwvhaguijmddcna20eu.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A latência do HLS é realmente aninhada no próprio protocolo; </font><font style="vertical-align: inherit;">como é necessário um longo tempo de buffer, o player é forçado a esperar pelo menos quando um pedaço é carregado, mas, de uma maneira boa, ele deve esperar até que dois pedaços (dois segmentos de mídia) sejam carregados; caso contrário, no caso de um atraso, o cliente terá o player carregado e isso não afetará muito bem experiência de usuário. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O segundo ponto que atrasa o HLS é o cache. </font><font style="vertical-align: inherit;">A lista de reprodução é armazenada em cache na camada interna e nos servidores de borda. </font><font style="vertical-align: inherit;">Mesmo se armazenamos em cache, relativamente falando, por um segundo ou meio segundo, isso representa aproximadamente mais 2-3 segundos de atraso. </font><font style="vertical-align: inherit;">No total, acontece de 12 a 18 segundos - isso não é muito agradável, obviamente é melhor.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Melhorando o HLS</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Com esses pensamentos, começamos a melhorar o HLS. Melhoramos de uma maneira bastante simples: vamos dar o último segmento de mídia ainda não gravado da playlist um pouco antes. Ou seja, assim que começamos a escrever o último segmento de mídia, o anunciamos imediatamente na playlist. O que está acontecendo neste momento? .. O </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
tempo de buffer nos jogadores é reduzido. O jogador acredita que já baixou tudo e começa a baixar com calma os segmentos desejados. Dessa forma, "enganamos" o player dessa maneira, mas se monitorarmos bem o "aço" (cargas no player), isso não nos assusta - podemos parar de fornecer o segmento com antecedência e tudo voltará ao normal.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O segundo ponto: ganhamos um total de cerca de 5-8 segundos. De onde eles vêm? O tempo desse segmento é de 2 a 4 segundos por segmento, mais o tempo para armazenar em cache a lista de reprodução (são outros 2 ou 3 segundos). Além disso, nosso atraso está diminuindo significativamente. O atraso é reduzido de 12 a 15 segundos para 5-7. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O que mais há de bom nessa abordagem? É realmente grátis! Só precisamos verificar se os jogadores são compatíveis com essa abordagem. Aqueles que são incompatíveis, enviamos para os URLs antigos e enviamos players compatíveis para os novos URLs. Não precisamos atualizar clientes antigos que suportam isso, o que também é importante. Na verdade, não precisamos modificar, liberar players em clientes móveis. Não precisamos desenvolver um web player. Parece bom o suficiente!</font></font><br>
<br>
<img src="https://habrastorage.org/webt/0f/gm/tt/0fgmttjysv2w8rg8bmzdgzcdtz4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dos pontos negativos - a necessidade de controlar o fluxo de vídeo recebido. </font><font style="vertical-align: inherit;">No caso de um cliente móvel, podemos fazer isso com bastante facilidade (quando o fluxo vem de um cliente móvel) ou transcodificá-lo sem falhas, pois o player deve saber quanto tempo leva para um segmento de mídia. </font><font style="vertical-align: inherit;">E como o anunciamos antes de realmente ser gravado, precisamos saber quanto tempo levará para gravá-lo.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Métricas de qualidade</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Assim, melhoramos o HLS. </font><font style="vertical-align: inherit;">Agora, quero dizer como monitoramos e quais métricas de qualidade captamos: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/3h/_y/iz/3h_yizx3clxbb18dzi-urr-oylq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Uma das principais métricas de qualidade é o horário de início. </font><font style="vertical-align: inherit;">Idealmente, é quando você percorre o cliente móvel antes da transmissão, pressiona o botão e ele inicia imediatamente. </font><font style="vertical-align: inherit;">Seria ideal se ele fosse iniciado antes de você pressionar o botão, mas, infelizmente, somente quando você pressionar.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O segundo ponto é o atraso do sinal. Acreditamos que alguns segundos são muito bons, 10 segundos são toleráveis, 20-30 segundos são muito ruins. Por que isso é importante? Por exemplo, para shows e alguns eventos públicos, essa é uma métrica absolutamente sem importância, não há feedback; apenas mostramos o fluxo - é melhor não ficar atrasado do que um pequeno atraso. E para um fluxo em que algum tipo de conferência está acontecendo ou uma pessoa diz algo e faz perguntas, isso começa a ser importante, porque eles fazem muitas perguntas nos comentários e eu quero que o público receba feedback o mais rápido possível.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Outra métrica importante é o buffer e as defasagens. </font><font style="vertical-align: inherit;">De fato, essa métrica é importante não apenas do ponto de vista do cliente e da qualidade, mas do ponto de vista de quanto podemos "esticar" a entrega do HLS, quanto podemos extrair dados de nossos servidores. </font><font style="vertical-align: inherit;">Portanto, monitoramos o tempo médio do buffer nos players e o "aço". </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A escolha da qualidade nos jogadores é compreensível: mudanças inesperadas são sempre irritantes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Portanto, essa também é uma métrica importante.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Monitoramento</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Temos muitas métricas de monitoramento, mas aqui eu escolhi aquelas métricas que sempre funcionam se algo der errado:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ir/wy/me/irwymelifaedclj13razr83a85i.jpeg"><br>
<br>
<ul>
<li>-,    .   -   ,    .  ,  – ,              ( ,  –  ).</li>
<li> /     .  , ,  ,      ,        ,    .     .</li>
<li>  edge-.  ,       ,     edge-       .</li>
</ul><br>
<br>
<h3>  «»,       ?</h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora, mostrarei como lidamos com um aplicativo como o "Player" quando usamos nossa infraestrutura para transmitir um fluxo de vídeo com perguntas e respostas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Clover é um questionário online. O anfitrião diz algo, pergunta: perguntas caem - você responde. 12 perguntas, 10 minutos do jogo, no final - algum tipo de prêmio. O que é tão complicado? Isso é crescimento! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
À direita, este gráfico: O </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hw/i8/_e/hwi8_er_sdcw_gxczrgk3z41en0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
pico [no gráfico] é a carga nos servidores em termos da API no momento do início do "Clover". O resto do tempo é o fluxo usual de transmissões. Isso não pode ser equiparado ao número de espectadores. Talvez este seja o número de solicitações e a carga.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
É difícil: em 5 minutos, um milhão de espectadores chegou até nós no pico. </font><font style="vertical-align: inherit;">Eles começam a assistir à transmissão, registrar-se, executar algum tipo de ação, solicitar um vídeo ... Parece um jogo muito simples, mas isso acontece em um período muito curto de tempo (todas as ações, incluindo o jogo final) - isso gera uma carga bastante alta.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Que perguntas e desafios enfrentamos?</font></font></h3><br>
<img src="https://habrastorage.org/webt/pd/ci/xh/pdcixhln_tmsracssi9qfy5ra5y.jpeg"><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Crescimento rápido. </font><font style="vertical-align: inherit;">Às vezes, era de + 50% por semana. </font><font style="vertical-align: inherit;">Se, por exemplo, você tem 200 mil pessoas na quarta-feira, então no sábado ou domingo já pode haver 300. Isso é muito! </font><font style="vertical-align: inherit;">Começam a surgir problemas que não eram visíveis anteriormente.</font></font></li>
<li>    2   .       .      ,  .       ,  , ,          ,         ,    .<br>
 12         . ,    ,     ,    , ,    -      ,     ,  …</li>
<li>      ,       .     , ,  200-300 ,         400-500.</li>
<li>- ,    ,   ,           3-5 .   ?    «»,    ,    ,         ,     .<br>
<br>
       (   3   ,   ),          ,       3-5 .    ?  –  ,  –     exponential backoff,        .<br>
<br>
  exponential on backoff:  – ,       2 ,   4,  8.             backend-.</li>
</ul><br>
<h3>    «»?</h3><br>
<img src="https://habrastorage.org/webt/-h/c_/gn/-hc_gnjjd-m7ujstbxa9edwnoms.jpeg"><br>
<ul>
<li>-,         .      ,    –   .</li>
<li>   « ».  ,     ,    ,      ,     «».      ,   , -,    ,  -,     .</li>
<li> ,         –   ,     «»    .      «».     ,  ,   ,    …     – . 10% «» – , 10% «»  100  –  .</li>
<li> «»   ,     ,    «»      .       –     -  .    100    –  ,  1    15  –   .</li>
<li>   .  «»   , , ,  .   ,      ,     .</li>
<li>   .                   ,    .         ,   latency,    .</li>
<li>   .    –     ,       .</li>
<li>  «»       1           . ,  ,   .      .    ,     ,     .      .</li>
</ul><br>
<h3>  ?</h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A arquitetura nos convém completamente, e eu posso recomendá-la com segurança. A HLS permanecerá conosco o protocolo principal para pelo menos o site e pelo menos o protocolo de backup para todo o resto. Talvez possamos mudar para MPEG-DASH. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
RTMP abandonado. Apesar de apresentar um atraso menor, decidimos ajustar o HLS. Talvez considere outros veículos de entrega, incluindo o DASH como uma alternativa. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qz/ut/oq/qzutoqnu3adqhxx0rivblxx9izq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos melhorar o saldo de entrada. Também queremos fazer um failover contínuo para o balanceamento de entrada, para que, em caso de problemas em um dos servidores de mídia do cliente, a comutação seja completamente invisível. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Talvez desenvolvamos sistemas de entrega de servidores de borda para o cliente. Provavelmente, será algum tipo de UDP. Qual deles - agora estamos pensando e estamos na fase de pesquisa.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na verdade, é tudo. </font><font style="vertical-align: inherit;">Obrigado a todos!</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Questões</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pergunta da platéia (doravante - A): - Muito obrigado pelo relatório! </font><font style="vertical-align: inherit;">Apenas o orador do Odnoklassniki falou e ele disse que eles tinham que reescrever a serpentina, o codificador, o codificador ... Você usa essas soluções ou usa as que estão no mercado (como Harmonic, etc.)? </font></font><br>
<br>
<img src="https://habrastorage.org/webt/1_/mt/qb/1_mtqbmuiapdtajkn5at3emzwtm.jpeg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MR:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Agora temos soluções de terceiros giratórias. </font><font style="vertical-align: inherit;">Das soluções de código aberto que usamos, tivemos o nginx, o módulo RTMP (por um longo tempo). </font><font style="vertical-align: inherit;">Por um lado, ele nos agradou porque trabalhou, bastante simples. </font><font style="vertical-align: inherit;">Lutamos por muito tempo para que ele trabalhasse de forma estável. </font><font style="vertical-align: inherit;">Agora ele está passando do Nginx-RTMP para sua própria solução. </font><font style="vertical-align: inherit;">Estamos pensando com um transcodificador agora. </font><font style="vertical-align: inherit;">O receptor, ou seja, a parte receptora, também foi reescrito do Nginx-RTMP para sua solução. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Eu queria fazer uma pergunta sobre fatiar o RTMP no HLS, mas pelo que entendi, você já respondeu ... Diga-me, suas soluções são de código aberto? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MR:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Estamos considerando lançá-lo em código aberto. Nós preferimos lançá-lo, mas a questão é o momento do lançamento em código aberto. Basta colocar a fonte na Internet - isso não é suficiente. Você precisa pensar, fazer alguns exemplos de implantação. E com que finalidade você está perguntando? Deseja usar? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Porque eu também me deparei com o Nginx-RTMP! É, para dizer o mínimo, que não é suportado por muito tempo. O autor nem sequer responde a perguntas particularmente ... </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MR:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Se você quiser, pode escrever para o correio. Dar para uso próprio? Nós podemos concordar. Nós realmente planejamos abri-lo. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Você também disse que pode passar do HLS para o DASH. HLS não combina? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MR:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Esta é uma pergunta sobre o que podemos, ou talvez não. Depende muito do que chegaremos em termos de pesquisa de métodos de entrega alternativos (ou seja, UDP). Se encontrarmos algo “completamente” bom, provavelmente não tocaremos no HLS. Se parece que o MPEG-DASH é mais confortável, talvez possamos mudar isso. Não parece ser muito difícil, mas não temos certeza se é necessário ou não. A sincronização entre fluxos, entre qualidades e outras coisas é claramente melhor lá. Existem vantagens. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Em relação aos alertas. Você falou sobre o fato de que, se os fluxos param de transmitir, isso é imediatamente um alerta. E você não percebeu algo independente: o provedor caiu, Megafon caiu e as pessoas pararam de transmitir? .. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MR:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Digamos que algo independente de nós é basicamente todos os tipos de feriados e assim por diante. Sim eles fizeram. Bem, eles fizeram sim. Os administradores olharam - hoje são as férias, o restante das características estão bem - eles se acalmaram. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - E sobre dimensionamento. Em que nível ele escala? Por exemplo, solicitei um fluxo do telefone - receberei imediatamente um determinado link com o servidor ash correto? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MR:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Um link será enviado imediatamente e, se necessário, será alternado (se houver problemas em um servidor específico). </font></font><br>
<br>
<img src="https://habrastorage.org/webt/xz/tn/rq/xztnrqvvbr73gu61lqgpvdt5c-e.jpeg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Quem trocará? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MR:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - player móvel ou web player. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Ele irá reiniciar o stream ou o quê? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MR:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Um novo link chegará até ele, onde ele deve ir ao vivo. Ele vai lá e pede novamente o fluxo. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Em que nível você tem caches? E playlists e pedaços, ou apenas isso? .. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MR:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - E playlists, pedaços! Ele armazena em cache de maneira um pouco diferente, tanto em termos de tempo quanto em termos de retorno do tempo, mas os armazenamos em cache. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Em relação à criação de servidores de cinzas? Você teve uma situação dessas que assiste a 2 milhões de telespectadores em uma transmissão, não tem tempo para algo e pega rapidamente algum servidor ash? Ou você eleva tudo antecipadamente com uma margem? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Senhor:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Talvez não tenha sido. Em primeiro lugar, o estoque é sempre pequeno ou grande - isso não importa. Em segundo lugar, não acontece que uma transmissão repentinamente se torne super popular. Podemos prever bem o número de espectadores. Basicamente, para termos muitas pessoas, precisamos fazer um esforço. Dessa forma, podemos ajustar o número de espectadores da transmissão, dependendo de quais esforços são feitos. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Você disse que mede atrasos instrumentais por parte do player. Quão? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MR:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Muito simples. Nos trechos (nos segmentos de mídia), temos um registro de data e hora, no nome do segmento de mídia - no player, apenas o retornamos. Se ele não é explicitamente, ele retorna. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Lembro de tentar executar o peering no WebRTC. Por que recusou? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Senhor:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Eu não posso responder a esta pergunta para você - aconteceu sem mim." Não sei dizer por que tentei e não sei por que me recusei. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Em relação ao receptor e ao servidor de mídia. Pelo que entendi, você costumava ter o Nginx-RTMP, agora, lá e ali, você tem soluções criadas por você. Na verdade, este é um servidor de mídia que proxies outros servidores de mídia, e eles já estão no cache e na borda. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MR:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Então, na verdade não. Essa é uma solução criada por você, mas é diferente em termos de servidor de mídia e de receptor. Nginx-RTMP - era algum tipo de colheitadeira que podia fazer as duas coisas. Nossos interiores do receptor e do servidor de mídia são muito diferentes - tanto por código quanto por toda parte. A única coisa que os une é o processamento RTMP. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Em relação ao equilíbrio entre as arestas. Como isso acontece?</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MR:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Medimos o tráfego, enviamos para o servidor desejado. Não entendi um pouco a pergunta ... </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Explico: o usuário solicita uma lista de reprodução através do player - ele retorna os caminhos relativos a manifestos e partes ou caminhos absolutos, por exemplo, por IP ou domínio? .. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MR:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Os caminhos são relativos. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Ou seja, não há balanceamento ao visualizar um fluxo por um usuário? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MR:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Isso acontece. Complicado o suficiente. Podemos usar o redirecionamento 301 ao sobrecarregar o servidor. Se percebermos que tudo está completamente ruim por lá, para segmentos, podemos enviá-lo para outro servidor. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Mas deve estar ligado à lógica do jogador? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Senhor:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Não, apenas esta parte não deve ser costurada. Redirecionamento 301! Simplesmente, o jogador deve conseguir sair do 301º link. Podemos enviá-lo para outro servidor do lado do servidor no momento da sobrecarga. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Ou seja, ele pergunta ao servidor, e o servidor entrega a ele? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MR:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Sim. Isso não é muito bom, portanto, a lógica do jogador é usada para retuitar links para o caso de falha de um dos servidores - isso já está na lógica do jogador. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - E você não tentou trabalhar não de forma relativa, mas de maneiras absolutas: quando você pede ao jogador que faça alguma mágica, descubra onde existem recursos e onde não existem e já fornece listas de reprodução indicando um servidor específico? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Senhor:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Na verdade, parece uma solução funcional. </font><font style="vertical-align: inherit;">Se você tivesse vindo então, teríamos pesado os dois! </font><font style="vertical-align: inherit;">Mas a solução atual também está funcionando, então não quero realmente pular de uma para outra, embora, talvez, isso também pareça uma solução funcional. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Diga-me, isso é de alguma forma amigável com o multicast? </font><font style="vertical-align: inherit;">HLS, pelo que entendi, absolutamente nada ... </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MR:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Na implementação atual, provavelmente não temos nada no sistema com o multicast ao vivo. </font><font style="vertical-align: inherit;">Não incluímos o conceito de multicast aqui. </font><font style="vertical-align: inherit;">Talvez em algum lugar nas profundezas da magia administrativa, haja algo dentro da rede, mas esteja oculto a todos e ninguém saiba ...</font></font><br>
<br>
<img src="https://habrastorage.org/webt/qr/va/s2/qrvas2mhyryhgck9t6n8ffc1pai.jpeg"><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/bA-Y_BfTZZY" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um pouco de publicidade :)</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Obrigado por ficar com a gente. Você gosta dos nossos artigos? Deseja ver materiais mais interessantes? Ajude-nos fazendo um pedido ou recomendando aos seus amigos o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VPS baseado em nuvem para desenvolvedores a partir de US $ 4,99</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , um </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">analógico exclusivo de servidores </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">básicos </font></font></a><font style="vertical-align: inherit;"><b><font style="vertical-align: inherit;">que foi inventado por nós para você: </font></b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">Toda a verdade sobre o VPS (KVM) E5-2697 v3 (6 núcleos) 10GB DDR4 480GB SSD 1Gbps de 10GB de US $ 19 ou como dividir o servidor?</font></a><font style="vertical-align: inherit;"> (as opções estão disponíveis com RAID1 e RAID10, até 24 núcleos e até 40GB DDR4). </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dell R730xd 2 vezes mais barato no data center Equinix Tier IV em Amsterdã?</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Somente nós temos </font></font><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 TVs Intel TetraDeca-Core Xeon 2x E5-2697v3 2.6GHz 14C 64GB DDR4 4x960GB SSD 1Gbps 100 TV a partir de US $ 199</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> na Holanda!</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dell R420 - 2x E5-2430 2.2Ghz 6C 128GB DDR3 2x960GB SSD 1Gbps 100TB - a partir de US $ 99! </font></font></b></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Leia sobre</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> como construir infraestrutura </font><font style="vertical-align: inherit;">classe c usando servidores Dell R730xd E5-2650 v4 que custam 9.000 euros por um centavo?</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt488136/index.html">Como o robô Atlas aprendeu a fazer acrobacias, insuportáveis ​​para uma pessoa comum?</a></li>
<li><a href="../pt488138/index.html">Medições de capacitância pequena (sensor capacitivo analógico)</a></li>
<li><a href="../pt488140/index.html">Como simplificar a vida com a ajuda da lei de Pareto</a></li>
<li><a href="../pt488142/index.html">Avalonia pensativa</a></li>
<li><a href="../pt488146/index.html">[Discussão]: São engenheiros de TI, são engenheiros de TI?</a></li>
<li><a href="../pt488150/index.html">Antiguidades: ThinkPad X200 e código fechado</a></li>
<li><a href="../pt488152/index.html">Um protótipo de jogo multiplayer para as 15h?</a></li>
<li><a href="../pt488154/index.html">Entramos no lugar do gerente do escritório. Algoritmos básicos de suprimento</a></li>
<li><a href="../pt488160/index.html">Windows Server 2019 vs. Instantâneos VMware com desativação: uma solução elegante para o problema</a></li>
<li><a href="../pt488162/index.html">Quanto maior a classificação, mais dinheiro e vice-versa</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>