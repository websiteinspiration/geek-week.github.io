<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ô†Ô∏è üó≥Ô∏è ü§≥üèø Imitation of freehand drawing on the example of RoughJS üï∂Ô∏è üíΩ üåó</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="RoughJS is a small (< 9KB ) JavaScript graphics library that allows you to draw in sketchy, handwritten style. It allows you to draw on <canvas>and wi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Imitation of freehand drawing on the example of RoughJS</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/500018/"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RoughJS</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> is a small (&lt; </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">9KB</font></a><font style="vertical-align: inherit;"> ) JavaScript graphics library that allows you to draw in </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sketchy, handwritten</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> style. </font><font style="vertical-align: inherit;">It allows you to draw on </font></font><code>&lt;canvas&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and with </font></font><code>SVG</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">In this post I want to answer the most popular question about RoughJS: </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">how does it work?</font></font></strong><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/06b/dcb/dee/06bdcbdee1eec1748f07434abb002f34.png"></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A bit of history</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fascinated by the images of hand-drawn graphs, diagrams and sketches, I, like a true nerd, asked myself: can I create such drawings with the help of a code, can I imitate the drawing as accurately as possible by hand, while still preserving the possibility of software implementation? I decided to focus on the primitives ‚Äî lines, polygons, ellipses, and curves ‚Äî to create an entire library of 2D graphics. Based on it, you can create libraries and graphs for drawing graphs and diagrams. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After briefly examining the issue, I found an article by </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Joe Wood</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and his colleagues called </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sketchy rendering for information visualization</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . The techniques described in it became the basis of the library, especially in drawing lines and ellipses.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In 2017, I wrote the first version of the library, which only worked on Canvas. </font><font style="vertical-align: inherit;">Having solved the problem, I lost interest in it. </font><font style="vertical-align: inherit;">A year later, I worked a lot with SVG, and decided to adapt RoughJS to work with SVG. </font><font style="vertical-align: inherit;">I also changed the structure of the API to make it simpler, and focused on simple vector graphics primitives. </font><font style="vertical-align: inherit;">I talked about version 2.0 on Hacker News and suddenly it gained immense popularity. </font><font style="vertical-align: inherit;">In 2018, it was </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ShowHN's second most popular post</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Since then, other people have created more amazing things based on RoughJS, for example, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Excalidraw</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Why do Cats &amp; Dogs ...</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the roughViz graphics library</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now let's talk about algorithms ...</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unevenness</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The fundamental basis for imitation of handwritten figures is chance. </font><font style="vertical-align: inherit;">When we draw by hand, any two shapes will be somewhat different. </font><font style="vertical-align: inherit;">No one draws perfectly precisely, so every spatial point in RoughJS is adjusted for random displacement. </font><font style="vertical-align: inherit;">The magnitude of randomness is given by a numerical parameter </font></font><code>roughness</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/35d/b72/e5e/35db72e5e11caf5a6cb19e194b0a5972.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Imagine a point </font></font><code>A</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and a circle around it. </font><font style="vertical-align: inherit;">Now replace with a </font></font><code>A</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">random point within this circle. </font><font style="vertical-align: inherit;">The area of ‚Äã‚Äãthis circle of randomness is controlled by value </font></font><code>roughness</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lines</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Handwritten lines are never straight and often show curvature in the </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bend</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (described </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">We randomize the two endpoints of the line based on roughness. </font><font style="vertical-align: inherit;">Then we select two more random points approximately at a distance of 50% and 75% from the end of the segment. </font><font style="vertical-align: inherit;">By connecting these points of the curve, we get the effect of </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bending</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/633/f29/8fe/633f298feb4231e8c9d652cb2811b4ff.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When drawing by hand, people sometimes move the pencil forward and backward along the line. </font><font style="vertical-align: inherit;">This is necessary either to make the line brighter, or simply to correct the straightness of the line. </font><font style="vertical-align: inherit;">It looks something like this:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/377/2fd/665/3772fd6659c97c0dea4144645d63fdf7.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To add a sketchy effect, RoughJS draws a line twice. </font><font style="vertical-align: inherit;">In the future I plan to make this aspect more customizable. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Look at this canvas surface. </font><font style="vertical-align: inherit;">The roughness parameter changes the appearance of the lines:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/vw/vy/fp/vwvyfpdytbbalxolkj9eufdctri.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the original article on canvas, you can draw yourself. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When drawing by hand, long lines usually become less straight and more curved. </font><font style="vertical-align: inherit;">That is, the randomness of offsets to create an effect </font></font><code></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">is a function of line length and value </font></font><code>randomness</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">However, scaling this function is not suitable for very long lines. </font><font style="vertical-align: inherit;">For example, in the image below, concentric squares are drawn with the same random seed, i.e. </font><font style="vertical-align: inherit;">in fact, they are one random figure, but with a different scale.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c6f/943/aaf/c6f943aaf7f5fd94336286e902a7ed5b.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You may notice that the edges of the outer squares look a little more uneven than the inner ones. </font><font style="vertical-align: inherit;">Therefore, I also added a damping factor depending on the line length. </font><font style="vertical-align: inherit;">The attenuation coefficient is used as a step function at various lengths.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f0f/f30/162/f0ff30162ccf5f76efab1543ed36b79a.jpg"></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ellipses (and circles)</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Take a sheet of paper and draw a few circles as quickly as possible in one continuous motion. </font><font style="vertical-align: inherit;">Here's what I got:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/268/911/691/2689116919287022e800ab72c7e3877f.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Note that the start and end points of the loop do not always match. </font><font style="vertical-align: inherit;">RoughJS tries to imitate this, while making the appearance more complete (the technique is adapted from the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">giCenter article</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The algorithm finds the </font></font><code>n</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ellipse points where it </font></font><code>n</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">is determined by the size of the ellipse. </font><font style="vertical-align: inherit;">Then each point is randomized by its value </font></font><code>roughness</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Then a curve is drawn through these points. </font><font style="vertical-align: inherit;">To get the effect of the </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">disconnected ends, the</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> points from the second to the last do not coincide with the first point. </font><font style="vertical-align: inherit;">Instead, the curve connects the second and third points.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4d8/a4f/238/4d8a4f238460b44b847da72c22cbf3d1.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A second ellipse is also drawn so that the loop is more closed and has an additional sketch effect. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the original article, you can draw ellipses on an interactive canvas surface. </font><font style="vertical-align: inherit;">Vary roughness and watch how the form changes:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/kq/5g/9o/kq5g9ouwifltwn-qfp2tednoaqq.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the case of line drawing, some of these artifacts become more accentuated if some shape is scaled to different sizes. </font><font style="vertical-align: inherit;">In an ellipse, this effect is more noticeable because the ratio is quadratic. </font><font style="vertical-align: inherit;">In the image below, all circles have the same shape, but the outer ones look more uneven.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d1c/bc1/682/d1cbc168206970ade73e1b7a77639d7d.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The algorithm automatically adjusts based on the size of the shape, increasing the number of points in the circle ( </font></font><code>n</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font><font style="vertical-align: inherit;">Below is the same set of circles generated using automatic tuning.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/aa4/6f0/612/aa46f0612d82b8944e70fb888db8ac39.jpg"></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Filling out</font></font></h2><br><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dotted</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> lines </font><font style="vertical-align: inherit;">
are usually used to fill in hand-drawn shapes </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">In the case of freehand sketches, the lines do not always remain within the outline of the shapes. </font><font style="vertical-align: inherit;">They are also randomized. </font><font style="vertical-align: inherit;">Density, angle, line width can be adjusted.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1e4/d62/0dc/1e4d620dc5d4e0c7167c7f64595537c6.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The squares shown above are easy to fill, but in the case of other shapes, all kinds of problems can occur. </font><font style="vertical-align: inherit;">For example, concave polygons (in which angles can exceed 180 ¬∞) often cause such problems:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/20b/9cd/46f/20b9cd46fba00903739307fba87386f0.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In fact, the image above is taken from an error report in one of the previous versions of RoughJS. Since then, I have updated the stroke filling algorithm by adapting the version of </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the string scanning method</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The string scanning algorithm</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> can be used to fill any polygon. Its principle is to scan a polygon using horizontal lines (raster lines). Raster lines go from the top of the polygon down. For each raster line, we determine at what points the line intersects with the polygon. We build these intersection points from left to right.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8d9/6df/028/8d96df0287ebd8320120e61813fc30f6.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Moving from point to point, we switch from filling mode to non-filling mode; </font><font style="vertical-align: inherit;">switching between states occurs when each intersection point on the raster line meets. </font><font style="vertical-align: inherit;">Here much more needs to be taken into account, in particular, borderline cases and scanning optimization methods; </font><font style="vertical-align: inherit;">You can read more about this here: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rasterizing polygons</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , or deploy a spoiler with pseudo-code.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Details of the implementation of the string scanning algorithm</font></font></b>
                        <div class="spoiler_text">     ()      .<br>
<br>
 ‚Äî     (Edge Table, ET),   ,    <code>Y<sub>min</sub></code>.      <code>Y<sub>min</sub></code>,        <code>X<sub>min</sub></code>.<br>
<br>
 ‚Äî     (Active Edge Table, AET),       ,     .<br>
<br>
        :<br>
<br>
<pre><code class="javascript hljs">interface EdgeTableEntry {
  <span class="hljs-attr">ymin</span>: number;<font></font>
  ymax: number;<font></font>
  x: number; <span class="hljs-comment">// Initialized to Xmin</span>
  iSlope: number; <span class="hljs-comment">// Inverse of the slope of the line: 1/m</span><font></font>
}<font></font>
<font></font>
interface ActiveEdgeTableEntry {<font></font>
  <span class="hljs-attr">scanlineY</span>: number; <span class="hljs-comment">// The y value of the scanline</span><font></font>
  edge: EdgeTableEntry;<font></font>
}</code></pre><br>
   ,    :<br>
<br>
<strong>1.</strong>  <em>y</em>   <em>y</em>  ET.      .<br>
<br>
<strong>2.</strong>  AET   .<br>
<br>
<strong>3.</strong>   ,   AET,  ET  :<br>
<br>
<strong>(a)</strong>    ET <em>y</em>  AET ,   <em>y<sub>min</sub> ‚â§ y</em>.<br>
<br>
<strong>(b)</strong>   AET ,   <em>y = y<sub>max</sub></em>,    AET  <em>x</em>.<br>
<br>
<strong>()</strong>      <em>y</em>,    <em>x</em>  AET.<br>
<br>
<strong>(d)</strong>   <em>y</em>   ,   , ..    .<br>
<br>
<strong>(e)</strong>    ,   AET,  <em>x</em>   <em>y</em> (<code>edge.x = edge.x + edge.iSlope</code>)</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the image below (in the original article interactive), each square denotes a pixel. </font><font style="vertical-align: inherit;">You can move the vertices to change the polygon and observe which pixels will be filled traditionally.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/2p/o7/wg/2po7wg8kdj0ixdeogj9_b2hax78.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When filling in strokes, the increment of raster lines is performed in increments depending on the given density of lines of strokes, and each line is drawn using the algorithm described above. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
However, this algorithm is for horizontal raster lines. </font><font style="vertical-align: inherit;">To implement different angles of strokes, the algorithm first rotates the shape itself by the desired angle of strokes. </font><font style="vertical-align: inherit;">Then the raster lines for the rotated figure are calculated. </font><font style="vertical-align: inherit;">Further, the calculated lines rotate back to the angle of the strokes in the opposite direction.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e9b/1ad/324/e9b1ad3244af05b53b02203659e7f6f7.jpg"></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Not just filling out strokes</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
RoughJS also supports other fill styles, but they are all derived from the same hatching algorithm. </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cross hatching</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> consists in drawing dashed lines at an angle </font></font><code>angle</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, and then another lines at an angle </font></font><code>angle + 90¬∞</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zigzag</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> seeks to connect one dashed line with the previous one. </font><font style="vertical-align: inherit;">To obtain a </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dot</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pattern, draw small circles along the dashed lines.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/06b/dcb/dee/06bdcbdee1eec1748f07434abb002f34.png"></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The curves</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Everything in RoughJS is normalized to curves - lines, polygons, ellipses, etc. </font><font style="vertical-align: inherit;">Therefore, the natural development of this idea is to create a sketch curve. </font><font style="vertical-align: inherit;">In RoughJS, we pass a set of points to a curve, after which we use the curve </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">approximation to</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> convert them to cubic Bezier </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">curves</font></a><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Each Bezier curve has two end points and two control points. </font><font style="vertical-align: inherit;">By randomizing them on the basis </font></font><code>roughness</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, you can similarly create ‚Äúhandwritten‚Äù curves.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ba3/0bd/82c/ba30bd82c30edfc43f6845670f97f4b0.png"></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Curve Filling</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
However, the inverse process is required to fill the curves. Instead of normalizing everything to a curve, the curve normalizes to a polygon. After obtaining the polygon, you can use the line scanning algorithm to fill the curved shape. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You can sample points on the curve with the desired frequency using the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">equation of the cubic Bezier curve</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a85/bcc/2d5/a85bcc2d5b946e8e88df52f2080b5303.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If we use the sampling frequency, which depends on the density of the strokes, then we get enough points to fill the figure. But this is not particularly effective. If part of the curve is sharp, then we need more points. If part of the curve is almost straight, then fewer points are needed. One solution may be to determine the </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">curvature / smoothness of the</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> curve. If it is very curved, then we divide the curve into two smaller curves. If it is smooth, then we will consider it simply as a straight line. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The smoothness of the curve is calculated using the method described in </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">this post</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . The smoothness value is compared with the tolerance value, after which a decision is made whether to split the curve or not. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Here is the same curve with a tolerance level of 0.7:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/995/55d/9be/99555d9be7e6cc2223db46f6cbd98da8.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Based on the tolerance alone, the algorithm provides enough points to represent the curve. </font><font style="vertical-align: inherit;">However, it does not allow you to effectively get rid of optional points. </font><font style="vertical-align: inherit;">This will help the second parameter called </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">distance</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">To reduce the number of points in this method, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the Ramer-Douglas-Pecker algorithm is used</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The following shows the points generated with values of distance, equal to </font></font><code>0.15</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>0.75</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>1.5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font><code>3.0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4c9/e93/6e1/4c9e936e15771d9d02d1768a2e14b70b.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Based on the </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">roughness of the</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> shape, you can set the appropriate </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">distance</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> value </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Having received all the vertices of the polygon, we can beautifully fill the curved shapes:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/45b/eb7/161/45beb716138e9836c8e841f63d15f28a.png"></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SVG circuits</font></font></h2><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SVG contours</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> are a very powerful tool that can be used to create all kinds of stunning images, but because of this, it is quite difficult to work with them. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
RoughJS parses the path and normalizes it in just three operations: </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Move</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Line</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cubic Curve</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">path-data-parser</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). After normalization, the figure can be drawn using the above methods of drawing lines and curves. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">points-on-path</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> package </font><font style="vertical-align: inherit;">combines the normalization of paths and the sampling of curve points to calculate the corresponding </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">path</font></a><font style="vertical-align: inherit;"> points. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The following is an example point calculation for a path </font></font><code>M240,100c50,0,0,125,50,100s0,-125,50,-150s175,50,50,100s-175,50,-300,0s0,-125,50,-100s0,125,50,150s0,-100,50,-100</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/585/374/dd6/585374dd67d5210ff7628540a6b5edaa.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Another SVG example that I love to show is the </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">outline</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> map of the United States:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ff7/68b/675/ff768b675300dc4604b87dc2e81478c7.png"></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Try RoughJS</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Check out </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the website</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> or </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">repository on Github</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> or the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API documentation</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Follow</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Twitter </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">@RoughLib</font></a><font style="vertical-align: inherit;"> for project </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">information</font></a><font style="vertical-align: inherit;"> .</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en500008/index.html">Meet upscalers</a></li>
<li><a href="../en500010/index.html">History of dirty hydrogen</a></li>
<li><a href="../en500012/index.html">Entity Framework Core</a></li>
<li><a href="../en500014/index.html">Fully responsive design is more than just media queries</a></li>
<li><a href="../en500016/index.html">Practical work with FPGAs in the set of Redd. Mastering DMA for the Avalon-ST bus and switching between Avalon-MM buses</a></li>
<li><a href="../en500020/index.html">Google Earth Engine - Unique Big Geodata Analysis Platform</a></li>
<li><a href="../en500022/index.html">Why participate in community life and how does it help professional growth?</a></li>
<li><a href="../en500026/index.html">Nonsense in this industry * just unbelievable</a></li>
<li><a href="../en500028/index.html">Data Management Platforms: Peripheral to Cloud</a></li>
<li><a href="../en500030/index.html">Who is good in a crisis: examples of IT companies whose stocks rise during a pandemic</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>