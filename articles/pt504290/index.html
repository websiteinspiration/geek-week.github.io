<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>📁 🧑🏿‍🤝‍🧑🏿 💃🏼 Teste de carga como um serviço de IC para desenvolvedores 👇🏿 ✊🏿 😌</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Um dos problemas que os fornecedores de software de vários produtos costumam encontrar é a duplicação de competências de engenheiros - desenvolvedores...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Teste de carga como um serviço de IC para desenvolvedores</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pt/blog/504290/"><img src="https://habrastorage.org/webt/r5/fa/5g/r5fa5gszksri1ly608-wffhunqu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um dos problemas que os fornecedores de software de vários produtos costumam encontrar é a duplicação de competências de engenheiros - desenvolvedores, testadores e administradores de infraestrutura - em quase todas as equipes. Isso também se aplica a engenheiros caros - especialistas na área de testes de carga. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em vez de se envolver em suas responsabilidades diretas e usar sua experiência única para criar o processo de teste de carga, escolhendo uma metodologia, métricas ideais e autoteste de gravação de acordo com perfis de carga, os engenheiros geralmente precisam implantar a infraestrutura de teste do zero, configurar ferramentas de carga e incorporá-las nos sistemas de CI, configure o monitoramento e a publicação de relatórios.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Você pode encontrar soluções para alguns problemas organizacionais nos testes que usamos na Positive Technologies em </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">outro artigo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">E aqui falarei sobre a possibilidade de integrar testes de carga em um pipeline de IC comum usando o conceito de "teste de carga como serviço". </font><font style="vertical-align: inherit;">Você aprenderá como e quais imagens da janela de encaixe das fontes de carregamento podem ser usadas no pipeline do IC; </font><font style="vertical-align: inherit;">Como conectar fontes de carregamento ao seu projeto de IC usando um modelo de montagem; </font><font style="vertical-align: inherit;">como é um pipe de demonstração para executar testes de carga e publicar resultados. </font><font style="vertical-align: inherit;">Este artigo pode ser útil para engenheiros de teste de software e engenheiros de automação da CI, que pensaram na arquitetura de seu sistema de carga.</font></font><a name="habracut"></a><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Essência do conceito</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O conceito de teste de carga como serviço implica a capacidade de integrar as ferramentas de carregamento Apache JMeter, Yandex.Tank e estruturas próprias em um sistema arbitrário de integração contínua. Uma demonstração será para o GitLab CI, mas os princípios são declarados comuns a todos os sistemas de CI. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O teste de carga como serviço é um serviço centralizado para a realização de testes de carga. Os testes de carga são executados em conjuntos de agentes dedicados, os resultados são publicados automaticamente no GitLab Pages, Influx DB e Grafana ou em sistemas de relatório de teste (TestRail, ReportPortal, etc.). A automação e o dimensionamento são realizados da maneira mais simples possível - adicionando e parametrizando o modelo gitlab-ci.yml usual no projeto GitLab CI.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A vantagem da abordagem é que toda a infraestrutura de CI, agentes de carga, imagens de encaixe de fontes de carga, pipelines de teste e publicação de relatórios são suportadas pelo departamento central de automação (engenheiros do DevOps) e os engenheiros de teste de carga podem concentrar seus esforços no desenvolvimento de testes e análise de seus resultados, sem lidar com questões de infraestrutura. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para simplificar a descrição, supomos que o aplicativo ou servidor de teste de destino já esteja implantado e configurado com antecedência (para isso, scripts automatizados em Python, SaltStack, Ansible etc. podem ser usados). Então, todo o conceito de teste de estresse como serviço se encaixa em três estágios: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">preparação, teste, publicação de relatórios</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Mais detalhes no diagrama (todas as imagens são clicáveis):</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/uc/no/nj/ucnonjamcikvuob-3njskwev-he.png"></a><br>
<br>
<h2>      </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ao realizar testes de estresse, tentamos aderir aos </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">padrões e metodologia do ISTQB</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , usamos a terminologia apropriada e as métricas recomendadas. Vou dar uma pequena lista de conceitos e definições básicas no teste de carga. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O agente de carregamento (agente de carregamento)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - a máquina virtual na qual o aplicativo será iniciado - a origem do carregamento (Apache JMeter, Yandex.Tank ou módulo de carregamento auto-gravado). </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O objetivo do teste (destino)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> é um servidor ou aplicativo instalado no servidor que será submetido ao carregamento. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um caso de teste</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> é um conjunto de etapas parametrizadas: ações do usuário e reações esperadas a essas ações, com solicitações e respostas de rede fixas, dependendo dos parâmetros especificados.</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Perfil ou plano de carga (perfil)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - na </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">metodologia ISTQB</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (Seção 4.2.4, p. 43), os perfis de carga determinam as métricas críticas para um teste específico e as opções para alterar os parâmetros de carga durante o teste. Você pode ver exemplos de perfis na figura. </font><b><font style="vertical-align: inherit;">Teste</font></b><font style="vertical-align: inherit;"> é um script com um conjunto predefinido de parâmetros. </font><b><font style="vertical-align: inherit;">Plano de</font></b><font style="vertical-align: inherit;"> teste - suíte de testes e perfil de carga. </font><b><font style="vertical-align: inherit;">Testrun (testrun)</font></b><font style="vertical-align: inherit;"> - uma iteração da execução de um teste com um cenário de carga totalmente executado e um relatório recebido. </font><b><font style="vertical-align: inherit;">Solicitação de rede (solicitação)</font></b><font style="vertical-align: inherit;"> - uma solicitação HTTP enviada do agente para o destino. </font><b><font style="vertical-align: inherit;">Resposta da rede (resposta)</font></b><font style="vertical-align: inherit;"> - uma resposta HTTP enviada do destino para o agente.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/qm/iq/d5/qmiqd5egscabj6hrmlnufxnyv4m.png"></a><br>
<br>
<b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O status da resposta HTTP é um código de resposta padrão do servidor de aplicativos. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Transação (transação) - um ciclo completo de "solicitação - resposta". </font><font style="vertical-align: inherit;">Uma transação é contada desde o início do envio de uma solicitação (solicitação) até a conclusão do recebimento de uma resposta (resposta). </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Status da transação (status das transações)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - se o ciclo "solicitação - resposta" foi concluído com êxito. </font><font style="vertical-align: inherit;">Se houver algum erro nesse loop, a transação inteira será considerada malsucedida. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tempo de resposta (latência)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - tempo desde o final do envio de uma solicitação (solicitação) até o início do recebimento de uma resposta (resposta). </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Métricas de carregamento (métricas)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - as características do serviço carregado e do agente de carregamento definidas durante o processo de teste de carga.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Métricas básicas para medir parâmetros de carga</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Algumas das </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">métricas</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mais comuns e recomendadas na metodologia </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">ISTQB</font></a><font style="vertical-align: inherit;"> (p. 36, 52) são mostradas na tabela abaixo. </font><font style="vertical-align: inherit;">Métricas semelhantes para o agente e o destino são mostradas na mesma linha.</font></font><br>
<br>
<div class="scrollable-table"><table>
<thead>
<tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Métricas do agente de carregamento</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Métricas do sistema ou aplicativo de destino testado sob carga</font></font></th>
</tr>
</thead>
<tbody>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O número de&nbsp;&nbsp; </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vCPU</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e memória </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RAM</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">disco</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - características "de ferro" do agente de carregamento</font></font></td>
<td><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CPU</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">memória, uso de disco</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - a dinâmica de carregamento do processador, memória e disco </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
durante o teste. </font><font style="vertical-align: inherit;">Geralmente medido como uma porcentagem dos </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
valores máximos disponíveis.</font></font></td>
</tr>
<tr>
<td><b>Network throughput</b> (on load agent) —   <br>
   , <br>
   . <br>
      (bps)</td>
<td><b>Network throughput</b>(on target) —     <br>
  .       (bps)</td>
</tr>
<tr>
<td><b>Virtual users</b>—   , <br>
    <br>
   </td>
<td><b>Virtual users status</b>, Passed/Failed/Total —    <br>
     <br>
  ,     .<br>
<br>
 ,      <br>
  ,    . <br>
   ,       <br>
      </td>
</tr>
<tr>
<td><b>Requests per second (minute)</b>—      ( ).<br>
<br>
   :     . <br>
       </td>
<td><b>Responses per second (minute)</b><br>
 —      ( ).<br>
<br>
   :   <br>
       <br>
 </td>
</tr>
<tr>
<td></td>
<td><b>HTTP responses status</b>—     <br>
  ,   . <br>
, 200 OK   , <br>
 404 —    </td>
</tr>
<tr>
<td></td>
<td><b>Latency</b> ( ) —    <br>
  (request)     (response). <br>
    (ms)</td>
</tr>
<tr>
<td></td>
<td><b>Transaction response time</b>—    , <br>
  « — ». <br>
      (request) <br>
    (response).<br>
<br>
      ( ) <br>
 :  , <br>
,  , , 90- . <br>
    —   <br>
  . <br>
    , <br>
    , <br>
     </td>
</tr>
<tr>
<td></td>
<td><b>Transactions per second (minute)</b> —   <br>
   (), <br>
       <br>
    . <br>
    </td>
</tr>
<tr>
<td></td>
<td><b>Transactions status</b> , Passed / Failed / Total —  <br>
,     .<br>
<br>
    <br>
    <br>
     </td>
</tr>
</tbody>
</table></div><br>
<h2>   </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O esquema básico de teste de carga é muito simples e consiste em três estágios principais, que eu já mencionei: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Preparar - Teste - Relatório</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , ou seja, preparar metas de teste e definir parâmetros para fontes de carga, depois executar testes de carga e, finalmente, gerar e publicar um relatório sobre o teste. </font><font style="vertical-align: inherit;">
Notas para o regime:</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/o5/s5/z5/o5s5z5f79dpui3ojk5vbwgsayso.png"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">QA.Tester - especialista em testes de estresse,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Target é o aplicativo de destino para o qual você precisa conhecer seu comportamento sob carga.</font></font></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Classificador de entidades, estágios e etapas no diagrama</font></font></h2><br>
<div class="scrollable-table"><table>
<thead>
<tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Etapas e etapas</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O que está acontecendo</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O que há na entrada</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Qual é a saída</font></font></th>
</tr>
</thead>
<tbody>
<tr>
<td colspan="4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Preparar: fase de preparação do teste</font></font></td>
</tr>
<tr>
<td><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parâmetros de carga</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Definindo e inicializando </font><font style="vertical-align: inherit;">
parâmetros de carregamento do </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
usuário </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
selecionando métricas e </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
preparando um plano de teste </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(perfil de carregamento)</font></font></td>
<td>  <br>
  <br>
-<br>
 </td>
<td></td>
</tr>
<tr>
<td><b>VM</b></td>
<td>   <br>
   <br>
 </td>
<td>    <br>
   <br>
 </td>
<td>  <br>
 </td>
</tr>
<tr>
<td><b>Env</b></td>
<td>    <br>
  <br>
  </td>
<td>   <br>
 <br>
   <br>
 </td>
<td> : <br>
,   , <br>
   <br>
 </td>
</tr>
<tr>
<td><b>LoadAgents</b></td>
<td>,    <br>
 . <br>
  -  <br>
  </td>
<td>-   <br>
(, JM   )<br>
  <br>
 </td>
<td>   <br>
   <br>
</td>
</tr>
<tr>
<td colspan="4">Test:    .    ,       GitLab CI</td>
</tr>
<tr>
<td><b>Load</b></td>
<td>   <br>
  -<br>
   </td>
<td>  <br>
  <br>
 <br>
-<br>
 </td>
<td>  <br>
 <br>
 <br>
      </td>
</tr>
<tr>
<td><b>RunAgents</b></td>
<td>  <br>
   <br>
  <br>
  <br>
   <br>
  </td>
<td>-<br>
 </td>
<td></td>
</tr>
<tr>
<td><b>Logs</b></td>
<td> «»  <br>
   : <br>
    , <br>
   <br>
 ,    </td>
<td></td>
<td>  <br>
 <br>
 </td>
</tr>
<tr>
<td><b>Metrics</b></td>
<td> «»    </td>
<td></td>
<td>    <br>
  </td>
</tr>
<tr>
<td colspan="4">Report:     </td>
</tr>
<tr>
<td><b>Generator</b></td>
<td>  <br>
   <br>
  «» <br>
  <br>
   <br>
 , <br>
   <br>
</td>
<td>  <br>
 <br>
 <br>
   <br>
   </td>
<td> «»  <br>
 ,   <br>
   <br>
   ,<br>
   </td>
</tr>
<tr>
<td><b>Publish</b></td>
<td>  <br>
  <br>
   <br>
</td>
<td> «» <br>
  ,  <br>
    <br>
</td>
<td>   <br>
   <br>
,  <br>
  </td>
</tr>
</tbody>
</table></div><br>
<h2>    CI-</h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos para a parte prática. Quero mostrar como, em alguns projetos da </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Positive Technologies</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , implementamos o conceito de teste de estresse como serviço. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Primeiro, com a ajuda de nossos engenheiros de DevOps, criamos um pool de agentes dedicado no GitLab CI para executar testes de carga. Para não confundi-los em modelos com outros, como conjuntos de montagens, adicionamos tags a esses agentes, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tags</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : load. Você pode usar outras tags claras. Eles são definidos </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">durante o registro dos</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> GitLab CI Runners.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como descobrir a energia necessária por hardware? As características dos agentes de carregamento - uma quantidade suficiente de vCPU, RAM e disco - podem ser calculadas com base em que Docker, Python (para Yandex.Tank), agente de GitLab CI, Java (para Apache JMeter) devem estar em execução no agente. Para Java no JMeter, também é recomendável usar no mínimo 512 MB de RAM e, como limite superior, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">80% da memória disponível</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Portanto, com base em nossa experiência, recomendamos o uso de pelo menos 4 vCPU, 4 GB de RAM, 60 GB SSD para agentes de carregamento. A largura de banda da placa de rede é determinada com base nos requisitos do perfil de carga. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Usamos principalmente duas fontes de carregamento - imagens do docker Apache JMeter e Yandex.Tank. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Yandex.Tank</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Esta é a ferramenta de código aberto do Yandex para testes de estresse. Sua arquitetura modular é baseada no gerador de solicitações HTTP assíncronas de alto desempenho Phantom. O tanque possui monitoramento interno dos recursos do servidor testado usando o protocolo SSH, pode interromper o teste automaticamente de acordo com as condições especificadas, pode exibir os resultados no console e na forma de gráficos, você pode conectar seus módulos a ele para expandir a funcionalidade. A propósito, usamos o Tank quando ele ainda não era popular. No artigo “ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Yandex.Tank e automação de testes de carga</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”, você pode ler a história de como, em 2013, a usamos para </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">realizar</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> testes de carga do </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">PT Appllication Firewall</font></a><font style="vertical-align: inherit;"> - um dos produtos de nossa empresa. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apache JMeter</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">É uma ferramenta de código aberto para realizar testes de estresse do Apache. Ele pode ser usado igualmente bem para testar aplicativos da Web estáticos e dinâmicos. O JMeter suporta um grande número de protocolos e maneiras de interagir com aplicativos: HTTP, HTTPS (Java, NodeJS, PHP, ASP.NET etc.), serviços da Web SOAP / REST, FTP, TCP, LDAP, SMTP (S), POP3 (S ) e IMAP (S), bancos de dados por meio do JDBC, podem executar comandos do shell e trabalhar com objetos Java. O JMeter possui um IDE para criar, depurar e executar planos de teste. Há também uma CLI para trabalhar na linha de comando de qualquer Java OS compatível (Linux, Windows, Mac OS X). A ferramenta pode gerar dinamicamente um relatório de teste HTML.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para facilitar o uso em nossa empresa, para a capacidade dos testadores de alterar e adicionar o ambiente, criamos imagens de docker de fontes de carga no GitLab CI com publicação no </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">docker-register</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> interno </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">no Artifactory</font></a><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Dessa forma, fica mais rápido e fácil conectá-los em tubulações para testes de carga. </font><font style="vertical-align: inherit;">Como fazer o docker enviar o registro via GitLab CI - consulte as </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">instruções</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O arquivo docker básico para o Yandex.Tank foi o que fizemos:</font></font><br>
<br>
<pre><code class="bash hljs">Dockerfile <font></font>
1 | FROM direvius/yandex-tank<font></font>
2 | ENTRYPOINT [<span class="hljs-string">""</span>]</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E para o Apache JMeter, este:</font></font><br>
<br>
<pre><code class="bash hljs">Dockerfile <font></font>
1 | FROM vmarrazzo/jmeter<font></font>
2 | ENTRYPOINT [<span class="hljs-string">""</span>]</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Você pode ler como nosso sistema de integração contínua funciona no artigo “ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Automação de processos de desenvolvimento: como implementamos as idéias de DevOps em tecnologias positivas</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Modelo e pipeline</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um modelo de exemplo para a realização de testes de carga está disponível no projeto </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">demo-load</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Você </font><font style="vertical-align: inherit;">pode ler as instruções para usar o modelo </font><font style="vertical-align: inherit;">no </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">arquivo leia</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">me</font></a><font style="vertical-align: inherit;"> . No próprio modelo (o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">arquivo .gitlab-ci.yml</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), há observações sobre o que é responsável por esta ou aquela etapa. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O modelo é muito simples e demonstra os três estágios do teste de carga descritos acima no diagrama: preparação, teste e publicação de relatórios. Responsável pelo </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">diretório de estágios</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o Preparar, o Teste e o Relatório</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<ol>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Prepare</a>           .       ,     -    docker registry:       Test.         .</li>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Test</a>     ,      .     : Yandex.Tank, Apache JMeter,    .         job-.     :<br>
 <ul>
<li>  Yandex.Tank    .<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">/tests/yandextank.sh</a>,</li>
<li>  Apache JMeter    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">./tests/jmeter.sh</a>.</li>
</ul><br>
:         CI-        .     ,    bash-.   ,       —    QA-.               .        <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">./tests</a>.<br>
 </li>
<li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Report</a>      ,    Test,   ,   GitLab Pages    .  GitLab Pages ,      ./public        index.html.     GitLab Pages    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> </a>.<br>
<br>
,   : <ul>
<li> JMeter  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">GitLab Pages</a>,</li>
<li> Yandex.Tank  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">InfluxDB  Grafana</a>.</li>
</ul><br>
   :<ul>
<li>HTML-  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">GitLab Pages</a>,</li>
<li> InfluxDB    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Grafana</a>.</li>
</ul></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em um exemplo de demonstração, um pipeline com testes de carga e duas fontes de carga (você pode desativar desnecessariamente) é semelhante a: O </font><font style="vertical-align: inherit;">
Apache JMeter pode gerar um relatório em HTML, por isso é mais rentável salvá-lo nas páginas do GitLab usando ferramentas regulares. </font><font style="vertical-align: inherit;">É assim que o relatório do Apache JMeter se parece: </font><font style="vertical-align: inherit;">
Na demonstração do Yandex.Tank, você verá apenas um </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">relatório de texto falso</font></a><font style="vertical-align: inherit;"> na seção Páginas do GitLab. </font><font style="vertical-align: inherit;">Durante o teste, o Tank pode salvar os resultados no banco de dados do InfluxDB e, a partir daí, eles podem ser exibidos no Grafana (a configuração é realizada no arquivo </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">./tests/example-yandextank-test.yml</font></a><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">É assim que o relatório de Tank se parece no Grafana:</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/t6/0f/bx/t60fbxhrvwnju5mubzwmifhjmn0.png"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/fr/pl/pr/frplprdv1ns3obkqrpn2i4tgetu.png"></a><br>
<br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/a6/y9/zw/a6y9zw9ej6wcy_g5pk69s1ncrpa.png"></a><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sumário</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No artigo, falei sobre o conceito de "teste de carga como serviço" (teste de carga como serviço). A idéia principal é usar a infraestrutura de pools pré-configurados de agentes de carregamento, imagens de encaixe de fontes de carregamento, sistemas de relatórios e um pipeline que os une no GitLab CI com base em um modelo simples .gitlab-ci.yml (exemplo </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">por referência</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). Tudo isso é suportado por uma pequena equipe de engenheiros de automação e é replicado a pedido das equipes de produto. Espero que isso ajude você a preparar e implementar um esquema semelhante em sua empresa. Obrigado pela atenção! </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS: Gostaria de agradecer muito aos meus colegas Sergey Kurbanov e Nikolay Yusev, pela assistência técnica na implementação do conceito de teste de carga como serviço em nossa empresa. </font></font></i><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Autor</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Timur Gilmullin</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - deputado. </font><font style="vertical-align: inherit;">Chefe de Tecnologia e Processos de Desenvolvimento (DevOps), Positive Technologies</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt504264/index.html">Comentário de revisão da Huawei: comente nas postagens de Wi-Fi 6 e receba prêmios</a></li>
<li><a href="../pt504270/index.html">O Svelte é uma boa opção para a implementação de widgets?</a></li>
<li><a href="../pt504276/index.html">Os 10 melhores livros para desenvolvedores</a></li>
<li><a href="../pt504282/index.html">Criação da arquitetura corporativa no NSPK</a></li>
<li><a href="../pt504284/index.html">O livro “Pure Agile. Noções básicas de flexibilidade</a></li>
<li><a href="../pt504296/index.html">Gerando ramificações aleatórias em Python</a></li>
<li><a href="../pt504306/index.html">Como é feito o hardware russo para armazenamento Aerodisk Vostok na Elbrus</a></li>
<li><a href="../pt504310/index.html">Dicotomia de dados: repensando a relação com dados e serviços</a></li>
<li><a href="../pt504312/index.html">Registro unificado de programas russos e GPL. Meus cinco centavos</a></li>
<li><a href="../pt504314/index.html">Implementação de comandos docker pull e docker push sem cliente docker via solicitações HTTP</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>