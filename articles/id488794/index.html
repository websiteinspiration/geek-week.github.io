<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🍜 🙌🏻 🔃 Golang + Phaser3 = MMORPG - Klien dan Server 🤹🏿 📙 ⛹🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Pada artikel terakhir, kami membuat kekosongan dengan Anda, sehingga untuk berbicara, dasar di mana alam semesta kita akan dibuat, visualisasi menggun...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Golang + Phaser3 = MMORPG - Klien dan Server</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/488794/"><img src="https://habrastorage.org/webt/ra/gk/at/ragkatgmqj9evur6anqx3rlos3e.gif" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pada artikel terakhir, kami membuat kekosongan dengan Anda, sehingga untuk berbicara, dasar di mana alam semesta kita akan dibuat, visualisasi menggunakan konsol mungkin terlihat baik, tetapi karakter teks membosankan dan tidak terlalu indah, dalam artikel ini kita akan fokus pada memvisualisasikan ubin kami menggunakan Phaser.js </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam artikel sebelumnya, proyek kami terlihat seperti ini: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/mb/5r/nh/mb5rnhfwbge-ytwhwqk_hu9psrc.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang kita akan menggunakan alat lain untuk pengembangan web, saya harap Anda memiliki Node.js dan npm diinstal, jika tidak, segera instal. </font><font style="vertical-align: inherit;">Jadi kami membuka terminal dan mulai:</font></font><br>
<a name="habracut"></a><br>
<pre><code class="bash hljs">$ npm install phaser@3.22.0</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah berhasil menyelesaikan tim, kita akan melihat yang berikut:</font></font><br>
<br>
<pre><code class="bash hljs">+ phaser@3.22.0<font></font>
added 15 packages from 48 contributors and audited 20 packages <span class="hljs-keyword">in</span> 4.38s
</code></pre><br>
<img src="https://habrastorage.org/webt/kv/iq/rd/kviqrdtp_esg27iy8xdwi1o5mmu.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Begitu bagus, modul muncul, sekarang kita akan membuat direktori untuk klien kita. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hc/jg/bm/hcjgbmqtqyh5s-yaagdgps8edxq.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam Konten kita akan menyimpan sumber daya game, mis. </font><font style="vertical-align: inherit;">sprite kami. </font><font style="vertical-align: inherit;">Kami juga akan membuat dua file game.js dan MainScene.js, di direktori root (di mana file main.go berada) buat index.html </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
game.js - menyimpan pengaturan utama untuk game </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MainScene.js - ini akan berisi kelas </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
index.html </font><font style="vertical-align: inherit;">adegan permainan utama </font><font style="vertical-align: inherit;">- halaman tempat adegan akan </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
segera sambungkan skrip kami ke index.html dan kami tidak akan kembali ke file ini lagi:</font></font><br>
<br>
<pre><code class="xml hljs">    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"node_modules/phaser/dist/phaser.js"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"module"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"Client/game.js"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"module"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di MainScene.js kita akan membuat templat kelas kecil untuk adegan masa depan kita:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">export</span> {MainScene}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MainScene</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Phaser</span>.<span class="hljs-title">Scene</span></span>{
<span class="hljs-keyword">constructor</span>() {
    <span class="hljs-keyword">super</span>({<span class="hljs-attr">key</span>: <span class="hljs-string">'MainScene'</span>})<font></font>
}<font></font>
preload() {<font></font>
<font></font>
}<font></font>
create() {<font></font>
<font></font>
}<font></font>
update() {<font></font>
<font></font>
}<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di game.js tambahkan pengaturan khas sesuai keinginan Anda, inilah milik saya:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">import</span> {MainScene} <span class="hljs-keyword">from</span> <span class="hljs-string">"./MainScene.js"</span>;
<span class="hljs-keyword">let</span> config = {
    <span class="hljs-attr">type</span>: Phaser.AUTO,
    <span class="hljs-attr">width</span>: <span class="hljs-number">800</span>,
    <span class="hljs-attr">height</span>: <span class="hljs-number">600</span>,
    <span class="hljs-attr">disableContextMenu</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">background</span>: <span class="hljs-string">'black'</span>,
    <span class="hljs-attr">physics</span>: {
        <span class="hljs-attr">default</span>: <span class="hljs-string">'arcade'</span>,
        <span class="hljs-attr">arcadePhysics</span>: {
            <span class="hljs-attr">overlapBias</span>: <span class="hljs-number">1</span><font></font>
        }<font></font>
    },<font></font>
    <span class="hljs-attr">scene</span>:[MainScene],
    <span class="hljs-attr">pixelArt</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">roundPixels</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">antialias</span>: <span class="hljs-literal">true</span><font></font>
<font></font>
}<font></font>
<span class="hljs-keyword">let</span> game = <span class="hljs-keyword">new</span> Phaser.Game(config);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang kita memerlukan server HTTP, pada ini dilakukan dalam beberapa baris. </font><font style="vertical-align: inherit;">Buka main.go dan buat server:</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-keyword">package</span> main<font></font>
<font></font>
<span class="hljs-keyword">import</span> (
	<span class="hljs-string">"fmt"</span>
	<span class="hljs-string">"html/template"</span>
	<span class="hljs-string">"net/http"</span><font></font>
)<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
	<span class="hljs-comment">//     </span>
	http.HandleFunc(<span class="hljs-string">"/"</span>, indexHandler)
	<span class="hljs-comment">//      (,   .)</span>
	http.Handle(<span class="hljs-string">"/node_modules/phaser/dist/"</span>, http.StripPrefix(<span class="hljs-string">"/node_modules/phaser/dist/"</span>, http.FileServer(http.Dir(<span class="hljs-string">"./node_modules/phaser/dist/"</span>))))<font></font>
	http.Handle(<span class="hljs-string">"/Client/"</span>, http.StripPrefix(<span class="hljs-string">"/Client/"</span>, http.FileServer(http.Dir(<span class="hljs-string">"./Client/"</span>))))<font></font>
	http.Handle(<span class="hljs-string">"/Client/Content/"</span>, http.StripPrefix(<span class="hljs-string">"/Client/Content/"</span>, http.FileServer(http.Dir(<span class="hljs-string">"./Client/Content/"</span>))))
	<span class="hljs-comment">//  .   ,   8080</span>
	err := http.ListenAndServe(<span class="hljs-string">":8080"</span>, <span class="hljs-literal">nil</span>)
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {<font></font>
		fmt.Println(err.Error())<font></font>
	}<font></font>
}<font></font>
<span class="hljs-comment">//   index.html,      </span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">indexHandler</span><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span> {<font></font>
	fmt.Println(<span class="hljs-string">"indexAction"</span>)<font></font>
	t, _ := template.ParseFiles(<span class="hljs-string">"index.html"</span>)<font></font>
	err := t.Execute(w, <span class="hljs-string">"index"</span>)
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {<font></font>
		fmt.Println(err.Error())<font></font>
	}<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Yah, kami memiliki server web dan klien kami sendiri! </font><font style="vertical-align: inherit;">Mari kita memulainya! </font><font style="vertical-align: inherit;">Buka konsol:</font></font><br>
<br>
<pre><code class="bash hljs">$ go run main.go</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami membuka browser dan mencoba untuk terhubung ke server kami, dalam kasus saya itu </font></font><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">localhost: 8080</font></font></blockquote><br>
<img src="https://habrastorage.org/webt/k5/85/pw/k585pwr9ihknt_hx2glcnyzgrua.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika Anda melihat layar hitam, maka Anda melakukan semuanya dengan benar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi, mari kita buat penangan lain dimana kita akan menerima potongan kita dalam format json. </font><font style="vertical-align: inherit;">Buat direktori terpisah dan sebut itu GameController, di sini kita akan memiliki semua penangan yang bekerja dengan data game, membuat file Map_Controller.go </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Juga kita perlu ditingkatkan</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chunk.go</font></font></b><div class="spoiler_text"><pre><code class="go hljs"><span class="hljs-keyword">package</span> Chunk<font></font>
<font></font>
<span class="hljs-keyword">import</span> (
	<span class="hljs-string">"exampleMMO/PerlinNoise"</span>
	<span class="hljs-string">"fmt"</span><font></font>
)<font></font>
<font></font>
<font></font>
<span class="hljs-keyword">var</span> TILE_SIZE = <span class="hljs-number">16</span>
<span class="hljs-keyword">var</span> CHUNK_SIZE = <span class="hljs-number">16</span> * <span class="hljs-number">16</span>
<span class="hljs-keyword">var</span> PERLIN_SEED <span class="hljs-keyword">float32</span> = <span class="hljs-number">160</span><font></font>
<font></font>
<span class="hljs-keyword">type</span> Chunk <span class="hljs-keyword">struct</span> {<font></font>
	ChunkID [<span class="hljs-number">2</span>]<span class="hljs-keyword">int</span> <span class="hljs-string">`json:"chunkID"`</span>
	Map     <span class="hljs-keyword">map</span>[Coordinate]Tile <span class="hljs-string">`json:"map"`</span><font></font>
}<font></font>
<font></font>
<span class="hljs-comment">/*
  
*/</span>
<span class="hljs-keyword">type</span> Tile <span class="hljs-keyword">struct</span> {<font></font>
	Key <span class="hljs-keyword">string</span> <span class="hljs-string">`json:"key"`</span>
	X   <span class="hljs-keyword">int</span>    <span class="hljs-string">`json:"x"`</span>
	Y   <span class="hljs-keyword">int</span>    <span class="hljs-string">`json:"y"`</span><font></font>
}<font></font>
<font></font>
<span class="hljs-comment">/*
    
*/</span>
<span class="hljs-keyword">type</span> Coordinate <span class="hljs-keyword">struct</span> {<font></font>
	X <span class="hljs-keyword">int</span> <span class="hljs-string">`json:"x"`</span>
	Y <span class="hljs-keyword">int</span> <span class="hljs-string">`json:"y"`</span><font></font>
}<font></font>
<font></font>
<font></font>
<font></font>
<span class="hljs-comment">/*
    ,      
 [1,1]
*/</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewChunk</span><span class="hljs-params">(idChunk Coordinate)</span> <span class="hljs-title">Chunk</span></span> {<font></font>
	fmt.Println(<span class="hljs-string">"New Chank"</span>, idChunk)<font></font>
	chunk := Chunk{ChunkID: [<span class="hljs-number">2</span>]<span class="hljs-keyword">int</span>{idChunk.X, idChunk.Y}}
	<span class="hljs-keyword">var</span> chunkXMax, chunkYMax <span class="hljs-keyword">int</span>
	<span class="hljs-keyword">var</span> chunkMap <span class="hljs-keyword">map</span>[Coordinate]Tile<font></font>
	chunkMap = <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[Coordinate]Tile)<font></font>
	chunkXMax = idChunk.X * CHUNK_SIZE<font></font>
	chunkYMax = idChunk.Y * CHUNK_SIZE<font></font>
<font></font>
	<span class="hljs-keyword">switch</span> {
	<span class="hljs-keyword">case</span> chunkXMax &lt; <span class="hljs-number">0</span> &amp;&amp; chunkYMax &lt; <span class="hljs-number">0</span>:<font></font>
		{<font></font>
			<span class="hljs-keyword">for</span> x := chunkXMax + CHUNK_SIZE; x &gt; chunkXMax; x -= TILE_SIZE {
				<span class="hljs-keyword">for</span> y := chunkYMax + CHUNK_SIZE; y &gt; chunkYMax; y -= TILE_SIZE {<font></font>
<font></font>
					posX := <span class="hljs-keyword">float32</span>(x - (TILE_SIZE / <span class="hljs-number">2</span>))<font></font>
					posY := <span class="hljs-keyword">float32</span>(y + (TILE_SIZE / <span class="hljs-number">2</span>))<font></font>
					tile := Tile{}<font></font>
					tile.X = <span class="hljs-keyword">int</span>(posX)<font></font>
					tile.Y = <span class="hljs-keyword">int</span>(posY)<font></font>
					perlinValue := PerlinNoise.Noise(posX/PERLIN_SEED, posY/PERLIN_SEED)<font></font>
					<span class="hljs-keyword">switch</span> {
					<span class="hljs-keyword">case</span> perlinValue &lt; <span class="hljs-number">-0.01</span>:<font></font>
						tile.Key = <span class="hljs-string">"Water"</span>
					<span class="hljs-keyword">case</span> perlinValue &gt;= <span class="hljs-number">-0.01</span> &amp;&amp; perlinValue &lt; <span class="hljs-number">0</span>:<font></font>
						tile.Key = <span class="hljs-string">"Sand"</span>
					<span class="hljs-keyword">case</span> perlinValue &gt;= <span class="hljs-number">0</span> &amp;&amp; perlinValue &lt;= <span class="hljs-number">0.5</span>:<font></font>
						tile.Key = <span class="hljs-string">"Ground"</span>
					<span class="hljs-keyword">case</span> perlinValue &gt; <span class="hljs-number">0.5</span>:<font></font>
						tile.Key = <span class="hljs-string">"Mount"</span><font></font>
					}<font></font>
					chunkMap[Coordinate{X: tile.X, Y: tile.Y}] = tile<font></font>
<font></font>
				}<font></font>
			}<font></font>
		}<font></font>
	<span class="hljs-keyword">case</span> chunkXMax &lt; <span class="hljs-number">0</span>:<font></font>
		{<font></font>
			<span class="hljs-keyword">for</span> x := chunkXMax + CHUNK_SIZE; x &gt; chunkXMax; x -= TILE_SIZE {
				<span class="hljs-keyword">for</span> y := chunkYMax - CHUNK_SIZE; y &lt; chunkYMax; y += TILE_SIZE {<font></font>
					posX := <span class="hljs-keyword">float32</span>(x - (TILE_SIZE / <span class="hljs-number">2</span>))<font></font>
					posY := <span class="hljs-keyword">float32</span>(y + (TILE_SIZE / <span class="hljs-number">2</span>))<font></font>
					tile := Tile{}<font></font>
					tile.X = <span class="hljs-keyword">int</span>(posX)<font></font>
					tile.Y = <span class="hljs-keyword">int</span>(posY)<font></font>
					perlinValue := PerlinNoise.Noise(posX/PERLIN_SEED, posY/PERLIN_SEED)<font></font>
					<span class="hljs-keyword">switch</span> {
					<span class="hljs-keyword">case</span> perlinValue &lt; <span class="hljs-number">-0.12</span>:<font></font>
						tile.Key = <span class="hljs-string">"Water"</span>
					<span class="hljs-keyword">case</span> perlinValue &gt;= <span class="hljs-number">-0.12</span> &amp;&amp; perlinValue &lt;= <span class="hljs-number">0.5</span>:<font></font>
						tile.Key = <span class="hljs-string">"Ground"</span>
					<span class="hljs-keyword">case</span> perlinValue &gt; <span class="hljs-number">0.5</span>:<font></font>
						tile.Key = <span class="hljs-string">"Mount"</span><font></font>
					}<font></font>
					chunkMap[Coordinate{X: tile.X, Y: tile.Y}] = tile<font></font>
				}<font></font>
			}<font></font>
		}<font></font>
	<span class="hljs-keyword">case</span> chunkYMax &lt; <span class="hljs-number">0</span>:<font></font>
		{<font></font>
			<span class="hljs-keyword">for</span> x := chunkXMax - CHUNK_SIZE; x &lt; chunkXMax; x += TILE_SIZE {
				<span class="hljs-keyword">for</span> y := chunkYMax + CHUNK_SIZE; y &gt; chunkYMax; y -= TILE_SIZE {<font></font>
					posX := <span class="hljs-keyword">float32</span>(x + (TILE_SIZE / <span class="hljs-number">2</span>))<font></font>
					posY := <span class="hljs-keyword">float32</span>(y - (TILE_SIZE / <span class="hljs-number">2</span>))<font></font>
					tile := Tile{}<font></font>
					tile.X = <span class="hljs-keyword">int</span>(posX)<font></font>
					tile.Y = <span class="hljs-keyword">int</span>(posY)<font></font>
					perlinValue := PerlinNoise.Noise(posX/PERLIN_SEED, posY/PERLIN_SEED)<font></font>
					<span class="hljs-keyword">switch</span> {
					<span class="hljs-keyword">case</span> perlinValue &lt; <span class="hljs-number">-0.12</span>:<font></font>
						tile.Key = <span class="hljs-string">"Water"</span>
					<span class="hljs-keyword">case</span> perlinValue &gt;= <span class="hljs-number">-0.12</span> &amp;&amp; perlinValue &lt;= <span class="hljs-number">0.5</span>:<font></font>
						tile.Key = <span class="hljs-string">"Ground"</span>
					<span class="hljs-keyword">case</span> perlinValue &gt; <span class="hljs-number">0.5</span>:<font></font>
						tile.Key = <span class="hljs-string">"Mount"</span><font></font>
					}<font></font>
					chunkMap[Coordinate{X: tile.X, Y: tile.Y}] = tile<font></font>
<font></font>
				}<font></font>
			}<font></font>
		}<font></font>
	<span class="hljs-keyword">default</span>:<font></font>
		{<font></font>
			<span class="hljs-keyword">for</span> x := chunkXMax - CHUNK_SIZE; x &lt; chunkXMax; x += TILE_SIZE {
				<span class="hljs-keyword">for</span> y := chunkYMax - CHUNK_SIZE; y &lt; chunkYMax; y += TILE_SIZE {<font></font>
					posX := <span class="hljs-keyword">float32</span>(x + (TILE_SIZE / <span class="hljs-number">2</span>))<font></font>
					posY := <span class="hljs-keyword">float32</span>(y + (TILE_SIZE / <span class="hljs-number">2</span>))<font></font>
					tile := Tile{}<font></font>
					tile.X = <span class="hljs-keyword">int</span>(posX)<font></font>
					tile.Y = <span class="hljs-keyword">int</span>(posY)<font></font>
					perlinValue := PerlinNoise.Noise(posX/PERLIN_SEED, posY/PERLIN_SEED)<font></font>
					<span class="hljs-keyword">switch</span> {
					<span class="hljs-keyword">case</span> perlinValue &lt; <span class="hljs-number">-0.12</span>:<font></font>
						tile.Key = <span class="hljs-string">"Water"</span>
					<span class="hljs-keyword">case</span> perlinValue &gt;= <span class="hljs-number">-0.12</span> &amp;&amp; perlinValue &lt;= <span class="hljs-number">0.5</span>:<font></font>
						tile.Key = <span class="hljs-string">"Ground"</span>
					<span class="hljs-keyword">case</span> perlinValue &gt; <span class="hljs-number">0.5</span>:<font></font>
						tile.Key = <span class="hljs-string">"Mount"</span><font></font>
					}<font></font>
					chunkMap[Coordinate{X: tile.X, Y: tile.Y}] = tile<font></font>
<font></font>
				}<font></font>
			}<font></font>
		}<font></font>
<font></font>
	}<font></font>
	chunk.Map = chunkMap<font></font>
	<span class="hljs-keyword">return</span> chunk<font></font>
}<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami baru saja menambahkan kunci json ke struktur kami dan sedikit memperbaiki kreasi. Kami </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
kembali ke Map_Controller,</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-keyword">package</span> GameController<font></font>
<font></font>
<span class="hljs-keyword">import</span> (
	<span class="hljs-string">"encoding/json"</span>
	<span class="hljs-string">"exampleMMO/Chunk"</span>
	<span class="hljs-string">"fmt"</span>
	<span class="hljs-string">"net/http"</span><font></font>
)<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Map_Handler</span><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span> {<font></font>
			c:= Chunk.NewChunk(Chunk.Coordinate{<span class="hljs-number">1</span>,<span class="hljs-number">1</span>})<font></font>
			 js, e :=json.Marshal(c)<font></font>
			 <span class="hljs-keyword">if</span> e!= <span class="hljs-literal">nil</span> {<font></font>
			 	fmt.Println(e.Error())<font></font>
			 }<font></font>
			 fmt.Println(<span class="hljs-keyword">string</span>(js))<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
dan tambahkan baris ke main.go</font></font><br>
<br>
<pre><code class="go hljs">	http.HandleFunc(<span class="hljs-string">"/map"</span>, GameController.Map_Handler)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mari kita coba untuk memulai server dan pergi ke localhost: 8080 / map. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Output di terminal:</font></font><br>
<br>
<pre><code class="bash hljs">New Chank {1 1}<font></font>
json: unsupported <span class="hljs-built_in">type</span>: map[Chunk.Coordinate]Chunk.Tile
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ya, kami lupa bahwa di Golang, ketika diserialisasi, kunci peta harus berupa string. </font><font style="vertical-align: inherit;">Untuk serialisasi, Go memeriksa apakah jenisnya cocok dengan antarmuka TextMarshaler, dan memanggil metode MarshalText (), kita hanya perlu membuat metode MarshalText () untuk tipe Koordinat kita. Kita </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
kembali ke Chunk.go dan menambahkan kode berikut:</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(t Coordinate)</span> <span class="hljs-title">MarshalText</span><span class="hljs-params">()</span> <span class="hljs-params">([]<span class="hljs-keyword">byte</span>, error)</span></span> {<font></font>
<font></font>
	<span class="hljs-keyword">return</span> []<span class="hljs-keyword">byte</span>(<span class="hljs-string">"["</span> + strconv.Itoa(t.X) + <span class="hljs-string">","</span> + strconv.Itoa(t.Y) + <span class="hljs-string">"]"</span>), <span class="hljs-literal">nil</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anda dapat menulis implementasi Anda, yang paling penting adalah metode ini mengembalikan string unik. </font><font style="vertical-align: inherit;">Kami akan menggunakan kunci ini untuk mengelola potongan pada klien, mari sekarang periksa cara kerja pengontrol kami, mulai server lagi dan lihat output ke konsol. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/xm/cv/fu/xmcvfu0hilosymyu172rdgr2gjk.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ya, semuanya baik-baik saja, mari sekarang buat kesimpulan ke aliran, tambahkan dua baris di akhir pengontrol kami:</font></font><br>
<br>
<pre><code class="go hljs">
	w.Header().Set(<span class="hljs-string">"Content-Type"</span>, <span class="hljs-string">"application/json"</span>)<font></font>
	w.Write(js)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk sekarang, selesaikan dengan Golang dan kembali ke klien. </font><font style="vertical-align: inherit;">kita akan membutuhkan tiga judul, walaupun sebenarnya kita memiliki 4 judul, tetapi untuk saat ini kita memiliki tiga, atau bahkan dua. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/14/ep/mt/14epmtlekh0tcaxqbyykzummptk.png"><br>
<br>
<img src="https://habrastorage.org/webt/q6/c3/nw/q6c3nwanc2id9a7-d770lxvrusu.png"><br>
<br>
<img src="https://habrastorage.org/webt/of/vf/9v/ofvf9vdoa0-dcuz-2smdbh5sx3i.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tambahkan ubin kami ke direktori Konten dan mulai bekerja dengan MainScene.js, untuk hasil pertama kami memerlukan beberapa fungsi:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MainScene</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Phaser</span>.<span class="hljs-title">Scene</span></span>{
<span class="hljs-keyword">constructor</span>() {
    <span class="hljs-keyword">super</span>({<span class="hljs-attr">key</span>: <span class="hljs-string">'MainScene'</span>})<font></font>
<font></font>
}<font></font>
preload() {<font></font>
    <span class="hljs-comment">//     </span>
    <span class="hljs-keyword">this</span>.load.image(<span class="hljs-string">"Ground"</span>, <span class="hljs-string">"Client/Content/sprGrass.png"</span>)
    <span class="hljs-keyword">this</span>.load.image(<span class="hljs-string">"Water"</span>, <span class="hljs-string">"Client/Content/sprWater1.png"</span>)
    <span class="hljs-keyword">this</span>.load.image(<span class="hljs-string">"Sand"</span>, <span class="hljs-string">"Client/Content/sprGrass.png"</span>)<font></font>
<font></font>
<font></font>
}<font></font>
create() {<font></font>
    <span class="hljs-keyword">this</span>.getGameMap()<font></font>
}<font></font>
update() {<font></font>
<font></font>
}<font></font>
<span class="hljs-comment">//   </span>
<span class="hljs-keyword">async</span> getGameMap() {
    <span class="hljs-keyword">let</span> res = <span class="hljs-keyword">await</span> fetch(<span class="hljs-string">"/map"</span>)
    <span class="hljs-keyword">let</span> result = <span class="hljs-keyword">await</span> res.json()    
    <span class="hljs-keyword">this</span>.drawChunk(result.map)<font></font>
<font></font>
}<font></font>
<span class="hljs-comment">//      </span><font></font>
drawChunk(map) {<font></font>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> chunkKey <span class="hljs-keyword">in</span> map) {
        <span class="hljs-keyword">this</span>.add.image(map[chunkKey].x,map[chunkKey].y, map[chunkKey].key)<font></font>
    }<font></font>
}<font></font>
<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Server mengembalikan bongkahan kami kepada kami dalam bentuk objek json, Anda dapat melihat strukturnya di konsol peramban: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/7t/4u/p4/7t4up4ltauu_8d652po4svdvcae.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan Phaser merendernya di peramban: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/kd/mr/y8/kdmry87ve-4eepdorxng_omh3h8.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami memeriksa pekerjaan paling sederhana antara server dan klien, pada artikel berikutnya kami akan segera menggambar 9 bongkahan dan menavigasi ke dunia. </font><font style="vertical-align: inherit;">Lihat semua kode dan sumber daya dari artikel di </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sini</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id488780/index.html">Mozilla hilang dalam perang browser, tetapi masih percaya itu bisa menyelamatkan Internet</a></li>
<li><a href="../id488782/index.html">Bagaimana Anda menyukai opsi manajemen dependensi ini di Python?</a></li>
<li><a href="../id488784/index.html">Komersialisasi peningkatan perangkat lunak gratis di bawah lisensi Copyleft</a></li>
<li><a href="../id488786/index.html">Seberapa rinci seharusnya cerita pengguna?</a></li>
<li><a href="../id488792/index.html">Memantau ketersediaan situs di Rusia dengan lutut</a></li>
<li><a href="../id488796/index.html">Belajar untuk menggunakan layanan microser. Bagian 2. Kubernetes</a></li>
<li><a href="../id488800/index.html">Agile: 9 Tip Buruk</a></li>
<li><a href="../id488806/index.html">Apakah ini tidak konstruktif, atau Anda melayani permohonan kepada raja?</a></li>
<li><a href="../id488808/index.html">Programmer, mari kita pelajari sumber program klasik</a></li>
<li><a href="../id488810/index.html">Kami menghidupkan kembali hexapod. Bagian satu</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>