<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚òÇÔ∏è üàÇÔ∏è üßú How we teach Yandex to answer questions and save users 20 thousand hours a day üë©‚Äçüëß‚Äçüë¶ üõ¥ ‚úùÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When we enter a query in the search bar, we are looking for information, not links. Moreover, often we need a short sentence or a well-known fact. For...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>How we teach Yandex to answer questions and save users 20 thousand hours a day</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yandex/blog/502542/"><img src="https://habrastorage.org/webt/vr/ly/op/vrlyoptfwt9r9zseizsvas_uwqw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When we enter a query in the search bar, we are looking for information, not links. </font><font style="vertical-align: inherit;">Moreover, often we need a short sentence or a well-known fact. </font><font style="vertical-align: inherit;">For example, [the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">formula for the volume of the truncated pyramid</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ] is the same on all sites - links are not needed, just give an answer. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No one can surprise anyone with factual (informational) answers, but few people know how they are formed, how they differ, and what has happened in this area recently. </font><font style="vertical-align: inherit;">My name is Anton Ivanov. </font><font style="vertical-align: inherit;">Today, together with my colleague Mikhail Ageev</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dminer</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">we‚Äôll tell the story of the answers in the search and share some of the details that we haven‚Äôt talked about before. </font><font style="vertical-align: inherit;">Hope it will be helpful.</font></font><br>
<br>
<a name="habracut"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The history of the Internet is the history of simplifying the search for information. </font><font style="vertical-align: inherit;">Once upon a time, people visited online catalogs to find answers where links to sites were grouped by topic. </font><font style="vertical-align: inherit;">Over time, search engines appeared, they learned how to search for sites by keywords. </font><font style="vertical-align: inherit;">The demand for a quick search for information stimulated the development of technology: a word search gradually evolved into a search by meaning, when the answer could be found on a page with zero intersection by keywords. </font><font style="vertical-align: inherit;">But even in this case, I had to click on the links. </font><font style="vertical-align: inherit;">People have always dreamed of more.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">First facts</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now it‚Äôs hard to remember how Yandex's factual answers began. We can say that the solution was a special format of the sorcerer, which assumes a short text response without interactivity (as opposed to responding to requests [ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">my ip address</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ] or [ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqua color</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]). As you know, implementing such a format is not difficult. The main question is different: where to get the answers? </font></font><br>
<br>
<img src="https://habrastorage.org/webt/4i/fw/7u/4ifw7uoaxcbicf5c-urmo2zaxeq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We started with the easiest technical way. Special people (assessors) analyzed the most popular queries, chose those for which you can find a short answer. A classic example of such a query is [ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">how many paws a fly has</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ].</font></font><br>
<br>
<img src="https://habrastorage.org/webt/aj/vz/nl/ajvznl2xow_khauxb9bxxlc71-u.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In this way, it was possible to cover only the most popular queries, and the long tail of other queries was ignored. Partly, we solved this problem with the help of crowdsourcing. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A few years ago, tolokers began to help us replenish the database of factual answers. Frequent requests were uploaded to the platform, tolokers saw the task: ‚ÄúIs it true that you can give an exhaustive answer to this request? And if true, then give it. ‚Äù Of course, other tolokers checked the adequacy of the answers, and we caught the mistakes with the help of a search </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">guard</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . By the way, tolokers also helped us find out that actual answers with a picture are usually liked by users more than just text.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The help of tolokers is significant, but even they will not help to cover the long tail of low-frequency queries. </font><font style="vertical-align: inherit;">There are simply too many such requests for any manual markup: there are not tens of thousands, but millions! </font><font style="vertical-align: inherit;">To solve this problem, the search ranking experience was useful to us.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fact snippet</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When you look for something in Yandex search, you see not only 10 links, but also a title, description, icon and other data. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We focus on the description. </font><font style="vertical-align: inherit;">Our search creates it automatically. </font><font style="vertical-align: inherit;">To highlight the best fragment of text, the lightweight CatBoost model is used, which estimates the proximity of a fragment of text and a request. </font><font style="vertical-align: inherit;">It turns out that link descriptions sometimes already contain factual answers. </font><font style="vertical-align: inherit;">It would be strange not to take advantage of this - but not so simple.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It may seem that the task is to choose the ‚Äúmost factual‚Äù description among all the descriptions of the pages found by request, but this approach will not work well. The reason is that the informative description of the page does not always coincide with a good answer to the direct question of a person. Therefore, our Fact Snippet technology builds facts in parallel with page descriptions, but based on other parameters so that the result is similar to the answer. And now among them you need to choose the most high-quality answer. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We already </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">told</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">on Habr√© about search algorithms "Palekh", "Korolev" and about the DSSM approach. </font><font style="vertical-align: inherit;">The task then came down to finding texts that were close in meaning when ranking pages. </font><font style="vertical-align: inherit;">In fact, we compared two vectors: the query vector and the document text vector. </font><font style="vertical-align: inherit;">The closer these vectors are in multidimensional space, the closer are the meanings of the texts. </font><font style="vertical-align: inherit;">To choose the best quality facts, we did the same. </font><font style="vertical-align: inherit;">Our neural network model, trained on the answers we already know, builds response vectors for the pages found in the search and compares them with the query vector. </font><font style="vertical-align: inherit;">So we get the best answer. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It is clear that answering all-all requests in this way is not worth it: most requests do not require a factual answer. </font><font style="vertical-align: inherit;">Therefore, we use another model for dropping out ‚Äúnon-factual‚Äù requests.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fact Snippet 2.0</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
All that we talked about above concerned ‚Äúclassical‚Äù factual answers: short, comprehensive, as in the encyclopedia. This direction has long been the only one. But the farther, the more we saw that the division on the basis of the existence of an exhaustive answer, on the one hand, is very shaky, and on the other - opaque to the user: he just needs to solve his problem faster. It took me to go beyond the usual facts. So the project appeared Fact Snippet 2.0. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/wk/nw/cu/wknwcu2dbthdtxbbk7dciqgiymu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To simplify things, Fact Snippet 2.0 is the same Fact Snippet, but without the requirement to find a ‚Äúcomprehensive answer‚Äù. In fact, everything is somewhat more complicated.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Let me remind you that Fact Snippet works in two stages. At the first stage, using an easy model, we evaluate the ‚Äúfactual nature‚Äù of the request: does it mean a factual answer or not. If yes, at the second stage we are looking for an answer, it appears in the search results. For Fact Snippet 2.0, we adapted both steps to find answers to a wider range of questions. Such answers do not claim to be encyclopedic in their entirety, but are still useful.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It is possible, but not always necessary, to select a paragraph of text for any request. </font><font style="vertical-align: inherit;">Sometimes the found texts are not relevant enough to the query. </font><font style="vertical-align: inherit;">Sometimes we already have good answers from other sources - and we need to decide which one to choose. </font><font style="vertical-align: inherit;">For example, why offer the address of the organization in text if you can show an interactive map, phone number and reviews. </font><font style="vertical-align: inherit;">We solve this problem with the help of a blender classifier, with which </font><font style="vertical-align: inherit;">Andrei Styskin </font><font style="vertical-align: inherit;">already </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">acquainted</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> readers of Habr </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">And the answer should not be rude, insulting. </font><font style="vertical-align: inherit;">Almost every such reasonable restriction has its own classifier, and making it work in runtime in a split second is another quest.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Query reformulations</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
They covered another part of the long tail, but many ‚Äúunique‚Äù requests remained behind. A significant proportion of them are other formulations of queries already known to us. For example, [ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">when a pike changes teeth</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ] and [at what time the </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;">pike changes teeth</font></a><font style="vertical-align: inherit;"> ] are almost the same thing. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/z6/o5/c0/z6o5c02r2igfjfxfngqu3depkvq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To solve this problem, we came up with a mechanism that on the fly understands that the incoming request is an alias (means the same) of another request, the answer to which we already have. This is easier and faster than independently generating two factual answers. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We take all requests for which there are answers, convert them into vectors and put them in the index </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">k-NN</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (more precisely, in its optimized version of </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HNSW</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">which allows you to search much faster). Next, we construct query vectors for which there is no answer by direct coincidence, and look for the top N most similar queries in our k-NN. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Next, we go through this top and run through the katbust classifier of the triple: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- user request; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- request from k-NN; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- response to a request from k-NN. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If the verifier verifier is positive, the request is considered an alias of the request from k-NN, we can return the already known answer. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The main creative part of this design is in writing factors for the classifier. Here we tried a lot of different ideas. Among the strongest factors: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- query vectors; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- Levenshtein distances; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- word by word embeddings;</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- factors based on a variety of sorcerers for each of the requests; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- distance between query words. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Separately, I will talk about a trick using the BERT neural network. We have rather strong restrictions on the time for searching an alias: a maximum of a few milliseconds. It is impossible to perform BERT in such a time with a load of several thousand RPS on current resources. Therefore, with our BERT-model, we collected a lot of (hundreds of millions) of artificial estimates and trained on them a simpler neural network DSSM, which works very fast in runtime. As a result, with some loss of accuracy, a strong factor was obtained.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In fact, one can determine the semantic proximity of requests in other ways. </font><font style="vertical-align: inherit;">For example, if two queries differ from each other in one word - check how the search results for these queries differ (look at the number of matching links in the top). </font><font style="vertical-align: inherit;">If you repeat this many millions of times and average the results, you get a pretty good estimate of how much the meaning of the query changes if you change one word for another in it. </font><font style="vertical-align: inherit;">After that, you can add all the data into one structure (for example, trie) and calculate the measure of the proximity of queries through the generalized Levenshtein distance. </font><font style="vertical-align: inherit;">You can expand this approach and consider not only words, but also pairs of words (but trie is obtained much more due to the exponential growth of data).</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What's next</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
According to our estimates, thanks to the factual / informational answers, we save users 20 thousand hours every day, because they do not have to look through the links in the search results (and this is not counting the time that they would have spent on finding the answer on the sites). </font><font style="vertical-align: inherit;">This is good, but there is always room to grow. </font><font style="vertical-align: inherit;">For example, now we use the text that we find on the Internet for answers, but the finished piece of text can not always be found in one place or in the correct form. </font><font style="vertical-align: inherit;">With the help of neural networks this problem can be solved: generate a response so that it matches the request and does not contain unnecessary. </font><font style="vertical-align: inherit;">This is our project of search neurosummarization, which, I hope, we will talk about next time.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en502528/index.html">Programming a game for an embedded device on ESP32</a></li>
<li><a href="../en502532/index.html">The revolution in the IT department (department). Is it necessary?</a></li>
<li><a href="../en502536/index.html">First impressions and key features of MIUI 12</a></li>
<li><a href="../en502538/index.html">How to build an old version of NGINX Ingress Controller and patch it</a></li>
<li><a href="../en502540/index.html">Alpine.js - continue dating</a></li>
<li><a href="../en502548/index.html">We invite you to free webinars on robotics 19.05 and dentistry 21.05</a></li>
<li><a href="../en502554/index.html">Middle information technology as a way out of crisis</a></li>
<li><a href="../en502556/index.html">Microsoft Build 2020 conference - completely online today (look directly at Habr√©)</a></li>
<li><a href="../en502558/index.html">How I Collected Wheel Physics at Unigine</a></li>
<li><a href="../en502560/index.html">Just say no to end-2-end tests</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>