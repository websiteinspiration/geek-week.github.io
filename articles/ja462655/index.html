<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🏀 🌊 👲 最後にコードを入力してください 🥩 🐬 🖖🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="こんにちはHabr！
 

先日、もう一度タイプコードをもらいました 
 

if(someParameter.Volatilities.IsEmpty()) { // We have to report about the broken channels, however we could not...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>最後にコードを入力してください</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/462655/"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">こんにちはHabr！</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">先日、もう一度タイプコードをもらいました </font></font></p><br>
<pre><code class="plaintext hljs">if(someParameter.Volatilities.IsEmpty())<font></font>
{<font></font>
    // We have to report about the broken channels, however we could not differ it from just not started cold system.<font></font>
    // Therefore write this case into the logs and then in case of emergency IT Ops will able to gather the target line<font></font>
    Log.Info("Channel {0} is broken or was not started yet", someParameter.Key)<font></font>
}</code></pre><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コードにはかなり重要な機能が1つあります。受信者は実際に何が起こったかを知りたいと思っています。</font><font style="vertical-align: inherit;">実際、1つのケースではシステムに問題があり、もう1つのケースではウォームアップします。</font><font style="vertical-align: inherit;">ただし、モデルはこれを提供しません（モデルの作成者であることが多い送信者を喜ばせるため）。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに、「たぶん何かがおかしい」という事実でさえ、コレクションが</font></font><code>Volatilities</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">空で</font><font style="vertical-align: inherit;">あるという事実に由来し</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">場合によっては正しいかもしれません。</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">経験豊富な開発者の大多数は、「このフラグの組み合わせが設定されている場合、A、B、Cを作成するように求められる」というスタイルで秘密の知識を含むコードの行を見つけたと思います（ただし、モデル自体からは見えません）。</font></font></p><br>
<p>   ,            ,       ,   -    legacy.</p><br>
<p><strong>:</strong>     ,    ,     (  ),           5-10 .     ,        ,         .  ,       ,       .</p><br>
<p>      —    .</p><a name="habracut"></a><br>
<h1 id="ispolzuyte-pattern-visitor">  visitor</h1><br>
<p>       ,       (  ).         ,    (    "   ,    ").      (   ,    ,   ,  -   ).   ,        ,      —    + .</p><br>
<p>         :</p><br>
<pre><code class="plaintext hljs">class Response<font></font>
{<font></font>
     public IVolatilityResponse Data { get; }<font></font>
}<font></font>
<font></font>
interface IVolatilityResponse<font></font>
{<font></font>
    TOutput Visit&lt;TInput, TOutput&gt;(IVolatilityResponseVisitor&lt;TInput, TOutput&gt; visitor, TInput input)<font></font>
}<font></font>
<font></font>
class VolatilityValues : IVolatilityResponse <font></font>
{<font></font>
    public Surface Data;<font></font>
<font></font>
    TOutput Visit&lt;TInput, TOutput&gt;(IVolatilityResponseVisitor&lt;TInput, TOutput&gt; visitor, TInput input)<font></font>
    =&gt; visitor.Visit(this, input);<font></font>
}<font></font>
<font></font>
class CalculationIsBroken : IVolatilityResponse <font></font>
{<font></font>
    TOutput Visit&lt;TInput, TOutput&gt;(IVolatilityResponseVisitor&lt;TInput, TOutput&gt; visitor, TInput input)<font></font>
    =&gt; visitor.Visit(this, input);<font></font>
}<font></font>
<font></font>
interface IVolatilityResponseVisitor&lt;TInput, TOutput&gt;<font></font>
{<font></font>
    TOutput Visit(VolatilityValues instance, TInput input);<font></font>
<font></font>
    TOutput Visit(CalculationIsBroken instance, TInput input);<font></font>
}</code></pre><br>
<p>   :</p><br>
<ul>
<li>   . ,        ,    .</li>
<li>-        <code>Response</code>  <code>json</code>/<code>protobuf</code>,       .     ,     (,   ,        ,       ).</li>
<li>  (    )    <code>IVolatilityResponseVisitor&lt;TInput, TOutput&gt;</code>,        .      ,     .</li>
<li>-       -       ..       ,    ,  .         ,       .</li>
</ul><br>
<h2 id="pro-ogranichenie-nasledovaniya-v-drugih-yazykah">     </h2><br>
<p>    (, <code>Scala</code>  <code>Kotlin</code>)   ,       ,   .            .</p><br>
<p> ,      <code>Kotlin</code> :</p><br>
<pre><code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Response</span> </span>(
     <span class="hljs-keyword">val</span> <span class="hljs-keyword">data</span>: IVolatilityResponse<font></font>
)<font></font>
<font></font>
<span class="hljs-keyword">sealed</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">VolatilityResponse</span></span><font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">VolatilityValues</span> : <span class="hljs-type">VolatilityResponse</span></span>()<font></font>
{<font></font>
    <span class="hljs-keyword">val</span> <span class="hljs-keyword">data</span>: Surface<font></font>
}<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CalculationIsBroken</span> : <span class="hljs-type">VolatilityResponse</span></span>()
</code></pre><br>
<p>   ,       ,     <code>VolatilityResponse</code>      ,      ,         .</p><br>
<pre><code class="kotlin hljs"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getResponseString</span><span class="hljs-params">(response: <span class="hljs-type">VolatilityResponse</span>)</span></span> = <span class="hljs-keyword">when</span>(response) {
    <span class="hljs-keyword">is</span> VolatilityValues -&gt; <span class="hljs-keyword">data</span>.toString()<font></font>
}</code></pre><br>
<p>  ,        .     :</p><br>
<pre><code class="kotlin hljs"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getResponseString</span><span class="hljs-params">(response: <span class="hljs-type">VolatilityResponse</span>)</span></span> {
    <span class="hljs-keyword">when</span>(response) {
        <span class="hljs-keyword">is</span> VolatilityValues -&gt; println(<span class="hljs-keyword">data</span>.toString())<font></font>
    }<font></font>
}</code></pre><br>
<h1 id="ne-vse-primitivnye-tipy-oznachayut-odno-i-to-zhe">        </h1><br>
<p>      .  , -       . : </p><br>
<pre><code class="plaintext hljs">class Group<font></font>
{<font></font>
    public int Id { get; }<font></font>
<font></font>
    public string Name { get; }<font></font>
}<font></font>
<font></font>
class User<font></font>
{<font></font>
    public int Id { get; }<font></font>
<font></font>
    public int GroupId { get; }<font></font>
<font></font>
    public string Name { get; }<font></font>
}</code></pre><br>
<p>  .        .  :    ?</p><br>
<pre><code class="plaintext hljs">public bool IsInGroup(User user, Group group)<font></font>
{<font></font>
    return user.Id == group.Id;<font></font>
}<font></font>
<font></font>
public User CreateUser(string name, Group group)<font></font>
{<font></font>
    return new User<font></font>
    {<font></font>
        Id = group.Id,<font></font>
        GroupId = group.Id,<font></font>
        name = name<font></font>
    }<font></font>
}</code></pre><br>
<p> —   ,     <code>Id</code>   <code>Id</code>    .      <code>id</code>  <code>Group</code>  <code>id</code>  <code>User</code>.</p><br>
<p>  ,    :    <code>GroupId</code>, <code>UserId</code>   .    <code>User</code>    ,       .   ,       .</p><br>
<p> ,         ,       :</p><br>
<pre><code class="plaintext hljs">public void SetUserGroup(UserId userId, GroupId groupId)<font></font>
{<font></font>
    /* some sql code */<font></font>
}</code></pre><br>
<p>      .   ,          .</p><br>
<p>     :</p><br>
<pre><code class="plaintext hljs">class GroupId<font></font>
{<font></font>
    public int Id { get; }<font></font>
<font></font>
    public bool Equals(GroupId groupId) =&gt; Id == groupId?.Id;<font></font>
<font></font>
    [Obsolete("GroupId can be equal only with GroupId", error: true)]<font></font>
    public override bool Equals(object obj) =&gt; Equals(obj as GroupId)<font></font>
<font></font>
    public static bool operator==(GroupId id1, GroupId id2) <font></font>
    {<font></font>
        if(ReferenceEquals(id1, id2))<font></font>
            return true;<font></font>
<font></font>
        if(ReferenceEquals(id1, null) || ReferenceEquals(id2, null))<font></font>
            return false;<font></font>
<font></font>
        return id1.Id == id2.Id;<font></font>
    }<font></font>
<font></font>
    [Obsolete("GroupId can be equal only with GroupId", error: true)]<font></font>
    public static bool operator==(object _, GroupId __) =&gt; throw new NotSupportedException("GroupId can be equal only with GroupId")<font></font>
<font></font>
    [Obsolete("GroupId can be equal only with GroupId", error: true)]<font></font>
    public static bool operator==(GroupId _, object __) =&gt; throw new NotSupportedException("GroupId can be equal only with GroupId")<font></font>
}</code></pre><br>
<p> :</p><br>
<ul>
<li>    . ,       ,      .</li>
<li>    (   ),      .</li>
<li>  :<br>
<ul>
<li>   .  ,     ,     <code>GroupId</code>   <code>UserId</code></li>
<li>   .  ,       (    <code>IEquitable</code>,     <code>GetHashCode</code>),         .    :     ,     . ..   "    ?"    "    ?".</li>
</ul></li>
</ul><br>
<h2 id="nemnogo-esche-ob-sql-i-ob-ogranicheniyah">   sql   </h2><br>
<p>        ,   .        :</p><br>
<pre><code class="plaintext hljs">void SetName(string name)<font></font>
{<font></font>
    if(name == null || name.IsEmpty() || !name[0].IsLetter || !name[0].IsCapital || name.Length &gt; MAX_NAME_COLUMN_LENGTH)<font></font>
    {<font></font>
        throw ....<font></font>
    }<font></font>
<font></font>
    /**/<font></font>
}</code></pre><br>
<p>        ,    .     ,  :</p><br>
<ul>
<li>     ,    .</li>
<li>       .</li>
<li>   <code>string</code>,    <code>name</code>,    ,  -  ,       .</li>
</ul><br>
<p> :</p><br>
<ul>
<li>   (  , , <code>Name</code>).</li>
<li>       .</li>
<li>    <code>string</code>  <code>Name</code>,      .</li>
</ul><br>
<p>   :</p><br>
<ul>
<li> ,     <code>name</code>    .</li>
<li> <em>Fail Fast</em> — ,   ,   ,  ,     ,    .  ,       "  ",   ,        .</li>
<li>    ,   : <code>void UpdateData(Name name, Email email, PhoneNumber number)</code>.        <code>string</code>,     .</li>
</ul><br>
<h2 id="nemnogo-o-privedenii-tipov">   </h2><br>
<p>   ,     ,      Sql,  -    .        ,   <code>string</code>:</p><br>
<ul>
<li>    <code>interface IValueGet&lt;TValue&gt;{ TValue Wrapped { get; } }</code>.        Sql     </li>
<li>   -    ,    ,     .     :</li>
</ul><br>
<pre><code class="plaintext hljs">interface IValueGet&lt;TValue&gt;<font></font>
{<font></font>
    TValue Wrapped { get; }<font></font>
}<font></font>
<font></font>
abstract class BaseWrapper : IValueGet&lt;TValue&gt; <font></font>
{<font></font>
    protected BaseWrapper(TValue initialValue)<font></font>
    {<font></font>
        Wrapped = initialValue;<font></font>
    }<font></font>
<font></font>
    public TValue Wrapped { get; private set; }<font></font>
}<font></font>
<font></font>
sealed class Name : BaseWrapper&lt;string&gt;<font></font>
{<font></font>
    public Name(string value)<font></font>
        :base(value)<font></font>
        {<font></font>
            /*no necessary validations*/<font></font>
        }<font></font>
}<font></font>
<font></font>
sealed class UserId : BaseWrapper&lt;int&gt;<font></font>
{<font></font>
    public UserId(int id)<font></font>
        :base(id)<font></font>
    {<font></font>
            /*no necessary validations*/<font></font>
    }<font></font>
}</code></pre><br>
<h1 id="proizvoditelnost"></h1><br>
<p>     ,      :</p><br>
<ul>
<li>  ,   il ,   ,   jit`   .           .</li>
<li>  ,     .   wrapper`      .</li>
</ul><br>
<p> ,      , :</p><br>
<ul>
<li>        java     (  ).           .          :      ,         .        ,   .  —   ,    . ,   ,  Wrapper'      ,   ,     -   .</li>
<li>  jit   ,     .                .         .           (    ).   ,   ,     ,     ,   ,      .</li>
<li> ,           ,           ,   <code>int</code>, <code>string</code>    .   —          ,   ,      .       ,        .       , ,    ,      Enterprise ,   ,      (   ).</li>
</ul><br>
<h2 id="kak-mozhno-optimizirovat-kod-sostoyaschiy-iz-bolshogo-chisla-podobnyh-mikrotipov">   ,      .</h2><br>
<p><strong>:</strong>      ,     ,     .   ,    .       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">    </a>,         (        M.2 SSD,     HDD    ).</p><br>
<p>,  :</p><br>
<ul>
<li>    .    ,  Wrapper     ,           .   ,       ,        GC    .<br>
<ul>
<li><code>struct</code>  .Net    boxing/unboxing.           <code>Dictionary</code>/<code>Map</code> (       ).</li>
<li><code>inline</code>   Kotlin/Scala   . ,       (        <code>ToString</code>/<code>GetHashCode</code>).</li>
<li>      .  , .Net <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">     </a>,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">GraalVM  Java </a>    ,     ,      (  ,   ). </li>
</ul></li>
<li>   (     ,  , ).<br>
<ul>
<li>    ,     ,      ,   —   .  ,     ,      .</li>
<li>     ,      ,   ,     .    ,     .</li>
<li>    ,        <code>Equals</code>/<code>GetHashCode</code>.       ,     ,     ,   ,    .        .</li>
<li>    ,     <code>GetHashCode</code>/<code>Equals</code> (.  ).      (    )  ,         Generation 0.</li>
</ul></li>
<li>      ,   .   ,          ,       . ,         ,       :   <code>ToUpperInvariant</code>  ,    ,    .        ,    —  .       (         ,           ).</li>
</ul><br>
<h1 id="vyvod"></h1><br>
<p>      :  ,   ,     ,     .  ,          .           ,   ,   " ".</p><br>
<p>         ,       ,     .</p><br>
<p>       ,         .        .</p><br>
<p>       ,      ,       .    ,      .</p><br>
<p>       —       (  —      ).          ,      .      :   ,      ,   .   ,   ,     .</p></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja462631/index.html">Web週末：集中的なNetology集中的なWebサイト開発</a></li>
<li><a href="../ja462635/index.html">量子、またはあちらこちら：量子-古典的遷移を研究するための新しいアルゴリズム</a></li>
<li><a href="../ja462643/index.html">Pythonを使用して、ボードメンバーシップの相互依存する個人を特定する</a></li>
<li><a href="../ja462649/index.html">＃18 Mosdroid Argon-レポート</a></li>
<li><a href="../ja462653/index.html">独立の象徴としてのLTE</a></li>
<li><a href="../ja462657/index.html">SkyRC B6 Nano充電器のレビューとテスト</a></li>
<li><a href="../ja462661/index.html">LinuxでC ++プログラムを開発する際のPVS-Studio静的アナライザーの知識</a></li>
<li><a href="../ja462663/index.html">水泳、ダンス（！）、ロッキング</a></li>
<li><a href="../ja462665/index.html">ヘルムセキュリティ</a></li>
<li><a href="../ja462667/index.html">GalaxyガイドDevOpsConf 2019</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>