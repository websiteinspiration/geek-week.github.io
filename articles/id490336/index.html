<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🎄 🍣 🔫 Saluran Anatomi dalam Go 🖊️ 🌶️ 🎪</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Halo, Habr! Saya mempersembahkan bagi Anda terjemahan artikel "Anatomi Saluran di Jalan " oleh Uday Hiwarale.
 Apa itu saluran?
 

Saluran adalah obje...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Saluran Anatomi dalam Go</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/490336/"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Halo, Habr! </font><font style="vertical-align: inherit;">Saya mempersembahkan bagi Anda terjemahan artikel </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Anatomi Saluran di</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Jalan </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">"</font></a><font style="vertical-align: inherit;"> oleh Uday Hiwarale.</font></font></p><br>
<h2 id="chto-takoe-kanaly"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apa itu saluran?</font></font></h2><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Saluran adalah objek komunikasi tempat goroutin bertukar data. </font><font style="vertical-align: inherit;">Secara teknis, ini adalah konveyor (atau pipa) dari mana Anda dapat membaca atau meletakkan data. </font><font style="vertical-align: inherit;">Artinya, satu goroutine dapat mengirim data ke saluran, dan yang lainnya dapat membaca data yang ditempatkan di saluran ini.</font></font></p><br>
<h2 id="sozdanie-kanala"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pembuatan Saluran</font></font></h2><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Go menyediakan kata kunci chan untuk membuat saluran. </font><font style="vertical-align: inherit;">Saluran dapat mengirimkan data hanya dari satu jenis, data jenis lain tidak dapat ditransmisikan melalui saluran ini.</font></font></p><a name="habracut"></a><br>
<pre><code class="go hljs"><span class="hljs-keyword">package</span> main<font></font>
<font></font>
<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">var</span> c <span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span><font></font>
    fmt.Println(c)<font></font>
} </code></pre><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contoh di play.golang.org</font></font></a></p><br>
<p>    <code>c</code>,    <code>int</code>.    <code>&lt;nil&gt;</code>,      —  <code>nil</code>.    .         ,       ().      <code>make</code>. </p><br>
<pre><code class="go hljs"><span class="hljs-keyword">package</span> main<font></font>
<font></font>
<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {<font></font>
    c := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>)<font></font>
<font></font>
    fmt.Printf(<span class="hljs-string">"type of `c` is %T\n"</span>, c)<font></font>
    fmt.Printf(<span class="hljs-string">"value of `c` is %v\n"</span>, c)<font></font>
}</code></pre><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">  play.golang.org</a></p><br>
<p>      <code>:=</code>       <code>make</code>.     :</p><br>
<pre><code class="plaintext hljs">type of `c` is chan int<font></font>
value of `c` is 0xc0420160c0</code></pre><br>
<p>     <code>c</code>,    .  go   .   ,      ,         .      ,        ,        .</p><br>
<h2 id="zapis-i-chtenie-dannyh">   </h2><br>
<p>Go      <code>&lt;-</code>    </p><br>
<pre><code class="plaintext hljs">c &lt;- data</code></pre><br>
<p>        <code>c</code>.     ,      <code>data</code>     <code>c</code>.</p><br>
<pre><code class="plaintext hljs">&lt;- c</code></pre><br>
<p>       <code>c</code>.           .         ,     :</p><br>
<pre><code class="plaintext hljs">var data int<font></font>
data = &lt;- c</code></pre><br>
<p>    <code>c</code>,    <code>int</code>,      <code>data</code>.     ,   :</p><br>
<pre><code class="plaintext hljs">data := &lt;- c</code></pre><br>
<p>Go   ,   <code>c</code>,   <code>data</code>   .</p><br>
<p>      .      ,     ,          .            ,      .    ,         .</p><br>
<h2 id="kanaly-na-praktike">  </h2><br>
<pre><code class="go hljs"><span class="hljs-keyword">package</span> main<font></font>
<font></font>
<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">greet</span><span class="hljs-params">(c <span class="hljs-keyword">chan</span> <span class="hljs-keyword">string</span>)</span></span> {<font></font>
    fmt.Println(<span class="hljs-string">"Hello "</span> + &lt;-c + <span class="hljs-string">"!"</span>)<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {<font></font>
    fmt.Println(<span class="hljs-string">"main() started"</span>)<font></font>
    c := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">string</span>)<font></font>
<font></font>
    <span class="hljs-keyword">go</span> greet(c)<font></font>
<font></font>
    c &lt;- <span class="hljs-string">"John"</span>
    fmt.Println(<span class="hljs-string">"main() stopped"</span>)<font></font>
}</code></pre><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">  play.golang.org</a></p><br>
<p>   :</p><br>
<ol>
<li>   <code>greet</code>,    <code>c</code>  .         <code>c</code>    .</li>
<li>  <code>main</code>    <code>"main() started"</code>.</li>
<li> ,  <code>make</code>,   <code>c</code>    <code>string</code>.</li>
<li>  <code></code>   <code>greet</code>     ,    <code>go</code>.</li>
<li>      <code>main</code>  <code>greet</code>, <code>main</code> -  .</li>
<li>    <code></code>     <code>main</code>    ,    (<code>greet</code>)      <code>c</code>.  Go   <code>greet</code>      .</li>
<li>  <code>main</code>        <code>"main() stopped"</code>.</li>
</ol><br>
<h2 id="deadlock-vzaimnaya-blokirovka">Deadlock ( )</h2><br>
<p>   ,             . ,    ,    "".     deadlock,      .</p><br>
<blockquote>      ,      ,         ,  -     .        :    ,       .</blockquote><p> deadlock   <code>main</code> ,      .</p><br>
<pre><code class="go hljs"><span class="hljs-keyword">package</span> main<font></font>
<font></font>
<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {<font></font>
    fmt.Println(<span class="hljs-string">"main() started"</span>)<font></font>
<font></font>
    c := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">string</span>)<font></font>
    c &lt;- <span class="hljs-string">"John"</span><font></font>
<font></font>
    fmt.Println(<span class="hljs-string">"main() stopped"</span>)<font></font>
}</code></pre><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">  play.golang.org</a></p><br>
<p>       :</p><br>
<pre><code class="plaintext hljs">main() started<font></font>
fatal error: all goroutines are asleep - deadlock!<font></font>
goroutine 1 [chan send]:<font></font>
main.main()<font></font>
        program.go:10 +0xfd<font></font>
exit status 2</code></pre><br>
<h3 id="zakrytie-kanala"> </h3><br>
<p> Go     ,         .       ,   : <code>val, ok := &lt;- channel</code>,  ok    ,         ,  <code>ok</code>  <code>false</code>,          .   ,    <code>close</code>,    <code>close(channel)</code>.    :</p><br>
<pre><code class="go hljs"><span class="hljs-keyword">package</span> main<font></font>
<font></font>
<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">greet</span><span class="hljs-params">(c <span class="hljs-keyword">chan</span> <span class="hljs-keyword">string</span>)</span></span> {<font></font>
    &lt;-c <span class="hljs-comment">// for John</span>
    &lt;-c <span class="hljs-comment">// for Mike</span><font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {<font></font>
    fmt.Println(<span class="hljs-string">"main() started"</span>)<font></font>
<font></font>
    c := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">string</span>, <span class="hljs-number">1</span>)<font></font>
<font></font>
    <span class="hljs-keyword">go</span> greet(c)<font></font>
    c &lt;- <span class="hljs-string">"John"</span><font></font>
<font></font>
    <span class="hljs-built_in">close</span>(c) <span class="hljs-comment">// closing channel</span><font></font>
<font></font>
    c &lt;- <span class="hljs-string">"Mike"</span>
    fmt.Println(<span class="hljs-string">"main() stopped"</span>)<font></font>
}</code></pre><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">  play.golang.org</a></p><br>
<blockquote>       <code>c &lt;- "John"</code>  ,         ,  <code>greet</code>    .      ,        <code>c</code>.     ,     <code>c</code>  ,     <code>main</code>       <code>close(c)</code>.</blockquote><p> :</p><br>
<pre><code class="plaintext hljs">main() started<font></font>
panic: send on closed channel<font></font>
<font></font>
goroutine 1 [running]:<font></font>
main.main()<font></font>
    program.go:20 +0x120<font></font>
exit status 2</code></pre><br>
<p>   ,    ,  ,      .           <code>for</code>.</p><br>
<h3 id="primer-s-ciklom-for">   for</h3><br>
<pre><code class="go hljs"><span class="hljs-keyword">package</span> main<font></font>
<font></font>
<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">squares</span><span class="hljs-params">(c <span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>)</span></span> {
    <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">9</span>; i++ {<font></font>
        c &lt;- i * i<font></font>
    }<font></font>
<font></font>
    <span class="hljs-built_in">close</span>(c) <span class="hljs-comment">// close channel</span><font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {<font></font>
    fmt.Println(<span class="hljs-string">"main() started"</span>)<font></font>
    c := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>)<font></font>
<font></font>
    <span class="hljs-keyword">go</span> squares(c) <span class="hljs-comment">// start goroutine</span><font></font>
<font></font>
    <span class="hljs-comment">// periodic block/unblock of main goroutine until chanel closes</span>
    <span class="hljs-keyword">for</span> {<font></font>
        val, ok := &lt;-c<font></font>
        <span class="hljs-keyword">if</span> ok == <span class="hljs-literal">false</span> {<font></font>
            fmt.Println(val, ok, <span class="hljs-string">"&lt;-- loop broke!"</span>)
            <span class="hljs-keyword">break</span> <span class="hljs-comment">// exit break loop</span>
        } <span class="hljs-keyword">else</span> {<font></font>
            fmt.Println(val, ok)<font></font>
        }<font></font>
    }<font></font>
<font></font>
    fmt.Println(<span class="hljs-string">"main() stopped"</span>)<font></font>
}</code></pre><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">  play.golang.org</a></p><br>
<p>         ,        .       <code>squares</code>,       0  9.  <code>main</code>       <code>for</code>.</p><br>
<p>      ,     <code>val, ok := &lt;-c</code>,  <code>ok</code>     ,   .   <code>squares</code>  ,    ,   ,   <code>close</code>.  <code>ok</code>  <code>true</code>,    <code>val</code>    ( <code>ok</code>).  <code>ok</code>  <code>false</code>,   ,    <code>break</code>.      :</p><br>
<pre><code class="plaintext hljs">main() started<font></font>
0 true<font></font>
1 true<font></font>
4 true<font></font>
9 true<font></font>
16 true<font></font>
25 true<font></font>
36 true<font></font>
49 true<font></font>
64 true<font></font>
81 true<font></font>
0 false &lt;-- loop broke!<font></font>
main() stopped</code></pre><br>
<blockquote>  ,  <code>val</code>,  ,   ,      .         <code>int</code>,     0,         : <code>0 false &lt;-- loop broke!</code></blockquote><p> ,           <code>for</code>, Go    <code>range</code>,    ,    .       <code>range</code>:</p><br>
<pre><code class="go hljs"><span class="hljs-keyword">package</span> main<font></font>
<font></font>
<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">squares</span><span class="hljs-params">(c <span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>)</span></span> {
    <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">9</span>; i++ {<font></font>
        c &lt;- i * i<font></font>
    }<font></font>
<font></font>
    <span class="hljs-built_in">close</span>(c) <span class="hljs-comment">// close channel</span><font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {<font></font>
    fmt.Println(<span class="hljs-string">"main() started"</span>)<font></font>
    c := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>)<font></font>
<font></font>
    <span class="hljs-keyword">go</span> squares(c) <span class="hljs-comment">// start goroutine</span><font></font>
<font></font>
    <span class="hljs-comment">// periodic block/unblock of main goroutine until chanel closes</span>
    <span class="hljs-keyword">for</span> val := <span class="hljs-keyword">range</span> c {<font></font>
        fmt.Println(val)<font></font>
    }<font></font>
<font></font>
    fmt.Println(<span class="hljs-string">"main() stopped"</span>)<font></font>
}</code></pre><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">  play.golang.org</a></p><br>
<p>     <code>val := range c</code>   ,  <code>range</code>        ,     .     :</p><br>
<pre><code class="plaintext hljs">main() started<font></font>
0<font></font>
1<font></font>
4<font></font>
9<font></font>
16<font></font>
25<font></font>
36<font></font>
49<font></font>
64<font></font>
81<font></font>
main() stopped</code></pre><br>
<blockquote>       <code>for</code>   <code>range</code>,      - <code>dealock</code>   .</blockquote><br>
<h3 id="razmer-bufera-kanala">  </h3><br>
<p>   ,         .       <code>make</code>  2- .   —    . -     0,     .   ,     ,    .</p><br>
<p>    0,      ,     .   ,     ,   ,   ,     (   ).    ,       ,  ,     ,        .  ,           ,     .</p><br>
<p>        :</p><br>
<pre><code class="plaintext hljs">c := make(chan Type, n)</code></pre><br>
<p>       <code>Type</code>    <code>n</code>.     ,       n+1 .</p><br>
<p> ,    ,       :</p><br>
<pre><code class="go hljs"><span class="hljs-keyword">package</span> main<font></font>
<font></font>
<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">squares</span><span class="hljs-params">(c <span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>)</span></span> {
    <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">3</span>; i++ {<font></font>
        num := &lt;-c<font></font>
        fmt.Println(num * num)<font></font>
    }<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {<font></font>
    fmt.Println(<span class="hljs-string">"main() started"</span>)<font></font>
    c := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>, <span class="hljs-number">3</span>)<font></font>
<font></font>
    <span class="hljs-keyword">go</span> squares(c)<font></font>
<font></font>
    c &lt;- <span class="hljs-number">1</span>
    c &lt;- <span class="hljs-number">2</span>
    c &lt;- <span class="hljs-number">3</span><font></font>
<font></font>
    fmt.Println(<span class="hljs-string">"main() stopped"</span>)<font></font>
}</code></pre><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">  play.golang.org</a></p><br>
<p>    <code>c</code>     3.  ,     3 (<code>c &lt;- 3</code>),      (        ), <code>main</code>   ,        .  :</p><br>
<pre><code class="plaintext hljs">main() started<font></font>
main() stopped</code></pre><br>
<p>       :</p><br>
<pre><code class="go hljs"><span class="hljs-keyword">package</span> main<font></font>
<font></font>
<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">squares</span><span class="hljs-params">(c <span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>)</span></span> {
    <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">3</span>; i++ {<font></font>
        num := &lt;-c<font></font>
        fmt.Println(num * num)<font></font>
    }<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {<font></font>
    fmt.Println(<span class="hljs-string">"main() started"</span>)<font></font>
    c := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>, <span class="hljs-number">3</span>)<font></font>
<font></font>
    <span class="hljs-keyword">go</span> squares(c)<font></font>
<font></font>
    c &lt;- <span class="hljs-number">1</span>
    c &lt;- <span class="hljs-number">2</span>
    c &lt;- <span class="hljs-number">3</span>
    c &lt;- <span class="hljs-number">4</span> <span class="hljs-comment">// blocks here</span><font></font>
<font></font>
    fmt.Println(<span class="hljs-string">"main() stopped"</span>)<font></font>
}</code></pre><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">  play.golang.org</a></p><br>
<p>  ,         <code>main</code> ,    <code>squares</code>,      ,     .</p><br>
<h2 id="dlina-i-emkost-kanala">   </h2><br>
<p> ,      .   —      ( )   ,  —     .  ,   ,    <code>len</code>, ,   <code>cap</code>,   .</p><br>
<pre><code class="plaintext hljs">package main<font></font>
<font></font>
import "fmt"<font></font>
<font></font>
func main() {<font></font>
    c := make(chan int, 3)<font></font>
    c &lt;- 1<font></font>
    c &lt;- 2<font></font>
<font></font>
    fmt.Printf("Length of channel c is %v and capacity of channel c is %v", len(c), cap(c))<font></font>
    fmt.Println()<font></font>
}<font></font>
</code></pre><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">  play.golang.org</a></p><br>
<p> :</p><br>
<pre><code class="plaintext hljs">Length of channel c is 2 and capacity of channel c is 3</code></pre><br>
<p>     <code>deadlock</code>  ,       3,     2   ,           <code>main</code>.        <code>main</code>,    ,   <strong>  </strong>.</p><br>
<p> :</p><br>
<pre><code class="go hljs"><span class="hljs-keyword">package</span> main<font></font>
<font></font>
<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">sender</span><span class="hljs-params">(c <span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>)</span></span> {<font></font>
    c &lt;- <span class="hljs-number">1</span> <span class="hljs-comment">// len 1, cap 3</span>
    c &lt;- <span class="hljs-number">2</span> <span class="hljs-comment">// len 2, cap 3</span>
    c &lt;- <span class="hljs-number">3</span> <span class="hljs-comment">// len 3, cap 3</span>
    c &lt;- <span class="hljs-number">4</span> <span class="hljs-comment">// &lt;- goroutine blocks here</span>
    <span class="hljs-built_in">close</span>(c)<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {<font></font>
    c := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>, <span class="hljs-number">3</span>)<font></font>
<font></font>
    <span class="hljs-keyword">go</span> sender(c)<font></font>
<font></font>
    fmt.Printf(<span class="hljs-string">"Length of channel c is %v and capacity of channel c is %v\n"</span>, <span class="hljs-built_in">len</span>(c), <span class="hljs-built_in">cap</span>(c))<font></font>
<font></font>
    <span class="hljs-comment">// read values from c (blocked here)</span>
    <span class="hljs-keyword">for</span> val := <span class="hljs-keyword">range</span> c {<font></font>
        fmt.Printf(<span class="hljs-string">"Length of channel c after value '%v' read is %v\n"</span>, val, <span class="hljs-built_in">len</span>(c))<font></font>
    }<font></font>
}</code></pre><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">  play.golang.org</a></p><br>
<p> :</p><br>
<pre><code class="plaintext hljs">Length of channel c is 0 and capacity of channel c is 3<font></font>
Length of channel c after value '1' read is 3<font></font>
Length of channel c after value '2' read is 2<font></font>
Length of channel c after value '3' read is 1<font></font>
Length of channel c after value '4' read is 0</code></pre><br>
<p>    :</p><br>
<pre><code class="go hljs"><span class="hljs-keyword">package</span> main<font></font>
<font></font>
<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"fmt"</span>
    <span class="hljs-string">"runtime"</span><font></font>
)<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">squares</span><span class="hljs-params">(c <span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>)</span></span> {
    <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">4</span>; i++ {<font></font>
        num := &lt;-c<font></font>
        fmt.Println(num * num)<font></font>
    }<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {<font></font>
    fmt.Println(<span class="hljs-string">"main() started"</span>)<font></font>
    c := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>, <span class="hljs-number">3</span>)
    <span class="hljs-keyword">go</span> squares(c)<font></font>
<font></font>
    fmt.Println(<span class="hljs-string">"active goroutines"</span>, runtime.NumGoroutine())<font></font>
    c &lt;- <span class="hljs-number">1</span>
    c &lt;- <span class="hljs-number">2</span>
    c &lt;- <span class="hljs-number">3</span>
    c &lt;- <span class="hljs-number">4</span> <span class="hljs-comment">// blocks here</span><font></font>
<font></font>
    fmt.Println(<span class="hljs-string">"active goroutines"</span>, runtime.NumGoroutine())<font></font>
<font></font>
    <span class="hljs-keyword">go</span> squares(c)<font></font>
<font></font>
    fmt.Println(<span class="hljs-string">"active goroutines"</span>, runtime.NumGoroutine())<font></font>
<font></font>
    c &lt;- <span class="hljs-number">5</span>
    c &lt;- <span class="hljs-number">6</span>
    c &lt;- <span class="hljs-number">7</span>
    c &lt;- <span class="hljs-number">8</span> <span class="hljs-comment">// blocks here</span><font></font>
<font></font>
    fmt.Println(<span class="hljs-string">"active goroutines"</span>, runtime.NumGoroutine())<font></font>
    fmt.Println(<span class="hljs-string">"main() stopped"</span>)<font></font>
}<font></font>
</code></pre><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">  play.golang.org</a></p><br>
<p> :</p><br>
<pre><code class="plaintext hljs">main() started<font></font>
active goroutines 2<font></font>
1<font></font>
4<font></font>
9<font></font>
16<font></font>
active goroutines 1<font></font>
active goroutines 2<font></font>
25<font></font>
36<font></font>
49<font></font>
64<font></font>
active goroutines 1<font></font>
main() stopped<font></font>
</code></pre><br>
<p>     <code>for range</code>,      .          ,   :</p><br>
<pre><code class="go hljs"><span class="hljs-keyword">package</span> main<font></font>
<font></font>
<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {<font></font>
    c := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>, <span class="hljs-number">3</span>)<font></font>
    c &lt;- <span class="hljs-number">1</span>
    c &lt;- <span class="hljs-number">2</span>
    c &lt;- <span class="hljs-number">3</span>
    <span class="hljs-built_in">close</span>(c)<font></font>
<font></font>
    <span class="hljs-comment">// iteration terminates after receiving 3 values</span>
    <span class="hljs-keyword">for</span> elem := <span class="hljs-keyword">range</span> c {<font></font>
        fmt.Println(elem)<font></font>
    }<font></font>
}</code></pre><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">  play.golang.org</a></p><br>
<h2 id="rabota-s-neskolkimi-gorutinami">   </h2><br>
<p>  2 ,      ,     :</p><br>
<pre><code class="go hljs"><span class="hljs-keyword">package</span> main<font></font>
<font></font>
<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">square</span><span class="hljs-params">(c <span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>)</span></span> {<font></font>
    fmt.Println(<span class="hljs-string">"[square] reading"</span>)<font></font>
    num := &lt;-c<font></font>
    c &lt;- num * num<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">cube</span><span class="hljs-params">(c <span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>)</span></span> {<font></font>
    fmt.Println(<span class="hljs-string">"[cube] reading"</span>)<font></font>
    num := &lt;-c<font></font>
    c &lt;- num * num * num<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {<font></font>
    fmt.Println(<span class="hljs-string">"[main] main() started"</span>)<font></font>
<font></font>
    squareChan := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>)<font></font>
    cubeChan := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>)<font></font>
<font></font>
    <span class="hljs-keyword">go</span> square(squareChan)
    <span class="hljs-keyword">go</span> cube(cubeChan)<font></font>
<font></font>
    testNum := <span class="hljs-number">3</span>
    fmt.Println(<span class="hljs-string">"[main] sent testNum to squareChan"</span>)<font></font>
<font></font>
    squareChan &lt;- testNum<font></font>
<font></font>
    fmt.Println(<span class="hljs-string">"[main] resuming"</span>)<font></font>
    fmt.Println(<span class="hljs-string">"[main] sent testNum to cubeChan"</span>)<font></font>
<font></font>
    cubeChan &lt;- testNum<font></font>
<font></font>
    fmt.Println(<span class="hljs-string">"[main] resuming"</span>)<font></font>
    fmt.Println(<span class="hljs-string">"[main] reading from channels"</span>)<font></font>
<font></font>
    squareVal, cubeVal := &lt;-squareChan, &lt;-cubeChan<font></font>
    sum := squareVal + cubeVal<font></font>
<font></font>
    fmt.Println(<span class="hljs-string">"[main] sum of square and cube of"</span>, testNum, <span class="hljs-string">" is"</span>, sum)<font></font>
    fmt.Println(<span class="hljs-string">"[main] main() stopped"</span>)<font></font>
}</code></pre><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">  play.golang.org</a></p><br>
<p>   :</p><br>
<ol>
<li>  2  <code>square</code>  <code>cube</code>,     .    <code>c</code> c   <code>int</code>,        <code>num</code>.       <code>c</code>.</li>
<li> <code>main</code>      <code>squareChan</code>  <code>cubeChan</code> c   <code>int</code>.</li>
<li> <code>square</code>  <code>cube</code> .</li>
<li>   -  <code>main</code> <code>testNum</code>   3.</li>
<li>      <code>squareChan</code>  <code>cubeChan</code>.  <code>main</code>  ,       .     ,    .</li>
<li>  <code>main</code>       (<code>squareChan</code>  <code>cubeChan</code>),   ,    (<code>square</code>  <code>cube</code>)      .      <code>:=</code>     .</li>
<li>    ,   <code>main</code>,        .</li>
</ol><br>
<p>  :</p><br>
<pre><code class="plaintext hljs">[main] main() started<font></font>
[main] sent testNum to squareChan<font></font>
[cube] reading<font></font>
[square] reading<font></font>
[main] resuming<font></font>
[main] sent testNum to cubeChan<font></font>
[main] resuming<font></font>
[main] reading from channels<font></font>
[main] sum of square and cube of 3  is 36<font></font>
[main] main() stopped</code></pre><br>
<h3 id="odnonapravlennye-kanaly"> </h3><br>
<p>     ,      .      ,   . , ,     ,       .</p><br>
<p>      <code>make</code>,     .</p><br>
<pre><code class="plaintext hljs">roc := make(&lt;-chan int)<font></font>
soc := make(chan&lt;- int)</code></pre><br>
<p> <code>roc</code>   ,  <code>soc</code>   .  ,      .</p><br>
<pre><code class="go hljs"><span class="hljs-keyword">package</span> main<font></font>
<font></font>
<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {<font></font>
    roc := <span class="hljs-built_in">make</span>(&lt;-<span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>)<font></font>
    soc := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span>&lt;- <span class="hljs-keyword">int</span>)<font></font>
<font></font>
    fmt.Printf(<span class="hljs-string">"Data type of roc is `%T`\n"</span>, roc)<font></font>
    fmt.Printf(<span class="hljs-string">"Data type of soc is `%T\n"</span>, soc)<font></font>
}<font></font>
</code></pre><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">  play.golang.org</a></p><br>
<p> :</p><br>
<pre><code class="plaintext hljs">Data type of roc is `&lt;-chan int`<font></font>
Data type of soc is `chan&lt;- int</code></pre><br>
<p>      ?        e, ,  ,   .</p><br>
<p> ,     ,         ,           /   .    ?</p><br>
<p>  Go          .</p><br>
<pre><code class="go hljs"><span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">greet</span><span class="hljs-params">(roc &lt;-<span class="hljs-keyword">chan</span> <span class="hljs-keyword">string</span>)</span></span> {<font></font>
    fmt.Println(<span class="hljs-string">"Hello "</span> + &lt;-roc + <span class="hljs-string">"!"</span>)<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {<font></font>
    fmt.Println(<span class="hljs-string">"main() started"</span>)<font></font>
    c := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">string</span>)<font></font>
<font></font>
    <span class="hljs-keyword">go</span> greet(c)<font></font>
<font></font>
    c &lt;- <span class="hljs-string">"John"</span>
    fmt.Println(<span class="hljs-string">"main() stopped"</span>)<font></font>
}</code></pre><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">  play.golang.org</a></p><br>
<p>     <code>greet</code>  ,         .         ,            :</p><br>
<p><code>"invalid operation: roc &lt;- "some text" (send to receive-only type &lt;-chan string)"</code></p><br>
<h3 id="anonimnye-gorutiny"> </h3><br>
<p>       .    ,   .<br>
    :</p><br>
<pre><code class="go hljs"><span class="hljs-keyword">package</span> main<font></font>
<font></font>
<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {<font></font>
    fmt.Println(<span class="hljs-string">"main() started"</span>)<font></font>
    c := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">string</span>)<font></font>
<font></font>
    <span class="hljs-comment">// launch anonymous goroutine</span>
    <span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c <span class="hljs-keyword">chan</span> <span class="hljs-keyword">string</span>)</span></span> {<font></font>
        fmt.Println(<span class="hljs-string">"Hello "</span> + &lt;-c + <span class="hljs-string">"!"</span>)<font></font>
    }(c)<font></font>
<font></font>
    c &lt;- <span class="hljs-string">"John"</span>
    fmt.Println(<span class="hljs-string">"main() stopped"</span>)<font></font>
}</code></pre><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">  play.golang.org</a></p><br>
<p>         .</p><br>
<h3 id="kanal-s-tipom-dannyh-kanala">    </h3><br>
<p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">  </a>,          ,   ,     /       .             :</p><br>
<pre><code class="go hljs"><span class="hljs-keyword">package</span> main<font></font>
<font></font>
<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span><font></font>
<font></font>
<span class="hljs-comment">// gets a channel and prints the greeting by reading from channel</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">greet</span><span class="hljs-params">(c <span class="hljs-keyword">chan</span> <span class="hljs-keyword">string</span>)</span></span> {<font></font>
    fmt.Println(<span class="hljs-string">"Hello "</span> + &lt;-c + <span class="hljs-string">"!"</span>)<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">// gets a channels and writes a channel to it</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">greeter</span><span class="hljs-params">(cc <span class="hljs-keyword">chan</span> <span class="hljs-keyword">chan</span> <span class="hljs-keyword">string</span>)</span></span> {<font></font>
    c := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">string</span>)<font></font>
    cc &lt;- c<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {<font></font>
    fmt.Println(<span class="hljs-string">"main() started"</span>)<font></font>
<font></font>
    <span class="hljs-comment">// make a channel `cc` of data type channel of string data type</span>
    cc := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">chan</span> <span class="hljs-keyword">string</span>)<font></font>
<font></font>
    <span class="hljs-keyword">go</span> greeter(cc) <span class="hljs-comment">// start `greeter` goroutine using `cc` channel</span><font></font>
<font></font>
    <span class="hljs-comment">// receive a channel `c` from `greeter` goroutine</span><font></font>
    c := &lt;-cc<font></font>
<font></font>
    <span class="hljs-keyword">go</span> greet(c) <span class="hljs-comment">// start `greet` goroutine using `c` channel</span><font></font>
<font></font>
    <span class="hljs-comment">// send data to `c` channel</span>
    c &lt;- <span class="hljs-string">"John"</span><font></font>
<font></font>
    fmt.Println(<span class="hljs-string">"main() stopped"</span>)<font></font>
}</code></pre><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">  play.golang.org</a></p><br>
<h3 id="select">select</h3><br>
<p><code>select</code>   <code>switch</code>  ,         .  <code>select</code>          ,    case.</p><br>
<p>    ,     :</p><br>
<pre><code class="go hljs"><span class="hljs-keyword">package</span> main<font></font>
<font></font>
<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"fmt"</span>
    <span class="hljs-string">"time"</span><font></font>
)<font></font>
<font></font>
<span class="hljs-keyword">var</span> start time.Time
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">init</span><span class="hljs-params">()</span></span> {<font></font>
    start = time.Now()<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">service1</span><span class="hljs-params">(c <span class="hljs-keyword">chan</span> <span class="hljs-keyword">string</span>)</span></span> {<font></font>
    time.Sleep(<span class="hljs-number">3</span> * time.Second)<font></font>
    c &lt;- <span class="hljs-string">"Hello from service 1"</span><font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">service2</span><span class="hljs-params">(c <span class="hljs-keyword">chan</span> <span class="hljs-keyword">string</span>)</span></span> {<font></font>
    time.Sleep(<span class="hljs-number">5</span> * time.Second)<font></font>
    c &lt;- <span class="hljs-string">"Hello from service 2"</span><font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {<font></font>
    fmt.Println(<span class="hljs-string">"main() started"</span>, time.Since(start))<font></font>
<font></font>
    chan1 := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">string</span>)<font></font>
    chan2 := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">string</span>)<font></font>
<font></font>
    <span class="hljs-keyword">go</span> service1(chan1)
    <span class="hljs-keyword">go</span> service2(chan2)<font></font>
<font></font>
    <span class="hljs-keyword">select</span> {
    <span class="hljs-keyword">case</span> res := &lt;-chan1:<font></font>
        fmt.Println(<span class="hljs-string">"Response from service 1"</span>, res, time.Since(start))
    <span class="hljs-keyword">case</span> res := &lt;-chan2:<font></font>
        fmt.Println(<span class="hljs-string">"Response from service 2"</span>, res, time.Since(start))<font></font>
    }<font></font>
<font></font>
    fmt.Println(<span class="hljs-string">"main() stopped"</span>, time.Since(start))<font></font>
}</code></pre><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">  play.golang.org</a></p><br>
<p>      <code>select</code>  <code>switch</code>,    ,        .  <code>select</code>   ,    <code>default</code>(      ).      <code>case</code>,  <code>main</code>  .    <code>case</code>  ?</p><br>
<p>   <code>case</code>  ,  <code>select</code>    ,     <code>case</code>    .        ,     <code>case</code>     ( :   ,         ).</p><br>
<p>   ,   .   2    .     <code>select</code> c  <code>case</code> .  <code>case</code>    <code>chan1</code>    <code>chan2</code>.      ,    .    <code>case</code>    <code>select</code>     ,    <code>case</code>  .</p><br>
<p>     <code>select</code>  <code>main</code>        (   ),     <code>select</code>,     <code>service1</code>  <code>service2</code>. <code>service1</code>  3 ,          <code>chan1</code>.      <code>service1</code>  <code>service2</code>,    5      <code>chan2</code>.   <code>service1</code>  ,  <code>service2</code>,  <code>case</code>       <code>chan1</code>,   <code>case</code>  .      <code>main</code>,       .</p><br>
<p> :</p><br>
<pre><code class="plaintext hljs">main() started 0s<font></font>
Response from service 1 Hello from service 1 3s<font></font>
main() stopped 3s</code></pre><br>
<blockquote>    -,                .   ,   select,       ,  ,    ,   .</blockquote><p> ,   ,    <code>case</code>      ,      Sleep  .</p><br>
<pre><code class="go hljs"><span class="hljs-keyword">package</span> main<font></font>
<font></font>
<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"fmt"</span>
    <span class="hljs-string">"time"</span><font></font>
)<font></font>
<font></font>
<span class="hljs-keyword">var</span> start time.Time
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">init</span><span class="hljs-params">()</span></span> {<font></font>
    start = time.Now()<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">service1</span><span class="hljs-params">(c <span class="hljs-keyword">chan</span> <span class="hljs-keyword">string</span>)</span></span> {<font></font>
    c &lt;- <span class="hljs-string">"Hello from service 1"</span><font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">service2</span><span class="hljs-params">(c <span class="hljs-keyword">chan</span> <span class="hljs-keyword">string</span>)</span></span> {<font></font>
    c &lt;- <span class="hljs-string">"Hello from service 2"</span><font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {<font></font>
    fmt.Println(<span class="hljs-string">"main() started"</span>, time.Since(start))<font></font>
<font></font>
    chan1 := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">string</span>)<font></font>
    chan2 := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">string</span>)<font></font>
<font></font>
    <span class="hljs-keyword">go</span> service1(chan1)
    <span class="hljs-keyword">go</span> service2(chan2)<font></font>
<font></font>
    <span class="hljs-keyword">select</span> {
    <span class="hljs-keyword">case</span> res := &lt;-chan1:<font></font>
        fmt.Println(<span class="hljs-string">"Response from service 1"</span>, res, time.Since(start))
    <span class="hljs-keyword">case</span> res := &lt;-chan2:<font></font>
        fmt.Println(<span class="hljs-string">"Response from service 2"</span>, res, time.Since(start))<font></font>
    }<font></font>
<font></font>
    fmt.Println(<span class="hljs-string">"main() stopped"</span>, time.Since(start))<font></font>
}</code></pre><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">  play.golang.org</a></p><br>
<p>    :</p><br>
<pre><code class="plaintext hljs">main() started 0s<font></font>
service2() started 481µs<font></font>
Response from service 2 Hello from service 2 981.1µs<font></font>
main() stopped 981.1µs</code></pre><br>
<p>      :</p><br>
<pre><code class="plaintext hljs">main() started 0s<font></font>
service1() started 484.8µs<font></font>
Response from service 1 Hello from service 1 984µs<font></font>
main() stopped 984µs</code></pre><br>
<p>  ,   <code>chan1</code>  <code>chan2</code>   ,             .</p><br>
<p> ,     <code>case</code> ,      .</p><br>
<pre><code class="go hljs"><span class="hljs-keyword">package</span> main<font></font>
<font></font>
<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"fmt"</span>
    <span class="hljs-string">"time"</span><font></font>
)<font></font>
<font></font>
<span class="hljs-keyword">var</span> start time.Time<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">init</span><span class="hljs-params">()</span></span> {<font></font>
    start = time.Now()<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {<font></font>
    fmt.Println(<span class="hljs-string">"main() started"</span>, time.Since(start))<font></font>
    chan1 := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">string</span>, <span class="hljs-number">2</span>)<font></font>
    chan2 := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">string</span>, <span class="hljs-number">2</span>)<font></font>
<font></font>
    chan1 &lt;- <span class="hljs-string">"Value 1"</span>
    chan1 &lt;- <span class="hljs-string">"Value 2"</span>
    chan2 &lt;- <span class="hljs-string">"Value 1"</span>
    chan2 &lt;- <span class="hljs-string">"Value 2"</span><font></font>
<font></font>
    <span class="hljs-keyword">select</span> {
    <span class="hljs-keyword">case</span> res := &lt;-chan1:<font></font>
        fmt.Println(<span class="hljs-string">"Response from chan1"</span>, res, time.Since(start))
    <span class="hljs-keyword">case</span> res := &lt;-chan2:<font></font>
        fmt.Println(<span class="hljs-string">"Response from chan2"</span>, res, time.Since(start))<font></font>
    }<font></font>
<font></font>
    fmt.Println(<span class="hljs-string">"main() stopped"</span>, time.Since(start))<font></font>
}</code></pre><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">  play.golang.org</a></p><br>
<p>   :</p><br>
<pre><code class="plaintext hljs">main() started 0s<font></font>
Response from chan2 Value 1 0s<font></font>
main() stopped 1.0012ms</code></pre><br>
<p> :</p><br>
<pre><code class="plaintext hljs">main() started 0s<font></font>
Response from chan1 Value 1 0s<font></font>
main() stopped 1.0012ms</code></pre><br>
<p>        2.     2   ,          <code>select</code>.        ,    ,    <code>case</code>  ,     Go  <code>case</code>  .</p><br>
<h3 id="default-case">default case</h3><br>
<p>    <code>switch</code>,  <code>select</code>   <code>default</code>.  <code>default</code>  ,     ,  <code>default</code>   <code>select</code>  .  ,         (         )   .</p><br>
<p>     - ,  <code>select</code>   <code>case</code>.  ,     <code>default</code>.</p><br>
<pre><code class="go hljs"><span class="hljs-keyword">package</span> main<font></font>
<font></font>
<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"fmt"</span>
    <span class="hljs-string">"time"</span><font></font>
)<font></font>
<font></font>
<span class="hljs-keyword">var</span> start time.Time<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">init</span><span class="hljs-params">()</span></span> {<font></font>
    start = time.Now()<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">service1</span><span class="hljs-params">(c <span class="hljs-keyword">chan</span> <span class="hljs-keyword">string</span>)</span></span> {<font></font>
    fmt.Println(<span class="hljs-string">"service1() started"</span>, time.Since(start))<font></font>
    c &lt;- <span class="hljs-string">"Hello from service 1"</span><font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">service2</span><span class="hljs-params">(c <span class="hljs-keyword">chan</span> <span class="hljs-keyword">string</span>)</span></span> {<font></font>
    fmt.Println(<span class="hljs-string">"service2() started"</span>, time.Since(start))<font></font>
    c &lt;- <span class="hljs-string">"Hello from service 2"</span><font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {<font></font>
    fmt.Println(<span class="hljs-string">"main() started"</span>, time.Since(start))<font></font>
<font></font>
    chan1 := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">string</span>)<font></font>
    chan2 := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">string</span>)<font></font>
<font></font>
    <span class="hljs-keyword">go</span> service1(chan1)
    <span class="hljs-keyword">go</span> service2(chan2)<font></font>
<font></font>
    <span class="hljs-keyword">select</span> {
    <span class="hljs-keyword">case</span> res := &lt;-chan1:<font></font>
        fmt.Println(<span class="hljs-string">"Response from service 1"</span>, res, time.Since(start))
    <span class="hljs-keyword">case</span> res := &lt;-chan2:<font></font>
        fmt.Println(<span class="hljs-string">"Response from service 2"</span>, res, time.Since(start))
    <span class="hljs-keyword">default</span>:<font></font>
        fmt.Println(<span class="hljs-string">"No response received"</span>, time.Since(start))<font></font>
    }<font></font>
<font></font>
    fmt.Println(<span class="hljs-string">"main() stopped"</span>, time.Since(start))<font></font>
}<font></font>
</code></pre><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">  play.golang.org</a></p><br>
<p> :</p><br>
<pre><code class="plaintext hljs">main() started 0s<font></font>
No response received 0s<font></font>
main() stopped 0s</code></pre><br>
<p>        ,    ,      <code>default</code>.     <code>select</code>  <code>default</code>,         .</p><br>
<p>   <code>default</code> <code>select</code>  ,     .  <code>main</code>  ,  <code>time.Sleep</code>.      ,      <code>main</code>,      .</p><br>
<pre><code class="go hljs"><span class="hljs-keyword">package</span> main<font></font>
<font></font>
<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"fmt"</span>
    <span class="hljs-string">"time"</span><font></font>
)<font></font>
<font></font>
<span class="hljs-keyword">var</span> start time.Time<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">init</span><span class="hljs-params">()</span></span> {<font></font>
    start = time.Now()<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">service1</span><span class="hljs-params">(c <span class="hljs-keyword">chan</span> <span class="hljs-keyword">string</span>)</span></span> {<font></font>
    fmt.Println(<span class="hljs-string">"service1() started"</span>, time.Since(start))<font></font>
    c &lt;- <span class="hljs-string">"Hello from service 1"</span><font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">service2</span><span class="hljs-params">(c <span class="hljs-keyword">chan</span> <span class="hljs-keyword">string</span>)</span></span> {<font></font>
    fmt.Println(<span class="hljs-string">"service2() started"</span>, time.Since(start))<font></font>
    c &lt;- <span class="hljs-string">"Hello from service 2"</span><font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {<font></font>
    fmt.Println(<span class="hljs-string">"main() started"</span>, time.Since(start))<font></font>
<font></font>
    chan1 := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">string</span>)<font></font>
    chan2 := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">string</span>)<font></font>
<font></font>
    <span class="hljs-keyword">go</span> service1(chan1)
    <span class="hljs-keyword">go</span> service2(chan2)<font></font>
<font></font>
    time.Sleep(<span class="hljs-number">3</span> * time.Second)<font></font>
<font></font>
    <span class="hljs-keyword">select</span> {
    <span class="hljs-keyword">case</span> res := &lt;-chan1:<font></font>
        fmt.Println(<span class="hljs-string">"Response from service 1"</span>, res, time.Since(start))
    <span class="hljs-keyword">case</span> res := &lt;-chan2:<font></font>
        fmt.Println(<span class="hljs-string">"Response from service 2"</span>, res, time.Since(start))
    <span class="hljs-keyword">default</span>:<font></font>
        fmt.Println(<span class="hljs-string">"No response received"</span>, time.Since(start))<font></font>
    }<font></font>
<font></font>
    fmt.Println(<span class="hljs-string">"main() stopped"</span>, time.Since(start))<font></font>
}</code></pre><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">  play.golang.org</a></p><br>
<p>     :</p><br>
<pre><code class="plaintext hljs">main() started 0s<font></font>
service1() started 0s<font></font>
service2() started 0s<font></font>
Response from service 1 Hello from service 1 3.0001805s<font></font>
main() stopped 3.0001805s</code></pre><br>
<p> ,   :</p><br>
<pre><code class="plaintext hljs">main() started 0s<font></font>
service1() started 0s<font></font>
service2() started 0s<font></font>
Response from service 2 Hello from service 2 3.0000957s<font></font>
main() stopped 3.0000957s</code></pre><br>
<h2 id="deadlock">Deadlock</h2><br>
<p> ,   <code>deadlock</code>,   <code>default</code>,      ,  Go         ,        .</p><br>
<pre><code class="go hljs"><span class="hljs-keyword">package</span> main<font></font>
<font></font>
<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"fmt"</span>
    <span class="hljs-string">"time"</span><font></font>
)<font></font>
<font></font>
<span class="hljs-keyword">var</span> start time.Time<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">init</span><span class="hljs-params">()</span></span> {<font></font>
    start = time.Now()<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {<font></font>
    fmt.Println(<span class="hljs-string">"main() started"</span>, time.Since(start))<font></font>
<font></font>
    chan1 := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">string</span>)<font></font>
    chan2 := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">string</span>)<font></font>
<font></font>
    <span class="hljs-keyword">select</span> {
    <span class="hljs-keyword">case</span> res := &lt;-chan1:<font></font>
        fmt.Println(<span class="hljs-string">"Response from chan1"</span>, res, time.Since(start))
    <span class="hljs-keyword">case</span> res := &lt;-chan2:<font></font>
        fmt.Println(<span class="hljs-string">"Response from chan2"</span>, res, time.Since(start))
    <span class="hljs-keyword">default</span>:<font></font>
        fmt.Println(<span class="hljs-string">"No goroutines available to send data"</span>, time.Since(start))<font></font>
    }<font></font>
<font></font>
    fmt.Println(<span class="hljs-string">"main() stopped"</span>, time.Since(start))<font></font>
}</code></pre><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">  play.golang.org</a></p><br>
<p> :</p><br>
<pre><code class="plaintext hljs">main() started 0s<font></font>
No goroutines available to send data 0s<font></font>
main() stopped 0s</code></pre><br>
<p>  ,           <code>default</code>,    ,     (  ).</p><br>
<h3 id="nil-kanaly">nil </h3><br>
<p>   ,      —  <code>nil</code>, -          .            <code>select</code>,   .</p><br>
<pre><code class="go hljs"><span class="hljs-keyword">package</span> main<font></font>
<font></font>
<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">service</span><span class="hljs-params">(c <span class="hljs-keyword">chan</span> <span class="hljs-keyword">string</span>)</span></span> {<font></font>
    c &lt;- <span class="hljs-string">"response"</span><font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {<font></font>
    fmt.Println(<span class="hljs-string">"main() started"</span>)<font></font>
<font></font>
    <span class="hljs-keyword">var</span> chan1 <span class="hljs-keyword">chan</span> <span class="hljs-keyword">string</span><font></font>
<font></font>
    <span class="hljs-keyword">go</span> service(chan1)<font></font>
<font></font>
    <span class="hljs-keyword">select</span> {
    <span class="hljs-keyword">case</span> res := &lt;-chan1:<font></font>
        fmt.Println(<span class="hljs-string">"Response from chan1"</span>, res)<font></font>
    }<font></font>
<font></font>
    fmt.Println(<span class="hljs-string">"main() stopped"</span>)<font></font>
}</code></pre><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">  play.golang.org</a></p><br>
<p> :</p><br>
<pre><code class="plaintext hljs">main() started<font></font>
fatal error: all goroutines are asleep - deadlock!<font></font>
<font></font>
goroutine 1 [select (no cases)]:<font></font>
main.main()<font></font>
    program.go:17 +0xc0<font></font>
<font></font>
goroutine 6 [chan send (nil chan)]:<font></font>
main.service(0x0, 0x1)<font></font>
    program.go:6 +0x40<font></font>
created by main.main<font></font>
    program.go:14 +0xa0</code></pre><br>
<p>     ,  <code>select (no cases)</code> ,  <code>select</code>  ,    <code>case</code>    .     <code>select{}</code>  <code>main</code> ,   <code>service</code>,      <code>nil</code> ,          : <code>chan send (nil chan)</code>.  ,   ,    <code>default</code>.</p><br>
<pre><code class="go hljs"><span class="hljs-keyword">package</span> main<font></font>
<font></font>
<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">service</span><span class="hljs-params">(c <span class="hljs-keyword">chan</span> <span class="hljs-keyword">string</span>)</span></span> {<font></font>
    c &lt;- <span class="hljs-string">"response"</span><font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {<font></font>
    fmt.Println(<span class="hljs-string">"main() started"</span>)<font></font>
<font></font>
    <span class="hljs-keyword">var</span> chan1 <span class="hljs-keyword">chan</span> <span class="hljs-keyword">string</span><font></font>
<font></font>
    <span class="hljs-keyword">go</span> service(chan1)<font></font>
<font></font>
    <span class="hljs-keyword">select</span> {
    <span class="hljs-keyword">case</span> res := &lt;-chan1:<font></font>
        fmt.Println(<span class="hljs-string">"Response from chan1"</span>, res)
    <span class="hljs-keyword">default</span>:<font></font>
        fmt.Println(<span class="hljs-string">"No response"</span>)<font></font>
    }<font></font>
<font></font>
    fmt.Println(<span class="hljs-string">"main() stopped"</span>)<font></font>
}</code></pre><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">  play.golang.org</a></p><br>
<p> :</p><br>
<pre><code class="plaintext hljs">main() started<font></font>
No response<font></font>
main() stopped</code></pre><br>
<p>    <code>case</code> ,    <code>default</code>  .      <code>service</code>.  , ,   ,   ,    <code>nil</code>.</p><br>
<h3 id="dobavlyaem-timeout"> timeout</h3><br>
<p>      - ,   <code>default</code>  .   ,       ,    ,     <code>default</code>.   ,  <code>case</code>   ,      .      <code>After</code>   (package) <code>time</code>.    :</p><br>
<pre><code class="go hljs"><span class="hljs-keyword">package</span> main<font></font>
<font></font>
<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"fmt"</span>
    <span class="hljs-string">"time"</span><font></font>
)<font></font>
<font></font>
<span class="hljs-keyword">var</span> start time.Time<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">init</span><span class="hljs-params">()</span></span> {<font></font>
    start = time.Now()<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">service1</span><span class="hljs-params">(c <span class="hljs-keyword">chan</span> <span class="hljs-keyword">string</span>)</span></span> {<font></font>
    time.Sleep(<span class="hljs-number">3</span> * time.Second)<font></font>
    c &lt;- <span class="hljs-string">"Hello from service 1"</span><font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">service2</span><span class="hljs-params">(c <span class="hljs-keyword">chan</span> <span class="hljs-keyword">string</span>)</span></span> {<font></font>
    time.Sleep(<span class="hljs-number">5</span> * time.Second)<font></font>
    c &lt;- <span class="hljs-string">"Hello from service 2"</span><font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {<font></font>
    fmt.Println(<span class="hljs-string">"main() started"</span>, time.Since(start))<font></font>
<font></font>
    chan1 := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">string</span>)<font></font>
    chan2 := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">string</span>)<font></font>
<font></font>
    <span class="hljs-keyword">go</span> service1(chan1)
    <span class="hljs-keyword">go</span> service2(chan2)<font></font>
<font></font>
    <span class="hljs-keyword">select</span> {
    <span class="hljs-keyword">case</span> res := &lt;-chan1:<font></font>
        fmt.Println(<span class="hljs-string">"Response from service 1"</span>, res, time.Since(start))
    <span class="hljs-keyword">case</span> res := &lt;-chan2:<font></font>
        fmt.Println(<span class="hljs-string">"Response from service 2"</span>, res, time.Since(start))
    <span class="hljs-keyword">case</span> &lt;-time.After(<span class="hljs-number">2</span> * time.Second):<font></font>
        fmt.Println(<span class="hljs-string">"No response received"</span>, time.Since(start))<font></font>
    }<font></font>
<font></font>
    fmt.Println(<span class="hljs-string">"main() stopped"</span>, time.Since(start))<font></font>
}</code></pre><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">  play.golang.org</a></p><br>
<p>      2 :</p><br>
<pre><code class="plaintext hljs">main() started 0s<font></font>
No response received 2s<font></font>
main() stopped 2s</code></pre><br>
<p>  ,   <code>&lt;-time.After(2 * time.Second)</code>  <code>main</code>    2 . <code>time.After</code>  ,        .      <code>chan1</code>  <code>chan2</code>   ,  3- ,     .</p><br>
<p>     ,          .   <code>time.After(2 * time.Second)</code>  <code>time.After(10 * time.Second)</code>     <code>service1</code>.</p><br>
<h3 id="pustoy-select"> select</h3><br>
<p>  <code>for{}</code>,  <code>select{}</code>    ,   .     <code>select</code>    ,     <code>case</code>   ,      <code>select</code>   <code>case</code>,    ,   ,   <code>deadlock</code>.</p><br>
<pre><code class="go hljs"><span class="hljs-keyword">package</span> main<font></font>
<font></font>
<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">service</span><span class="hljs-params">()</span></span> {<font></font>
    fmt.Println(<span class="hljs-string">"Hello from service!"</span>)<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {<font></font>
    fmt.Println(<span class="hljs-string">"main() started"</span>)<font></font>
<font></font>
    <span class="hljs-keyword">go</span> service()<font></font>
<font></font>
    <span class="hljs-keyword">select</span> {}<font></font>
<font></font>
    fmt.Println(<span class="hljs-string">"main() stopped"</span>)<font></font>
}</code></pre><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">  play.golang.org</a></p><br>
<p>     :</p><br>
<pre><code class="plaintext hljs">main() started<font></font>
Hello from service!<font></font>
fatal error: all goroutines are asleep - deadlock!<font></font>
goroutine 1 [select (no cases)]:<font></font>
main.main()<font></font>
        program.go:16 +0xba<font></font>
exit status 2</code></pre><br>
<h3 id="waitgroup">WaitGroup</h3><br>
<p>   ,    ,      ( : ,      ).      ,     <code>select</code>.       .</p><br>
<p>    WaitGroup.    ,       ,       ( :      ,   ,     ,        ,      ,     ,   ).     ,     .</p><br>
<p>   :</p><br>
<pre><code class="go hljs"><span class="hljs-keyword">package</span> main<font></font>
<font></font>
<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"fmt"</span>
    <span class="hljs-string">"sync"</span>
    <span class="hljs-string">"time"</span><font></font>
)<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">service</span><span class="hljs-params">(wg *sync.WaitGroup, instance <span class="hljs-keyword">int</span>)</span></span> {<font></font>
    time.Sleep(<span class="hljs-number">2</span> * time.Second)<font></font>
    fmt.Println(<span class="hljs-string">"Service called on instance"</span>, instance)<font></font>
    wg.Done() <span class="hljs-comment">// decrement counter</span><font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {<font></font>
    fmt.Println(<span class="hljs-string">"main() started"</span>)
    <span class="hljs-keyword">var</span> wg sync.WaitGroup <span class="hljs-comment">// create waitgroup (empty struct)</span><font></font>
<font></font>
    <span class="hljs-keyword">for</span> i := <span class="hljs-number">1</span>; i &lt;= <span class="hljs-number">3</span>; i++ {<font></font>
        wg.Add(<span class="hljs-number">1</span>) <span class="hljs-comment">// increment counter</span>
        <span class="hljs-keyword">go</span> service(&amp;wg, i)<font></font>
    }<font></font>
<font></font>
    wg.Wait() <span class="hljs-comment">// blocks here</span>
    fmt.Println(<span class="hljs-string">"main() stopped"</span>)<font></font>
}</code></pre><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">  play.golang.org</a></p><br>
<p>      WaitGroup,        <code>noCopy</code>  <code>state1</code> (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">https://golang.org/src/sync/waitgroup.go?s=574:929#L10</a>).    : <code>Add</code>, <code>Wait</code>  <code>Done</code>.   .</p><br>
<p> <code>Add</code>  <code>int</code> ,   <code>delta</code> ()   <code>WaitGroup</code>.   —    ,    0.     .  <code>WaitGroup</code> ,     0,     ,  <code>delta</code>    <code>Add</code>.    ,    ,      ,   <code>Add</code>.</p><br>
<p> <code>Wait</code>     ,    .     0,   .    -   .</p><br>
<p> <code>Done</code>   .     . ( :     <code>sync</code>,   ,       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">Add(-1)</a>).</p><br>
<p> ,   <code>wg</code>,      <code>for</code>  1  3 .           1.      3  ,     <code>WaitGroup</code>     3. ,      <code>wg</code>  .  ,   <code>Done</code>     ,       .</p><br>
<p>   <code>for</code>,   <code>wg.Wait()</code>,     , ,  ,    <code>main</code>   ,      ,       0.   <code>main</code>  ,     .</p><br>
<p>     :</p><br>
<pre><code class="plaintext hljs">main() started<font></font>
Service called on instance 1<font></font>
Service called on instance 3<font></font>
Service called on instance 2<font></font>
main() stopped</code></pre><br>
<p>   , -   .</p><br>
<h3 id="pul-vorkerov"> </h3><br>
<p>   ,   —   ,     .   <code>WaitGroup</code>    ,  ,       .       ,    - ,     .</p><br>
<pre><code class="go hljs"><span class="hljs-keyword">package</span> main<font></font>
<font></font>
<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"fmt"</span>
    <span class="hljs-string">"time"</span><font></font>
)<font></font>
<font></font>
<span class="hljs-comment">// worker than make squares</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">sqrWorker</span><span class="hljs-params">(tasks &lt;-<span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>, results <span class="hljs-keyword">chan</span>&lt;- <span class="hljs-keyword">int</span>, id <span class="hljs-keyword">int</span>)</span></span> {
    <span class="hljs-keyword">for</span> num := <span class="hljs-keyword">range</span> tasks {<font></font>
        time.Sleep(time.Millisecond) <span class="hljs-comment">// simulating blocking task</span>
        fmt.Printf(<span class="hljs-string">"[worker %v] Sending result by worker %v\n"</span>, id, id)<font></font>
        results &lt;- num * num<font></font>
    }<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {<font></font>
    fmt.Println(<span class="hljs-string">"[main] main() started"</span>)<font></font>
<font></font>
    tasks := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>, <span class="hljs-number">10</span>)<font></font>
    results := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>, <span class="hljs-number">10</span>)<font></font>
<font></font>
    <span class="hljs-comment">// launching 3 worker goroutines</span>
    <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; i++ {
        <span class="hljs-keyword">go</span> sqrWorker(tasks, results, i)<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">// passing 5 tasks</span>
    <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++ {<font></font>
        tasks &lt;- i * <span class="hljs-number">2</span> <span class="hljs-comment">// non-blocking as buffer capacity is 10</span><font></font>
    }<font></font>
<font></font>
    fmt.Println(<span class="hljs-string">"[main] Wrote 5 tasks"</span>)<font></font>
<font></font>
    <span class="hljs-comment">// closing tasks</span>
    <span class="hljs-built_in">close</span>(tasks)<font></font>
<font></font>
    <span class="hljs-comment">// receving results from all workers</span>
    <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++ {<font></font>
        result := &lt;-results <span class="hljs-comment">// blocking because buffer is empty</span>
        fmt.Println(<span class="hljs-string">"[main] Result"</span>, i, <span class="hljs-string">":"</span>, result)<font></font>
    }<font></font>
<font></font>
    fmt.Println(<span class="hljs-string">"[main] main() stopped"</span>)<font></font>
}</code></pre><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">  play.golang.org</a></p><br>
<p> :</p><br>
<pre><code class="plaintext hljs">[main] main() started<font></font>
[main] Wrote 5 tasks<font></font>
[worker 0] Sending result by worker 0<font></font>
[worker 2] Sending result by worker 2<font></font>
[worker 1] Sending result by worker 1<font></font>
[main] Result 0 : 4<font></font>
[main] Result 1 : 0<font></font>
[main] Result 2 : 16<font></font>
[worker 2] Sending result by worker 2<font></font>
[main] Result 3 : 64<font></font>
[worker 0] Sending result by worker 0<font></font>
[main] Result 4 : 36<font></font>
[main] main() stopped</code></pre><br>
<p>,    ,   :</p><br>
<ol>
<li> <code>sqrWorker</code>   <code>tasks</code>,  <code>results</code>,    <code>id</code>.    —   ,    <code>tasks</code>,   <code>results</code>.</li>
<li>  <code>main</code>,    <code>tasks</code>  <code>result</code>   ,  10. ,     ,    .       —   .</li>
<li>     <code>sqrWorker</code>          <code>id</code>,      ,    .</li>
<li>   5   <code>tasks</code>,   ,      .</li>
<li>      <code>tasks</code>,  .    ,       ,   .</li>
<li>  <code>for</code>  5 ,      <code>results</code>.         ,      .   ,     , <code>main</code>  .</li>
<li>      ,          .   ,      <code>results</code>,              ,    ,     .        ,         <code>tasks</code>.  ,       <code>tasks</code>,  <code>for</code> ,   <code>tasks</code>  .      <code>deadlock</code>,    <code>tasks</code>  .</li>
<li>       ,  <code>main</code>      ,   <code>results</code>   .</li>
<li> ,    , <code>main</code>  ,      <code>results</code>,   .</li>
</ol><br>
<p>   ,   ,            .   ,    .    <code>time.Sleep()</code>,      ,       ,           .</p><br>
<blockquote>       ,       .</blockquote><p>   <code>WaitGroup</code>   .     <code>WaitGroup</code>,      ,   .</p><br>
<pre><code class="go hljs"><span class="hljs-keyword">package</span> main<font></font>
<font></font>
<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"fmt"</span>
    <span class="hljs-string">"sync"</span>
    <span class="hljs-string">"time"</span><font></font>
)<font></font>
<font></font>
<span class="hljs-comment">// worker than make squares</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">sqrWorker</span><span class="hljs-params">(wg *sync.WaitGroup, tasks &lt;-<span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>, results <span class="hljs-keyword">chan</span>&lt;- <span class="hljs-keyword">int</span>, instance <span class="hljs-keyword">int</span>)</span></span> {
    <span class="hljs-keyword">for</span> num := <span class="hljs-keyword">range</span> tasks {<font></font>
        time.Sleep(time.Millisecond)<font></font>
        fmt.Printf(<span class="hljs-string">"[worker %v] Sending result by worker %v\n"</span>, instance, instance)<font></font>
        results &lt;- num * num<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">// done with worker</span><font></font>
    wg.Done()<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {<font></font>
    fmt.Println(<span class="hljs-string">"[main] main() started"</span>)<font></font>
<font></font>
    <span class="hljs-keyword">var</span> wg sync.WaitGroup<font></font>
<font></font>
    tasks := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>, <span class="hljs-number">10</span>)<font></font>
    results := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>, <span class="hljs-number">10</span>)<font></font>
<font></font>
    <span class="hljs-comment">// launching 3 worker goroutines</span>
    <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; i++ {<font></font>
        wg.Add(<span class="hljs-number">1</span>)
        <span class="hljs-keyword">go</span> sqrWorker(&amp;wg, tasks, results, i)<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">// passing 5 tasks</span>
    <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++ {<font></font>
        tasks &lt;- i * <span class="hljs-number">2</span> <span class="hljs-comment">// non-blocking as buffer capacity is 10</span><font></font>
    }<font></font>
<font></font>
    fmt.Println(<span class="hljs-string">"[main] Wrote 5 tasks"</span>)<font></font>
<font></font>
    <span class="hljs-comment">// closing tasks</span>
    <span class="hljs-built_in">close</span>(tasks)<font></font>
<font></font>
    <span class="hljs-comment">// wait until all workers done their job</span><font></font>
    wg.Wait()<font></font>
<font></font>
    <span class="hljs-comment">// receving results from all workers</span>
    <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++ {<font></font>
        result := &lt;-results <span class="hljs-comment">// non-blocking because buffer is non-empty</span>
        fmt.Println(<span class="hljs-string">"[main] Result"</span>, i, <span class="hljs-string">":"</span>, result)<font></font>
    }<font></font>
<font></font>
    fmt.Println(<span class="hljs-string">"[main] main() stopped"</span>)<font></font>
}</code></pre><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">  play.golang.org</a></p><br>
<p>  :</p><br>
<pre><code class="plaintext hljs">[main] main() started<font></font>
[main] Wrote 5 tasks<font></font>
[worker 0] Sending result by worker 0<font></font>
[worker 2] Sending result by worker 2<font></font>
[worker 1] Sending result by worker 1<font></font>
[worker 2] Sending result by worker 2<font></font>
[worker 0] Sending result by worker 0<font></font>
[main] Result 0 : 4<font></font>
[main] Result 1 : 0<font></font>
[main] Result 2 : 16<font></font>
[main] Result 3 : 64<font></font>
[main] Result 4 : 36<font></font>
[main] main() stopped</code></pre><br>
<p>      ,   ,       <code>results</code>  <code>main</code>  ,    <code>results</code>    -   <code>wg.Wait()</code>.  <code>WaitGroup</code>,     ()   (    ),    7  9   .         .</p><br>
<h3 id="myuteks"></h3><br>
<p> —        Go.      ,       <code>race condition</code>(<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"> </a>).    ,        . , ,       .             ,      .   :</p><br>
<pre><code class="go hljs"><span class="hljs-keyword">package</span> main<font></font>
<font></font>
<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"fmt"</span>
    <span class="hljs-string">"sync"</span><font></font>
)<font></font>
<font></font>
<span class="hljs-keyword">var</span> i <span class="hljs-keyword">int</span> <span class="hljs-comment">// i == 0</span><font></font>
<font></font>
<span class="hljs-comment">// goroutine increment global variable i</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">worker</span><span class="hljs-params">(wg *sync.WaitGroup)</span></span> {<font></font>
    i = i + <span class="hljs-number">1</span><font></font>
    wg.Done()<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">var</span> wg sync.WaitGroup<font></font>
<font></font>
    <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++ {<font></font>
        wg.Add(<span class="hljs-number">1</span>)
        <span class="hljs-keyword">go</span> worker(&amp;wg)<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">// wait until all 1000 goroutines are done</span><font></font>
    wg.Wait()<font></font>
<font></font>
    <span class="hljs-comment">// value of i should be 1000</span>
    fmt.Println(<span class="hljs-string">"value of i after 1000 operations is"</span>, i)<font></font>
}</code></pre><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">  play.golang.org</a></p><br>
<p>     1000 ,      <code>i</code>,   0.      <code>WaitGroup</code>,   ,   1000    <code>i</code> , ,  ,     1000.  <code>main</code>    <code>wg.Wait()</code>,    <code>i</code>.     :</p><br>
<pre><code class="plaintext hljs">value of i after 1000 operations is 937</code></pre><br>
<p>?      1000?     . ,  ,  <code>race condition</code>. ,    .</p><br>
<p> <code>i = i + 1</code>    :</p><br>
<ol>
<li>  <code>i</code></li>
<li>  1</li>
<li>  <code>i</code>   </li>
</ol><br>
<p>   ,         .  ,  2    1000 ,  . G1  G2.</p><br>
<p>G1 ,  <code>i</code>  0,    <code>i</code>   1.   ,  G1   <code>i</code>  1   3,   G2   ,       .   G2,  <code>i</code>   0,      <code>i</code>   1,    G1        <code>i</code>  1.   ,       3- ,   2      <code>i</code>  2,    . ,   ,       <code>i</code>  1000.</p><br>
<p>  ,       ,        ,     .   <code>i = i + 1</code>   ,    Go   ?</p><br>
<p>     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">stackoverflow</a>.          Go        .</p><br>
<p>   ,     3    ,   . <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"></a> —    ,         .     ,        ,    ,     .   ,         .</p><br>
<p> Go  —   ,    <code>sync</code>.  Go      ,    <code>race condition</code>,    ,   <code>mutex.Lock()</code>.      <code>i = i + 1</code>    ,   ,   <code>mutext.Unlock()</code>.          <code>i</code>   ,       ,     .           <code>i</code>. ,   ,   <code>Lock</code>  <code>Unlock</code>,        ,      .</p><br>
<p>   ,  .</p><br>
<pre><code class="go hljs"><span class="hljs-keyword">package</span> main<font></font>
<font></font>
<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"fmt"</span>
    <span class="hljs-string">"sync"</span><font></font>
)<font></font>
<font></font>
<span class="hljs-keyword">var</span> i <span class="hljs-keyword">int</span> <span class="hljs-comment">// i == 0</span><font></font>
<font></font>
<span class="hljs-comment">// goroutine increment global variable i</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">worker</span><span class="hljs-params">(wg *sync.WaitGroup, m *sync.Mutex)</span></span> {<font></font>
    m.Lock() <span class="hljs-comment">// acquire lock</span>
    i = i + <span class="hljs-number">1</span>
    m.Unlock() <span class="hljs-comment">// release lock</span><font></font>
    wg.Done()<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">var</span> wg sync.WaitGroup
    <span class="hljs-keyword">var</span> m sync.Mutex<font></font>
<font></font>
    <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++ {<font></font>
        wg.Add(<span class="hljs-number">1</span>)
        <span class="hljs-keyword">go</span> worker(&amp;wg, &amp;m)<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">// wait until all 1000 goroutines are done</span><font></font>
    wg.Wait()<font></font>
<font></font>
    <span class="hljs-comment">// value of i should be 1000</span>
    fmt.Println(<span class="hljs-string">"value of i after 1000 operations is"</span>, i)<font></font>
}</code></pre><br>
<p>            ,       <code>i</code>,    ,  <code>m.Lock()</code>,      <code>i</code>   ,  <code>m.Unlock()</code>.      :</p><br>
<pre><code class="plaintext hljs">value of i after 1000 operations is 1000</code></pre><br>
<p>   ,      <code>race condition</code>.        .</p><br>
<blockquote>     <code>race condition</code>  Go,   <code>race</code>,   . <code>go run -race program.go</code>.       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"></a>.</blockquote><br>
<h2 id="patterny-konkurentnogo-programmirovaniya">  </h2><br>
<p>  ,         .      ,          .</p><br>
<h3 id="generator"></h3><br>
<p> ,      .         ,        .  ,    ,     . ,   .</p><br>
<pre><code class="go hljs"><span class="hljs-keyword">package</span> main<font></font>
<font></font>
<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span><font></font>
<font></font>
<span class="hljs-comment">// fib returns a channel which transports fibonacci numbers</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">fib</span><span class="hljs-params">(length <span class="hljs-keyword">int</span>)</span> &lt;-<span class="hljs-title">chan</span> <span class="hljs-title">int</span></span> {
    <span class="hljs-comment">// make buffered channel</span>
    c := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>, length)<font></font>
<font></font>
    <span class="hljs-comment">// run generation concurrently</span>
    <span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">for</span> i, j := <span class="hljs-number">0</span>, <span class="hljs-number">1</span>; i &lt; length; i, j = i+j, i {<font></font>
            c &lt;- i<font></font>
        }<font></font>
        <span class="hljs-built_in">close</span>(c)<font></font>
    }()<font></font>
<font></font>
    <span class="hljs-comment">// return channel</span>
    <span class="hljs-keyword">return</span> c<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// read 10 fibonacci numbers from channel returned by `fib` function</span>
    <span class="hljs-keyword">for</span> fn := <span class="hljs-keyword">range</span> fib(<span class="hljs-number">10</span>) {<font></font>
        fmt.Println(<span class="hljs-string">"Current fibonacci number is"</span>, fn)<font></font>
    }<font></font>
}</code></pre><br>
<pre><code class="plaintext hljs">Current fibonacci number is 0<font></font>
Current fibonacci number is 1<font></font>
Current fibonacci number is 1<font></font>
Current fibonacci number is 2<font></font>
Current fibonacci number is 3<font></font>
Current fibonacci number is 5<font></font>
Current fibonacci number is 8</code></pre><br>
<p>  fib,   ,      .    fib,        .           .   ,       .       <code>for</code>,      .  <code>main</code>,  <code>range</code>,    ,     <code>fib</code>.</p><br>
<h3 id="fan-in-i-fan-out">Fan-in  Fan-out</h3><br>
<p>Fan-in —   ,          . Fan-out —   ,        .</p><br>
<pre><code class="go hljs">
<span class="hljs-keyword">package</span> main<font></font>
<font></font>
<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"fmt"</span>
    <span class="hljs-string">"sync"</span><font></font>
)<font></font>
<font></font>
<span class="hljs-comment">// return channel for input numbers</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">getInputChan</span><span class="hljs-params">()</span> &lt;-<span class="hljs-title">chan</span> <span class="hljs-title">int</span></span> {
    <span class="hljs-comment">// make return channel</span>
    input := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>, <span class="hljs-number">100</span>)<font></font>
<font></font>
    <span class="hljs-comment">// sample numbers</span>
    numbers := []<span class="hljs-keyword">int</span>{<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>}<font></font>
<font></font>
    <span class="hljs-comment">// run goroutine</span>
    <span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">for</span> num := <span class="hljs-keyword">range</span> numbers {<font></font>
            input &lt;- num<font></font>
        }<font></font>
        <span class="hljs-comment">// close channel once all numbers are sent to channel</span>
        <span class="hljs-built_in">close</span>(input)<font></font>
    }()<font></font>
<font></font>
    <span class="hljs-keyword">return</span> input<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">// returns a channel which returns square of numbers</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">getSquareChan</span><span class="hljs-params">(input &lt;-<span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>)</span> &lt;-<span class="hljs-title">chan</span> <span class="hljs-title">int</span></span> {
    <span class="hljs-comment">// make return channel</span>
    output := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>, <span class="hljs-number">100</span>)<font></font>
<font></font>
    <span class="hljs-comment">// run goroutine</span>
    <span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> {
        <span class="hljs-comment">// push squares until input channel closes</span>
        <span class="hljs-keyword">for</span> num := <span class="hljs-keyword">range</span> input {<font></font>
            output &lt;- num * num<font></font>
        }<font></font>
<font></font>
        <span class="hljs-comment">// close output channel once for loop finishes</span>
        <span class="hljs-built_in">close</span>(output)<font></font>
    }()<font></font>
<font></font>
    <span class="hljs-keyword">return</span> output<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">// returns a merged channel of `outputsChan` channels</span>
<span class="hljs-comment">// this produce fan-in channel</span>
<span class="hljs-comment">// this is variadic function</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">merge</span><span class="hljs-params">(outputsChan ...&lt;-<span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>)</span> &lt;-<span class="hljs-title">chan</span> <span class="hljs-title">int</span></span> {
    <span class="hljs-comment">// create a WaitGroup</span>
    <span class="hljs-keyword">var</span> wg sync.WaitGroup<font></font>
<font></font>
    <span class="hljs-comment">// make return channel</span>
    merged := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>, <span class="hljs-number">100</span>)<font></font>
<font></font>
    <span class="hljs-comment">// increase counter to number of channels `len(outputsChan)`</span>
    <span class="hljs-comment">// as we will spawn number of goroutines equal to number of channels received to merge</span>
    wg.Add(<span class="hljs-built_in">len</span>(outputsChan))<font></font>
<font></font>
    <span class="hljs-comment">// function that accept a channel (which sends square numbers)</span>
    <span class="hljs-comment">// to push numbers to merged channel</span>
    output := <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(sc &lt;-<span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>)</span></span> {
        <span class="hljs-comment">// run until channel (square numbers sender) closes</span>
        <span class="hljs-keyword">for</span> sqr := <span class="hljs-keyword">range</span> sc {<font></font>
            merged &lt;- sqr<font></font>
        }<font></font>
        <span class="hljs-comment">// once channel (square numbers sender) closes,</span>
        <span class="hljs-comment">// call `Done` on `WaitGroup` to decrement counter</span><font></font>
        wg.Done()<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">// run above `output` function as groutines, `n` number of times</span>
    <span class="hljs-comment">// where n is equal to number of channels received as argument the function</span>
    <span class="hljs-comment">// here we are using `for range` loop on `outputsChan` hence no need to manually tell `n`</span>
    <span class="hljs-keyword">for</span> _, optChan := <span class="hljs-keyword">range</span> outputsChan {
        <span class="hljs-keyword">go</span> output(optChan)<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">// run goroutine to close merged channel once done</span>
    <span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> {
        <span class="hljs-comment">// wait until WaitGroup finishes</span><font></font>
        wg.Wait()<font></font>
        <span class="hljs-built_in">close</span>(merged)<font></font>
    }()<font></font>
<font></font>
    <span class="hljs-keyword">return</span> merged<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// step 1: get input numbers channel</span>
    <span class="hljs-comment">// by calling `getInputChan` function, it runs a goroutine which sends number to returned channel</span><font></font>
    chanInputNums := getInputChan()<font></font>
<font></font>
    <span class="hljs-comment">// step 2: `fan-out` square operations to multiple goroutines</span>
    <span class="hljs-comment">// this can be done by calling `getSquareChan` function multiple times where individual function call returns a channel which sends square of numbers provided by `chanInputNums` channel</span>
    <span class="hljs-comment">// `getSquareChan` function runs goroutines internally where squaring operation is ran concurrently</span><font></font>
    chanOptSqr1 := getSquareChan(chanInputNums)<font></font>
    chanOptSqr2 := getSquareChan(chanInputNums)<font></font>
<font></font>
    <span class="hljs-comment">// step 3: fan-in (combine) `chanOptSqr1` and `chanOptSqr2` output to merged channel</span>
    <span class="hljs-comment">// this is achieved by calling `merge` function which takes multiple channels as arguments</span>
    <span class="hljs-comment">// and using `WaitGroup` and multiple goroutines to receive square number, we can send square numbers</span>
    <span class="hljs-comment">// to `merged` channel and close it</span><font></font>
    chanMergedSqr := merge(chanOptSqr1, chanOptSqr2)<font></font>
<font></font>
    <span class="hljs-comment">// step 4: let's sum all the squares from 0 to 9 which should be about `285`</span>
    <span class="hljs-comment">// this is done by using `for range` loop on `chanMergedSqr`</span>
    sqrSum := <span class="hljs-number">0</span><font></font>
<font></font>
    <span class="hljs-comment">// run until `chanMergedSqr` or merged channel closes</span>
    <span class="hljs-comment">// that happens in `merge` function when all goroutines pushing to merged channel finishes</span>
    <span class="hljs-comment">// check line no. 86 and 87</span>
    <span class="hljs-keyword">for</span> num := <span class="hljs-keyword">range</span> chanMergedSqr {<font></font>
        sqrSum += num<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">// step 5: print sum when above `for loop` is done executing which is after `chanMergedSqr` channel closes</span>
    fmt.Println(<span class="hljs-string">"Sum of squares between 0-9 is"</span>, sqrSum)<font></font>
}</code></pre><br>
<p>  .</p><br>
<ol>
<li>  <code>chanInputNums</code>,    <code>getInputChan</code>.  <code>getInputChan</code>       ,    ,     ,         <code>numbers</code>   .</li>
<li>   (fan-out)   (<code>chanOptSqr1</code>  <code>chanOptSqr2</code>),      <code>getSquareChan</code>.  <code>getSquareChan</code>       ,    ,             ,     .</li>
<li>      (fan-in),   <code>merge</code>.   <code>merge</code>   <code>WaitGroup</code>,    (<code>merged</code>),         <code>outputsChan</code>, ,        ,                <code>merged</code>,     ,        .          .            ,                   .       <code>merged</code>.</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kami membaca data dari saluran </font></font><code>chanMergedSqr</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">menggunakan </font></font><code>for</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dan </font></font><code>range</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, dan merangkum data yang diterima.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pada akhirnya, kami mendapatkan hasil kami.</font></font></li>
</ol><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Output Program:</font></font></p><br>
<pre><code class="plaintext hljs">Sum of squares between 0-9 is 285</code></pre><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MEMPERBARUI:</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Literatur lebih lanjut tentang saluran internal:</font></font></p><br>
<ol>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bagaimana saluran diatur di Go</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Di bawah tenda Golang - cara kerja saluran. </font><font style="vertical-align: inherit;">Bagian 1.</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Struktur kanal di Golang. </font><font style="vertical-align: inherit;">Bagian 2.</font></font></a></li>
</ol></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id490320/index.html">Membuat POSTGRESQL COUNT Lebih Cepat (*)</a></li>
<li><a href="../id490322/index.html">Namibia: infrastruktur dan apa yang perlu diketahui sebelum bepergian</a></li>
<li><a href="../id490324/index.html">Bagaimana kami menemukan kesalahan yang tidak terlihat dalam antarmuka tugas online untuk anak-anak</a></li>
<li><a href="../id490328/index.html">Profesi: Penguji</a></li>
<li><a href="../id490332/index.html">Kami membuat klon dari layanan pengiriman makanan menggunakan Nuxt.js, GraphQL, Strapi dan Stripe. Bagian 2/7</a></li>
<li><a href="../id490338/index.html">Dalam percobaan inovatif, fisikawan belajar menangkap atom individu.</a></li>
<li><a href="../id490340/index.html">Zen pergi</a></li>
<li><a href="../id490342/index.html">Apa yang kami pelajari dari pengujian sistem informasi negara</a></li>
<li><a href="../id490344/index.html">Siapa techlide dan mengapa tim membutuhkannya</a></li>
<li><a href="../id490346/index.html">Peran protokol MQTT dalam pengembangan Internet industri hal</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>