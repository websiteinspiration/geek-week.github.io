<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🎅🏿 👩🏻‍🎨 🏇🏼 Linux-Zeitsynchronisation: NTP, Chrony und systemd-timesyncd 👨🏽‍🤝‍👨🏻 🍜 💴</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Die meisten Leute verfolgen die Zeit. Wir stehen pünktlich auf, um unsere Morgenrituale durchzuführen und zur Arbeit zu gehen, eine Mittagspause einzu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Linux-Zeitsynchronisation: NTP, Chrony und systemd-timesyncd</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/vdsina/blog/505314/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/m-/ts/k3/m-tsk33gxcmkrlh4yuqdaxl4ytk.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die meisten Leute verfolgen die Zeit. </font><font style="vertical-align: inherit;">Wir stehen pünktlich auf, um unsere Morgenrituale durchzuführen und zur Arbeit zu gehen, eine Mittagspause einzulegen, die Projektfristen einzuhalten, Geburtstage und Feiertage zu feiern, in ein Flugzeug zu steigen und so weiter. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Außerdem: Einige von uns sind von Zeit besessen. </font><font style="vertical-align: inherit;">Meine Uhr wird mit Solarenergie betrieben und erhält die genaue Uhrzeit vom Nationalen Institut für Standards und Technologie ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NIST</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) in Fort Collins, Colorado, über </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WWVB Longwave Radio</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Zeitsignale werden mit der Atomuhr synchronisiert, die sich ebenfalls in Fort Collins befindet. </font><font style="vertical-align: inherit;">Mein Fitbit wird mit meinem Telefon synchronisiert, das mit dem </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NTP-</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Server </font><font style="vertical-align: inherit;">synchronisiert wird, der letztendlich mit der Atomuhr synchronisiert wird.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Geräte verfolgen auch die Zeit</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es gibt viele Gründe, warum unsere Geräte und Computer eine genaue Zeit benötigen. In Banken, Aktienmärkten und anderen Finanzunternehmen müssen Transaktionen beispielsweise in der richtigen Reihenfolge ausgeführt werden, und genaue Zeitabläufe sind dafür entscheidend. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unsere Telefone, Tablets, Autos, GPS-Systeme und Computer erfordern genaue Einstellungen für Uhrzeit und Datum. Ich möchte, dass die Uhr auf dem Desktop meines Computers die richtige Zeit anzeigt. Ich möchte, dass mein lokaler Kalender zum richtigen Zeitpunkt Erinnerungen enthält. Die richtige Zeit stellt auch sicher, dass die Cron- und Systemd-Jobs zum richtigen Zeitpunkt gestartet werden.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Datum und Uhrzeit sind auch für die Protokollierung wichtig, sodass es etwas einfacher ist, bestimmte Protokolle basierend auf Datum und Uhrzeit zu finden. </font><font style="vertical-align: inherit;">Ich habe zum Beispiel einmal bei DevOps gearbeitet (sie haben es damals nicht so genannt) und ein E-Mail-System in North Carolina eingerichtet. </font><font style="vertical-align: inherit;">Früher haben wir über 20 Millionen E-Mails pro Tag verarbeitet. </font><font style="vertical-align: inherit;">Das Verfolgen von E-Mails über eine Reihe von Servern oder das Bestimmen der genauen Reihenfolge von Ereignissen mithilfe von Protokolldateien auf geografisch verteilten Hosts kann viel einfacher sein, wenn die Computer rechtzeitig synchronisiert werden.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Einmal - viele Stunden</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Linux-Hosts müssen sich bewusst sein, dass es eine Systemzeit und eine RTC-Zeit gibt. RTC (Real Time Clock) ist ein etwas seltsamer und nicht sehr genauer Name für eine Hardware-Uhr. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Hardware-Uhr läuft kontinuierlich, auch wenn der Computer mit dem Akku auf der Hauptplatine des Systems ausgeschaltet wird. Die Hauptfunktion von RTC besteht darin, die Zeit zu speichern, zu der die Verbindung zum Zeitserver nicht verfügbar ist. In jenen Tagen, in denen es unmöglich war, über das Internet eine Verbindung zum Zeitserver herzustellen, musste jeder Computer über eine genaue interne Uhr verfügen. Betriebssysteme mussten beim Booten auf RTC zugreifen, und der Benutzer musste die Systemzeit manuell über die Hardware-BIOS-Konfigurationsoberfläche einstellen, um sicherzustellen, dass sie korrekt war.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hardware-Uhren verstehen das Konzept der Zeitzonen nicht. </font><font style="vertical-align: inherit;">RTC speichert nur die Zeit, nicht die Zeitzone oder den Versatz von UTC (Coordinated Universal Time, auch als GMT oder Greenwich Mean Time bezeichnet). </font><font style="vertical-align: inherit;">Sie können RTC mit dem Tool installieren, das ich später in diesem Artikel erläutern werde. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Systemzeit ist die Zeit, die das Betriebssystem auf der GUI-Uhr auf Ihrem Desktop in der Ausgabe des Datumsbefehls in den Zeitstempeln der Protokolle anzeigt. </font><font style="vertical-align: inherit;">Dies gilt auch für die Zeit, in der Dateien erstellt, geändert und geöffnet wurden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RTC-</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Manpage </font><font style="vertical-align: inherit;">enthält eine vollständige Beschreibung der RTC und der Systemuhr.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Was hat NTP?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Computer auf der ganzen Welt verwenden NTP (Network Time Protocol), um ihre Zeit mithilfe einer Hierarchie von NTP-Servern mit Standardreferenzuhren über das Internet zu synchronisieren. Die Hauptzeitserver befinden sich auf Ebene 1 und sind über Satellit, Radio oder sogar Modems über Telefonleitungen direkt mit verschiedenen nationalen Zeitdiensten auf Ebene 0 verbunden. Zeitdienste auf Ebene 0 können eine Atomuhr, ein Funkempfänger, der auf die von der Atomuhr übertragenen Signale abgestimmt ist, oder ein GPS-Empfänger sein, der hochpräzise Uhrensignale verwendet, die von GPS-Satelliten übertragen werden.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Auf der überwiegenden Mehrheit der Referenzserver sind mehrere tausend öffentliche NTP-Stratum-2-Server geöffnet, die allen zur Verfügung stehen. </font><font style="vertical-align: inherit;">Viele Organisationen und Benutzer (einschließlich mir) mit einer großen Anzahl von Hosts, für die ein NTP-Server erforderlich ist, bevorzugen die Installation eigener Zeitserver. Daher ruft nur ein lokaler Host Schicht 2 oder 3 auf. Anschließend konfigurieren sie die verbleibenden Knoten im Netzwerk für die Verwendung des lokalen Zeitservers . </font><font style="vertical-align: inherit;">Bei meinem Heimnetzwerk handelt es sich um einen Server der Stufe 3.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Verschiedene NTP-Implementierungen </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die anfängliche Implementierung von NTP ist ntpd. Dann kamen zwei neuere hinzu, chronyd und systemd-timesyncd. Alle drei synchronisieren die lokale Hostzeit mit dem NTP-Zeitserver. Der systemd-timesyncd-Dienst ist nicht so zuverlässig wie chronyd, dies reicht jedoch für die meisten Zwecke aus. Wenn RTC nicht synchronisiert ist, kann die Systemzeit für die Synchronisierung mit dem NTP-Server schrittweise angepasst werden, wenn die lokale Systemzeit geringfügig verschoben wird. Der systemd-timesync-Dienst kann nicht als Zeitserver verwendet werden. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chrony</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ist eine NTP-Implementierung, die zwei Programme enthält: den chronyd-Daemon und eine Befehlszeilenschnittstelle namens chronyc. Chrony hat einige Eigenschaften, die in vielen Fällen einfach unersetzlich sind:</font></font><br>
<br>
<ul>
<li>Chrony       ,    ntpd.       ,    .</li>
<li>     , ,           ,      -   ,       .</li>
<li>    ,        .</li>
<li>    .</li>
<li>    Chrony    .             .</li>
<li>Chrony       .          .</li>
<li>Chrony     NTP-.</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Noch einmal: NTP ist ein Protokoll, das mit Chrony oder systemd-timesyncd auf einem Linux-Host implementiert werden kann. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die RPM-Pakete NTP, Chrony und systemd-timesyncd sind in Standard-Fedora-Repositorys verfügbar. </font><font style="vertical-align: inherit;">RPM systemd-udev ist ein Kernel-Event-Manager, der standardmäßig in Fedora installiert ist, aber nicht benötigt wird. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sie können alle drei installieren und zwischen ihnen wechseln, dies verursacht jedoch zusätzliche Kopfschmerzen. </font><font style="vertical-align: inherit;">Also ist es besser, es nicht zu tun. </font><font style="vertical-align: inherit;">Aktuelle Versionen von Fedora, CentOS und RHEL wurden standardmäßig auf Chrony migriert und verfügen über systemd-timesyncd. </font><font style="vertical-align: inherit;">Ich glaube, dass Chrony gut funktioniert, eine bessere Schnittstelle als der NTP-Dienst bietet, viel mehr Informationen liefert und die Kontrolle erhöht, die Systemadministratoren sicherlich genießen werden.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NTP-Dienste deaktivieren </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Auf Ihrem Host wird möglicherweise bereits der NTP-Dienst ausgeführt. </font><font style="vertical-align: inherit;">In diesem Fall müssen Sie es deaktivieren, bevor Sie zu etwas anderem wechseln. </font><font style="vertical-align: inherit;">Ich hatte chronyd ausgeführt, also habe ich die folgenden Befehle verwendet, um es zu stoppen und zu deaktivieren. </font><font style="vertical-align: inherit;">Führen Sie die entsprechenden Befehle für jeden NTP-Dämon aus, den Sie auf Ihrem Host verwenden:</font></font><br>
<br>
<pre><code class="bash hljs">[root@testvm1 ~]<span class="hljs-comment"># systemctl disable chronyd ; systemctl stop chronyd</span><font></font>
Removed /etc/systemd/system/multi-user.target.wants/chronyd.service.<font></font>
[root@testvm1 ~]<span class="hljs-comment">#</span></code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Stellen Sie sicher, dass der Dienst gestoppt und deaktiviert ist:</font></font><br>
<br>
<pre><code class="bash hljs">[root@testvm1 ~]<span class="hljs-comment"># systemctl status chronyd</span><font></font>
● chronyd.service - NTP client/server<font></font>
     Loaded: loaded (/usr/lib/systemd/system/chronyd.service; disabled; vendor preset: enabled)<font></font>
     Active: inactive (dead)<font></font>
       Docs: man:chronyd(8)<font></font>
             man:chrony.conf(5)<font></font>
[root@testvm1 ~]<span class="hljs-comment">#</span></code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Überprüfen Sie den Status vor dem Start</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mit dem Synchronisierungsstatus der Systemuhr können Sie feststellen, ob der NTP-Dienst ausgeführt wird. </font><font style="vertical-align: inherit;">Da Sie NTP noch nicht gestartet haben, weist der Befehl timesync-status darauf hin:</font></font><br>
<br>
<pre><code class="bash hljs">[root@testvm1 ~]<span class="hljs-comment"># timedatectl timesync-status</span>
Failed to query server: Could not activate remote peer.</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eine direkte Statusanfrage liefert wichtige Informationen. </font><font style="vertical-align: inherit;">Beispielsweise führt der Befehl timedatectl ohne Argument oder Parameter den Unterbefehl Standardstatus aus:</font></font><br>
<br>
<pre><code class="bash hljs">[root@testvm1 ~]<span class="hljs-comment"># timedatectl status</span><font></font>
           Local time: Fri 2020-05-15 08:43:10 EDT  <font></font>
           Universal time: Fri 2020-05-15 12:43:10 UTC  <font></font>
                 RTC time: Fri 2020-05-15 08:43:08      <font></font>
                Time zone: America/New_York (EDT, -0400)<font></font>
System clock synchronized: no                          <font></font>
              NTP service: inactive                    <font></font>
          RTC <span class="hljs-keyword">in</span> <span class="hljs-built_in">local</span> TZ: yes                    <font></font>
<font></font>
Warning: The system is configured to <span class="hljs-built_in">read</span> the RTC time <span class="hljs-keyword">in</span> the <span class="hljs-built_in">local</span> time zone.<font></font>
         This mode cannot be fully supported. It will create various problems<font></font>
         with time zone changes and daylight saving time adjustments. The RTC<font></font>
         time is never updated, it relies on external facilities to maintain it.<font></font>
         If at all possible, use RTC <span class="hljs-keyword">in</span> UTC by calling
         <span class="hljs-string">'timedatectl set-local-rtc 0'</span>.<font></font>
[root@testvm1 ~]<span class="hljs-comment">#</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So erhalten Sie die Ortszeit für Ihren Host, die UTC-Zeit und die RTC-Zeit. In diesem Fall wird die Systemzeit auf die Zeitzone America / New_York (TZ) eingestellt, die RTC auf die Zeit in der lokalen Zeitzone und der NTP-Dienst ist nicht aktiv. Die RTC-Zeit begann leicht von der Systemzeit abzuweichen. Dies ist normal für Systeme, deren Uhren nicht synchronisiert wurden. Die Höhe des Offsets auf dem Host hängt von der Zeit ab, die seit der letzten Systemsynchronisation vergangen ist.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben auch eine Warnung bezüglich der Verwendung der Ortszeit für RTC erhalten - dies gilt für Änderungen in der Zeitzone und den Einstellungen für die Sommerzeit. </font><font style="vertical-align: inherit;">Wenn der Computer zu dem Zeitpunkt ausgeschaltet wird, an dem Änderungen erforderlich sind, ändert sich die RTC-Zeit nicht. </font><font style="vertical-align: inherit;">Für Server oder andere Hosts, die rund um die Uhr arbeiten, ist dies jedoch überhaupt kein Problem. </font><font style="vertical-align: inherit;">Darüber hinaus passt jeder Dienst, der eine NTP-Zeitsynchronisierung bereitstellt, die Hostzeit in der Anfangsphase des Startvorgangs an. Sobald der Startvorgang abgeschlossen ist, wird die Uhrzeit wieder korrekt.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zeitzoneneinstellung</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Normalerweise geben Sie die Zeitzone während des Installationsvorgangs an und haben keine Aufgabe, sie in Zukunft zu ändern. Es gibt jedoch Zeiten, in denen Sie die Zeitzone ändern müssen. Es gibt verschiedene Tools, die helfen können. Linux verwendet Zeitzonendateien, um die lokale Zeitzone des Hosts zu bestimmen. Diese Dateien befinden sich im </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Verzeichnis / usr / share / zoneinfo</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Standardmäßig schreibt das System für meine Zeitzone </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Folgendes</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font><b><font style="vertical-align: inherit;">/ etc / localtime -&gt; ../usr/share/zoneinfo/America/New_York</font></b><font style="vertical-align: inherit;"> . Sie müssen solche Feinheiten jedoch nicht kennen, um die Zeitzone zu ändern. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Hauptsache ist, den offiziellen Namen der Zeitzone für Ihren Standort und das entsprechende Team zu kennen. Angenommen, Sie möchten die Zeitzone in Los Angeles ändern:</font></font><br>
<br>
<pre><code class="bash hljs">
[root@testvm2 ~]<span class="hljs-comment"># timedatectl list-timezones | column</span><font></font>
&lt;SNIP&gt;<font></font>
America/La_Paz                  Europe/Budapest<font></font>
America/Lima                    Europe/Chisinau<font></font>
America/Los_Angeles             Europe/Copenhagen<font></font>
America/Maceio                  Europe/Dublin<font></font>
America/Managua                 Europe/Gibraltar<font></font>
America/Manaus                  Europe/Helsinki<font></font>
&lt;SNIP&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt können Sie die Zeitzone einstellen. </font><font style="vertical-align: inherit;">Ich habe den Befehl date verwendet, um nach Änderungen zu suchen, aber Sie können auch timedatectl verwenden:</font></font><br>
<br>
<pre><code class="bash hljs">[root@testvm2 ~]<span class="hljs-comment"># date</span><font></font>
Tue 19 May 2020 04:47:49 PM EDT<font></font>
[root@testvm2 ~]<span class="hljs-comment"># timedatectl set-timezone America/Los_Angeles</span>
[root@testvm2 ~]<span class="hljs-comment"># date</span><font></font>
Tue 19 May 2020 01:48:23 PM PDT<font></font>
[root@testvm2 ~]<span class="hljs-comment">#</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt können Sie die Zeitzone Ihres Hosts wieder auf Ortszeit ändern.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systemd-timesyncd</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Timesync-Dämon systemd bietet eine NTP-Implementierung, die im Kontext von systemd einfach zu verwalten ist. </font><font style="vertical-align: inherit;">Es ist standardmäßig in Fedora und Ubuntu installiert. </font><font style="vertical-align: inherit;">Es startet jedoch standardmäßig nur in Ubuntu. </font><font style="vertical-align: inherit;">Bei den anderen Distributionen bin ich mir nicht sicher. </font><font style="vertical-align: inherit;">Sie können selbst überprüfen:</font></font><br>
<br>
<pre><code class="bash hljs">[root@testvm1 ~]<span class="hljs-comment"># systemctl status systemd-timesyncd</span></code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Systemd-timesyncd konfigurieren</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Konfigurationsdatei für systemd-timesyncd lautet </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/systemd/timesyncd.conf</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Dies ist eine einfache Datei mit weniger Optionen als in den alten NTP- und Chronyd-Diensten. </font><font style="vertical-align: inherit;">Hier ist der Inhalt dieser Datei (ohne weitere Änderungen) auf meiner virtuellen Fedora-Maschine:</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-comment">#  This file is part of systemd.</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">#  systemd is free software; you can redistribute it and/or modify it</span>
<span class="hljs-comment">#  under the terms of the GNU Lesser General Public License as published by</span>
<span class="hljs-comment">#  the Free Software Foundation; either version 2.1 of the License, or</span>
<span class="hljs-comment">#  (at your option) any later version.</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># Entries in this file show the compile time defaults.</span>
<span class="hljs-comment"># You can change settings by editing this file.</span>
<span class="hljs-comment"># Defaults can be restored by simply deleting this file.</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># See timesyncd.conf(5) for details.</span><font></font>
<font></font>
[Time]<font></font>
<span class="hljs-comment">#NTP=</span>
<span class="hljs-comment">#FallbackNTP=0.fedora.pool.ntp.org 1.fedora.pool.ntp.org 2.fedora.pool.ntp.org 3.fedora.pool.ntp.org</span>
<span class="hljs-comment">#RootDistanceMaxSec=5</span>
<span class="hljs-comment">#PollIntervalMinSec=32</span>
<span class="hljs-comment">#PollIntervalMaxSec=2048</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der einzige Abschnitt, der es enthält, abgesehen von Kommentaren, ist [Zeit]. </font><font style="vertical-align: inherit;">Alle anderen Zeilen sind auskommentiert. </font><font style="vertical-align: inherit;">Dies sind die Standardwerte, sie müssen nicht geändert werden (es sei denn, Sie haben einen Grund dafür). </font><font style="vertical-align: inherit;">Wenn Sie den NTP-Zeitserver nicht in der Zeile NTP = definiert haben, verwendet Fedora standardmäßig den Fedora-Sicherungszeitserver. </font><font style="vertical-align: inherit;">Normalerweise füge ich meinen Zeitserver hinzu:</font></font><br>
<br>
<pre><code class="bash hljs">NTP=myntpserver</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Starten Sie timesync</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sie können systemd-timesyncd folgendermaßen starten und aktivieren:</font></font><br>
<br>
<pre><code class="bash hljs">[root@testvm2 ~]<span class="hljs-comment"># systemctl enable systemd-timesyncd.service</span><font></font>
Created symlink /etc/systemd/system/dbus-org.freedesktop.timesync1.service → /usr/lib/systemd/system/systemd-timesyncd.service.<font></font>
Created symlink /etc/systemd/system/sysinit.target.wants/systemd-timesyncd.service → /usr/lib/systemd/system/systemd-timesyncd.service.<font></font>
[root@testvm2 ~]<span class="hljs-comment"># systemctl start systemd-timesyncd.service</span>
[root@testvm2 ~]<span class="hljs-comment">#</span></code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Installation der Hardware-Uhr</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So sieht die Situation nach dem Ausführen von timesyncd aus:</font></font><br>
<br>
<pre><code class="bash hljs">[root@testvm2 systemd]<span class="hljs-comment"># timedatectl</span><font></font>
               Local time: Sat 2020-05-16 14:34:54 EDT  <font></font>
           Universal time: Sat 2020-05-16 18:34:54 UTC  <font></font>
                 RTC time: Sat 2020-05-16 14:34:53      <font></font>
                Time zone: America/New_York (EDT, -0400)<font></font>
System clock synchronized: yes                          <font></font>
              NTP service: active                      <font></font>
          RTC <span class="hljs-keyword">in</span> <span class="hljs-built_in">local</span> TZ: no    </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anfänglich überschreitet die Differenz zwischen RTC und Ortszeit (EDT) keine Sekunde, und die Diskrepanz nimmt in den nächsten Tagen um einige Sekunden zu. Da es in RTC kein Konzept für Zeitzonen gibt, muss der Befehl timedatectl einen Vergleich durchführen, um die gewünschte Zeitzone zu bestimmen. Wenn die RTC nicht genau mit der Ortszeit übereinstimmt, stimmt sie nicht mit der Ortszeitzone überein. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Auf der Suche nach weiteren Informationen habe ich den Status von systemd-timesync überprüft und Folgendes festgestellt:</font></font><br>
<br>
<pre><code class="bash hljs">[root@testvm2 systemd]<span class="hljs-comment"># systemctl status systemd-timesyncd.service</span><font></font>
● systemd-timesyncd.service - Network Time Synchronization<font></font>
     Loaded: loaded (/usr/lib/systemd/system/systemd-timesyncd.service; enabled; vendor preset: disabled)<font></font>
     Active: active (running) since Sat 2020-05-16 13:56:53 EDT; 18h ago<font></font>
       Docs: man:systemd-timesyncd.service(8)<font></font>
   Main PID: 822 (systemd-timesyn)<font></font>
     Status: <span class="hljs-string">"Initial synchronization to time server 163.237.218.19:123 (2.fedora.pool.ntp.org)."</span>
      Tasks: 2 (<span class="hljs-built_in">limit</span>: 10365)<font></font>
     Memory: 2.8M<font></font>
        CPU: 476ms<font></font>
     CGroup: /system.slice/systemd-timesyncd.service<font></font>
             └─822 /usr/lib/systemd/systemd-timesyncd<font></font>
<font></font>
May 16 09:57:24 testvm2.both.org systemd[1]: Starting Network Time Synchronization...<font></font>
May 16 09:57:24 testvm2.both.org systemd-timesyncd[822]: System clock time <span class="hljs-built_in">unset</span> or jumped backwards, restoring from recorded timestamp: Sat 2020-05-16 13:56:53 EDT<font></font>
May 16 13:56:53 testvm2.both.org systemd[1]: Started Network Time Synchronization.<font></font>
May 16 13:57:56 testvm2.both.org systemd-timesyncd[822]: Initial synchronization to time server 163.237.218.19:123 (2.fedora.pool.ntp.org).<font></font>
[root@testvm2 systemd]<span class="hljs-comment">#</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beachten Sie die Protokollmeldung, die besagt, dass die Systemzeit nicht eingestellt oder zurückgesetzt wird. </font><font style="vertical-align: inherit;">Der Timesync-Dienst legt die Systemzeit basierend auf einem Zeitstempel fest. </font><font style="vertical-align: inherit;">Zeitstempel werden vom timesync-Daemon verwaltet und bei jeder erfolgreichen Synchronisierung erstellt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Befehl timedatectl kann den Wert der Hardware-Uhr nicht von der Systemuhr übernehmen. </font><font style="vertical-align: inherit;">Sie kann Uhrzeit und Datum nur anhand des in der Befehlszeile eingegebenen Werts einstellen. </font><font style="vertical-align: inherit;">Mit dem Befehl hwclock können Sie RTC auf den gleichen Wert wie die Systemzeit einstellen:</font></font><br>
<br>
<pre><code class="bash hljs">[root@testvm2 ~]<span class="hljs-comment"># /sbin/hwclock --systohc --localtime</span>
[root@testvm2 ~]<span class="hljs-comment"># timedatectl</span><font></font>
               Local time: Mon 2020-05-18 13:56:46 EDT  <font></font>
           Universal time: Mon 2020-05-18 17:56:46 UTC  <font></font>
                 RTC time: Mon 2020-05-18 13:56:46      <font></font>
                Time zone: America/New_York (EDT, -0400)<font></font>
System clock synchronized: yes                          <font></font>
              NTP service: active                      <font></font>
          RTC <span class="hljs-keyword">in</span> <span class="hljs-built_in">local</span> TZ: yes</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Option --localtime gibt an, dass die Hardwareuhr die Ortszeit und nicht die UTC anzeigt.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Warum brauchst du überhaupt RTC?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bei jeder NTP-Implementierung wird die Systemuhr beim Start eingestellt. </font><font style="vertical-align: inherit;">Und warum dann RTC? </font><font style="vertical-align: inherit;">Dies ist nicht ganz richtig: Dies geschieht nur, wenn Sie eine Netzwerkverbindung zu einem Zeitserver haben. </font><font style="vertical-align: inherit;">Viele Systeme haben jedoch keinen ständigen Zugriff auf die Netzwerkverbindung, sodass die Hardware-Uhr für Linux nützlich ist, um die Systemzeit basierend auf ihnen festzulegen. </font><font style="vertical-align: inherit;">Dies ist besser als das manuelle Einstellen der Zeit, auch wenn sie von der Echtzeit abweichen kann.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fazit</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dieser Artikel beschreibt einige Tools zum Verwalten von Datum, Uhrzeit und Zeitzonen. Das Tool systemd-timesyncd bietet einen NTP-Client, der die Zeit auf einem lokalen Host mit einem NTP-Server synchronisieren kann. Systemd-timesyncd bietet jedoch keinen Serverdienst. Wenn Sie also einen NTP-Server in Ihrem Netzwerk benötigen, müssen Sie etwas anderes verwenden, z. B. Chrony, um als Server zu arbeiten. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich bevorzuge eine einzige Implementierung für alle Dienste in meinem Netzwerk, daher verwende ich Chrony. Wenn Sie keinen lokalen NTP-Server benötigen oder wenn es Ihnen nichts ausmacht, Chrony als Server und systemd-timesyncd als SNTP-Client zu verwenden. Wenn Sie mit der Funktionalität von systemd-timesyncd zufrieden sind, müssen Sie die zusätzlichen Funktionen von Chrony nicht als Client verwenden.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Noch ein Hinweis: Sie müssen keine systemd-Tools verwenden, um NTP zu implementieren. </font><font style="vertical-align: inherit;">Sie können die alte Version von ntpd, Chrony oder einer anderen NTP-Implementierung verwenden. </font><font style="vertical-align: inherit;">Schließlich besteht systemd aus einer Vielzahl von Diensten; </font><font style="vertical-align: inherit;">Viele von ihnen sind optional, sodass Sie sie deaktivieren und stattdessen etwas anderes verwenden können. </font><font style="vertical-align: inherit;">Dies ist kein riesiges monolithisches Monster. </font><font style="vertical-align: inherit;">Möglicherweise mögen Sie systemd oder Teile davon nicht, aber Sie müssen eine fundierte Entscheidung treffen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich mag die NTP-Implementierung in systemd, aber ich bevorzuge Chrony, weil es meinen Bedürfnissen besser entspricht. </font><font style="vertical-align: inherit;">Das ist Linux, Baby -)</font></font><br>
<br>
<hr><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Als Werbung</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
VDSina bietet </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Server für jede Aufgabe</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , eine große Auswahl an Betriebssystemen für die automatische Installation. Es ist möglich, jedes Betriebssystem von seiner eigenen </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ISO</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , einem praktischen </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bedienfeld mit</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> eigenem Design und täglicher Bezahlung </font><font style="vertical-align: inherit;">zu installieren </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Denken Sie daran, dass wir ewige Server haben, die definitiv zeitlos sind;)</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/9fa/cf4/a34/9facf4a348ef01048b4eb5e16ae66daa.png"></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de505298/index.html">Flug der Crew Dragon in Fotos und Video</a></li>
<li><a href="../de505300/index.html">Ölindustrie für Ingenieure, Programmierer, Mathematiker und die Masse der Arbeiter, Teil 1</a></li>
<li><a href="../de505302/index.html">10 Tipps zum Schaltungsdesign</a></li>
<li><a href="../de505306/index.html">Von Spielen zu E-Commerce-Projekten. Änderung des zweijährigen Programms von Technopark</a></li>
<li><a href="../de505310/index.html">Was zeichnet technologisch fortschrittliche Unternehmen aus und wie Techlide Ihrem Team helfen kann, zu wachsen</a></li>
<li><a href="../de505322/index.html">Dispatcher der Zukunft: Wie wird sich seine Rolle im Dienstleistungsunternehmen verändern?</a></li>
<li><a href="../de505330/index.html">So erstellen Sie in 3 Jahren keine Kryptowährung von Grund auf neu</a></li>
<li><a href="../de505336/index.html">Gewusst wie: Manet oder Monet? Neuronales Netz reagiert</a></li>
<li><a href="../de505340/index.html">Walmart-Mitarbeiter versuchen zu beweisen, dass Anti-Diebstahl-KI nicht funktioniert</a></li>
<li><a href="../de505342/index.html">Die Abhängigkeitsinjektion und das Prinzip der Abhängigkeitsinversion sind NICHT EIN UND GLEICH</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>