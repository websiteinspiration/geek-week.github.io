<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚óæÔ∏è üë©üèø‚Äçüî¨ üöµüèæ Watch DOOM di ESP32. Bagian 1 üß• üö∑ üçà</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Setelah mencoba pengembangan dengan modul ESP32 yang sudah jadi, saya ingin melakukan sesuatu yang kecil dan asli. Saya memutuskan untuk membuat arloj...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Watch DOOM di ESP32. Bagian 1</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/494748/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Setelah mencoba pengembangan dengan modul ESP32 yang sudah jadi, saya ingin melakukan sesuatu yang kecil dan asli. </font><font style="vertical-align: inherit;">Saya memutuskan untuk membuat arloji. </font><font style="vertical-align: inherit;">Awalnya saya berpikir tentang </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ESP32-PICO-D4</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Karena hanya memiliki 4 MB flash untuk program ini, saya memutuskan untuk membuat versi lengkap dengan ekstensi hingga 16 MB flash dan 8 MB SRAM. </font><font style="vertical-align: inherit;">Apa pun jamnya, Anda dapat menjalankan Doom pertama. </font><font style="vertical-align: inherit;">Secara umum, itu semua isian penuh! </font></font><br>
<br>
<img src="https://habrastorage.org/webt/r0/tm/qh/r0tmqhwcgq1geu0iyijuroahpvq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apa yang belum dilakukan atau perlu perbaikan:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Indikator baterai</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Sirkuit charging Charging diimplementasikan pada Schottky diode</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Antena tidak terletak dengan baik di lapisan lain dari ESP32</font></font><br>
</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bukan tutorial!</font></font><br>
<br>
<img src="https://habrastorage.org/webt/bw/cn/gr/bwcngruk2zywo5wuqk-zvco4toq.jpeg"><br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dengan tampilan</font></font></h3><br>
<img width="400" src="https://habrastorage.org/webt/y-/0a/rp/y-0arpnjd4fsidh22irudjow-qg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya menerapkan layar warna pada pengontrol ST7789 dengan resolusi 240x240. </font><font style="vertical-align: inherit;">Cukup ringkas dan murah. </font><font style="vertical-align: inherit;">Semakin banyak driver dan port yang muncul di jaringan. </font><font style="vertical-align: inherit;">Misalnya, ada port untuk </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LittlevGL</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , tetapi tidak ada gerobak dorong pada tampilan ini. </font><font style="vertical-align: inherit;">Saya pikir itu bisa dibeli dan direkatkan. </font><font style="vertical-align: inherit;">Mungkin seseorang memiliki pengalaman? </font><font style="vertical-align: inherit;">Share. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya mengembangkan satu papan di ST7789 dan itu dimulai tanpa masalah.</font></font><br>
<br>
<img width="500" src="https://habrastorage.org/webt/fw/ic/mc/fwicmcivnyq44nxvhwqpjqrlsco.jpeg"><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LittlevGL esp32</font></font></b>
                        <div class="spoiler_text"><iframe width="560" height="315" src="https://www.youtube.com/embed/15qrV2CNSoQ" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
</div>
                    </div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dengan mengisi program dan men-debug</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya menggunakan </font><font style="vertical-align: inherit;">konverter </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BRIDGE USB-TO-UART</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> CP2102. </font><font style="vertical-align: inherit;">Pertama, itu kompak dan kedua, diagram koneksi sangat sederhana dan hampir tidak ada bagian tambahan yang diperlukan.</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Opsi 2: Kapasitor 4,7 ŒºF dapat ditambahkan jika memberi daya pada perangkat lain dari regulator on-chip.</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jika Anda menghubungkan REGIN dan VBUS ke catu daya USB 5V, Anda hanya akan memerlukan kapasitor shunt di input. </font><font style="vertical-align: inherit;">Meskipun saya pikir itu bisa bekerja tanpanya. </font><font style="vertical-align: inherit;">VDD pada sebuah chip dalam hal ini adalah jalan keluarnya! </font><font style="vertical-align: inherit;">Saya membuat kesalahan dan menghubungkannya ke rangkaian daya 3.3V dan tidak bisa mengerti mengapa saya memiliki 4.65V pada catu daya ?! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tautan dalam dokumentasi di bawah ini memiliki opsi untuk menghubungkan ke daya 3.3V. </font><font style="vertical-align: inherit;">Tapi saya pikir sama sekali tidak perlu menyalakan CP2102 ketika kita tidak perlu mengunggah atau men-debug perangkat</font></font><br>
<br>
<img src="https://habrastorage.org/webt/yy/-k/go/yy-kgo5r6igfhil55qe7zg2j7wu.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pengisian baterai modulo</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Resistor pada LTC4054 mengatur arus pengisian:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/rd/ex/5q/rdex5qbeqitjred4al5o0c267ju.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nutrisi</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Didukung oleh baterai 3.7V dengan stabilizer HT7833. Output 500mA saat ini. Ini memiliki drop tegangan kecil ~ 300mV. LD1117-3.3 memiliki "sedikit" lebih banyak. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Catatan tentang kesimpulan VDD_SDIO. Output catu daya pin ini adalah 1.8V atau 3.3V, tergantung pada keadaan mikrokontroler IO12 </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">saat startup</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . 3.3V GPIO12 adalah 0 (standar)</font></font><br>
<blockquote>VDD_SDIO works as the power supply for the related IO, and also for an external device.<br>
<br>
When VDD_SDIO operates at 1.8 V, it can be generated from ESP32‚Äôs internal LDO. The maximum currentthis LDO can offer is 40 mA, and the output voltage range is 1.65 V~2.0 V. <br>
<br>
When the VDD_SDIO outputs 1.8 V, the value of GPIO12 should be set to 1 when the chip boots and it is recommended that users add a2 k‚Ñ¶ ground resistor and a 4.7 mF filter capacitor close to VDD_SDIO.<br>
<br>
When VDD_SDIO operates at 3.3 V, it is driven directly by VDD3P3_RTC through a 6‚Ñ¶resistor, therefore,there will be some voltage drop from VDD3P3_RTC. <br>
<br>
When the VDD_SDIO outputs 3.3 V, the value of GPIO12 is 0 (default) when the chip boots and it is recommended that users add a 1mF capacitor close to VDD_SDIO<br>
</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ini sangat nyaman jika Anda memiliki flash 1.8V. </font><font style="vertical-align: inherit;">Tetapi dalam kasus saya, saya mencetak kesimpulan ini dan menghubungkan flash 3V3 dan PSRAM saya ke catu daya </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
umum.Beberapa modul ESP32 menggunakan VDD_SDIO, oleh karena itu saya tidak dapat menggantung apa pun dari periferal pada IO12 saat startup. </font><font style="vertical-align: inherit;">Anda dapat, misalnya, menggantung tombol. </font><font style="vertical-align: inherit;">Dalam salah satu solusi saya, saya menggantung kaki SPI pada IO12 dan modul tidak memulai. </font><font style="vertical-align: inherit;">Rupanya IO12 mendapat unit dari port SPI ini, tetapi saya membutuhkan 0 atau sebaliknya. </font><font style="vertical-align: inherit;">Ini harus diperhitungkan! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bersama:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/cx/-o/ku/cx-oku_wxajemjbyrjrilqm0xpc.png" alt="gambar"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8MB PSRAM</font></font></h3><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8MB PSRAM Upgrade Mod </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dukungan untuk RAM eksternal</font></font></a><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PSRAM / CE (pin 1)&gt; ESP32 GPIO 16 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PSRAM SO (pin 2)&gt; flash DO </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PSRAM SIO [2] (pin 3)&gt; flash WP </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PSRAM SI (pin 5)&gt; flash DI </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PSRAM SCLK (pin 6)&gt; ESP32 GPIO 17 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PSRAM SIO [3] (pin 7)&gt; flash HOLD </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PSRAM Vcc (pin 8)&gt; ESP32 VCC_SDIO</font></font></blockquote><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Antena PCB</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya menggunakan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">antena PCB Ukuran Kecil 2,4 GHz</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Itu ada di perpustakaan Eagle Autodesk dan menempati area kecil. </font><font style="vertical-align: inherit;">Anda mungkin dapat menggunakan ANTENA KERAMIK DIELEKTRIK tetapi Anda harus membelinya, dan harga antena PCB sedikit lebih sibuk. </font><font style="vertical-align: inherit;">Namun, antena keramik kurang efektif. </font><font style="vertical-align: inherit;">Opsi apa pun Pilihan </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Antena Panduan Cepat </font></font></a><font style="vertical-align: inherit;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">Desain Antena dan Panduan Tata Letak RF</font></a><font style="vertical-align: inherit;"> cocok untuk memeriksa konsep.</font></font><br>
<br>
<img width="400" src="https://habrastorage.org/webt/m9/0b/lq/m90blqi_al7oqlx6cgobpazbk4c.png" alt="gambar"><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sedikit tentang mencocokkan antena</font></font></h3><br>
<img src="https://habrastorage.org/webt/py/o-/lx/pyo-lxfj7y7lu51eltxs_f3u-mm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pedoman Desain ESP32 Hardware</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pada halaman 7 memberikan pedoman untuk menerapkan filter RF:</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Impedansi keluaran pin RF ESP32 (QFN 6 * 6) dan ESP32 (QFN 5 * 5) masing-masing adalah (30 + j10) Œ© dan (35 + j10) Œ©, masing-masing</font></font><br>
</blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Untuk menghitung, gunakan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alat Bagan Smith Online</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Ide utamanya adalah untuk sampai ke pusat lingkaran di (30 + j10). Namun, ini adalah data yang dihitung dan penggunaan parameter yang sebenarnya dapat dipengaruhi oleh ketebalan trek dan PCB, serta lokasi relatif terhadap komponen sirkuit lainnya. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/mb/lw/w2/mblww2rcjw5h5otg0bwgbfoqhgw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ini bukan satu-satunya sirkuit pencocokan antena. Sebagai contoh, pencocokan pada papan esp32-pic sedikit berbeda: </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">esp32-pico-kit-v4_schematic </font></font></a><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Smith Chart dan Impedance Matching</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Lokasi antena dan area bebas di sekitarnya juga penting. Seperti yang saya tulis sebelumnya, dalam kasus saya, posisi tidak dipilih secara optimal. Tetapi untuk iterasi pertama papan dan verifikasi konsep, bagian </font></font><br>
<br>
<img src="https://habrastorage.org/webt/2y/sk/me/2yskmeit4qo4hv0fhldmyq0xgpq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
kedua akan dikhususkan untuk papan itu sendiri dan porting perangkat lunak ketiga. Mungkin semuanya cocok menjadi satu.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya akan sedikit maju tentang </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Doom</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> port </font><font style="vertical-align: inherit;">dari Espressif Systems. </font><font style="vertical-align: inherit;">Port menggunakan ILI9341, kami memiliki ST7789. </font><font style="vertical-align: inherit;">Tetapi karena inisialisasi dan output dari buffer dikeluarkan dalam file yang terpisah dan dibagi menjadi metode yang terpisah, adaptasi ke tampilan saya seharusnya tidak menyebabkan kesulitan besar.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ili_init dan displayTask bertanggung jawab untuk menginisialisasi tampilan</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DisplayTask bertanggung jawab atas tampilan.</font></font></li>
</ul><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">displayTask</font></font></b>
                        <div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> IRAM_ATTR <span class="hljs-title">displayTask</span><span class="hljs-params">(<span class="hljs-keyword">void</span> *arg)</span> </span>{
	<span class="hljs-keyword">int</span> x, i;
	<span class="hljs-keyword">int</span> idx=<span class="hljs-number">0</span>;
	<span class="hljs-keyword">int</span> inProgress=<span class="hljs-number">0</span>;
	<span class="hljs-keyword">static</span> <span class="hljs-keyword">uint16_t</span> *dmamem[NO_SIM_TRANS];
	<span class="hljs-keyword">spi_transaction_t</span> trans[NO_SIM_TRANS];
	<span class="hljs-keyword">spi_transaction_t</span> *rtrans;<font></font>
<font></font>
    <span class="hljs-keyword">esp_err_t</span> ret;
    <span class="hljs-keyword">spi_bus_config_t</span> buscfg={<font></font>
        .miso_io_num=<span class="hljs-number">-1</span>,<font></font>
        .mosi_io_num=PIN_NUM_MOSI,<font></font>
        .sclk_io_num=PIN_NUM_CLK,<font></font>
        .quadwp_io_num=<span class="hljs-number">-1</span>,<font></font>
        .quadhd_io_num=<span class="hljs-number">-1</span>,<font></font>
        .max_transfer_sz=(MEM_PER_TRANS*<span class="hljs-number">2</span>)+<span class="hljs-number">16</span><font></font>
    };<font></font>
    <span class="hljs-keyword">spi_device_interface_config_t</span> devcfg={<font></font>
        .clock_speed_hz=<span class="hljs-number">26000000</span>,               <span class="hljs-comment">//Clock out at 26 MHz. Yes, that's heavily overclocked.</span>
        .mode=<span class="hljs-number">0</span>,                                <span class="hljs-comment">//SPI mode 0</span>
        .spics_io_num=PIN_NUM_CS,               <span class="hljs-comment">//CS pin</span>
        .queue_size=NO_SIM_TRANS,               <span class="hljs-comment">//We want to be able to queue this many transfers</span>
        .pre_cb=ili_spi_pre_transfer_callback,  <span class="hljs-comment">//Specify pre-transfer callback to handle D/C line</span><font></font>
    };<font></font>
<font></font>
	<span class="hljs-built_in">printf</span>(<span class="hljs-string">"*** Display task starting.\n"</span>);<font></font>
<font></font>
    <span class="hljs-comment">//Initialize the SPI bus</span>
    ret=spi_bus_initialize(HSPI_HOST, &amp;buscfg, <span class="hljs-number">1</span>);<font></font>
    assert(ret==ESP_OK);<font></font>
    <span class="hljs-comment">//Attach the LCD to the SPI bus</span><font></font>
    ret=spi_bus_add_device(HSPI_HOST, &amp;devcfg, &amp;spi);<font></font>
    assert(ret==ESP_OK);<font></font>
    <span class="hljs-comment">//Initialize the LCD</span><font></font>
    ili_init(spi);<font></font>
<font></font>
	<span class="hljs-comment">//We're going to do a fair few transfers in parallel. Set them all up.</span>
	<span class="hljs-keyword">for</span> (x=<span class="hljs-number">0</span>; x&lt;NO_SIM_TRANS; x++) {<font></font>
		dmamem[x]=pvPortMallocCaps(MEM_PER_TRANS*<span class="hljs-number">2</span>, MALLOC_CAP_DMA);<font></font>
		assert(dmamem[x]);<font></font>
		<span class="hljs-built_in">memset</span>(&amp;trans[x], <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">spi_transaction_t</span>));<font></font>
		trans[x].length=MEM_PER_TRANS*<span class="hljs-number">2</span>;<font></font>
		trans[x].user=(<span class="hljs-keyword">void</span>*)<span class="hljs-number">1</span>;<font></font>
		trans[x].tx_buffer=&amp;dmamem[x];<font></font>
	}<font></font>
	xSemaphoreGive(dispDoneSem);<font></font>
<font></font>
	<span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>) {<font></font>
		xSemaphoreTake(dispSem, portMAX_DELAY);<font></font>
<span class="hljs-comment">//		printf("Display task: frame.\n");</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">ifndef</span> DOUBLE_BUFFER</span>
		<span class="hljs-keyword">uint8_t</span> *myData=(<span class="hljs-keyword">uint8_t</span>*)currFbPtr;
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><font></font>
<font></font>
		send_header_start(spi, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">320</span>, <span class="hljs-number">240</span>);<font></font>
		send_header_cleanup(spi);<font></font>
		<span class="hljs-keyword">for</span> (x=<span class="hljs-number">0</span>; x&lt;<span class="hljs-number">320</span>*<span class="hljs-number">240</span>; x+=MEM_PER_TRANS) {
<span class="hljs-meta">#<span class="hljs-meta-keyword">ifdef</span> DOUBLE_BUFFER</span>
			<span class="hljs-keyword">for</span> (i=<span class="hljs-number">0</span>; i&lt;MEM_PER_TRANS; i+=<span class="hljs-number">4</span>) {
				<span class="hljs-keyword">uint32_t</span> d=currFbPtr[(x+i)/<span class="hljs-number">4</span>];<font></font>
				dmamem[idx][i+<span class="hljs-number">0</span>]=lcdpal[(d&gt;&gt;<span class="hljs-number">0</span>)&amp;<span class="hljs-number">0xff</span>];<font></font>
				dmamem[idx][i+<span class="hljs-number">1</span>]=lcdpal[(d&gt;&gt;<span class="hljs-number">8</span>)&amp;<span class="hljs-number">0xff</span>];<font></font>
				dmamem[idx][i+<span class="hljs-number">2</span>]=lcdpal[(d&gt;&gt;<span class="hljs-number">16</span>)&amp;<span class="hljs-number">0xff</span>];<font></font>
				dmamem[idx][i+<span class="hljs-number">3</span>]=lcdpal[(d&gt;&gt;<span class="hljs-number">24</span>)&amp;<span class="hljs-number">0xff</span>];<font></font>
			}<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">else</span></span>
			<span class="hljs-keyword">for</span> (i=<span class="hljs-number">0</span>; i&lt;MEM_PER_TRANS; i++) {<font></font>
				dmamem[idx][i]=lcdpal[myData[i]];<font></font>
			}<font></font>
			myData+=MEM_PER_TRANS;<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span>
			trans[idx].length=MEM_PER_TRANS*<span class="hljs-number">16</span>;<font></font>
			trans[idx].user=(<span class="hljs-keyword">void</span>*)<span class="hljs-number">1</span>;<font></font>
			trans[idx].tx_buffer=dmamem[idx];<font></font>
			ret=spi_device_queue_trans(spi, &amp;trans[idx], portMAX_DELAY);<font></font>
			assert(ret==ESP_OK);<font></font>
<font></font>
			idx++;<font></font>
			<span class="hljs-keyword">if</span> (idx&gt;=NO_SIM_TRANS) idx=<span class="hljs-number">0</span>;<font></font>
<font></font>
			<span class="hljs-keyword">if</span> (inProgress==NO_SIM_TRANS<span class="hljs-number">-1</span>) {<font></font>
				ret=spi_device_get_trans_result(spi, &amp;rtrans, portMAX_DELAY);<font></font>
				assert(ret==ESP_OK);<font></font>
			} <span class="hljs-keyword">else</span> {<font></font>
				inProgress++;<font></font>
			}<font></font>
		}<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">ifndef</span> DOUBLE_BUFFER</span><font></font>
		xSemaphoreGive(dispDoneSem);<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span>
		<span class="hljs-keyword">while</span>(inProgress) {<font></font>
			ret=spi_device_get_trans_result(spi, &amp;rtrans, portMAX_DELAY);<font></font>
			assert(ret==ESP_OK);<font></font>
			inProgress--;<font></font>
		}<font></font>
	}<font></font>
}<font></font>
</code></pre><br>
</div>
                    </div><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Demo cepat Video Esp32-Doom</font></font></b>
                        <div class="spoiler_text"><iframe width="560" height="315" src="https://www.youtube.com/embed/Gb_JFDa0AIo" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
</div>
                    </div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pesanan untuk papan telah dikirim ke pabrik Jlcpcb. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tantangan Diluncurkan!</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id494728/index.html">Metode otomatisasi tirai paling terjangkau</a></li>
<li><a href="../id494730/index.html">Wawancara dengan Amusa Buminasan</a></li>
<li><a href="../id494732/index.html">Pemelihara perpustakaan JS paling populer dijatuhi hukuman penjara karena kecelakaan fatal karena kesalahannya</a></li>
<li><a href="../id494736/index.html">Apa yang disampaikan oleh blog penerbit tentang tren komunitas TI</a></li>
<li><a href="../id494738/index.html">Ansible bukan bash untuk Anda. Sergey Pechenko</a></li>
<li><a href="../id494750/index.html">Teori warna, kontras</a></li>
<li><a href="../id494754/index.html">Acara digital di Moskow dari 30 Maret hingga 5 April</a></li>
<li><a href="../id494762/index.html">50 aplikasi untuk organisasi kerja jarak jauh yang efektif</a></li>
<li><a href="../id494766/index.html">Tren teknologi komunikasi masa depan</a></li>
<li><a href="../id494772/index.html">Bagaimana perang melawan panggilan robot berkembang di AS - pada ukuran politisi dan perusahaan telekomunikasi</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>