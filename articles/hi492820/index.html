<!doctype html>
<html class="no-js" lang="hi">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯЩЖЁЯП┐ ЁЯзЧ ЁЯНл .Net Core Api: рд╡рд┐рднрд┐рдиреНрди рд╕реНрд░реЛрддреЛрдВ рд╕реЗ рдЕрдиреБрд░реЛрдз рдореЗрдВ рдбреЗрдЯрд╛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ ЁЯСОЁЯП╝ ЁЯджЁЯП┐ ЁЯЩЖЁЯП╝</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content=".Net рдХреЛрд░ рдореЗрдВ рдПрдХ рдЕрдВрддрд░реНрдирд┐рд╣рд┐рдд рдореЙрдбрд▓ рдмрд╛рдЗрдВрдбрд┐рдВрдЧ рддрдВрддреНрд░ рд╣реИ, рдЬреЛ рди рдХреЗрд╡рд▓ рдирд┐рдпрдВрддреНрд░рдХреЛрдВ рдореЗрдВ рдЗрдирдкреБрдЯ рдорд╛рдкрджрдВрдбреЛрдВ рдХреЛ рд╕реНрд╡реАрдХрд╛рд░ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ, рдмрд▓реНрдХрд┐ рддреБрд░рдВрдд рднрд░реЗ рд╣реБрдП рдХреНрд╖реЗ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>.Net Core Api: рд╡рд┐рднрд┐рдиреНрди рд╕реНрд░реЛрддреЛрдВ рд╕реЗ рдЕрдиреБрд░реЛрдз рдореЗрдВ рдбреЗрдЯрд╛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/492820/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.Net рдХреЛрд░ рдореЗрдВ рдПрдХ рдЕрдВрддрд░реНрдирд┐рд╣рд┐рдд рдореЙрдбрд▓ рдмрд╛рдЗрдВрдбрд┐рдВрдЧ рддрдВрддреНрд░ рд╣реИ, рдЬреЛ рди рдХреЗрд╡рд▓ рдирд┐рдпрдВрддреНрд░рдХреЛрдВ рдореЗрдВ рдЗрдирдкреБрдЯ рдорд╛рдкрджрдВрдбреЛрдВ рдХреЛ рд╕реНрд╡реАрдХрд╛рд░ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ, рдмрд▓реНрдХрд┐ рддреБрд░рдВрдд рднрд░реЗ рд╣реБрдП рдХреНрд╖реЗрддреНрд░реЛрдВ рд╕реЗ рд╡рд╕реНрддреБрдУрдВ рдХреЛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдпрд╣ рдЖрдкрдХреЛ рдореЙрдбрд▓ рд╡реИрдзрддрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╕рднреА рдЖрд╡рд╢реНрдпрдХ рдЬрд╛рдВрдЪреЛрдВ рдХреЛ рдРрд╕реЗ рдСрдмреНрдЬреЗрдХреНрдЯ рдореЗрдВ рдПрдореНрдмреЗрдб рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдпрд╣рд╛рдВ рдПрдкреАрдЖрдИ рдХреЗ рд▓рд┐рдП рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рдбреЗрдЯрд╛ рд╣реИрдВ, рди рдХреЗрд╡рд▓ рдХреНрд╡реЗрд░реА рдпрд╛ рдмреЙрдбреА рд╕реЗ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдЖрдПрдВред </font><font style="vertical-align: inherit;">рдХреБрдЫ рдбреЗрдЯрд╛ рдХреЛ рд╣реЗрдбрд░ рд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ (рдореЗрд░реЗ рдорд╛рдорд▓реЗ рдореЗрдВ рдмреЗрд╕ 64 рдореЗрдВ json рдерд╛), рдХреБрдЫ рдбреЗрдЯрд╛ рдмрд╛рд╣рд░реА рд╕реЗрд╡рд╛рдУрдВ рдпрд╛ рдПрдХреНрд╢рдирд░реАрдЯ рд╕реЗ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП рдпрджрд┐ рдЖрдк REST рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рд╡рд╣рд╛рдВ рд╕реЗ рдбреЗрдЯрд╛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдк рдЕрдкрдиреА рдмрд╛рдЗрдВрдбрд┐рдВрдЧ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рд╕рдЪ рд╣реИ, рдПрдХ рд╕рдорд╕реНрдпрд╛ рд╣реИ: рдпрджрд┐ рдЖрдк рдирд┐рд░реНрдорд╛рдг рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЗрдирдХреИрдкреНрд╕реБрд▓реЗрд╢рди рдХреЛ рддреЛрдбрд╝рдиреЗ рдФрд░ рдореЙрдбрд▓ рдХреЛ рдЗрдирд┐рд╢рд┐рдпрд▓рд╛рдЗрдЬрд╝ рдирд╣реАрдВ рдХрд░рдиреЗ рдХрд╛ рдирд┐рд░реНрдгрдп рд▓реЗрддреЗ рд╣реИрдВ, рддреЛ рдЖрдкрдХреЛ рд╢рд░реНрдорд╕рд╛рд░ рд╣реЛрдирд╛ рдкрдбрд╝реЗрдЧрд╛ред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЕрдкрдиреЗ рд▓рд┐рдП рдФрд░ рдЖрдиреЗ рд╡рд╛рд▓реА рдкреАрдврд╝рд┐рдпреЛрдВ рдХреЗ рд▓рд┐рдП, рдореИрдВрдиреЗ рдЗрд╕рдХреЗ рд╕рд╛рде рдмрд╛рдЗрдВрдбрд┐рдВрдЧ рдФрд░ рд╢рд░реНрдорд┐рдВрджрдЧреА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рдирд┐рд░реНрджреЗрд╢реЛрдВ рдХреЗ рд░реВрдк рдореЗрдВ рдХреБрдЫ рд▓рд┐рдЦрдиреЗ рдХрд╛ рдлреИрд╕рд▓рд╛ рдХрд┐рдпрд╛ред</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдореБрд╕реАрдмрдд</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдирд┐рдпрдВрддреНрд░рдХ рдХреБрдЫ рдЗрд╕ рддрд░рд╣ рджрд┐рдЦрддрд╛ рд╣реИ:</font></font><br>
<br>
<pre><code class="cs hljs">[<span class="hljs-meta">HttpGet</span>]
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task&lt;IActionResult&gt; <span class="hljs-title">GetSomeData</span>(<span class="hljs-params">[FromQuery[IncomeData someData</span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">var</span> moreData = GetFromHeaderAndDecode(<span class="hljs-string">"X-Property"</span>);
    <span class="hljs-keyword">if</span> (moreData.Id == <span class="hljs-number">0</span>)<font></font>
    {<font></font>
        <span class="hljs-keyword">return</span> StatusCode(<span class="hljs-number">400</span>, <span class="hljs-string">"Nginx doesnt know your id"</span>);<font></font>
    }<font></font>
    <span class="hljs-keyword">var</span> externalData = GetFromExternalService(<span class="hljs-string">"http://myservice.com/MoreData"</span>);
    <span class="hljs-keyword">if</span> (externalData == <span class="hljs-literal">null</span>)<font></font>
    {<font></font>
        <span class="hljs-keyword">return</span> StatusCode(<span class="hljs-number">500</span>, <span class="hljs-string">"Cant connect to external service"</span>);<font></font>
    }<font></font>
    <span class="hljs-keyword">var</span> finalData = <span class="hljs-keyword">new</span> FinalData(someData, moreData, externalData);
    <span class="hljs-keyword">return</span> _myService.Handle(finalData);<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдкрд░рд┐рдгрд╛рдорд╕реНрд╡рд░реВрдк, рд╣рдореЗрдВ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╕рдорд╕реНрдпрд╛рдПрдВ рдЖрддреА рд╣реИрдВ:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рддреНрдпрд╛рдкрди рддрд░реНрдХ рдХреЛ рдЕрдиреБрд░реЛрдз рдСрдмреНрдЬреЗрдХреНрдЯ, рд╣реЗрдбрд░ рд╕реЗ рдЕрдиреБрд░реЛрдз рд╡рд┐рдзрд┐, рд╕реЗрд╡рд╛ рд╕реЗ рдЕрдиреБрд░реЛрдз рд╡рд┐рдзрд┐ рдФрд░ рдирд┐рдпрдВрддреНрд░рдХ рд╡рд┐рдзрд┐ рджреНрд╡рд╛рд░рд╛ рд╕реНрдореАрдпрд░ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ рдЖрд╡рд╢реНрдпрдХ рдЬрд╛рдВрдЪ рдирд┐рд╢реНрдЪрд┐рдд рд░реВрдк рд╕реЗ рд╣реИ, рдЖрдкрдХреЛ рдкреВрд░реА рдЬрд╛рдВрдЪ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ!</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЖрд╕рдиреНрди рдирд┐рдпрдВрддреНрд░рдХ рд╡рд┐рдзрд┐ рдореЗрдВ рдмрд┐рд▓реНрдХреБрд▓ рд╕рдорд╛рди рдХреЛрдб рд╣реЛрдЧрд╛ред </font><font style="vertical-align: inherit;">рд╣рдорд▓реЗ рдореЗрдВ рдХреЙрдкреА-рдкреЗрд╕реНрдЯ рдкреНрд░реЛрдЧреНрд░рд╛рдорд┐рдВрдЧред</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЖрдорддреМрд░ рдкрд░ рдЙрджрд╛рд╣рд░рдг рдХреА рддреБрд▓рдирд╛ рдореЗрдВ рдмрд╣реБрдд рдЕрдзрд┐рдХ рдЪреЗрдХ рд╣реЛрддреЗ рд╣реИрдВ, рдФрд░ рдкрд░рд┐рдгрд╛рдорд╕реНрд╡рд░реВрдк, рдХреЗрд╡рд▓ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд▓рд╛рдЗрди - рд╡реНрдпрд╛рдкрд╛рд░ рддрд░реНрдХ рдкреНрд░рд╕рдВрд╕реНрдХрд░рдг рд╡рд┐рдзрд┐ рдХреЗ рд▓рд┐рдП рдХреЙрд▓ - рдХреЛрдб рдХреЗ рдвреЗрд░ рдореЗрдВ рдЫрд┐рдкрд╛ рд╣реБрдЖ рд╣реИред </font><font style="vertical-align: inherit;">рдЙрд╕реЗ рджреЗрдЦрдиреЗ рдФрд░ рд╕рдордЭрдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ рдпрд╣рд╛рдБ рдХреНрдпрд╛ рд╣реЛ рд░рд╣рд╛ рд╣реИ, рдХреБрдЫ рдкреНрд░рдпрд╛рд╕ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред</font></font></li>
</ol><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХрд╕реНрдЯрдо рдмрдВрдзрди (рдЖрд╕рд╛рди рдореЛрдб)</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЕрдиреБрд░реЛрдз рдкреНрд░рд╕рдВрд╕реНрдХрд░рдг рдкрд╛рдЗрдкрд▓рд╛рдЗрди рдореЗрдВ рдЕрдкрдиреЗ рд╣реИрдВрдбрд▓рд░ рдХреЛ рд▓рд╛рдЧреВ рдХрд░рдХреЗ рд╕рдорд╕реНрдпрд╛ рдХрд╛ рд╣рд┐рд╕реНрд╕рд╛ рд╣рд▓ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдкрд╣рд▓реЗ рдЕрдВрддрд┐рдо рдирд┐рдпрдВрддреНрд░рдХ рдХреЛ рддреБрд░рдВрдд рд╡рд┐рдзрд┐ рд╕реЗ рдкрд╛рд╕ рдХрд░рдХреЗ рд╣рдорд╛рд░реЗ рдирд┐рдпрдВрддреНрд░рдХ рдХреЛ рдареАрдХ рдХрд░реЗрдВред </font><font style="vertical-align: inherit;">рдпрд╣ рдмрд╣реБрдд рдЕрдЪреНрдЫрд╛ рд▓рдЧ рд░рд╣рд╛ рд╣реИ, рд╣реИ рдирд╛?</font></font><br>
<br>
<pre><code class="cs hljs">[<span class="hljs-meta">HttpGet</span>]
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task&lt;IActionResult&gt; <span class="hljs-title">GetSomeData</span>(<span class="hljs-params">[FromQuery]FinalData finalData</span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">return</span> _myService.Handle(finalData);<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЗрд╕рдХреЗ рдмрд╛рдж, MoreData рдкреНрд░рдХрд╛рд░ рдХреЗ рд▓рд┐рдП рдЕрдкрдирд╛ рдмрд╛рдЗрдВрдбрд░ рдмрдирд╛рдПрдВред</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">MoreDataBinder</span> : <span class="hljs-title">IModelBinder</span><font></font>
{<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Task <span class="hljs-title">BindModelAsync</span>(<span class="hljs-params">ModelBindingContext bindingContext</span>)</span><font></font>
    {<font></font>
        <span class="hljs-keyword">var</span> moreData = GetFromHeaderAndDecode(bindingContext.HttpContext.Request.Headers);
        <span class="hljs-keyword">if</span> (moreData != <span class="hljs-literal">null</span>)<font></font>
        {<font></font>
            bindingContext.Result = ModelBindingResult.Success(moreData);<font></font>
        }<font></font>
        <span class="hljs-keyword">return</span> Task.CompletedTask;<font></font>
    }<font></font>
    <span class="hljs-function"><span class="hljs-keyword">private</span> MoreData <span class="hljs-title">GetFromHeaderAndDecode</span>(<span class="hljs-params">IHeaderDictionary headers</span>)</span> { ... }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЕрдВрдд рдореЗрдВ, рд╣рдо рд╡рд╣рд╛рдВ рд╕рдВрдкрддреНрддрд┐ рдореЗрдВ рдмрд╛рдЗрдВрдбрд░ рдмрд╛рдЗрдВрдбрд┐рдВрдЧ рдЬреЛрдбрд╝рдХрд░ рдлрд╝рд╛рдЗрдирд▓рдбрд╛рдЯрд╛ рдореЙрдбрд▓ рдХреЛ рдареАрдХ рдХрд░ рджреЗрдВрдЧреЗ:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">FinalData</span><font></font>
{<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> SomeDataNumber { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }<font></font>
<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> SomeDataText { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }<font></font>
<font></font>
    [<span class="hljs-meta">ModelBinder(BinderType = typeof(MoreDataBinder))</span>]
    <span class="hljs-keyword">public</span> MoreData MoreData { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдпрд╣ рдкрд╣рд▓реЗ рд╕реЗ рдмреЗрд╣рддрд░ рд╣реИ, рд▓реЗрдХрд┐рди рдмрд╡рд╛рд╕реАрд░ рдореЗрдВ рд╡реГрджреНрдзрд┐ рд╣реБрдИ рд╣реИ: рдЕрдм рдЖрдкрдХреЛ рдпрд╣ рдЬрд╛рдирдирд╛ рд╣реЛрдЧрд╛ рдХрд┐ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдПрдХ рд╡рд┐рд╢реЗрд╖ рд╣реИрдВрдбрд▓рд░ рд╣реИ рдФрд░ рдЗрд╕реЗ рд╕рднреА рдореЙрдбрд▓реЛрдВ рдореЗрдВ рджрд░реНрд╢рд╛рдПрдВред </font><font style="vertical-align: inherit;">рд▓реЗрдХрд┐рди рдпрд╣ рд╕реЙрд▓реНрд╡ рд╣реИред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЕрдкрдирд╛ BinderProvider рдмрдирд╛рдПрдВ:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">MoreDataBinderProvider</span> : <span class="hljs-title">IModelBinderProvider</span><font></font>
{<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> IModelBinder <span class="hljs-title">GetBinder</span>(<span class="hljs-params">ModelBinderProviderContext context</span>)</span><font></font>
    {<font></font>
        <span class="hljs-keyword">var</span> modelType = context.Metadata.UnderlyingOrModelType;
        <span class="hljs-keyword">if</span> (modelType == <span class="hljs-keyword">typeof</span>(MoreData))<font></font>
        {<font></font>
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> BinderTypeModelBinder(<span class="hljs-keyword">typeof</span>(MoreDataBinder));<font></font>
        }<font></font>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<font></font>
    }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдФрд░ рдЗрд╕реЗ рд╕реНрдЯрд╛рд░реНрдЯрдЕрдк рдореЗрдВ рдкрдВрдЬреАрдХреГрдд рдХрд░реЗрдВ:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ConfigureServices</span>(<span class="hljs-params">IServiceCollection services</span>)</span><font></font>
{<font></font>
    services.AddControllers();<font></font>
    services.AddMvc(options =&gt;<font></font>
    {<font></font>
        options.ModelBinderProviders.Insert(<span class="hljs-number">0</span>, <span class="hljs-keyword">new</span> MoreDataBinderProvider());<font></font>
     });<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдкреНрд░рджрд╛рддрд╛ рдХреЛ рдХрддрд╛рд░ рдХреЗ рдХреНрд░рдо рдореЗрдВ рдкреНрд░рддреНрдпреЗрдХ рдореЙрдбрд▓ рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЗ рд▓рд┐рдП рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдпрджрд┐ рд╣рдорд╛рд░рд╛ рдкреНрд░рджрд╛рддрд╛ рд╡рд╛рдВрдЫрд┐рдд рдкреНрд░рдХрд╛рд░ рд╕реЗ рдорд┐рд▓рддрд╛ рд╣реИ, рддреЛ рдпрд╣ рд╡рд╛рдВрдЫрд┐рдд рдмрд╛рдЗрдВрдбрд░ рд▓реМрдЯрд╛ рджреЗрдЧрд╛ред </font><font style="vertical-align: inherit;">рдФрд░ рдпрджрд┐ рдирд╣реАрдВ, рддреЛ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдмрд╛рдЗрдВрдбрд░ рдХрд╛рдо рдХрд░реЗрдЧрд╛ред </font><font style="vertical-align: inherit;">рддреЛ рдЕрдм рдЬрдм рднреА рд╣рдо MoreData рдХреЗ рдкреНрд░рдХрд╛рд░ рдХреЛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдЗрд╕реЗ рд╣реЗрдбрд░ рд╕реЗ рд▓рд┐рдпрд╛ рдФрд░ рдбрд┐рдХреЛрдб рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ рдФрд░ рдореЙрдбрд▓ рдореЗрдВ рд╡рд┐рд╢реЗрд╖ рд╡рд┐рд╢реЗрд╖рддрд╛рдУрдВ рдХреЛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИред</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХрд╕реНрдЯрдо рдмрд╛рдЗрдВрдбрд┐рдВрдЧ (рд╣рд╛рд░реНрдб рдореЛрдб)</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдпрд╣ рд╕рдм рдмрд╣реБрдд рдЕрдЪреНрдЫрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдПрдХ рдмрд╛рдд рд╣реИ рд▓реЗрдХрд┐рди: рдЬрд╛рджреВ рдХреЗ рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдорд╛рд░реЗ рдореЙрдбрд▓ рдореЗрдВ рд╕реЗрдЯ рдХреЗ рд╕рд╛рде рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдЧреБрдг рд╣реЛрдиреЗ рдЪрд╛рд╣рд┐рдПред </font><font style="vertical-align: inherit;">рд▓реЗрдХрд┐рди рдЗрдирдХреИрдкреНрд╕реБрд▓реЗрд╢рди рдХрд╛ рдХреНрдпрд╛? </font><font style="vertical-align: inherit;">рдХреНрдпрд╛ рд╣реЛрдЧрд╛ рдпрджрд┐ рдореИрдВ рдХреНрд▓рд╛рдЙрдб рдореЗрдВ рд╡рд┐рднрд┐рдиреНрди рд╕реНрдерд╛рдиреЛрдВ рдкрд░ рдЕрдиреБрд░реЛрдз рдбреЗрдЯрд╛ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рддрд╛ рд╣реВрдВ рдФрд░ рдЬрд╛рдирддрд╛ рд╣реВрдВ рдХрд┐ рдЙрдиреНрд╣реЗрдВ рд╡рд╣рд╛рдВ рдирд╣реАрдВ рдмрджрд▓рд╛ рдЬрд╛рдПрдЧрд╛? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╕рдорд╕реНрдпрд╛ рдпрд╣ рд╣реИ рдХрд┐ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдмрд╛рдЗрдВрдбрд░ рдЙрди рдореЙрдбрд▓реЛрдВ рдХреЗ рд▓рд┐рдП рдХрд╛рдо рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИ рдЬрд┐рдирдореЗрдВ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдХрдВрд╕реНрдЯреНрд░рдХреНрдЯрд░ рдирд╣реАрдВ рд╣реИред </font><font style="vertical-align: inherit;">рд▓реЗрдХрд┐рди рдХреНрдпрд╛ рд╣рдореЗрдВ рдЦреБрдж рдХреЛ рд▓рд┐рдЦрдиреЗ рд╕реЗ рд░реЛрдХрддрд╛ рд╣реИ?</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬрд┐рд╕ рд╕реЗрд╡рд╛ рдХреЗ рд▓рд┐рдП рдореИрдВрдиреЗ рдпрд╣ рдХреЛрдб рд▓рд┐рдЦрд╛ рдерд╛ рд╡рд╣ REST рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИ, рдкреИрд░рд╛рдореАрдЯрд░ рдХреЗрд╡рд▓ рдХреНрд╡реЗрд░реА рдФрд░ рдмреЙрдбреА рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдкреНрд░реЗрд╖рд┐рдд рд╣реЛрддреЗ рд╣реИрдВ, рдФрд░ рдХреЗрд╡рд▓ рджреЛ рдкреНрд░рдХрд╛рд░ рдХреЗ рдЕрдиреБрд░реЛрдзреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ - рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 рдФрд░ рдкреЛрд╕реНрдЯ рдХрд░реЗрдВред </font><font style="vertical-align: inherit;">рддрджрдиреБрд╕рд╛рд░, рдЖрд░рдИрдПрд╕рдЯреА рдПрдкреАрдЖрдИ рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ, рдкреНрд░рд╕рдВрд╕реНрдХрд░рдг рддрд░реНрдХ рдереЛрдбрд╝рд╛ рдЕрд▓рдЧ рд╣реЛрдЧрд╛ред</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рд╛рдорд╛рдиреНрдп рддреМрд░ рдкрд░, рдХреЛрдб рдЕрдкрд░рд┐рд╡рд░реНрддрд┐рдд рд░рд╣реЗрдЧрд╛, рдХреЗрд╡рд▓ рд╣рдорд╛рд░реЗ рдмрд╛рдЗрдВрдбрд░ рдХреЛ рд╢реЛрдзрди рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рддрд╛рдХрд┐ рд╡рд╣ рдПрдХ рд╡рд╕реНрддреБ рдмрдирд╛ рд╕рдХреЗ рдФрд░ рдЕрдкрдиреЗ рдирд┐рдЬреА рдХреНрд╖реЗрддреНрд░реЛрдВ рдХреЛ рднрд░ рд╕рдХреЗред </font><font style="vertical-align: inherit;">рдЖрдЧреЗ рдореИрдВ рдЯрд┐рдкреНрдкрдгрд┐рдпреЛрдВ рдХреЗ рд╕рд╛рде рдХреЛрдб рдХреЗ рдЯреБрдХрдбрд╝реЗ рджреВрдВрдЧрд╛, рдЬрд┐рдиреНрд╣реЗрдВ рдХреЛрдИ рджрд┐рд▓рдЪрд╕реНрдкреА рдирд╣реАрдВ рд╣реИ - рдмрд┐рд▓реНрд▓реА рдХреЗ рдиреАрдЪреЗ рд▓реЗрдЦ рдХреЗ рдЕрдВрдд рдореЗрдВ рдХрдХреНрд╖рд╛ рдХреА рдкреВрд░реА рд╕реВрдЪреА рд╣реИред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдкрд╣рд▓реЗ, рдпрд╣ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░реЗрдВ рдХрд┐ рдХреНрдпрд╛ MoreData рдХреЗрд╡рд▓ рд╡рд░реНрдЧ рдХреА рд╕рдВрдкрддреНрддрд┐ рд╣реИред </font><font style="vertical-align: inherit;">рдпрджрд┐ рд╣рд╛рдБ, рддреЛ рдЖрдкрдХреЛ рдСрдмреНрдЬреЗрдХреНрдЯ рд╕реНрд╡рдпрдВ рдмрдирд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ (рд╣реИрд▓реЛ, рдПрдХреНрдЯрд┐рд╡реЗрдЯрд░), рдФрд░ рдпрджрд┐ рдирд╣реАрдВ, рддреЛ JsonConvert рдХрд╛рдо рдХреЛ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдХрд░реЗрдЧрд╛, рдФрд░ рд╣рдо рд╕рд┐рд░реНрдл рдЖрд╡рд╢реНрдпрдХ рдбреЗрдЯрд╛ рдХреЛ рд╕рдВрдкрддреНрддрд┐ рдореЗрдВ рдкрд░реНрдЪреА рдХрд░рддреЗ рд╣реИрдВред</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">NeedActivator</span>(<span class="hljs-params">IReflect modelType</span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">var</span> propFlags = BindingFlags.NonPublic | BindingFlags.Public | BindingFlags.Instance;
    <span class="hljs-keyword">var</span> properties = modelType.GetProperties(propFlags);<font></font>
<font></font>
    <span class="hljs-keyword">return</span> properties.Select(p =&gt; p.Name).Distinct().Count() == <span class="hljs-number">1</span>;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
JsonConvert рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдПрдХ рд╡рд╕реНрддреБ рдмрдирд╛рдирд╛ рд╕рд░рд▓ рд╣реИ, рд╢рд░реАрд░ рдХреЗ рд╕рд╛рде рдкреНрд░рд╢реНрдиреЛрдВ рдХреЗ рд▓рд┐рдП:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">object</span>? GetModelFromBody(ModelBindingContext bindingContext, Type modelType)<font></font>
{<font></font>
    <span class="hljs-keyword">using</span> <span class="hljs-keyword">var</span> reader = <span class="hljs-keyword">new</span> StreamReader(bindingContext.HttpContext.Request.Body);
    <span class="hljs-keyword">var</span> jsonString = reader.ReadToEnd();
    <span class="hljs-keyword">var</span> data = JsonConvert.DeserializeObject(jsonString, modelType);
    <span class="hljs-keyword">return</span> data;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд▓реЗрдХрд┐рди рдХреНрд╡реЗрд░реА рдХреЗ рд╕рд╛рде рдореБрдЭреЗ рд▓реЗрдЯрдирд╛ рдкрдбрд╝рд╛ред </font><font style="vertical-align: inherit;">рдореБрдЭреЗ рдЦреБрд╢реА рд╣реЛрдЧреА рдЕрдЧрд░ рдХреЛрдИ рдФрд░ рдЕрдзрд┐рдХ рд╕реБрдВрджрд░ рд╕рдорд╛рдзрд╛рди рд╕реБрдЭрд╛ рд╕рдХрддрд╛ рд╣реИред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдПрдХ рд╕рд░рдгреА рдкрд╛рд╕ рдХрд░рддреЗ рд╕рдордп, рд╕рдорд╛рди рдирд╛рдо рд╡рд╛рд▓реЗ рдХрдИ рдкреИрд░рд╛рдореАрдЯрд░ рдкреНрд░рд╛рдкреНрдд рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдПрдХ рдлреНрд▓реИрдЯ рдкреНрд░рдХрд╛рд░ рдореЗрдВ рдХрд╛рд╕реНрдЯрд┐рдВрдЧ рдХрд░рдиреЗ рд╕реЗ рдорджрдж рдорд┐рд▓рддреА рд╣реИ, рд▓реЗрдХрд┐рди рдХреНрд░рдорд╛рдВрдХрди рд╕рд░рдгреА рдкрд░ рдЕрддрд┐рд░рд┐рдХреНрдд рдЙрджреНрдзрд░рдг рдбрд╛рд▓рддрд╛ рд╣реИ [], рдЬрд┐рд╕реЗ рдореИрдиреНрдпреБрдЕрд▓ рд░реВрдк рд╕реЗ рд╣рдЯрд╛рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">object</span>? GetModelFromQuery(ModelBindingContext bindingContext, Type modelType)<font></font>
{<font></font>
    <span class="hljs-keyword">var</span> valuesDictionary = QueryHelpers.ParseQuery(bindingContext.HttpContext.Request.QueryString.Value);
    <span class="hljs-keyword">var</span> jsonDictionary = valuesDictionary.ToDictionary(pair =&gt; pair.Key, pair =&gt; pair.Value.Count &lt; <span class="hljs-number">2</span> ? pair.Value.ToString() : <span class="hljs-string">$"[<span class="hljs-subst">{pair.Value}</span>]"</span>);<font></font>
<font></font>
    <span class="hljs-keyword">var</span> jsonStr = JsonConvert.SerializeObject(jsonDictionary).Replace(<span class="hljs-string">"\"["</span>, <span class="hljs-string">"["</span>).Replace(<span class="hljs-string">"]\""</span>, <span class="hljs-string">"]"</span>);
    <span class="hljs-keyword">var</span> data = JsonConvert.DeserializeObject(jsonStr, modelType);
    <span class="hljs-keyword">return</span> data;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЕрдВрдд рдореЗрдВ, рдСрдмреНрдЬреЗрдХреНрдЯ рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдХрд░рддреЗ рд╣реБрдП, рд╣рдорд╛рд░реЗ рдбреЗрдЯрд╛ рдХреЛ рдЙрд╕рдХреА рдирд┐рдЬреА рд╕рдВрдкрддреНрддрд┐ рдореЗрдВ рд▓рд┐рдЦрдирд╛ рдЖрд╡рд╢реНрдпрдХ рд╣реИред </font><font style="vertical-align: inherit;">рдпрд╣ рдЗрд╕ shamanism рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдерд╛ рдЬреЛ рдореИрдВрдиреЗ рд▓реЗрдЦ рдХреА рд╢реБрд░реБрдЖрдд рдореЗрдВ рдмреЛрд▓рд╛ рдерд╛ред </font><font style="vertical-align: inherit;">рдореБрдЭреЗ рдпрд╣ рд╕рдорд╛рдзрд╛рди </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╣рд╛рдВ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдорд┐рд▓рд╛ </font><font style="vertical-align: inherit;">, рдЬрд┐рд╕рдХреЗ рд▓рд┐рдП рд▓реЗрдЦрдХ рдХреЛ рдмрд╣реБрдд рдзрдиреНрдпрд╡рд╛рджред</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ForceSetValue</span>(<span class="hljs-params">PropertyInfo propertyInfo, <span class="hljs-keyword">object</span> obj, <span class="hljs-keyword">object</span> <span class="hljs-keyword">value</span></span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">var</span> propName = <span class="hljs-string">$"&lt;<span class="hljs-subst">{propertyInfo.Name}</span>&gt;k__BackingField"</span>;
    <span class="hljs-keyword">var</span> propFlags = BindingFlags.Instance | BindingFlags.NonPublic;<font></font>
            <font></font>
    obj.GetType().GetField(propName, propFlags)?.SetValue(obj, <span class="hljs-keyword">value</span>);<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЦреИрд░, рд╣рдо рдЗрди рд╡рд┐рдзрд┐рдпреЛрдВ рдХреЛ рдПрдХ рдХреЙрд▓ рдореЗрдВ рд╕рдВрдпреЛрдЬрд┐рдд рдХрд░рддреЗ рд╣реИрдВ:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> Task <span class="hljs-title">BindModelAsync</span>(<span class="hljs-params">ModelBindingContext bindingContext</span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">var</span> moreData = GetFromHeaderAndDecode(bindingContext.HttpContext.Request.Headers);
    <span class="hljs-keyword">if</span> (moreData == <span class="hljs-literal">null</span>)<font></font>
    {<font></font>
        <span class="hljs-keyword">return</span> Task.CompletedTask;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">var</span> modelType = bindingContext.ModelMetadata.UnderlyingOrModelType;
    <span class="hljs-keyword">if</span> (NeedActivator(modelType))<font></font>
    {<font></font>
        <span class="hljs-keyword">var</span> data = Activator.CreateInstance(modelType, moreData);<font></font>
        bindingContext.Result = ModelBindingResult.Success(data);<font></font>
<font></font>
        <span class="hljs-keyword">return</span> Task.CompletedTask;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">var</span> model = bindingContext.HttpContext.Request.Method == <span class="hljs-string">"GET"</span><font></font>
                            ? GetModelFromQuery(bindingContext, modelType)<font></font>
                            : GetModelFromBody(bindingContext, modelType);<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (model <span class="hljs-keyword">is</span> <span class="hljs-literal">null</span>)<font></font>
    {<font></font>
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Exception(<span class="hljs-string">"  "</span>);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">var</span> ignoreCase = StringComparison.InvariantCultureIgnoreCase;
    <span class="hljs-keyword">var</span> dataProperty = modelType.GetProperties()<font></font>
                            .FirstOrDefault(p =&gt; p.Name.Equals(<span class="hljs-keyword">typeof</span>(T).Name, ignoreCase));<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (dataProperty != <span class="hljs-literal">null</span>)<font></font>
    {<font></font>
        ForceSetValue(dataProperty, model, moreData);<font></font>
    }<font></font>
<font></font>
    bindingContext.Result = ModelBindingResult.Success(model);<font></font>
    <span class="hljs-keyword">return</span> Task.CompletedTask;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдпрд╣ рдмрд╛рдЗрдВрдбрд░рдкреНрд░реЛрдЗрдбрд░ рдХреЛ рдареАрдХ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдмрдиреА рд╣реБрдИ рд╣реИ рддрд╛рдХрд┐ рдпрд╣ рд╡рд╛рдВрдЫрд┐рдд рд╕рдВрдкрддреНрддрд┐ рдХреЗ рд╕рд╛рде рдХрд┐рд╕реА рднреА рд╡рд░реНрдЧ рдХреЛ рдЬрд╡рд╛рдм рджреЗ:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">MoreDataBinderProvider</span> : <span class="hljs-title">IModelBinderProvider</span><font></font>
{<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> IModelBinder <span class="hljs-title">GetBinder</span>(<span class="hljs-params">ModelBinderProviderContext context</span>)</span><font></font>
    {<font></font>
       <span class="hljs-keyword">var</span> modelType = context.Metadata.UnderlyingOrModelType;
       <span class="hljs-keyword">if</span> (HasDataProperty(modelType))<font></font>
       {<font></font>
           <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> BinderTypeModelBinder(<span class="hljs-keyword">typeof</span>(PrivateDataBinder&lt;MoreData&gt;));<font></font>
       }<font></font>
       <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<font></font>
    }<font></font>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">HasDataProperty</span>(<span class="hljs-params">IReflect modelType</span>)</span><font></font>
    {<font></font>
        <span class="hljs-keyword">var</span> propFlags = BindingFlags.NonPublic | BindingFlags.Public | BindingFlags.Instance;
        <span class="hljs-keyword">var</span> properties = modelType.GetProperties(propFlags);<font></font>
<font></font>
        <span class="hljs-keyword">return</span> properties.Select(p =&gt; p.Name) .Contains(<span class="hljs-keyword">nameof</span>(MoreData));<font></font>
    }<font></font>
}<font></font>
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдмрд╕ рдЗрддрдирд╛ рд╣реАред </font><font style="vertical-align: inherit;">рдмрд╛рдЗрдВрдбрд░ рдИрдЬрд╝реА рдореЛрдб рдХреА рддреБрд▓рдирд╛ рдореЗрдВ рдереЛрдбрд╝рд╛ рдЕрдзрд┐рдХ рдЬрдЯрд┐рд▓ рдирд┐рдХрд▓рд╛, рд▓реЗрдХрд┐рди рдЕрдм рд╣рдо рдЕрддрд┐рд░рд┐рдХреНрдд рдкреНрд░рдпрд╛рд╕реЛрдВ рдХреЗ рдмрд┐рдирд╛ рд╕рднреА рдирд┐рдпрдВрддреНрд░рдХреЛрдВ рдХреЗ рд╕рднреА рддрд░реАрдХреЛрдВ рдореЗрдВ "рдмрд╛рд╣рд░реА" рдЧреБрдгреЛрдВ рдХреЛ рдмрд╛рдВрдз рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">Minuses рдХреА:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдирд┐рдЬреА рдХреНрд╖реЗрддреНрд░реЛрдВ рдХреЗ рд╕рд╛рде рд╡рд╕реНрддреБрдУрдВ рдХреЗ рдирд┐рд░реНрдорд╛рддрд╛ рдХреЛ [JsonConstrustor] рд╡рд┐рд╢реЗрд╖рддрд╛ рдХреЛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдПред </font><font style="vertical-align: inherit;">рд▓реЗрдХрд┐рди рдпрд╣ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдореЙрдбрд▓ рдХреЗ рддрд░реНрдХ рдореЗрдВ рдлрд┐рдЯ рдмреИрдарддрд╛ рд╣реИ рдФрд░ рдЗрд╕рдХреА рдзрд╛рд░рдгрд╛ рдореЗрдВ рд╣рд╕реНрддрдХреНрд╖реЗрдк рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИред</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХрд╣реАрдВ, рдЖрдкрдХреЛ рд╣реЗрдбрд░ рд╕реЗ рдореЛрд░реЗрдбреЗрдЯрд╛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИред </font><font style="vertical-align: inherit;">рд▓реЗрдХрд┐рди рдПрдХ рдЕрд▓рдЧ рд╡рд░реНрдЧ рдмрдирд╛рдХрд░ рдЗрд╕рдХрд╛ рдЗрд▓рд╛рдЬ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдмрд╛рдХреА рдЯреАрдо рдХреЛ рдЬрд╛рджреВ рдХреА рдЙрдкрд╕реНрдерд┐рддрд┐ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдкрддрд╛ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред </font><font style="vertical-align: inherit;">рд▓реЗрдХрд┐рди рдкреНрд░рд▓реЗрдЦрди рдорд╛рдирд╡рддрд╛ рдХреЛ рдмрдЪрд╛рдПрдЧрд╛ред</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдкрд░рд┐рдгрд╛рдореА рдмрд╛рдЗрдВрдбрд░ рдХреА рдкреВрд░реА рд╕реВрдЪреА рдпрд╣рд╛рдБ рд╣реИ:</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PrivateMoreDataBinder.cs</font></font></b><div class="spoiler_text"><pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">PrivateDataBinder</span>&lt;T&gt; : <span class="hljs-title">IModelBinder</span><font></font>
    {<font></font>
        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span><span class="hljs-doctag">&lt;/summary&gt;</span></span>
        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="bindingContext"&gt;</span><span class="hljs-doctag">&lt;/param&gt;</span></span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> Task <span class="hljs-title">BindModelAsync</span>(<span class="hljs-params">ModelBindingContext bindingContext</span>)</span><font></font>
        {<font></font>
            <span class="hljs-keyword">var</span> moreData = GetFromHeaderAndDecode(bindingContext.HttpContext.Request.Headers);
            <span class="hljs-keyword">if</span> (moreData == <span class="hljs-literal">null</span>)<font></font>
            {<font></font>
                <span class="hljs-keyword">return</span> Task.CompletedTask;<font></font>
            }<font></font>
<font></font>
            <span class="hljs-keyword">var</span> modelType = bindingContext.ModelMetadata.UnderlyingOrModelType;
            <span class="hljs-keyword">if</span> (NeedActivator(modelType))<font></font>
            {<font></font>
                <span class="hljs-keyword">var</span> data = Activator.CreateInstance(modelType, moreData);<font></font>
                bindingContext.Result = ModelBindingResult.Success(data);<font></font>
<font></font>
                <span class="hljs-keyword">return</span> Task.CompletedTask;<font></font>
            }<font></font>
<font></font>
            <span class="hljs-keyword">var</span> model = bindingContext.HttpContext.Request.Method == <span class="hljs-string">"GET"</span><font></font>
                            ? GetModelFromQuery(bindingContext, modelType)<font></font>
                            : GetModelFromBody(bindingContext, modelType);<font></font>
<font></font>
            <span class="hljs-keyword">if</span> (model <span class="hljs-keyword">is</span> <span class="hljs-literal">null</span>)<font></font>
            {<font></font>
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Exception(<span class="hljs-string">"  "</span>);<font></font>
            }<font></font>
<font></font>
            <span class="hljs-keyword">var</span> ignoreCase = StringComparison.InvariantCultureIgnoreCase;
            <span class="hljs-keyword">var</span> dataProperty = modelType.GetProperties()<font></font>
                                        .FirstOrDefault(p =&gt; p.Name.Equals(<span class="hljs-keyword">typeof</span>(T).Name, ignoreCase));<font></font>
<font></font>
            <span class="hljs-keyword">if</span> (dataProperty != <span class="hljs-literal">null</span>)<font></font>
            {<font></font>
                ForceSetValue(dataProperty, model, moreData);<font></font>
            }<font></font>
<font></font>
            bindingContext.Result = ModelBindingResult.Success(model);<font></font>
<font></font>
            <span class="hljs-keyword">return</span> Task.CompletedTask;<font></font>
        }<font></font>
<font></font>
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">object</span>? GetModelFromQuery(ModelBindingContext bindingContext,<font></font>
                                                 Type modelType)<font></font>
        {<font></font>
            <span class="hljs-keyword">var</span> valuesDictionary = QueryHelpers.ParseQuery(bindingContext.HttpContext.Request.QueryString.Value);<font></font>
<font></font>
            <span class="hljs-keyword">var</span> jsonDictionary = valuesDictionary.ToDictionary(pair =&gt; pair.Key, pair =&gt; pair.Value.Count &lt; <span class="hljs-number">2</span> ? pair.Value.ToString() : <span class="hljs-string">$"[<span class="hljs-subst">{pair.Value}</span>]"</span>);<font></font>
<font></font>
            <span class="hljs-keyword">var</span> jsonStr = JsonConvert.SerializeObject(jsonDictionary)<font></font>
                                     .Replace(<span class="hljs-string">"\"["</span>, <span class="hljs-string">"["</span>)<font></font>
                                     .Replace(<span class="hljs-string">"]\""</span>, <span class="hljs-string">"]"</span>);<font></font>
<font></font>
            <span class="hljs-keyword">var</span> data = JsonConvert.DeserializeObject(jsonStr, modelType);<font></font>
<font></font>
            <span class="hljs-keyword">return</span> data;<font></font>
        }<font></font>
<font></font>
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">object</span>? GetModelFromBody(ModelBindingContext bindingContext,<font></font>
                                                Type modelType)<font></font>
        {<font></font>
            <span class="hljs-keyword">using</span> <span class="hljs-keyword">var</span> reader = <span class="hljs-keyword">new</span> StreamReader(bindingContext.HttpContext.Request.Body);
            <span class="hljs-keyword">var</span> jsonString = reader.ReadToEnd();
            <span class="hljs-keyword">var</span> data = JsonConvert.DeserializeObject(jsonString, modelType);<font></font>
<font></font>
            <span class="hljs-keyword">return</span> data;<font></font>
        }<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">NeedActivator</span>(<span class="hljs-params">IReflect modelType</span>)</span><font></font>
        {<font></font>
            <span class="hljs-keyword">var</span> propFlags = BindingFlags.NonPublic | BindingFlags.Public | BindingFlags.Instance;
            <span class="hljs-keyword">var</span> properties = modelType.GetProperties(propFlags);<font></font>
<font></font>
            <span class="hljs-keyword">return</span> properties.Select(p =&gt; p.Name).Distinct().Count() == <span class="hljs-number">1</span>;<font></font>
        }<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ForceSetValue</span>(<span class="hljs-params">PropertyInfo propertyInfo, <span class="hljs-keyword">object</span> obj, <span class="hljs-keyword">object</span> <span class="hljs-keyword">value</span></span>)</span><font></font>
        {<font></font>
            <span class="hljs-keyword">var</span> propName = <span class="hljs-string">$"&lt;<span class="hljs-subst">{propertyInfo.Name}</span>&gt;k__BackingField"</span>;
            <span class="hljs-keyword">var</span> propFlags = BindingFlags.Instance | BindingFlags.NonPublic;<font></font>
            <font></font>
            obj.GetType().GetField(propName, propFlags)?.SetValue(obj, <span class="hljs-keyword">value</span>);<font></font>
        }<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">private</span> T <span class="hljs-title">GetFromHeaderAndDecode</span>(<span class="hljs-params">IHeaderDictionary headers</span>)</span> { <span class="hljs-keyword">return</span> (T)Activator.CreateInstance(<span class="hljs-keyword">typeof</span>(T), <span class="hljs-keyword">new</span> <span class="hljs-keyword">object</span>[] { <span class="hljs-string">"ok"</span> }); }<font></font>
    }<font></font>
</code></pre><br>
</div></div></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi492806/index.html">рдореЛрдмрд╛рдЗрд▓ рдЧреЗрдореНрд╕ рдФрд░ рдРрдкреНрд╕ рдореЗрдВ рдореБрджреНрд░реАрдХрд░рдг рд╕реЗ рдЬреБрдбрд╝рд╛рд╡ рдХреИрд╕реЗ рдХрд░реЗрдВ</a></li>
<li><a href="../hi492808/index.html">рдЖрдкрд╛рддрдХрд╛рд▓реАрди рдкреНрд░рдХрд╛рд╢ рд╕реНрд╡рд┐рдЪ рд╕реНрдерд┐рддрд┐ рд╕реЗрдВрд╕рд░</a></li>
<li><a href="../hi492810/index.html">[COVID-19] рдЖрдкрдХрд╛ рдХрд╛рд░реНрдп рд╢рд┐рдЦрд░ рдХреЛ рд╕реБрдЪрд╛рд░реВ рдХрд░рдирд╛ рд╣реИ</a></li>
<li><a href="../hi492812/index.html">OpenVINO рдореЗрдВ GAN рдиреЗрдЯрд╡рд░реНрдХ рдЪрд▓рд╛рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░ рд░рд╣рд╛ рд╣реИ</a></li>
<li><a href="../hi492816/index.html">рдЗрдВрдЯреЗрд▓реАрдЬ рдЖрдИрдбреАрдИрдП рдЯрд┐рдкреНрд╕ рдПрдВрдб рдЯреНрд░рд┐рдХреНрд╕: 4. рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдХреЛ рд╕рд┐рдВрдХреНрд░рдирд╛рдЗрдЬрд╝ рдФрд░ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ</a></li>
<li><a href="../hi492822/index.html">рд╕реАрдПрд╕рдПрд╕ рдбреЗрд╡рд▓рдкрд░реНрд╕ - рджреБрдирд┐рдпрд╛ рдХреЛ рдЙрдирдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдХреНрдпреЛрдВ рд╣реИ?</a></li>
<li><a href="../hi492828/index.html">рдХреИрд╕реЗ рдПрдХ рдмрдВрдж рджреБрдирд┐рдпрд╛ рдореЗрдВ рдЬреАрд╡рд┐рдд рд░рд╣рдиреЗ рдХреЗ рд▓рд┐рдП</a></li>
<li><a href="../hi492830/index.html">рд╕рдорд╛рди рд░реВрдк рд╕реЗ = рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рд▓рдХреНрд╖реНрдордг - рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдХреНрд░реЛрдо 80 рд╕реНрдерд┐рд░ (рд╣рд╛рд▓рд╛рдВрдХрд┐ рдЕрднреА рддрдХ рд╕рднреА рдХреЗ рд▓рд┐рдП рдирд╣реАрдВ)</a></li>
<li><a href="../hi492832/index.html">I.MX6 рдФрд░ рд▓рд┐рдирдХреНрд╕ рдкрд░ рдЖрдзрд╛рд░рд┐рдд рдФрджреНрдпреЛрдЧрд┐рдХ рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдХреЗ рд▓рд┐рдП IoT- рдкреНрд░рд╡реЗрд╢ рджреНрд╡рд╛рд░</a></li>
<li><a href="../hi492834/index.html">LVM рдФрд░ matryoshka рдХреЗ рдмреАрдЪ рдХреНрдпрд╛ рдЖрдо рд╣реИ?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>