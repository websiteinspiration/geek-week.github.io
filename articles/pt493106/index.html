<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèΩ‚Äçü§ù‚Äçüë®üèª ü•ë üîê Quanto h√° de novo na D√∫zia do Diabo? üë®‚Äçüë®‚Äçüëß‚Äçüëß üë®‚Äçüë©‚Äçüëß üçä</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Estamos falando apenas do PostgreSQL 13. Em 8 de abril, ocorreu um ‚Äúcongelamento‚Äù - o congelamento de recursos do PostgreSQL , agora apenas os recurso...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Quanto h√° de novo na D√∫zia do Diabo?</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/postgrespro/blog/493106/"><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Estamos falando apenas do PostgreSQL 13. Em 8 de abril, ocorreu um ‚Äúcongelamento‚Äù - o </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">congelamento de recursos do</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> PostgreSQL </font><font style="vertical-align: inherit;">, agora apenas os recursos que s√£o aceitos antes desta data ser√£o inclu√≠dos nesta vers√£o. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√â dif√≠cil nomear uma vers√£o revolucion√°ria disso. </font><font style="vertical-align: inherit;">N√£o h√° mudan√ßas conceituais e cardinais nele. </font><font style="vertical-align: inherit;">Al√©m disso, patches importantes, como Tabela e Fun√ß√µes para o padr√£o JSON / SQL, que eu tamb√©m queria ver na PG12 ao lado do patch JSONPath, n√£o tiveram tempo para inseri-lo; </font><font style="vertical-align: inherit;">o armazenamento incorporado pronto n√£o apareceu - apenas a interface est√° sendo finalizada. </font><font style="vertical-align: inherit;">Mas a lista de melhorias ainda √© impressionante. </font><font style="vertical-align: inherit;">Preparamos um resumo bastante completo dos patches inclu√≠dos na D√∫zia do Diabo.</font></font></i><br>
<br>
<hr><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Altera√ß√µes nos comandos SQL</font></font></h3><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE DATABASE ... LOCALE</font></font></b></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Utilities</font></font><code>initdb</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font><code>createdb</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e a equipe</font></font><code>CREATE COLLATION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tem uma configura√ß√£o</font></font><code>LOCALE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que permite que voc√™ especificar valores para a direita</font></font><code>LC_CTYPE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e</font></font><code>LC_COLLATE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Agora, a mesma oportunidade apareceu na equipe</font></font><code>CREATE DATABASE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">DATABASE</span> db_koi8r <span class="hljs-keyword">TEMPLATE</span> template0 
    <span class="hljs-keyword">ENCODING</span> <span class="hljs-string">'KOI8R'</span> LOCALE <span class="hljs-string">'ru_RU.KOI8R'</span>;</code></pre><a name="habracut"></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ALTER VIEW ... COLUNA RENAME</font></font></b></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
O nome da coluna na vista agora pode ser alterado com o comando</font></font><code>ALTER VIEW</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Anteriormente, isso exigia a recria√ß√£o da exibi√ß√£o. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Suponha que voc√™ esqueceu de dar um nome √† coluna:</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">VIEW</span> uptime <span class="hljs-keyword">AS</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">current_timestamp</span>, <span class="hljs-built_in">current_timestamp</span> - pg_postmaster_start_time();
<span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> uptime;</code></pre><br>
<pre><code class="plaintext hljs">       current_timestamp       |    ?column?     <font></font>
-------------------------------+-----------------<font></font>
 2020-03-23 15:37:00.088824+03 | 04:18:24.897856</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pode ser corrigido:</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">VIEW</span> uptime <span class="hljs-keyword">RENAME</span> <span class="hljs-keyword">COLUMN</span> "?column?" <span class="hljs-keyword">TO</span> uptime;
<span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> uptime;</code></pre><br>
<pre><code class="plaintext hljs">       current_timestamp       |     uptime      <font></font>
-------------------------------+-----------------<font></font>
 2020-03-23 15:37:40.726516+03 | 04:19:05.535548</code></pre><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ALTER TABLE ... ALTER COLUMN ... DROP EXPRESSION</font></font></b></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
A coluna gerada da tabela agora pode ser normalizada, ou seja, excluir a express√£o para avali√°-la:</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> payments (<font></font>
    id <span class="hljs-type">integer</span> <span class="hljs-keyword">PRIMARY KEY</span>,<font></font>
    amount <span class="hljs-type">numeric</span>(<span class="hljs-number">18</span>,<span class="hljs-number">2</span>),<font></font>
    income_tax <span class="hljs-type">numeric</span>(<span class="hljs-number">18</span>,<span class="hljs-number">2</span>) <span class="hljs-keyword">GENERATED</span> <span class="hljs-keyword">ALWAYS</span> <span class="hljs-keyword">AS</span> (amount*<span class="hljs-number">0.13</span>) STORED<font></font>
);<font></font>
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> payments(id, amount) <span class="hljs-keyword">VALUES</span>(<span class="hljs-number">1</span>, <span class="hljs-number">42</span>);<font></font>
\d payments</code></pre><br>
<pre><code class="plaintext hljs">                                     Table "public.payments"<font></font>
   Column   |     Type      | Collation | Nullable |                   Default            <font></font>
        <font></font>
------------+---------------+-----------+----------+--------------------------------------<font></font>
 id         | integer       |           | not null |<font></font>
 amount     | numeric(18,2) |           |          |<font></font>
 income_tax | numeric(18,2) |           |          | generated always as ((amount * 0.13))<font></font>
 stored<font></font>
Indexes:<font></font>
    "payments_pkey" PRIMARY KEY, btree (id)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Posteriormente, eles decidiram que o imposto de renda deve ser definido explicitamente. </font><font style="vertical-align: inherit;">Exclua a express√£o:</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> payments <span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">COLUMN</span> income_tax <span class="hljs-keyword">DROP</span> EXPRESSION;<font></font>
\d payments</code></pre><br>
<pre><code class="plaintext hljs">                   Table "public.payments"<font></font>
   Column   |     Type      | Collation | Nullable | Default<font></font>
------------+---------------+-----------+----------+---------<font></font>
 id         | integer       |           | not null |<font></font>
 amount     | numeric(18,2) |           |          |<font></font>
 income_tax | numeric(18,2) |           |          |<font></font>
Indexes:<font></font>
    "payments_pkey" PRIMARY KEY, btree (id)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Obviamente, os dados existentes da coluna n√£o desapareceram:</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> payments;</code></pre><br>
<pre><code class="plaintext hljs"> id | amount | income_tax<font></font>
----+--------+------------<font></font>
  1 |  42.00 |       5.46</code></pre><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DROP DATABASE ... FORCE</font></font></b></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Se voc√™ deseja excluir um banco de dados sem aguardar a desconex√£o de todos os usu√°rios, pode usar a nova op√ß√£o de</font></font><code>FORCE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">comando</font></font><code>DROP DATABASE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">DATABASE</span> db;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Conecte-se ao novo banco de dados:</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">EXTENSION</span> <span class="hljs-keyword">IF</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> dblink;
<span class="hljs-keyword">SELECT</span> dblink_connect(<span class="hljs-string">'dbname=db'</span>);</code></pre><br>
<pre><code class="plaintext hljs"> dblink_connect<font></font>
----------------<font></font>
 OK</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E agora excluiremos, interrompendo √† for√ßa, tamb√©m </font></font><code>pg_terminate_backend</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, as conex√µes abertas:</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">DATABASE</span> db <span class="hljs-keyword">WITH</span> (FORCE);</code></pre><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ALTER TYPE ... SET STORAGE</font></font></b></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
O comando</font></font><code>ALTER TYPE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">permite que tipos de dados b√°sicos alterem v√°rias propriedades, em particular a estrat√©gia de armazenamento. </font><font style="vertical-align: inherit;">Anteriormente, voc√™ s√≥ podia configur√°-lo em uma equipe</font></font><code>CREATE TYPE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para demonstra√ß√£o, n√£o criaremos um novo tipo de base, mas usaremos o -</font></font><code>tsquery</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Mas primeiro, crie um banco de dados separado e conecte-se a ele:</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">DATABASE</span> db;<font></font>
\c db</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Uma estrat√©gia de armazenamento √© usada para o tipo de dados tsquery </font></font><code>plain</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, para que as colunas das tabelas desse tipo obtenham a mesma estrat√©gia:</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">SELECT</span> typname,typstorage <span class="hljs-keyword">FROM</span> pg_type <span class="hljs-keyword">WHERE</span> typname = <span class="hljs-string">'tsquery'</span>;</code></pre><br>
<pre><code class="plaintext hljs"> typname | typstorage<font></font>
---------+------------<font></font>
 tsquery | p</code></pre><br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> queries (query <span class="hljs-type">tsquery</span>);
<span class="hljs-keyword">SELECT</span> attname, attstorage <span class="hljs-keyword">FROM</span> pg_attribute <span class="hljs-keyword">WHERE</span> attrelid = <span class="hljs-string">'queries'</span>::<span class="hljs-type">regclass</span> <span class="hljs-keyword">AND</span> attname = <span class="hljs-string">'query'</span>;</code></pre><br>
<pre><code class="plaintext hljs"> attname | attstorage<font></font>
---------+------------<font></font>
 query   | p</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se voc√™ precisar usar uma estrat√©gia diferente para novas tabelas, poder√° alterar o tipo de base:</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TYPE</span> <span class="hljs-type">tsquery</span> <span class="hljs-keyword">SET</span> (storage=<span class="hljs-keyword">external</span>);
<span class="hljs-keyword">SELECT</span> typname,typstorage <span class="hljs-keyword">FROM</span> pg_type <span class="hljs-keyword">WHERE</span> typname = <span class="hljs-string">'tsquery'</span>;</code></pre><br>
<pre><code class="plaintext hljs"> typname | typstorage<font></font>
---------+------------<font></font>
 tsquery | e</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O tipo de armazenamento nas novas tabelas tamb√©m ser√° alterado:</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> new_queries (query <span class="hljs-type">tsquery</span>);
<span class="hljs-keyword">SELECT</span> attname, attstorage <span class="hljs-keyword">FROM</span> pg_attribute <span class="hljs-keyword">WHERE</span> attrelid = <span class="hljs-string">'new_queries'</span>::<span class="hljs-type">regclass</span> <span class="hljs-keyword">AND</span> attname = <span class="hljs-string">'query'</span>;</code></pre><br>
<pre><code class="plaintext hljs"> attname | attstorage<font></font>
---------+------------<font></font>
 query   | e</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Deve-se ter em mente que a altera√ß√£o de uma estrat√©gia envolvendo o uso do TOAST </font></font><code>plain</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n√£o pode ser </font><font style="vertical-align: inherit;">alterada novamente para </font><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TYPE</span> <span class="hljs-type">tsquery</span> <span class="hljs-keyword">SET</span> (storage=plain);</code></pre><br>
<pre><code class="plaintext hljs">ERROR:  cannot change type's storage to PLAIN</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Portanto, os experimentos foram realizados em um banco de dados separado, o que n√£o √© uma pena excluir. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ALTER STATISTICS ... SET STATISTICS O</font></font></b></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
comando </font></font><code>CREATE STATISTICS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">permite coletar listas dos valores mais comuns para combina√ß√µes selecionadas de colunas da tabela. </font><font style="vertical-align: inherit;">O n√∫mero de valores mais comuns recolhidas √© determinado pelo par√¢metro </font></font><code>default_statistics_target</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">O valor para estat√≠sticas espec√≠ficas agora pode ser alterado com o comando:</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">STATISTICS</span>  <span class="hljs-keyword">SET</span> <span class="hljs-keyword">STATISTICS</span> _;</code></pre><br>
<b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RECEBA PRIMEIRO com a op√ß√£o WITH TIES</font></font></a></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Como voc√™ sabe, em</font></font><code>SELECT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vez de especificar um</font><font style="vertical-align: inherit;">comando</font><font style="vertical-align: inherit;">,</font></font><code>LIMIT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">voc√™ pode usar a sintaxe definida no padr√£o SQL:</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">SELECT</span> *
<span class="hljs-keyword">FROM</span> (<span class="hljs-keyword">VALUES</span> (<span class="hljs-number">1</span>,<span class="hljs-string">'1.1'</span>), (<span class="hljs-number">2</span>,<span class="hljs-string">'2.1'</span>), (<span class="hljs-number">2</span>,<span class="hljs-string">'2.2'</span>), (<span class="hljs-number">3</span>,<span class="hljs-string">'3.1'</span>)) t(a,b)
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> a
<span class="hljs-keyword">FETCH FIRST</span> <span class="hljs-number">2</span> <span class="hljs-keyword">ROWS</span> <span class="hljs-keyword">ONLY</span>;</code></pre><br>
<pre><code class="plaintext hljs"> a |  b  <font></font>
---+-----<font></font>
 1 | 1.1<font></font>
 2 | 2.1<font></font>
(2 rows)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora ele </font></font><code>FETCH</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">suporta a frase </font></font><code>WITH TIES</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, que adiciona √† sa√≠da todas as linhas "relacionadas" (linhas iguais √†s j√° selecionadas, se apenas a condi√ß√£o de classifica√ß√£o for levada em considera√ß√£o):</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">SELECT</span> *
<span class="hljs-keyword">FROM</span> (<span class="hljs-keyword">VALUES</span> (<span class="hljs-number">1</span>,<span class="hljs-string">'1.1'</span>), (<span class="hljs-number">2</span>,<span class="hljs-string">'2.1'</span>), (<span class="hljs-number">2</span>,<span class="hljs-string">'2.2'</span>), (<span class="hljs-number">3</span>,<span class="hljs-string">'3.1'</span>)) t(a,b)
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> a
<span class="hljs-keyword">FETCH FIRST</span> <span class="hljs-number">2</span> <span class="hljs-keyword">ROWS</span> <span class="hljs-keyword">WITH</span> TIES;</code></pre><br>
<pre><code class="plaintext hljs"> a |  b  <font></font>
---+-----<font></font>
 1 | 1.1<font></font>
 2 | 2.1<font></font>
 2 | 2.2<font></font>
(3 rows)</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fun√ß√µes internas e tipos de dados</font></font></h3><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">get_random_uuid A</font></font></b></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
nova fun√ß√£o</font></font><code>get_random_uuid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">retorna o valor UUID da vers√£o 4 (valor aleat√≥rio):</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">SELECT</span> gen_random_uuid();</code></pre><br>
<pre><code class="plaintext hljs">           gen_random_uuid            <font></font>
--------------------------------------<font></font>
 25e02793-80c0-438c-be07-c94b966c43ab</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A fun√ß√£o √© √∫til para gerar valores UUID exclusivos em sistemas distribu√≠dos. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anteriormente, era necess√°rio usar as bibliotecas uuid-ossp ou pgcrypto. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">min_scale e trim_scale para valores do tipo num√©rico</font></font></b></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
A fun√ß√£o </font></font><code>min_scale</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">determina o n√∫mero de d√≠gitos significativos na parte fracion√°ria do n√∫mero e a fun√ß√£o </font></font><code>trim_scale</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">descarta zeros </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><b><font style="vertical-align: inherit;">n√£o</font></b></a><font style="vertical-align: inherit;"> significativos </font><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">SELECT</span> n, min_scale(n), trim_scale(n) <span class="hljs-keyword">FROM</span> (<span class="hljs-keyword">VALUES</span>(<span class="hljs-number">42.42000</span>)) <span class="hljs-keyword">as</span> t(n);</code></pre><br>
<pre><code class="plaintext hljs">    n     | min_scale | trim_scale<font></font>
----------+-----------+------------<font></font>
 42.42000 |         2 |      42.42</code></pre><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gcd e lcm</font></font></b></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Reabastecimento na se√ß√£o de fun√ß√µes matem√°ticas. </font><font style="vertical-align: inherit;">Agora voc√™ pode encontrar rapidamente o maior divisor comum (</font></font><code>gcm</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) e o menor m√∫ltiplo comum (</font></font><code>lcm</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">):</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">SELECT</span> gcd(<span class="hljs-number">54</span>,<span class="hljs-number">24</span>), lcm(<span class="hljs-number">54</span>,<span class="hljs-number">24</span>);</code></pre><br>
<pre><code class="plaintext hljs"> gcd | lcm<font></font>
-----+-----<font></font>
   6 | 216</code></pre><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fun√ß√µes agregadas min e max para o tipo pg_lsn</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> As fun√ß√µes agregadas foram adicionadas ao</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
tipo de dados</font><font style="vertical-align: inherit;">e</font><font style="vertical-align: inherit;">permitem executar consultas no formul√°rio:</font></font><code>pg_lsn</code><font style="vertical-align: inherit;"></font><code>min</code><font style="vertical-align: inherit;"></font><code>max</code><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">SELECT</span> min(restart_lsn) <span class="hljs-keyword">FROM</span> pg_replication_slots;
<span class="hljs-keyword">SELECT</span> min(sent_lsn) <span class="hljs-keyword">FROM</span> pg_stat_replication;</code></pre><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Verificando o modificador de tipo do valor de retorno de uma fun√ß√£o</font></font></b></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Nas vers√µes anteriores, o modificador de tipo n√£o foi verificado quanto ao valor de retorno da fun√ß√£o. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Suponha que exista um tipo para armazenar unidades monet√°rias e uma fun√ß√£o que retorne o valor do imposto de renda:</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TYPE</span> currency <span class="hljs-keyword">AS</span> (<font></font>
    amount <span class="hljs-type">numeric</span>(<span class="hljs-number">18</span>,<span class="hljs-number">2</span>),<font></font>
    code   <span class="hljs-type">text</span><font></font>
);<font></font>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">FUNCTION</span> income_tax(quantity currency) <span class="hljs-keyword">RETURNS</span> currency
    <span class="hljs-keyword">AS</span> <span class="hljs-string">'SELECT quantity.amount * 0.13, quantity.code'</span> <span class="hljs-keyword">LANGUAGE</span> <span class="hljs-keyword">SQL</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Chamando a fun√ß√£o, esperamos obter duas casas decimais, no entanto, obtemos quatro. </font><font style="vertical-align: inherit;">Mesmo a convers√£o expl√≠cita ap√≥s uma chamada de fun√ß√£o n√£o ajuda (terceira coluna):</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">SELECT</span> amount, code, amount::<span class="hljs-type">numeric</span>(<span class="hljs-number">18</span>,<span class="hljs-number">2</span>)
<span class="hljs-keyword">FROM</span> income_tax(<span class="hljs-keyword">ROW</span>(<span class="hljs-number">42.42</span>, <span class="hljs-string">''</span>))\gx</code></pre><br>
<pre><code class="plaintext hljs">-[ RECORD 1 ]--<font></font>
amount | 5.5146<font></font>
code   | <font></font>
amount | 5.5146</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na vers√£o 13, o resultado est√° correto:</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">SELECT</span> amount, code, amount::<span class="hljs-type">numeric</span>(<span class="hljs-number">18</span>,<span class="hljs-number">2</span>)
<span class="hljs-keyword">FROM</span> income_tax(<span class="hljs-keyword">ROW</span>(<span class="hljs-number">42.42</span>, <span class="hljs-string">''</span>))\gx</code></pre><br>
<pre><code class="plaintext hljs">-[ RECORD 1 ]<font></font>
amount | 5.51<font></font>
code   | <font></font>
amount | 5.51</code></pre><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Os nomes localizados em to_date () e to_timestamp ()</font></font></b></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Fun√ß√µes</font></font><code>to_date</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tamb√©m</font></font><code>to_timestamp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aprendeu a compreender os nomes localizados dos meses e dias da semana. </font><font style="vertical-align: inherit;">Anteriormente, apenas nomes em ingl√™s podiam ser usados:</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">SELECT</span> to_date(<span class="hljs-string">', 24  2020'</span>, <span class="hljs-string">'TMDay, DD TMMonth YYYY'</span>);</code></pre><br>
<pre><code class="plaintext hljs">  to_date   <font></font>
------------<font></font>
 2020-03-24</code></pre><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">normalize e IS NORMALIZED</font></font></b></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Para estar em conformidade com o padr√£o SQL, a fun√ß√£o normalize () foi adicionada para normalizar uma sequ√™ncia Unicode e o predicado IS NORMALIZED para verificar se uma sequ√™ncia √© normalizada.</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">SELECT</span> str, normalize(str, NFC) <span class="hljs-keyword">AS</span> nfc,<font></font>
       str <span class="hljs-keyword">IS</span> NFC NORMALIZED <span class="hljs-keyword">AS</span> is_nfc_normalized,<font></font>
       normalize(str, NFKC) <span class="hljs-keyword">AS</span> nfkc,<font></font>
       str <span class="hljs-keyword">IS</span> NFKC NORMALIZED <span class="hljs-keyword">AS</span> is_nfkc_normalized
<span class="hljs-keyword">FROM</span> (<span class="hljs-keyword">VALUES</span>(<span class="hljs-string">U&amp;'\0032\2075'</span>)) <span class="hljs-keyword">AS</span> vals(str)\gx</code></pre><br>
<pre><code class="plaintext hljs">-[ RECORD 1 ]------+---<font></font>
str                | 2‚Åµ<font></font>
nfc                | 2‚Åµ<font></font>
is_nfc_normalized  | t<font></font>
nfkc               | 25<font></font>
is_nfkc_normalized | f</code></pre><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Leia mais</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sobre os formul√°rios de normaliza√ß√£o do UNICODE. </font></font><br>
<br>
<b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fun√ß√£o Xid8 type e xid8_current () para n√∫meros de transa√ß√µes de 64 bits</font></font></a></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Adicionado um novo tipo de dados xid8 para o n√∫mero de transa√ß√£o de 64 bits. Mas n√£o, isso n√£o significa que o PostgreSQL mudou para transa√ß√µes de 64 bits: tudo funciona exatamente como antes. Mas algumas fun√ß√µes retornam um novo tipo, por exemplo, agora √© recomendado para uso em vez das antigas fun√ß√µes pg_current_xact_id txid_current, que retornou int8, e assim por diante. N. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Novos tipos de dados polim√≥rfica fam√≠lia anycompatible</font></font></b></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
tipos acrescentou </font></font><code>anycompatible</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>anycompatiblearray</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>anycompatiblenonarray</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>anycompatiblerange</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Ao contr√°rio dos tipos de fam√≠lia </font></font><code>anyelement</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, novos tipos permitem que voc√™ use n√£o exatamente o mesmo, mas tipos realmente compat√≠veis. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No exemplo a seguir, a fun√ß√£o</font></font><code>maximum</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">como argumentos definidos como </font></font><code>anycompatible</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s√£o passados </font></font><code>integer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><code>numeric</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">O valor de retorno √© convertido em um valor comum para esses dois tipos:</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">FUNCTION</span> maximum(a anycompatible, b anycompatible) <span class="hljs-keyword">RETURNS</span> anycompatible
	<span class="hljs-keyword">AS</span> <span class="hljs-string">'SELECT CASE WHEN a &gt; b THEN a ELSE b END'</span> <span class="hljs-keyword">LANGUAGE</span> <span class="hljs-keyword">SQL</span>;<font></font>
<font></font>
<span class="hljs-keyword">SELECT</span> f, pg_typeof(f) <span class="hljs-keyword">FROM</span> maximum(<span class="hljs-number">42</span>, <span class="hljs-number">42.42</span>) f;</code></pre><br>
<pre><code class="plaintext hljs">   f   | pg_typeof<font></font>
-------+-----------<font></font>
 42.42 | numeric</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al√©m disso, os tipos anycompatible- e any- s√£o dois conjuntos independentes de tipos:</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">FUNCTION</span> first_elems(a <span class="hljs-type">anyarray</span>, b anycompatiblearray)
    <span class="hljs-keyword">RETURNS</span> <span class="hljs-keyword">TABLE</span>(a <span class="hljs-type">anyelement</span>, b anycompatible) <span class="hljs-keyword">AS</span> $$<span class="pgsql">
        <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">ROW</span>(a[array_lower(a,<span class="hljs-number">1</span>)], b[array_lower(b,<span class="hljs-number">1</span>)]);
    $$</span> <span class="hljs-keyword">LANGUAGE</span> <span class="hljs-keyword">sql</span>;
<span class="hljs-keyword">SELECT</span> first_elems(<span class="hljs-keyword">ARRAY</span>[<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>], <span class="hljs-keyword">ARRAY</span>[<span class="hljs-string">'a'</span>,<span class="hljs-string">'b'</span>,<span class="hljs-string">'c'</span>]) <span class="hljs-keyword">AS</span> str, <font></font>
       first_elems(<span class="hljs-keyword">ARRAY</span>[<span class="hljs-number">1.1</span>,<span class="hljs-number">2.2</span>,<span class="hljs-number">3.3</span>],<span class="hljs-keyword">ARRAY</span>[<span class="hljs-keyword">true</span>,<span class="hljs-keyword">false</span>]) <span class="hljs-type">bool</span>;</code></pre><br>
<pre><code class="plaintext hljs">  str  |  bool   <font></font>
-------+---------<font></font>
 (1,a) | (1.1,t)</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L√≠nguas processuais</font></font></h3><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Transforma√ß√£o para o tipo bool no PL / Perl</font></font></b></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Mais recentemente, TRANSFORM de Ivan Panchenko (Postgres Professional) -</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> bool_plperl foi confirmado</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">O Postgres passa valores booleanos para</font></font><code>t</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou</font><font style="vertical-align: inherit;">em PL / Perl</font></font><code>f</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, mas para Perl n√£o</font></font><code>f</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√© um</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> falso</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> booleano</font><font style="vertical-align: inherit;">, mas apenas a letra f, ou seja, </font><font style="vertical-align: inherit;">em um contexto l√≥gico,</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> verdade</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Esse problema pode ser resolvido de diferentes maneiras (consulte a</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> correspond√™ncia</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), mas criar TRANSFORM para bool, de acordo com Tom Lane, √© o mais pr√°tico. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Execu√ß√£o r√°pida de express√µes simples em PL / pgSQL</font></font></b></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Express√µes simples (pelo menos n√£o contendo chamadas de tabela e n√£o exigindo bloqueios) ser√£o mais r√°pidas. </font><font style="vertical-align: inherit;">Anteriormente, nesses casos, o tempo era improdutivo em contato com o planejador em cada ciclo.</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">OR REPLACE</span> <span class="hljs-keyword">FUNCTION</span> slow_pi() <span class="hljs-keyword">RETURNS</span> <span class="hljs-type">double</span> <span class="hljs-type">precision</span> <span class="hljs-keyword">AS</span> $$<span class="pgsql">
    <span class="hljs-keyword">DECLARE</span>
        a <span class="hljs-type">double</span> <span class="hljs-type">precision</span> := <span class="hljs-number">1</span>;
        s <span class="hljs-type">double</span> <span class="hljs-type">precision</span> := <span class="hljs-number">1</span>;
        r <span class="hljs-type">double</span> <span class="hljs-type">precision</span> := <span class="hljs-number">0</span>;
    <span class="hljs-keyword">BEGIN</span>
        <span class="hljs-keyword">FOR</span> i <span class="hljs-keyword">IN</span> <span class="hljs-number">1</span> .. <span class="hljs-number">10000000</span> <span class="hljs-keyword">LOOP</span>
            r := r + s/a; a := a + <span class="hljs-number">2</span>; s := -s;
        <span class="hljs-keyword">END</span> <span class="hljs-keyword">LOOP</span>;
        <span class="hljs-keyword">RETURN</span> <span class="hljs-number">4</span>*r;
    <span class="hljs-keyword">END</span>;
    $$</span> <span class="hljs-keyword">LANGUAGE</span> plpgsql;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ligue para slow_pi () no PG12:</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">SELECT</span> slow_pi();</code></pre><br>
<pre><code class="plaintext hljs">          slow_pi      <font></font>
    --------------------<font></font>
     3.1415925535898497<font></font>
    (1 row)<font></font>
    Time: 13060,650 ms (00:13,061)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora na PG13:</font></font><br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">SELECT</span> slow_pi();</code></pre><br>
<pre><code class="plaintext hljs">          slow_pi      <font></font>
    --------------------<font></font>
     3.1415925535897915<font></font>
    (1 row)<font></font>
    Time: 2108,464 ms (00:02,108)</code></pre><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Extens√µes confi√°veis ‚Äã‚Äãem vez de pg_pltemplate</font></font></b></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
O diret√≥rio do sistema diminuiu uma tabela. </font><font style="vertical-align: inherit;">Exclu√≠do</font></font><code>pg_pltemplate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Ele armazenou as propriedades das linguagens procedurais necess√°rias durante a execu√ß√£o</font></font><code>CREATE LANGUAGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Agora decidimos registrar as propriedades nos scripts de extens√µes dos idiomas correspondentes</font></font><code>pg_pltemplate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e nos livrar da pr√≥pria tabela. </font><font style="vertical-align: inherit;">Mas, para implementar o plano, √© necess√°rio prever a possibilidade do propriet√°rio do banco de dados (sem direitos de superusu√°rio) criar um idioma confi√°vel a partir do script de extens√£o. </font><font style="vertical-align: inherit;">De fato, agora para criar, por exemplo, plpgsql, o propriet√°rio do banco de dados n√£o precisa ser superusu√°rio. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Recebido da seguinte forma. </font><font style="vertical-align: inherit;">Um novo par√¢metro l√≥gico apareceu no arquivo de controle para extens√µes</font></font><code>trusted</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Se ambos os par√¢metros</font></font><code>trusted</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e</font></font><code>superuser</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">inclu√≠da, a extens√£o pode ser criada n√£o apenas pelo superusu√°rio, mas tamb√©m pelo usu√°rio com direito </font></font><code>CREATE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ao banco de dados atual (e, portanto, seu propriet√°rio). </font><font style="vertical-align: inherit;">Ao executar um script dessa extens√£o, ser√£o utilizados os direitos de superusu√°rio que inicializaram o cluster. </font><font style="vertical-align: inherit;">Os objetos criados pela extens√£o pertencer√£o a ela, embora o propriet√°rio da pr√≥pria extens√£o seja o usu√°rio criador. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Consequ√™ncias importantes dessas mudan√ßas:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As extens√µes confi√°veis ‚Äã‚Äãabrem caminho para que desenvolvedores de terceiros criem outros idiomas confi√°veis. </font><font style="vertical-align: inherit;">Agora estamos limitados apenas a plpgsql, plperl e pltcl.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Foi </font></font><code>pg_pltemplate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dif√≠cil escrever que plpython se refere √† segunda vers√£o da linguagem. </font><font style="vertical-align: inherit;">N√£o </font></font><code>pg_pltemplate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fazer isso √© uma etapa (necess√°ria, embora n√£o suficiente) para a transi√ß√£o para o python 3.</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√çndices</font></font></h3><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Compress√£o da √°rvore B</font></font></b></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Um patch importante e aguardado (o trabalho j√° come√ßou em 2015), escrito por Anastasia Lubennikova (Postgres Professional) e Peter Geigan (Peter Geoghegan), finalmente √© comunicado por Peter. Nastya conseguiu</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> falar</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sobre isso</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"> no PGconf √çndia</font></a><font style="vertical-align: inherit;"> . O Postgres aprendeu a reduzir significativamente o tamanho dos √≠ndices da √°rvore B por meio da deduplica√ß√£o, ou seja, economia em chaves de √≠ndice duplicadas. Esses √≠ndices foram seriamente redesenhados para que a compacta√ß√£o seja poss√≠vel sem perda de compatibilidade com vers√µes anteriores de √≠ndices. A id√©ia de desduplica√ß√£o √© retirada de uma arquitetura mais flex√≠vel de √≠ndices como</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> GIN</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (√≠ndices reversos - √çndice Invertido Generalizado).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nestes √≠ndices mais frequentemente do que na</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √°rvore B</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, existe uma situa√ß√£o em que uma chave corresponde a um grande n√∫mero de registros. No caso do processamento de texto, por exemplo, o mesmo token geralmente √© encontrado em v√°rios documentos. E √© armazenado no √≠ndice apenas uma vez. At√© recentemente, os √≠ndices das √°rvores B n√£o sabiam como fazer isso. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os √≠ndices das √°rvores B diferem dos √≠ndices GIN principalmente nas p√°ginas de folha. Dependendo do n√∫mero de registros relacionados ao mesmo valor-chave, s√£o poss√≠veis op√ß√µes: a p√°gina cont√©m apenas uma lista de lan√ßamentos - uma lista de TIDs (identificadores de registros indexados), se a lista √© pequena e se existem muitos TIDs, em vez de uma lista de valores ser armazenada novos "galhos de √°rvores" - links para outras p√°ginas, como a lista de lan√ßamentos ou outros galhos de √°rvores (eles s√£o chamados de √°rvore de lan√ßamentos).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Essa estrutura de √°rvore √© semelhante a uma √°rvore B, mas difere em detalhes essenciais: por exemplo, as listas para mover-se pelas p√°ginas do mesmo n√≠vel de √°rvore no GIN s√£o unidirecionais e n√£o bidirecionais. Portanto, n√£o √© f√°cil obter (inclusive) uma boa compatibilidade de novos √≠ndices deduplicados com vers√µes antigas. E as melhorias realmente levaram mais de 3 anos. Tamb√©m era necess√°rio elaborar o mecanismo de limpeza (microv√°cuo) e outras nuances. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nos testes de desempenho, todos os √≠ndices aos quais a deduplica√ß√£o √© aplic√°vel diminu√≠ram cerca de 3 vezes. A compacta√ß√£o de duplicatas tamb√©m ajuda a √≠ndices exclusivos, eliminando o problema de aumento de √≠ndice em uma alta taxa de altera√ß√µes na tabela. Um novo comportamento pode ser conectado e desconectado no n√≠vel de configura√ß√µes do √≠ndice. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A verifica√ß√£o completa pelo √≠ndice GIN n√£o √© feita onde n√£o √© necess√°ria</font></font></b></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esse patch permite, em alguns casos, evitar uma passagem completa por todo o √≠ndice GIN. </font><font style="vertical-align: inherit;">Algumas opera√ß√µes, embora suportadas pelo √≠ndice GIN, s√£o executadas por uma varredura completa do √≠ndice. </font><font style="vertical-align: inherit;">Pegue, por exemplo, o √≠ndice para pesquisa de coluna em texto completo </font></font><code>tsvector</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Se a consulta de pesquisa tiver o formato "qualquer coisa, exceto uma palavra espec√≠fica", o √≠ndice inteiro dever√° ser lido na √≠ntegra. </font><font style="vertical-align: inherit;">Se, no entanto, houver outra condi√ß√£o na solicita√ß√£o que n√£o exija uma verifica√ß√£o completa do √≠ndice, o √≠ndice ainda ser√° verificado completamente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Com a nova otimiza√ß√£o, uma condi√ß√£o mais precisa ser√° usada primeiro, permitindo obter um ganho do √≠ndice e, em seguida, os resultados ser√£o verificados duas vezes para levar em conta outra limita√ß√£o. </font><font style="vertical-align: inherit;">Compare o n√∫mero de p√°ginas que foram lidas na vers√£o 12 (buffers):</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">EXPLAIN</span> (<span class="hljs-keyword">ANALYZE</span>, <span class="hljs-keyword">BUFFERS</span>, <span class="hljs-keyword">COSTS</span> <span class="hljs-keyword">OFF</span>, <span class="hljs-keyword">TIMING</span> <span class="hljs-keyword">OFF</span>)
<span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> mail_messages <span class="hljs-keyword">WHERE</span> tsv @@ to_tsquery(<span class="hljs-string">'!vacuum'</span>) <span class="hljs-keyword">AND</span> tsv @@ to_tsquery(<span class="hljs-string">'analyze'</span>);</code></pre><br>
<pre><code class="plaintext hljs">                                             QUERY PLAN                                             <font></font>
------------------------------------------------------------------<font></font>
Bitmap Heap Scan on mail_messages (actual rows=5864 loops=1)<font></font>
   Recheck Cond: ((tsv @@ to_tsquery('!vacuum'::text)) AND (tsv @@ to_tsquery('analyze'::text)))<font></font>
   Heap Blocks: exact=5167<font></font>
   Buffers: shared hit=24 read=27405<font></font>
   -&gt;  Bitmap Index Scan on mail_messages_tsv_idx (actual rows=5864 loops=1)<font></font>
         Index Cond: ((tsv @@ to_tsquery('!vacuum'::text)) AND (tsv @@ to_tsquery('analyze'::text)))<font></font>
         Buffers: shared hit=24 read=22238<font></font>
 Planning Time: 0.283 ms<font></font>
 Execution Time: 3258.234 ms</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
com o n√∫mero de buffers na nova vers√£o:</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">EXPLAIN</span> (<span class="hljs-keyword">ANALYZE</span>, <span class="hljs-keyword">BUFFERS</span>, <span class="hljs-keyword">COSTS</span> <span class="hljs-keyword">OFF</span>, <span class="hljs-keyword">TIMING</span> <span class="hljs-keyword">OFF</span>)
<span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> mail_messages <span class="hljs-keyword">WHERE</span> tsv @@ to_tsquery(<span class="hljs-string">'!vacuum'</span>) <span class="hljs-keyword">AND</span> tsv @@ to_tsquery(<span class="hljs-string">'analyze'</span>);</code></pre><br>
<pre><code class="plaintext hljs">                                             QUERY PLAN                                             <font></font>
---------------------------------------------------------------------------<font></font>
Bitmap Heap Scan on mail_messages (actual rows=5864 loops=1)<font></font>
   Recheck Cond: ((tsv @@ to_tsquery('!vacuum'::text)) AND (tsv @@ to_tsquery('analyze'::text)))<font></font>
   Heap Blocks: exact=5156<font></font>
   Buffers: shared hit=5179<font></font>
   -&gt;  Bitmap Index Scan on mail_messages_tsv_idx (actual rows=5864 loops=1)<font></font>
         Index Cond: ((tsv @@ to_tsquery('!vacuum'::text)) AND (tsv @@ to_tsquery('analyze'::text)))<font></font>
         Buffers: shared hit=23<font></font>
 Planning Time: 0.250 ms<font></font>
 Execution Time: 8.779 ms</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Uma situa√ß√£o semelhante pode ser encontrada ao usar trigramas e ao verificar a ocorr√™ncia de matrizes. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Par√¢metros das classes de operadores</font></font></b></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
No PostgreSQL, muitos m√©todos de acesso ao √≠ndice s√£o uma ‚Äúestrutura‚Äù que assume uma implementa√ß√£o de alto n√≠vel do algoritmo de busca, trabalhando com p√°ginas e bloqueios, e o log do WAL. E a liga√ß√£o a tipos e operadores de dados espec√≠ficos √© realizada usando classes de operadores. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
At√© agora, as classes de operadores n√£o podiam ter par√¢metros. Por exemplo, para uma pesquisa em texto completo, um √≠ndice GiST com uma classe de operadores pode ser usado </font></font><code>tsvector_ops</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(sobre classes de operadores GiST </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqui</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) Essa classe de operadores usa uma √°rvore de assinaturas e o comprimento da assinatura foi corrigido (124 bytes). Agora voc√™ pode especificar explicitamente o comprimento, o que permite controlar o equil√≠brio entre o tamanho do √≠ndice e a efici√™ncia (o n√∫mero de colis√µes de hash):</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">INDEX</span> <span class="hljs-keyword">ON</span> mail_messages <span class="hljs-keyword">USING</span> gist(tsv tsvector_ops(siglen=<span class="hljs-number">1024</span>));</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Altera√ß√µes semelhantes para iniciantes foram feitas para outras classes de operadores GiST que usam uma √°rvore de assinaturas, que se aplica √†s extens√µes hstore, intarray, ltree e pg_trgm. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas a principal id√©ia para a qual essa altera√ß√£o foi concebida √© a capacidade de passar a express√£o JSONPath para o √≠ndice GIN, para que nem todo o documento JSON seja indexado, mas apenas a parte necess√°ria. Em muitos casos, isso reduzir√° radicalmente o tamanho dos √≠ndices. Mas esse trabalho ainda precisa ser feito. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A id√©ia de Oleg Bartunov, a implementa√ß√£o de Nikita Glukhov e Alexander Korotkov (todos os tr√™s profissionais do Postgres). </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O operador &lt;-&gt; (caixa, ponto) foi</font></font></b></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
adicionado.A opera√ß√£o ausente foi adicionada para uso no kNN para </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GiST</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SP-GiST</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Na PG12 ao trabalhar com tipos geom√©tricos </font></font><code>point</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e</font></font><code>box</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">voc√™ pode usar o operador de dist√¢ncia </font></font><code>&lt;-&gt;(point, box)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e agilizar√° a pesquisa com os √≠ndices GiST e SP-GiST. </font><font style="vertical-align: inherit;">Mas o operador sim√©trico para ele </font></font><code>&lt;-&gt;(box, point)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n√£o foi implementado, embora ele </font></font><code>box</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">j√° entendesse as dist√¢ncias para tipos mais complexos - pol√≠gonos e c√≠rculos.</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> points(<span class="hljs-type">point</span> <span class="hljs-type">point</span>);
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> boxes(<span class="hljs-type">box</span> <span class="hljs-type">box</span>);
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> points <span class="hljs-keyword">VALUES</span>(<span class="hljs-string">'1,2'</span>,<span class="hljs-string">'3,4'</span>);
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> boxes <span class="hljs-keyword">VALUES</span>(box(<span class="hljs-type">point</span>(<span class="hljs-number">3</span>,<span class="hljs-number">4</span>),<span class="hljs-type">point</span>(<span class="hljs-number">5</span>,<span class="hljs-number">6</span>)), box(<span class="hljs-type">point</span>(<span class="hljs-number">13</span>,<span class="hljs-number">14</span>),<span class="hljs-type">point</span>(<span class="hljs-number">15</span>,<span class="hljs-number">16</span>)));</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No PG12:</font></font><br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">SELECT</span> p.point, b.box, b.box  &lt;-&gt; p.point distance <span class="hljs-keyword">FROM</span> points <span class="hljs-keyword">AS</span> p, boxes <span class="hljs-keyword">AS</span> b <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> distance;</code></pre><br>
<pre><code class="plaintext hljs">:    : box &lt;-&gt; point</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se vice-versa, tudo est√° bem:</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">SELECT</span> p.point, b.box, p.point  &lt;-&gt; b.box distance <span class="hljs-keyword">FROM</span> points <span class="hljs-keyword">AS</span> p, boxes <span class="hljs-keyword">AS</span> b <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> distance;</code></pre><br>
<pre><code class="plaintext hljs"> point |       box       |      distance<font></font>
-------+-----------------+--------------------<font></font>
 (1,2) | (5,6),(3,4)     | 2.8284271247461903<font></font>
 (2,1) | (5,6),(3,4)     | 3.1622776601683795<font></font>
 (1,2) | (15,16),(13,14) | 16.970562748477143<font></font>
 (2,1) | (15,16),(13,14) | 17.029386365926403</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E no PG13:</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">SELECT</span> p.point, b.box, b.box  &lt;-&gt; p.point distance <span class="hljs-keyword">FROM</span> points <span class="hljs-keyword">AS</span> p, boxes <span class="hljs-keyword">AS</span> b <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> distance;</code></pre><br>
<pre><code class="plaintext hljs"> point |       box       |      distance<font></font>
-------+-----------------+--------------------<font></font>
 (1,2) | (5,6),(3,4)     | 2.8284271247461903<font></font>
 (2,1) | (5,6),(3,4)     | 3.1622776601683795<font></font>
 (1,2) | (15,16),(13,14) | 16.970562748477143<font></font>
 (2,1) | (15,16),(13,14) | 17.029386365926403</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os √≠ndices GiST e SP-GiST ser√£o acelerados nesta opera√ß√£o. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Observe que na PG13, se voc√™ perguntar:</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">SELECT</span> count(*) <span class="hljs-keyword">FROM</span> pg_operator <span class="hljs-keyword">WHERE</span> oprname = <span class="hljs-string">'&lt;-&gt;'</span>;</code></pre><pre><code class="plaintext hljs"> count <font></font>
-------<font></font>
    28</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
e se fizermos o mesmo na PG12, obteremos 20 entradas: na 13¬™ vers√£o, a lista foi reabastecida com at√© 8 operadores.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Json</font></font></h3><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Suporte ao m√©todo .datetime () para jsonpath</font></font></b></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Esse √© um dos patches malsucedidos de uma grande s√©rie de</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> patches JSONPath que o PG12</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> n√£o teve tempo para concluir. Parte do padr√£o JSON / SQL. O problema era que todas as fun√ß√µes da s√©rie de patches JSONPath s√£o imut√°veis, mas a compara√ß√£o de datas leva em considera√ß√£o o fuso hor√°rio atual, que pode mudar durante a sess√£o.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nesses casos, permitimos que as fun√ß√µes imut√°veis ‚Äã‚Äãexistentes gerem um erro sobre compara√ß√µes n√£o imut√°veis. Ao mesmo tempo, esse patch possui fun√ß√µes com o sufixo _tz que funcionam de maneira est√°vel nas opera√ß√µes com o fuso hor√°rio.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Nova fun√ß√£o - fun√ß√£o jsonb_set_lax</font></font></b></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em geral, lax √© um modo de opera√ß√£o n√£o estrito (ao contr√°rio de estrito) de fun√ß√µes com o jsonb. Nesse caso, essa fun√ß√£o estar√° operacional em uma situa√ß√£o em que um dos argumentos necess√°rios √© NULL. Diferente da vers√£o estrita - jsonb_set () - ele possui um argumento adicional que indica a√ß√µes no caso de NULL. Op√ß√µes: use_json_null / raise_exception / return_target / delete_key. Op√ß√µes sugeridas pelos usu√°rios interessados. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Otimizado algumas fun√ß√µes jsonb.</font></font></b></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Otimizado </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">muito.</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, principalmente atrav√©s dos esfor√ßos de Nikita Glukhov (Postgres Professional). </font><font style="vertical-align: inherit;">Mas analisar cada ponto neste caso √© in√∫til: primeiro, sua abund√¢ncia inflar√° um artigo j√° curto; </font><font style="vertical-align: inherit;">e segundo, as altera√ß√µes est√£o relacionadas ao dispositivo interno e nem todo usu√°rio est√° interessado. </font><font style="vertical-align: inherit;">Portanto, listaremos apenas a maioria deles:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fun√ß√£o otimizada JsonbExtractScalar ();</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Operador otimizado # &gt;&gt;, fun√ß√µes jsonb_each_text (), jsonb_array_elements_text ();</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O reconhecimento do tipo JsonbContainer em get_jsonb_path_all () √© otimizado;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A busca do primeiro token do iterador JsonbIterator √© substitu√≠da pela macro leve JsonbContainerIsXxx ();</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Extra√ß√£o de chave mais conveniente - findJsonbKeyInObject ();</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Armazenamento otimizado do resultado findJsonbValueFromContainer () e getIthJsonbValueFromContainer ();</font></font></li>
<li>  get_jsonb_path_all(),     ;<br>
  JsonbValueAsText.</li>
</ol><br>
<i> ,        SQL/JSON: JSON_TABLE  SQL/JSON: functions.       . ,   .      .     PG14.   JSONPath   .</i><br>
<br>
<h3>  </h3><br>
<h4>pgbench</h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O utilit√°rio para executar testes de desempenho recebeu uma s√©rie de melhorias. </font><font style="vertical-align: inherit;">Havia </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">estat√≠sticas sobre o desempenho das</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tarefas na fase de inicializa√ß√£o, uma </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">conclus√£o</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mais </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">visual</font></a><font style="vertical-align: inherit;"> , a capacidade de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ver o c√≥digo dos scripts internos</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , testando </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">em uma tabela de</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> contas </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">particionada</font></a><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al√©m disso, adicionamos um comando </font></font><code>\aset</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">semelhante a </font></font><code>\gset</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, mas permitindo definir valores para vari√°veis ‚Äã‚Äãde v√°rios pedidos enviados por vez. </font><font style="vertical-align: inherit;">A linha a seguir, enviada ao servidor para execu√ß√£o, define as vari√°veis </font></font><code>one</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><code>two</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">SELECT</span> <span class="hljs-number">1</span> <span class="hljs-keyword">AS</span> one \; <span class="hljs-keyword">SELECT</span> <span class="hljs-number">2</span> <span class="hljs-keyword">AS</span> two \aset</code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pg_dump</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O pg_dump aprendeu a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">descarregar dados de tabelas de terceiros</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Atrav√©s do par√¢metro, </font></font><code>--include-foreign-data</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">voc√™ pode especificar uma lista de servidores de terceiros, cujos dados das tabelas ser√£o descarregados. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Use esta descarga com cuidado. </font><font style="vertical-align: inherit;">Longe do fato de que os dados devem ser enviados para um servidor de terceiros. </font><font style="vertical-align: inherit;">Al√©m disso, √© bem poss√≠vel que um servidor de terceiros n√£o esteja dispon√≠vel durante a recupera√ß√£o. </font><font style="vertical-align: inherit;">Ou um servidor de terceiros pode permitir apenas a leitura, mas n√£o a grava√ß√£o de dados.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">psql</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Uma s√©rie de pequenas corre√ß√µes torna o psql mais confort√°vel:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclus√£o de guia aprimorada para v√°rias equipes.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Al√©m de </font></font><code>\echo</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">enviar uma sequ√™ncia para STDOUT, um novo comando </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>\warn</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">envia uma sequ√™ncia para a sa√≠da de erro padr√£o (STDERR).</font></font></li>
<li> <code>\d</code> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> toast-</a>       .        <code>\d+</code>        .</li>
<li>  <code>\dt+</code> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">  ¬´Persistence¬ª</a>      (unlogged)   (permanent).</li>
<li>  <code>\e</code>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">  </a>,       <code>;</code> (  <code>\g*</code>). ,       psql      .</li>
<li>         .     <code>PROMPT1</code>  <code>PROMPT2</code> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> </a> <code>%x</code>.</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Novos comandos</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para obter mais informa√ß√µes sobre m√©todos de acesso: </font></font><code>\dAc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>\dAf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>\dAo</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font><code>\dAp</code></li>
<li><font style="vertical-align: inherit;"></font><code>\g</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agora </font><font style="vertical-align: inherit;">voc√™ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pode especificar</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> entre colchetes todas as op√ß√µes suportadas </font></font><code>\pset</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Eles atuar√£o apenas na equipe atual.</font></font></li>
</ul><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">libpq</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pequenas altera√ß√µes em conex√£o com o PostgreSQL:</font></font><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A imprecis√£o</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> na descri√ß√£o dos par√¢metros host e hostadr e a inconsist√™ncia resultante na sa√≠da do </font></font><code>\conninfo</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">comando do utilit√°rio psql foram corrigidas.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se a chave do certificado do cliente estiver armazenada no formato criptografado, voc√™ poder√° inserir a senha apenas no modo interativo. </font><font style="vertical-align: inherit;">O novo par√¢metro </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sslpassword permite</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> descriptografar a chave de maneira n√£o interativa.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dois novos par√¢metros, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sslminprotocolversion e sslmaxprotocolversion,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> permitem especificar uma restri√ß√£o na vers√£o do protocolo SSL / TCL com a qual a conex√£o √© permitida.</font></font></li>
</ul><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">reindexdb</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O novo par√¢metro </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--jobs do</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> utilit√°rio </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">reindexdb</font></a><font style="vertical-align: inherit;"> define o n√∫mero de conex√µes com o banco de dados nas quais os √≠ndices ser√£o reconstru√≠dos ao mesmo tempo.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pg_rewind</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As limita√ß√µes do utilit√°rio est√£o sendo gradualmente removidas e as possibilidades est√£o aumentando. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Primeiro, o pg_rewind </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">agora pode</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> registrar informa√ß√µes para recupera√ß√£o (como o pg_basebackup pode fazer isso), bem como iniciar a recupera√ß√£o e o desligamento subsequente de uma inst√¢ncia se n√£o tiver sido interrompida por um ponto de verifica√ß√£o (isso tinha que ser feito manualmente antes). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em segundo lugar, pg_rewind aprendeu a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">trabalhar com o arquivo WAL</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Depois que o utilit√°rio encontrar o ponto de diverg√™ncia do WAL entre os dois servidores, ele dever√° criar uma lista de todas as p√°ginas que precisam ser copiadas no cluster de destino para eliminar as diferen√ßas. </font><font style="vertical-align: inherit;">Para isso, o utilit√°rio requer todos os arquivos WAL, come√ßando no ponto encontrado. </font><font style="vertical-align: inherit;">Se os arquivos WAL necess√°rios n√£o estiverem dispon√≠veis no cluster de destino, o utilit√°rio n√£o poder√° executar seu trabalho antes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Com esse patch de Alexey Kondratov (Postgres Professional), o pg_rewind poder√° ler os segmentos WAL ausentes do arquivo morto dos arquivos de log usando o par√¢metro restore_command se uma nova op√ß√£o -c ou --restore-target-wal for especificada.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pg_waldump</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O pg_waldump </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">descriptografar√°</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> o </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">registro de</font></a><font style="vertical-align: inherit;"> transa√ß√£o preparado.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">amcheck</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A extens√£o amcheck aprendeu a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">reconhecer melhor os danos</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nos √≠ndices das √°rvores B. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A prop√≥sito, agora as mensagens no log do servidor sobre p√°ginas danificadas ser√£o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">diferentes para √≠ndices e tabelas</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pageinspect</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A </font></font><code>heap_tuple_infomask_flags</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fun√ß√£o de extens√£o pageinspect </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">descriptografa os valores dos campos</font></font></a> <code>infomask</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><code>infomask2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">retornados pela fun√ß√£o </font></font><code>heap_page_items</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">√ötil na investiga√ß√£o de situa√ß√µes de corrup√ß√£o de dados.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">postgres_fdw</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O superusu√°rio no n√≠vel de mapeamento de nome de usu√°rio pode </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">permitir que usu√°rios comuns</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> usem uma conex√£o sem uma senha:</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">USER</span> <span class="hljs-keyword">MAPPING</span> <span class="hljs-keyword">FOR</span>  <span class="hljs-keyword">SERVER</span> 
    <span class="hljs-keyword">OPTIONS</span> (<span class="hljs-keyword">ADD</span> password_required <span class="hljs-string">'false'</span>);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Isso √© feito, entre outras coisas, para que </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sslkey e sslcert</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> possam ser usados ‚Äã‚Äãcomo par√¢metros de conex√£o </font><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">adminpack</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A extens√£o adminpack possui um novo recurso - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>pg_file_sync</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Usando-o, voc√™ pode executar o fsync para arquivos gravados pelo servidor no disco, por exemplo, via </font></font><code>pg_file_write</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou </font></font><code>COPY TO</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Monitoramento</font></font></h3><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pg_stat_slru</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A mem√≥ria compartilhada do servidor cont√©m n√£o apenas um cache de buffer grande, mas tamb√©m v√°rios outros caches mais simples (por exemplo, para o status da transa√ß√£o). </font><font style="vertical-align: inherit;">Eles usam um algoritmo simples para agrupar as p√°ginas menos usadas (simples, menos usada recentemente ou SLRU). </font><font style="vertical-align: inherit;">At√© agora, esses caches ‚Äúapenas funcionavam‚Äù, mas havia a necessidade de monitor√°-los, principalmente para os desenvolvedores do kernel do PostgreSQL descobrirem se algo precisa ser alterado neles. </font><font style="vertical-align: inherit;">Para isso e para isso, uma nova exibi√ß√£o de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pg_stat_slru apareceu</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pg_stat_activity</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na visualiza√ß√£o, a </font></font><code>pg_stat_activity</code> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nova coluna</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √© </font></font><code>leader_id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Para processos que participam de solicita√ß√µes paralelas, ele √© preenchido com o n√∫mero do processo principal. </font><font style="vertical-align: inherit;">E processo principal </font></font><code>leader_id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√© um n√∫mero de processo </font></font><code>pid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A consulta a seguir mostra quais consultas e quais processos est√£o sendo executados atualmente em paralelo:</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">SELECT</span> query, leader_pid, <font></font>
    array_agg(pid) <span class="hljs-keyword">filter</span>(<span class="hljs-keyword">WHERE</span> leader_pid != pid) <span class="hljs-keyword">AS</span> members
  <span class="hljs-keyword">FROM</span> pg_stat_activity
 <span class="hljs-keyword">WHERE</span> leader_pid <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>
 <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> query, leader_pid;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
H√° altera√ß√µes na lista de eventos em espera. </font><font style="vertical-align: inherit;">Adicionado </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dois novos eventos</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><code>BackupWaitWalArchive</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><code>RecoveryPause</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">E os outros dois receberam nomes mais precisos: </font></font><code>RecoveryWalStream -&gt; RecoveryRetrieveRetryInterval</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>RecoveryWalAll -&gt; RecoveryWalStream</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mais dois novos eventos de espera que ocorrem na r√©plica</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><code>RecoveryConflictSnapshot</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(conflito com VACUUM, que excluiu a vers√£o necess√°ria das linhas) e </font></font><code>RecoveryConflictTablespace</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(conflito relacionado √† remo√ß√£o do espa√ßo de tabela).</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pg_stat_statements</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
At√© agora, a extens√£o </font></font><code>pg_stat_statements</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tratava solicita√ß√µes com </font></font><code>FOR UPDATE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e sem uma frase como a mesma solicita√ß√£o. Agora, os pedidos com </font></font><code>FOR UPDATE</code> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s√£o gravados separadamente</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A quantidade de informa√ß√µes coletadas aumentou. A partir de agora, n√£o apenas as informa√ß√µes sobre recursos para a execu√ß√£o de comandos s√£o registradas, mas tamb√©m </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">estat√≠sticas sobre lan√ßamentos cont√°beis manuais gerados</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Novas colunas de apresenta√ß√£o: </font></font><code>wal_bytes</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- volume de registros gerados, </font></font><code>wal_records</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- n√∫mero de registros gerados, </font></font><code>wal_num_fpw</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- n√∫mero de imagens de p√°gina inteira (grava√ß√£o de p√°gina inteira). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Isso foi poss√≠vel gra√ßas √† </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">infraestrutura preparada</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para rastrear o uso do WAL. Portanto, agora </font></font><code>EXPLAIN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">com uma nova op√ß√£o, ele </font></font><code>WAL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mostrar√° o volume de registros gerados:</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> t (id <span class="hljs-type">int</span>);
<span class="hljs-keyword">EXPLAIN</span> (<span class="hljs-keyword">ANALYZE</span>, WAL, <span class="hljs-keyword">COSTS</span> <span class="hljs-keyword">OFF</span>, <span class="hljs-keyword">TIMING</span> <span class="hljs-keyword">OFF</span>, <span class="hljs-keyword">SUMMARY</span> <span class="hljs-keyword">OFF</span>)
    <span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> t <span class="hljs-keyword">VALUES</span>(<span class="hljs-number">1</span>);</code></pre><br>
<pre><code class="plaintext hljs">              QUERY PLAN              <font></font>
--------------------------------------<font></font>
 Insert on t (actual rows=0 loops=1)<font></font>
   WAL:  records=1  bytes=59<font></font>
   -&gt;  Result (actual rows=1 loops=1)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Extens√£o </font></font><code>auto_explain</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>VACUUM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s </font></font><code>VERBOSE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, e </font></font><code>autovacuum</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tamb√©m utilizar os volumes de infra-estrutura e de sa√≠da ser√° criado de WAL. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voltando para </font></font><code>pg_stat_statements</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Se o novo par√¢metro </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pg_stat_statements.track_planning estiver ativado</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , ser√£o registradas estat√≠sticas adicionais relacionadas a cada operador para o planejador: o n√∫mero de compila√ß√µes do plano; </font><font style="vertical-align: inherit;">tempo total de planejamento; </font><font style="vertical-align: inherit;">tempo m√≠nimo e m√°ximo de um planejamento, bem como m√©dia e desvio padr√£o. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A contabiliza√ß√£o dos recursos alocados ao planejador √© refletida em outro patch que n√£o est√° relacionado </font></font><code>pg_stat_statements</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><code>EXPLAIN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">com a op√ß√£o </font></font><code>BUFFERS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">relatar√° o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n√∫mero de buffers usados ‚Äã‚Äãno est√°gio de planejamento</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">EXPLAIN</span> (<span class="hljs-keyword">ANALYZE</span>, <span class="hljs-keyword">BUFFERS</span>, <span class="hljs-keyword">COSTS</span> <span class="hljs-keyword">OFF</span>, <span class="hljs-keyword">TIMING</span> <span class="hljs-keyword">OFF</span>) 
    <span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> pg_class;</code></pre><br>
<pre><code class="plaintext hljs">                   QUERY PLAN                   <font></font>
------------------------------------------------<font></font>
 Seq Scan on pg_class (actual rows=386 loops=1)<font></font>
   Buffers: shared hit=9 read=4<font></font>
 Planning Time: 0.782 ms<font></font>
   Buffers: shared hit=103 read=11<font></font>
 Execution Time: 0.219 ms</code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Revista</font></font></h4><br>
<ul>
<li> <code>log_statement_sample_rate</code>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">   SQL,   </a>,      <code>log_min_duration_sample</code>( ).<br>
,    <code>log_min_duration_statement</code>    , ..  <code>log_min_duration_statement</code> ,  <code>log_min_duration_sample</code>,       ,      <code>log_statement_sample_rate</code>.<br>
 ,   <code>log_transaction_sample_rate</code>    ,       ,      .</li>
<li>  ,   (   log_min_error_statement),         .          <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>log_parameter_max_length_on_error</code></a>.     0,   .<br>
 <code>log_parameter_max_length_on_error</code>          SQL,    ,      .<br>
    (     <code>log_statements</code>  <code>log_duration</code>)   ,  : <code>log_parameter_max_length</code>,     ,   .</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agora voc√™ pode </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gravar o tipo de processo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font></font><code>pg_stat_activity.backend_type</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) no </font><font style="vertical-align: inherit;">log </font><font style="vertical-align: inherit;">do </font><font style="vertical-align: inherit;">servidor </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Para isso </font></font><code>log_line_prefix</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, um s√≠mbolo especial √© fornecido </font><font style="vertical-align: inherit;">no par√¢metro </font></font><code>%b</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">E se o log for gravado no formato csv ( </font></font><code>log_destination=csvlog</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), a coluna </font></font><code>backend_type</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">j√° </font><font style="vertical-align: inherit;">estar√° </font><font style="vertical-align: inherit;">inclu√≠da l√°.</font></font></li>
</ul><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Progresso</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Novas visualiza√ß√µes </font></font><code>pg_stat_progress_analyze</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tamb√©m </font></font><code>pg_stat_progress_basebackup</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">permitem acompanhar o andamento da </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">coleta</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">estat√≠sticas</font></a><font style="vertical-align: inherit;"> pela equipe </font></font><code>ANALYZE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">criar uma c√≥pia de backup do</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> utilit√°rio, </font></font><code>pg_basebackup</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">respectivamente.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Otimiza√ß√£o</font></font></h3><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C√°lculo de fun√ß√µes imut√°veis ‚Äã‚Äãna cl√°usula FROM no est√°gio de planejamento</font></font></b></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
O patch de Aleksandr Kuzmenkov e Aleksandr Parfyonov (ambos do Postgres Professional) ajuda nos casos em que a</font></font><code>FROM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">chamada cont√©m uma chamada de fun√ß√£o que √© realmente uma constante. </font><font style="vertical-align: inherit;">Nesse caso, em vez de fazer a conex√£o, o valor constante √© substitu√≠do nos locais necess√°rios da solicita√ß√£o. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Veja como isso acontece com um exemplo de consulta relacionada √† pesquisa de texto completo:</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">EXPLAIN</span> (<span class="hljs-keyword">COSTS</span> <span class="hljs-keyword">OFF</span>)
<span class="hljs-keyword">SELECT</span> subject, ts_rank_cd(tsv, q) <span class="hljs-keyword">AS</span> rank
<span class="hljs-keyword">FROM</span> mail_messages, to_tsquery(<span class="hljs-string">'english'</span>, <span class="hljs-string">'tuple'</span>) q
<span class="hljs-keyword">WHERE</span> tsv @@ q
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> rank <span class="hljs-keyword">DESC</span>;</code></pre><br>
<pre><code class="plaintext hljs">                              QUERY PLAN                              <font></font>
------------------------------------------------------------------<font></font>
 Sort<font></font>
   Sort Key: (ts_rank_cd(mail_messages.tsv, '''tuple'''::tsquery)) DESC<font></font>
   -&gt;  Bitmap Heap Scan on mail_messages<font></font>
         Recheck Cond: (tsv @@ '''tuple'''::tsquery)<font></font>
         -&gt;  Bitmap Index Scan on mail_messages_tsv_idx<font></font>
               Index Cond: (tsv @@ '''tuple'''::tsquery)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N√£o h√° conex√£o, e o valor 'tuple' :: tsquery √© substitu√≠do na consulta j√° no est√°gio de planejamento. </font><font style="vertical-align: inherit;">A vers√£o 12 tinha uma imagem completamente diferente:</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">EXPLAIN</span> (<span class="hljs-keyword">COSTS</span> <span class="hljs-keyword">OFF</span>)
<span class="hljs-keyword">SELECT</span> subject, ts_rank_cd(tsv, q) <span class="hljs-keyword">AS</span> rank                            
<span class="hljs-keyword">FROM</span> mail_messages, to_tsquery(<span class="hljs-string">'english'</span>, <span class="hljs-string">'tuple'</span>) q
<span class="hljs-keyword">WHERE</span> tsv @@ q                            
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> rank <span class="hljs-keyword">DESC</span>;</code></pre><br>
<pre><code class="plaintext hljs">                          QUERY PLAN                         <font></font>
-----------------------------------------------------<font></font>
 Sort<font></font>
   Sort Key: (ts_rank_cd(mail_messages.tsv, q.q)) DESC<font></font>
   -&gt;  Nested Loop<font></font>
         -&gt;  Function Scan on q<font></font>
         -&gt;  Bitmap Heap Scan on mail_messages<font></font>
               Recheck Cond: (tsv @@ q.q)<font></font>
               -&gt;  Bitmap Index Scan on mail_messages_tsv_idx<font></font>
                     Index Cond: (tsv @@ q.q)</code></pre><br>
<br>
<b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Classifica√ß√£o incremental</font></font></a></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Quando a classifica√ß√£o por muitas chaves √© necess√°ria (k1, k2, k3 ...), o planejador agora pode tirar proveito do conhecimento de que os dados j√° est√£o classificados por v√°rias das primeiras chaves (por exemplo, k1 e k2). Nesse caso, n√£o √© poss√≠vel reorganizar todos os dados novamente, mas dividi-los em grupos consecutivos com os mesmos valores k1 e k2 e "classificar" pela chave k3.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Assim, toda a classifica√ß√£o se divide em v√°rios tipos consecutivos de tamanho menor. Isso reduz a quantidade de mem√≥ria necess√°ria e tamb√©m permite que voc√™ forne√ßa os primeiros dados antes que toda a classifica√ß√£o seja conclu√≠da.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por exemplo, na desmobase da tabela de tickets, existe um √≠ndice na coluna ticket_id. </font><font style="vertical-align: inherit;">Os dados recebidos do √≠ndice ser√£o classificados por ticket_id, portanto, a seguinte consulta usar√° a classifica√ß√£o incremental:</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">EXPLAIN</span> (<span class="hljs-keyword">analyze</span>, <span class="hljs-keyword">costs</span> <span class="hljs-keyword">off</span>, <span class="hljs-keyword">timing</span> <span class="hljs-keyword">off</span>)
<span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> tickets <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> ticket_no, passenger_id;</code></pre><br>
<pre><code class="plaintext hljs">                                  QUERY PLAN                                  <font></font>
------------------------------------------------------------------------------<font></font>
 Incremental Sort (actual rows=2949857 loops=1)<font></font>
   Sort Key: ticket_no, passenger_id<font></font>
   Presorted Key: ticket_no<font></font>
   Full-sort Groups: 92184 Sort Method: quicksort Memory: avg=31kB peak=31kB<font></font>
   -&gt;  Index Scan using tickets_pkey on tickets (actual rows=2949857 loops=1)<font></font>
 Planning Time: 2.137 ms<font></font>
 Execution Time: 2230.019 ms</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A funcionalidade de classifica√ß√£o incremental pode ser desativada com o par√¢metro enable_incrementalsort. </font><font style="vertical-align: inherit;">Nesse caso, a classifica√ß√£o levar√° consideravelmente mais tempo:</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">SET</span> enable_incrementalsort = <span class="hljs-keyword">off</span>;
<span class="hljs-keyword">EXPLAIN</span> (<span class="hljs-keyword">analyze</span>, <span class="hljs-keyword">costs</span> <span class="hljs-keyword">off</span>, <span class="hljs-keyword">timing</span> <span class="hljs-keyword">off</span>)
<span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> tickets <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> ticket_no, passenger_id;</code></pre><br>
<pre><code class="plaintext hljs">                              QUERY PLAN                               <font></font>
-----------------------------------------------------------------------<font></font>
 Gather Merge (actual rows=2949857 loops=1)<font></font>
   Workers Planned: 2<font></font>
   Workers Launched: 2<font></font>
   -&gt;  Sort (actual rows=983286 loops=3)<font></font>
         Sort Key: ticket_no, passenger_id<font></font>
         Sort Method: external merge  Disk: 107024kB<font></font>
         Worker 0:  Sort Method: external merge  Disk: 116744kB<font></font>
         Worker 1:  Sort Method: external merge  Disk: 107200kB<font></font>
         -&gt;  Parallel Seq Scan on tickets (actual rows=983286 loops=3)<font></font>
 Planning Time: 3.994 ms<font></font>
 Execution Time: 12291.844 ms</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A id√©ia de classifica√ß√£o incremental foi proposta em 2013 por Alexander Korotkov (Postgres Professional), e agora, sete anos depois, o patch foi levado por James Coleman a um estado aceito pela comunidade. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Acelerar TRUNCATE</font></font></b></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Quando </font></font><code>TRUNCATE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ocorre </font></font><code>shared_buffers</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a </font><font style="vertical-align: inherit;">varredura </font><font style="vertical-align: inherit;">para remover os buffers da tabela da mem√≥ria compartilhada. Anteriormente, a verifica√ß√£o era realizada tr√™s vezes, para cada camada da tabela: PRINCIPAL (camada de dados principal), FSM (mapa de espa√ßo livre), VM (mapa de visibilidade). Agora a l√≥gica mudou, em vez de opera√ß√£o tripla, os buffers s√£o verificados apenas uma vez. Com valores grandes, </font></font><code>shared_buffers</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">isso proporciona um ganho tang√≠vel. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Descompress√£o parcial TOAST</font></font></b></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quando n√£o h√° necessidade de ler completamente o TOAST, limitando-o a uma fatia no in√≠cio ou perto do in√≠cio, n√£o faz sentido abri-lo completamente. </font><font style="vertical-align: inherit;">O TOAST compactado √© lido nas itera√ß√µes: leia uma pe√ßa, se n√£o houver dados necess√°rios, expanda-a e continue lendo. </font><font style="vertical-align: inherit;">Sugerido por um aluno do Google Summer of Code, Binguo Bao, que d√° um exemplo:</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> slicingtest (<font></font>
     id <span class="hljs-type">serial</span> <span class="hljs-keyword">PRIMARY KEY</span>,<font></font>
     a <span class="hljs-type">text</span><font></font>
);<font></font>
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> slicingtest (a) <span class="hljs-keyword">SELECT</span>
    repeat(<span class="hljs-string">'1234567890-=abcdefghijklmnopqrstuvwxyz'</span>, <span class="hljs-number">1000000</span>) <span class="hljs-keyword">AS</span> a <span class="hljs-keyword">FROM</span>
    generate_series(<span class="hljs-number">1</span>,<span class="hljs-number">100</span>);<font></font>
\<span class="hljs-keyword">timing</span>
<span class="hljs-keyword">SELECT</span> sum(length(substr(a, <span class="hljs-number">0</span>, <span class="hljs-number">20</span>))) <span class="hljs-keyword">FROM</span> slicingtest;</code></pre><br>
<pre><code class="plaintext hljs">Time: 28.123 ms</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Com o patch, uma ordem de magnitude mais r√°pida:</font></font><br>
<br>
<pre><code class="plaintext hljs">Time: 2.306 ms</code></pre><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V√ÅCUO paralelo</font></font></b></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Em seu</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> artigo sobre este assunto,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Yegor Rogov explica em detalhes esse importante passo na paraleliza√ß√£o. Em resumo: ‚ÄúPatch Masahiko Sawada, que permite executar a limpeza em paralelo. A tabela em si ainda √© limpa por um processo (principal), mas, para limpar √≠ndices, agora pode iniciar fluxos de trabalho em segundo plano, um para cada √≠ndice. No modo manual, isso permite acelerar a limpeza de tabelas grandes com v√°rios √≠ndices; a limpeza autom√°tica ainda n√£o usa esse recurso. ‚Äù</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Limpeza autom√°tica quando colado em uma tabela</font></font></b></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para este patch (tamb√©m conhecido como v√°cuo autom√°tico do Berserk), precisamos agradecer a Dorofei Proleskovsky, que prop√¥s uma solu√ß√£o para o seguinte problema: a limpeza autom√°tica n√£o chega √† tabela de acr√©scimo, porque eles n√£o t√™m vers√µes "mortas" das linhas. Por esse motivo, o mapa de visibilidade n√£o √© atualizado, tornando apenas as verifica√ß√µes apenas de √≠ndice ineficazes e, quando a limpeza ocorre para impedir o estouro do contador de transa√ß√µes, √© necess√°rio muito trabalho ao mesmo tempo. Agora esta situa√ß√£o foi corrigida: a limpeza autom√°tica tamb√©m funcionar√° na adi√ß√£o de linhas. Dois novos par√¢metros do servidor ( </font></font><code>autovacuum_vacuum_insert_threshold</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><code>autovacuum_vacuum_insert_scale_factor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) apareceram, semelhantes aos das modifica√ß√µes ( </font></font><code>autovacuum_vacuum_threshold</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><code>autovacuum_vacuum_scale_factor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gerenciamento de mem√≥ria agregada de hash</font></font></b></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A agrega√ß√£o de hash pode exigir mais RAM do que o planejador pensou e do que √© indicado em </font></font><code>work_mem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Anteriormente, esse erro do agendador fazia com que o tamanho fosse </font></font><code>work_mem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ignorado e a mem√≥ria fosse alocada o necess√°rio para a opera√ß√£o ou chegada do OOM Killer. Agora, o algoritmo pode n√£o ir al√©m </font></font><code>work_mem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e, se necess√°rio, usar arquivos tempor√°rios no disco. Para controlar o comportamento do planejador, os par√¢metros apareceram: </font></font><code>enable_groupingsets_hash_disk</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><code>enable_hashagg_disk</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Otimizando UPDATE para tabelas com colunas geradas</font></font></b></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na vers√£o 12, as colunas geradas foram recalculadas durante qualquer atualiza√ß√£o de linha, mesmo que essa altera√ß√£o n√£o as afetasse de forma alguma. Agora eles ser√£o recalculados somente quando for realmente necess√°rio (se suas colunas base foram alteradas). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Essa otimiza√ß√£o, por exemplo, pode acelerar significativamente a atualiza√ß√£o de tabelas com uma coluna de tipo gerada </font></font><code>tsvector</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, pois a fun√ß√£o √© </font></font><code>to_tsvector()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bastante cara. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Acesso do acionador √† lista de colunas alteradas</font></font></b></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Um pequeno patch que adiciona um </font></font><code>TriggerData</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bitmap de colunas alteradas </font><font style="vertical-align: inherit;">√† estrutura </font><font style="vertical-align: inherit;">. Essas informa√ß√µes podem ser usadas por fun√ß√µes gerais do acionador, como </font></font><code>tsvector_update_trigger()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou </font></font><code>lo_manage()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, para n√£o executar trabalhos desnecess√°rios. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Uso de v√°rias estat√≠sticas avan√ßadas ao avaliar</font></font></b></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na PG12, o planejador n√£o conseguiu usar v√°rias estat√≠sticas avan√ßadas para a mesma tabela ao mesmo tempo. Por exemplo, imagine uma situa√ß√£o em que duas estat√≠sticas avan√ßadas sejam constru√≠das para conjuntos diferentes de colunas e as colunas de um conjunto e de outro participem da consulta. Agora o planejador tem acesso a todas as informa√ß√µes dispon√≠veis. </font></font><br>
<br>
<b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Infraestrutura para paraleliza√ß√£o e COPY</font></font></a></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (consulte tamb√©m </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">este patch</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">.</font></a></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A simultaneidade do PostgreSQL ainda funciona para consultas somente leitura. </font><font style="vertical-align: inherit;">Existem dificuldades com os escritores, e um deles est√° bloqueando processos que executam simultaneamente uma tarefa (inclu√≠da em um grupo paralelo comum). </font><font style="vertical-align: inherit;">Acredita-se que os bloqueios de tais processos n√£o entrem em conflito - por exemplo, v√°rios processos podem conter um bloqueio exclusivo na mesma tabela. </font><font style="vertical-align: inherit;">Isso requer cuidados especiais dos desenvolvedores do kernel, mas, caso contr√°rio, eles teriam constantemente impasses. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas h√° duas exce√ß√µes:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bloqueio de extens√£o de rela√ß√£o, que √© capturado quando novas p√°ginas s√£o adicionadas ao final do arquivo de dados e</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bloqueio de p√°gina, usado ao mover itens de √≠ndice GIN da lista de espera para a √°rvore principal.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(Voc√™ pode ler mais </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">neste artigo.</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esses bloqueios devem entrar em conflito mesmo entre processos do mesmo grupo paralelo - o que implementa esse patch. </font><font style="vertical-align: inherit;">Mas esses bloqueios nunca podem levar a conflitos, portanto, eles s√£o exclu√≠dos da verifica√ß√£o. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para o usu√°rio, em geral, nada muda, mas esse patch √© importante porque, em primeiro lugar, abre caminho para INSERT e COPY paralelos e, em segundo lugar, elimina um dos gargalos do PostgreSQL em condi√ß√µes de alta carga (o que pode ser ouvido </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no relat√≥rio HL ++</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Seguran√ßa</font></font></h3><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Os</font></font></b></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
primos</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><b><font style="vertical-align: inherit;"> SKH PRH substitu√≠ram os</font></b></a><font style="vertical-align: inherit;"> primos EDH</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><b><font style="vertical-align: inherit;"> substitu√≠dos</font></b></a><font style="vertical-align: inherit;"> (Diffie-Hellman Ephemeral Keys) usando o agora extinto protocolo SKIP.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> initdb: as configura√ß√µes padr√£o para autentica√ß√£o</font></font></b></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
foram alteradas As configura√ß√µes de acesso padr√£o para conex√µes locais e de rede foram alteradas quando o initdb √© iniciado. Agora,</font></font><code>pg_hba.conf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para conex√µes locais, em vez do m√©todo de autentica√ß√£o,</font></font><code>trust</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ser√°</font></font><code>peer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(ou md5 se o par n√£o for suportado) e</font></font><code>md5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para conex√µes de rede. Inicialmente, foram discutidas medidas mais liberais: aviso na documenta√ß√£o. Em seguida, mais dif√≠cil:</font></font><code>scram-sha-256</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Como resultado, decidimos nos limitar a</font></font><code>peer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e</font></font><code>md5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Usando o explic_bzero</font></font></b></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Patch importante. As fun√ß√µes do SO bzero () e expl√≠cita_bzero () escrevem bytes que cont√™m nas √°reas de mem√≥ria indicadas </font></font><code>'\0'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(consulte, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">por exemplo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , Linux). Esses patches s√£o apenas o come√ßo: existem muitas se√ß√µes de mem√≥ria nas quais senhas e outras informa√ß√µes confidenciais podem permanecer. Decidimos come√ßar a partir de lugares como libpq, nos quais todo o arquivo com senhas pode permanecer na mem√≥ria ap√≥s a leitura de .pgpass e a limpeza ap√≥s o fechamento da conex√£o. No be-secure-common.c, agora h√° uma substitui√ß√£o da frase secreta inserida no SSL, que aparece na linha (caminho) do erro. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Adicionado o par√¢metro "password_protocol" no libpq</font></font></b></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esse patch permite que a libpq controle qual protocolo de transfer√™ncia de senha √© usado durante a conex√£o. Ap√≥s receber este par√¢metro, a libpq recusar√° a autentica√ß√£o se o protocolo for mais fraco que o especificado. Por padr√£o, este par√¢metro </font></font><code>plaintext</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, ou seja, todos os protocolos s√£o adequados. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Acesso obrigat√≥rio para TRUNCATE</font></font></b></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Este patch permite que extens√µes incorporem o controle de acesso obrigat√≥rio (MAC) a uma opera√ß√£o TRUNCATE. Os direitos a ele agora ser√£o verificados pela extens√£o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sepgsql</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A pol√≠tica de refer√™ncia do SELinux</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e as distribui√ß√µes Linux baseadas no Redhat n√£o suportam a verifica√ß√£o do SELinux no db_table {truncate}. Nesse caso, o sepgsql ser√° usado com 'deny_unknown' igual a 1 e TRUNCATE falhar√°. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Disponibilidade de GUC ssl_passphrase_command</font></font></b></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um patch simples, mas √∫til. </font><font style="vertical-align: inherit;">Agora, o valor do par√¢metro ssl_passphrase_command ser√° visto apenas pelo superusu√°rio. </font><font style="vertical-align: inherit;">O par√¢metro especifica um comando externo que √© chamado quando uma senha √© necess√°ria para descriptografar um arquivo SSL, por exemplo, uma chave privada.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Localiza√ß√£o</font></font></h3><br>
<b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Regras de agrupamento da vers√£o libc</font></font></a></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Para</font><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"> regras de agrupamento de</font></a></b><font style="vertical-align: inherit;"> ICU, os n√∫meros de vers√£o s√£o armazenados no banco de dados. Cada vez que a regra √© usada (classifica√ß√£o, compara√ß√£o de caracteres), o n√∫mero da vers√£o salva √© verificado com a vers√£o atual na biblioteca ICU no SO e, em caso de discrep√¢ncias, √© emitido um aviso. Isso permite que voc√™ descubra que determinados √≠ndices criados de acordo com as regras de classifica√ß√£o modificadas podem estar incorretos e devem ser reconstru√≠dos. Ao recriar os √≠ndices com o comando</font></font><code>ALTER COLLATION ... REFRESH VERSION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, a vers√£o da regra de classifica√ß√£o no banco de dados √© atualizada e os avisos n√£o s√£o mais emitidos.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas isso foi apenas para a UTI. Agora, o n√∫mero da vers√£o tamb√©m √© armazenado para regras de classifica√ß√£o da libc:</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">SELECT</span> collname, collversion <span class="hljs-keyword">FROM</span> pg_collation <span class="hljs-keyword">WHERE</span> collname = <span class="hljs-string">'ru_RU'</span>;</code></pre><br>
<pre><code class="plaintext hljs"> collname | collversion<font></font>
----------+-------------<font></font>
 ru_RU    | 2.27</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O que possibilita emitir avisos quando uma biblioteca √© alterada no sistema operacional. </font><font style="vertical-align: inherit;">Muito relevante √† luz da transi√ß√£o para a glibc 2.28, onde muitas regras de classifica√ß√£o foram alteradas e os √≠ndices correspondentes devem ser reconstru√≠dos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas at√© que eles mudaram para 2,28, tudo est√° calmo:</font></font><br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">COLLATION</span> "ru_RU" <span class="hljs-keyword">REFRESH</span> <span class="hljs-keyword">VERSION</span>;</code></pre><br>
<pre><code class="plaintext hljs">NOTICE:  version has not changed<font></font>
ALTER COLLATION</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pesquisa de texto completo</font></font></h3><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pesquisa por texto completo do idioma grego</font></font></b></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Sem coment√°rios. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dict_int aprendeu a lidar com valores absolutos.O</font></font></b></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
dicion√°rio de modelos dict_int (tamb√©m conhecido como extens√£o) adicionou a capacidade de remover o sinal de um n√∫mero.</font></font><br>
<br>
<pre><code class="pgsql hljs">
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">EXTENSION</span> dict_int;
<span class="hljs-keyword">SELECT</span> ts_lexize(<span class="hljs-string">'intdict'</span>, <span class="hljs-string">'-123'</span>);</code></pre><br>
<pre><code class="plaintext hljs">ts_lexize<font></font>
-----------<font></font>
 {-123}<font></font>
(1 row)</code></pre><br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TEXT SEARCH</span> <span class="hljs-keyword">DICTIONARY</span> intdict (ABSVAL = <span class="hljs-keyword">true</span>);
<span class="hljs-keyword">SELECT</span> ts_lexize(<span class="hljs-string">'intdict'</span>, <span class="hljs-string">'-123'</span>);</code></pre><br>
<pre><code class="plaintext hljs">ts_lexize<font></font>
-----------<font></font>
 {123}<font></font>
(1 row)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ou seja, desta vez o valor absoluto foi reconhecido.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Particionamento</font></font></h4><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ANTES dos</font></font></b></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
gatilhos de linha</font></font><code>BEFORE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">em uma tabela particionada</font><font style="vertical-align: inherit;">Na vers√£o 12, voc√™ n√£o pode criar gatilhos de linha</font><font style="vertical-align: inherit;">em uma tabela particionada. Em se√ß√µes separadas - por favor, mas n√£o em toda a mesa de uma s√≥ vez. Agora, um</font></font><code>BEFORE FOR EACH ROW</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gatilho criado em uma tabela particionada ser√° automaticamente herdado e funcionar√° para todas as se√ß√µes. Mas com a condi√ß√£o de que, se for um gatilho ativado</font></font><code>UPDATE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, a chave de parti√ß√£o nele s√≥ poder√° ser alterada na se√ß√£o atual.</font></font><br>
<br>
<b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Suporte para tabelas particionadas na replica√ß√£o l√≥gica</font></font></a></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Anteriormente, a inclus√£o de uma tabela particionada em uma publica√ß√£o causava um erro:</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">PUBLICATION</span> pub <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">TABLE</span> p;</code></pre><br>
<pre><code class="plaintext hljs">ERROR:  "p" is a partitioned table<font></font>
DETAIL:  Adding partitioned tables to publications is not supported.<font></font>
HINT:  You can add the table partitions individually.</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora funciona. </font></font><br>
<br>
<b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Algoritmo JOIN secional aprimorado</font></font></a></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
A partir da 11¬™ vers√£o, o planejador pode ingressar em tabelas particionadas se√ß√£o por se√ß√£o, mas apenas se os limites das se√ß√µes corresponderem exatamente. </font><font style="vertical-align: inherit;">Agora, o algoritmo foi aprimorado: funcionar√° se a se√ß√£o de uma tabela estiver completamente inclu√≠da na se√ß√£o de outra, mesmo que seus tamanhos n√£o correspondam (por exemplo, se uma tabela for particionada por dia e a outra por m√™s). </font><font style="vertical-align: inherit;">O novo algoritmo trabalha para particionar por intervalos e por listas. </font></font><br>
<br>
<b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JUN√á√ÉO EXTERNA COMPLETA SECIONAL A jun√ß√£o seccionada</font></font></a></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
agora funciona para jun√ß√µes externas completas registradas com uma frase </font></font><code>USING</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tableam</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nesta √°rea atraente e promissora, mas dif√≠cil, n√£o h√° avan√ßos radicais em rela√ß√£o ao PostgreSQL 12. N√£o h√° armazenamentos de plug-in prontos, como </font></font><code>zheap</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">outros que n√£o sejam heap), mas o trabalho continua na API. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um n√≠vel mais alto de abstra√ß√£o na determina√ß√£o do tamanho da tabela</font></font></b></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Robert Haas reescreveu o c√≥digo, alterando sua arquitetura em favor de camadas abstratas, para n√£o duplicar o c√≥digo no futuro. Esta pe√ßa refere-se ao </font></font><code>estimate_rel_size</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tamanho das camadas (garfos) da tabela. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Voc√™ pode usar os m√©todos de acesso √† tabela com relcache.</font></font></b></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Este patch traz os recursos de gerenciamento de mem√≥ria dos m√©todos de acesso √† tabela aos recursos dos m√©todos de √≠ndice. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tableam e TOAST</font></font></b></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
TOAST s√£o projetados para armazenamento</font></font><code>heap</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Portanto, ao criar novos </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m√©todos de acesso √† tabela,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> voc√™ pode seguir duas maneiras: ajudar os desenvolvedores de novos m√©todos a integrar inserir, atualizar e excluir registros TOAST neles ou delegar trabalho com o TOAST para codificar usando o heap tradicional de armazenamento PostgreSQL. </font><font style="vertical-align: inherit;">Uma s√©rie de 5 patches usa slots de tupla para implementar opera√ß√µes de inser√ß√£o / atualiza√ß√£o / exclus√£o e pode ajudar aqueles que seguem os dois lados.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fsync</font></font></h4><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Manipulando erros de fsync em pg_receivewal e pg_recvlogical</font></font></b></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
A luta contra o</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fsync ()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> continua. O PostgreSQL acredita que uma chamada fsync () bem-sucedida significa que todos os dados no arquivo foram liberados para o disco, mas isso nem sempre acontece (depende do SO) e pode levar √† perda de dados. A PG13 decidiu que era necess√°rio lidar com os servi√ßos p√∫blicos</font></font><code>pg_receivewal</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e</font></font><code>pg_recvlogical</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Atualmente, o comportamento padr√£o √© este: esses utilit√°rios gravam erros fsync nos logs, restauram a conex√£o e continuam como se nada tivesse acontecido. Como resultado, o WAL cont√©m informa√ß√µes sobre os arquivos que foram copiados com √™xito e que, na verdade, n√£o foram corretamente liberados para o disco. Portanto, √© melhor interromper o utilit√°rio. O destino de pg_dump, pg_basebackup, pg_rewind e pg_checksums tamb√©m foi discutido, mas at√© agora eles se limitaram a esses dois.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prote√ß√£o contra a configura√ß√£o de sinalizadores incorretos para fsync ()</font></font></b></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Este patch verifica se os sinalizadores est√£o definidos corretamente ao receber o descritor de arquivo para fsync () - os diret√≥rios est√£o abertos apenas para leitura e os arquivos para grava√ß√£o ou ambos.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Backup e replica√ß√£o</font></font></h3><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pausa durante a recupera√ß√£o antes de atingir o ponto de recupera√ß√£o</font></font></b></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Se durante a recupera√ß√£o os WALs terminaram, mas</font></font><code>recovery_target_time</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n√£o atingiram o</font><font style="vertical-align: inherit;">especificado</font><font style="vertical-align: inherit;">, o servidor conclui a recupera√ß√£o e alterna para o modo de opera√ß√£o normal. Agora n√£o ser√° assim. O processo de recupera√ß√£o ser√° pausado, conforme relatado no log, e o administrador ter√° a oportunidade de inserir os segmentos WAL ausentes e continuar a recupera√ß√£o.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> O par√¢metro ignore_invalid_pages</font></font></b></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Quando o processo de recupera√ß√£o em uma r√©plica encontra um link para uma p√°gina inv√°lida no registro WAL,</font></font><code>panic</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-a</font><font style="vertical-align: inherit;">acontece</font><font style="vertical-align: inherit;">. A inclus√£o do par√¢metro ajudar√° a super√°-lo.</font></font><code>ignore_invalid_pages</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. A recupera√ß√£o continuar√° com uma poss√≠vel perda de integridade, dados e outras consequ√™ncias mais graves. O par√¢metro √© destinado aos desenvolvedores de servidores e deve ser usado nesses casos quando voc√™ ainda precisa tentar concluir a recupera√ß√£o e iniciar a r√©plica. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alterar primary_conninfo sem reiniciar</font></font></b></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
o patch de Sergey Kornilov, que permite que voc√™ altere as configura√ß√µes </font></font><code>primary_conninfo</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>primary_slot_name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><code>wal_receiver_create_temp_slot</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sem reiniciar o servidor. Na verdade, por causa disso, eles abandonaram o arquivo </font></font><code>recovery.conf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no 12¬∫ lan√ßamento. </font><font style="vertical-align: inherit;">
Os manifestos de </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">backup</font></font></b></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Pg_basebackup agora criam um "manifesto" - um arquivo JSON contendo informa√ß√µes sobre o backup feito (nomes e tamanhos de arquivos, arquivos WAL necess√°rios, al√©m de somas de verifica√ß√£o para tudo e mais).</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O novo utilit√°rio pg_validatebackup verifica a conformidade dos backups com o manifesto e tamb√©m verifica a disponibilidade e a corre√ß√£o dos arquivos WAL necess√°rios para a recupera√ß√£o usando o utilit√°rio pg_waldump (isso se aplica apenas aos arquivos WAL dentro do pr√≥prio backup e n√£o no arquivo morto). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Isso permitir√° detectar situa√ß√µes em que os arquivos de backup foram danificados ou desapareceram ou quando a recupera√ß√£o se tornou imposs√≠vel devido √† falta dos arquivos de log necess√°rios. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Limitando o slot de replica√ß√£o de dados n√£o lidos O slot de replica√ß√£o</font></font></b></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
√© um mecanismo conveniente, mas perigoso: se o cliente n√£o ler os dados do slot a tempo, os registros WAL n√£o lidos poder√£o ocupar todo o espa√ßo no servidor. Agora usando o par√¢metro</font></font><code>max_slot_wal_keep_size</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Voc√™ pode definir um limite para a quantidade m√°xima de espa√ßo em disco que pode ser ocupada por dados n√£o lidos. </font><font style="vertical-align: inherit;">Se, no pr√≥ximo ponto de verifica√ß√£o, o tamanho for excedido, o slot ser√° desativado e o local ser√° liberado.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">janelas</font></font></h3><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Suporte para soquetes Unix nos soquetes do</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
dom√≠nio </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">Unix do Windows</font></a><font style="vertical-align: inherit;"> s√£o suportados no Windows 10, embora estejam desativados por padr√£o.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Documenta√ß√£o</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Existem dois novos aplicativos na documenta√ß√£o. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ap√≥s uma longa </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">discuss√£o</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ap√™ndice M. Gloss√°rio apareceu</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Atualmente, existem 101 termos no gloss√°rio. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A capacidade de destacar a cor das mensagens de diagn√≥stico dos utilit√°rios do console usando uma vari√°vel </font></font><code>PG_COLOR</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">era anterior. </font><font style="vertical-align: inherit;">Isso agora est√° </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">documentado</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> no </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ap√™ndice N. Suporte a cores</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">A inten√ß√£o original de Peter Eisentrout nesse patch era ativar a sa√≠da colorida por padr√£o. </font><font style="vertical-align: inherit;">E para quem n√£o queria isso, foi proposto definir explicitamente a vari√°vel</font></font><code>NO_COLOR</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Mas havia mais opositores √† diferencia√ß√£o de cores das mensagens entre os que discutiam o patch. </font><font style="vertical-align: inherit;">Portanto, eles decidiram apenas documentar as oportunidades dispon√≠veis. </font><font style="vertical-align: inherit;">E temos uma nova se√ß√£o do primeiro n√≠vel na documenta√ß√£o.</font></font><br>
<br>
<hr><br>
<i>        PG13,  ,  PG14     . ,   . .</i></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt493094/index.html">Funcion√°rios do armaz√©m da Amazon disparam alarme sobre a propaga√ß√£o de coronav√≠rus</a></li>
<li><a href="../pt493096/index.html">Adicionar um tema sombrio no iOS</a></li>
<li><a href="../pt493098/index.html">Implante o conjunto de balanceamento de carga da VPN ASA</a></li>
<li><a href="../pt493100/index.html">Como encontrar maneiras f√°ceis ajuda as startups a alcan√ßar um crescimento agressivo</a></li>
<li><a href="../pt493102/index.html">Tend√™ncias da automa√ß√£o global: desenvolvimento de RPA</a></li>
<li><a href="../pt493108/index.html">Cloudflare seleciona processadores AMD para servidores de ponta da d√©cima gera√ß√£o</a></li>
<li><a href="../pt493110/index.html">Como delegar no trabalho remoto - um guia para o l√≠der da equipe e muito mais</a></li>
<li><a href="../pt493112/index.html">Como iniciar um novo neg√≥cio em 6 meses em vez de 3 anos</a></li>
<li><a href="../pt493114/index.html">Como o engenheiro de dados assistiu os dados</a></li>
<li><a href="../pt493116/index.html">"Mais interatividade!" ou Como foi o TeamLead Conf 2020</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>