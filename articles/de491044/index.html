<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🗄️ 👃🏾 🌕 Orchestrator und VIP als HA-Lösung für MySQL-Cluster 🈯️ 🧒🏻 👇🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In CityMobile verwenden wir die MySQL-Datenbank als Hauptspeicher für persistente Daten. Wir haben mehrere Datenbankcluster für verschiedene Dienste u...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Orchestrator und VIP als HA-Lösung für MySQL-Cluster</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/citymobil/blog/491044/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In CityMobile verwenden wir die MySQL-Datenbank als Hauptspeicher für persistente Daten. </font><font style="vertical-align: inherit;">Wir haben mehrere Datenbankcluster für verschiedene Dienste und Zwecke. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die ständige Verfügbarkeit des Assistenten ist ein kritischer Indikator für den Zustand des gesamten Systems und seiner einzelnen Teile. </font><font style="vertical-align: inherit;">Die automatische Clusterwiederherstellung im Falle eines Assistentenfehlers reduziert die Reaktionszeit auf Vorfälle und die Systemausfallzeit erheblich. </font><font style="vertical-align: inherit;">In diesem Artikel werde ich einen </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> HA-Cluster betrachten, der auf </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">MySQL Orchestrator</font></a><font style="vertical-align: inherit;"> und virtuellen IP-Adressen (VIP) </font><font style="vertical-align: inherit;">basiert </font><font style="vertical-align: inherit;">.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/dn/78/bb/dn78bbg_qvozrgufsyzr0joysuw.png"><br>
<a name="habracut"></a><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VIP HA-Lösung</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zunächst werde ich kurz darauf eingehen, wie unser Datenspeichersystem aussieht. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir verwenden das klassische Replikationsschema mit einem Nur-Schreib-Assistenten und vielen Nur-Lese-Replikaten. Ein Cluster kann einen Zwischenmaster enthalten - einen Knoten, der sowohl ein Replikat als auch ein Master für andere ist. Clients greifen über HAProxy auf Replikate zu, was eine gleichmäßige Lastverteilung und einfache Skalierbarkeit ermöglicht. Die Verwendung von HAProxy hat historische Gründe, und jetzt sind wir dabei, auf ProxySQL zu migrieren. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Replikation ist halbsynchron basierend auf</font></font><code>GTID</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Dies bedeutet, dass mindestens ein Replikat die Transaktion in das Protokoll schreiben muss, bevor sie als erfolgreich angesehen wird. Dieser Replikationsmodus bietet ein optimales Gleichgewicht zwischen Leistung und Datensicherheit bei Ausfall des Hauptknotens. Grundsätzlich werden alle Änderungen mithilfe von vom Master auf Replikate übertragen </font></font><code>Row Based Replication (RBR)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, einige Knoten jedoch möglicherweise </font></font><code>mixed binlog format</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Orchestrator aktualisiert regelmäßig den Status der Clustertopologie, analysiert die empfangenen Informationen und kann bei Problemen den automatischen Wiederherstellungsvorgang starten. Der Entwickler ist für das Verfahren selbst verantwortlich, da es auf verschiedene Arten implementiert werden kann: basierend auf VIP, DNS, mithilfe von Service Discovery-Diensten oder eigenständigen Mechanismen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eine der einfachsten Möglichkeiten, einen Assistenten im Fehlerfall wiederherzustellen, ist die Verwendung von schwebenden VIP-Adressen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Was Sie über diese Lösung wissen müssen, bevor Sie fortfahren:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VIP ist eine IP-Adresse, die nicht an eine bestimmte physische Netzwerkschnittstelle gebunden ist. </font><font style="vertical-align: inherit;">Wenn ein Knoten ausfällt oder während der geplanten Arbeit, können wir den VIP mit minimaler Ausfallzeit auf eine andere Ressource umstellen.</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das Freigeben und Ausgeben einer virtuellen IP-Adresse ist eine kostengünstige und schnelle Operation.</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Für die Arbeit mit dem VIP ist beispielsweise der Zugriff auf den Server über SSH oder die Verwendung von Spezialwerkzeugen erforderlich </font></font><code>keepalived</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir werden mögliche Probleme mit unserem Master prüfen und uns vorstellen, wie der automatische Wiederherstellungsmechanismus funktionieren sollte.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Netzwerkverbindung zum Master ist verschwunden oder auf Hardwareebene ist ein Problem aufgetreten, und der Server ist nicht verfügbar</font></font></h4><br>
<ol>
<li>   ,      .     ,     ,   .<br>
</li>
<li>  VIP    — .<br>
</li>
<li>    .  .<br>
</li>
<li>     VIP.   VIP  ,        <b>gratuitous ARP</b>.   /        IP-  MAC-,       VIP.    <code>split brain</code>    . <br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alle neuen Verbindungen werden sofort zum neuen Master umgeleitet. </font><font style="vertical-align: inherit;">Alte Verbindungen schlagen fehl, es werden wiederholt Aufrufe an die Datenbank auf Anwendungsebene getätigt.</font></font><br>
</li>
</ol><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Server arbeitet im normalen Modus. Auf DBMS-Ebene ist ein Fehler aufgetreten</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Algorithmus ähnelt dem vorherigen Fall: Aktualisieren der Topologie und Starten des Wiederherstellungsprozesses. </font><font style="vertical-align: inherit;">Da der Server verfügbar ist, geben wir den VIP erfolgreich auf dem alten Master frei, übertragen ihn auf den neuen und senden mehrere ARP-Anfragen. </font><font style="vertical-align: inherit;">Die mögliche Rückgabe des alten Assistenten sollte sich nicht auf den neu erstellten Cluster und den Betrieb der Anwendung auswirken.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Andere Probleme</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Ausfall von Replikaten oder Zwischenmastern </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">führt nicht</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> zu automatischen Aktionen und erfordert manuelle Eingriffe. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die virtuelle Netzwerkschnittstelle wird immer vorübergehend hinzugefügt, dh nach dem Neustart wird der VIP-Server nicht automatisch zugewiesen. </font><font style="vertical-align: inherit;">Jede Instanz der Datenbank wird standardmäßig im schreibgeschützten Modus gestartet. Der Orchestrator schaltet den neuen Master automatisch auf Aufzeichnung um und versucht, ihn </font></font><code>read only</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">auf dem alten Master </font><font style="vertical-align: inherit;">zu installieren </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Diese Maßnahmen zielen darauf ab, die Wahrscheinlichkeit zu verringern </font></font><code>split brain</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Während des Wiederherstellungsprozesses können Probleme auftreten, die zusätzlich zu den Standardüberwachungstools auch über die Benutzeroberfläche des Orchestrators gemeldet werden sollten. </font><font style="vertical-align: inherit;">Wir haben die REST-API um diese Funktion erweitert ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PR</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> wird derzeit geprüft).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das allgemeine Schema der HA-Lösung ist unten dargestellt.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/yl/pk/gk/ylpkgksjn1cfj0wdbil7dje9qss.png"><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Auswählen eines neuen Assistenten</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Orchester ist klug genug und versucht, die am </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">besten geeignete Nachbildung</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> als neuer Meister nach folgenden Kriterien auszuwählen:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Verzögerung der Replik vom Master;</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL-Assistent und Replikatversion;</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Art der Replikation (RBR, SBR oder gemischt);</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Standort in einem oder mehreren Rechenzentren;</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Verfügbarkeit </font></font><code>errant GTID</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Transaktionen, die auf dem Replikat ausgeführt wurden und auf dem Master fehlen;</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Benutzerdefinierte Auswahlregeln werden ebenfalls berücksichtigt.</font></font><br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nicht jede Replik ist ein idealer Kandidat für die Rolle des Meisters. </font><font style="vertical-align: inherit;">Beispielsweise kann ein Replikat zum Sichern von Daten verwendet werden, oder der Server verfügt über eine schwächere Hardwarekonfiguration. </font><font style="vertical-align: inherit;">Der Orchestrator </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unterstützt</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> manuelle Regeln, nach denen Sie Ihre Einstellungen für die Auswahl eines Kandidaten anpassen können, der am meisten bevorzugt bis ignoriert wird.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reaktions- und Wiederherstellungszeit</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im Falle eines Vorfalls ist es wichtig, die Systemausfallzeit zu minimieren. Daher berücksichtigen wir die MySQL-Parameter, die sich auf die Erstellung und Aktualisierung der Clustertopologie durch das Orchester auswirken:</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><code>slave_net_timeout</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Die Anzahl der Sekunden, in denen das Replikat auf neue Daten oder ein Heartbeat-Signal vom Master wartet, bevor die Verbindung als unterbrochen erkannt und die Verbindung erneut hergestellt wird. </font><font style="vertical-align: inherit;">Je niedriger der Wert, desto schneller kann das Replikat feststellen, dass die Verbindung zum Master unterbrochen ist. </font><font style="vertical-align: inherit;">Wir setzen diesen Wert auf 5 Sekunden.</font></font><br>
</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><code>MASTER_CONNECT_RETRY</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Die Anzahl der Sekunden zwischen den Wiederverbindungsversuchen. </font><font style="vertical-align: inherit;">Bei Netzwerkproblemen können Sie mit einem niedrigen Wert dieses Parameters schnell wieder eine Verbindung herstellen und den Start des Cluster-Wiederherstellungsprozesses verhindern. </font><font style="vertical-align: inherit;">Der empfohlene Wert beträgt 1 Sekunde.</font></font><br>
</li>
<li><code>MASTER_RETRY_COUNT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Die maximale Anzahl von Versuchen, die Verbindung wiederherzustellen. </font></font><br>
</li>
<li><code>MASTER_HEARTBEAT_PERIOD</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- das Intervall in Sekunden, nach dem der Master ein Heartbeat-Signal sendet. </font><font style="vertical-align: inherit;">Der Standardwert ist der halbe Wert </font></font><code>slave_net_timeout</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Orchestrator-Optionen:</font></font><br>
<br>
<ul>
<li><code>DelayMasterPromotionIfSQLThreadNotUpToDate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Wenn gleich </font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, wird die Rolle des Assistenten nicht auf das Kandidatenreplikat angewendet, bis der Replikat-SQL-Stream alle nicht angewendeten Transaktionen aus dem Relay Log abgeschlossen hat. </font><font style="vertical-align: inherit;">Wir verwenden diese Option, um Transaktionen nicht zu verlieren, wenn alle Kandidatenreplikate im Rückstand sind.</font></font><br>
</li>
<li><code>InstancePollSeconds</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - die Häufigkeit des Erstellens und Aktualisierens der Topologie.</font></font><br>
</li>
<li><code>RecoveryPollSeconds</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Häufigkeit der Topologieanalyse. </font><font style="vertical-align: inherit;">Wenn ein Problem erkannt wird, wird die Wiederherstellung der Topologie gestartet. </font><font style="vertical-align: inherit;">Dies ist eine </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Konstante</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> von 1 Sekunde.</font></font><br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jeder Clusterknoten wird einmal pro </font></font><code>InstancePollSeconds</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sekunde </font><font style="vertical-align: inherit;">vom Orchestrator abgefragt </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Wenn ein Problem erkannt wird, wird der Clusterstatus zwangsweise </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aktualisiert</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , und dann wird die endgültige Entscheidung getroffen, eine Wiederherstellung durchzuführen. </font><font style="vertical-align: inherit;">Durch Experimentieren mit verschiedenen Parametern der Datenbank und des Orchesters konnten wir die Dauer der Reaktion und Wiederherstellung auf 30 Sekunden reduzieren.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prüfstand</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben begonnen, das HA-Schema zu </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">testen</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , indem wir einen lokalen </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">Prüfstand entwickelt</font></a><font style="vertical-align: inherit;"> und in einer Test- und Kampfumgebung weiter implementiert haben. </font><font style="vertical-align: inherit;">Der lokale Stand ist basierend auf Docker vollautomatisch und ermöglicht es Ihnen, mit der Konfiguration des Orchesters und des Netzwerks zu experimentieren, den Cluster von 2-3 Servern auf mehrere Zehner zu skalieren und Übungen in einer sicheren Umgebung durchzuführen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Während der Übungen wählen wir eine der Methoden zur Emulation des Problems: Schießen Sie den Assistenten sofort mit </font></font><code>kill -9</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, schließen Sie den Vorgang vorsichtig ab und stoppen Sie den Server ( </font></font><code>docker-compose stop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), simulieren Sie Netzwerkprobleme mit </font></font><code>iptables -j REJECT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">oder </font></font><code>iptables -j DROP</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Wir erwarten diese Ergebnisse:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das Orchester erkennt Probleme mit dem Master und aktualisiert die Topologie in nicht mehr als 10 Sekunden.</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Wiederherstellungsvorgang wird automatisch gestartet: Die Netzwerkkonfiguration ändert sich, die Rolle des Assistenten wechselt zum Replikat, die Topologie wird neu erstellt.</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der neue Master steht für die Aufnahme zur Verfügung. Live-Replikate gehen beim Wiederherstellen nicht verloren.</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Daten werden in den neuen Master geschrieben und repliziert.</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die gesamte Wiederherstellungszeit beträgt nicht mehr als 30 Sekunden.</font></font><br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie Sie wissen, kann sich ein System in Test- und Produktionsumgebungen aufgrund unterschiedlicher Hardware- und Netzwerkkonfigurationen, unterschiedlicher synthetischer und realer Last usw. unterschiedlich verhalten. </font><font style="vertical-align: inherit;">Daher führen wir regelmäßig Übungen unter realen Bedingungen durch und überprüfen, wie sich das System bei Verlust der Netzwerkkonnektivität oder Verschlechterung seiner Einzelteile verhält. </font><font style="vertical-align: inherit;">In Zukunft wollen wir eine völlig identische Infrastruktur für beide Umgebungen aufbauen und deren Tests automatisieren.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ergebnisse</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Funktionsfähigkeit des Hauptknotens des Speichersystems ist eine der Hauptaufgaben des SRE-Teams und des Betriebs. </font><font style="vertical-align: inherit;">Mit der Einführung des Orchesters und der auf VIP basierenden HA-Lösungen konnten folgende Ergebnisse erzielt werden:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zuverlässige Erkennung von Problemen mit der Topologie des Datenbankclusters;</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Automatische und schnelle Reaktion auf Vorfälle im Zusammenhang mit dem Master, wodurch Systemausfallzeiten reduziert werden.</font></font><br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Lösung hat jedoch ihre Vor- und Nachteile:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Für die Skalierung des HA-Schemas auf mehrere Rechenzentren ist ein einziges L2-Netzwerk erforderlich.</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bevor Sie dem neuen Meister einen VIP zuweisen, müssen wir ihn vom alten befreien. </font><font style="vertical-align: inherit;">Der Prozess ist sequentiell, was die Wiederherstellungszeit verlängert.</font></font><br>
</li>
<li> VIP  SSH-  ,       .      ,   ,     ,   VIP  .            IP-   <code>split brain</code>.<br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um dies zu vermeiden </font></font><code>split brain</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, können Sie die </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">STONITH-</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Methode </font><font style="vertical-align: inherit;">(„Den anderen Knoten in den Kopf schießen“) verwenden, mit der der Problemknoten vollständig isoliert oder getrennt wird. </font><font style="vertical-align: inherit;">Es gibt andere Möglichkeiten, die Hochverfügbarkeit des Clusters zu implementieren: eine Kombination aus VIP und DNS, Diensterkennung und Proxy-Diensten, synchroner Replikation und anderen Methoden, die ihre Nachteile und Vorteile haben. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich sprach über unseren Ansatz zum Erstellen eines MySQL-Failoverclusters. </font><font style="vertical-align: inherit;">Es ist einfach zu implementieren und bietet in der aktuellen Umgebung ein akzeptables Maß an Zuverlässigkeit. </font><font style="vertical-align: inherit;">Mit der Entwicklung des gesamten Systems und insbesondere der Infrastruktur wird sich dieser Ansatz zweifellos weiterentwickeln.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de491032/index.html">"RTFM, Alter!" Oder wie kostenlos Käse mich 5 Dollar gekostet hat. Und es hätte bei über 80 Dollar liegen können</a></li>
<li><a href="../de491034/index.html">WireGuard - Schnelles und sicheres VPN im Linux-Kernel</a></li>
<li><a href="../de491036/index.html">Wenn kein JavaScript-Framework benötigt wird</a></li>
<li><a href="../de491038/index.html">Yandex öffnet die Testsuite</a></li>
<li><a href="../de491040/index.html">QA Meetup in Nischni - wie es war und die Materialien von der Veranstaltung</a></li>
<li><a href="../de491050/index.html">Registrierung für NeoQUEST-2020: Post-Apocalyptic World Open</a></li>
<li><a href="../de491052/index.html">Wie und warum Kuratoren an der HSE in St. Petersburg Neulingen Programmierern helfen</a></li>
<li><a href="../de491054/index.html">So signieren Sie E-Mail-Korrespondenz mit einem GPG-Schlüssel mithilfe von PKCS # 11-Token</a></li>
<li><a href="../de491056/index.html">Ampere Altra - der weltweit erste 80-Kern-ARM-Prozessor</a></li>
<li><a href="../de491058/index.html">Mortalität, Mortalität, Coronavirus und Matan</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>