<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🦍 🔴 🧒🏿 Besi atau optimasi? Badoo, Avito dan Mamba - tentang kinerja PHP 🎵 🛠️ 🌍</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Masalah kinerja PHP untuk Badoo adalah salah satu yang paling penting. Kualitas PHP backend secara langsung tergantung pada jumlah sumber daya yang ka...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Besi atau optimasi? Badoo, Avito dan Mamba - tentang kinerja PHP</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/badoo/blog/487234/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Masalah kinerja PHP untuk Badoo adalah salah satu yang paling penting. Kualitas PHP backend secara langsung tergantung pada jumlah sumber daya yang kami habiskan untuk pengembangan dan operasi, kecepatan layanan dan kesan yang dibuat pada pengguna. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Oleh karena itu, topik pertemuan ketiga komunitas pengembang PHP di kantor kami, kami membuat kinerja backend dan mengundang kolega dari Avito dan Mamba untuk berdiskusi. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/t-/p7/se/t-p7sef1pbww8vboigkup6ditzu.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Baca di bawah transkrip cutscene diskusi, di mana saya beruntung menjadi moderator: bagaimana infrastruktur dari tiga perusahaan diatur, bagaimana kita mengukur produktivitas dan metrik apa yang kita fokuskan, alat apa yang kita gunakan, bagaimana kita membuat pilihan antara perangkat keras dan optimisasi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan pada 15 Februari, datanglah ke </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pertemuan PHP Badoo berikutnya</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : diskusikan Legacy.</font></font><br>
<a name="habracut"></a><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/kWBm0C9A8oo" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe> <br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kami telah menguraikan hanya bagian dari diskusi, yang menurut kami paling menarik. </font><font style="vertical-align: inherit;">Versi lengkap tersedia di video. </font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pakar:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Semyon Kataev, Kepala Unit Pengembangan di Core Services Avito</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pavel Murzakov </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pmurzakov</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, PHP Timlid di Badoo </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mikhail Buylov </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mipxtx</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, Direktur IT dari Mamba</font></font></li>
</ul><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ceritakan kisah tentang pengoptimalan dari latihan Anda: kesuksesan besar atau kegagalan besar adalah sesuatu yang menarik untuk dibagikan. </font></font></blockquote><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mikhail Buylov, Mamba </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya punya perumpamaan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekitar enam bulan sekali kami melihat metrik dan mencari apa yang melambat, tidak berfungsi dengan baik, apa yang perlu dioptimalkan. </font><font style="vertical-align: inherit;">Suatu ketika kami memperhatikan wadah ketergantungan symfony kami, yang tumbuh hingga 52.000 baris. </font><font style="vertical-align: inherit;">Kami memutuskan bahwa dia, si bajingan, yang harus disalahkan atas segalanya: 20 ms overhead untuk setiap permintaan. </font><font style="vertical-align: inherit;">Kami melihatnya. </font><font style="vertical-align: inherit;">Kami menguranginya. </font><font style="vertical-align: inherit;">Kami entah bagaimana mencoba memisahkannya, tetapi tidak ada yang membantu. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan kemudian ternyata kami memiliki anti-spam yang perlu masuk ke 20 database untuk memenuhi semua permintaan yang diperlukan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Solusi yang didahulukan tidak selalu yang tepat. </font><font style="vertical-align: inherit;">Terlihat lebih baik pada jejak, log, dan tolok ukur permintaan Anda, dan jangan putus secara langsung. </font><font style="vertical-align: inherit;">Ini adalah sebuah cerita.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pavel Murzakov, Badoo</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami memiliki ekosistem yang cukup besar di PHP, jadi kami melakukan optimasi secara berkala. </font><font style="vertical-align: inherit;">Kami berkembang, kami mencapai level CPU, kami memahami bahwa kami perlu membeli perangkat keras atau mengoptimalkan. </font><font style="vertical-align: inherit;">Timbang argumen untuk dan terhadap setiap opsi dan putuskan. </font><font style="vertical-align: inherit;">Paling sering - mendukung optimasi, karena besi membutuhkan banyak. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pada salah satu poin ini, kami mengidentifikasi seluruh kelompok yang terlibat dalam mencari berbagai hal yang tidak optimal dalam skrip PHP dan mengoptimalkannya. </font><font style="vertical-align: inherit;">Ini terjadi secara harfiah “setetes demi setetes”: di sini mereka menemukan persentase, di sana mereka menemukan persentase - beberapa orang menemukan persentase dalam sebulan. </font><font style="vertical-align: inherit;">Pada titik tertentu, sishnik kami ada di dekatnya</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">einstein_man</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Dia memutuskan untuk melihat apa yang bisa dia lakukan: dia pergi di malam hari, meluncurkan Perf, menemukan beberapa masalah dalam ekstensi PHP - dan mempercepat semuanya dalam beberapa malam sebesar 13%!</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Semyon Kataev, Avito </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya punya dua cerita. Satu tentang file, yang lain tentang super developer. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tentang Gagal. Kami memiliki banyak layanan Microsoft, termasuk PHP. Semua orang bekerja di Kubernetes. Saya mengerjakan salah satu dari layanan microser ini. Ada pemanfaatan CPU yang signifikan: mereka menghabiskan satu minggu untuk mengoptimalkan dan menemukan masalah. Ternyata salah satu pengembang menambahkan Xdebug ke gambar dasar untuk menghitung tes cakupan kode dalam layanan (lainnya), setelah semua layanan mikron dalam produksi bekerja dengan Xdebug selama seperempat! Setelah seperempat, kami menemukan ini, memperbaiki gambar dasar - dan mulai menangkap hadiah tak terduga: Saya memutar ulang layanan saya, dan mulai bekerja lebih cepat. Di setiap penyebaran, gambar layanan kami dibangun kembali, dan sekarang tanpa Xdebug.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sejarah kesuksesan. Kami memiliki banyak layanan microser, dan mereka menjadi semakin banyak. Dalam situasi ini, jumlah panggilan RPC menjadi masalah. Misalnya, pada kartu pengumuman - dan ini adalah salah satu halaman yang paling sering di Avito - sekitar 30 layanan mikro terlibat dalam merender halaman. Selain itu, semua ini tidak dilakukan dengan sangat eksplisit: sepertinya Anda memanggil semacam abstraksi, dan di bawahnya lima panggilan RPC ke layanan lain dilakukan secara berurutan.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selama bertahun-tahun, kartu pengumuman telah sangat terdegradasi. </font><font style="vertical-align: inherit;">Satu pengembang kuat berjuang selama seperempat, dioptimalkan, dan mengeluarkan semua panggilan RPC. </font><font style="vertical-align: inherit;">Ketika dia bisa melakukan ini, dia memparalelkannya melalui Guzzle multi permintaan - dan bukannya 30 permintaan sinkron berturut-turut, dia menerima 30 permintaan yang sama, tetapi yang paralel, yang sangat mempercepat pekerjaan. </font><font style="vertical-align: inherit;">Setelah refactoring ini, waktu respons kartu sama dengan waktu respons maksimum dari salah satu layanan. </font><font style="vertical-align: inherit;">Tetapi dia membutuhkan seperempat penuh untuk mengoptimalkan / menulis ulang kode tampilan kartu pengumuman.</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beri tahu kami, berapa ukuran cluster PHP Anda, bagaimana cara mengonfigurasinya - setidaknya PHP-FPM, atau mungkin di suatu tempat Apache mendapat masalah?</font></font></blockquote><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mikhail Buylov, Mamba </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami memiliki sekitar 15.000 RPS. </font><font style="vertical-align: inherit;">Sekelompok 80 server FPM dibeli beberapa tahun yang lalu. </font><font style="vertical-align: inherit;">Pada setiap cluster, FPM (maksimum 50 anak) diluncurkan ke statika. </font><font style="vertical-align: inherit;">Ini memuat sekitar sepuluh pada puncaknya di prime time. </font><font style="vertical-align: inherit;">Waktu respons rata-rata adalah 100 ms, dan kami mencoba menahannya (ketika melebihi 100 ms, kami mulai mencari bagian pengereman). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami memiliki sistem pemantauan kinerja kami sendiri. </font><font style="vertical-align: inherit;">Kami menyebarkan banyak penghitung dalam kode, sekitar 120 per permintaan. </font><font style="vertical-align: inherit;">Kami memantau banyak peristiwa yang terjadi di dalam kode di PHP.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pavel Murzakov, Badoo</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Semuanya standar dengan kami: nginx, PHP-FPM. Sekitar 600 server dengan FPM. Jika berbicara tentang PHP sama sekali, maka, mungkin, ada sekitar 300 server lagi untuk berbagai keperluan, seperti skrip, back-office dan lainnya. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dari fitur konfigurasi, ada dua. Pertama, kami memiliki proxy BMA - ini adalah proxy untuk seluler. Yaitu, sebelum permintaan tiba di nginx, itu akan sampai ke proxy khusus yang memegang koneksi persisten dan mengirimkan permintaan ke nginx. Fitur kedua - kadang-kadang Anda harus mematikan opcache CLI (kami telah menghidupkan mesin scripting). Setelah kami tidak mematikannya dan kehilangan 30% dari CPU pada ini. Setelah mereka menyadari kesalahan mereka, mereka terkejut betapa Anda dapat menghemat dengan satu pengaturan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami memiliki tambalan PHP, tetapi hampir tidak terkait dengan kinerja.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ada satu poin dengan kunci APCu yang kompetitif - ketika Anda perlu banyak menulis ke kunci yang sama. </font><font style="vertical-align: inherit;">Arsitektur internal APCu dibangun sedemikian rupa sehingga ada kunci kunci global, dan selama perekaman intensif, rem dimulai. </font><font style="vertical-align: inherit;">Karenanya, kami memiliki ekstensi khusus di sana yang menyelesaikan masalah ini. </font><font style="vertical-align: inherit;">Ini hanya sebagian berhubungan dengan kinerja, karena ini mempengaruhi waktu respons, tetapi bukan konsumsi CPU.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Semyon Kataev, Avito </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami memiliki sekitar 2 juta permintaan per menit (~ 33 kRPS). </font><font style="vertical-align: inherit;">Aplikasi monolitik yang ditulis dalam PHP telah ditulis selama lebih dari 11 tahun. </font><font style="vertical-align: inherit;">Ia berada dalam fase pertumbuhan yang cepat. </font><font style="vertical-align: inherit;">Ketika perusahaan mulai, ada 65 LXC di 65 server fisik. </font><font style="vertical-align: inherit;">Pada setiap wadah dengan aplikasi, PHP-FPM, nginx dan perangkat lunak tambahan untuk metrik dan pencatatan sedang berjalan. </font><font style="vertical-align: inherit;">Tidak ada yang spesial. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selama bertahun-tahun, kami tidak pernah menambahkan zat besi untuk monolit. </font><font style="vertical-align: inherit;">Kami meningkatkan kehadiran, jumlah iklan, jumlah transaksi pengguna, dan kami terus mengoptimalkan, meningkatkan kode, mengoptimalkan perangkat lunak. </font><font style="vertical-align: inherit;">Konsumsi CPU dan memori telah menurun selama beberapa tahun terakhir: 65 kontainer untuk monolit sekarang cukup untuk kita.</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bagaimana Anda mengukur kinerja? </font><font style="vertical-align: inherit;">Alat apa yang Anda ukur waktu respons klien?</font></font></blockquote><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mikhail Buylov, Mamba</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami memiliki sistem pengumpulan log. </font><font style="vertical-align: inherit;">Log dua indikator - waktu dari awal FPM ke fungsi shutdown dan sampai akhir skrip. </font><font style="vertical-align: inherit;">Metrik kedua diperlukan untuk melihat apa yang terjadi setelah fungsi shutdown. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami mengukur JS. </font><font style="vertical-align: inherit;">Ini, sebenarnya, adalah metrik biasa-biasa saja, saluran jaringan sangat sering dilanggar. </font><font style="vertical-align: inherit;">Akibatnya, memuat di suatu tempat di pedalaman Rusia mulai tumpul. </font><font style="vertical-align: inherit;">Oleh karena itu, kita terlihat seperti ini: "Oh, melompat - itu berarti ada sesuatu yang jatuh." </font><font style="vertical-align: inherit;">Ditambah iklan pihak ketiga sangat menyimpangkan metrik. </font><font style="vertical-align: inherit;">Dan, yang paling penting, spammer datang, dan ini umumnya semacam keacakan.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Semyon Kataev, Avito</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Omong-omong, kami dulu menggunakan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pinba</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dari Badoo dengan </font><font style="vertical-align: inherit;">sangat aktif </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Saya suka dia sekarang. </font><font style="vertical-align: inherit;">Sebagian besar metrik dikumpulkan olehnya, tetapi kemudian beralih ke protokol StatsD. </font><font style="vertical-align: inherit;">Sekarang kami melakukan pengukuran dari berbagai titik: dari depan, dari server di depan aplikasi, dari nginx dan dari aplikasi PHP itu sendiri. </font><font style="vertical-align: inherit;">Kami memiliki tim kinerja yang berdedikasi. </font><font style="vertical-align: inherit;">Dia mulai dengan kinerja bagian depan, tetapi kemudian beralih ke dukungan. </font><font style="vertical-align: inherit;">Dari depan, ia mengumpulkan tidak hanya JS, CSS, dan statika lainnya, tetapi pada saat yang sama juga waktu respons server. </font><font style="vertical-align: inherit;">Pertama-tama, kami fokus pada waktu respons aplikasi.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pavel Murzakov, Badoo</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Semuanya mirip dengan apa yang orang-orang katakan kepada kami. </font><font style="vertical-align: inherit;">Menggunakan Pinba klasik untuk PHP, kami mengukur waktu berjalan skrip PHP dalam hal PHP. </font><font style="vertical-align: inherit;">Tetapi kami juga memiliki, misalnya, Pinba untuk nginx, yang mengukur waktu respons dari sudut pandang nginx. </font><font style="vertical-align: inherit;">Kami juga mengumpulkan metrik pada klien. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apa yang kita lihat? </font><font style="vertical-align: inherit;">Di satu sisi, waktu respons. </font><font style="vertical-align: inherit;">Ini tidak terkait dengan perencanaan sumber daya. </font><font style="vertical-align: inherit;">Jika buruk, perlu ditingkatkan, karena pada kenyataannya, kualitas layanan. </font><font style="vertical-align: inherit;">Hal lain adalah Anda harus merencanakan setrika dengan cara apa pun. </font><font style="vertical-align: inherit;">ITOps dan tim pemantau kami memantau semua perangkat keras. </font><font style="vertical-align: inherit;">Ada beberapa bar di jaringan, di disk. </font><font style="vertical-align: inherit;">Ada beberapa nilai setelah peringatan terjadi - dan kami melakukan sesuatu. </font><font style="vertical-align: inherit;">Seperti yang telah ditunjukkan oleh praktik, kami biasanya mengoptimalkan CPU: kami menabraknya.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Semyon Kataev, Avito </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pada kami aplikasi PHP mengukur dirinya sendiri dan di register_shutdown_function () membuang metrik. </font><font style="vertical-align: inherit;">Setiap LXC memiliki server StatsD, yang mengumpulkan metrik ini dan mengirimkannya melalui kolektor ke cluster Graphite (termasuk ClickHouse), tempat data disimpan. </font><font style="vertical-align: inherit;">Ini adalah diagnosa diri. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Juga di setiap wadah adalah nginx, mis. Nginx + PHP-FPM. </font><font style="vertical-align: inherit;">Dengan nginx, kami mengumpulkan metrik eksternal yang terkait dengan waktu berjalan aplikasi PHP. </font><font style="vertical-align: inherit;">Mereka juga menghadapi server terpisah (kami menyebutnya avi-http) nginx, yang melakukan perutean dasar, yang juga mengumpulkan metrik tingkat yang lebih tinggi, seperti waktu respons, jumlah 500 kode respons, dan lainnya.</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alat apa yang Anda miliki untuk trek kinerja? </font><font style="vertical-align: inherit;">Apa yang paling sering Anda gunakan?</font></font></blockquote><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mikhail Buylov, Mamba </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami menulis alat kami sendiri. Ketika Pinba baru saja keluar - pada tahun 2012, waktu yang sangat lama - itu adalah modul untuk MySQL yang menerima sesuatu seperti ini di atas UDP. Sulit untuk mengeluarkan grafis, itu tidak sangat dioptimalkan untuk kinerja. Dan kami tidak menghasilkan sesuatu yang lebih baik daripada menulis hal kami sendiri yang disebut Better Than Pinba. Ini hanya server penghitung yang menerimanya dari klien PHP. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami menyebarkan banyak penghitung waktu dalam kode: setiap kali kami ingin mengukur sesuatu, kami mengatur waktu mulai dan berhenti penghitung waktu dalam kode. Modul itu sendiri akan menghitung runtime penghitung, mengagregasikan penghitung yang terakumulasi ke dalam suatu paket, dan mengirimkannya ke daemon. Antarmuka itu sendiri akan mengekstrak semua yang Anda butuhkan dan membangun grafik yang terhubung di penghitung yang diinginkan.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Salah satu masalah Pinba adalah kurangnya antarmuka sendiri - itu perlu untuk mentransfer data ke RRD (kemudian ada kegelapan). </font><font style="vertical-align: inherit;">Oleh karena itu, kami menulis antarmuka kami sendiri. </font><font style="vertical-align: inherit;">Setiap kali kita melihat apa yang melompat, kita dapat menginstal skrip. </font><font style="vertical-align: inherit;">Dalam skrip semua konter agregat dikirim kepada kami, yang dikirimkan kepada kami. </font><font style="vertical-align: inherit;">Kita dapat melihat di mana penghitung telah tumbuh, atau waktu respons di penghitung telah meningkat, atau jumlah penghitung telah meningkat. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Itu bisa dilihat saat kinerja turun. </font><font style="vertical-align: inherit;">Kami mulai menggali dengan cara ini. </font><font style="vertical-align: inherit;">Sebelum PHP 7, kami menggunakan XHProf, lalu berhenti membangun bersama kami. </font><font style="vertical-align: inherit;">Karena itu, kami beralih ke Xdebug. </font><font style="vertical-align: inherit;">Xdebug kami menyodok hanya ketika masalah terlihat.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pavel Murzakov, Badoo</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ini adalah kepercayaan umum bahwa XHProf tidak akan dibangun di PHP 7. </font><font style="vertical-align: inherit;">Ini benar, tetapi hanya sebagian. </font><font style="vertical-align: inherit;">Jika Anda mengambil XHProf dari wizard, itu tidak akan terjadi. </font><font style="vertical-align: inherit;">Tetapi jika pada GitHub Anda beralih ke cabang yang disebut Eksperimental (atau sesuatu seperti itu), maka semuanya berfungsi dengan baik untuk PHP 7, siap produksi. </font><font style="vertical-align: inherit;">Diperiksa</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mikhail Buylov, Mamba</font></font></h3> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tidak, saya beralih. </font><font style="vertical-align: inherit;">Itu tidak berhasil untuk saya.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pavel Murzakov, Badoo</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya ingin menambahkan tentang Pinba. </font><font style="vertical-align: inherit;">Anda telah menjadi nabi sampai batas tertentu. </font><font style="vertical-align: inherit;">Kami juga, pada beberapa titik kehilangan produktivitas. </font><font style="vertical-align: inherit;">Kami membuat </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pinba2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , yang sangat cepat. </font><font style="vertical-align: inherit;">Ini dapat digunakan sebagai pengganti Pinba.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Semyon Kataev, Avito </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Semuanya sederhana dengan kita. </font><font style="vertical-align: inherit;">Kami hanya mengambil arahan kinerja ke dalam pekerjaan: kami mengumpulkan metrik, seperti waktu respons. </font><font style="vertical-align: inherit;">Kami menggunakan StatsD. </font><font style="vertical-align: inherit;">Kami belum menggunakan profiler apa pun secara teratur, tetapi saya tahu pasti bahwa beberapa tim menggunakannya dalam layanan Microsoft yang ditulis dalam PHP. </font><font style="vertical-align: inherit;">Menurut pendapat saya, bahkan seseorang relik New Relic. </font><font style="vertical-align: inherit;">Namun dalam konteks aplikasi monolitik utama, sejauh ini kami hanya mendekati ini.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pavel Murzakov, Badoo</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sejarah besi dipantau di Grafana, Zabbix. </font><font style="vertical-align: inherit;">Adapun bagian PHP, kami memiliki Pinba, kami memiliki banyak timer; </font><font style="vertical-align: inherit;">Kami membangun grafik yang nyaman di atasnya. </font><font style="vertical-align: inherit;">Kami menggunakan XHProf, pada produksi kami mengendarainya untuk sebagian permintaan. </font><font style="vertical-align: inherit;">Kami selalu memiliki profil XHProf baru. </font><font style="vertical-align: inherit;">Kami memiliki liveprof: ini adalah alat kami, Anda dapat membacanya, termasuk </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">di artikel saya</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Itu semua terjadi secara otomatis, Anda hanya perlu menonton. </font><font style="vertical-align: inherit;">Kami menggunakan phpspy. </font><font style="vertical-align: inherit;">Itu tidak selalu dimulai dengan kita: ketika seseorang ingin melihat sesuatu, dia memasuki mobil, melepas profilnya. </font><font style="vertical-align: inherit;">Pada prinsipnya, seperti halnya dengan Perf.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Semyon Kataev, Avito </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
XHProf memiliki cerita yang sama. </font><font style="vertical-align: inherit;">Kami pernah menggunakannya sejak lama: itu adalah inisiatif pribadi dari beberapa pengembang, dan, pada kenyataannya, tidak lepas landas. </font><font style="vertical-align: inherit;">Dia berhenti mengumpulkan. </font><font style="vertical-align: inherit;">Kami mengumpulkan banyak metrik dari panggilan router, pengontrol, berbagai model. </font><font style="vertical-align: inherit;">Sekitar 60–70% dari jaringan internal pusat data ditempati oleh paket-paket UDP dengan metrik. </font><font style="vertical-align: inherit;">Saat ini, ini sudah cukup bagi kami. </font><font style="vertical-align: inherit;">Sekarang kita akan mencari tempat baru untuk optimasi.</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Karena kita telah mencapai titik puncak: apakah seseorang secara sistematis terlibat dalam perencanaan kapasitas di perusahaan Anda? </font><font style="vertical-align: inherit;">Bagaimana proses ini dibangun?</font></font></blockquote><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Semyon Kataev, Avito </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aplikasi monolitik berjalan setidaknya 65 LXC selama setidaknya lima tahun. </font><font style="vertical-align: inherit;">Kami mengoptimalkan kode, memperbaikinya: ia memiliki sumber daya yang cukup. </font><font style="vertical-align: inherit;">Perencanaan kapasitas utama kami berlaku untuk Kubernetes, di mana sekitar 400 lebih atau kurang layanan mikro ditulis dalam PHP / Go. </font><font style="vertical-align: inherit;">Kami perlahan-lahan memotong potongan-potongan dari monolith, tetapi masih terus tumbuh. </font><font style="vertical-align: inherit;">Kita tidak bisa menghentikannya. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Secara umum, PHP adalah bahasa yang keren. </font><font style="vertical-align: inherit;">Dengan cepat mengimplementasikan logika bisnis.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pavel Murzakov, Badoo</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pertama-tama, ITOps dan tim pemantau memastikan bahwa ada sumber daya yang cukup. </font><font style="vertical-align: inherit;">Jika kita mulai mendekati nilai ambang, kolega memperhatikan ini. </font><font style="vertical-align: inherit;">Mereka mungkin terutama bertanggung jawab atas perencanaan kapasitas global. </font><font style="vertical-align: inherit;">Bagian PHP memiliki sumber daya CPU utama, jadi kami ikuti sendiri. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kita mengatur sendiri bar: kita tidak boleh "makan" lebih dari 60% dari cluster. </font><font style="vertical-align: inherit;">60%, dan bukan 95%, karena kami mengalami hipertensi, yang juga memeras lebih banyak dari prosesor daripada yang dapat Anda hilangkan tanpa itu. </font><font style="vertical-align: inherit;">Untuk ini, kami membayar dengan fakta bahwa setelah 50% dari konsumsi CPU kami, kami dapat tumbuh dengan cara yang tidak terduga, karena kernel hyper -reading tidak sepenuhnya jujur.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mikhail Buylov, Mamba </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami melakukan penyebaran dan melihat ada sesuatu yang gagal dengan kami - perencanaan kapasitas seperti itu. </font><font style="vertical-align: inherit;">Dengan mata! </font><font style="vertical-align: inherit;">Kami memiliki margin produktivitas tertentu yang memungkinkan kami melakukan ini. </font><font style="vertical-align: inherit;">Kami mencoba untuk tetap berpegang pada itu. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selain itu, kami melakukan optimasi post factum. </font><font style="vertical-align: inherit;">Ketika kita melihat sesuatu telah jatuh, kita mundur jika semuanya benar-benar buruk. </font><font style="vertical-align: inherit;">Tapi ini praktis tidak terjadi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Atau kita hanya melihat bahwa "di sini tidak optimal, sekarang kita akan segera memperbaiki semuanya dan semuanya akan berfungsi sebagaimana mestinya." </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami tidak terlalu peduli: sangat sulit, dan knalpotnya tidak akan terlalu besar.</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anda berbicara tentang layanan mikro. </font><font style="vertical-align: inherit;">Bagaimana mereka berinteraksi? </font><font style="vertical-align: inherit;">Apakah ini ISTIRAHAT atau Anda menggunakan protokol biner?</font></font></blockquote><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Semyon Kataev, Avito </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kafka digunakan untuk mengirim acara antar layanan, JSON-RPC digunakan untuk memastikan interaksi antar layanan, tetapi tidak lengkap, tetapi versi yang disederhanakan, yang tidak dapat kita singkirkan. </font><font style="vertical-align: inherit;">Ada implementasi yang lebih cepat: protobuf yang sama, gRPC. </font><font style="vertical-align: inherit;">Ini ada dalam rencana kami, tetapi tentu saja bukan prioritas. </font><font style="vertical-align: inherit;">Dengan lebih dari 400 layanan mikro, sulit untuk memindahkan semuanya ke protokol baru. </font><font style="vertical-align: inherit;">Ada banyak tempat lain untuk dioptimalkan. </font><font style="vertical-align: inherit;">Kami jelas tidak sanggup melakukannya sekarang.</font></font><br>
 <br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pavel Murzakov, Badoo</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami dengan demikian tidak memiliki layanan microser. </font><font style="vertical-align: inherit;">Ada layanan, ada juga Kafka, protokolnya sendiri di atas protobuf Google. </font><font style="vertical-align: inherit;">Mungkin, kita akan menggunakan gRPC, karena itu keren, ia memiliki dukungan untuk semua bahasa, kemampuan untuk dengan mudah mengikat bagian yang berbeda. </font><font style="vertical-align: inherit;">Tetapi ketika kami membutuhkannya, gRPC belum ada di sana. </font><font style="vertical-align: inherit;">Tapi ada protobuf, dan kami mengambilnya. </font><font style="vertical-align: inherit;">Di atas itu, hal-hal yang berbeda ditambahkan sehingga bukan hanya serialisasi, tetapi protokol lengkap.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mikhail Buylov, Mamba</font></font></h3> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami juga tidak memiliki layanan microser. </font><font style="vertical-align: inherit;">Ada sebagian besar layanan yang ditulis dalam C. Kami menggunakan JSON-RPC karena nyaman. </font><font style="vertical-align: inherit;">Anda baru saja membuka soket ketika Anda men-debug kode Anda, dan dengan cepat menulis apa yang Anda inginkan. </font><font style="vertical-align: inherit;">Sesuatu telah kembali padamu. </font><font style="vertical-align: inherit;">Protobuf lebih sulit karena Anda perlu menggunakan beberapa alat tambahan. </font><font style="vertical-align: inherit;">Ada overhead kecil, tapi kami percaya Anda perlu membayar untuk kenyamanan, dan ini bukan harga yang besar.</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anda memiliki basis data yang sangat besar. </font><font style="vertical-align: inherit;">Ketika Anda perlu mengubah sirkuit di salah satu dari mereka, bagaimana Anda melakukannya? </font><font style="vertical-align: inherit;">Semacam migrasi? </font><font style="vertical-align: inherit;">Jika migrasi ini memakan waktu beberapa hari, bagaimana ini mempengaruhi kinerja?</font></font></blockquote><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mikhail Buylov, Mamba </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami memiliki meja besar, monolitik. </font><font style="vertical-align: inherit;">Ada beling. </font><font style="vertical-align: inherit;">Shard berubah cukup cepat, karena ada banyak perubahan paralel sekaligus. </font><font style="vertical-align: inherit;">Meja besar dengan profil diubah sekitar tiga jam. </font><font style="vertical-align: inherit;">Kami menggunakan alat Perkonovskie yang tidak membuatnya membaca dan menulis. </font><font style="vertical-align: inherit;">Selain itu, kami menerapkan untuk mengubah sehingga kode mendukung kedua negara. </font><font style="vertical-align: inherit;">Setelah perubahan, kami juga menggunakan: penerapan lebih cepat daripada menerapkan skema apa pun.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pavel Murzakov, Badoo</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami memiliki penyimpanan terbesar (kami menyebutnya "tempat") - ini adalah basis data yang sangat luas. </font><font style="vertical-align: inherit;">Jika kita mengambil tabel “Pengguna”, maka dia memiliki banyak pecahan. </font><font style="vertical-align: inherit;">Saya tidak akan memberi tahu Anda dengan tepat berapa banyak tabel di satu server: idenya adalah ada banyak tabel kecil. </font><font style="vertical-align: inherit;">Ketika kita mengubah sirkuit, sebenarnya, kita hanya melakukan perubahan. </font><font style="vertical-align: inherit;">Di setiap meja kecil, itu terjadi dengan cepat. </font><font style="vertical-align: inherit;">Ada repositori lain - sudah ada pendekatan lain. </font><font style="vertical-align: inherit;">Jika ada satu basis besar, ada alat Perconian. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Secara umum, kami menggunakan berbagai hal sesuai dengan kebutuhan. </font><font style="vertical-align: inherit;">Perubahan yang paling sering adalah perubahan basis tempat yang sangat luas ini, di mana kami sudah memiliki proses yang dibangun. </font><font style="vertical-align: inherit;">Semuanya bekerja sangat sederhana.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Semyon Kataev, Avito</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aplikasi monolitik yang sama yang melayani sebagian besar lalu lintas digunakan lima hingga enam kali sehari. </font><font style="vertical-align: inherit;">Hampir setiap dua jam. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam hal bekerja dengan database, ini merupakan masalah yang terpisah. </font><font style="vertical-align: inherit;">Ada migrasi, mereka bergulir secara otomatis. </font><font style="vertical-align: inherit;">Ini adalah ulasan DBA. </font><font style="vertical-align: inherit;">Ada opsi untuk melewati migrasi dan memutar secara manual. </font><font style="vertical-align: inherit;">Migrasi akan secara otomatis beralih ke pementasan saat menguji kode. </font><font style="vertical-align: inherit;">Tetapi pada produksi, jika ada semacam migrasi meragukan yang menggunakan banyak sumber daya, maka DBA akan memulainya secara manual.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kode harus sedemikian rupa sehingga berfungsi dengan struktur database lama dan baru. </font><font style="vertical-align: inherit;">Kami sering melakukan beberapa perjalanan untuk menggunakan fitur. </font><font style="vertical-align: inherit;">Untuk dua atau tiga peluncuran, dimungkinkan untuk mendapatkan status yang diinginkan. </font><font style="vertical-align: inherit;">Demikian juga, ada database yang sangat besar, basis data yang terbengkalai. </font><font style="vertical-align: inherit;">Jika kami menghitung untuk semua layanan microser, maka pasti ada 100-150 penyebaran per hari.</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Saya ingin tahu berapa waktu respons backend standar untuk Anda yang Anda ikuti? </font><font style="vertical-align: inherit;">Kapan Anda memahami apa yang perlu Anda optimalkan lebih lanjut, atau berapa waktu untuk menyelesaikannya? </font><font style="vertical-align: inherit;">Apakah ada nilai "rata-rata rumah sakit"?</font></font></blockquote><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pavel Murzakov, Badoo</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tidak. </font><font style="vertical-align: inherit;">Tergantung pada titik akhir. </font><font style="vertical-align: inherit;">Kami melihat semuanya secara terpisah. </font><font style="vertical-align: inherit;">Mencoba memahami betapa pentingnya hal ini. </font><font style="vertical-align: inherit;">Beberapa titik akhir umumnya diminta di latar belakang. </font><font style="vertical-align: inherit;">Ini tidak mempengaruhi pengguna dengan cara apa pun, bahkan jika waktu responsnya adalah 20 detik. </font><font style="vertical-align: inherit;">Ini akan terjadi di latar belakang, tidak ada perbedaan. </font><font style="vertical-align: inherit;">Hal utama adalah bahwa beberapa hal penting dilakukan dengan cepat. </font><font style="vertical-align: inherit;">Mungkin 200 ms masih ok, tetapi peningkatan kecil sudah penting.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mikhail Buylov, Mamba </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami beralih dari rendering HTML ke permintaan API. </font><font style="vertical-align: inherit;">Faktanya, API merespons jauh lebih cepat daripada respons HTML besar dan berat. </font><font style="vertical-align: inherit;">Oleh karena itu, sulit untuk membedakan, misalnya, nilai 100 ms. </font><font style="vertical-align: inherit;">Kami fokus pada 200 ms. </font><font style="vertical-align: inherit;">Kemudian terjadi PHP 7 - dan kami mulai fokus pada 100 ms. </font><font style="vertical-align: inherit;">Ini adalah "rata-rata untuk rumah sakit." </font><font style="vertical-align: inherit;">Ini adalah metrik yang sangat kabur, yang menunjukkan bahwa inilah saatnya untuk setidaknya melihat ke sana. </font><font style="vertical-align: inherit;">Jadi kami lebih fokus pada penyebaran dan melompati waktu respons setelahnya.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Semyon Kataev, Avito</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami membuat sketsa dari salah satu tim pertunjukan. Kolega mengukur seberapa banyak penghasilan yang diperoleh perusahaan dengan mempercepat pemuatan halaman di bawah berbagai skenario. Kami menghitung berapa banyak lagi pembeli, transaksi, panggilan, transisi, dan seterusnya. Menurut data ini, dapat dipahami bahwa pada titik tertentu, akselerasi tidak lagi masuk akal. Misalnya, jika waktu respons salah satu halaman dari 90 ms dipercepat menjadi 70 ms, ini memberi + 2% pembeli. Dan jika Anda mempercepat dari 70 ms ke 60 ms, maka sudah ada ditambah 0,1% dari pembeli, yang umumnya termasuk dalam kesalahan. Sama seperti dengan teman-teman, semuanya sangat tergantung pada halaman yang sedang kami kerjakan. Secara umum, Avito 75 persentil - sekitar 75 ms. Menurut saya, ini lambat. Kami sekarang mencari tempat untuk mengoptimalkan. Sebelum transisi ke layanan mikro, semuanya terjadi jauh lebih cepat bagi kami, dan kami berusaha untuk mengoptimalkan kinerja.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/5j/tw/ig/5jtwigxel1bcp3pbmmvhdxdslhu.jpeg"><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dan pertanyaan abadi: besi atau optimasi? </font><font style="vertical-align: inherit;">Bagaimana memahami apakah layak membeli perangkat keras atau lebih baik berinvestasi dalam optimasi? </font><font style="vertical-align: inherit;">Dimana perbatasannya?</font></font></blockquote><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Semyon Kataev, Avito</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pendapat saya: seorang programmer sebenarnya adalah optimasi. </font><font style="vertical-align: inherit;">Sepertinya saya bahwa di perusahaan besar seperti Badoo, tambang, Yandex, ada banyak pengembang dari berbagai tingkatan. </font><font style="vertical-align: inherit;">Ada pengembang junior / magang dan pengembang terkemuka. </font><font style="vertical-align: inherit;">Sepertinya saya bahwa jumlah tempat untuk optimasi / revisi selalu ditambahkan di sana. </font><font style="vertical-align: inherit;">Besi adalah langkah terakhir. </font><font style="vertical-align: inherit;">Untuk monolit pada 65 LXC, kami belum menambahkan zat besi untuk waktu yang sangat lama. </font><font style="vertical-align: inherit;">Pemanfaatan CPU - 20%. </font><font style="vertical-align: inherit;">Kami sudah berpikir untuk mentransfernya ke kluster Kubernetes.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pavel Murzakov, Badoo</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya sangat suka posisi Semyon. Tetapi saya memiliki sudut pandang yang sangat berlawanan. Pertama-tama, saya akan melihat besi. Apakah mungkin untuk menjatuhkan zat besi dan apakah akan lebih murah? Jika demikian, maka lebih mudah untuk menyelesaikan masalah dengan setrika. Pengembang dapat melakukan hal lain, berguna saat ini. Waktu pengembang membutuhkan uang. Zat besi juga membutuhkan biaya, jadi Anda harus membandingkan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Yang mana dari ini yang lebih penting tidak jelas. Jika keduanya sama biayanya, maka perangkat kerasnya menang, karena pengembang akan dapat melakukan sesuatu saat ini. Khususnya, dalam hal PHP backend, kami tidak dapat melakukan ini. Optimalisasi harganya jauh lebih murah daripada membeli besi.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Akan berhenti. </font><font style="vertical-align: inherit;">Dalam hal perencanaan, kami memiliki beberapa jenis bar. </font><font style="vertical-align: inherit;">Jika kita mengurangi konsumsi CPU di bawahnya, maka kita berhenti. </font><font style="vertical-align: inherit;">Di sisi lain, ada juga kualitas layanan. </font><font style="vertical-align: inherit;">Jika kita melihat bahwa waktu respons tidak cocok untuk kita di suatu tempat, maka kita perlu mengoptimalkan.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mikhail Buylov, Mamba </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Menurut saya, semuanya tergantung pada ukuran tim dan proyek. </font><font style="vertical-align: inherit;">Semakin kecil proyek, semakin mudah untuk membeli perangkat keras, karena gaji pengembang konstan, dan kode yang berfungsi, pengguna yang bekerja dengannya, sangat berbeda. </font><font style="vertical-align: inherit;">Jika ada beberapa pengguna, maka lebih mudah untuk membeli perangkat keras dan mempercayakan pekerjaan kepada pengembang untuk mengembangkan proyek. </font><font style="vertical-align: inherit;">Jika ada banyak pengguna, maka satu pengembang dapat mengkompensasi sebagian besar biaya server.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Semyon Kataev, Avito </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Semuanya sangat tergantung pada skalanya. </font><font style="vertical-align: inherit;">Jika Anda memiliki seribu server dan optimasi mengarah pada fakta bahwa Anda tidak memerlukan seribu server lain, maka jelas lebih baik untuk mengoptimalkan. </font><font style="vertical-align: inherit;">Jika Anda memiliki satu server, maka Anda dapat dengan aman membeli dua atau tiga server lagi dan menilai pengoptimalan. </font><font style="vertical-align: inherit;">Jika perintah kecil, maka mulai server dibeli. </font><font style="vertical-align: inherit;">Jika tim besar dan Anda memiliki dua atau tiga pusat data, maka membeli enam pusat data sudah tidak begitu murah, tidak terlalu cepat.</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Karena kita memiliki mitap PHP, frasa ini harus berbunyi: mengapa kita membutuhkan PHP, karena kita memiliki masalah seperti itu sepanjang waktu? </font><font style="vertical-align: inherit;">Mari kita menulis ulang Go, C, C #, Rust, Node.js! </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apakah menurut Anda pendekatan penulisan ulang secara umum dapat dibenarkan? </font><font style="vertical-align: inherit;">Apakah ada masalah untuk solusi yang layak dilakukan dan investasi saat ini?</font></font></blockquote><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Semyon Kataev, Avito</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Secara umum, PHP adalah bahasa yang sangat baik. Ini benar-benar memungkinkan Anda untuk memecahkan masalah bisnis. Dia cukup cepat. Semua masalah kinerja adalah masalah kesalahan, bug, kode lawas (semacam kode yang kurang mahal, hal-hal yang tidak optimal yang akan ditembak dalam bahasa lain dengan cara yang sama). Dengan porting mereka mentah ke Golang, Java, Python, Anda mendapatkan kinerja yang sama. Seluruh masalah adalah bahwa ada banyak warisan.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Memperkenalkan bahasa baru, menurut saya, masuk akal untuk memperluas tumpukan dan peluang kerja. Sekarang cukup sulit untuk menemukan pengembang PHP yang bagus. Jika kami memperkenalkan Golang ke dalam techradar, maka kami dapat merekrut gophers. Ada beberapa shnik PHP dan sedikit akan menghubungkan di pasar, dan bersama-sama sudah ada banyak dari mereka. Misalnya, kami memiliki satu percobaan. Kami mengambil pengembang C # yang siap untuk belajar bahasa baru - kami hanya memperluas tumpukan perekrutan. Jika kami memberi tahu orang-orang bahwa kami akan mengajari mereka cara menulis dalam PHP, mereka mengatakan bahwa lebih baik tidak melakukannya. Dan jika kami menawarkan mereka untuk belajar menulis dalam PHP, Pergi dan masih menjanjikan kesempatan untuk menulis dengan Python, maka orang-orang lebih bersedia untuk merespons. Bagi saya, ini merupakan perpanjangan dari peluang kerja. Dalam bahasa lain, ada beberapa hal yang benar-benar hilang di PHP. Namun secara umum, PHP sangat memadai untuk menyelesaikan masalah bisnis dan mengimplementasikan proyek-proyek besar.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pavel Murzakov, Badoo</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya mungkin sepenuhnya setuju dengan Semyon. </font><font style="vertical-align: inherit;">Menulis ulang tidak masuk akal. </font><font style="vertical-align: inherit;">PHP adalah bahasa yang cukup produktif. </font><font style="vertical-align: inherit;">Jika Anda membandingkannya dengan bahasa non-kompilasi skrip lain, maka itu mungkin akan menjadi yang tercepat. </font><font style="vertical-align: inherit;">Menulis ulang ke dalam beberapa bahasa seperti Go dan lainnya? </font><font style="vertical-align: inherit;">Ini adalah bahasa lain, mereka memiliki masalah lain. </font><font style="vertical-align: inherit;">Masih lebih sulit untuk menuliskannya: tidak terlalu cepat dan ada banyak nuansa.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Meskipun demikian, ada hal-hal yang sulit atau tidak nyaman untuk ditulis dalam PHP. </font><font style="vertical-align: inherit;">Beberapa hal multi-proses, multi-utas lebih baik untuk ditulis dalam bahasa lain. </font><font style="vertical-align: inherit;">Contoh tugas di mana non-penggunaan PHP dibenarkan, pada prinsipnya, penyimpanan apa pun. </font><font style="vertical-align: inherit;">Jika ini adalah layanan yang menyimpan banyak memori, maka PHP mungkin bukan bahasa terbaik, karena memiliki overhead memori yang sangat besar karena pengetikan dinamis. </font><font style="vertical-align: inherit;">Ternyata Anda menyimpan int 4-byte, dan 50 byte dikonsumsi. </font><font style="vertical-align: inherit;">Tentu saja, saya melebih-lebihkan, tetapi overhead ini masih sangat besar. </font><font style="vertical-align: inherit;">Jika Anda memiliki beberapa jenis penyimpanan, lebih baik menulisnya dalam bahasa kompilasi lain dengan pengetikan statis. </font><font style="vertical-align: inherit;">Sama seperti beberapa hal yang membutuhkan eksekusi multi-threaded.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mikhail Buylov, Mamba </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mengapa PHP dianggap tidak terlalu cepat? Karena itu dinamis. Terjemahan Go adalah solusi untuk masalah menerjemahkan kode dari pengetikan dinamis ke statis. Karena ini, semuanya terjadi lebih cepat. Khusus untuk Go, dalam rencana saya ada tugas aliran data tertentu. Misalnya, jika ada semacam aliran data yang perlu dikonversi ke format yang lebih nyaman, ini adalah hal yang ideal. Dibesarkan oleh daemon, ia menerima satu aliran data pada input, ia mengeluarkan yang lain. Memori kecil makan. PHP memakan banyak memori dalam hal ini: Anda harus hati-hati memastikan bahwa itu dibersihkan.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Transfer ke Pergi adalah transfer ke layanan microser, karena Anda tidak akan memotong seluruh kode. </font><font style="vertical-align: inherit;">Anda tidak akan mengambil dan menulis ulang secara keseluruhan. </font><font style="vertical-align: inherit;">Penerjemahan ke layanan mikro adalah tugas yang lebih dalam daripada terjemahan dari satu bahasa ke bahasa lain. </font><font style="vertical-align: inherit;">Penting untuk menyelesaikannya terlebih dahulu, dan kemudian pikirkan tentang bahasa apa yang akan ditulis. </font><font style="vertical-align: inherit;">Bagian tersulit adalah mempelajari cara menjalankan layanan mikro.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Semyon Kataev, Avito</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tidak perlu menggunakan Go dalam layanan microser. Banyak layanan ditulis dalam PHP dan memiliki waktu respons yang dapat diterima. Tim yang mendukung mereka memutuskan sendiri bahwa mereka perlu menulis logika bisnis dengan sangat cepat dan memperkenalkan fitur. Mereka kadang-kadang melakukan lebih cepat daripada penjual. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami memiliki kecenderungan untuk merekrut pedagang, menerjemahkan ke Go. Tetapi kami masih memiliki sebagian besar kode yang ditulis dalam PHP, dan itu akan menjadi setidaknya untuk beberapa tahun lagi. Tidak ada ras yang sebenarnya, kami tidak memutuskan bahwa Go lebih baik atau lebih buruk. Enam rilis diluncurkan ke monolith setiap hari. Obrolan kami "Avito Deploy" memiliki daftar tugas yang dikerahkan. Setidaknya 20 tugas diluncurkan per hari di setiap rilis: setidaknya lima atau enam rilis per hari, sekitar 80 tugas yang telah dilakukan orang pada tugas-tugas ini. Semua ini dilakukan dalam PHP.</font></font><br>
<br>
<blockquote>      ?       -,    ?</blockquote><br>
<h3> , </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ini sangat sulit. Ada momen psikologis: Saya meluncurkan fitur baru - Anda selesai. Meluncurkan fitur baru yang luar biasa - Anda super muda! Ketika seorang manajer atau pengembang mengatakan bahwa ia menghapus fitur (dinonaktifkan), ia tidak menerima pengakuan tersebut. Karyanya tidak terlihat. Sebagai contoh, sebuah tim dapat menerima bonus untuk keberhasilan implementasi fitur baru, tetapi saya belum melihat adanya penghargaan untuk fungsionalitas mati atau eksperimental. Dan hasil dari ini bisa sangat kolosal. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Banyak fitur warisan yang belum ada yang menggunakan benar-benar memperlambat pengembangan. Ada ratusan kasus ketika seseorang baru memasuki perusahaan dan mere-refactore kode mati yang tidak pernah dipanggil karena dia tidak tahu bahwa itu adalah kode mati.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami mencoba bernegosiasi dengan para manajer, mencari tahu dengan fitur seperti apa itu, dengan para analis kami mempertimbangkan berapa banyak uang yang dihasilkannya, siapa yang membutuhkannya, dan hanya setelah itu kami mencoba memotongnya. </font><font style="vertical-align: inherit;">Ini adalah proses yang rumit.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mikhail Buylov, Mamba </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami memotong kode mati ketika kami sampai ke sana. </font><font style="vertical-align: inherit;">Dan jauh dari selalu mungkin untuk memotongnya dengan cepat. </font><font style="vertical-align: inherit;">Pertama Anda menulis satu kode, lalu yang lain, di atas yang ketiga, dan kemudian di bawahnya ternyata fitur ini tidak diperlukan. </font><font style="vertical-align: inherit;">Dia menarik sejumlah besar dependensi, yang juga perlu diperbaiki. </font><font style="vertical-align: inherit;">Ini tidak selalu memungkinkan, dan manajer perlu melaporkannya. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Manajer menetapkan tugas, Anda menilainya. </font><font style="vertical-align: inherit;">Anda berkata: "Anda tahu, bung, saya akan melakukan ini selama enam bulan. </font><font style="vertical-align: inherit;">Apakah Anda siap untuk mentolerir setengah tahun? " </font><font style="vertical-align: inherit;">Dia mengatakan: "Tidak, mari kita pikirkan apa yang perlu dipotong, apa yang bisa ditinggalkan. </font><font style="vertical-align: inherit;">Apa yang secara fundamental diperlukan dan apa yang dibutuhkan untuk bermain-main. " </font><font style="vertical-align: inherit;">Begitulah caranya.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pavel Murzakov, Badoo</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ketika seorang pengembang menerima fitur, ia mengevaluasi seberapa sulitnya dalam hal pengembangan, seberapa sulit itu dalam hal kinerja. Jika dia melihat salah satu atau yang lain, dia mengklarifikasi dengan manajer produk apakah ini benar-benar diperlukan, apakah kita dapat menghapus sesuatu di suatu tempat. Kadang-kadang terjadi bahwa perubahan tidak kritis, dan manajer dengan cepat membuat konsesi ketika mereka mengetahui bahwa hal ini rumit atau memakan sumber daya. Itu terjadi begitu saja: Anda mengatakan "Ayo hapus" - dan hanya itu. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kebetulan fitur tersebut pergi, dan setelah itu kami perhatikan bahwa itu tidak akan berfungsi sebaik yang kami inginkan. Dan kemudian, sekali lagi, Anda dapat berbicara dengan manajer. Seringkali semuanya berakhir dengan sukses.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tidak ada proses bawaan untuk menghapus fitur. Ini dilakukan secara sporadis. Kami melihat ada beberapa fitur, kami datang dan menawarkan untuk mematikannya. Kami mematikannya, menonton apa yang memberi, dan hentikan itu. Hal lain adalah kode mati. Kami memiliki ekstensi khusus, bahkan seluruh infrastruktur, untuk deteksi kode mati. Kami melihat kode mati ini. Kami mencoba untuk memotongnya perlahan. Pertanyaan lain adalah jika benar-benar mati dan permintaan tidak pernah masuk, maka itu tidak mempengaruhi kinerja dengan cara apa pun. Itu mempengaruhi daya dukungan. Orang-orang terus membacanya, meskipun mereka mungkin tidak membacanya. Tidak ada koneksi khusus dengan kinerja.</font></font><br>
<br>
<blockquote><i>15      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Badoo PHP Meetup</a>. ,      : SuperJob, ManyChat, , Badoo  FunCorp    . <br>
<br>
,   ,       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">YouTube-</a>. ,       - .<br>
<br>
   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="> </a>,     .</i><br>
</blockquote></div>
      
    </div><p class="reference-to-source js-reference-to-source">Source: https://habr.com/ru/post/undefined/</p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id487224/index.html">Berapa lama konstruksi jangka panjang, yang ditakdirkan untuk menjadi maha karya</a></li>
<li><a href="../id487226/index.html">Buat lencana Anda: Add-On yang menyebalkan tidak masalah OFFZONE</a></li>
<li><a href="../id487228/index.html">Frontend mitap Facebook dan AvitoTech</a></li>
<li><a href="../id487230/index.html">USA Life Notes</a></li>
<li><a href="../id487232/index.html">Pencetakan kekebalan pada masa kanak-kanak: asal mula perlindungan virus</a></li>
<li><a href="../id487238/index.html">Bagaimana merancang peralatan perlindungan jaringan listrik</a></li>
<li><a href="../id487242/index.html">Februari Acara TI Digest</a></li>
<li><a href="../id487246/index.html">Otoritas Sertifikasi Tensor dapat membahayakan kunci pribadi pelanggan</a></li>
<li><a href="../id487248/index.html">Sedikit lagi tentang pengujian yang tidak tepat</a></li>
<li><a href="../id487250/index.html">Alfa tertunda berbaur</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>