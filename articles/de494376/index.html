<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🐵 🥧 🤾🏾 Hierarchischer Tiefenpuffer 👇🏿 💓 ✳️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Kurze Review
 Ein hierarchischer Tiefenpuffer ist ein mehrstufiger Tiefenpuffer (Z-Puffer), der als Beschleunigungsstruktur zum Abfragen von Tiefen ve...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Hierarchischer Tiefenpuffer</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/494376/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/fr/kx/e8/frkxe8hnnru9xzoo2g9k8qec2sq.png"></div><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kurze Review</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ein hierarchischer Tiefenpuffer ist ein mehrstufiger Tiefenpuffer (Z-Puffer), der als Beschleunigungsstruktur zum Abfragen von Tiefen verwendet wird. Wie im Fall von Textur-Mip-Ketten sind die Größen jeder Ebene normalerweise das Ergebnis der Division der Größe des Puffers mit voller Auflösung durch den Grad zwei. In diesem Artikel werde ich über zwei Möglichkeiten sprechen, einen hierarchischen Tiefenpuffer aus einem Puffer mit voller Auflösung zu generieren. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zunächst werde ich zeigen, wie eine vollständige Mip-Kette für einen Tiefenpuffer generiert wird, wodurch die Genauigkeit von Tiefenabfragen im Texturkoordinatenraum (NDC) auch für Tiefenpuffergrößen ungleich Zweierpotenzen erhalten bleibt. (Im Internet bin ich auf Codebeispiele gestoßen, die diese Genauigkeit nicht garantieren, was die Ausführung genauer Abfragen bei hohen Mip-Levels erschwert.)</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In Fällen, in denen nur eine Downsampling-Ebene erforderlich ist, werde ich zeigen, wie diese Ebene mit einem einzigen Aufruf eines Compute-Shaders mithilfe atomarer Operationen im gemeinsam genutzten Speicher der Arbeitsgruppe generiert wird. </font><font style="vertical-align: inherit;">Für meine Anwendung, bei der nur eine Auflösung von 1/16 x 1/16 erforderlich ist (Mip-Level 4), ist die Methode mit dem Computational Shader </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2-3 Mal schneller</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> als der übliche Ansatz, bei dem die Mip-Kette in mehreren Durchgängen heruntergesampelt wird.</font></font><br>
<a name="habracut"></a><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Einführung</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hierarchische Tiefen (auch Hi-Z genannt) sind eine Technik, die häufig in 3D-Grafiken verwendet wird. Es wird verwendet, um das Trimmen unsichtbarer Geometrie (Okklusions-Culling) (sowohl in der </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CPU</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> als </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">auch</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in der </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GPU</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), die Berechnung von </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reflexionen im Bildschirmraum</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">volumetrischen Nebel</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und vieles mehr </font><font style="vertical-align: inherit;">zu beschleunigen </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Darüber hinaus werden </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hi-Z-</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> GPUs </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">häufig</font></a><font style="vertical-align: inherit;"> als Teil einer Rasterisierungspipeline </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">implementiert</font></a><font style="vertical-align: inherit;"> . Schnelle Hi-Z-Suchvorgänge in den Caches auf dem Chip ermöglichen es Ihnen, Fragmentkacheln vollständig zu überspringen, wenn sie vollständig von zuvor gerenderten Grundelementen abgedeckt sind.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Grundidee von Hi-Z besteht darin, Tiefenabfragevorgänge durch Lesen aus Puffern mit niedrigerer Auflösung zu beschleunigen. </font><font style="vertical-align: inherit;">Dies ist aus zwei Gründen schneller als das Lesen von Tiefen mit voller Auflösung aus dem Puffer:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ein Texel (oder nur einige Texel) eines Puffers mit niedrigerer Auflösung kann als ein ungefährer Wert einer Vielzahl von Texeln eines Puffers mit hoher Auflösung verwendet werden.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ein Puffer mit niedrigerer Auflösung kann klein genug sein und zwischengespeichert werden, was die Ausführung von Suchvorgängen (insbesondere bei wahlfreiem Zugriff) erheblich beschleunigt.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Inhalt der heruntergesampelten Hi-Z-Pufferpegel hängt davon ab, wie sie verwendet werden (ob der Tiefenpuffer </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"invertiert" wird</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , welche Arten von Anforderungen verwendet werden sollten). Im Allgemeinen speichert ein Texel auf der Hi-Z-Pufferebene </font></font><code>min</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">oder </font></font><code>max</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">alle ihm entsprechenden Texel auf der vorherigen Ebene. Manchmal werden die Werte von </font></font><code>min</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und </font><font style="vertical-align: inherit;">gleichzeitig gespeichert </font></font><code>max</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Einfache gemittelte Werte (die häufig in den Mip-Ebenen regulärer Texturen verwendet werden) werden selten verwendet, da sie für solche Abfragetypen selten nützlich sind. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hi-Z-Puffer werden am häufigsten fast sofort am Ausgang angefordert, um eine weitere Verarbeitung und genauere Suchvorgänge im Puffer mit voller Auflösung zu vermeiden. Zum Beispiel, wenn wir Werte speichern</font></font><code>max</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Für einen nicht invertierten Tiefenpuffer (in dem das Objekt umso größer ist, je größer der Tiefenwert ist) können wir schnell genau bestimmen, ob eine bestimmte Position im Bildschirmbereich von einem Tiefenpuffer abgedeckt wird (wenn seine Koordinate Z&gt; der in einigen gespeicherte Wert (max) ist höherer Pegel (d. h. niedrigere Auflösung) des Hi-Z-Puffers). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bitte beachten Sie, dass ich den Ausdruck „genau“ verwendet habe: Wenn die Koordinate Z &lt;= der empfangene Wert (max) ist, ist nicht bekannt, ob sich der Puffer überlappt. </font><font style="vertical-align: inherit;">In einigen Anwendungen kann es in Fällen von Unsicherheit erforderlich sein, den Puffer nach Tiefen mit voller Auflösung zu durchsuchen. </font><font style="vertical-align: inherit;">In anderen Fällen ist dies nicht erforderlich (z. B. wenn nur unnötige Berechnungen auf dem Spiel stehen und nicht das richtige Rendering).</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Meine Anwendung: Rendern von Partikeln in einem Computational Shader</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich war mit der Notwendigkeit konfrontiert, Hi-Z bei der Implementierung des </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Partikel-Renderings in einem Computational Shader</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in der Engine meiner </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PARTICULATE</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> VR-Anwendung zu verwenden </font><font style="vertical-align: inherit;">. Da diese Rendering-Technik keine Rasterung mit festen Funktionen verwendet, muss für jedes Partikel mit einer Größe von einem Pixel eine eigene Tiefenprüfung verwendet werden. Und da die Partikel in keiner Weise sortiert sind, ist der Zugriff auf den Tiefenpuffer (im schlimmsten Fall) nahezu zufällig. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Suchvorgänge auf einer Vollbild-Textur mit wahlfreiem Zugriff führen zu einer schlechten Leistung. Um die Last zu reduzieren, suche ich zuerst nach Tiefen im Puffer mit reduzierter Tiefe mit einer Auflösung von 1/16 x 1/16 gegenüber dem Original. Dieser Puffer enthält Tiefenwerte.</font></font><code>min</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dadurch kann der Computer-Rendering-Shader für die überwiegende Mehrheit der sichtbaren Partikel den Tiefentest mit voller Auflösung überspringen. (Wenn die Partikeltiefe &lt;die minimale Tiefe ist, die im Puffer mit niedrigerer Auflösung gespeichert ist, wissen wir, dass sie absolut sichtbar ist. Wenn sie&gt; = min ist, müssen wir den Tiefenpuffer mit voller Auflösung überprüfen.) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dank dessen ist der Tiefentest für sichtbare Partikel im allgemeinen Fall wird zu einem kostengünstigen Betrieb. (Für Partikel, die sich durch Geometrie überlappen, ist es teurer, aber es passt zu uns, weil es keine Renderkosten verursacht. Daher erfordern Partikel immer noch wenig Berechnung.) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aufgrund der Tatsache, dass die Suche zuerst im Puffer von Tiefen mit niedrigerer Auflösung durchgeführt wird (wie oben erwähnt). wird die </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Partikelwiedergabezeit um maximal 35% reduziert</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">im Vergleich zu dem Fall, in dem die Suche nur im Puffer mit voller Auflösung durchgeführt wird. </font><font style="vertical-align: inherit;">Daher ist Hi-Z für meine Anwendung sehr vorteilhaft. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nun werden zwei Techniken zum Erzeugen eines hierarchischen Tiefenpuffers betrachtet.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Technik 1: Generieren einer vollständigen Mip-Kette</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In vielen Hi-Z-Anwendungen ist die Erstellung einer vollständigen Tiefenpuffer-Mip-Kette erforderlich. Wenn Sie beispielsweise ein Okklusions-Culling mit Hi-Z durchführen, wird das Begrenzungsvolumen in den Bildschirmbereich projiziert und anhand der projizierten Größe die geeignete Mip-Ebene ausgewählt (sodass bei jedem Überlappungstest eine feste Anzahl von Texeln beteiligt ist). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Erzeugen einer Mip-Kette aus dem Tiefenpuffer mit voller Auflösung ist normalerweise eine einfache Aufgabe - für jedes Texel auf Stufe N nehmen wir </font></font><code>max</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(oder </font></font><code>min</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">oder beide) die entsprechenden 4 Texel in der zuvor erzeugten Stufe N-1. Wir führen sequentielle Durchgänge durch (jedes Mal, wenn die Größe um die Hälfte reduziert wird), bis wir die letzte Mip-Stufe 1x1 in der Größe erhalten.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bei Tiefenpuffern, deren Größe nicht der Zweierpotenz entspricht, ist jedoch alles komplizierter. Da Hi-Z für Tiefenpuffer häufig aus Standard-Bildschirmauflösungen (die selten Zweierpotenzen sind) erstellt wird, müssen wir eine zuverlässige Lösung für dieses Problem finden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lassen Sie uns zunächst entscheiden, was der Wert jedes Tiefenpuffers auf Texel-Mip-Ebene bedeutet. In diesem Artikel wird davon ausgegangen, dass die MIP-Kette Werte speichert </font></font><code>min</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Tiefensuchoperationen sollten die Filterung der nächsten Nachbarn verwenden, da die Interpolation von Werten </font></font><code>min</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">für uns nutzlos ist und die hierarchische Natur der erstellten Mip-Kette von Tiefen beeinträchtigt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Was genau bedeutet der von uns erhaltene Wert des einzelnen Texels auf der Mip-Ebene N? Dies sollte der Mindestwert sein (</font></font><code>min</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) aller Texel des Vollbild-Tiefenpuffers, der denselben Platz im (normalisierten) Texturkoordinatenraum einnimmt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mit anderen Worten, wenn eine separate Koordinate der Textur (im Intervall</font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>[</mo><mn>0</mn><mo>,</mo><mn>1</mn><msup><mo stretchy=&quot;false&quot;>]</mo><mn>2</mn></msup></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.707ex" height="2.884ex" viewBox="0 -916.9 2457.1 1241.8" role="img" focusable="false" style="vertical-align: -0.755ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAIN-5B" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAIN-30" x="278" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAIN-2C" x="779" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAIN-31" x="1224" y="0"></use><g transform="translate(1724,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAIN-5D" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAIN-32" x="393" y="513"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">[</mo><mn>0</mn><mo>,</mo><mn>1</mn><msup><mo stretchy="false">]</mo><mn>2</mn></msup></math></span></span><script type="math/tex" id="MathJax-Element-1">[0, 1]^2</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) auf ein einzelnes Texel des Puffers mit voller Auflösung abgebildet wird (durch Filtern der nächsten Nachbarn), dann sollte dieses Texel mit voller Auflösung als Kandidat für den </font></font><code>min</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">für das Texel berechneten </font><font style="vertical-align: inherit;">Wert </font><font style="vertical-align: inherit;">bei jedem nachfolgenden höheren Mip-Level betrachtet werden, mit dem dieselbe Texturkoordinate abgebildet wird. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn diese Entsprechung garantiert ist, werden wir sicher sein, dass die Suchoperation bei hohen Mip-Pegeln niemals den Tiefenwert&gt; Texelwert in derselben Texturkoordinate zurückgibt, die dem Puffer mit voller Auflösung (Ebene 0) entspricht. Bei einem separaten N bleibt diese Garantie für alle darunter liegenden Ebenen erhalten (&lt;N).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Für gerade Dimensionen (und im Fall von Puffern mit voller Auflösung, bei denen es sich um Zweierpotenzen handelt, sind gerade Dimensionen auf jeder Ebene bis zur allerletzten Ebene, bei der die Dimensionen gleich 1 werden) einfach durchzuführen. </font><font style="vertical-align: inherit;">Im eindimensionalen Fall für Texel mit einem Index</font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>i</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="0.802ex" height="2.009ex" viewBox="0 -755.5 345.5 865.1" role="img" focusable="false" style="vertical-align: -0.255ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMATHI-69" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>i</mi></math></span></span><script type="math/tex" id="MathJax-Element-2">i</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> auf Stufe N müssen wir Texel auf Stufe N-1 mit Indizes nehmen </font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mn>2</mn></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.162ex" height="2.009ex" viewBox="0 -755.5 500.5 865.1" role="img" focusable="false" style="vertical-align: -0.255ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAIN-32" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>2</mn></math></span></span><script type="math/tex" id="MathJax-Element-3">2</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-4-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mn>2</mn><mi>i</mi><mo>+</mo><mn>1</mn></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.968ex" height="2.134ex" viewBox="0 -755.5 2569.4 918.9" role="img" focusable="false" style="vertical-align: -0.38ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAIN-32" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMATHI-69" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAIN-2B" x="1068" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAIN-31" x="2068" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>2</mn><mi>i</mi><mo>+</mo><mn>1</mn></math></span></span><script type="math/tex" id="MathJax-Element-4">2i + 1</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und finden ihre Bedeutung </font></font><code>min</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Also</font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-5-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>D</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>N</mi></mrow></msub><mo stretchy=&quot;false&quot;>[</mo><mi>i</mi><mo stretchy=&quot;false&quot;>]</mo><mo>=</mo><mtext>min</mtext><mo stretchy=&quot;false&quot;>(</mo><msub><mi>D</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>N</mi><mo>&amp;#x2212;</mo><mn>1</mn></mrow></msub><mo stretchy=&quot;false&quot;>[</mo><mn>2</mn><mi>i</mi><mo stretchy=&quot;false&quot;>]</mo><mo>,</mo><msub><mi>D</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>N</mi><mo>&amp;#x2212;</mo><mn>1</mn></mrow></msub><mo stretchy=&quot;false&quot;>[</mo><mn>2</mn><mi>i</mi><mo>+</mo><mn>1</mn><mo stretchy=&quot;false&quot;>]</mo><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="37.481ex" height="2.634ex" viewBox="0 -809.3 16137.7 1134.2" role="img" focusable="false" style="vertical-align: -0.755ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMATHI-44" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMATHI-4E" x="1171" y="-213"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAIN-5B" x="1556" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMATHI-69" x="1835" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAIN-5D" x="2180" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAIN-3D" x="2737" y="0"></use><g transform="translate(3793,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAIN-6D"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAIN-69" x="833" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAIN-6E" x="1112" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAIN-28" x="5461" y="0"></use><g transform="translate(5851,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMATHI-44" x="0" y="0"></use><g transform="translate(828,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMATHI-4E" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAIN-2212" x="888" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAIN-31" x="1667" y="0"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAIN-5B" x="8312" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAIN-32" x="8590" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMATHI-69" x="9091" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAIN-5D" x="9436" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAIN-2C" x="9715" y="0"></use><g transform="translate(10160,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMATHI-44" x="0" y="0"></use><g transform="translate(828,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMATHI-4E" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAIN-2212" x="888" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAIN-31" x="1667" y="0"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAIN-5B" x="12621" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAIN-32" x="12900" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMATHI-69" x="13400" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAIN-2B" x="13968" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAIN-31" x="14969" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAIN-5D" x="15469" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAIN-29" x="15748" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>D</mi><mrow class="MJX-TeXAtom-ORD"><mi>N</mi></mrow></msub><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo>=</mo><mtext>min</mtext><mo stretchy="false">(</mo><msub><mi>D</mi><mrow class="MJX-TeXAtom-ORD"><mi>N</mi><mo>−</mo><mn>1</mn></mrow></msub><mo stretchy="false">[</mo><mn>2</mn><mi>i</mi><mo stretchy="false">]</mo><mo>,</mo><msub><mi>D</mi><mrow class="MJX-TeXAtom-ORD"><mi>N</mi><mo>−</mo><mn>1</mn></mrow></msub><mo stretchy="false">[</mo><mn>2</mn><mi>i</mi><mo>+</mo><mn>1</mn><mo stretchy="false">]</mo><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-5">D_{N}[i] = \text{min}(D_{N-1}[2i], D_{N-1}[2i + 1])</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Wir können die Texel direkt im Verhältnis „2 zu 1“ (und damit in der Größe der Texturkoordinaten) vergleichen, da die Größe jeder Ebene genau zweimal kleiner ist als die der vorherigen.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/11f/ca7/b43/11fca7b43dd706d72f35590f69422e2c.svg"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ein Beispiel für gleichmäßige Levelgrößen: 6 Texel auf diesem Level werden auf einem höheren Level auf 3 reduziert. </font><font style="vertical-align: inherit;">Die Texturkoordinatengrößen jedes der drei Texel auf hoher Ebene werden genau auf zwei Texel auf niedrigerer Ebene überlagert. </font><font style="vertical-align: inherit;">(Punkte sind die Zentren von Texeln, und Quadrate sind die Abmessungen der Texturkoordinate beim Filtern der nächsten Nachbarn.)</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Bei ungeraden Ebenengrößen (und Puffer mit voller Auflösung, die keine Zweierpotenz haben, haben mindestens eine Ebene mit einer ungeraden Größe) alles Härter werden. </font><font style="vertical-align: inherit;">Für Stufe N-1 von ungerader Größe</font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-6-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;>d</mi><mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;>i</mi><mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;>m</mi></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>N</mi><mo>&amp;#x2212;</mo><mn>1</mn></mrow></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="7.595ex" height="2.384ex" viewBox="0 -755.5 3270.2 1026.6" role="img" focusable="false" style="vertical-align: -0.63ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAINI-64" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAINI-69" x="511" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAINI-6D" x="819" y="0"></use><g transform="translate(1637,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMATHI-4E" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAIN-2212" x="888" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAIN-31" x="1667" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mrow class="MJX-TeXAtom-ORD"><mi class="MJX-tex-mathit" mathvariant="italic">d</mi><mi class="MJX-tex-mathit" mathvariant="italic">i</mi><mi class="MJX-tex-mathit" mathvariant="italic">m</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mi>N</mi><mo>−</mo><mn>1</mn></mrow></msub></math></span></span><script type="math/tex" id="MathJax-Element-6">\mathit{dim}_{N-1}</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Die Größe der nächsten Ebene (N) ist gleich </font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-7-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;>d</mi><mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;>i</mi><mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;>m</mi></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>N</mi></mrow></msub><mo>=</mo><mo fence=&quot;false&quot; stretchy=&quot;false&quot;>&amp;#x230A;</mo><mfrac><msub><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;>d</mi><mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;>i</mi><mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;>m</mi></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>N</mi><mo>&amp;#x2212;</mo><mn>1</mn></mrow></msub><mn>2</mn></mfrac><mo fence=&quot;false&quot; stretchy=&quot;false&quot;>&amp;#x230B;</mo></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="16.865ex" height="3.759ex" viewBox="0 -1132.2 7261.2 1618.6" role="img" focusable="false" style="vertical-align: -1.13ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAINI-64" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAINI-69" x="511" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAINI-6D" x="819" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMATHI-4E" x="2315" y="-213"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAIN-3D" x="2643" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAIN-230A" x="3699" y="0"></use><g transform="translate(4144,0)"><g transform="translate(120,0)"><rect stroke="none" width="2432" height="60" x="0" y="220"></rect><g transform="translate(60,558)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAINI-64" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAINI-69" x="511" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAINI-6D" x="819" y="0"></use><g transform="translate(1157,-107)"><use transform="scale(0.5)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMATHI-4E" x="0" y="0"></use><use transform="scale(0.5)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAIN-2212" x="888" y="0"></use><use transform="scale(0.5)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAIN-31" x="1667" y="0"></use></g></g><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAIN-32" x="1469" y="-542"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAIN-230B" x="6816" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mrow class="MJX-TeXAtom-ORD"><mi class="MJX-tex-mathit" mathvariant="italic">d</mi><mi class="MJX-tex-mathit" mathvariant="italic">i</mi><mi class="MJX-tex-mathit" mathvariant="italic">m</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mi>N</mi></mrow></msub><mo>=</mo><mo fence="false" stretchy="false">⌊</mo><mfrac><msub><mrow class="MJX-TeXAtom-ORD"><mi class="MJX-tex-mathit" mathvariant="italic">d</mi><mi class="MJX-tex-mathit" mathvariant="italic">i</mi><mi class="MJX-tex-mathit" mathvariant="italic">m</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mi>N</mi><mo>−</mo><mn>1</mn></mrow></msub><mn>2</mn></mfrac><mo fence="false" stretchy="false">⌋</mo></math></span></span><script type="math/tex" id="MathJax-Element-7">\mathit{dim}_{N} = \lfloor \frac{\mathit{dim}_{N-1}}{2} \rfloor</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, also </font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-8-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo>&amp;#x2260;</mo><mfrac><msub><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;>d</mi><mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;>i</mi><mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;>m</mi></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>N</mi><mo>&amp;#x2212;</mo><mn>1</mn></mrow></msub><mn>2</mn></mfrac></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="8.66ex" height="3.759ex" viewBox="0 -1132.2 3728.6 1618.6" role="img" focusable="false" style="vertical-align: -1.13ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAIN-2260" x="0" y="0"></use><g transform="translate(778,0)"><g transform="translate(397,0)"><rect stroke="none" width="2432" height="60" x="0" y="220"></rect><g transform="translate(60,558)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAINI-64" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAINI-69" x="511" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAINI-6D" x="819" y="0"></use><g transform="translate(1157,-107)"><use transform="scale(0.5)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMATHI-4E" x="0" y="0"></use><use transform="scale(0.5)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAIN-2212" x="888" y="0"></use><use transform="scale(0.5)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAIN-31" x="1667" y="0"></use></g></g><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAIN-32" x="1469" y="-542"></use></g></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>≠</mo><mfrac><msub><mrow class="MJX-TeXAtom-ORD"><mi class="MJX-tex-mathit" mathvariant="italic">d</mi><mi class="MJX-tex-mathit" mathvariant="italic">i</mi><mi class="MJX-tex-mathit" mathvariant="italic">m</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mi>N</mi><mo>−</mo><mn>1</mn></mrow></msub><mn>2</mn></mfrac></math></span></span><script type="math/tex" id="MathJax-Element-8">\neq \frac{\mathit{dim}_{N-1}}{2}</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dies bedeutet, dass wir jetzt keine eindeutige 2-zu-1-Zuordnung von Texeln der Ebene N-1 zu Texeln der Ebene N haben. Nun wird die Größe der Texturkoordinate jedes Texels der Ebene N der Größe von </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Texeln der Ebene N-1 </font><font style="vertical-align: inherit;">überlagert </font><font style="vertical-align: inherit;">.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/48d/9d6/6e1/48d9d66e16424a3781e695a3340d2cb4.svg"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ein Beispiel für eine ungerade Levelgröße: 7 Texel dieses Levels werden auf dem nächsten Level auf 3 Texel reduziert. </font><font style="vertical-align: inherit;">Die Dimensionen der Texturkoordinaten der drei übergeordneten Texel werden den Größen der drei Texel aus der unteren Ebene überlagert. </font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Daher</font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-9-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>D</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>N</mi></mrow></msub><mo stretchy=&quot;false&quot;>[</mo><mi>i</mi><mo stretchy=&quot;false&quot;>]</mo><mo>=</mo><mtext>min</mtext><mo stretchy=&quot;false&quot;>(</mo><msub><mi>D</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>N</mi><mo>&amp;#x2212;</mo><mn>1</mn></mrow></msub><mo stretchy=&quot;false&quot;>[</mo><mn>2</mn><mi>i</mi><mo stretchy=&quot;false&quot;>]</mo><mo>,</mo><msub><mi>D</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>N</mi><mo>&amp;#x2212;</mo><mn>1</mn></mrow></msub><mo stretchy=&quot;false&quot;>[</mo><mn>2</mn><mi>i</mi><mo>+</mo><mn>1</mn><mo stretchy=&quot;false&quot;>]</mo><mo>,</mo><msub><mi>D</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>N</mi><mo>&amp;#x2212;</mo><mn>1</mn></mrow></msub><mo stretchy=&quot;false&quot;>[</mo><mn>2</mn><mi>i</mi><mo>+</mo><mn>2</mn><mo stretchy=&quot;false&quot;>]</mo><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="51.493ex" height="2.634ex" viewBox="0 -809.3 22170.5 1134.2" role="img" focusable="false" style="vertical-align: -0.755ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMATHI-44" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMATHI-4E" x="1171" y="-213"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAIN-5B" x="1556" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMATHI-69" x="1835" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAIN-5D" x="2180" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAIN-3D" x="2737" y="0"></use><g transform="translate(3793,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAIN-6D"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAIN-69" x="833" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAIN-6E" x="1112" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAIN-28" x="5461" y="0"></use><g transform="translate(5851,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMATHI-44" x="0" y="0"></use><g transform="translate(828,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMATHI-4E" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAIN-2212" x="888" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAIN-31" x="1667" y="0"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAIN-5B" x="8312" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAIN-32" x="8590" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMATHI-69" x="9091" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAIN-5D" x="9436" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAIN-2C" x="9715" y="0"></use><g transform="translate(10160,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMATHI-44" x="0" y="0"></use><g transform="translate(828,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMATHI-4E" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAIN-2212" x="888" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAIN-31" x="1667" y="0"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAIN-5B" x="12621" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAIN-32" x="12900" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMATHI-69" x="13400" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAIN-2B" x="13968" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAIN-31" x="14969" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAIN-5D" x="15469" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAIN-2C" x="15748" y="0"></use><g transform="translate(16193,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMATHI-44" x="0" y="0"></use><g transform="translate(828,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMATHI-4E" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAIN-2212" x="888" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAIN-31" x="1667" y="0"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAIN-5B" x="18654" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAIN-32" x="18933" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMATHI-69" x="19433" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAIN-2B" x="20001" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAIN-32" x="21002" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAIN-5D" x="21502" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAIN-29" x="21781" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>D</mi><mrow class="MJX-TeXAtom-ORD"><mi>N</mi></mrow></msub><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo>=</mo><mtext>min</mtext><mo stretchy="false">(</mo><msub><mi>D</mi><mrow class="MJX-TeXAtom-ORD"><mi>N</mi><mo>−</mo><mn>1</mn></mrow></msub><mo stretchy="false">[</mo><mn>2</mn><mi>i</mi><mo stretchy="false">]</mo><mo>,</mo><msub><mi>D</mi><mrow class="MJX-TeXAtom-ORD"><mi>N</mi><mo>−</mo><mn>1</mn></mrow></msub><mo stretchy="false">[</mo><mn>2</mn><mi>i</mi><mo>+</mo><mn>1</mn><mo stretchy="false">]</mo><mo>,</mo><msub><mi>D</mi><mrow class="MJX-TeXAtom-ORD"><mi>N</mi><mo>−</mo><mn>1</mn></mrow></msub><mo stretchy="false">[</mo><mn>2</mn><mi>i</mi><mo>+</mo><mn>2</mn><mo stretchy="false">]</mo><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-9">D_{N}[i] = \text{min}(D_{N-1}[2i], D_{N-1}[2i + 1], D_{N-1}[2i + 2])</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Dies bedeutet, dass ein Texel auf der Ebene von N-1 manchmal den </font></font><code>min</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">für </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Texel auf der Ebene von N </font><font style="vertical-align: inherit;">berechneten </font><font style="vertical-align: inherit;">Wert beeinflusst </font><font style="vertical-align: inherit;">. Dies ist erforderlich, um den oben beschriebenen Vergleich aufrechtzuerhalten. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die obige Beschreibung wurde der Einfachheit halber nur in einer Dimension dargestellt. </font><font style="vertical-align: inherit;">Wenn in zwei Dimensionen beide Dimensionen der N-1-Ebene gerade sind, wird der 2x2-Texelbereich auf der N-1-Ebene auf ein Texel auf der N-Ebene abgebildet. Wenn eine der Dimensionen ungerade ist, wird der 2x3- oder 3x2-Bereich auf der N-1-Ebene auf einen abgebildet Texel auf Ebene N. Wenn </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">beide</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Dimensionen </font><font style="vertical-align: inherit;">ungerade sind </font><font style="vertical-align: inherit;">, sollte auch das "eckige" Texel berücksichtigt werden, dh der 3x3-Bereich auf Ebene N-1 wird mit einem Texel auf Ebene N verglichen.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Codebeispiel</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der unten gezeigte GLSL-Shader-Code implementiert den von uns beschriebenen Algorithmus. </font><font style="vertical-align: inherit;">Es muss für jeden nachfolgenden Mip ab Stufe 1 ausgeführt werden (Stufe 0 ist die volle Auflösungsstufe).</font></font><br>
<br>
<pre><code class="cpp hljs">uniform sampler2D u_depthBuffer;<font></font>
uniform <span class="hljs-keyword">int</span> u_previousLevel;<font></font>
uniform ivec2 u_previousLevelDimensions;<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{<font></font>
	ivec2 thisLevelTexelCoord = ivec2(gl_FragCoord);<font></font>
	ivec2 previousLevelBaseTexelCoord = <span class="hljs-number">2</span> * thisLevelTexelCoord;<font></font>
<font></font>
	vec4 depthTexelValues;<font></font>
	depthTexelValues.x = texelFetch(u_depthBuffer,<font></font>
                                    previousLevelBaseTexelCoord,<font></font>
                                    u_previousLevel).r;<font></font>
	depthTexelValues.y = texelFetch(u_depthBuffer,<font></font>
                                    previousLevelBaseTexelCoord + ivec2(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>),<font></font>
                                    u_previousLevel).r;<font></font>
	depthTexelValues.z = texelFetch(u_depthBuffer,<font></font>
                                    previousLevelBaseTexelCoord + ivec2(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>),<font></font>
                                    u_previousLevel).r;<font></font>
	depthTexelValues.w = texelFetch(u_depthBuffer,<font></font>
                                    previousLevelBaseTexelCoord + ivec2(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>),<font></font>
                                    u_previousLevel).r;<font></font>
<font></font>
	<span class="hljs-keyword">float</span> minDepth = min(min(depthTexelValues.x, depthTexelValues.y),<font></font>
                         min(depthTexelValues.z, depthTexelValues.w));<font></font>
<font></font>
    <span class="hljs-comment">// Incorporate additional texels if the previous level's width or height (or both) </span>
    <span class="hljs-comment">// are odd. </span>
	<span class="hljs-keyword">bool</span> shouldIncludeExtraColumnFromPreviousLevel = ((u_previousLevelDimensions.x &amp; <span class="hljs-number">1</span>) != <span class="hljs-number">0</span>);
	<span class="hljs-keyword">bool</span> shouldIncludeExtraRowFromPreviousLevel = ((u_previousLevelDimensions.y &amp; <span class="hljs-number">1</span>) != <span class="hljs-number">0</span>);
	<span class="hljs-keyword">if</span> (shouldIncludeExtraColumnFromPreviousLevel) {<font></font>
		vec2 extraColumnTexelValues;<font></font>
		extraColumnTexelValues.x = texelFetch(u_depthBuffer,<font></font>
                                              previousLevelBaseTexelCoord + ivec2(<span class="hljs-number">2</span>, <span class="hljs-number">0</span>),<font></font>
                                              u_previousLevel).r;<font></font>
		extraColumnTexelValues.y = texelFetch(u_depthBuffer,<font></font>
                                              previousLevelBaseTexelCoord + ivec2(<span class="hljs-number">2</span>, <span class="hljs-number">1</span>),<font></font>
                                              u_previousLevel).r;<font></font>
<font></font>
		<span class="hljs-comment">// In the case where the width and height are both odd, need to include the </span>
        <span class="hljs-comment">// 'corner' value as well. </span>
		<span class="hljs-keyword">if</span> (shouldIncludeExtraRowFromPreviousLevel) {
			<span class="hljs-keyword">float</span> cornerTexelValue = texelFetch(u_depthBuffer,<font></font>
                                                previousLevelBaseTexelCoord + ivec2(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>),<font></font>
                                                u_previousLevel).r;<font></font>
			minDepth = min(minDepth, cornerTexelValue);<font></font>
		}<font></font>
		minDepth = min(minDepth, min(extraColumnTexelValues.x, extraColumnTexelValues.y));<font></font>
	}<font></font>
	<span class="hljs-keyword">if</span> (shouldIncludeExtraRowFromPreviousLevel) {<font></font>
		vec2 extraRowTexelValues;<font></font>
		extraRowTexelValues.x = texelFetch(u_depthBuffer,<font></font>
                                           previousLevelBaseTexelCoord + ivec2(<span class="hljs-number">0</span>, <span class="hljs-number">2</span>),<font></font>
                                           u_previousLevel).r;<font></font>
		extraRowTexelValues.y = texelFetch(u_depthBuffer,<font></font>
                                           previousLevelBaseTexelCoord + ivec2(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>),<font></font>
                                           u_previousLevel).r;<font></font>
		minDepth = min(minDepth, min(extraRowTexelValues.x, extraRowTexelValues.y));<font></font>
	}<font></font>
<font></font>
	gl_FragDepth = minDepth;<font></font>
}</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fehler in diesem Code</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Erstens können Aufrufindizes bei Tiefenpuffern mit voller Auflösung, bei denen eine Dimension mehr als doppelt so groß ist wie eine andere Dimension, </font></font><code>texelFetch</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">darüber hinausgehen </font></font><code>u_depthBuffer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. (In solchen Fällen wird die kleinere Dimension zu 1 vor der anderen.) Ich wollte in diesem Beispiel </font></font><code>texelFetch</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(unter Verwendung von Ganzzahlkoordinaten) verwenden, damit das Geschehen so klar wie möglich war und nicht persönlich auf solche Puffer mit besonders großer / hoher Tiefe stieß. Wenn Sie auf solche Probleme stoßen, können Sie </font></font><code>clamp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">die übertragenen </font></font><code>texelFetch</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Koordinaten </font><font style="vertical-align: inherit;">begrenzen ( </font><font style="vertical-align: inherit;">) </font><font style="vertical-align: inherit;">oder die </font></font><code>texture</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">normalisierten Koordinaten der Textur verwenden (legen Sie im Sampler eine Grenze für die Kante fest). Bei der Berechnung </font></font><code>min</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">oder </font></font><code>max</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sollte immer ein Texel mehrmals für das Vorhandensein von Grenzfällen berücksichtigt werden.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zweitens </font><font style="vertical-align: inherit;">erschwert dies die Sache </font><font style="vertical-align: inherit;">, obwohl die ersten vier Anrufe </font></font><code>texelFetch</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">durch einen ersetzt werden können </font></font><code>textureGather</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(da der </font></font><code>textureGather</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mip-Pegel nicht angegeben werden kann). </font><font style="vertical-align: inherit;">Außerdem habe ich bei der Verwendung keine Geschwindigkeitssteigerung festgestellt </font></font><code>textureGather</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Performance</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich habe den obigen Fragment-Shader verwendet, um zwei vollständige Mip-Ketten für zwei Tiefenpuffer (einen für jedes Auge) in meiner VR-Engine zu generieren. </font><font style="vertical-align: inherit;">Im Test betrug die Auflösung für jedes Auge 1648 x 1776, was zur Schaffung von 10 zusätzlichen reduzierten Mip-Levels führte (was 10 Durchgänge bedeutet). </font><font style="vertical-align: inherit;">Bei der NVIDIA GTX 980 dauerte es 0,25 ms und bei der AMD R9 290 0,30 ms, um eine vollständige Kette für beide Augen zu erzeugen.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/805/461/815/8054618153533c29d1de1000fcee2878.jpg"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a8f/2b6/950/a8f2b6950b278655f3deff3ca456874c.png"></div><br>
<i>Mip- 4, 5  6,    ,     . ( ,     ,  ,     .) Mip- 4 — ,    (103x111)     2.</i><br>
<br>
<h2>   mip-</h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Aufgabe des oben beschriebenen Algorithmus besteht darin, die Genauigkeit von Tiefenabfragen im Texturkoordinatenraum (NDC) aufrechtzuerhalten. Der Vollständigkeit halber (und weil ich diese Garantie in der Technik unter 2 abgelehnt habe) möchte ich eine weitere Methode demonstrieren, auf die ich gestoßen bin (zum Beispiel in </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">diesem Artikel</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beachten Sie, dass diese alternative Methode wie die vorherige für Puffer mit voller Auflösung ausgelegt ist, deren Größe keine Zweierpotenzen ist (aber natürlich mit Größen, die Zweierpotenzen entsprechen).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn bei dieser alternativen Methode eine Ebene mit einer ungeraden Breite (oder Höhe) heruntergerechnet wird, anstatt für jedes Ausgabetext eine zusätzliche Spalte (oder Zeile) von Texeln aus der vorherigen (unteren) Ebene hinzuzufügen, führen wir diese Operation nur für Ausgabetexel mit maximalen Indizes („extreme“ Texel) aus ) Das einzige, was sich im oben dargestellten Fragment-Shader ändert, ist das Festlegen von Werten </font></font><code>shouldIncludeExtraColumnFromPreviousLevel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und </font></font><code>shouldIncludeExtraRowFromPreviousLevel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">// If the previous level's width is odd and this is the highest-indexed "edge" texel for </span>
<span class="hljs-comment">// this level, incorporate the rightmost edge texels from the previous level. The same goes </span>
<span class="hljs-comment">// for the height. </span>
<span class="hljs-keyword">bool</span> shouldIncludeExtraColumnFromPreviousLevel =<font></font>
    (previousMipLevelBaseTexelCoords.x == u_previousLevelDimensions.x - <span class="hljs-number">3</span>);
<span class="hljs-keyword">bool</span> shouldIncludeExtraRowFromPreviousLevel =<font></font>
    (previousMipLevelBaseTexelCoords.y == u_previousLevelDimensions.y - <span class="hljs-number">3</span>);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aus diesem Grund werden die extremen Texel mit dem höchsten Index sehr "dick", da jede Division durch zwei ungerade Dimensionen dazu führt, dass sie ein proportional größeres Intervall des normalisierten Texturkoordinatenraums einnehmen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Nachteil dieses Ansatzes besteht darin, dass es schwieriger wird, Tiefenabfragen mit hohen Mip-Pegeln durchzuführen. </font><font style="vertical-align: inherit;">Anstatt nur die normalisierten Texturkoordinaten zu verwenden, müssen wir zuerst das diesen Koordinaten entsprechende Texel mit voller Auflösung bestimmen und dann die Koordinaten dieses Texels auf die Koordinaten der entsprechenden Mip-Ebene übertragen, deren Anforderung ausgeführt wird. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das folgende Codefragment migriert aus dem NDC-Bereich</font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-10-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>[</mo><mo>&amp;#x2212;</mo><mn>1</mn><mo>,</mo><mn>1</mn><msup><mo stretchy=&quot;false&quot;>]</mo><mn>2</mn></msup></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="7.515ex" height="2.884ex" viewBox="0 -916.9 3235.6 1241.8" role="img" focusable="false" style="vertical-align: -0.755ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAIN-5B" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAIN-2212" x="278" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAIN-31" x="1057" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAIN-2C" x="1557" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAIN-31" x="2002" y="0"></use><g transform="translate(2503,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAIN-5D" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAIN-32" x="393" y="513"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">[</mo><mo>−</mo><mn>1</mn><mo>,</mo><mn>1</mn><msup><mo stretchy="false">]</mo><mn>2</mn></msup></math></span></span><script type="math/tex" id="MathJax-Element-10">[-1, 1]^2</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zu texel Koordinaten auf Mip-Ebene </font></font><code>higherMipLevel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="cpp hljs">vec2 windowCoords = (<span class="hljs-number">0.5</span> * ndc.xy + vec2(<span class="hljs-number">0.5</span>)) * textureSize(u_depthBuffer, <span class="hljs-number">0</span>);
<span class="hljs-comment">// Account for texel centers being halfway between integers. </span>
ivec2 texelCoords = ivec2(round(windowCoords.xy - vec2(<span class="hljs-number">0.5</span>)));<font></font>
ivec2 higherMipLevelTexelCoords =<font></font>
    min(texelCoords / (<span class="hljs-number">1</span> &lt;&lt; higherMipLevel),<font></font>
        textureSize(u_depthBuffer, higherMipLevel).xy - ivec2(<span class="hljs-number">1</span>));</code></pre><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Technik 2: Generieren eines einzelnen Hi-Z-Levels mit einem Computing-Shader</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Generieren einer vollständigen Mip-Kette ist ziemlich schnell, aber es hat mich ein wenig gestört, dass meine Anwendung alle diese Ebenen generiert und nur eine davon verwendet (Ebene 4). </font><font style="vertical-align: inherit;">Zusätzlich zur Beseitigung dieser leichten Ineffizienz wollte ich auch sehen, um wie viel alles beschleunigt werden könnte, wenn ich nur einen Compute-Shader-Aufruf verwenden würde, um das benötigte Level zu generieren. </font><font style="vertical-align: inherit;">(Es ist erwähnenswert, dass meine Anwendung bei Verwendung einer Lösung mit einem Fragment-Shader mit mehreren Durchgängen auf Stufe 4 anhalten kann. Daher habe ich sie am Ende dieses Abschnitts als Grundlage für den Vergleich der Laufzeiten verwendet.)</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In den meisten Hi-Z-Anwendungen ist nur eine Tiefenstufe erforderlich, daher finde ich diese Situation häufig. Ich habe einen Computational Shader für meine eigenen spezifischen Anforderungen geschrieben (Generieren von Level 4 mit einer Auflösung von 1/16 x 1/16 gegenüber dem Original). Ähnlicher Code kann verwendet werden, um verschiedene Ebenen zu generieren. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Computational Shader ist für diese Aufgabe gut geeignet, da er gemeinsam genutzten Arbeitsgruppenspeicher zum Datenaustausch zwischen Threads verwenden kann. Jede Arbeitsgruppe ist für ein Ausgabe-Texel verantwortlich (reduziert durch Downsampling des Puffers), und die Threads der Arbeitsgruppe teilen sich die Arbeit der Berechnung der </font></font><code>min</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">entsprechenden Texel mit voller Auflösung und teilen die Ergebnisse über den gemeinsamen Speicher.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich habe zwei Hauptlösungen ausprobiert, die auf Computer-Shadern basieren. Im ersten Schritt forderte jeder Thread </font></font><code>atomicMin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">eine gemeinsam genutzte Speichervariable an. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bitte beachten Sie, dass </font></font><code>float</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hier einige Tricks erforderlich </font><font style="vertical-align: inherit;">sind, da Programmierer (ohne Erweiterungen für die Hardware eines bestimmten Herstellers) keine atomaren Operationen mit nicht ganzzahligen Werten ausführen können (und meine Tiefen als gespeichert werden </font><font style="vertical-align: inherit;">). Da nicht negative Gleitkommawerte des IEEE 754-Standards ihre Reihenfolge beibehalten, wenn ihre Bits als vorzeichenlose ganzzahlige Werte verarbeitet werden, können wir </font></font><code>floatBitsToUint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">die Tiefenwerte </font></font><code>float</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">auf </font><font style="vertical-align: inherit;">(unter Verwendung einer Neuinterpretation der Umwandlung) bringen </font></font><code>uint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und dann aufrufen </font></font><code>atomicMin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(um dann </font></font><code>uintBitsToFloat</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">den fertigen Mindestwert </font><font style="vertical-align: inherit;">auszuführen </font></font><code>uint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). .</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die naheliegendste Lösung </font></font><code>atomicMin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wäre, 16x16-Thread-Gruppen zu erstellen, in denen jeder Thread ein Texel empfängt und es dann </font></font><code>atomicMin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mit einem Wert im gemeinsam genutzten Speicher </font><font style="vertical-align: inherit;">ausführt </font><font style="vertical-align: inherit;">. Ich habe diesen Ansatz mit kleineren Stream-Blöcken (8x8, 4x8, 4x4, 2x4, 2x2) verglichen, bei denen jeder Stream eine Texelregion empfängt und sein eigenes lokales Minimum berechnet und dann aufruft </font></font><code>atomicMin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die schnellste aller dieser getesteten Lösungen mit</font></font><code>atomicMin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sowohl NVIDIA als auch AMD hatten eine Lösung mit 4x4-Stream-Blöcken (in denen jeder Stream selbst einen 4x4-Texel-Bereich erhält). </font><font style="vertical-align: inherit;">Ich verstehe nicht ganz, warum sich diese Option als die schnellste herausstellte, aber vielleicht spiegelt sie einen Kompromiss zwischen der Konkurrenz atomarer Operationen und Berechnungen in unabhängigen Flüssen wider. </font><font style="vertical-align: inherit;">Es ist auch erwähnenswert, dass die Größe der 4x4-Arbeitsgruppe nur 16 Threads pro Warp / Welle verwendet (und es ist auch möglich, 32 oder 64 zu verwenden), was interessant ist. </font><font style="vertical-align: inherit;">Das folgende Beispiel implementiert diesen Ansatz. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Als Alternative zur Verwendung habe </font></font><code>atomicMin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ich versucht, eine parallele Reduktion mithilfe der in </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">dieser aktiv zitierten NVIDIA-Präsentation</font></a><font style="vertical-align: inherit;"> verwendeten Techniken durchzuführen</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">(Die Grundidee besteht darin, ein gemeinsam genutztes Speicherarray mit der gleichen Größe wie die Anzahl der Threads in der Arbeitsgruppe zu verwenden</font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-11-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>log</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mn>2</mn></mrow></msub><mo>&amp;#x2061;</mo><mo stretchy=&quot;false&quot;>(</mo><mi>n</mi><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="7.23ex" height="2.634ex" viewBox="0 -809.3 3112.9 1134.2" role="img" focusable="false" style="vertical-align: -0.755ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAIN-6C"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAIN-6F" x="278" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAIN-67" x="779" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAIN-32" x="1809" y="-343"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAIN-28" x="1733" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMATHI-6E" x="2122" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhgtrv4cOuDq5KQ4mus2cDFCMklBGg#MJMAIN-29" x="2723" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>log</mi><mrow class="MJX-TeXAtom-ORD"><mn>2</mn></mrow></msub><mo>⁡</mo><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-11">\log_{2} (n)</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Durchgänge für die sequentielle gemeinsame Berechnung der </font></font><code>min</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Minima jedes Stroms, bis das endgültige Minimum der gesamten Arbeitsgruppe erreicht ist.) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich habe diese Lösung mit allen gleichen Größen von Arbeitsgruppen wie in Lösung c ausprobiert </font></font><code>atomicMin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Trotz aller in der NVIDIA-Präsentation beschriebenen Optimierungen ist die Lösung zur parallelen Reduzierung etwas langsamer (innerhalb von zehn GPUs auf beiden GPUs) als die Lösung, zu der </font></font><code>atomicMin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ich gekommen bin. </font><font style="vertical-align: inherit;">Darüber hinaus ist die Lösung mit </font></font><code>atomicMin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in Bezug auf Code viel einfacher.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Codebeispiel</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bei dieser Methode ist es am einfachsten, nicht zu versuchen, die Konsistenz im normalisierten Texturkoordinatenraum zwischen Texeln mit reduzierten Puffern und voller Auflösung aufrechtzuerhalten. </font><font style="vertical-align: inherit;">Sie können einfach Konvertierungen von Texelkoordinaten mit voller Auflösung in Texelkoordinaten mit reduzierter Auflösung durchführen:</font></font><br>
<br>
<pre><code class="cpp hljs">ivec2 reducedResTexelCoords = texelCoords / ivec2(downscalingFactor);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In meinem Fall (das Äquivalent von Mip-Level 4 </font></font><code>downscalingFactor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wird </font><font style="vertical-align: inherit;">generiert) </font><font style="vertical-align: inherit;">ist 16. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie oben erwähnt, implementiert dieser GLSL-Computational-Shader eine Lösung mit </font></font><code>atomicMin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4x4-Arbeitsgruppengröße, bei der jeder Thread einen 4x4-Texelbereich aus dem Puffer mit voller Auflösung empfängt. </font><font style="vertical-align: inherit;">Der resultierende Tiefenpuffer mit reduzierter Tiefe </font></font><code>min</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">beträgt 1/16 x 1/16 der Puffergröße mit voller Auflösung (aufgerundet, wenn die Größen mit voller Auflösung nicht vollständig durch 16 teilbar sind).</font></font><br>
<br>
<pre><code class="cpp hljs">uniform sampler2D u_inputDepthBuffer;<font></font>
uniform <span class="hljs-keyword">restrict</span> writeonly image2DArray u_outputDownsampledMinDepthBufferImage;
<span class="hljs-comment">// The dimension in normalized texture coordinate space of a single texel in </span>
<span class="hljs-comment">// u_inputDepthBuffer. </span><font></font>
uniform vec2 u_texelDimensions;<font></font>
<font></font>
<span class="hljs-comment">// Resulting image is 1/16th x 1/16th resolution, but we fetch 4x4 texels per thread, hence </span>
<span class="hljs-comment">// the divisions by 4 here. </span>
layout(local_size_x = <span class="hljs-number">16</span>/<span class="hljs-number">4</span>, local_size_y = <span class="hljs-number">16</span>/<span class="hljs-number">4</span>, local_size_z = <span class="hljs-number">1</span>) in;<font></font>
<font></font>
<span class="hljs-comment">// This is stored as uint because atomicMin only works on integer types. Luckily </span>
<span class="hljs-comment">// (non-negative) floats maintain their order when their bits are interpreted as uint (using </span>
<span class="hljs-comment">// floatBitsToUint). </span><font></font>
shared uint s_workgroupMinDepthEncodedAsUint;<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
	<span class="hljs-keyword">if</span> (gl_LocalInvocationIndex == <span class="hljs-number">0</span>) {
        <span class="hljs-comment">// Initialize to 1.0 (max depth) before performing atomicMin's. </span>
		s_workgroupMinDepthEncodedAsUint = floatBitsToUint(<span class="hljs-number">1.0</span>);<font></font>
	}<font></font>
<font></font>
	memoryBarrierShared();<font></font>
	barrier();<font></font>
<font></font>
	<span class="hljs-comment">// Fetch a 4x4 texel region per thread with 4 calls to textureGather. 'gatherCoords' </span>
    <span class="hljs-comment">// are set up to be equidistant from the centers of the 4 texels being gathered (which </span>
    <span class="hljs-comment">// puts them on integer values). In my tests textureGather was not faster than </span>
    <span class="hljs-comment">// individually fetching each texel - I use it here only for conciseness. </span>
    <span class="hljs-comment">// </span>
    <span class="hljs-comment">// Note that in the case of the full-res depth buffer's dimensions not being evenly </span>
    <span class="hljs-comment">// divisible by the downscaling factor (16), these textureGather's may try to fetch </span>
    <span class="hljs-comment">// out-of-bounds coordinates - that's fine as long as the texture sampler is set to </span>
    <span class="hljs-comment">// clamp-to-edge, as redundant values don't affect the resulting min. </span><font></font>
<font></font>
	uvec2 baseTexelCoords = <span class="hljs-number">4</span> * gl_GlobalInvocationID.xy;<font></font>
	vec2 gatherCoords1 = (baseTexelCoords + uvec2(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>)) * u_texelDimensions;<font></font>
	vec2 gatherCoords2 = (baseTexelCoords + uvec2(<span class="hljs-number">3</span>, <span class="hljs-number">1</span>)) * u_texelDimensions;<font></font>
	vec2 gatherCoords3 = (baseTexelCoords + uvec2(<span class="hljs-number">1</span>, <span class="hljs-number">3</span>)) * u_texelDimensions;<font></font>
	vec2 gatherCoords4 = (baseTexelCoords + uvec2(<span class="hljs-number">3</span>, <span class="hljs-number">3</span>)) * u_texelDimensions;<font></font>
<font></font>
	vec4 gatheredTexelValues1 = textureGather(u_inputDepthBuffer, gatherCoords1);<font></font>
	vec4 gatheredTexelValues2 = textureGather(u_inputDepthBuffer, gatherCoords2);<font></font>
	vec4 gatheredTexelValues3 = textureGather(u_inputDepthBuffer, gatherCoords3);<font></font>
	vec4 gatheredTexelValues4 = textureGather(u_inputDepthBuffer, gatherCoords4);<font></font>
<font></font>
	<span class="hljs-comment">// Now find the min across the 4x4 region fetched, and apply that to the workgroup min </span>
    <span class="hljs-comment">// using atomicMin. </span><font></font>
	vec4 gatheredTexelMins = min(min(gatheredTexelValues1, gatheredTexelValues2),<font></font>
                                 min(gatheredTexelValues3, gatheredTexelValues4));<font></font>
	<span class="hljs-keyword">float</span> finalMin = min(min(gatheredTexelMins.x, gatheredTexelMins.y),<font></font>
                         min(gatheredTexelMins.z, gatheredTexelMins.w));<font></font>
	atomicMin(s_workgroupMinDepthEncodedAsUint, floatBitsToUint(finalMin));<font></font>
<font></font>
	memoryBarrierShared();<font></font>
	barrier();<font></font>
<font></font>
    <span class="hljs-comment">// Thread 0 writes workgroup-wide min to image. </span>
	<span class="hljs-keyword">if</span> (gl_LocalInvocationIndex == <span class="hljs-number">0</span>) {
		<span class="hljs-keyword">float</span> workgroupMinDepth = uintBitsToFloat(s_workgroupMinDepthEncodedAsUint);<font></font>
<font></font>
		imageStore(u_outputDownsampledMinDepthBufferImage,<font></font>
		           ivec2(gl_WorkGroupID.xy),<font></font>
                   <span class="hljs-comment">// imageStore can only be passed vec4, but only a float is stored. </span><font></font>
				   vec4(workgroupMinDepth));<font></font>
	}<font></font>
}</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Performance</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich habe den obigen Berechnungs-Shader verwendet, um den Tiefenpuffer mit voller Auflösung mit denselben Abmessungen zu verarbeiten, die zum Generieren der vollständigen Mip-Kette verwendet wurden (1648 x 1776 Puffer für jedes Auge). </font><font style="vertical-align: inherit;">Es läuft in 0,12 ms auf der NVIDIA GTX 980 und 0,08 ms auf der AMD R9 290. Wenn wir mit der Generierungszeit von nur 1–4 Mip-Pegeln (0,22 ms auf NVIDIA, 0,25 ms AMD) vergleichen, dann die Lösung mit einem rechnerischen Shader stellte sich heraus , </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">87% schneller mit NVIDIA - </font><font style="vertical-align: inherit;">GPUs zu sein</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">197% schneller als AMD - </font><font style="vertical-align: inherit;">GPUs</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In absoluten Zahlen ist die Beschleunigung nicht so groß, aber alle 0,1 ms ist wichtig, besonders in VR :)</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de494364/index.html">DSGVO: Zustimmung zur Verarbeitung personenbezogener Daten</a></li>
<li><a href="../de494366/index.html">Online-Mitaps für die ganze Woche ab dem 27. März (für Back, Mobile, QA, PM und alle)</a></li>
<li><a href="../de494370/index.html">Saubere Architektur mit den Augen eines Python-Entwicklers</a></li>
<li><a href="../de494372/index.html">Allrussische Verifizierungssoftware - Eine Innenansicht</a></li>
<li><a href="../de494374/index.html">Elektrobusse und ihre Batterien: Was ist Lithiumtitanat? (Teil 1)</a></li>
<li><a href="../de494380/index.html">Einführung in das strategische Produktmanagement</a></li>
<li><a href="../de494384/index.html">Funktionserhebung</a></li>
<li><a href="../de494390/index.html">Durch den 3D-Druck konnten die Kosten für die automatische Optimierung halbiert werden</a></li>
<li><a href="../de494398/index.html">Playstation Doom Polygone</a></li>
<li><a href="../de494400/index.html">Coronavirus und das Internet</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>