<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèº‚Äç‚öïÔ∏è üèÖ üë®üèæ Una mirada al interior de la fiabilidad de los servicios de Facebook üë®‚Äçüè´ üíè üßö</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Cuando Facebook "miente", la gente piensa que se debe a piratas inform√°ticos o ataques DDoS, pero no es as√≠. Todas las "ca√≠das" en los √∫ltimos a√±os ha...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Una mirada al interior de la fiabilidad de los servicios de Facebook</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/oleg-bunin/blog/489204/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cuando Facebook "miente", la gente piensa que se debe a piratas inform√°ticos o ataques DDoS, pero no es as√≠. Todas las "ca√≠das" en los √∫ltimos a√±os han sido causadas por cambios internos o fallas. Para ense√±ar a los nuevos empleados a no romper Facebook con ejemplos, todos los incidentes importantes tienen nombres, por ejemplo, "Call the Cops" o "CAPSLOCK". El primero fue nombrado porque cuando un d√≠a la red social cay√≥, los usuarios llamaron a la polic√≠a de Los √Ångeles y pidieron que lo arreglaran, y el sheriff desesperado en Twitter pidi√≥ no molestarlos por esto. Durante el segundo incidente en las m√°quinas de cach√©, la interfaz de red se cay√≥ y no aument√≥, y todas las m√°quinas se reiniciaron a mano. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Elina Lobanova</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ha estado trabajando en Facebook durante los √∫ltimos 4 a√±os en el equipo de Web Foundation. Los miembros del equipo se llaman ingenieros de producci√≥n y monitorean la confiabilidad y el rendimiento de todo el backend, apagan Facebook cuando est√° encendido, escriben monitoreo y automatizaci√≥n para facilitarles la vida a ellos mismos y a los dem√°s. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/jf/9x/nj/jf9xnjbzmqg3ufk-km_bqmgkrya.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En un art√≠culo basado en el informe de Elina sobre </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HighLoad ++ 2019</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;">mostraremos</font></a><font style="vertical-align: inherit;"> c√≥mo los ingenieros de producci√≥n monitorean el backend de Facebook, qu√© herramientas usan, cu√°les son las principales fallas y c√≥mo lidiar con ellas.</font></font><br>
<a name="habracut"></a><br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/wuV5DLiUuaI" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mi nombre es Elina, hace casi 5 a√±os fui llamado a Facebook como desarrollador ordinario, donde encontr√© por primera vez sistemas muy cargados, esto no se ense√±a en los institutos. </font><font style="vertical-align: inherit;">La compa√±√≠a no contrata un equipo, sino una oficina, as√≠ que llegu√© a Londres, eleg√≠ un equipo que supervisa el trabajo de facebook.com y estaba entre los ingenieros de producci√≥n.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ingenieros de produccion</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para comenzar, te dir√© lo que estamos haciendo y por qu√© nos llaman ingenieros de producci√≥n, y no SRE como Google, por ejemplo.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2009. SRE</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El modelo est√°ndar que todav√≠a se usa en muchas empresas es "desarrolladores - probadores - operaci√≥n". </font><font style="vertical-align: inherit;">A menudo est√°n divididos: se sientan en diferentes pisos, a veces incluso en diferentes pa√≠ses, y no se comunican entre s√≠. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En 2009, Facebook ya ten√≠a SRE. </font><font style="vertical-align: inherit;">En Google, SRE comenz√≥ antes, saben c√≥mo lograr DevOps y lo han escrito en su libro " </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ingenier√≠a de confiabilidad del sitio</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ". </font></font><br>
<br>
<img src="https://habrastorage.org/webt/6h/o6/1l/6ho61luejwigg_bb6v_7441tlty.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En Facebook en 2009, no hab√≠a nada como esto. </font><font style="vertical-align: inherit;">Nos llamaron SRE, pero hicimos el mismo trabajo que Ops en el resto del mundo: trabajo manual, sin automatizaci√≥n, implementaci√≥n de todos los servicios con sus manos, monitoreo de alguna manera, llamada para todo, un conjunto de scripts de shell.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2010. SRO y AppOps</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todo esto no escalaba, porque la cantidad de usuarios en ese momento estaba creciendo 3 veces al a√±o, y la cantidad de servicios creci√≥ en consecuencia. </font><font style="vertical-align: inherit;">En 2010, la decisi√≥n decidida Ops se dividi√≥ en dos grupos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El primer grupo es </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SRO</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , donde "O" son "operaciones", dedicadas al desarrollo, la automatizaci√≥n y el monitoreo del sitio. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El segundo grupo es </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AppOps</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , se integraron en equipos, cada uno para grandes servicios. </font><font style="vertical-align: inherit;">AppOps ya est√° cerca de la idea de DevOps. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La separaci√≥n por un tiempo salv√≥ a todos.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2012. Ingenieros de producci√≥n</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En 2012, AppOps simplemente cambi√≥ el nombre de </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ingenieros de producci√≥n</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Adem√°s del nombre, nada ha cambiado, pero se ha vuelto m√°s c√≥modo. </font><font style="vertical-align: inherit;">Como llamas a un yate, navegar√°, y no quer√≠amos navegar como Ops. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Las SRO todav√≠a exist√≠an, Facebook estaba creciendo y monitorear todos los servicios a la vez era dif√≠cil. </font><font style="vertical-align: inherit;">A una persona que estaba en la llamada ni siquiera se le permit√≠a ir al ba√±o: le pidi√≥ a alguien que lo reemplazara, porque se estaba quemando constantemente.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2014. SRO de cierre</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En un momento, las autoridades transfirieron a todos a la llamada. </font><font style="vertical-align: inherit;">"Todos" significa que los desarrolladores tambi√©n: escriban su c√≥digo, ¬°aqu√≠ est√°n y respondan por este c√≥digo! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Los ingenieros de producci√≥n ya se han integrado en los equipos m√°s importantes para obtener ayuda, y el resto no tiene suerte. </font><font style="vertical-align: inherit;">Comenzamos con equipos grandes y en un par de a√±os transferimos a todos en Facebook a oncall. </font><font style="vertical-align: inherit;">Entre los desarrolladores hubo una gran emoci√≥n: alguien renunci√≥, alguien escribi√≥ publicaciones malas. </font><font style="vertical-align: inherit;">Pero todo se calm√≥, y en 2014 el SRO se cerr√≥ porque ya no eran necesarios. </font><font style="vertical-align: inherit;">Entonces vivimos hasta el d√≠a de hoy. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La palabra "SRE" en la empresa es notoria, pero parecemos SRE en Google. </font><font style="vertical-align: inherit;">Hay diferencias.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Siempre estamos </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">integrados en equipos. </font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No tenemos b√∫squeda SRE en general, como en Google, es para cada servicio de b√∫squeda por separado.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">estamos en los productos</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , solo en la infraestructura que el producto administra por s√≠ mismo.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Estamos en </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">llamada</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> junto con los desarrolladores.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tenemos un poco m√°s de experiencia en sistemas y redes, por lo que nos </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">enfocamos en monitorear</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y extinguir los servicios cuando se queman brillantemente. </font><font style="vertical-align: inherit;">Solucionamos los errores de antemano que podr√≠an provocar bloqueos e influir en la arquitectura de los nuevos servicios desde el principio, para que luego funcionen sin problemas en la producci√≥n.</font></font></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Supervisi√≥n</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es lo mas importante. </font><font style="vertical-align: inherit;">C√≥mo hacemos esto? </font><font style="vertical-align: inherit;">Como todos: sin magia negra, en su propio hogar. </font><font style="vertical-align: inherit;">Pero el diablo, como siempre, te contar√° sobre ellos en detalle.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ENCIMA</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comencemos desde abajo. Todos conocen TOP en Linux, y usamos ATOP, donde "A" es "avanzado": un monitor de rendimiento del sistema. El principal beneficio de ATOP es que almacena el historial: puede configurarlo para guardar instant√°neas en el disco. Nuestro ATOP se ejecuta en todas las m√°quinas cada 5 segundos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqu√≠ hay un servidor de ejemplo que ejecuta el backend PHP para facebook.com. Escribimos nuestra m√°quina virtual para ejecutar c√≥digo PHP, se llama </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HHVM</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (HipHop Virtual Machine). Seg√∫n las m√©tricas exportadas, encontramos que varias m√°quinas no procesaron casi una sola solicitud en un minuto. Veamos por qu√©, abra ATOP 30 segundos antes de que se cuelgue.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/p2/vt/wf/p2vtwfqsucdo-shyennmf64opy8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se puede ver que con los problemas del procesador, lo cargamos demasiado. </font><font style="vertical-align: inherit;">Tambi√©n hay problemas con la memoria, solo quedan 1.5 GB en la memoria cach√©, y despu√©s de 5 segundos solo 800 MB. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/dz/q-/_x/dzq-_x7xjizrcgynj3gdayuh8u0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despu√©s de otros 5 segundos, la CPU se libera, no se ejecuta nada. </font><font style="vertical-align: inherit;">ATOP dice mira el resultado final, escribimos en el disco, pero ¬øqu√©? </font><font style="vertical-align: inherit;">Resulta que estamos escribiendo swap. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/4z/-j/v1/4z-jv12mgthgjnezqlvbznu6ync.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬øQui√©n est√° haciendo esto? </font><font style="vertical-align: inherit;">Procesos que fueron tomados de la memoria de 0.5 GB y puestos en intercambio. </font><font style="vertical-align: inherit;">En su lugar, aparecieron dos procesos sospechosos de Python, que luego se pueden ver como una l√≠nea de comando.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/8y/ej/uk/8yejuk2y3eeswlw7astqbiaaste.jpeg"><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ATOP es hermoso, lo usamos constantemente.</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si no lo tiene, le recomiendo usarlo. </font><font style="vertical-align: inherit;">No tenga miedo por la unidad, ATOP solo consume 200-300 MB por d√≠a cada 5 segundos.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Malloc HTTP</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A las Bahamas y los grandes incidentes, les damos nombres. Hay un error divertido relacionado con ATOP llamado Malloc HTTP. Lo presentamos con ATOP y strace. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Usamos Thrift en todas partes como un RPC. En las primeras versiones de su analizador hab√≠a un error sorprendente que funcionaba as√≠: lleg√≥ un mensaje en el que los primeros 4 bytes son del tama√±o de los datos, luego los datos en s√≠, y los primeros bytes se agregan al siguiente mensaje. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pero una vez que uno de los programas en lugar de ir al servicio Thrift, fui a HTTP, y recibi√≥ una respuesta ¬´HTTP Malo la Solicitud¬ª: </font></font><code>HTTP/1.1 400</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despu√©s tom√≥ HTTP y asign√≥ usando malloc HTTP el n√∫mero de bytes.</font></font><br>
<br>
<pre><code class="bash hljs">Thrift message<font></font>
HTTP/1.1 400<font></font>
<span class="hljs-string">"HTTP"</span> == 0x48545450</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Est√° bien, tenemos un compromiso excesivo, ¬°asignemos m√°s memoria! </font><font style="vertical-align: inherit;">Lo asignamos con malloc, y hasta que escribamos y leamos all√≠, no nos dar√°n memoria real. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬°Pero no estaba all√≠! </font><font style="vertical-align: inherit;">Si queremos bifurcar, la bifurcaci√≥n devolver√° un error: no hay suficiente memoria.</font></font><br>
<br>
<pre><code class="bash hljs">malloc(<span class="hljs-string">"HTTP"</span>)<font></font>
pid = fork(); // errno = ENOMEM</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pero, ¬øpor qu√© hay un recuerdo? </font><font style="vertical-align: inherit;">Al comprender los manuales, descubrimos que todo es muy simple: la configuraci√≥n actual de sobrecompromiso es tal que es una heur√≠stica m√°gica, y el n√∫cleo en s√≠ mismo decide cu√°ndo y cu√°ndo no:</font></font><br>
<br>
<pre><code class="bash hljs">malloc(<span class="hljs-string">"HTTP"</span>)<font></font>
pid = fork(); // errno = ENOMEM<font></font>
<font></font>
// 0: heuristic overcommit<font></font>
vm.overcommit_memory = 0</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para un proceso de trabajo, esto es normal, puede seleccionar malloc hasta TB, pero para un nuevo proceso, no. </font><font style="vertical-align: inherit;">Y parte del monitoreo en nosotros estuvo relacionado con el hecho de que el proceso principal bifurc√≥ peque√±os scripts para la recopilaci√≥n de datos. </font><font style="vertical-align: inherit;">Como resultado, nuestra parte de monitoreo se descompuso, porque ya no pod√≠amos bifurcar.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FB303</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FB303 es nuestro sistema de monitoreo b√°sico. </font><font style="vertical-align: inherit;">Fue nombrado despu√©s del sintetizador de bajo est√°ndar de 1982. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/t2/x3/f4/t2x3f4of3j794hnfskzti5lk3va.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El principio es simple, por lo tanto, todav√≠a funciona: cada servicio implementa la interfaz Thrift getCounters.</font></font><br>
<br>
<pre><code class="php hljs">Service FacebookService {<font></font>
    map&lt;<span class="hljs-keyword">string</span>, i64&gt; getCounters()<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De hecho, no lo implementa, porque las bibliotecas ya est√°n escritas, todo se hace en el c√≥digo </font></font><code>increment</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o </font></font><code>set</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<pre><code class="php hljs">incrementCounter(<span class="hljs-keyword">string</span>&amp; key);<font></font>
<font></font>
setCounter(<span class="hljs-keyword">string</span>&amp; key, int64_t value);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como resultado, cada servicio exporta contadores en el puerto que registra con Service Discovery. A continuaci√≥n se muestra un ejemplo de una m√°quina que genera una fuente de noticias y exporta aproximadamente 5.5 mil pares (cadena, n√∫mero): memoria, producci√≥n, cualquier cosa. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/sl/sb/fj/slsbfj9kapkaqsi3quo_do4q64a.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cada m√°quina ejecuta un proceso binario que pasa por todos los servicios, recopila estos contadores y los almacena. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As√≠ es como se ve la </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GUI de almacenamiento</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/sh/lt/li/shltlimradfvsovwo1vp1xzudmu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Muy similar a Prometeo y Grafana, pero no lo es. La primera entrada de FB303 en GitHub fue en 2009, y Prometheus en 2012. Esta es una explicaci√≥n de todos los productos de Facebook "caseros": los hicimos cuando nada era normal en Open Source. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por ejemplo, hay una b√∫squeda de los nombres de los contadores. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vb/b3/ya/vbb3yabg-lhlypl1y7_zwf9dolw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Los gr√°ficos en s√≠ se parecen a esto.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/b7/td/lj/b7tdljhxpmw6d5rt1fpguoon3ru.jpeg"><br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Una imagen del grupo interno en el que publicamos hermosos gr√°ficos. </font></font></em><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Una diferencia importante entre nuestra pila de monitoreo y Prometheus y Grafana es que </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">almacenamos datos para siempre</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Nuestro monitoreo volver√° a muestrear los datos, y despu√©s de 2 semanas tendremos un punto por cada 5 minutos, y despu√©s de un a√±o por cada hora. </font><font style="vertical-align: inherit;">Por lo tanto, se pueden almacenar tanto. </font><font style="vertical-align: inherit;">Autom√°ticamente esto no est√° configurado en ning√∫n lado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pero si hablamos de las caracter√≠sticas de monitorear Facebook, entonces lo describir√≠a con una palabra en ingl√©s " </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">observabilidad"</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Observabilidad</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hay una "caja negra", hay una "caja blanca", y tenemos una "caja" transparente de vidrio. </font><font style="vertical-align: inherit;">Esto significa que cuando escribimos c√≥digo, escribimos todo lo que es posible en los registros, y no selectivamente. </font><font style="vertical-align: inherit;">El muestreo est√° bien ajustado en todas partes, por lo que el backend para almacenamiento, mostradores y todo lo dem√°s vive bien. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al mismo tiempo, podemos construir nuestros paneles ya en los contadores existentes. </font><font style="vertical-align: inherit;">En el caso de estudiar estos paneles, este no es el punto final con 10 gr√°ficos, sino el inicial, desde el cual vamos a nuestra IU y encontramos todo lo que all√≠ es posible.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Escafandra aut√≥noma</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este es el cl√≠max de la idea de observabilidad. Esta es nuestra pila de ELK. El principio es el mismo: escribimos en JSON sin un esquema espec√≠fico, luego solicitamos en forma de </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tabla</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , series temporales de datos o 10 opciones de visualizaci√≥n m√°s. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Los registros de buceo son del orden de cientos de gigabytes por segundo. Todo se solicita muy r√°pidamente, porque no es Elasticsearch, y todo est√° en la memoria en m√°quinas potentes. S√≠, se gasta dinero, ¬°pero qu√© maravilloso es! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por ejemplo, debajo de la interfaz de usuario de Scuba, se abre una de las tablas m√°s populares, en la que todos los clientes de todos los servicios de Thrift escriben registros. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/dj/ah/ad/djahadigvrtru4luney67766slw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El gr√°fico muestra que al final, algo sali√≥ mal en el servicio. Para averiguar el retraso, vaya a la lista de contadores, seleccione el retraso, la agregaci√≥n, haga clic en "Inmersi√≥n". </font></font><br>
<br>
<img src="https://habrastorage.org/webt/m2/c-/y8/m2c-y8pfnqyrz4hivxhxyszwvnw.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La respuesta llega en 2 segundos.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/j6/ac/kg/j6ackggq0o7xk93vejg0yfbyrhi.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se puede ver que en ese momento sucedi√≥ algo y la demora aument√≥ significativamente. </font><font style="vertical-align: inherit;">Para obtener m√°s informaci√≥n, puede agrupar por diferentes par√°metros. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hay cientos de esas mesas.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Una tabla que muestra las versiones de archivos binarios, paquetes, cu√°nta memoria se consume en millones de m√°quinas. </font><font style="vertical-align: inherit;">En cada host, se realiza un PS una vez por hora y se env√≠a a Scuba.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Todos los dmesg, todos los volcados de memoria, se env√≠an a otras tablas. </font><font style="vertical-align: inherit;">Ejecutamos Perf una vez cada 10 minutos en cada m√°quina, por lo que sabemos qu√© rastros de pila tenemos en el n√∫cleo y qu√© puede cargar la CPU global.</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Depuraci√≥n PHP</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Scuba tambi√©n proporciona un back-end para nuestra herramienta principal de depuraci√≥n de PHP. Miles de ingenieros escriben c√≥digo PHP, y de alguna manera necesitas salvar el repositorio global de cosas malas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬øComo funciona? PHP tambi√©n escribe un seguimiento de pila en cada registro. Scuba (nuestro Elasticsearch) simplemente no puede acomodar el seguimiento de la pila de todos los registros de todas las m√°quinas. Antes de poner el registro en Scuba, convertimos la traza de la pila a un hash, la muestra por hash y los guardamos solo. Las trazas de la pila se env√≠an a Memcached. Luego, en la herramienta interna, puede extraer un seguimiento de pila espec√≠fico de Memcached lo suficientemente r√°pido. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ch/w_/im/chw_im8wjuue2nolmyzgcfappnq.jpeg"><br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Visualizaci√≥n con agrupaci√≥n hash de registros y seguimientos de pila.</font></font></em><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Depuramos el c√≥digo usando el m√©todo de </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">coincidencia de patrones</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : abra Scuba, vea c√≥mo se ve el gr√°fico de error.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/nd/op/nx/ndopnxibxeidsb8cmyy0rokasjm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos a LogView, all√≠ los errores ya est√°n agrupados por trazas de pila. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yx/0f/t3/yx0ft3lf_mnoskzxba7oqw3wtai.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se carga un seguimiento de pila desde Memcached, y en √©l ya puede encontrar diff (commit en el repositorio de PHP), que se public√≥ aproximadamente al mismo tiempo, y revertirlo. </font><font style="vertical-align: inherit;">Cualquiera puede retroceder y comprometerse con nosotros, no se necesitan permisos para esto.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/kh/eu/ck/kheuck1w2losbdhiyasysemlvnk.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tableros</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Terminar√© el tema de monitoreo con paneles. Tenemos pocos de ellos, solo dos de cada tres indicadores. El tablero en s√≠ es bastante inusual. Me gustar√≠a hablar m√°s sobre √©l. A continuaci√≥n se muestra un panel est√°ndar con un conjunto de gr√°ficos. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/kh/eu/ck/kheuck1w2losbdhiyasysemlvnk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Desafortunadamente, no es tan simple con √©l. El hecho es que la l√≠nea p√∫rpura en un gr√°fico es el mismo servicio al que corresponde la l√≠nea azul en otro gr√°fico, y otro gr√°fico puede estar en un d√≠a y otro en un mes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Utilizamos nuestro panel de control basado en el </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cubismo</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , la biblioteca JS de c√≥digo abierto. Fue escrito en Square y lanzado bajo la licencia Apache. Tienen soporte incorporado para grafito y cubo. Pero es f√°cil de expandir, lo que hemos hecho.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El tablero a continuaci√≥n muestra un d√≠a a un p√≠xel por minuto. </font><font style="vertical-align: inherit;">Cada l√≠nea es una regi√≥n: centros de datos que est√°n cerca. </font><font style="vertical-align: inherit;">Muestran el n√∫mero de registros que el backend de Facebook escribe en bytes por segundo. </font><font style="vertical-align: inherit;">A continuaci√≥n hay anotaciones para que los equipos en Estados Unidos vean lo que ya hemos solucionado de lo que sucedi√≥ durante el d√≠a. </font><font style="vertical-align: inherit;">Es f√°cil buscar correlaci√≥n en esta imagen. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/fx/3u/8f/fx3u8f42urcs2ernp8cu_gvxj6q.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A continuaci√≥n se muestra el n√∫mero de errores 500. Lo que a la izquierda no les importaba a los usuarios, y obviamente no les gustaba la franja verde oscuro en el centro. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/jy/dp/g1/jydpg1dmhrcxiirkeba3dhmtxcs.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El siguiente es el 99% de latencia. </font><font style="vertical-align: inherit;">Al mismo tiempo, como en el cuadro anterior, se puede ver que la latencia baj√≥. </font><font style="vertical-align: inherit;">Para devolver un error, no es necesario pasar mucho tiempo.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/og/4w/it/og4witypnhr2n091yaiwzjqctsg.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C√≥mo funciona</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En un gr√°fico de 120 p√≠xeles de altura, todo es visible. Pero muchos de estos no se pueden colocar en un tablero de instrumentos, por lo que nos exprimiremos hasta 30. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/48/-t/-2/48-t-2gfcbcmotwnkifz2tln_9u.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Desafortunadamente, obtenemos alg√∫n tipo de boa constrictor. Volvamos y veamos qu√© hace el cubismo con √©l. Rompe el gr√°fico en 4 partes: cuanto m√°s alto, m√°s oscuro, y luego se derrumba. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/zg/s-/48/zgs-48iqemvyyyyxuh1g949aoji.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora tenemos el mismo horario que antes, pero todo es claramente visible: cuanto m√°s oscuro es el verde, peor. Ahora est√° mucho m√°s claro lo que est√° sucediendo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A la izquierda puedes ver la ola mientras se eleva, y en el centro, donde es de color verde oscuro, todo est√° muy mal. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ql/0f/xu/ql0fxubdkifq0ax-mwhbn00ndxi.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El cubismo es solo el comienzo. Es necesario para la visualizaci√≥n, para comprender si todo est√° mal ahora o no. Para cada tabla, ya hay paneles con gr√°ficos detallados.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/_p/zx/u-/_pzxu-sbu9xc5p2gpoyrekvbybc.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El monitoreo por s√≠ solo ayuda a comprender el estado del sistema y responder si se rompe. </font><font style="vertical-align: inherit;">En Facebook, cada empleado de la llamada debe poder reparar todo. </font><font style="vertical-align: inherit;">Si se quema intensamente, todo se enciende, pero especialmente los ingenieros de producci√≥n con la experiencia de un administrador de sistemas, porque saben c√≥mo resolver el problema r√°pidamente.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cuando Facebook yac√≠a</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A veces ocurren incidentes y Facebook miente. Por lo general, la gente piensa que Facebook est√° mintiendo debido a ataques DDoS o hackers, pero en 5 a√±os nunca ha sucedido. La raz√≥n siempre ha sido nuestros ingenieros. No son a prop√≥sito: los sistemas son muy complejos y pueden descomponerse donde no espera. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Damos nombres a todos los incidentes importantes para que sea conveniente mencionarlos y contarles a los reci√©n llegados sobre ellos para no repetir errores en el futuro. El campe√≥n con el nombre m√°s divertido es el incidente de </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Call the Cops</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . La gente llam√≥ a la polic√≠a de Los √Ångeles y pidi√≥ arreglar Facebook porque estaba mintiendo. El Sheriff de Los √Ångeles estaba tan harto de eso que tuite√≥: "¬°Por favor no nos llames!" ¬°No somos responsables de esto! " </font></font><br>
<br>
<img src="https://habrastorage.org/webt/4p/tl/nv/4ptlnvj0sppjmmmdt3zjowumd-u.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mi incidente favorito en el que particip√© se llam√≥ </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CAPSLOCK.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Es interesante porque muestra que cualquier cosa puede suceder. Y esto es lo que sucedi√≥. Se obychnyyIP direcci√≥n: </font></font><code>fd3b:5679:92eb:9ce4::1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Facebook usa Chef para personalizar el sistema operativo. Service Inventory almacena la configuraci√≥n del host en su base de datos y Chef recibe un archivo de configuraci√≥n del servicio. Una vez que el servicio cambi√≥ su versi√≥n, comenz√≥ a leer las direcciones IP de la base de datos inmediatamente en formato MySQL y las puso en un archivo. La nueva direcci√≥n se escribe ahora en la capital: </font></font><code>FD3B:5679:92EB:9CE4::1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Shef mira el nuevo archivo y ve que la direcci√≥n IP ha "cambiado" porque se compara, no en forma binaria, sino con una cadena. La direcci√≥n IP es "nueva", lo que significa que debe bajar la interfaz y subirla. En todos los millones de autom√≥viles en 15 minutos, la interfaz se fue arriba y abajo.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parece que est√° bien: la capacidad disminuy√≥ mientras la red se encontraba en algunas m√°quinas. </font><font style="vertical-align: inherit;">Pero de repente se abri√≥ un error en el controlador de red de nuestras tarjetas de red personalizadas: al inicio, requer√≠an 0,5 GB de memoria f√≠sica secuencial. </font><font style="vertical-align: inherit;">En las m√°quinas de cach√©, esos 0.5 GB desaparecieron mientras baj√°bamos y sub√≠amos la interfaz. </font><font style="vertical-align: inherit;">Por lo tanto, en las m√°quinas de cach√©, la interfaz de red se cay√≥ y no aument√≥, y nada funciona sin cach√©s. </font><font style="vertical-align: inherit;">Nos sentamos y reiniciamos estas m√°quinas con nuestras manos. </font><font style="vertical-align: inherit;">Fue divertido.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Portal del administrador de incidentes</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cuando Facebook "arde", es necesario organizar el trabajo de la "brigada de bomberos" y, lo m√°s importante, comprender d√≥nde arde, porque en una gran empresa puede "oler a quemado" en un lugar, pero el problema estar√° en otro. </font><font style="vertical-align: inherit;">La herramienta de interfaz de usuario llamada </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Incident Manager Portal</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nos ayuda con esto </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Fue escrito por ingenieros de producci√≥n y est√° abierto a todos. </font><font style="vertical-align: inherit;">Tan pronto como sucede algo, comenzamos un incidente all√≠: nombre, comienzo, descripci√≥n.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/hj/px/sm/hjpxsmys_lbno7lkm9r9osacq7o.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tenemos una persona especialmente capacitada: Administrador de incidentes de guardia (IMOC). </font><font style="vertical-align: inherit;">Esta no es una posici√≥n permanente; los gerentes cambian regularmente. </font><font style="vertical-align: inherit;">En caso de grandes incendios, el IMOC organiza y coordina a las personas para su reparaci√≥n, pero no tiene que repararlo ellos mismos. </font><font style="vertical-align: inherit;">Tan pronto como se crea un incidente con un alto nivel de peligro, IMOC recibe SMS y comienza a ayudar a organizar todo. </font><font style="vertical-align: inherit;">En un sistema grande, no se puede prescindir de esas personas.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prevenci√≥n</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Facebook no es tan com√∫n. </font><font style="vertical-align: inherit;">La mayor√≠a de las veces no apagamos incendios y no reiniciamos las m√°quinas de cach√©, pero arreglamos los errores de antemano y, si es posible, para todos a la vez. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Una vez que encontramos y solucionamos el "problema de la cola". </font><font style="vertical-align: inherit;">El n√∫mero de solicitudes aumenta en un 50% y los errores en un 100%, porque nadie estrangula por adelantado, especialmente en servicios peque√±os. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Descubrimos un ejemplo de varios servicios y definimos aproximadamente un modelo de comportamiento.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bajo carga normal, la solicitud llega, se procesa y se devuelve al cliente.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Con una carga alta, las solicitudes est√°n esperando en una cola porque todos los subprocesos para procesar solicitudes est√°n ocupados. </font><font style="vertical-align: inherit;">La demora est√° aumentando, pero hasta ahora todo est√° bien.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La l√≠nea est√° creciendo, la carga est√° aumentando. </font><font style="vertical-align: inherit;">En alg√∫n momento, todo lo que el servidor ejecuta en el cliente termina con un tiempo de espera de respuesta y el cliente se cae con un error. </font><font style="vertical-align: inherit;">En este punto, el resultado del servidor simplemente puede desecharse.</font></font></li>
</ul><br>
<img src="https://habrastorage.org/webt/0b/c1/b1/0bc1b11xgg49wz266m-tvoximls.jpeg"><br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El tiempo de espera del cliente se resalta en rojo. </font></font></em><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬°Y el cliente repite de nuevo! </font><font style="vertical-align: inherit;">Resulta que todas las solicitudes que ejecutamos se tiran a la basura y ya nadie las necesita. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬øC√≥mo resolver este problema para todos a la vez? </font><font style="vertical-align: inherit;">Introduzca un l√≠mite en el tiempo de espera en la cola. </font><font style="vertical-align: inherit;">Si la solicitud est√° en la cola m√°s de lo esperado, la descartamos y no la procesamos en el servidor, no desperdiciamos CPU en ella. </font><font style="vertical-align: inherit;">Obtenemos un juego honesto: desechamos todo lo que no podemos procesar y todo lo que podemos procesar.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La restricci√≥n hizo posible, mientras aumentaba la carga en un 50% por encima del m√°ximo, procesar el 66% de las solicitudes y recibir solo el 33% de los errores. </font><font style="vertical-align: inherit;">Los desarrolladores del marco para Dispatch implementaron esto en el lado del servidor, y nosotros, los ingenieros de producci√≥n, resolvimos suavemente el tiempo de espera de 100 ms en la cola para todos. </font><font style="vertical-align: inherit;">Por lo tanto, todos los servicios obtuvieron inmediatamente una aceleraci√≥n b√°sica barata.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Herramientas</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La ideolog√≠a de SRE dice que si tiene una gran flota de autom√≥viles, un mont√≥n de servicios y nada que ver con sus manos, entonces necesita automatizar. </font><font style="vertical-align: inherit;">Por lo tanto, la mitad del tiempo escribimos c√≥digo y construimos herramientas.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cubismo</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> integrado </font><font style="vertical-align: inherit;">en el sistema.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FBAR es un "caballo de batalla" que viene y repara, por lo que nadie se preocupa por un auto roto. </font><font style="vertical-align: inherit;">Esta es la tarea principal de la FBAR, pero ahora tiene a√∫n m√°s tareas.</font></font></li>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Coredumper</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , que escribimos con dos colegas </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Supervisa los coredumps en todas las m√°quinas y los deja caer en un solo lugar junto con los rastros de la pila con toda la informaci√≥n del host: d√≥nde se encuentra, c√≥mo encontrar qu√© tama√±o. </font><font style="vertical-align: inherit;">Pero lo m√°s importante, los seguimientos de pila son gratuitos, sin iniciar GDB utilizando programas BPF.</font></font></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Centro</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lo √∫ltimo que hacemos es hablar con las personas, entrevistarlas. </font><font style="vertical-align: inherit;">Nos parece que esto es muy importante. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Una encuesta √∫til es sobre la fiabilidad. </font><font style="vertical-align: inherit;">Preguntamos acerca de los servicios que ya se est√°n ejecutando en las citas clave de nuestro cuestionario:</font></font><br>
<blockquote><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"La responsabilidad principal del software del sistema debe ser continuar ejecut√°ndose. </font><font style="vertical-align: inherit;">La prestaci√≥n de servicios debe verse como un efecto secundario beneficioso de la operaci√≥n continua ¬ª</font></font></em></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Esto significa que el deber principal del sistema es continuar trabajando, y el hecho de que brinde alg√∫n tipo de servicio es una ventaja adicional. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Las encuestas son solo para servicios medianos, los grandes tambi√©n entienden. </font><font style="vertical-align: inherit;">Damos un cuestionario en el que hacemos preguntas b√°sicas sobre arquitectura, SLO, pruebas, por ejemplo.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"¬øQu√© sucede si su sistema obtiene el 10% de la carga?" </font><font style="vertical-align: inherit;">Cuando la gente piensa: "¬øPero realmente, qu√©?" </font><font style="vertical-align: inherit;">- aparecen ideas y muchos incluso gobiernan sus sistemas. </font><font style="vertical-align: inherit;">Anteriormente, no lo pensaban, pero despu√©s de la pregunta hay una raz√≥n.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"¬øQui√©n es el primero en notar problemas con su servicio, usted o sus usuarios?" </font><font style="vertical-align: inherit;">Los desarrolladores comienzan a recordar cu√°ndo sucedi√≥ esto y: "... Tal vez necesites agregar alertas".</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"¬øCu√°l es tu mayor dolor en la llamada?" </font><font style="vertical-align: inherit;">Esto es inusual para los desarrolladores, especialmente para los nuevos. </font><font style="vertical-align: inherit;">Inmediatamente dicen: ‚Äú¬°Tenemos muchas alertas! </font><font style="vertical-align: inherit;">Vamos a limpiarlos y eliminar aquellos que no son el caso ".</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"¬øQu√© tan frecuentes son sus lanzamientos?" </font><font style="vertical-align: inherit;">Primero recuerdan que lo est√°n lanzando con sus manos, y luego tienen su propia implementaci√≥n personalizada.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No hay codificaci√≥n en el cuestionario; est√° estandarizado y cambia cada seis meses. </font><font style="vertical-align: inherit;">Este es un documento de dos p√°ginas que ayudamos a completar en 2-3 semanas. </font><font style="vertical-align: inherit;">Y luego organizamos una reuni√≥n de dos horas y encontramos soluciones a muchos dolores. </font><font style="vertical-align: inherit;">Esta sencilla herramienta funciona bien con nosotros y puede ayudarlo.</font></font><br>
<br>
<blockquote>6-7         <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Saint HighLoad++</a>,          .      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="> </a>       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="> </a>   (,   ,  ). <br>
   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a>       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">telegram-</a>  .   !</blockquote></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es489192/index.html">Smart Engines ingres√≥ a los tres primeros en el ranking FWCI entre las organizaciones b√°sicas de FizTech</a></li>
<li><a href="../es489194/index.html">C√≥mo OpenShift est√° cambiando la estructura organizativa de una organizaci√≥n de TI. La evoluci√≥n de los modelos organizacionales al pasar a PaaS</a></li>
<li><a href="../es489196/index.html">Humo M√°gico: Microcontroladores vs. Reguladores Lineales</a></li>
<li><a href="../es489198/index.html">C√≥mo no dispararte en el pie con Liquibase</a></li>
<li><a href="../es489200/index.html">Qu√© startups est√° buscando Y Combinator en 2020</a></li>
<li><a href="../es489206/index.html">Historias de bloqueo con Patroni, o C√≥mo soltar un cl√∫ster PostgreSQL</a></li>
<li><a href="../es489210/index.html">Prueba de rendimiento del c√≥digo de Linux con ejemplos</a></li>
<li><a href="../es489212/index.html">1C-Bitrix evita la cancelaci√≥n de la suscripci√≥n al bolet√≠n por el requisito de enviar sus datos personales</a></li>
<li><a href="../es489214/index.html">Enfoque moderno para probar la localizaci√≥n en iOS</a></li>
<li><a href="../es489218/index.html">Es ingenuo. Super: c√≥digo y arquitectura de un juego simple</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>