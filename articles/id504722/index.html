<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🍹 🤸🏼 🍐 HLS dalam MP4 menggunakan ffmpeg di browser 👨‍✈️ 👲 🕕</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Halo! Selama lebih dari dua bulan, di waktu senggang saya telah melihat aplikasi web untuk mengkonversi HLS dan DASH ke MP4 menggunakan emscripten dan...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>HLS dalam MP4 menggunakan ffmpeg di browser</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/504722/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Halo! </font><font style="vertical-align: inherit;">Selama lebih dari dua bulan, di waktu senggang saya telah melihat aplikasi web untuk mengkonversi HLS dan DASH ke MP4 menggunakan emscripten dan ffmpeg, dari mana saya ingin berbagi bagaimana saya berhasil melakukan ini. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam artikel ini saya tidak akan mengutip kode sumber dari ffmpeg dan tambalan, seperti </font><font style="vertical-align: inherit;">kebanyakan dari mereka dilakukan di atas lutut saya, dan saya tidak pandai C. Tapi sekarang ada artikel yang cukup untuk membantu Anda.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pengantar</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dua tahun yang lalu saya memiliki tujuan untuk menggabungkan track audio dan video menjadi satu file mp4. Lalu saya hanya terjun ke emscripten dan untuk dasar-dasarnya saya menemukan repositori </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ffmpeg.js</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dari mana saya belajar banyak. Kemudian saya hampir dapat mencapai tujuan, walaupun saya berorientasi kondisional dalam C. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Memahami kode sumber, ffmpeg membuat tambalan untuk bekerja dengan sistem file, di mana membaca dari file menyebabkan fungsi asinkron di js dari mana saya membaca gumpalan file dan mentransfer buffer, dan ketika menulis dipanggil Fungsi js yang mengirim data buffer ke repositori.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tetapi ada masalah dengan fungsi asinkron, yang saya tidak bisa pecahkan dengan benar, mereka bekerja melalui asyncify (fastcomp), yang tidak berfungsi dengan benar dalam beberapa kasus, yaitu, eksekusi kode dalam wasm tidak berhenti, tanpa menunggu hasil dari fungsi js, itu saja hancur. </font><font style="vertical-align: inherit;">Masalah ini diperbaiki melalui flag EMTERPRETIFY_WHITELIST, yang tampaknya memindahkan kode dari wasm ke asm pada saat yang sama dan memperlambatnya, dan perlu untuk men-debug tumpukan panggilan dan menambahkan fungsi yang rusak ke daftar dengan setiap pengecualian. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Secara umum, dengan masalah seperti itu, ini tidak bisa disebut solusi kerja, di mana semua ini tetap merupakan demo kecil.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/y-/gu/z-/y-guz-s_vswdqlgfbt8vbshowcg.png"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Satu setengah tahun kemudian</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah menonton laporan di Google Dev Summit </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tentang fitur-fitur baru di WebAssambly</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , saya pergi untuk melihat bagaimana emscripten lakukan dan melihat pesan:</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Emscripten memancarkan WebAssembly menggunakan backend LLVM wasm hulu, karena versi 1.39.0 (Oktober 2019), dan backend fastcomp lama tidak digunakan lagi</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya ingin mencoba membangun kembali format repacker saya. </font><font style="vertical-align: inherit;">Sekitar seminggu saya mencari cara untuk memperbaiki masalah kompilasi baru dan akhirnya menyatukan semuanya. </font><font style="vertical-align: inherit;">Perubahannya tidak banyak, tapi itu bukan karena linker perpustakaan baru, dan sudah putus asa untuk mengumpulkan setidaknya sesuatu, saya baru saja melihat perpustakaan yang bermasalah (ternyata, perpustakaan itu sendiri terhubung dan Anda tidak perlu menentukannya dengan tangan Anda saat perakitan). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan sekarang, saatnya telah tiba ketika ia telah mengumpulkan dan menghasilkan! </font><font style="vertical-align: inherit;">Masalah dengan kode asinkron hilang, tidak perlu men-debug apa pun, itu berfungsi sebagaimana mestinya dari awal. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di sini saya tampaknya telah mencapai tujuan saya, tetapi ... yang baru muncul.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tulis ulang Protokol HTTP</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pemikiran seperti itu sudah ada sejak lama. </font><font style="vertical-align: inherit;">Ini memungkinkan Anda untuk mengunduh HLS atau DASH, dan tidak hanya daftar putar yang sudah jadi tetapi juga streaming langsung. </font><font style="vertical-align: inherit;">Dan saya belum pernah melihat yang seperti ini di Internet. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Butuh waktu sekitar tiga minggu untuk membuat setidaknya sesuatu bekerja dengan saya dengan istirahat pendek. </font><font style="vertical-align: inherit;">Saya tahu C (walaupun tidak memiliki pengalaman), ada banyak masalah dengan pointer (sulit untuk melacak ke mana perginya, dan bahkan dalam kode orang lain), tetapi pada akhirnya sesuatu dikompilasi tanpa kesalahan. </font><font style="vertical-align: inherit;">Setelah kesuksesan pertama, ini bahkan memberi lebih banyak antusiasme untuk menyelesaikan gagasan itu. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hanya beberapa minggu, dan akhirnya saya berhasil melakukan iterasi pertama dari protokol http yang berfungsi, dan sepertinya itu saja?</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ketika yang paling sulit berakhir</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pada titik ini, saya memiliki kerangka kerja siap, bentuk html kecil dengan bidang input url dan tombol mulai, pada dasarnya itu berhasil. Tapi itu masih perlu untuk menulis ekstensi untuk memotong CORS dan memuat data, membuat penyimpanan yang akan menulis data dalam potongan, membuat antarmuka dengan tampilan kemajuan, semua ini sudah di-debug untuk memperbaiki masalah di browser yang berbeda. Secara umum, waktunya telah tiba akhirnya memungkinkan untuk menggunakannya. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pada dasarnya, skrip pengguna dibuat, yang merupakan proksi untuk mengambil permintaan dari ffmpeg untuk mengunduh data. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beberapa hari kemudian, ekstensi untuk Chrome dan Firefox sudah siap, yang menggunakan webRequest mengumpulkan semua tautan hls yang dimuat browser saat menonton video.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di Firefox, ternyata, API ekstensi tidak memungkinkan Anda untuk mengelola daya, dari mana Anda tidak dapat mencegah komputer tertidur, sayangnya. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ekstensinya terlihat seperti ini: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vu/a6/ig/vua6igsxprko_lw12jwmstkfq48.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Baru saja memperbaiki halaman tempat situs itu sedikit, mengacaukan material-ui, menyelesaikan semua tempat yang dihancurkan. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/tq/s1/il/tqs1iltzg0y1-h1hmmatewctvyo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah menguji berbagai cara menyimpan data, saya mengungkapkan sejumlah masalah: </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Blob</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Chrome menulisnya ke RAM dan jatuh ke disk ketika meluap, tetapi hanya di OSX ketika memori meluap, OS meninggalkan akun dan menutup semua aplikasi yang terbuka. Dan Firefox umumnya selalu menyimpan data dalam memori. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Penyimpanan cache</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- berfungsi seperti IndexedDb, tetapi setelah menulis data, di Chrome blob mereka tetap di RAM (baik bug atau fitcha), tetapi ternyata data ditulis ke penyimpanan cache (ke disk) dan juga turun sama ketika memori penuh volume ke disk sebagai gumpalan. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IndexedDb</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - bekerja seperti jam, tahu cara menyimpan gumpalan, menulis data tanpa embel-embel, tetapi Firefox secara ketat membatasi jumlah 2gb. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya bekerja sedikit, saya berhasil membuat fungsi mengganggu proses ffmpeg (melalui pointer), saya datang dengan cara membuat pilihan format (ffprobe) dan penanganan kesalahan jaringan. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ut/80/eo/ut80eoy4c02vuelxcfrx9ngswga.png"><br>
<br>
<img src="https://habrastorage.org/webt/ae/b7/qi/aeb7qikdlqnzfhuyiy6_-onisro.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan sekarang, Anda dapat mencoba hasilnya sendiri </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">di sini</font></font></a> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bagi saya, ini adalah hal yang sangat diperlukan ketika Anda perlu merekam streaming di tweet atau mengunduh VOD. </font><font style="vertical-align: inherit;">Ini juga bekerja dengan laptop, mixer, dan situs lain yang menyiarkan konten dalam HLS atau DASH (sayangnya, implementasi DASH di ffmpeg sangat kondisional dan langsung tidak dapat mengunduh dengan benar, karena tidak memperhitungkan interval permintaan fragmen). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Terima kasih telah membaca! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika Anda memiliki pertanyaan tentang ffmpeg dan emscripten - write, saya akan mencoba menjawab.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id504712/index.html">Mengapa saya tidak menggunakan SharedViewModel untuk fragmen?</a></li>
<li><a href="../id504714/index.html">Go alat pengukuran perangkat lunak</a></li>
<li><a href="../id504716/index.html">Akses aman ke rumah pintar tanpa adanya IP publik (bagian 1)</a></li>
<li><a href="../id504718/index.html">Intisari bahan-bahan segar dari dunia front-end untuk minggu terakhir No. 417 (25 - 31 Mei, 2020)</a></li>
<li><a href="../id504720/index.html">Mesin templat tercepat untuk PHP</a></li>
<li><a href="../id504724/index.html">Koneksiisme</a></li>
<li><a href="../id504726/index.html">4 perjanjian</a></li>
<li><a href="../id504728/index.html">Port Editor Godot untuk WebAssembly dirilis</a></li>
<li><a href="../id504730/index.html">Mungkin ternyata Anda membeli sampah apa pun di Amazon - dan secara harfiah</a></li>
<li><a href="../id504732/index.html">Solarografi Digital</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>