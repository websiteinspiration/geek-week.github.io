<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👧 🥤 🥣 IoT, wo Sie nicht gewartet haben (Teil 3). Erstellen eines Simulationsmodells 🐚 👦🏼 🔏</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Wie ich bereits im letzten Teil sagte , sind bei der Entwicklung eines IoT-Projekts die Protokolle für die Interaktion mit Geräten ziemlich instabil, ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>IoT, wo Sie nicht gewartet haben (Teil 3). Erstellen eines Simulationsmodells</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jugru/blog/503064/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wie ich bereits im </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">letzten Teil</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sagte </font><font style="vertical-align: inherit;">, sind bei der Entwicklung eines IoT-Projekts die Protokolle für die Interaktion mit Geräten ziemlich instabil, und die Wahrscheinlichkeit, nach dem Aktualisieren der Firmware den Kontakt zu Testgeräten zu verlieren, war ziemlich groß. </font><font style="vertical-align: inherit;">An der Entwicklung waren mehrere Teams beteiligt, und es bestand eine strikte Anforderung, die Fähigkeit zum Testen der Geschäftsschicht der Anwendung nicht zu verlieren, selbst wenn das Flashen der Geräte den gesamten Arbeitsfluss mit Sensoren unterbricht.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/zv/z5/tv/zvz5tvvouwnwasl8uerdpzto6eq.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Damit Geschäftsanalysten ihre Hypothesen an Daten testen können, die der Realität mehr oder weniger ähnlich sind, haben wir ein Simulationsmodell des Geräts erstellt. </font><font style="vertical-align: inherit;">Wenn das Gerät aufgrund einer neuen Firmware ausfiel und die Daten dringend empfangen werden mussten, haben wir ein Simulationsmodell anstelle eines realen Geräts im Netzwerk gestartet, das die Daten im alten Format verfolgte und das Ergebnis lieferte.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Vorteil des Modells bestand auch darin, dass das Unternehmen niemals eine große Menge von Geräten kaufen würde, nur um eine Hypothese zu testen. </font><font style="vertical-align: inherit;">Das Geschäftsanalyseteam entschied beispielsweise, dass die Vorhersage der Behälterfüllzeit anders funktionieren sollte. </font><font style="vertical-align: inherit;">Und um ihre Hypothese zu testen, wird niemand laufen, um 10.000 Sensoren zu kaufen.</font></font><br>
<br>
<h2><font color="#DB8E0D"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Entwicklung eines Simulationsmodells</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Simulationsmodell selbst war wie folgt: Der </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ed/bs/pf/edbspfx-ti5ypivxexehovva9ok.gif" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zustand und das Verhalten der Mülltonne werden von einer regulären Zustandsmaschine beschrieben. Zuerst initialisieren wir die Zustandsmaschine mit dem Zustand "LEER (Ebene = 0)" und können einige Aktionen ausführen, dh Müll in den Container werfen. Jetzt müssen Sie entscheiden, ob der Container leer bleibt (Ebene? MAX_LEVEL) oder voll ist (Ebene&gt; = MAX_LEVEL). Wenn der zweite, ändert sich der Status in "FULL". </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jemand kann den Müll aus einem vollen Container entladen, oder der Hausmeister ist gekommen, um sein Chaos zu beseitigen, und wir müssen entscheiden, in welchen Zustand wir wechseln sollen. Der Status "CHOICE" ist für die Auswahl einer Aktion verantwortlich - in der Terminologie einer Zustandsmaschine, ähnlich einem if-Block.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ein anderer Container kann brennen, und dann ändert sich der Zustand der Zustandsmaschine in "FEUER". </font><font style="vertical-align: inherit;">Außerdem kann der Container herunterfallen und sein Zustand wird zu "FALL" (in dem Bericht habe ich darüber gesprochen, welche unerwarteten Gründe das Fallenlassen von Containern verursachen können). </font><font style="vertical-align: inherit;">Es gibt jedoch einen anderen "LOST" -Zustand, der von jedem anderen Zustand aus gültig ist - er wird festgelegt, wenn die Verbindung unterbrochen wird. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eine solche Zustandsmaschine beschreibt fast das gesamte Verhalten des Behälters und des darauf befindlichen Sensors. </font><font style="vertical-align: inherit;">Dies reicht jedoch nicht aus, um ein Simulationsmodell zu erstellen, da wir die möglichen Zustände und Übergänge kennen, aber nicht wissen, wie wahrscheinlich diese Ereignisse sind und wann sie auftreten werden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tatsächlich stellte sich heraus, dass die Wahrscheinlichkeit von Ereignissen von der Tageszeit abhängt, weil:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Träger arbeiten nachts nicht;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menschen werfen zu bestimmten Zeiten mehr Müll (morgens vor der Arbeit und abends).</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Daher haben wir es dem Business Analysis Team ermöglicht, das Simulationsverhalten anzupassen. </font><font style="vertical-align: inherit;">Es war möglich, die Wahrscheinlichkeit eines Ereignisses zu einer bestimmten Tageszeit einzustellen.</font></font><br>
<br>
<h2><font color="#DB8E0D"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Einfacher und intuitiver Stresstest </font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nachahmung selbst hat viele Vorteile, und einer davon ist das Testen billiger Belastungen. </font><font style="vertical-align: inherit;">Es ist billig, da Nachahmung in der Tat ein separater Thread ist, der die Zustandsmaschine startet, Ereignisse darauf anwendet und die Ereignisse selbst an den realen Server gesendet werden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Daher unterscheidet sich die Simulation für das Backend nicht vom realen Sensor. </font><font style="vertical-align: inherit;">Und wenn wir 1000 Sensoren ausführen müssen, führen Sie 1000 Threads aus und arbeiten Sie. </font><font style="vertical-align: inherit;">Darüber hinaus skaliert die Simulation perfekt.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/xq/5c/w5/xq5cw5zezhxybxbmk_xuyo7sjxk.gif" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Einerseits ist es ziemlich unhöflich, die Last zu testen, andererseits ermöglichte die Simulation, viele Daten für das gesamte Projekt realitätsnah zu steuern. Und vergessen Sie nicht begabte chinesische Entwickler, die Standardprotokolle wie MQTT ignorierten und ihr Protokoll auf Sockets absägten. Daher mussten wir unsere eigene Implementierung eines Servers durchführen, der Daten auf Sockets unter diesem proprietären Protokoll akzeptiert.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ein solcher Server musste Multithreading sein, da es viele Eingangssensoren gibt. und dieser Teil muss auch separat unter Verwendung von Leistungstests getestet werden. Sie können JMeter (ein typisches Testskript schreiben), JMH / JCStress (einzelne Teile testen und einen dünneren Benchmark erstellen) oder etwas anderes nehmen. Wenn Sie in einer ähnlichen Situation eine Entscheidung treffen, empfehle ich Ihnen, Fachleuten zuzuhören, zum Beispiel Alexei Shipilev. Bei JPoint 2017 </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sprach</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> er sehr cool </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">darüber,</font></a><font style="vertical-align: inherit;"> wie man verschiedene Dinge </font><font style="vertical-align: inherit;">bewertet </font><font style="vertical-align: inherit;">und woran man denken muss, wenn man Leistungstests durchführt.</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/p2b4JHESEOc" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben uns für die Option entschieden, etwas Eigenes zu tun, da das Projekt einen atypischen Ansatz für die Qualitätssicherung hatte - wir haben kein separates Testerteam, und das Backend-Team selbst hat die Funktionalität getestet. </font><font style="vertical-align: inherit;">Das heißt, die Person, die den Socket-Server geschrieben hat, musste den Code mit normalen Einheiten, Integrations- und Leistungstests abdecken. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir hatten ein kleines Tool, mit dem wir das Lastszenario schnell beschreiben und in der richtigen Anzahl paralleler Threads ausführen konnten:</font></font><br>
<br>
<pre><code class="java hljs">StressTestRunner.test()<font></font>
                .mode(ExecutionMode.EXECUTOR_MODE)<font></font>
                .threads(THREADS_COUNT)<font></font>
                .iterations(MESSAGES_COUNT)<font></font>
                .timeout(<span class="hljs-number">5</span>, TimeUnit.SECONDS)<font></font>
                .run(() -&gt; sensor.send(MESSAGE));<font></font>
<font></font>
Awaitility.await()<font></font>
          .atMost(<span class="hljs-number">5</span>, TimeUnit.SECONDS)<font></font>
          .untilAsserted(() -&gt;<font></font>
            verifyReceived(MESSAGES_COUNT)<font></font>
          );<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir geben an, wie viele Threads Sie ausführen müssen, wie viele Nachrichten gesendet werden müssen, wie lange es dauern sollte und senden Daten an den Socket in jedem Thread. </font><font style="vertical-align: inherit;">Es bleibt nur zu warten, bis unser Server alle diese Daten korrekt verarbeitet hat. </font><font style="vertical-align: inherit;">Es wurden nur wenige Codezeilen veröffentlicht, die von jedem Backend-Entwickler geschrieben werden können.</font></font><br>
<br>
<h2><font color="#DB8E0D"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Emulation von Netzwerkproblemen</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mit Hilfe der Nachahmung konnten wir sowohl minderwertige als auch spezifische Arbeiten mit Steckdosen simulieren. </font><font style="vertical-align: inherit;">GSM-SIM-Karten in den Sensoren haben keine „weißen“ IP-Adressen, und wir können 50 Mal am Tag Daten von verschiedenen IPs empfangen. </font><font style="vertical-align: inherit;">Und es kam oft vor, dass die Verbindung geöffnet wurde, wir begannen, Daten zu übertragen, dann änderte sich die IP-Adresse und der Server öffnete eine neue Verbindung, ohne die alte zu schließen. </font><font style="vertical-align: inherit;">Wenn wir dies nicht berücksichtigen würden, würden uns in ein paar Tagen die freien Ports auf dem Server ausgehen. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/zo/7i/cp/zo7icpvaszptgcfrwhlisznm5aw.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es gab auch ein Problem mit verschiedenen Geschwindigkeitssensoren. </font><font style="vertical-align: inherit;">Ein langsames Gerät kann eine Verbindung öffnen und für eine Weile einfrieren, während ein schnelles Gerät etwas sendet. </font><font style="vertical-align: inherit;">Und das alles muss richtig verarbeitet werden. </font><font style="vertical-align: inherit;">Bei der Nachahmung ist es einfach, eine ähnliche Situation mithilfe von Pausen zu simulieren. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/wh/q2/es/whq2esv39_sverob7195mc6yxtw.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dies ist nur ein Teil der Szenarien, die in das Modell integriert werden können.</font></font><br>
<br>
<h2><font color="#DB8E0D"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ergebnisse</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es scheint mir, dass genau die Möglichkeit der Simulation das Internet der Dinge stark von anderen Projekten unterscheidet. Das Simulieren des Geräteverhaltens ist einfacher als menschliches Verhalten. Bei der Eingabe erhalten wir deterministische Werte, die gut mit unserem Modell korrelieren, und keine zufälligen menschlichen Handlungen. Weil das Verhalten von Geräten logisch einfacher zu beschreiben ist als das Verhalten von Personen, und das Testen des Systems einfacher wird. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben uns einige verschiedene Aspekte der Entwicklung im Internet der Dinge angesehen. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/dm/be/gl/dmbeglutox6rwbye8o2jkvgflm4.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie die beiden vorherigen Teile dieses Artikels übersprungen haben, finden Sie sie hier: </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IoT, auf das Sie nicht gewartet haben (Teil 1) - Der Themenbereich und die Probleme des </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IoT, auf die Sie nicht gewartet haben (Teil 2) - Anwendungsarchitektur und IoT-Tests bestimmter Dinge </font></font></a><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Github mit den fraglichen Testwerkzeugen.</font></font></a><br>
<br>
<blockquote> .  ,     Heisenbug    ,        IoT. ,   !        JPoint,        .          Heisenbug   JPoint    6   . <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">   !</a></blockquote></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de503042/index.html">5 Mythen über Red Teaming</a></li>
<li><a href="../de503052/index.html">Automatisierung von Mikrofronts oder wie Komponentenbibliotheken in Tinkoff getestet werden</a></li>
<li><a href="../de503054/index.html">Was ist gemeinsam zwischen Tropfen in einer Tasse Kaffee und der Quantenmechanik?</a></li>
<li><a href="../de503056/index.html">23. Mai Online-Pub: Holivarim über Wolken, JS und Handys</a></li>
<li><a href="../de503062/index.html">Реальная стоимость жизни в Кремниевой Долине для разработчика</a></li>
<li><a href="../de503068/index.html">An der Schnittstelle von Technologie und Wirtschaft: IT-Verantwortliche eröffnen eine neue Universität in der Schweiz</a></li>
<li><a href="../de503070/index.html">Elektrischer Becher. Bau eines verrückten Elektrorollers / Elektrofahrrads</a></li>
<li><a href="../de503072/index.html">Nur ein weiteres Tool: Kennenlernen der Dienstkonfiguration mit Desired State Configuration </a></li>
<li><a href="../de503074/index.html">Details zum Provider-Paket für Flutter</a></li>
<li><a href="../de503082/index.html">Telegramm als NAS / FTP</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>