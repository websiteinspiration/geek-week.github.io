<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëß ü•§ ü•£ IoT, wo Sie nicht gewartet haben (Teil 3). Erstellen eines Simulationsmodells üêö üë¶üèº üîè</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Wie ich bereits im letzten Teil sagte , sind bei der Entwicklung eines IoT-Projekts die Protokolle f√ºr die Interaktion mit Ger√§ten ziemlich instabil, ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>IoT, wo Sie nicht gewartet haben (Teil 3). Erstellen eines Simulationsmodells</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jugru/blog/503064/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wie ich bereits im </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">letzten Teil</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sagte </font><font style="vertical-align: inherit;">, sind bei der Entwicklung eines IoT-Projekts die Protokolle f√ºr die Interaktion mit Ger√§ten ziemlich instabil, und die Wahrscheinlichkeit, nach dem Aktualisieren der Firmware den Kontakt zu Testger√§ten zu verlieren, war ziemlich gro√ü. </font><font style="vertical-align: inherit;">An der Entwicklung waren mehrere Teams beteiligt, und es bestand eine strikte Anforderung, die F√§higkeit zum Testen der Gesch√§ftsschicht der Anwendung nicht zu verlieren, selbst wenn das Flashen der Ger√§te den gesamten Arbeitsfluss mit Sensoren unterbricht.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/zv/z5/tv/zvz5tvvouwnwasl8uerdpzto6eq.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Damit Gesch√§ftsanalysten ihre Hypothesen an Daten testen k√∂nnen, die der Realit√§t mehr oder weniger √§hnlich sind, haben wir ein Simulationsmodell des Ger√§ts erstellt. </font><font style="vertical-align: inherit;">Wenn das Ger√§t aufgrund einer neuen Firmware ausfiel und die Daten dringend empfangen werden mussten, haben wir ein Simulationsmodell anstelle eines realen Ger√§ts im Netzwerk gestartet, das die Daten im alten Format verfolgte und das Ergebnis lieferte.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Vorteil des Modells bestand auch darin, dass das Unternehmen niemals eine gro√üe Menge von Ger√§ten kaufen w√ºrde, nur um eine Hypothese zu testen. </font><font style="vertical-align: inherit;">Das Gesch√§ftsanalyseteam entschied beispielsweise, dass die Vorhersage der Beh√§lterf√ºllzeit anders funktionieren sollte. </font><font style="vertical-align: inherit;">Und um ihre Hypothese zu testen, wird niemand laufen, um 10.000 Sensoren zu kaufen.</font></font><br>
<br>
<h2><font color="#DB8E0D"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Entwicklung eines Simulationsmodells</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Simulationsmodell selbst war wie folgt: Der </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ed/bs/pf/edbspfx-ti5ypivxexehovva9ok.gif" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zustand und das Verhalten der M√ºlltonne werden von einer regul√§ren Zustandsmaschine beschrieben. Zuerst initialisieren wir die Zustandsmaschine mit dem Zustand "LEER (Ebene = 0)" und k√∂nnen einige Aktionen ausf√ºhren, dh M√ºll in den Container werfen. Jetzt m√ºssen Sie entscheiden, ob der Container leer bleibt (Ebene? MAX_LEVEL) oder voll ist (Ebene&gt; = MAX_LEVEL). Wenn der zweite, √§ndert sich der Status in "FULL". </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jemand kann den M√ºll aus einem vollen Container entladen, oder der Hausmeister ist gekommen, um sein Chaos zu beseitigen, und wir m√ºssen entscheiden, in welchen Zustand wir wechseln sollen. Der Status "CHOICE" ist f√ºr die Auswahl einer Aktion verantwortlich - in der Terminologie einer Zustandsmaschine, √§hnlich einem if-Block.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ein anderer Container kann brennen, und dann √§ndert sich der Zustand der Zustandsmaschine in "FEUER". </font><font style="vertical-align: inherit;">Au√üerdem kann der Container herunterfallen und sein Zustand wird zu "FALL" (in dem Bericht habe ich dar√ºber gesprochen, welche unerwarteten Gr√ºnde das Fallenlassen von Containern verursachen k√∂nnen). </font><font style="vertical-align: inherit;">Es gibt jedoch einen anderen "LOST" -Zustand, der von jedem anderen Zustand aus g√ºltig ist - er wird festgelegt, wenn die Verbindung unterbrochen wird. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eine solche Zustandsmaschine beschreibt fast das gesamte Verhalten des Beh√§lters und des darauf befindlichen Sensors. </font><font style="vertical-align: inherit;">Dies reicht jedoch nicht aus, um ein Simulationsmodell zu erstellen, da wir die m√∂glichen Zust√§nde und √úberg√§nge kennen, aber nicht wissen, wie wahrscheinlich diese Ereignisse sind und wann sie auftreten werden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tats√§chlich stellte sich heraus, dass die Wahrscheinlichkeit von Ereignissen von der Tageszeit abh√§ngt, weil:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tr√§ger arbeiten nachts nicht;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menschen werfen zu bestimmten Zeiten mehr M√ºll (morgens vor der Arbeit und abends).</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Daher haben wir es dem Business Analysis Team erm√∂glicht, das Simulationsverhalten anzupassen. </font><font style="vertical-align: inherit;">Es war m√∂glich, die Wahrscheinlichkeit eines Ereignisses zu einer bestimmten Tageszeit einzustellen.</font></font><br>
<br>
<h2><font color="#DB8E0D"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Einfacher und intuitiver Stresstest </font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nachahmung selbst hat viele Vorteile, und einer davon ist das Testen billiger Belastungen. </font><font style="vertical-align: inherit;">Es ist billig, da Nachahmung in der Tat ein separater Thread ist, der die Zustandsmaschine startet, Ereignisse darauf anwendet und die Ereignisse selbst an den realen Server gesendet werden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Daher unterscheidet sich die Simulation f√ºr das Backend nicht vom realen Sensor. </font><font style="vertical-align: inherit;">Und wenn wir 1000 Sensoren ausf√ºhren m√ºssen, f√ºhren Sie 1000 Threads aus und arbeiten Sie. </font><font style="vertical-align: inherit;">Dar√ºber hinaus skaliert die Simulation perfekt.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/xq/5c/w5/xq5cw5zezhxybxbmk_xuyo7sjxk.gif" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Einerseits ist es ziemlich unh√∂flich, die Last zu testen, andererseits erm√∂glichte die Simulation, viele Daten f√ºr das gesamte Projekt realit√§tsnah zu steuern. Und vergessen Sie nicht begabte chinesische Entwickler, die Standardprotokolle wie MQTT ignorierten und ihr Protokoll auf Sockets abs√§gten. Daher mussten wir unsere eigene Implementierung eines Servers durchf√ºhren, der Daten auf Sockets unter diesem propriet√§ren Protokoll akzeptiert.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ein solcher Server musste Multithreading sein, da es viele Eingangssensoren gibt. und dieser Teil muss auch separat unter Verwendung von Leistungstests getestet werden. Sie k√∂nnen JMeter (ein typisches Testskript schreiben), JMH / JCStress (einzelne Teile testen und einen d√ºnneren Benchmark erstellen) oder etwas anderes nehmen. Wenn Sie in einer √§hnlichen Situation eine Entscheidung treffen, empfehle ich Ihnen, Fachleuten zuzuh√∂ren, zum Beispiel Alexei Shipilev. Bei JPoint 2017 </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sprach</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> er sehr cool </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">dar√ºber,</font></a><font style="vertical-align: inherit;"> wie man verschiedene Dinge </font><font style="vertical-align: inherit;">bewertet </font><font style="vertical-align: inherit;">und woran man denken muss, wenn man Leistungstests durchf√ºhrt.</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/p2b4JHESEOc" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben uns f√ºr die Option entschieden, etwas Eigenes zu tun, da das Projekt einen atypischen Ansatz f√ºr die Qualit√§tssicherung hatte - wir haben kein separates Testerteam, und das Backend-Team selbst hat die Funktionalit√§t getestet. </font><font style="vertical-align: inherit;">Das hei√üt, die Person, die den Socket-Server geschrieben hat, musste den Code mit normalen Einheiten, Integrations- und Leistungstests abdecken. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir hatten ein kleines Tool, mit dem wir das Lastszenario schnell beschreiben und in der richtigen Anzahl paralleler Threads ausf√ºhren konnten:</font></font><br>
<br>
<pre><code class="java hljs">StressTestRunner.test()<font></font>
                .mode(ExecutionMode.EXECUTOR_MODE)<font></font>
                .threads(THREADS_COUNT)<font></font>
                .iterations(MESSAGES_COUNT)<font></font>
                .timeout(<span class="hljs-number">5</span>, TimeUnit.SECONDS)<font></font>
                .run(() -&gt; sensor.send(MESSAGE));<font></font>
<font></font>
Awaitility.await()<font></font>
          .atMost(<span class="hljs-number">5</span>, TimeUnit.SECONDS)<font></font>
          .untilAsserted(() -&gt;<font></font>
            verifyReceived(MESSAGES_COUNT)<font></font>
          );<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir geben an, wie viele Threads Sie ausf√ºhren m√ºssen, wie viele Nachrichten gesendet werden m√ºssen, wie lange es dauern sollte und senden Daten an den Socket in jedem Thread. </font><font style="vertical-align: inherit;">Es bleibt nur zu warten, bis unser Server alle diese Daten korrekt verarbeitet hat. </font><font style="vertical-align: inherit;">Es wurden nur wenige Codezeilen ver√∂ffentlicht, die von jedem Backend-Entwickler geschrieben werden k√∂nnen.</font></font><br>
<br>
<h2><font color="#DB8E0D"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Emulation von Netzwerkproblemen</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mit Hilfe der Nachahmung konnten wir sowohl minderwertige als auch spezifische Arbeiten mit Steckdosen simulieren. </font><font style="vertical-align: inherit;">GSM-SIM-Karten in den Sensoren haben keine ‚Äûwei√üen‚Äú IP-Adressen, und wir k√∂nnen 50 Mal am Tag Daten von verschiedenen IPs empfangen. </font><font style="vertical-align: inherit;">Und es kam oft vor, dass die Verbindung ge√∂ffnet wurde, wir begannen, Daten zu √ºbertragen, dann √§nderte sich die IP-Adresse und der Server √∂ffnete eine neue Verbindung, ohne die alte zu schlie√üen. </font><font style="vertical-align: inherit;">Wenn wir dies nicht ber√ºcksichtigen w√ºrden, w√ºrden uns in ein paar Tagen die freien Ports auf dem Server ausgehen. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/zo/7i/cp/zo7icpvaszptgcfrwhlisznm5aw.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es gab auch ein Problem mit verschiedenen Geschwindigkeitssensoren. </font><font style="vertical-align: inherit;">Ein langsames Ger√§t kann eine Verbindung √∂ffnen und f√ºr eine Weile einfrieren, w√§hrend ein schnelles Ger√§t etwas sendet. </font><font style="vertical-align: inherit;">Und das alles muss richtig verarbeitet werden. </font><font style="vertical-align: inherit;">Bei der Nachahmung ist es einfach, eine √§hnliche Situation mithilfe von Pausen zu simulieren. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/wh/q2/es/whq2esv39_sverob7195mc6yxtw.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dies ist nur ein Teil der Szenarien, die in das Modell integriert werden k√∂nnen.</font></font><br>
<br>
<h2><font color="#DB8E0D"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ergebnisse</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es scheint mir, dass genau die M√∂glichkeit der Simulation das Internet der Dinge stark von anderen Projekten unterscheidet. Das Simulieren des Ger√§teverhaltens ist einfacher als menschliches Verhalten. Bei der Eingabe erhalten wir deterministische Werte, die gut mit unserem Modell korrelieren, und keine zuf√§lligen menschlichen Handlungen. Weil das Verhalten von Ger√§ten logisch einfacher zu beschreiben ist als das Verhalten von Personen, und das Testen des Systems einfacher wird. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben uns einige verschiedene Aspekte der Entwicklung im Internet der Dinge angesehen. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/dm/be/gl/dmbeglutox6rwbye8o2jkvgflm4.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie die beiden vorherigen Teile dieses Artikels √ºbersprungen haben, finden Sie sie hier: </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IoT, auf das Sie nicht gewartet haben (Teil 1) - Der Themenbereich und die Probleme des </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IoT, auf die Sie nicht gewartet haben (Teil 2) - Anwendungsarchitektur und IoT-Tests bestimmter Dinge </font></font></a><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Github mit den fraglichen Testwerkzeugen.</font></font></a><br>
<br>
<blockquote> .  ,     Heisenbug    ,        IoT. ,   !        JPoint,        .          Heisenbug   JPoint    6   . <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">   !</a></blockquote></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de503042/index.html">5 Mythen √ºber Red Teaming</a></li>
<li><a href="../de503052/index.html">Automatisierung von Mikrofronts oder wie Komponentenbibliotheken in Tinkoff getestet werden</a></li>
<li><a href="../de503054/index.html">Was ist gemeinsam zwischen Tropfen in einer Tasse Kaffee und der Quantenmechanik?</a></li>
<li><a href="../de503056/index.html">23. Mai Online-Pub: Holivarim √ºber Wolken, JS und Handys</a></li>
<li><a href="../de503062/index.html">–†–µ–∞–ª—å–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –∂–∏–∑–Ω–∏ –≤ –ö—Ä–µ–º–Ω–∏–µ–≤–æ–π –î–æ–ª–∏–Ω–µ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞</a></li>
<li><a href="../de503068/index.html">An der Schnittstelle von Technologie und Wirtschaft: IT-Verantwortliche er√∂ffnen eine neue Universit√§t in der Schweiz</a></li>
<li><a href="../de503070/index.html">Elektrischer Becher. Bau eines verr√ºckten Elektrorollers / Elektrofahrrads</a></li>
<li><a href="../de503072/index.html">Nur ein weiteres Tool: Kennenlernen der Dienstkonfiguration mit Desired State Configuration¬†</a></li>
<li><a href="../de503074/index.html">Details zum Provider-Paket f√ºr Flutter</a></li>
<li><a href="../de503082/index.html">Telegramm als NAS / FTP</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>