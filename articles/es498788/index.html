<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚òÅÔ∏è üëäüèº üë©üèæ‚Äçüíº Aprendiendo un Mini Motor Paso a Paso üìâ üë®üèæ‚Äçü§ù‚Äçüë®üèº ü¶ó</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Los motores paso a paso son ampliamente utilizados en la industria moderna y en productos caseros. Se utilizan donde es necesario garantizar la precis...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Aprendiendo un Mini Motor Paso a Paso</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/498788/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Los motores paso a paso son ampliamente utilizados en la industria moderna y en productos caseros. Se utilizan donde es necesario garantizar la precisi√≥n del posicionamiento de los componentes mec√°nicos, sin recurrir a la retroalimentaci√≥n y a mediciones precisas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hoy quiero hablar sobre un tipo especial de motores paso a paso: motores paso a paso en miniatura, que se utilizan en la construcci√≥n de sistemas √≥pticos. Echaremos un vistazo m√°s de cerca a su dispositivo y c√≥mo controlar motores tan peque√±os.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/zh/sz/_x/zhsz_xl6lm4btv11g953x7e2kwa.jpeg"><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un motor paso a paso es un motor el√©ctrico sin escobillas (sin escobillas) con varios devanados (fases) ubicados en el estator e imanes (a menudo permanentes) en el rotor. Al aplicar voltaje a los devanados del estator, podemos fijar la posici√≥n del rotor, y al aplicar voltaje a los devanados, podemos obtener sucesivamente el movimiento del rotor de una posici√≥n a otra (paso), y este paso tiene un valor angular fijo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No nos detendremos en la consideraci√≥n de cada tipo de motor paso a paso. Mucho se ha escrito sobre esto en la red y bueno, por ejemplo, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqu√≠</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quiero hablar sobre un tipo especial de motores paso a paso: motores paso a paso en miniatura, que se utilizan en la construcci√≥n de sistemas √≥pticos. </font><font style="vertical-align: inherit;">Estos ni√±os est√°n disponibles para la venta. </font><font style="vertical-align: inherit;">Pero en la red, especialmente en los de habla rusa, hay muy poca informaci√≥n sobre tales motores. </font><font style="vertical-align: inherit;">Por lo tanto, cuando necesitaba usarlos en mi proyecto, ten√≠a que buscar informaci√≥n y realizar un par de experimentos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Compartir√© los resultados de mis b√∫squedas y experimentos en este art√≠culo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Consideraremos la gesti√≥n de tales motores peque√±os, a saber:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">controlador L293D + microcontrolador ATtiny44;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Controlador TMC2208 + microcontrolador ATtiny44;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">microcontrolador ATtiny44 (sin controlador).</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En realidad, solo el √∫ltimo punto puede causar preguntas aqu√≠. </font><font style="vertical-align: inherit;">Cr√©eme, tambi√©n me sorprendi√≥ cuando me encontr√© con un video clip ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqu√≠ est√°</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), ¬°donde el tipo simplemente levanta y engancha directamente el motor paso a paso a los pines del microcontrolador! </font><font style="vertical-align: inherit;">Pero hablemos de todo en orden.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conocido</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Primero, un peque√±o vistazo a la apariencia de nuestro h√©roe: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/s9/6n/lu/s96nlurhh1cpirq8g8zrtv1t_t0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬°es realmente muy peque√±o! Seg√∫n el libro inteligente Petrenko S.F. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
"Motores piezoel√©ctricos en instrumentaci√≥n", motores electromagn√©ticos m√°s peque√±os, en principio, es imposible de crear ... es decir, es posible, pero con una disminuci√≥n en el di√°metro del cable del que est√°n hechos los devanados, se disipa m√°s y m√°s energ√≠a como calor en el medio ambiente, lo que conduce a una disminuci√≥n en la eficiencia del motor y hace Su uso es irracional. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De lo notable, se puede notar que su eje es muy corto y tiene una ranura especial para instalar el engranaje o la palanca. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dos bobinados son claramente visibles, que incluso est√°n cubiertos con aislamiento de diferentes colores. Entonces, nuestro motor probablemente pertenece a la clase de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">motores paso a paso bipolares</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Veamos c√≥mo funciona: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/5v/ds/2w/5vds2wkt6kjahi0m55emzq5ipmc.jpeg"><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">creo que nuestro conocimiento de estos motores no estar√° completo si no vemos lo que hay dentro de √©l. ¬°Siempre es interesante mirar dentro del mecanismo! ¬øNo es as√≠?</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
En realidad, no vimos nada inusual. El rotor est√° magnetizado. No hay cojinetes en ning√∫n lado, todo est√° en los bujes. El cubo trasero se presiona en la carcasa del motor. El frente no est√° fijado por nada. Curiosamente, el cuerpo del motor se ensambl√≥ mediante soldadura por puntos. Entonces la portada tuvo que ser cortada. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora pasamos al tema de la conexi√≥n y sus caracter√≠sticas el√©ctricas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aseg√∫rate de que sea bipolar tocando los devanados. Realmente bipolar, como en la imagen de arriba. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La resistencia del devanado es de aproximadamente 26 ohmios</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , aunque el vendedor indic√≥ 14 ohmios.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La descripci√≥n dice que el </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">voltaje de alimentaci√≥n es de 5V</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Aunque todos sabemos que para un motor paso a paso, la corriente que consumir√°n sus devanados es importante. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Estamos intentando conectarnos.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Experimento No. 1. </font><font style="vertical-align: inherit;">L293D + ATtiny44</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como sabemos, para controlar un motor paso a paso bipolar, es necesario no solo aplicar voltaje a los dos devanados en la secuencia deseada, sino tambi√©n cambiar la direcci√≥n de la corriente en estos devanados, y hacerlo independientemente uno del otro. Para esto, cada devanado necesita su propio puente H. Para no sacarlo de los transistores, se tom√≥ un chip L293D listo para usar. Otra de sus ventajas: el chip tiene pines especiales Enable1 y Enable2, que activan y desactivan cada puente. Se pueden usar para proporcionar una se√±al PWM, por lo tanto, es posible controlar el voltaje de alimentaci√≥n de cada puente. Por qu√© esto puede ser necesario, veremos m√°s. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Adem√°s, el L293D puede cambiar </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">voltajes de hasta 36V y producir hasta 1.2A por canal</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, que deber√≠a ser suficiente para alimentar los devanados de nuestro motor. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entonces, el diagrama: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ap/eu/sm/apeusmkkhcddqmhrdrmvwkpjbsk.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
las entradas de control L293D est√°n conectadas a las salidas OC0A y OC0B, lo que nos permitir√° enviarles una se√±al PWM en el futuro. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Destellaremos el controlador a trav√©s del programador en circuito (no se muestra en el diagrama). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As√≠ es como se ve el circuito ensamblado en una placa de </font></font><br>
<br>
<img src="https://habrastorage.org/webt/gx/87/jg/gx87jgsrgeuethu-dotn-_a-fsc.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
pruebas </font><font style="vertical-align: inherit;">: </font><font style="vertical-align: inherit;">as√≠ es como se encuentra nuestro </font></font><br>
<br>
<img src="https://habrastorage.org/webt/xr/so/xw/xrsoxwzgqmg1q80dx9dwecpcg68.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
piloto de </font><font style="vertical-align: inherit;">prueba: </font><font style="vertical-align: inherit;">ahora puede comenzar a experimentar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Calculamos la corriente que fluir√° a trav√©s de los devanados del motor cuando est√°n conectados a un voltaje de 5V: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I = U / R = 5V / 26Ohm = 190mA </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Muy peque√±o. Me pregunto cu√°nto tiempo puede aguantar tanta corriente y no sobrecalentarse.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Incluimos un amper√≠metro y un volt√≠metro en el circuito de uno de los devanados, y medimos los valores correspondientes cuando se suministra energ√≠a a este devanado a trav√©s del controlador. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cuando el voltaje cae a trav√©s del devanado de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.56V, el amper√≠metro muestra una corriente de 150 mA</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , y es claramente visible c√≥mo la magnitud de la corriente comienza a caer durante el calentamiento de los devanados. Cabe se√±alar que no hace tanto calor. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despu√©s de asegurarse de que el voltaje de 5 V para el motor no sea peligroso, intente girarlos en diferentes direcciones. Y ahora algunas palabras que diremos sobre los modos de operaci√≥n del motor paso a paso. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esto est√° bastante bien dicho </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqu√≠</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No repetiremos, pero recuerde que un motor paso a paso puede funcionar en tres modos:</font></font><br>
<br>
<ul>
<li>           ,   ,       . </li>
<li>          ,  ,      ,     .</li>
<li>        ,     ,      ,   (   )    . ,  ,          ( , ,   ).   .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Intentemos implementar los primeros dos modos en el chip L293D, y para el modo de micropaso, dejaremos un controlador especial del segundo experimento. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El c√≥digo fuente del programa es el siguiente:</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C√≥digo fuente de WinAVR</font></font></b>
                        <div class="spoiler_text"><pre><code class="cs hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> F_CPU 8000000UL  //    </span><font></font>
<font></font>
<span class="hljs-comment">//    L: E2; H:DF; Ex:FF; </span>
<span class="hljs-comment">//    8         (     8)</span><font></font>
<font></font>
<span class="hljs-meta">#include &lt;avr/io.h&gt; //   </span><font></font>
<font></font>
<span class="hljs-meta">#include &lt;util/delay.h&gt; //   </span><font></font>
<font></font>
<span class="hljs-meta">#include &lt;avr/interrupt.h&gt; //   </span><font></font>
<font></font>
<span class="hljs-comment">//   </span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LED_pin PA5</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LED_ON PORTA |=(1&lt;&lt;LED_pin)</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LED_OFF PORTA &amp;=(~(1&lt;&lt;LED_pin))</span><font></font>
<font></font>
<span class="hljs-comment">//     L293DD</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PWM_1 PB2 // OC0A (EN1)</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PWM_2 PA7 // OC0B (EN2)</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PWM_1_value OCR0A</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PWM_2_value OCR0B</span><font></font>
<font></font>
<span class="hljs-comment">//       L293D</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> IN1 PA0 //  PORTA</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> IN2 PA1</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> IN3 PB1 //  PORTB</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> IN4 PB0</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">delay_microsecond</span> (<span class="hljs-params">unsigned <span class="hljs-keyword">int</span> delay_time</span>)</span> { <span class="hljs-comment">//     </span><font></font>
    <font></font>
	<span class="hljs-comment">//      </span><font></font>
<font></font>
    <span class="hljs-keyword">for</span>(unsigned <span class="hljs-keyword">int</span> delay_us = <span class="hljs-number">0</span>; delay_us&lt;delay_time; delay_us++) {<font></font>
	<font></font>
	    _delay_us(<span class="hljs-number">1</span>);<font></font>
	<font></font>
	}<font></font>
<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">delay_millisecond</span> (<span class="hljs-params">unsigned <span class="hljs-keyword">int</span> delay_time</span>)</span> { <span class="hljs-comment">//     </span><font></font>
<font></font>
    <span class="hljs-keyword">for</span>(unsigned <span class="hljs-keyword">int</span> delay_ms = <span class="hljs-number">0</span>; delay_ms&lt;delay_time; delay_ms++) {<font></font>
	<font></font>
	    _delay_ms(<span class="hljs-number">1</span>);<font></font>
	<font></font>
	}<font></font>
<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//      </span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">step_1_one_phase</span> (<span class="hljs-params"><span class="hljs-keyword">void</span></span>)</span> {<font></font>
<font></font>
    PORTB &amp;=(~((<span class="hljs-number">1</span>&lt;&lt;IN3)|(<span class="hljs-number">1</span>&lt;&lt;IN4)));<font></font>
	<font></font>
	PORTA &amp;=(~(<span class="hljs-number">1</span>&lt;&lt;IN2)); <span class="hljs-comment">//   </span><font></font>
  <font></font>
    PORTA |=(<span class="hljs-number">1</span>&lt;&lt;IN1); <span class="hljs-comment">//    </span><font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">step_2_one_phase</span> (<span class="hljs-params"><span class="hljs-keyword">void</span></span>)</span> {<font></font>
<font></font>
    PORTA &amp;=(~((<span class="hljs-number">1</span>&lt;&lt;IN1)|(<span class="hljs-number">1</span>&lt;&lt;IN2)));<font></font>
	<font></font>
	PORTB &amp;=(~(<span class="hljs-number">1</span>&lt;&lt;IN3));<font></font>
  <font></font>
    PORTB |=(<span class="hljs-number">1</span>&lt;&lt;IN4);<font></font>
  <font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">step_3_one_phase</span> (<span class="hljs-params"><span class="hljs-keyword">void</span></span>)</span> {<font></font>
<font></font>
    PORTB &amp;=(~((<span class="hljs-number">1</span>&lt;&lt;IN3)|(<span class="hljs-number">1</span>&lt;&lt;IN4))); <font></font>
	 <font></font>
	PORTA &amp;=(~(<span class="hljs-number">1</span>&lt;&lt;IN1));<font></font>
  <font></font>
    PORTA |=(<span class="hljs-number">1</span>&lt;&lt;IN2);<font></font>
  <font></font>
	<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">step_4_one_phase</span> (<span class="hljs-params"><span class="hljs-keyword">void</span></span>)</span> {<font></font>
<font></font>
    PORTA &amp;=(~((<span class="hljs-number">1</span>&lt;&lt;IN1)|(<span class="hljs-number">1</span>&lt;&lt;IN2))); <font></font>
	<font></font>
	PORTB &amp;=(~(<span class="hljs-number">1</span>&lt;&lt;IN4));<font></font>
    <font></font>
    PORTB |=(<span class="hljs-number">1</span>&lt;&lt;IN3);<font></font>
  <font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//      </span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">step_1_two_phase</span> (<span class="hljs-params"><span class="hljs-keyword">void</span></span>)</span> {<font></font>
<font></font>
    PORTB |=(<span class="hljs-number">1</span>&lt;&lt;IN4);  <font></font>
  <font></font>
    PORTB &amp;=(~(<span class="hljs-number">1</span>&lt;&lt;IN3));<font></font>
  <font></font>
    PORTA |=(<span class="hljs-number">1</span>&lt;&lt;IN1);<font></font>
  <font></font>
    PORTA &amp;=(~(<span class="hljs-number">1</span>&lt;&lt;IN2));<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">step_2_two_phase</span> (<span class="hljs-params"><span class="hljs-keyword">void</span></span>)</span> {<font></font>
<font></font>
    PORTA &amp;=(~(<span class="hljs-number">1</span>&lt;&lt;IN2));<span class="hljs-comment">//2</span><font></font>
	<font></font>
	PORTA |=(<span class="hljs-number">1</span>&lt;&lt;IN1);<font></font>
  <font></font>
    PORTB |=(<span class="hljs-number">1</span>&lt;&lt;IN3);<font></font>
  <font></font>
    PORTB &amp;=(~(<span class="hljs-number">1</span>&lt;&lt;IN4));<font></font>
  <font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">step_3_two_phase</span> (<span class="hljs-params"><span class="hljs-keyword">void</span></span>)</span> {<font></font>
<font></font>
    PORTB |=(<span class="hljs-number">1</span>&lt;&lt;IN3);<span class="hljs-comment">//3</span><font></font>
  <font></font>
    PORTB &amp;=(~(<span class="hljs-number">1</span>&lt;&lt;IN4));<font></font>
	<font></font>
	PORTA &amp;=(~(<span class="hljs-number">1</span>&lt;&lt;IN1));<font></font>
  <font></font>
    PORTA |=(<span class="hljs-number">1</span>&lt;&lt;IN2);<font></font>
  <font></font>
	<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">step_4_two_phase</span> (<span class="hljs-params"><span class="hljs-keyword">void</span></span>)</span> {<font></font>
<font></font>
    PORTA |=(<span class="hljs-number">1</span>&lt;&lt;IN2);<span class="hljs-comment">//4</span><font></font>
  <font></font>
    PORTA &amp;=(~(<span class="hljs-number">1</span>&lt;&lt;IN1));<font></font>
    <font></font>
    PORTB |=(<span class="hljs-number">1</span>&lt;&lt;IN4);<font></font>
  <font></font>
    PORTB &amp;=(~(<span class="hljs-number">1</span>&lt;&lt;IN3));<font></font>
  <font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">stepper_OFF</span> (<span class="hljs-params"><span class="hljs-keyword">void</span></span>)</span> { <span class="hljs-comment">//   </span><font></font>
<font></font>
	<span class="hljs-comment">//    ,       ,    </span><font></font>
	<font></font>
	PORTA &amp;=(~((<span class="hljs-number">1</span>&lt;&lt;IN1)|(<span class="hljs-number">1</span>&lt;&lt;IN2)));<font></font>
	<font></font>
	PORTB &amp;=(~((<span class="hljs-number">1</span>&lt;&lt;IN3)|(<span class="hljs-number">1</span>&lt;&lt;IN4)));<font></font>
	<font></font>
}<font></font>
<font></font>
unsigned <span class="hljs-keyword">char</span> step_counter = <span class="hljs-number">0</span>; <font></font>
<font></font>
<span class="hljs-comment">//      </span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">L293D_step</span> (<span class="hljs-params">unsigned <span class="hljs-keyword">int</span> step_quantity, unsigned <span class="hljs-keyword">char</span> direction, unsigned <span class="hljs-keyword">int</span> step_delay, unsigned <span class="hljs-keyword">char</span> phase</span>)</span> { <span class="hljs-comment">//      </span><font></font>
<font></font>
    <span class="hljs-keyword">while</span>(step_quantity&gt;<span class="hljs-number">0</span>) { <span class="hljs-comment">//  ,      </span><font></font>
<font></font>
        <span class="hljs-keyword">switch</span>(direction) { <span class="hljs-comment">//           </span><font></font>
	<font></font>
			<span class="hljs-keyword">case</span> <span class="hljs-string">'F'</span>:
				<span class="hljs-keyword">if</span>(step_counter&lt;<span class="hljs-number">3</span>) { step_counter++; } <span class="hljs-keyword">else</span> { step_counter=<span class="hljs-number">0</span>; }
			<span class="hljs-keyword">break</span>;<font></font>
		<font></font>
			<span class="hljs-keyword">case</span> <span class="hljs-string">'B'</span>:
				<span class="hljs-keyword">if</span>(step_counter&gt;<span class="hljs-number">0</span>) { step_counter--; } <span class="hljs-keyword">else</span> { step_counter=<span class="hljs-number">3</span>; }
			<span class="hljs-keyword">break</span>;<font></font>
		<font></font>
		}<font></font>
		<font></font>
		<span class="hljs-keyword">switch</span>(phase) { <span class="hljs-comment">//     </span><font></font>
		<font></font>
		    <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>: <font></font>
			<font></font>
				<span class="hljs-keyword">switch</span>(step_counter) { <span class="hljs-comment">//   </span><font></font>
	<font></font>
					<span class="hljs-keyword">case</span> <span class="hljs-number">0</span>:<font></font>
						step_1_two_phase_DL();<font></font>
					<span class="hljs-keyword">break</span>;<font></font>
		<font></font>
					<span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:<font></font>
						step_2_two_phase_DL();<font></font>
					<span class="hljs-keyword">break</span>;<font></font>
		<font></font>
					<span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:<font></font>
						step_3_two_phase_DL();<font></font>
					<span class="hljs-keyword">break</span>;<font></font>
		<font></font>
					<span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:<font></font>
						step_4_two_phase_DL();<font></font>
					<span class="hljs-keyword">break</span>;<font></font>
	<font></font>
				}<font></font>
			<font></font>
			<span class="hljs-keyword">break</span>;<font></font>
			<font></font>
			<span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:<font></font>
			<font></font>
				<span class="hljs-keyword">switch</span>(step_counter) { <span class="hljs-comment">//   </span><font></font>
	<font></font>
					<span class="hljs-keyword">case</span> <span class="hljs-number">0</span>:<font></font>
						step_1_two_phase_DL();<font></font>
					<span class="hljs-keyword">break</span>;<font></font>
		<font></font>
					<span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:<font></font>
						step_2_two_phase_DL();<font></font>
					<span class="hljs-keyword">break</span>;<font></font>
		<font></font>
					<span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:<font></font>
						step_3_two_phase_DL();<font></font>
					<span class="hljs-keyword">break</span>;<font></font>
		<font></font>
					<span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:<font></font>
						step_4_two_phase_DL();<font></font>
					<span class="hljs-keyword">break</span>;<font></font>
	<font></font>
				}<font></font>
			<font></font>
			<span class="hljs-keyword">break</span>;<font></font>
		<font></font>
		}<font></font>
		<font></font>
    delay_millisecond(step_delay); <span class="hljs-comment">//       </span><font></font>
	<font></font>
	step_quantity--; <font></font>
	<font></font>
	} <font></font>
<font></font>
}<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">PWM_init</span> (<span class="hljs-params"><span class="hljs-keyword">void</span></span>)</span> { <span class="hljs-comment">//   </span><font></font>
<font></font>
    DDRB |=(<span class="hljs-number">1</span>&lt;&lt;PWM_1);<font></font>
<font></font>
    DDRA |=(<span class="hljs-number">1</span>&lt;&lt;PWM_2);<font></font>
<font></font>
    TCCR0A = (<span class="hljs-number">1</span>&lt;&lt;WGM01)|(<span class="hljs-number">1</span>&lt;&lt;WGM00)|(<span class="hljs-number">1</span>&lt;&lt;COM0A1)|(<span class="hljs-number">0</span>&lt;&lt;COM0A0)|(<span class="hljs-number">1</span>&lt;&lt;COM0B1)|(<span class="hljs-number">0</span>&lt;&lt;COM0B0); <span class="hljs-comment">//  FAST PWM,   </span><font></font>
	<font></font>
    TCCR0B = (<span class="hljs-number">0</span>&lt;&lt;WGM02)|(<span class="hljs-number">0</span>&lt;&lt;CS02)|(<span class="hljs-number">0</span>&lt;&lt;CS01)|(<span class="hljs-number">1</span>&lt;&lt;CS00); <span class="hljs-comment">//   8</span><font></font>
	<font></font>
    OCR0A = <span class="hljs-number">255</span>; <span class="hljs-comment">//    (0-255)</span><font></font>
<font></font>
    OCR0B = <span class="hljs-number">255</span>;<font></font>
<font></font>
} <span class="hljs-comment">//    </span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span> (<span class="hljs-params"><span class="hljs-keyword">void</span></span>)</span> { <font></font>
<font></font>
    DDRA |=(<span class="hljs-number">1</span>&lt;&lt;LED_pin);<font></font>
	<font></font>
    DDRA |=(<span class="hljs-number">1</span>&lt;&lt;IN1)|(<span class="hljs-number">1</span>&lt;&lt;IN2);<font></font>
<font></font>
    DDRB |=(<span class="hljs-number">1</span>&lt;&lt;IN3)|(<span class="hljs-number">1</span>&lt;&lt;IN4);<font></font>
	<font></font>
    PWM_init(); <span class="hljs-comment">//  </span><font></font>
	<font></font>
    delay_millisecond(<span class="hljs-number">2000</span>);<font></font>
	<font></font>
    <span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>==<span class="hljs-number">1</span>) { <font></font>
	   <font></font>
	LED_ON;<font></font>
		<font></font>
        L293D_step(<span class="hljs-number">16</span>,<span class="hljs-string">'F'</span>,<span class="hljs-number">100</span>,<span class="hljs-number">2</span>); <span class="hljs-comment">//step( ,  F/B,   , / )</span><font></font>
		<font></font>
	<span class="hljs-comment">//stepper_OFF();</span><font></font>
		<font></font>
	delay_millisecond(<span class="hljs-number">2000</span>);<font></font>
		<font></font>
	LED_OFF;<font></font>
		<font></font>
	L293D_step(<span class="hljs-number">16</span>,<span class="hljs-string">'B'</span>,<span class="hljs-number">100</span>,<span class="hljs-number">2</span>);<font></font>
		<font></font>
	<span class="hljs-comment">//stepper_OFF();</span><font></font>
		<font></font>
	delay_millisecond(<span class="hljs-number">2000</span>);<font></font>
		  <font></font>
    } <font></font>
<font></font>
} </code></pre><br>
</div>
                    </div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Modo paso completo </font><font style="vertical-align: inherit;">Fase √∫nica</font></font></h3><br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/_U7lQKinBe8" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El motor da 16 pasos por revoluci√≥n. </font><font style="vertical-align: inherit;">Adem√°s, los pasos para las dos fases no tienen el mismo valor angular. </font><font style="vertical-align: inherit;">No s√© con qu√© est√° conectado. </font><font style="vertical-align: inherit;">Tal vez el dise√±o del motor es este? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Veamos la frecuencia m√°xima de pasos que puede proporcionar en este modo sin perderlos. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El retraso m√≠nimo entre pasos es de 2 ms, lo que significa 500 pasos / segundo. </font><font style="vertical-align: inherit;">No est√° mal, son 31 rpm = 1850 rpm.</font></font></b><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Modo paso completo </font><font style="vertical-align: inherit;">Dos fases</font></font></h3><br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/AGNc-i35tkI" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tenga en cuenta que en este caso los pasos son m√°s suaves, son del mismo tama√±o (en cualquier caso, m√°s iguales que en el caso anterior). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Naturalmente, en este caso, dos bobinados se energizan simult√°neamente y aumenta la transferencia de calor. </font><font style="vertical-align: inherit;">Despu√©s de unos segundos, el motor se calienta bastante, as√≠ que detuve el experimento. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øQu√© pasa con la frecuencia m√°xima de pasos? </font><font style="vertical-align: inherit;">500 pasos / segundo; </font><font style="vertical-align: inherit;">31 rpm = 1875 rpm. </font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hay que decir que para un motor paso a paso es bastante √°gil. </font><font style="vertical-align: inherit;">Esto se debe al peque√±o n√∫mero de polos magn√©ticos en el rotor. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Continuamos ...</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Experimento n√∫mero 2. </font><font style="vertical-align: inherit;">TMC2208 + ATtiny44</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
TMC2208 es el nombre de un chip controlador para controlar motores paso a paso bipolares, llamado de manera similar un m√≥dulo basado en √©l, que se produce para la instalaci√≥n en impresoras 3D caseras (y no solo) y tiene un dise√±o de pin unificado. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mucho y l√∫cidamente dijo sobre este m√≥dulo </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqu√≠</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se ha escrito mucho en Internet sobre c√≥mo instalarlo en su impresora 3D, pero estamos interesados ‚Äã‚Äãen c√≥mo conectar el m√≥dulo al microcontrolador, as√≠ que comprendamos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Las caracter√≠sticas del chip son impresionantes (solo personas impresionables):</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tensi√≥n de alimentaci√≥n de la parte l√≥gica: 3-5V;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tensi√≥n de alimentaci√≥n del motor 5.5-36V;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">corriente pico 2A;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ajuste de la corriente m√°xima del motor;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Soporte de interfaz UART para gestionar y configurar registros internos;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apagado autom√°tico;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Soporte para el modo de micropasos del control del motor hasta 1/16 de un paso.</font></font></li>
</ul><br>
<img src="https://habrastorage.org/webt/hy/4x/fg/hy4xfgf0clqt-j9hxilghfje85u.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es muy simple de administrar, de hecho, solo necesita dos pines del microcontrolador. </font><font style="vertical-align: inherit;">Uno est√° conectado a DIR - indicamos la direcci√≥n de rotaci√≥n del motor, el otro est√° conectado a STEP - cuando se aplica un pulso, el microcircuito realiza las manipulaciones necesarias con corrientes y voltajes en los devanados del motor y da un paso. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El diagrama de conexi√≥n se ver√° as√≠: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/p6/7m/s1/p67ms10_2wbu6fdbxjmkcz7y5f8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
adem√°s, us√© el pin EN para apagar el motor y durante mucho tiempo para no mantener los devanados energizados.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C√≥digo fuente de WinAVR</font></font></b>
                        <div class="spoiler_text"><pre><code class="cs hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> F_CPU 8000000UL  //    </span><font></font>
<font></font>
<span class="hljs-comment">//    L: E2; H:DF; Ex:FF; </span>
<span class="hljs-comment">//    8         (     8)</span><font></font>
<font></font>
<span class="hljs-meta">#include &lt;avr/io.h&gt; //   </span><font></font>
<font></font>
<span class="hljs-meta">#include &lt;util/delay.h&gt; //   </span><font></font>
<font></font>
<span class="hljs-meta">#include &lt;avr/interrupt.h&gt; //   </span><font></font>
<font></font>
<span class="hljs-comment">//   </span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LED_pin PA5</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LED_ON PORTA |=(1&lt;&lt;LED_pin)</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LED_OFF PORTA &amp;=(~(1&lt;&lt;LED_pin))</span><font></font>
<font></font>
<span class="hljs-comment">//     TMC2208</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> DIR PB2</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> EN PA6</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> STP PA7</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> EN_OFF PORTA |=(1&lt;&lt;EN)</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> EN_ON PORTA &amp;=(~(1&lt;&lt;EN))</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> DIR_FOR PORTB |=(1&lt;&lt;DIR)</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> DIR_BACK PORTB &amp;=(~(1&lt;&lt;DIR))</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> STP_ON PORTA |=(1&lt;&lt;STP)</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> STP_OFF PORTA &amp;=(~(1&lt;&lt;STP))</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">delay_microsecond</span> (<span class="hljs-params">unsigned <span class="hljs-keyword">int</span> delay_time</span>)</span> { <span class="hljs-comment">//     </span><font></font>
    <font></font>
	<span class="hljs-comment">//      </span><font></font>
<font></font>
    <span class="hljs-keyword">for</span>(unsigned <span class="hljs-keyword">int</span> delay_us = <span class="hljs-number">0</span>; delay_us&lt;delay_time; delay_us++) {<font></font>
	<font></font>
	    _delay_us(<span class="hljs-number">1</span>);<font></font>
	<font></font>
	}<font></font>
<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">delay_millisecond</span> (<span class="hljs-params">unsigned <span class="hljs-keyword">int</span> delay_time</span>)</span> { <span class="hljs-comment">//     </span><font></font>
<font></font>
    <span class="hljs-keyword">for</span>(unsigned <span class="hljs-keyword">int</span> delay_ms = <span class="hljs-number">0</span>; delay_ms&lt;delay_time; delay_ms++) {<font></font>
	<font></font>
	    _delay_ms(<span class="hljs-number">1</span>);<font></font>
	<font></font>
	}<font></font>
<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">TMS2208_STEP</span> (<span class="hljs-params">unsigned <span class="hljs-keyword">int</span> step_quantity, unsigned <span class="hljs-keyword">char</span> direction, unsigned <span class="hljs-keyword">int</span> step_delay</span>)</span> {<font></font>
<font></font>
    <span class="hljs-keyword">switch</span>(direction) { <span class="hljs-comment">//  </span><font></font>
	<font></font>
		<span class="hljs-keyword">case</span> <span class="hljs-string">'F'</span>:<font></font>
			DIR_FOR;	<font></font>
		<span class="hljs-keyword">break</span>;<font></font>
		<font></font>
		<span class="hljs-keyword">case</span> <span class="hljs-string">'B'</span>:<font></font>
			DIR_BACK;	<font></font>
		<span class="hljs-keyword">break</span>;<font></font>
		<font></font>
	}<font></font>
<font></font>
    <span class="hljs-keyword">while</span>(step_quantity&gt;<span class="hljs-number">0</span>) { <span class="hljs-comment">//      </span><font></font>
	<font></font>
		STP_ON; <span class="hljs-comment">//   </span><font></font>
		<font></font>
		delay_microsecond(<span class="hljs-number">100</span>); <span class="hljs-comment">//   100</span><font></font>
		<font></font>
		STP_OFF;<font></font>
		<font></font>
		delay_millisecond(step_delay);<span class="hljs-comment">//   </span><font></font>
	<font></font>
	    step_quantity--;<font></font>
	<font></font>
	}<font></font>
<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span> (<span class="hljs-params"><span class="hljs-keyword">void</span></span>)</span> {<font></font>
<font></font>
        DDRA |=(<span class="hljs-number">1</span>&lt;&lt;LED_pin);<font></font>
<font></font>
        DDRB |=(<span class="hljs-number">1</span>&lt;&lt;DIR);<font></font>
<font></font>
        DDRA |=(<span class="hljs-number">1</span>&lt;&lt;EN);<font></font>
<font></font>
        DDRA |=(<span class="hljs-number">1</span>&lt;&lt;STP);<font></font>
	<font></font>
	PWM_init(); <span class="hljs-comment">//  </span><font></font>
	<font></font>
	delay_millisecond(<span class="hljs-number">2000</span>);<font></font>
	<font></font>
	<span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>==<span class="hljs-number">1</span>) { <font></font>
	   <font></font>
	   LED_ON;<font></font>
	   <font></font>
	   EN_ON;<font></font>
	<font></font>
	   TMS2208_STEP(<span class="hljs-number">32</span>,<span class="hljs-string">'F'</span>,<span class="hljs-number">10</span>); <span class="hljs-comment">// TMS2208_STEP ( ,  F/B,   )</span><font></font>
	   <font></font>
	   delay_millisecond(<span class="hljs-number">2000</span>);<font></font>
	   <font></font>
	   LED_OFF;<font></font>
	   <font></font>
	   TMS2208_STEP(<span class="hljs-number">32</span>,<span class="hljs-string">'B'</span>,<span class="hljs-number">10</span>);<font></font>
	   <font></font>
	   delay_millisecond(<span class="hljs-number">2000</span>);<font></font>
	<font></font>
	   <font></font>
	} <font></font>
<font></font>
}  </code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Antes de comenzar todo, debe preconfigurar el m√≥dulo. Primero, configure el modo de micropaso deseado. En segundo lugar, establezca la corriente m√°xima deseada del motor. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Con un microstep, todo es simple. Los pines MS1 y MS2 son responsables de esto. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/mr/vf/ba/mrvfbaqfm3rvb_fkop2w28ybtiw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Observo que el microcircuito no cambia el voltaje paso a paso, pero lo hace "suavemente", pero dado que el microcircuito es digital, la salida no es una se√±al suave, sino una se√±al con un peque√±o paso, seg√∫n la documentaci√≥n, divide cada paso en 256 micro pasos. Esto se hizo para aumentar la suavidad de marcha, reducir el ruido del motor y, en teor√≠a, no deber√≠a permitir que la estructura a la que se atornilla ingrese la resonancia. En resumen, todo para que la impresora 3D sea m√°s silenciosa.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para configurar la corriente del motor es necesario medir el voltaje en el contacto Vref, que se indica en la figura. El valor del voltaje se puede cambiar usando un potenci√≥metro instalado al lado del contacto. El voltaje en el contacto ser√° proporcional a la corriente del motor, y la dependencia tendr√° la siguiente forma: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vref = I * 1.44; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nuestro </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">motor necesita alrededor de 150 mA, porque Vref = 0.216V</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Instalamos ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se entiende que un aumento en la corriente proporciona el microcircuito al aumentar el voltaje a trav√©s del devanado. Por lo tanto, debe asegurarse de que esta tensi√≥n sea suficiente. Pero, creo, 5V deber√≠a ser suficiente para ese peque√±o motor. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Probaremos el funcionamiento del motor con varios modos de microstep y veremos qu√© sucede (la pausa entre microsteps es de 10 ms):</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/smws8Omm5Gk" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Puede notar que los movimientos del motor se han vuelto m√°s suaves (en comparaci√≥n con el experimento anterior), sin embargo, los 16 pasos caracter√≠sticos a√∫n se observan con bastante claridad. </font><font style="vertical-align: inherit;">Bueno ... aparentemente esta es una caracter√≠stica de los </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">motores paso a paso con un rotor de im√°n permanente</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tambi√©n debe tenerse en cuenta que el motor en este modo se calienta casi tanto como en un modo de paso completo con dos fases. </font><font style="vertical-align: inherit;">Es comprensible, los devanados se energizan constantemente, el calor se genera continuamente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Creo que para tales motores, el uso de un controlador de este tipo, y de hecho modos microstep, no es muy recomendable.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Experimento n√∫mero 3. </font><font style="vertical-align: inherit;">ATtiny44 driver</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Volvamos brevemente al primer experimento y recordemos que las entradas EN1 y EN2 del microcircuito del controlador est√°n conectadas a los pines OC0A y OC0B del microcontrolador. Esto significa que podemos enviar all√≠ una se√±al PWM generada usando el temporizador TIMER0 y as√≠ cambiar el voltaje aplicado a los devanados del motor y, en consecuencia, regular la corriente que fluir√° a trav√©s de ellos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seg√∫n la hoja de datos del microcontrolador ATtiny44, la corriente m√°xima que puede proporcionar un pin es de solo 40 mA. Adem√°s, no est√° indicado para qu√© tipo de corriente (pulsante o constante) esta caracter√≠stica. Simplemente est√° all√≠ y es as√≠ ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Debo decir que he estado familiarizado con los microcontroladores ATMEL durante m√°s de 7 a√±os. Y nunca tuve el deseo de revisar esta l√≠nea de la hoja de datos.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/7g/-s/b3/7g-sb3h1t3qbhccp7kyvd0knqge.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quiz√°s el fabricante sea seguro y, de hecho, pueda dar m√°s, o tal vez sea realmente lo m√°ximo que puede dar un pin. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos a averiguar. Pero primero debe averiguar a qu√© corriente m√≠nima generalmente puede girar el motor. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Usando el circuito del primer experimento, ajustamos el valor de la corriente a trav√©s de los devanados igual a 40 mA. Comenzamos en modo de paso completo con dos fases (ya que el par ser√° mayor): </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬°Excelente! </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬°A 40 mA, el motor arranc√≥ con √©xito!</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Tambi√©n se detect√≥ el valor m√≠nimo de la corriente de bobinado necesaria para el funcionamiento estable del motor, y es igual a 30 mA. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por supuesto, el par ser√° mucho m√°s bajo, pero el hecho de que logramos arrancar el motor con un consumo de energ√≠a tan peque√±o es importante para nosotros.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El diagrama de conexi√≥n del motor paso a paso al microcontrolador ser√° el siguiente: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/8z/no/s8/8znos8hnrnwto939rm8yap_znpw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
dado que cada pin del microcontrolador funciona como medio puente (puede cambiar la salida del microcircuito a Vcc o GND), para controlar el motor paso a paso bipolar, necesitamos 4 pines del microcontrolador. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C√≥digo de programa:</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C√≥digo fuente de WinAVR</font></font></b>
                        <div class="spoiler_text"><pre><code class="cs hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> F_CPU 8000000UL  //    </span><font></font>
<font></font>
<span class="hljs-comment">//    L: E2; H:DF; Ex:FF; </span>
<span class="hljs-comment">//    8         (     8)</span><font></font>
<font></font>
<span class="hljs-meta">#include &lt;avr/io.h&gt; //   </span><font></font>
<font></font>
<span class="hljs-meta">#include &lt;util/delay.h&gt; //   </span><font></font>
<font></font>
<span class="hljs-meta">#include &lt;avr/interrupt.h&gt; //   </span><font></font>
<font></font>
<span class="hljs-comment">//   </span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LED_pin PA5</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LED_ON PORTA |=(1&lt;&lt;LED_pin)</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LED_OFF PORTA &amp;=(~(1&lt;&lt;LED_pin))</span><font></font>
<font></font>
<span class="hljs-comment">//     L293DD</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PWM_1 PB2 // OC0A (EN1)</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PWM_2 PA7 // OC0B (EN2)</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PWM_1_value OCR0A</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PWM_2_value OCR0B</span><font></font>
<font></font>
<span class="hljs-comment">//       L293D</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> IN1 PA0 //  PORTA</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> IN2 PA1</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> IN3 PB1 //  PORTB</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> IN4 PB0</span><font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">delay_microsecond</span> (<span class="hljs-params">unsigned <span class="hljs-keyword">int</span> delay_time</span>)</span> { <span class="hljs-comment">//     </span><font></font>
    <font></font>
	<span class="hljs-comment">//      </span><font></font>
<font></font>
    <span class="hljs-keyword">for</span>(unsigned <span class="hljs-keyword">int</span> delay_us = <span class="hljs-number">0</span>; delay_us&lt;delay_time; delay_us++) {<font></font>
	<font></font>
	    _delay_us(<span class="hljs-number">1</span>);<font></font>
	<font></font>
	}<font></font>
<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">delay_millisecond</span> (<span class="hljs-params">unsigned <span class="hljs-keyword">int</span> delay_time</span>)</span> { <span class="hljs-comment">//     </span><font></font>
<font></font>
    <span class="hljs-keyword">for</span>(unsigned <span class="hljs-keyword">int</span> delay_ms = <span class="hljs-number">0</span>; delay_ms&lt;delay_time; delay_ms++) {<font></font>
	<font></font>
	    _delay_ms(<span class="hljs-number">1</span>);<font></font>
	<font></font>
	}<font></font>
<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//        </span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">step_1_two_phase_DL</span> (<span class="hljs-params"><span class="hljs-keyword">void</span></span>)</span> { <span class="hljs-comment">// DL - driver less</span><font></font>
   <font></font>
   <span class="hljs-comment">//  </span>
   OCR0A = <span class="hljs-number">160</span>;<font></font>
   PORTB &amp;=(~(<span class="hljs-number">1</span>&lt;&lt;IN4)); <font></font>
   <font></font>
   <span class="hljs-comment">//  </span>
   OCR0B = <span class="hljs-number">160</span>;<font></font>
   PORTB &amp;=(~(<span class="hljs-number">1</span>&lt;&lt;IN3)); <font></font>
    <font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">step_2_two_phase_DL</span> (<span class="hljs-params"><span class="hljs-keyword">void</span></span>)</span> { <font></font>
   <font></font>
   <span class="hljs-comment">//  </span>
   OCR0A = <span class="hljs-number">160</span>;<font></font>
   PORTB &amp;=(~(<span class="hljs-number">1</span>&lt;&lt;IN4)); <font></font>
   <font></font>
   <span class="hljs-comment">//  </span>
   OCR0B = <span class="hljs-number">95</span>;<font></font>
   PORTB |=(<span class="hljs-number">1</span>&lt;&lt;IN3); <font></font>
    <font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">step_3_two_phase_DL</span> (<span class="hljs-params"><span class="hljs-keyword">void</span></span>)</span> { <font></font>
   <font></font>
   <span class="hljs-comment">//  </span>
   OCR0A = <span class="hljs-number">95</span>;<font></font>
   PORTB |=(<span class="hljs-number">1</span>&lt;&lt;IN4); <font></font>
   <font></font>
   <span class="hljs-comment">//  </span>
   OCR0B = <span class="hljs-number">95</span>;<font></font>
   PORTB |=(<span class="hljs-number">1</span>&lt;&lt;IN3); <font></font>
    <font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">step_4_two_phase_DL</span> (<span class="hljs-params"><span class="hljs-keyword">void</span></span>)</span> { <font></font>
   <font></font>
   <span class="hljs-comment">//  </span>
   OCR0A = <span class="hljs-number">95</span>;<font></font>
   PORTB |=(<span class="hljs-number">1</span>&lt;&lt;IN4); <font></font>
   <font></font>
   <span class="hljs-comment">//  </span>
   OCR0B = <span class="hljs-number">160</span>;<font></font>
   PORTB &amp;=(~(<span class="hljs-number">1</span>&lt;&lt;IN3)); <font></font>
    <font></font>
}<font></font>
<font></font>
unsigned <span class="hljs-keyword">char</span> step_counter = <span class="hljs-number">0</span>; <font></font>
<font></font>
<span class="hljs-comment">//      </span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">L293D_step</span> (<span class="hljs-params">unsigned <span class="hljs-keyword">int</span> step_quantity, unsigned <span class="hljs-keyword">char</span> direction, unsigned <span class="hljs-keyword">int</span> step_delay, unsigned <span class="hljs-keyword">char</span> phase</span>)</span> { <span class="hljs-comment">//      </span><font></font>
<font></font>
    <span class="hljs-keyword">while</span>(step_quantity&gt;<span class="hljs-number">0</span>) { <span class="hljs-comment">//  ,      </span><font></font>
<font></font>
        <span class="hljs-keyword">switch</span>(direction) { <span class="hljs-comment">//           </span><font></font>
	<font></font>
			<span class="hljs-keyword">case</span> <span class="hljs-string">'F'</span>:
				<span class="hljs-keyword">if</span>(step_counter&lt;<span class="hljs-number">3</span>) { step_counter++; } <span class="hljs-keyword">else</span> { step_counter=<span class="hljs-number">0</span>; }
			<span class="hljs-keyword">break</span>;<font></font>
		<font></font>
			<span class="hljs-keyword">case</span> <span class="hljs-string">'B'</span>:
				<span class="hljs-keyword">if</span>(step_counter&gt;<span class="hljs-number">0</span>) { step_counter--; } <span class="hljs-keyword">else</span> { step_counter=<span class="hljs-number">3</span>; }
			<span class="hljs-keyword">break</span>;<font></font>
		<font></font>
		}<font></font>
		<font></font>
		<span class="hljs-keyword">switch</span>(phase) { <span class="hljs-comment">//     </span><font></font>
		<font></font>
		    <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>: <font></font>
			<font></font>
				<span class="hljs-keyword">switch</span>(step_counter) { <span class="hljs-comment">//   </span><font></font>
	<font></font>
					<span class="hljs-keyword">case</span> <span class="hljs-number">0</span>:<font></font>
						step_1_two_phase_DL();<font></font>
					<span class="hljs-keyword">break</span>;<font></font>
		<font></font>
					<span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:<font></font>
						step_2_two_phase_DL();<font></font>
					<span class="hljs-keyword">break</span>;<font></font>
		<font></font>
					<span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:<font></font>
						step_3_two_phase_DL();<font></font>
					<span class="hljs-keyword">break</span>;<font></font>
		<font></font>
					<span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:<font></font>
						step_4_two_phase_DL();<font></font>
					<span class="hljs-keyword">break</span>;<font></font>
	<font></font>
				}<font></font>
			<font></font>
			<span class="hljs-keyword">break</span>;<font></font>
			<font></font>
			<span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:<font></font>
			<font></font>
				<span class="hljs-keyword">switch</span>(step_counter) { <span class="hljs-comment">//   </span><font></font>
	<font></font>
					<span class="hljs-keyword">case</span> <span class="hljs-number">0</span>:<font></font>
						step_1_two_phase_DL();<font></font>
					<span class="hljs-keyword">break</span>;<font></font>
		<font></font>
					<span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:<font></font>
						step_2_two_phase_DL();<font></font>
					<span class="hljs-keyword">break</span>;<font></font>
		<font></font>
					<span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:<font></font>
						step_3_two_phase_DL();<font></font>
					<span class="hljs-keyword">break</span>;<font></font>
		<font></font>
					<span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:<font></font>
						step_4_two_phase_DL();<font></font>
					<span class="hljs-keyword">break</span>;<font></font>
	<font></font>
				}<font></font>
			<font></font>
			<span class="hljs-keyword">break</span>;<font></font>
		<font></font>
		}<font></font>
		<font></font>
    delay_millisecond(step_delay); <span class="hljs-comment">//       </span><font></font>
	<font></font>
	step_quantity--; <font></font>
	<font></font>
	} <font></font>
<font></font>
}<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">PWM_init</span> (<span class="hljs-params"><span class="hljs-keyword">void</span></span>)</span> { <span class="hljs-comment">//   </span><font></font>
<font></font>
    DDRB |=(<span class="hljs-number">1</span>&lt;&lt;PWM_1); <font></font>
	<font></font>
    DDRA |=(<span class="hljs-number">1</span>&lt;&lt;PWM_2);<font></font>
<font></font>
    TCCR0A = (<span class="hljs-number">1</span>&lt;&lt;WGM01)|(<span class="hljs-number">1</span>&lt;&lt;WGM00)|(<span class="hljs-number">1</span>&lt;&lt;COM0A1)|(<span class="hljs-number">0</span>&lt;&lt;COM0A0)|(<span class="hljs-number">1</span>&lt;&lt;COM0B1)|(<span class="hljs-number">0</span>&lt;&lt;COM0B0); <span class="hljs-comment">//  FAST PWM,   </span><font></font>
	<font></font>
    TCCR0B = (<span class="hljs-number">0</span>&lt;&lt;WGM02)|(<span class="hljs-number">0</span>&lt;&lt;CS02)|(<span class="hljs-number">0</span>&lt;&lt;CS01)|(<span class="hljs-number">1</span>&lt;&lt;CS00); <span class="hljs-comment">//   8</span><font></font>
	<font></font>
    OCR0A = <span class="hljs-number">160</span>; <font></font>
	<font></font>
    OCR0B = <span class="hljs-number">160</span>;<font></font>
<font></font>
} <span class="hljs-comment">//    </span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span> (<span class="hljs-params"><span class="hljs-keyword">void</span></span>)</span> { <span class="hljs-comment">//  </span><font></font>
<font></font>
    DDRA |=(<span class="hljs-number">1</span>&lt;&lt;LED_pin);<font></font>
	<font></font>
	DDRA |=(<span class="hljs-number">1</span>&lt;&lt;IN1)|(<span class="hljs-number">1</span>&lt;&lt;IN2);<font></font>
	<font></font>
	DDRB |=(<span class="hljs-number">1</span>&lt;&lt;IN3)|(<span class="hljs-number">1</span>&lt;&lt;IN4);<font></font>
	<font></font>
	PWM_init(); <span class="hljs-comment">//  </span><font></font>
	<font></font>
	delay_millisecond(<span class="hljs-number">2000</span>);<font></font>
	<font></font>
	<span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>==<span class="hljs-number">1</span>) { <span class="hljs-comment">//  </span><font></font>
<font></font>
	    LED_ON;<font></font>
		<font></font>
	    L293D_step(<span class="hljs-number">16</span>,<span class="hljs-string">'F'</span>,<span class="hljs-number">100</span>,<span class="hljs-number">2</span>); <span class="hljs-comment">//step( ,  F/B,   , / )</span><font></font>
		<font></font>
            delay_millisecond(<span class="hljs-number">2000</span>);<font></font>
		<font></font>
	    LED_OFF;<font></font>
		<font></font>
	    L293D_step(<span class="hljs-number">16</span>,<span class="hljs-string">'B'</span>,<span class="hljs-number">100</span>,<span class="hljs-number">2</span>);<font></font>
		<font></font>
	    delay_millisecond(<span class="hljs-number">2000</span>);<font></font>
		<font></font>
	<font></font>
	   <font></font>
	} <font></font>
<font></font>
} </code></pre><br>
</div>
                    </div> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
D√©jame explicarte un poco c√≥mo funciona este programa. Este es un c√≥digo modificado del primer experimento. Como dije anteriormente, se usar√° un TIMER0 de 8 bits para generar una se√±al PWM en las salidas OC0A y OC0B. El temporizador est√° configurado en modo FastPWM con un preescalador de 8 (la frecuencia de se√±al a 8 MHz del reloj del microcontrolador es 3906 Hz). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para cambiar la polaridad de las se√±ales en los devanados, el pin del microcontrolador se cambia de Vcc a GND cambiando el bit correspondiente en el registro PORTx y cambiando el ciclo de trabajo PWM escribiendo valores en los registros OCR0A y OCR0B (los valores se seleccionaron experimentalmente). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y entonces:</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/yvaAGt1vhxs" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un curso de circuito realizado en el primer a√±o del instituto sugiere que el mult√≠metro muestra el valor eficaz de la tensi√≥n y la corriente en el motor. </font></font></i><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬°El motor paso a paso gira desde los pines del microcontrolador sin controladores! </font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pero aqu√≠ no vamos m√°s all√° de las capacidades del microcontrolador, al menos, de acuerdo con lo que est√° escrito en la documentaci√≥n. </font><font style="vertical-align: inherit;">En este modo, el microcontrolador y el motor pueden funcionar durante mucho tiempo. </font><font style="vertical-align: inherit;">De hecho, el experimento dur√≥ 20 minutos. </font><font style="vertical-align: inherit;">Durante este tiempo, no hubo pasos de omisi√≥n, ni reinicio del controlador ni sobrecalentamiento (ni el motor ni el controlador).</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Deja de lado todas las precauciones</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eliminamos el PWM del experimento y controlaremos directamente los pines del microcontrolador utilizando los registros PORTx. </font><font style="vertical-align: inherit;">Veamos qu√© pasa con el microcontrolador despu√©s de eso. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Funciona ... con una corriente m√°xima de 51 mA ... Bueno ... inesperadamente, parece que esta es la corriente limitante que puede dar un pin del microcontrolador. </font><font style="vertical-align: inherit;">Si me equivoco, corr√≠geme. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En cualquier caso, el video de YouTube no fue enga√±ado. </font><font style="vertical-align: inherit;">De hecho, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">puede controlar este motor sin ning√∫n controlador</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">recomendaciones</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Estudiamos en detalle los motores paso a paso bipolares en miniatura, su dise√±o y c√≥mo controlarlos, para usar en nuestras propias aplicaciones. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1. El motor paso a paso bipolar en miniatura con un rotor de im√°n permanente es realmente en miniatura. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sus caracter√≠sticas principales:</font></font><br>
<br>
<ul>
<li>   ,  ,    ( , ,  16);</li>
<li>    (   ),     1875 /;</li>
<li>     (    );</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2. El motor paso a paso en miniatura puede ser controlado por cualquier controlador adecuado para trabajar con motores paso a paso bipolares, solo necesita seleccionar los par√°metros de corriente del devanado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3. El uso de un controlador especializado TMC2208 es un tema controvertido, ya que el motor no admite los micropasos, aunque las transiciones entre los pasos se realizan de manera m√°s fluida. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4. Es posible conectar un motor paso a paso directamente a los puertos del microcontrolador. </font><font style="vertical-align: inherit;">Pero esto es solo dentro del marco del experimento, ya que el par en este caso es muy insignificante, e incluso una corriente peque√±a no permite que se tomen medidas a alta velocidad. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La pr√≥xima vez te dir√© por qu√© necesit√°bamos motores paso a paso tan peque√±os.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es498762/index.html">¬øLas falsificaciones son tontas o serias?</a></li>
<li><a href="../es498766/index.html">Las mejores comedias de TI. Top 3 programas de televisi√≥n</a></li>
<li><a href="../es498768/index.html">Uso de un detector de humo en veh√≠culos.</a></li>
<li><a href="../es498770/index.html">C√≥mo trabaj√© para el equipo Agile de Microsoft en 1998, cuando el t√©rmino Agile solo intentaba aparecer</a></li>
<li><a href="../es498782/index.html">Experimentadores de batalla - Sand and Stick Science - Inoculaci√≥n del pensamiento cient√≠fico en la mente p√∫blica</a></li>
<li><a href="../es498796/index.html">Pol√≠tica de seguridad de contenido en Magento 2</a></li>
<li><a href="../es498798/index.html">Sigue aprendiendo y aprendiendo con JetBrains</a></li>
<li><a href="../es498800/index.html">C√≥mo le ense√±√© a mi computadora a jugar Dobble con OpenCV y Deep Learning</a></li>
<li><a href="../es498808/index.html">Vim con soporte YAML para Kubernetes</a></li>
<li><a href="../es498814/index.html">Fallaste una pregunta te√≥rica sobre la Seguridad Social, y te pusieron fin. ¬øEsto es normal? // Estamos condenados # 3</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>