<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤑 👩🏼‍🔬 🔁 5人の学生と3つの分散Key-Valueストア 🕝 👩🏻‍⚖️ 💅🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="または、ZooKeeper、etcd、およびConsul KVのクライアントC ++ライブラリを作成したとき
 、クラスタの構成に関する情報を格納するノードの構成を管理する、失敗したノードを検出し、リーダーを選ぶ、：分散システムの世界では、一般的なタスクの数があり、他は。これらの問題を解決するために...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>5人の学生と3つの分散Key-Valueストア</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/458832/"><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">または、ZooKeeper、etcd、およびConsul KVのクライアントC ++ライブラリを作成したとき</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
、クラスタの構成に関する情報を格納するノードの構成を管理する、失敗したノードを検出し、リーダーを選ぶ、：分散システムの世界では、一般的なタスクの数があり</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、他は</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。これらの問題を解決するために、特別な分散システム、つまり調整サービスが作成されました。次に、そのうちの3つ、ZooKeeper、etcd、およびConsulに注目します。 Consulのすべての豊富な機能のうち、Consul KVに焦点を当てます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/j2/ut/gh/j2utghbsb8egpxnz1ct4k3dqtbk.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実際、これらのシステムはすべて、フォールトトレラントな線形化されたKey-Valueストアです。</font><font style="vertical-align: inherit;">これらのデータモデルには大きな違いがありますが、これについては後で説明しますが、同じ実用的な問題を解決することができます。</font><font style="vertical-align: inherit;">明らかに、調整サービスを使用する各アプリケーションはそれらの1つに関連付けられているため、異なるアプリケーションの1つのデータセンターで同じタスクを解決する複数のシステムをサポートする必要が生じる可能性があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この問題を解決するために設計されたアイデアは、オーストラリアのコンサルティング代理店で生まれました。私たち学生の小さなチームが、それを実装する必要がありました。これについてお話しします。</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ZooKeeper、etcd、およびConsul KVを操作するための共通インターフェースを提供するライブラリを作成することができました。</font><font style="vertical-align: inherit;">ライブラリはC ++で書かれていますが、他の言語への移植の計画があります。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データモデル</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3つの異なるシステムに共通のインターフェースを開発するには、それらの共通点とそれらの違いを理解する必要があります。</font><font style="vertical-align: inherit;">それを正しくしましょう。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">飼育係</font></font></b><br>
<br>
<img src="https://habrastorage.org/webt/dv/7g/bu/dv7gbu5u-rvvg91d7qukhgfs1xg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
キーはツリーに編成され、ノード（znode）と呼ばれます。したがって、ノードについては、その子のリストを取得できます。 znodeの作成（create）と値の変更（setData）の操作は別です。既存のキーだけが値を読み取って変更できます。監視は、ノードの存在の確認、値の読み取り、および子の取得の操作にアタッチできます。 Watchは、サーバー上の対応するデータのバージョンが変更されたときに起動する1回限りのトリガーです。エフェメラルノードは、障害の検出に使用されます。それらは、それらを作成したクライアントのセッションに添付されます。クライアントがセッションを閉じるか、その存在についてZooKeeperに通知を停止すると、これらのノードは自動的に削除されます。単純なトランザクションがサポートされています-少なくとも1つの操作が不可能な場合に、すべて成功または失敗する一連の操作。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">etcd</font></font></b><br>
<br>
<img src="https://habrastorage.org/webt/at/hg/me/athgmezjwbafkvetueuq7ytewdc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
このシステムの開発者は明らかにZooKeeperに触発されたため、すべてが異なる方法で行われました。キー階層はここにはありませんが、辞書順に並べられたセットを形成します。特定の範囲に属するすべてのキーを取得または削除できます。このような構造は奇妙に思えるかもしれませんが、実際には非常に表現力があり、それを介した階層ビューは簡単にエミュレートされます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
etcdには標準の比較および設定操作はありませんが、トランザクションというより優れたものがあります。もちろん、これらは3つのシステムすべてにありますが、etcdトランザクションは特に優れています。これらは、チェック、成功、失敗の3つのブロックで構成されています。最初のブロックには一連の条件、2番目と3番目の操作が含まれています。トランザクションはアトミックに実行されます。すべての条件が真の場合、成功ブロックが実行されます。それ以外の場合、失敗します。 API 3.3では、成功ブロックと失敗ブロックにネストされたトランザクションを含めることができます。つまり、ほぼ任意のレベルのネストの条件付き構成をアトミックに実行することが可能です。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ドキュメント</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">から、存在するチェックと操作について詳しく知ることができ</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ます</font></a><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
時計もここにありますが、少し複雑で再利用できます。つまり、一連のキーに時計をインストールした後、最初の時計だけでなく、時計をキャンセルするまで、この範囲のすべてのアップデートを受け取ります。 etcdでは、リースはZooKeeperクライアントセッションと同等です。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">KV領事</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
厳密な階層構造もありませんが、Consulはそれが存在するように見せることができます。つまり、指定したプレフィックスを持つすべてのキーを受信して​​削除できます。つまり、キーの「サブツリー」を操作できます。このようなクエリは再帰的と呼ばれます。さらに、Consulは、接頭辞の後に指定された文字を含まないキーのみを選択できます。これは、即時の「子」の受信に対応します。ただし、これはまさに階層構造の外観であることに注意してください。親が存在しない場合はキーを作成したり、子を持つキーを削除したりできますが、子は引き続きシステムに保存されます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/qq/mb/8t/qqmb8tupgbnod_6jm6andrhelrs.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Consulのウォッチの代わりに、ブロッキングHTTPリクエストがあります。</font><font style="vertical-align: inherit;">本質的に、これらはデータ読み取りメソッドへの通常の呼び出しであり、他のパラメーターと共に、データの最新の既知のバージョンが示されます。</font><font style="vertical-align: inherit;">サーバー上の対応するデータの現在のバージョンが指定されたバージョンより大きい場合、応答はすぐに返され、それ以外の場合は、値が変更されます。</font><font style="vertical-align: inherit;">ここには、いつでもキーに接続できるセッションがあります。</font><font style="vertical-align: inherit;">セッションを削除すると関連するキーが削除されるようなetcdやZooKeeperとは異なり、セッションを単純にそれらから切り離すモードがあることに注意してください。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">トランザクション</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は</font><font style="vertical-align: inherit;">、分岐なしで</font><font style="vertical-align: inherit;">利用できます</font><font style="vertical-align: inherit;">が、あらゆる種類のチェックがあります。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">すべてをまとめる</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最も厳密なデータモデルにはZooKeeperがあります。</font><font style="vertical-align: inherit;">etcdで利用できる表現範囲リクエストは、ZooKeeperでもConsulでも効率的にエミュレートできません。</font><font style="vertical-align: inherit;">すべてのサービスの最高のものを吸収しようとすると、ZooKeeperインターフェースとほぼ同等のインターフェースが得られますが、以下の重要な例外があります。</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">シーケンス、コンテナ、TTLノードは</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サポートされ</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">て</font></a><font style="vertical-align: inherit;">いません</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ACLはサポートされていません</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">キーが存在しない場合、setメソッドはキーを作成します（ZKでは、この場合、setDataはエラーを返します）。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">setメソッドとcasメソッドは別々です（ZKでは、これらは基本的に同じものです）</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">eraseメソッドはサブツリーとともに頂点を削除します（ZKでは、頂点に子がある場合、deleteはエラーを返します）</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">各キーにはバージョンが1つだけあります-値のバージョン（ZK </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">には3つあります</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
順次ノードの拒否は、etcdおよびConsulにはそれらの組み込みサポートがなく、結果として得られるライブラリインターフェースに加えて、ユーザーが簡単に実装できるという事実が原因です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最上位のZooKeeperを削除するときの同じ動作の実装では、各キーについて個別の子カウンターをetcdとConsulで維持する必要があります。</font><font style="vertical-align: inherit;">メタ情報を保存しないようにしたため、サブツリー全体を削除することにしました。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">実装の微妙さ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
異なるシステムでのライブラリインターフェースの実装のいくつかの側面をより詳細に検討してみましょう。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">etcdでの階層etcd</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
で階層ビューを維持することは、最も興味深いタスクの1つであることが証明されています。範囲リクエストを使用すると、指定した接頭辞を持つキーのリストを簡単に取得できます。たとえば、で始まるすべてが必要な場合は</font></font><code>"/foo"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、範囲をリクエストします</font></font><code>["/foo", "/fop")</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。しかし、これはキーのサブツリー全体を返すため、サブツリーが大きい場合は受け入れられない可能性があります。最初は、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zetcdに実装されて</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">いるキー変換メカニズムを使用する予定</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">でした</font></a><font style="vertical-align: inherit;">。これには、ツリーのノードの深さに等しい、キーの先頭に1バイトを追加することが含まれます。例を挙げましょう。</font></font><br>
<br>
<pre><code class="plaintext hljs">"/foo" -&gt; "\u01/foo"<font></font>
"/foo/bar" -&gt; "\u02/foo/bar"</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に</font></font><code>"/foo"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、範囲を要求すること</font><font style="vertical-align: inherit;">で、キーの直接の子をすべて取得でき</font><font style="vertical-align: inherit;">ます</font></font><code>["\u02/foo/", "\u02/foo0")</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">はい、ASCII </font></font><code>"0"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ではの直後</font></font><code>"/"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、どのようにして、頂点を削除するには？</font></font><code>["\uXX/foo/", "\uXX/foo0")</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XXの</font><font style="vertical-align: inherit;">ビュー範囲</font><font style="vertical-align: inherit;">を01からFF </font><font style="vertical-align: inherit;">まですべて削除する必要があることが</font><font style="vertical-align: inherit;">わかりました。</font><font style="vertical-align: inherit;">そして</font><font style="vertical-align: inherit;">、単一のトランザクション内</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の操作数の制限に</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">遭遇しました</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その結果、シンプルなキー変換システムが発明され、キーの削除と子のリストの受け取りの両方を効果的に実装することができました。</font><font style="vertical-align: inherit;">最後のトークンの前に特別な記号を追加するだけで十分です。</font><font style="vertical-align: inherit;">例えば：</font></font><br>
<br>
<pre><code class="plaintext hljs">"/very" -&gt; "/\u00very"<font></font>
"/very/long" -&gt; "/very/\u00long"<font></font>
"/very/long/path" -&gt; "/very/long/\u00path"</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、キーを</font></font><code>"/very"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">削除すると、</font></font><code>"/\u00very"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">範囲が</font><font style="vertical-align: inherit;">削除され、</font></font><code>["/very/", "/very0")</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">すべての子が範囲からのキーを要求するようになります</font></font><code>["/very/\u00", "/very/\u01")</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ZooKeeperでキーを削除する</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すでに述べたように、ZooKeeperでは、子ノードがある場合、ノードを削除できません。サブツリーとともにキーを削除します。になる方法私たちは楽観的にやっています。まず、サブツリーを再帰的に走査し、各頂点の子を個別のクエリで取得します。次に、サブツリーのすべてのノードを正しい順序で削除しようとするトランザクションを作成します。もちろん、サブツリーの読み取りと削除の間で変更が発生する可能性があります。この場合、トランザクションは失敗します。さらに、サブツリーは読み取りプロセス中に変更される可能性があります。たとえば、この頂点がすでに削除されている場合、次のノードの子に対するクエリはエラーを返すことがあります。どちらの場合も、プロセス全体を繰り返します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このアプローチでは、子が存在する場合、キーの削除は非常に効率が悪くなります。さらに、アプリケーションがサブツリーを操作し続けると、キーの削除と作成がさらに非効率になります。ただし、これにより、etcdおよびConsulでの他のメソッドの実装を複雑にする必要がなくなりました。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ZooKeeperに設定ZooKeeperに</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
は、ツリー構造（create、delete、getChildren）を操作するメソッドとノードのデータ（setData、getData）を操作するメソッドが別々にあります。すべてのメソッドには厳密な前提条件があります。ノードがすでに作成されている場合、createはエラーを返します、削除、またはsetData-まだ存在しない場合。キーを意識せずに呼び出すことができるsetメソッドが必要でした。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1つのオプションは、削除時のように、楽観的なアプローチを適用することです。ノードが存在するか確認してください。存在する場合はsetDataを呼び出し、存在しない場合は作成します。最後のメソッドがエラーを返した場合は、もう一度繰り返します。最初に注目する価値があるのは、存在を確認する意味がないことです。すぐにcreateを呼び出すことができます。正常に完了すると、ノードが存在せず、作成されたことを意味します。それ以外の場合、createは対応するエラーを返します。その後、setDataを呼び出す必要があります。もちろん、呼び出しの合間に、頂点は競合する呼び出しによって削除でき、setDataもエラーを返します。この場合、それをもう一度繰り返すことができますが、それだけの価値がありますか？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
両方のメソッドがエラーを返した場合、競合する削除があったことが確実にわかります。</font><font style="vertical-align: inherit;">この削除がsetを呼び出した後に発生したと想像してください。</font><font style="vertical-align: inherit;">そうすれば、どんな値を設定しようとしても、すでに消去されます。</font><font style="vertical-align: inherit;">したがって、実際には何も書かれていなくても、セットは成功したと想定できます。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">より技術的な詳細</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このセクションでは、分散システムから脱却し、コーディングについて説明します。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
顧客の主な要件の1つはクロスプラットフォームでした。Linux、MacOS、Windowsでは、少なくとも1つのサービスをサポートする必要があります。最初はLinuxでのみ開発を行い、他のシステムでは後でテストを開始しました。これは多くの問題を引き起こしましたが、しばらくの間、どのように対処するかが完全に不明確でした。その結果、現在、3つの調整サービスはすべてLinuxおよびMacOSでサポートされており、WindowsではConsul KVのみがサポートされています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
当初から、既成のライブラリを使用してサービスにアクセスしようとしました。 ZooKeeperの場合、</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ZooKeeper C ++を</font></a><font style="vertical-align: inherit;">選択しました。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、これは最終的にはWindowsでコンパイルできませんでした。ただし、これは驚くべきことではありません。ライブラリはLinux専用として配置されています。 Consulの場合、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ppconsul</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が唯一のオプション</font><font style="vertical-align: inherit;">でした。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">セッション</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">トランザクションの</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サポートを追加する必要があり</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">まし</font></a><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">た</font></a><font style="vertical-align: inherit;">。 etcdについては、プロトコルの最新バージョンをサポートする本格的なライブラリが見つからなかったため</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、grpcクライアントを生成しました</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ZooKeeper C ++ライブラリの非同期インターフェースに触発されて、非同期インターフェースも実装することにしました。 ZooKeeper C ++はこのためにfuture / promiseプリミティブを使用します。 STLでは、残念ながら、それらは非常に控えめに実装されています。たとえば、</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">thenメソッド</font></a><font style="vertical-align: inherit;">はありません</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、渡された関数が利用可能になったときに将来の結果に適用します。私たちの場合、結果をライブラリの形式に変換するには、このようなメソッドが必要です。この問題を回避するには、単純なスレッドプールを実装する必要がありました。これは、顧客の要求により、Boostなどの重いサードパーティライブラリを使用できなかったためです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
thenの実装は次のように機能します。呼び出されると、追加のpromise / futureペアが作成されます。新しいフューチャーが返され、転送されたフューチャーが、対応する関数と追加のプロミスとともにキューに入れられます。プールのスレッドは、キューからいくつかのフューチャーを選択し、wait_forを使用してそれらをポーリングします。結果が利用可能になると、対応する関数が呼び出され、その戻り値がpromiseに渡されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
同じスレッドプールを使用して、etcdおよびConsulへのリクエストを実行しました。</font><font style="vertical-align: inherit;">これは、いくつかの異なるスレッドが基礎となるライブラリで動作できることを意味します。</font><font style="vertical-align: inherit;">ppconsulはスレッドセーフではないため、アクセスはロックによって保護されます。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
複数のスレッドからgrpcを操作できますが、微妙な点があります。</font><font style="vertical-align: inherit;">Etcdウォッチはgrpcストリームを通じて実装されます。</font><font style="vertical-align: inherit;">これらは、特定のタイプのメッセージ用の双方向チャネルです。</font><font style="vertical-align: inherit;">ライブラリは、すべてのウォッチ用の単一のストリームと、着信メッセージを処理する単一のストリームを作成します。</font><font style="vertical-align: inherit;">そのため、grpcはストリーミングする並行録音を禁止しています。</font><font style="vertical-align: inherit;">つまり、ウォッチを初期化または削除する場合、前のリクエストの送信が完了するまで待ってから次のリクエストを送信する必要があります。</font><font style="vertical-align: inherit;">同期には</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">条件変数</font></a><font style="vertical-align: inherit;">を使用し</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">合計</font></font></h3><br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">liboffkv</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
をご</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">確認ください</font></a><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちのチーム：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ラエドロマノフ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">イワンGlushenkov</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ドミトリーKamaldinov</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ビクターKrapivensky</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ヴィタリーIvanin</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja458818/index.html">著名な同時代人</a></li>
<li><a href="../ja458820/index.html">Minecraftプラットフォームでの有名なジャンルの実装について</a></li>
<li><a href="../ja458826/index.html">オーガニックで急激に成長するように古い記事を取り除く方法：+ 6か月間のトラフィックの104％</a></li>
<li><a href="../ja458828/index.html">ValueTaskを使用する理由、理由、および時期</a></li>
<li><a href="../ja458830/index.html">デルのテクノロジーウェビナー：チュートリアルのすべての詳細</a></li>
<li><a href="../ja458834/index.html">ポール・アレンの人格の側面、それについて私が望むほど多くの人々は知りませんでした</a></li>
<li><a href="../ja458836/index.html">ボルシュ指数。価格/品質比を評価、比較、決定するための体系的なアプローチ</a></li>
<li><a href="../ja458840/index.html">Great Chinese Firewallをどのように貫通したか（パート2）</a></li>
<li><a href="../ja458842/index.html">忍耐と労働はテキスト全体を抽出します</a></li>
<li><a href="../ja458844/index.html">VeriSM™アプローチの適応によるサイロ破壊</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>