<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👆 🙇🏾 🏝️ ペンテストに一度、または泌尿器科医とRoskomnadzorの助けを借りてすべてを壊す方法 👔 📳 🍘</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="この記事は、数年前にGroup-IBスペシャリストによって実施された非常に成功したペンテストに基づいています。ボリウッドでの映画の改作であると主張する物語が起こりました。おそらく、読者の反応は次のようになります。「ああ、別のPR記事、これもまた描かれています。どれほど優れているか、ペンテストを購入す...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>ペンテストに一度、または泌尿器科医とRoskomnadzorの助けを借りてすべてを壊す方法</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/group-ib/blog/496712/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/vn/0a/bo/vn0abo7bxrqzjjq0vgophwwr3rm.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この記事は、数年前にGroup-IBスペシャリストによって実施された非常に成功したペンテストに基づいています。ボリウッドでの映画の改作であると主張する物語が起こりました。おそらく、読者の反応は次のようになります。「ああ、別のPR記事、これもまた描かれています。どれほど優れているか、ペンテストを購入することを忘れないでください。」まあ、一方ではそうです。ただし、この記事が表示された理由はいくつかあります。ペンテスターが正確に何をするのか、この作業がどれほど面白くて重要な作業になるのか、プロジェクトで面白い状況が発生する可能性があること、そして最も重要なのは実際の例を使ってライブ資料を表示することです。</font></font><a name="habracut"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
世界の謙虚さのバランスを取り戻すために、しばらくして行かなかったペンテストについて書きます。</font><font style="vertical-align: inherit;">これらのプロセスが存在し、実際に機能しているという理由だけで、企業で確立されたプロセスが、広範囲の攻撃から保護されていることを示します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちの感情によれば、この記事の顧客も、すべてロシア連邦の市場の95％を上回っており、全体的に問題はありませんでしたが、長い一連のイベントを形成するいくつかの小さなニュアンスがあり、最初に作業に関する長いレポートにつながりました、そしてこの記事へ。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それで、ポップコーンを買い足して、探偵へようこそ。</font><font style="vertical-align: inherit;">私</font><font style="vertical-align: inherit;">は、Audit and Consulting Group-IBのテクニカルディレクターである</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pavel Suprunyukに発言し</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パート1.ポチキンドクター </font></font><br>
</h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2018年。顧客がいます-それ自体が多くの顧客にサービスを提供しているハイテクIT企業です。彼は質問への回答を得たいと思っています。インターネットを介して作業していて、初期の知識とアクセスがなければ、Active Directoryドメインの管理者権限を取得することは可能ですか？ソーシャルエンジニアリングは関係ありません（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ええ、でも無駄です</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。特に作業を妨害することはありませんが、たとえば、奇妙な作業サーバーを誤って再ロードする可能性があります。追加のタスクは、外部境界に関して他の攻撃ベクトルをできるだけ多く識別することです。同社は定期的にそのようなテストを実施しており、現在は新しいテストの締め切りとなっています。条件はほぼ標準的で、適切で、理解可能です。降ります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
顧客名があります-メインサイトが</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">www.company.ruの</font></a><font style="vertical-align: inherit;">「会社」とし</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。もちろん、お客様の呼び方は異なりますが、この記事ではすべてを個人化解除します。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私はネットワークインテリジェンスを実施します。どのアドレスとドメインが顧客に割り当てられているかを調べ、ネットワーク図を描き、サービスがこれらのアドレスにどのように配布されるかを調べます。結果は4000を超えるライブIPアドレスです。私はこれらのネットワークのドメインに目を通します。幸いなことに、大多数は顧客顧客向けのネットワークであり、彼らは私たちに正式に関心を示していません。顧客は同じことを信じています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
256個のアドレスを持つ1つのネットワークが残っています。この時点で、すでにIPアドレスによるドメインとサブドメインの分布が理解されています。スキャンされたポートに関する情報があり、興味深いサービスのサービスを目で確認できます。並行して、あらゆる種類のスキャナーがアクセス可能なIPアドレスで起動され、Webサイト上で個別に起動されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
たくさんのサービスがあります。これは通常、ペンテスターに​​とっての喜びであり、サービスが多ければ多いほど攻撃のフィールドが広くなり、アーティファクトを見つけやすくなるため、迅速な勝利を期待します。ウェブサイトをざっと見たところ、それらのほとんどは、世界の大企業の有名な製品のウェブインターフェースであり、あなたに不満を示していることがわかりました。彼らはユーザー名とパスワードを要求し、2番目の要素を入力するためにフィールドを揺さぶるしきい値から、TLSクライアント証明書を要求するか、Microsoft ADFSに送信します。一部はインターネットから単に利用できません。一部の人にとっては、3つの給与に対して特別な有料クライアントが必要か、入力する正確なURLを知っている必要があることは明らかです。既知の脆弱性についてバージョンごとにソフトウェアを「突破」しようとするプロセス、Webパスの隠されたコンテンツ、LinkedInなどのサードパーティのサービスから漏えいしたアカウントを検索するプロセスでは、次の段階で徐々に落胆しません。それらのパスワードを選択する試み、および自己記述型Webサイトの脆弱性の発掘-ところで、統計によると、これはこれまでの外部攻撃の最も有望なベクトルです。すぐに、その後発射された映画銃に注目します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、何百ものサービスから際立っている2つのサイトがありました。これらのサイトには共通点が1つあります。ドメインごとに綿密なネットワーク調査を行わず、「前面」で開いているポートがないか、既知のIP範囲で脆弱性スキャナーを汚染している場合、これらのサイトは検証から除外され、DNS名を知らない限り表示されません。おそらく、少なくともそれらは以前に見落とされており、リソースに直接設定されていても、自動ツールはそれらに問題を見つけませんでした。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ちなみに、以前に発売されたスキャナーが一般的に発見されたという事実について。思い出させてください。一部の人々にとって、「ペンテスト」は「自動スキャン」に相当します。そして、このプロジェクトのスキャナーは何も言わなかった。まあ、中程度の脆弱性が最大を示しました（危険性の観点から5つのうち3つ）。一部のサービスには不正なTLS証明書または古い暗号化アルゴリズムがあり、ほとんどのサイトにクリックジャッキングがあります。しかし、これでは目標に到達しません。ここではスキャナーの方が便利でしょう。ただし、お客様自身がそのようなプログラムを購入してテストすることができ、退屈な結果から判断して、彼はすでにそれを確認しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
「異常な」サイトに戻ります。最初は、非標準アドレスのローカルWikiのようなものですが、wiki.company [。] Ruをこの記事に含めます。彼女はまた、すぐにユーザー名とパスワードを要求しましたが、ブラウザーのNTLMを介してすでに要求されています。ユーザーにとって、これはユーザー名とパスワードを要求する禁欲的なウィンドウのように見えます。そして、これは悪い習慣です。</font></font><br>
<br>
<blockquote> . NTLM  -      .   —    Active Directory.       company.ru,   «» DNS-.  ,    - ,        ,    - .  —        NTLM (, ?),     «» ,         .    ,      .         —  ,    .  —       .         — , ,  .  —   pass-the-hash-. ADFS           .<br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Microsoft製品の1つの悪い機能があります。そのようなNTLMを具体的に公開していなくても、少なくともOWAおよびLyncのデフォルトのインストールに含まれます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ちなみに、この記事の執筆者は、同じ方法で、ある大手銀行の従業員約1000アカウントをたった1時間で誤ってブロックしたため、見た目はやや淡色でした。</font><font style="vertical-align: inherit;">銀行のITサービスも青ざめていましたが、すべてが適切に終了し、この問題を最初に発見したことを称賛され、迅速かつ決定的な修正が行われました。</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2番目のサイトのアドレスは「明らかにいくつかの最後のname.company.ru」でした。</font><font style="vertical-align: inherit;">Googleで見つけた、10ページのようなもの。</font><font style="vertical-align: inherit;">デザインは2000年半ばに始まり、立派な人が次のようなメインページから見ました。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/vn/0a/bo/vn0abo7bxrqzjjq0vgophwwr3rm.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それから彼は「Dog’s Heart」からフレームを取りましたが、私を信じて、それはかなり似ていて、似た色の配色でさえも似ていました。サイトの名前を</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">preobrazhensky.company.ruとし</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
泌尿器科医の個人サイトでした。泌尿器科医のサイトがハイテク企業のサブドメインで何をしているのかが興味深くなりました。 Googleをざっと調べたところ、この医師は私たちの顧客の法人の1人の共同創設者であり、登録資本の約1000ルーブルにも貢献していることがわかりました。このサイトはおそらく何年も前に作成されたものであり、顧客のサーバーリソースがホスティングとして使用されていました。このサイトは長い間関連性を失っていますが、何らかの理由で長い間機能していません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
脆弱性に関しては、ウェブサイト自体は安全でした。先を見据えて、それは一連の静力学でした-腎臓と膀胱の形のイラストを挿入した単純なhtmlページです。そのようなサイトを「壊す」ことは役に立たない。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、その下のWebサーバーの方が面白かった。 HTTP Serverヘッダーから判断すると、IIS 6.0がありました。つまり、Windows 2003がオペレーティングシステムとして使用されていました。スキャナーは以前、泌尿器科医のこの特定のWebサイトが、同じWebサーバー上の他の仮想ホストとは異なり、PROPFINDコマンドに応答すること、つまりWebDAVがそこで機能することを明らかにしました。ちなみに、スキャナーはこの情報をInfoのマークを付けて発行しました（スキャナーの言語では、これが最も危険度が低いと報告されています）。通常、このようなことはスキップされます。組み合わせて、これは興味深い効果をもたらしました。これは、Googleをもう一度掘り下げた後でのみ明らかになりました。シャドウブローカーセットに関連するまれなバッファーオーバーフローの脆弱性、つまりCVE-2017-7269は、すでにエクスプロイトが用意されています。つまり、Windows 2003を使用していて、WebDAVがIISで実行されている場合は、惨事になります。2018年にWindows 2003の運用に携わっていますが、これはそれ自体が災害です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
エクスプロイトはMetasploitで終わり、制御されたサービスにDNSクエリを送信する負荷ですぐにテストされました-Burp CollaboratorはDNSクエリをトラップするために伝統的に使用されています。驚いたことに、それは初めて機能しました。DNSでジャークが受信されました。次に、ポート80を介してバックエンド接続（つまり、サーバーから攻撃者へのネットワーク接続で、犠牲ホストのcmd.exeにアクセスできる）を作成する試みがありましたが、大失敗が起こりました。接続は確立されず、3回目の操作の試行後、サイトはすべての面白い写真とともに永久に姿を消しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
通常、この後に「お客様、目を覚まして、すべてを落としました」というスタイルの手紙が続きます。しかし、サイトはビジネスプロセスとは関係なく、一般にそこで機能し、サーバー全体のように理由は不明であり、このリソースを自由に使用できると言われました。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
約1日後、サイトは突然独自に作業を開始しました。 IIS 6.0でWebDAVからスタンドを構築したところ、デフォルトの設定ではIISワークフローが30時間ごとに再起動されます。つまり、コントロールがシェルコードを終了すると、IISワークフローが終了し、それ自体が数回再起動してから30時間休止しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
tcpのbekconnectが初めて失敗したので、この問題を閉じたポートに書き留めました。</font><font style="vertical-align: inherit;">つまり、発信接続を許可しないファイアウォールの存在を示唆しました。</font><font style="vertical-align: inherit;">多くのtcpおよびudpポートをソートするシェルコードを実行し始めましたが、効果はありませんでした。</font><font style="vertical-align: inherit;">Metasploitからのhttp（s）を介した逆接続ロード-meterpreter / reverse_http（s）が機能しませんでした。</font><font style="vertical-align: inherit;">突然、同じポート80への接続が確立されましたが、すぐに切断されました。</font><font style="vertical-align: inherit;">彼は、メータプリッターのトラフィックを好まなかった、まだ架空のIPSのアクションにそれを書き留めました。</font><font style="vertical-align: inherit;">ポート80への純粋なtcpの接続は失敗したが、httpは失敗したという事実に照らして、httpプロキシが何らかの方法でシステムで構成されていると結論付けました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DNSを介してmeterpreterを試してみました（ありがとう</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d00kie</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">彼の努力のために、多くのプロジェクトを救い、最初の成功を思い出しましたが、スタンドで働いていませんでした。シェルコードはこの脆弱性に対して大きすぎました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実際には、次のように見えます。5〜4分以内に3〜4回攻撃を試み、その後30時間待機します。そして、3週間続けて。時間を無駄にしないようにリマインダーも設定しました。さらに、テスト環境と戦闘環境の動作に違いがありました。この脆弱性には2つの類似したエクスプロイトがあり、1つはMetasploitから、もう1つはインターネットから、Shadow Brokersのバージョンからやり直されました。したがって、戦闘ではMetasploitのみが機能し、スタンドでは2番目のみでした。これにより、デバッグがさらに複雑になり、脳が壊れました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最終的に、シェルコードは効果的であることが判明しました。これは、特定のサーバーからhttp経由でexeファイルをダウンロードし、それをターゲットシステムで実行しました。シェルコードは収まるほど十分に小さく、少なくともそれは機能しました。 TCPサーバーがトラフィックをまったく嫌い、http（s）がメータープリッターを検査されたため、このシェルコードを介してDNS-meterpreterを含むexeファイルをダウンロードするのが最も速い方法だと判断しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここでも問題が発生しました。exeファイルをダウンロードすると、試行が示されているように、ダウンロードが中断されました。</font><font style="vertical-align: inherit;">繰り返しますが、私のサーバーと泌尿器科医の間のある種の保護デバイスは、内部にexeがあるhttpトラフィックが好きではありませんでした。</font><font style="vertical-align: inherit;">シェルコードを変更して、オンザフライでhttpトラフィックを難読化し、exeではなく抽象的なバイナリデータを転送するのは、「迅速な」ソリューションのように思われました。</font><font style="vertical-align: inherit;">最後に、攻撃は成功し、制御はシンDNSチャネルを介して行われました。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/ca/-h/da/ca-hdaxtehdtgxz-o1sypuvgo5u.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
何もすることができないIISワークフローに対する最も単純な権限を持っていることがすぐに明らかになりました。</font><font style="vertical-align: inherit;">これはMetasploitコンソールでの表示方法です。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/nc/cu/ck/nccucklqwhs5kpekejdz8vky3qc.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべてのペンテスト方法論では、アクセス権を取得するときに権利を増やす必要があることを強く示唆しています。最初のアクセスは単にネットワークエントリポイントと見なされ、同じネットワーク上の別のマシンを危険にさらすことは、通常、既存のホストの特権を増やすよりも簡単で高速であるため、通常、これはローカルでは行いません。しかし、DNSチャネルは非常に狭く、トラフィックのローミングを許可しないため、これは当てはまりません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このWindows 2003搭載サーバーが既知のMS17-010の脆弱性から修復されなかったと仮定して、メータープリプリターDNSトンネルを介してポート445 / TCPへのトラフィックをlocalhostにトンネリングし（そう、これも可能です）、以前にダウンロードしたexeを脆弱性を介して実行しようとしています。攻撃は機能し、2つ目の接続を取得しますが、SYSTEM権限が必要です。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/bv/mq/em/bvmqempcbcjfwu7colpyjhiupju.png"></div><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">興味深いことに、サーバーはまだMS17-010からの保護を試みていました。外部インターフェイスで脆弱なネットワークサービスを無効にしていました。</font><font style="vertical-align: inherit;">これはネットワークを介した攻撃から実際に保護しますが、ローカルホストのSMBをすぐに無効にすることはできないため、ローカルホスト内からの攻撃は機能しました。</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">次に、新しい興味深い詳細が明らかになります：</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SYSTEM権限があれば、TCPを介してバックコネクトを簡単にインストールできます。</font><font style="vertical-align: inherit;">明らかに、直接TCPの禁止は、もっぱらIIS限定のユーザー問題です。</font><font style="vertical-align: inherit;">スポイラー：IISユーザートラフィックは、何らかの形でローカルISAプロキシに双方向でラップされていました。</font><font style="vertical-align: inherit;">これが正確にどのように機能するかは再現されていません。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私は特定の「DMZ」にいます（これはActive Directoryドメインではなく、WORKGROUPです）-論理的に聞こえます。</font><font style="vertical-align: inherit;">しかし、予想されるプライベート（「灰色」）IPアドレスの代わりに、私は前に攻撃したのとまったく同じように、かなり「白」です。</font><font style="vertical-align: inherit;">これは、2005年のシスコのマニュアルに示されているように、会社がIPv4アドレッシングの世界で古く、DMZゾーンをスキームに従ってNATなしで128の「ホワイト」アドレスに維持できる余裕があることを意味します。</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
サーバーが古いため、Mimikatzはメモリから直接動作することが保証されています。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/qn/bu/tk/qnbutkh_dfi7ngbtp1cguanlf5q.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ローカル管理者のパスワードを取得し、TCPを介してRDPトラフィックをトンネルし、居心地の良いデスクトップに移動します。</font><font style="vertical-align: inherit;">サーバーで何でもできるので、ウイルス対策ソフトウェアを削除しました。サーバーは、TCPポート80および443でのみインターネットからアクセスでき、443はビジーではありませんでした。</font><font style="vertical-align: inherit;">OpenVPNサーバーを443に上げ、VPNトラフィックにNAT機能を追加し、OpenVPNを介して無制限の形式でDMZネットワークに直接アクセスします。</font><font style="vertical-align: inherit;">注目に値するのは、いくつかの無効化されていないIPS機能を備えたISAがポートスキャンでトラフィックをブロックしたことです。そのため、よりシンプルで柔軟なRRASに置き換える必要がありました。</font><font style="vertical-align: inherit;">したがって、ペンテスターはまだすべてを管理する必要がある場合があります。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/y3/cs/rb/y3csrbtb7drx_oh7bcswhqf8apq.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意深い読者は、次のように質問します。「2番目のサイトは何ですか。NTLM認証を備えたwikiで、これほど多くのことが書かれています。」</font><font style="vertical-align: inherit;">それについてさらに。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パート2.まだ暗号化していませんか？</font><font style="vertical-align: inherit;">その後、私</font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">たちはあなたに</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">すでにここに</font><s><font style="vertical-align: inherit;">行き</font></s><font style="vertical-align: inherit;">ます</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、DMZネットワークセグメントへのアクセスがあります。</font><font style="vertical-align: inherit;">ドメイン管理者に行く必要があります。</font><font style="vertical-align: inherit;">最初に頭に浮かぶのは、DMZセグメント内のサービスのセキュリティを自動的にチェックすることです。これは、特に現在調査のために開いているサービスがはるかに多いためです。</font><font style="vertical-align: inherit;">侵入テストの典型的な状況：外部境界は内部サービスよりも保護されており、大規模なインフラストラクチャへのアクセス権を取得すると、このドメインにツールからアクセスできるようになるため、ドメインで拡張権限を取得することがはるかに簡単になります。次に、数千のホストのインフラストラクチャには、常にいくつかの重要な問題があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
OpenVPNトンネルを介してDMZにスキャナーをロードし、待機します。私はレポートを開きます-深刻なことは何もありません。明らかに誰かが私と同じように歩きました。次のステップは、ホストがDMZネットワーク内でどのように通信するかを調べることです。これを行うには、まず、通常のWiresharkを起動して、ブロードキャスト要求（主にARP）をリッスンします。 ARPパッケージは終日収集されました。このセグメントではいくつかのゲートウェイが使用されていることがわかります。これは後で重宝します。 ARPの要求と応答のデータとポートスキャンデータを結合すると、以前はWebやメールなどの既知のサービスに加えて、ローカルネットワーク内からのユーザートラフィックの出力ポイントが見つかりました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
現時点では他のシステムにアクセスできず、企業サービス用のアカウントが1つもなかったため、ARPスプーフィングを使用してトラフィックから少なくとも一部のアカウントを取得することにしました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cain＆Abelが泌尿器科医のサーバーで起動されました。</font><font style="vertical-align: inherit;">識別されたトラフィックフローを考慮して、最も有望なペアが「中間者攻撃」に選択されました。次に、5〜10分間の短期間の起動と、「フリーズ」の場合にサーバーを再起動するタイマーを使用して、一部のネットワークトラフィックが受信されました。</font><font style="vertical-align: inherit;">冗談のように、2つのニュースがありました。</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">良い：多くの資格情報が検出され、攻撃は全体として機能しました。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">悪い：すべての資格情報は、顧客自身の顧客からのものでした。</font><font style="vertical-align: inherit;">サポートサービスを提供し、トラフィックの暗号化が常に構成されているとは限らないカスタマーサービスに接続するカスタマーのスペシャリスト。</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その結果、プロジェクトのコンテキストでは役に立たない多くの資格情報を手に入れましたが、攻撃の危険性のデモンストレーションとして間違いなく興味深いものでした。 telnetを使用する大企業のボーダールーター、すべてのデータを含む内部HTTPへのデバッグHTTPポートの転送、ローカルネットワーク上のWindows XPからのRDPへの直接アクセス、その他の不明瞭さ。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MITERマトリックスによると、</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ある種の</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">サプライチェーンの侵害</font></a><font style="vertical-align: inherit;">が判明しました</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、このようなトラフィックからメールを収集する楽しい機会を見つけました。これは、お客様からクライアントのSMTPポートに、暗号化なしで送信された完成した手紙の例です。あるAndreiは彼の同名にドキュメントを再送信するように依頼し、それはユーザー名、パスワード、および1つの返信レター内のリンクとともにクラウドディスクに配置されます。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/ec/mo/y1/ecmoy10hbidcsgl7809ldpkx1fu.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、すべてのサービスを暗号化する必要があることをもう一度思い出させるものです。プロバイダー、他社のシステム管理者、またはそのようなペンターなど、具体的に誰がいつデータを読み取って適用するかは不明です。多くの場合、暗号化されていないトラフィックを傍受できるだけであることに私は沈黙しています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
明らかな成功にもかかわらず、これは目標に近づかなかった。もちろん、長い間座って貴重な情報を入手することは可能でしたが、そこに現れたという事実は不可能であり、攻撃自体はネットワークの完全性の点で非常に危険です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
サービスをさらに掘り下げた後、興味深いアイデアが思い浮かびました。 Responderと呼ばれるユーティリティがあります（この名前でアプリケーションの例を見つけるのは簡単です）。これは、ブロードキャスト要求を「ポイズニング」することで、SMB、HTTP、LDAPなどのさまざまなプロトコルを介して接続を引き起こします。さまざまな方法で、接続する各ユーザーは認証と調整を求められ、認証がNTLMを通過し、被害者に対して透過モードになります。ほとんどの場合、攻撃者はこのようにNetNTLMv2ハンドシェイクを収集し、それらから、ディクショナリに従って、ユーザードメインのパスワードをすばやく回復します。私はここでも似たようなものを望みましたが、ユーザーは「壁の後ろ」に座っていました。つまり、ファイアウォールで隔てられており、WEB上でBlue Coatプロキシクラスタを通過しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Active Directoryドメイン名が「外部」ドメインと一致することを指定しました。つまり、company.ruでしたか？したがって、Windows、より正確にはInternet Explorer（およびEdge、Chrome）では、サイトが「イントラネットゾーン」にあるとユーザーが考える場合、ユーザーはNTLMを介してHTTPで透過的に認証できます。 「イントラネット」の兆候の1つは、「灰色」のIPアドレスまたは短いDNS名、つまりドットなしの呼び出しです。 「ホワイト」IPおよびDNS名preobrazhensky.company.ruのサーバーは自由に使用でき、ドメインマシンは通常、DHCP経由でActive Directoryドメインサフィックスを取得して名前の入力を簡略化するため、アドレスバーに</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">preobrazhensky</font></a><font style="vertical-align: inherit;"> URLを書き込むだけで</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">済み</font></a><font style="vertical-align: inherit;">ます</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">これにより、侵害された泌尿器科医のサーバーへの正しい道を見つけることができ、現在「イントラネット」と呼ばれていることを忘れないでください。</font><font style="vertical-align: inherit;">つまり、NTLMハンドシェイクのユーザーに、彼の知らないうちに同時に与えてくれました。</font><font style="vertical-align: inherit;">クライアントのブラウザーに、このサーバーにアクセスする緊急の必要性を考えさせる必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
素晴らしいユーティリティIntercepter-NGが助けになりました（ありがとう</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">インターセプター</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）外出先でトラフィックを変更することができ、Windows 2003で完全に機能しました。トラフィックストリームのJavaScriptファイルのみを変更するための個別の機能さえありました。一種の大規模なクロスサイトスクリプティングが計画されました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ユーザーがグローバルWEBにアクセスするBlue Coatプロキシは、静的コンテンツを定期的にキャッシュしました。トラフィックを傍受することで、24時間体制で動作し、頻繁に使用される統計情報を絶え間なく要求して、ピーク時のコンテンツの表示を高速化することが明らかになりました。さらに、BlueCoatには特定のユーザーエージェントがあり、生きているユーザーとは明確に区別されていました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Javascriptが準備され、夜間のIntercepter-NGの助けを借りて、Blue CoatのJSファイルを使用して各回答を実装するのに丸1時間かかりました。スクリプトは次のことを行いました。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">User-Agentが現在のブラウザを検出しました。</font><font style="vertical-align: inherit;">Internet Explorer、Edge、またはChromeの場合、問題なく動作しました。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ページのDOMが形成されるまで待機しました。</font></font></li>
<li><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">preobrazhensky</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">タイプのsrc属性を持つ非表示の画像を</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">DOM</font></a><font style="vertical-align: inherit;">に挿入しました</font><font style="vertical-align: inherit;">：8080 / NNNNNNN.pngここで、NNNは任意の数字なので、BlueCoatはキャッシュしません。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注入が行われ、画像を挿入する必要がなくなったことを示すグローバルフラグ変数を設定します。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ブラウザーは、侵害されたサーバーのポート8080でこの画像を読み込もうとしましたが、私のラップトップへのTCPトンネルを待っていました。そこでは、同じResponderが起動され、ブラウザーからのNTLMログインが必要でした。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/ht/p8/d-/htp8d-9mcytkfs2ov2yuom9bm4i.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
レスポンダーログから判断すると、朝、人々が仕事に取り掛かり、ワークステーションの電源を入れた後、NTLMハンドシェイクを「マージ」することを忘れずに、泌尿器科医のサーバーに一目で見えなくなりました。</font><font style="vertical-align: inherit;">ハンドシェイクは一日中雨が降り、悪名高いパスワード回復攻撃のための資料が明らかに蓄積されました。</font><font style="vertical-align: inherit;">これはレスポンダーログがどのように見えるかです：</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/aj/ba/yt/ajbaytlvh2okb4xknkzalcniqyc.png"></div><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ユーザーによる泌尿器科医のサーバーへの大規模な秘密の訪問</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
このストーリーはすべて、「すべてが大丈夫だったが、つまらないことがあり、それから克服し、すべてが成功した」という原則に基づいていることに気付いたと思います。</font><font style="vertical-align: inherit;">それで、困ったことがありました。</font><font style="vertical-align: inherit;">500のユニークな握手のうち、1つは明らかにされなかった。</font><font style="vertical-align: inherit;">そして、これは、プロセッサが停止しているラップトップでも、これらのNTLMv2ハンドシェイクが1秒あたり数億回の試行の速度で処理できるという事実を考慮に入れています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私は、パスワード変更技術、グラフィックスカード、より厚い辞書を身につけて待つ必要がありました。</font><font style="vertical-align: inherit;">久しぶりに、「Q11111111 ... .1111111q」の形式のパスワードを持ついくつかのアカウントが開かれました。これは、すべてのユーザーが、大文字と小文字が異なる非常に長いパスワードを考えざるを得なかったことを示唆しています。</font><font style="vertical-align: inherit;">しかし、熟練したユーザーを失敗させることはできません。このようにして、覚えやすくなりました。</font><font style="vertical-align: inherit;">合計で約5個が開かれ、そのうちの1つだけがサービスに対する貴重な権利を有していました。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パート3. Roskomnadzorが反撃</font></font><br>
</h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、最初のドメインアカウントが受信されました。</font><font style="vertical-align: inherit;">この時点で長い読書から眠りに落ちていなかった場合は、おそらく2番目の認証要素を必要としないサービスについて言及したことを覚えているでしょう。これはNTLM認証を備えたwikiです。</font><font style="vertical-align: inherit;">もちろん、彼らがした最初のことは入ることでした。</font><font style="vertical-align: inherit;">内部ナレッジベースを掘り下げると、すぐに結果が出ました。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">同社は、ローカルネットワークにアクセスできるドメインアカウント認証を備えたWiFiネットワークを持っています。</font><font style="vertical-align: inherit;">現在のデータセットでは、これはすでに攻撃ベクトルですが、足でオフィスに行き、顧客のオフィスのどこかにいる必要があります。</font></font></li>
<li> ,    , …    « » ,              .    «»  «»        .      ,       DMZ.</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
もちろん、「2番目の要素」は、私の電話のアプリケーションとして、侵害されたアカウントにすぐに追加されました。 「承認」/「不承認」ボタンを押して電話にプッシュリクエストを送信したり、さらに独立した入力のために画面にOTPコードを静かに表示したりするプログラムがありました。さらに、最初の方法が唯一の正しい指示であるはずでしたが、OTP方法とは異なり、機能しませんでした。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
壊れた「第2要素」で、私はなんとかOutlook Web Accessメールにログインし、Citrix Netscaler Gatewayにリモートアクセスしました。 Outlookでは、メールでサプライズが待っていました。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/l8/3r/hr/l83rhrmhg4o8cn1ghrhhyjqagrg.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">この珍しいショットでは、Roskomnadzorがペンテスターをどのように支援しているかを見ることができます。</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
これらは有名なTelegramファンロックの最初の数か月で、何千ものアドレスを持つネットワーク全体が</font><i><font style="vertical-align: inherit;">容赦</font></i><font style="vertical-align: inherit;">なくアクセスから姿を消しました。なぜプッシュがすぐに機能しなかったのか、そして私の「被害者」が営業時間内に彼女のアカウントを使い始めたために警報が鳴らなかったのはなぜかが明らかになりました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Citrix Netscalerに精通しているユーザーは、通常は画像インターフェイスのみをユーザーに伝えることができるような方法で実装され、サードパーティのアプリケーションを起動してデータを転送するためのツールを提供せず、あらゆる方法で標準のコントロールシェルによるアクションを制限することを想像しています。私の職業では、1Cしか得られませんでした：</font></font><br>
<br>
<div style="text-align:center;"><img width="600" src="https://habrastorage.org/webt/jl/oy/wi/jloywi1o1ollk3__dpvedswgina.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1Cインターフェースを少し歩いたところ、外部処理モジュールがあることがわかりました。</font><font style="vertical-align: inherit;">これらはインターフェースからロードでき、権限と設定に応じて、クライアントまたはサーバーで実行されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
友人の1Cプログラマに、文字列を取得して実行するような処理を作成するように依頼しました。</font><font style="vertical-align: inherit;">1Cでは、プロセスの起動は次のようになります（インターネットから取得）。</font><font style="vertical-align: inherit;">同意します。1C言語の構文は、その即時性でロシア語を話す人を攻撃しますか？</font></font><br>
<br>
<img width="600" src="https://habrastorage.org/webt/su/_m/ec/su_mecdfowq1wm2voklffkf4zeu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
処理は完全に実行され、ペンテスターが「シェル」と呼んでいるものであることがわかりました-Internet Explorerはそれを介して起動されました。</font></font><br>
<br>
<div style="text-align:center;"><img width="600" src="https://habrastorage.org/webt/5v/xd/kj/5vxdkjtdo7aowdfvpfgj0hdrfso.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以前は、システムのアドレスがメールに記載されていたため、テリトリーへのパスを注文できました。</font><font style="vertical-align: inherit;">WiFi経由で攻撃ベクターを使用する必要がある場合に備えて、パスを注文しました。</font></font><br>
<br>
<div style="text-align:center;"><img width="600" src="https://habrastorage.org/webt/dc/xj/sg/dcxjsgmg53xnrzopu0j6_mlxx9s.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
インターネット上では、顧客のオフィスには美味しい無料のケータリングがまだあったと言われていますが、私はリモートサイトから攻撃を仕掛けることを好んだので、落ち着いています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AppLockerは、Citrixを使用するアプリケーションサーバーでアクティブ化されましたが、バイパスされました。</font><font style="vertical-align: inherit;">同じMeterpreterが読み込まれ、DNSを介して開始されました。これは、http（s）バージョンが接続したくないため、内部プロキシアドレスを知らなかったためです。</font><font style="vertical-align: inherit;">ちなみに、この瞬間から、外部のペンテストは本質的に内部のペンテストに変わりました。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パート4.ユーザーの管理者権限-これは悪い、p-nyatnenko？</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pentesterがドメインユーザーのセッションを制御するときに最初に行うことは、ドメインの権利に関するすべての情報を収集することです。</font><font style="vertical-align: inherit;">このようなユーティリティBloodHoundがあり、ドメインコントローラからLDAPプロトコルを介してユーザー、コンピュータ、セキュリティグループに関する情報、および最近ログインしたユーザーとSMBを通じてローカル管理者であるユーザーに関する情報を自動的にダウンロードできます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ドメイン管理者権限を取得するための一般的な手法は、単調なアクションのサイクルのように単純化されています。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">既にキャプチャされたドメインアカウントに基づいて、ローカル管理者権限があるドメインコンピュータに移動します。</font></font></li>
<li> Mimikatz    ,  Kerberos   NTLM  ,       .      lsass.exe        .     Windows  2012R2/Windows 8.1    .</li>
<li>,       .   .  -      .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
「End of Cycle;」。1Cプログラマがここに書き込むため。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、私たちのユーザーは、Windows 7を搭載した1つのホスト（ "VDI"または "仮想デスクトップインフラストラクチャ"という個人用仮想マシン）のローカル管理者であることがわかりました。</font><font style="vertical-align: inherit;">おそらく、VDIサービスの設計者は、VDIはユーザーの個人用オペレーティングシステムであるため、ユーザーがソフトウェア環境を好きなように変更できるようにすることを示唆しています。</font><font style="vertical-align: inherit;">私はまた、一般的には良い考えだと思いました。私はこの個人用VDIホストに行って、そこにソケットを作成しました。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私はそこにOpenVPNクライアントをインストールし、インターネットを介して私のサーバーにトンネルを作りました。</font><font style="vertical-align: inherit;">クライアントはドメイン認証を使用してブルーコートを通過する必要がありましたが、OpenVPNはそのまま、問題なく対応しました。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VDI OpenSSHにインストールされます。</font><font style="vertical-align: inherit;">まあ、本当に、SSHのないこのWindows 7は何ですか？</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは生きているように見えた方法です。</font><font style="vertical-align: inherit;">これはすべてCitrixと1Cを通じて行う必要があることを思い出してください。</font></font><br>
<br>
<div style="text-align:center;"><img width="600" src="https://habrastorage.org/webt/tc/4p/g8/tc4pg8otdktkxljex7oblfldjo0.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
近隣のコンピューターへのアクセスを促進する手法の1つは、ローカル管理者のパスワードが一致するかどうかを確認することです。</font><font style="vertical-align: inherit;">ここで運がすぐに待っていました。デフォルトのローカル管理者のNTLMハッシュ（突然Administratorと呼ばれました）は、数百の隣接するVDIホストにpass-the-hash攻撃を介して接近しました。</font><font style="vertical-align: inherit;">もちろん、攻撃はすぐに彼らを超えました。</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">次に、VDI管理者は足元を2回撃ちました。</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LAPSによって初めてVDIマシンが動作するようになったのではなく、VDIに大量に展開されたイメージから同じローカル管理者パスワードを本質的に保存しました。</font></font></li>
<li>   —   ,    pass-the-hash .          ,         ,   — .</li>
</ul></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">そのWindowsでSSHサービスを使用する理由非常にシンプルです。OpenSSHサーバーは、ユーザーの作業を妨げることなく、便利なインタラクティブコマンドシェルを提供するだけでなく、VDI上のsocks5プロキシも提供します。この靴下を通して、私はSMBを介して接続し、これらの何百ものVDIマシンからキャッシュされたアカウントを収集し、BloodHoundグラフでドメイン管理者へのパスを探しました。何百ものホストが自由に使えるので、この方法をすぐに見つけました。ドメイン管理者権限を取得しています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、類似の検索を示すインターネットの画像です。リンクは、管理者が誰で、どこに誰が入力したかを示します。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/hm/49/aa/hm49aasvb46cltksyxo-ugguwns.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ちなみに、「ソーシャルエンジニアリングを適用しない」というプロジェクトの最初からの状態を覚えておいてください。</font><font style="vertical-align: inherit;">したがって、それでも平凡なフィッシングを適用できたとしても、ボリウッド全体が特殊効果でどれだけ切り取られるかを考えてみることをお勧めします。</font><font style="vertical-align: inherit;">でも個人的にはこういうことに興味がありました。</font><font style="vertical-align: inherit;">これを読んで興味を持っていただければ幸いです。</font><font style="vertical-align: inherit;">もちろん、すべてのプロジェクトがそれほど興味深く見えるわけではありませんが、全体としての作業は非常に不可解で、停滞しません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
おそらく、誰かが質問するでしょう：どのように自分を守るのですか？</font><font style="vertical-align: inherit;">この記事でも多くのテクニックが説明されていますが、Windows管理者はそれらの多くについてさえ知りません。</font><font style="vertical-align: inherit;">ただし、ハッキングされた原則と情報セキュリティ対策の観点からそれらを検討することを提案します。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">古いソフトウェアを使用しないでください（最初にWindows 2003を覚えていますか？）</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不要なシステムをオンにしたままにしないでください（なぜ泌尿器科医のサイトだったのですか？）</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ユーザーのパスワードを自分で確認してください（それ以外の場合は、</font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">兵士...</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ペンテスター</font><font style="vertical-align: inherit;">がこれを行います</font><font style="vertical-align: inherit;">）</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">異なるアカウントに同じパスワードを使用しない（VDIの侵害）</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">その他</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
もちろん、実装するのは非常に困難ですが、次の記事では、これが実際に可能であることを示します。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja496702/index.html">Intel VシリーズFPGAのPCI Express：インターフェイスの基本とハードウェアコア機能</a></li>
<li><a href="../ja496704/index.html">Saturn-5ロケットのPCB-説明付きのリバースエンジニアリング</a></li>
<li><a href="../ja496706/index.html">週末の読書：オーディオ形式の歴史-カセットの時代と音声合成技術の開発</a></li>
<li><a href="../ja496708/index.html">スペースガン、スチームロケット、オービタルミラー</a></li>
<li><a href="../ja496710/index.html">コンピュータ情報：シンプルで高速</a></li>
<li><a href="../ja496714/index.html">Power Automate VS Logic Apps。一般情報</a></li>
<li><a href="../ja496716/index.html">Power Automate VS Logic Apps。パワー自動化ケース</a></li>
<li><a href="../ja496720/index.html">LLHDプロジェクト-ユニバーサルハードウェア記述言語</a></li>
<li><a href="../ja496722/index.html">Tinkov API、投資。最初のステップ</a></li>
<li><a href="../ja496726/index.html">下に傾ける</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>