<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🐁 🐛 👩‍❤️‍👩 Préparer notre produit à évoluer avec les files d'attente Laravel 👩🏻‍⚖️ 🐜 📥</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Une traduction de l'article a été préparée spécialement pour les étudiants du cours «Framework Laravel» .
 
 
 
 Bonjour, je m'appelle Valerio, un ing...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Préparer notre produit à évoluer avec les files d'attente Laravel</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/499508/"><b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Une traduction de l'article a été préparée spécialement pour les étudiants du cours </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">«Framework Laravel»</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></i></b><br>
<br>
<img src="https://habrastorage.org/webt/ei/7u/aq/ei7uaq5c5omdkojxhmurjggkqw4.png"><br>
<hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bonjour, je m'appelle Valerio, un ingénieur logiciel italien. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce guide est destiné à tous les développeurs PHP qui ont déjà des applications en ligne avec de vrais utilisateurs, mais qui n'ont pas une compréhension plus approfondie de la façon d'implémenter (ou d'améliorer considérablement) l'évolutivité de leur système à l'aide des files d'attente Laravel. J'ai découvert Laravel pour la première fois fin 2013 au début de la 5e version du framework. Ensuite, je n'étais pas encore un développeur impliqué dans des projets sérieux, et l'un des aspects des frameworks modernes, en particulier à Laravel, qui me semblait le plus incompréhensible, était Queues.</font></font><a name="habracut"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En lisant la documentation, j'ai deviné le potentiel, mais sans réelle expérience de développement, tout cela n'est resté qu'au niveau des théories dans ma tête. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aujourd'hui, je suis le créateur </font></font><code>Inspector.dev</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tableau de </font><font style="vertical-align: inherit;">bord en </font><font style="vertical-align: inherit;">temps réel</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , qui effectue des </font><font style="vertical-align: inherit;">milliers de tâches toutes les </font><font style="vertical-align: inherit;">heures, et je comprends cette architecture bien mieux qu'auparavant. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ey/rx/qu/eyrxquvk3yrmu5kldbmpuit5riu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans cet article, je vais vous expliquer comment j'ai découvert les files d'attente et les tâches et quelles configurations m'ont aidé à traiter de grandes quantités de données en temps réel, tout en économisant les ressources du serveur.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">introduction</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsqu'une application PHP reçoit une requête http entrante, notre code est exécuté séquentiellement étape par étape jusqu'à ce que la requête soit terminée et qu'une réponse soit renvoyée au client (par exemple, le navigateur de l'utilisateur). Ce comportement synchrone est vraiment intuitif, prévisible et facile à comprendre. J'envoie une requête http au point de terminaison, l'application extrait les données de la base de données, les convertit au format approprié, effectue des tâches supplémentaires et les renvoie. Tout se passe linéairement. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les tâches et les files d'attente introduisent un comportement asynchrone qui viole ce flux de ligne. C'est pourquoi ces fonctionnalités m'ont paru un peu étranges au début.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais parfois, une demande http entrante peut déclencher un cycle de tâches chronophages, par exemple, l'envoi de notifications par e-mail à tous les membres de l'équipe. </font><font style="vertical-align: inherit;">Cela peut signifier l'envoi de six ou dix e-mails, ce qui peut prendre quatre ou cinq secondes. </font><font style="vertical-align: inherit;">Par conséquent, chaque fois que l'utilisateur clique sur le bouton correspondant, il doit attendre cinq secondes avant de pouvoir continuer à utiliser l'application. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Plus l'application grandit, plus ce problème s'aggrave.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Qu'est-ce qu'une tâche?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un travail est une classe qui implémente la méthode </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">handle</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> qui contient la logique que nous voulons exécuter de manière asynchrone.</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-meta">&lt;?php</span><font></font>
<font></font>
<span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Contracts</span>\<span class="hljs-title">Queue</span>\<span class="hljs-title">ShouldQueue</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Foundation</span>\<span class="hljs-title">Bus</span>\<span class="hljs-title">Dispatchable</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Queue</span>\<span class="hljs-title">InteractsWithQueue</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Bus</span>\<span class="hljs-title">Queueable</span>;<font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CallExternalAPI</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">ShouldQueue</span>
</span>{
    <span class="hljs-keyword">use</span> <span class="hljs-title">Dispatchable</span>,
        <span class="hljs-title">InteractsWithQueue</span>,
        <span class="hljs-title">Queueable</span>;<font></font>
        <font></font>
    <span class="hljs-comment">/**
     * <span class="hljs-doctag">@var</span> string
     */</span>
    <span class="hljs-keyword">protected</span> $url;<font></font>
<font></font>
    <span class="hljs-comment">/**
     *    .
     *
     * <span class="hljs-doctag">@param</span> array $Data
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params">$url</span>)
    </span>{
        <span class="hljs-keyword">$this</span>-&gt;url = $url;<font></font>
    }<font></font>
    <font></font>
<font></font>
    <span class="hljs-comment">/**
     *  ,   .
     *
     * <span class="hljs-doctag">@return</span> void
     * <span class="hljs-doctag">@throws</span> \Throwable
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">handle</span>(<span class="hljs-params"></span>)
    </span>{<font></font>
        file_get_contents(<span class="hljs-keyword">$this</span>-&gt;url);<font></font>
    }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme mentionné ci-dessus, la principale raison de conclure un morceau de code dans Job est de terminer une tâche longue, sans forcer l'utilisateur à attendre sa fin.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Qu'entendons-nous par «tâches laborieuses»?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est une question naturelle. </font><font style="vertical-align: inherit;">L'envoi d'e-mails est l'exemple le plus couramment utilisé dans les articles qui parlent de files d'attente, mais je veux vous parler de la véritable expérience de ce que je devais faire. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En tant que propriétaire de produit, il est très important pour moi de synchroniser les informations de voyage des utilisateurs avec nos outils de marketing et d'assistance client. </font><font style="vertical-align: inherit;">Ainsi, en fonction des actions des utilisateurs, nous mettons à jour les informations des utilisateurs dans divers logiciels externes via une API (ou des appels http externes) à des fins de service et de marketing.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'un des points de terminaison les plus couramment utilisés dans mon application peut envoyer 10 e-mails et effectuer 3 appels http vers des services externes avant la fin. </font><font style="vertical-align: inherit;">Aucun utilisateur n'attendra autant de temps - très probablement, ils cessent tous d'utiliser mon application. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Grâce aux files d'attente, je peux encapsuler toutes ces tâches dans les classes allouées, transférer les informations nécessaires à l'exécution de leur travail au constructeur et planifier leur achèvement à une date ultérieure en arrière-plan afin que mon contrôleur puisse immédiatement renvoyer la réponse.</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-meta">&lt;?php</span><font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ProjectController</span> 
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">store</span>(<span class="hljs-params">Request $request</span>)
    </span>{<font></font>
        $project = Project::create($request-&gt;all());<font></font>
        <font></font>
        <span class="hljs-comment">//  NotifyMembers, TagUserActive, NotifyToProveSource </span>
        <span class="hljs-comment">//   ,     </span>
        Notification::queue(<span class="hljs-keyword">new</span> NotifyMembers($project-&gt;owners));
        <span class="hljs-keyword">$this</span>-&gt;dispatch(<span class="hljs-keyword">new</span> TagUserAsActive($project-&gt;owners));
        <span class="hljs-keyword">$this</span>-&gt;dispatch(<span class="hljs-keyword">new</span> NotifyToProveSource($project-&gt;owners));<font></font>
        <font></font>
        <span class="hljs-keyword">return</span> $project;<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je n'ai pas besoin d'attendre la fin de tous ces processus avant de retourner la réponse; </font><font style="vertical-align: inherit;">au contraire, l'attente sera égale au temps nécessaire pour les publier dans la file d'attente. </font><font style="vertical-align: inherit;">Et cela signifie la différence entre 10 secondes et 10 millisecondes !!!</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Qui effectue ces tâches après les avoir envoyées dans la file d'attente?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il s'agit de l'architecture classique </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">éditeur / consommateur</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Nous avons déjà publié nos tâches dans la file d'attente à partir du contrôleur, nous allons maintenant comprendre comment la file d'attente est utilisée et, enfin, les tâches sont exécutées. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/pi/va/vr/pivavrbjasagc40trhmqpesyc2u.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour utiliser la file d'attente, nous devons exécuter l'une des commandes artisanales les plus populaires:</font></font><br>
<br>
<pre><code class="php hljs">php artisan queue:work</code></pre><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comme le dit la documentation: </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Laravel inclut un travailleur de file d'attente qui traite les nouvelles tâches lorsqu'elles sont en file d'attente.</font></font></i></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Génial! </font><font style="vertical-align: inherit;">Laravel fournit une interface prête à l'emploi pour les tâches de mise en file d'attente et une commande prête à l'emploi pour récupérer les tâches de la file d'attente et exécuter leur code en arrière-plan.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rôle de superviseur</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'était une autre «chose étrange» au début. Je pense qu'il est normal de découvrir de nouvelles choses. Après cette étape de formation, j'écris ces articles pour m'aider à organiser mes compétences, et en même temps aider d'autres développeurs à étendre leurs connaissances. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si la tâche échoue lors du lancement d'une exception, l'équipe </font></font><code>queue:work</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">arrêtera son travail. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour qu'un processus </font></font><code>queue:work</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s'exécute en continu (consommant vos files d'attente), vous devez utiliser un moniteur de processus tel que Supervisor pour vous assurer que la commande </font></font><code>queue:work</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ne s'arrête pas de fonctionner même si la tâche lève une exception. </font><font style="vertical-align: inherit;">Supervisor </font><font style="vertical-align: inherit;">redémarre la commande après qu'elle se bloque, en commençant à nouveau de la tâche suivante, en mettant de côté l'exception de lancement.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les tâches s'exécuteront en arrière-plan sur votre serveur, ne dépendant plus de la requête HTTP. </font><font style="vertical-align: inherit;">Cela introduit quelques modifications que j'ai dû prendre en compte lors de l'implémentation du code de tâche. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici les plus importants auxquels je ferai attention:</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comment savoir que le code de tâche ne fonctionne pas?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lors de l'exécution en arrière-plan, vous ne pouvez pas immédiatement remarquer que votre tâche provoque des erreurs. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous n'aurez plus de commentaires immédiats, comme lors d'une demande http depuis votre navigateur. </font><font style="vertical-align: inherit;">Si la tâche échoue, elle le fera en silence et personne ne le remarquera. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Envisagez d'intégrer un outil de surveillance en temps réel tel que l' </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">inspecteur</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour détecter chaque défaut.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vous n'avez pas de demande http</font></font></h3><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il n'y a plus de requête HTTP. </font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Votre code sera exécuté à partir de cli. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous avez besoin de paramètres de requête pour terminer vos tâches, vous devez les transmettre au constructeur de tâches pour une utilisation ultérieure au moment de l'exécution:</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-meta">&lt;?php</span><font></font>
<font></font>
<span class="hljs-comment">//   </span><font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TagUserJob</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">ShouldQueue</span>
</span>{
    <span class="hljs-keyword">public</span> $data;<font></font>
    <font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-keyword">array</span> $data</span>)
    </span>{
        <span class="hljs-keyword">$this</span>-&gt;data = $data;<font></font>
    }<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//       </span><font></font>
<font></font>
<span class="hljs-keyword">$this</span>-&gt;dispatch(<span class="hljs-keyword">new</span> TagUserJob($request-&gt;all()));</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vous ne savez pas qui s'est connecté</font></font></h3><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il n'y a plus de session</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">De la même manière, vous ne connaîtrez pas l'identité de l'utilisateur connecté, donc si vous avez besoin d'informations sur l'utilisateur pour terminer la tâche, vous devez passer l'objet utilisateur au constructeur de la tâche:</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-meta">&lt;?php</span><font></font>
<font></font>
<span class="hljs-comment">//   </span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TagUserJob</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">ShouldQueue</span>
</span>{
    <span class="hljs-keyword">public</span> $user;<font></font>
    <font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params">User $user</span>)
    </span>{
        <span class="hljs-keyword">$this</span>-&gt;user= $user;<font></font>
    }<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//       </span>
<span class="hljs-keyword">$this</span>-&gt;dispatch(<span class="hljs-keyword">new</span> TagUserJob($request-&gt;user()));</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comprendre comment évoluer</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Malheureusement, dans de nombreux cas, cela ne suffit pas. </font><font style="vertical-align: inherit;">Utiliser une seule ligne et un consommateur peut vite devenir inutile. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les files d'attente sont des tampons FIFO («premier entré, premier sorti»). </font><font style="vertical-align: inherit;">Si vous avez planifié beaucoup de tâches, peut-être même de types différents, ils doivent attendre que d'autres terminent leurs tâches avant de terminer. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il existe deux façons de faire évoluer: </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">plusieurs consommateurs par file d'attente.</font></font></b><br>
<br>
<img src="https://habrastorage.org/webt/id/uu/0j/iduu0jzihjoqnm95edxdox7swim.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Ainsi, cinq tâches seront supprimées de la file d'attente à la fois, ce qui accélérera le traitement de la file d'attente. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Files d'attente à usage spécial</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Vous pouvez également créer des files d'attente spécifiques pour chaque type de tâche à lancer avec un consommateur dédié pour chaque file d'attente.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/3r/0i/gv/3r0igvjwxthteiiqrx7p8exouz8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainsi, chaque file d'attente sera traitée indépendamment, sans attendre la fin des autres types de tâches.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Horizon</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Laravel Horizon est un gestionnaire de files d'attente qui vous donne un contrôle total sur le nombre de files d'attente que vous souhaitez configurer et la capacité d'organiser les consommateurs, permettant aux développeurs de combiner ces deux stratégies et de mettre en œuvre celle qui convient à vos besoins d'évolutivité. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le lancement se fait à travers l' </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">horizon d'artisan php</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> au lieu de la </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">file d'attente d'artisan php: travail</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Cette commande analyse votre fichier de configuration </font></font><code>horizon.php</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et démarre une série de travailleurs de file d'attente en fonction de la configuration:</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-meta">&lt;?php</span><font></font>
<font></font>
<span class="hljs-string">'production'</span> =&gt; [
    <span class="hljs-string">'supervisor-1'</span> =&gt; [
        <span class="hljs-string">'connection'</span> =&gt; <span class="hljs-string">"redis"</span>,
        <span class="hljs-string">'queue'</span> =&gt; [<span class="hljs-string">'adveritisement'</span>, <span class="hljs-string">'logs'</span>, <span class="hljs-string">'phones'</span>],
        <span class="hljs-string">'processes'</span> =&gt; <span class="hljs-number">9</span>,
        <span class="hljs-string">'tries'</span> =&gt; <span class="hljs-number">3</span>,
        <span class="hljs-string">'balance'</span> =&gt; <span class="hljs-string">'simple'</span>, <span class="hljs-comment">//   simple, auto  null</span><font></font>
<font></font>
    ]<font></font>
]<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans l'exemple ci-dessus, Horizon démarre trois files d'attente avec trois processus affectés pour traiter chaque file d'attente. </font><font style="vertical-align: inherit;">Comme mentionné dans la documentation Laravel, l'approche basée sur le code d'Horizon permet à ma configuration de rester dans un système de contrôle de version où mon équipe peut collaborer. </font><font style="vertical-align: inherit;">C'est la solution parfaite en utilisant un outil CI. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour découvrir la signification des paramètres de configuration en détail, lisez </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ce merveilleux article</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ma propre configuration</font></font></h3><br>
<br>
<pre><code class="php hljs"><span class="hljs-meta">&lt;?php</span><font></font>
<font></font>
<span class="hljs-string">'production'</span> =&gt; [
    <span class="hljs-string">'supervisor-1'</span> =&gt; [
        <span class="hljs-string">'connection'</span> =&gt; <span class="hljs-string">'redis'</span>,
        <span class="hljs-string">'queue'</span> =&gt; [<span class="hljs-string">'default'</span>, <span class="hljs-string">'ingest'</span>, <span class="hljs-string">'notifications'</span>],
        <span class="hljs-string">'balance'</span> =&gt; <span class="hljs-string">'auto'</span>,
        <span class="hljs-string">'processes'</span> =&gt; <span class="hljs-number">15</span>,
        <span class="hljs-string">'tries'</span> =&gt; <span class="hljs-number">3</span>,<font></font>
    ],<font></font>
]</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Inspector utilise principalement trois files d'attente:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ingérer des processus d'analyse de données provenant d'applications externes;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">les notifications sont utilisées pour planifier immédiatement les notifications si une erreur est détectée lors de la réception des données;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">la valeur par défaut est utilisée pour d'autres tâches que je ne veux pas mélanger avec </font><i><font style="vertical-align: inherit;">les</font></i><font style="vertical-align: inherit;"> processus d' </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">acquisition</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">notification</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Grâce à l'utilisation d' </font></font><code>balance=auto</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Horizon, il comprend que le nombre maximum de processus activés est de 15, qui seront distribués dynamiquement en fonction du chargement des files d'attente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si les files d'attente sont vides, Horizon prend en charge un processus actif pour chaque file d'attente, ce qui permet au consommateur de traiter immédiatement la file d'attente si une tâche est planifiée.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Observations finales</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'exécution simultanée en arrière-plan peut provoquer de nombreuses autres erreurs imprévisibles, telles que MySQL "Lock timed out" et de nombreux autres problèmes de conception. </font><font style="vertical-align: inherit;">En savoir plus </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'espère que cet article vous a aidé à utiliser les files d'attente et les tâches avec plus de confiance. </font><font style="vertical-align: inherit;">Si vous voulez en savoir plus sur nous, visitez notre site Web à </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">www.inspector.dev </font></font></a><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Précédemment publié ici </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">www.inspector.dev/what-worked-for-me-using-laravel-queues-from-the-basics-to -horizon</font></font></a></i><br>
<br>
<hr><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Suivez le cours et bénéficiez d'une remise.</font></font><br>
</a><br>
<hr></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr499490/index.html">Algorithmes aléatoires</a></li>
<li><a href="../fr499492/index.html">Est-il possible pour un développeur de la Silicon Valley de devenir millionnaire? Ingénieur d'état-major analysant à Lyft</a></li>
<li><a href="../fr499502/index.html">Pourquoi OceanStor Dorado V6 est le stockage le plus rapide et le plus fiable</a></li>
<li><a href="../fr499504/index.html">Protocole de suivi des contacts Bluetooth Apple et Google</a></li>
<li><a href="../fr499506/index.html">Paiement horaire, pour le résultat ou le salaire?</a></li>
<li><a href="../fr499512/index.html">AHK au minimum. Classeur</a></li>
<li><a href="../fr499516/index.html">Début des tests bêta du plugin pour Rider et PVS-Studio C # pour Linux / macOS</a></li>
<li><a href="../fr499518/index.html">La vidéoconférence est désormais un marché et de nouvelles technologies. Longrid, première partie</a></li>
<li><a href="../fr499522/index.html">Toutes les innovations de Windows 10 2004 (20H1)</a></li>
<li><a href="../fr499524/index.html">Quarkus: mises à niveau d'applications utilisant l'exemple helloworld de JBoss EAP Quickstart</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>