<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>💲 👨🏽‍🔬 👨🏻‍💼 Divulgation de numéro de téléphone et géolocalisation par vulnérabilité dans Telegram 💞 🗃️ 🍗</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Récemment, Telegram a de plus en plus discuté du sujet de la percée des personnes et de la fuite de données personnelles. Je me demandais à quel point...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Divulgation de numéro de téléphone et géolocalisation par vulnérabilité dans Telegram</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/495990/"><img src="https://habrastorage.org/webt/ve/mw/s5/vemws5sils-r3vtvvr7rg162sdw.jpeg" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Récemment, Telegram a de plus en plus discuté du sujet de la percée des personnes et de la fuite de données personnelles. </font><font style="vertical-align: inherit;">Je me demandais à quel point l'écosystème Telegram lui-même résiste à de telles fuites. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sous la coupe se trouve l'histoire de la façon dont j'ai trouvé un bug dans Telegram. </font><font style="vertical-align: inherit;">Le bogue vous permet d'induire l'utilisateur en erreur et de le pousser à partager sans le savoir ses données - géolocalisation et numéro de téléphone.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici comment ça fonctionne:</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/o8N0kjurgfo" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La complexité du système a toujours été un ennemi de la sécurité. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Telegram a grandi, a cessé d'être un simple messager et est devenu une grande plate-forme multimédia dotée de fonctionnalités riches. L'API Telegram Bot se démarque comme une maison séparée, vous permettant de créer des applications entières à l'intérieur du messager - les soi-disant bots. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Très probablement, tous ceux qui ont essayé de créer leur propre bot savent déjà que l'utilisateur peut recevoir une demande pour son numéro de téléphone à l'aide d'un bouton spécial. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le texte de ce bouton peut être défini sur n'importe lequel. De plus, le bot peut utiliser les mêmes boutons pour d'autres interactions: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/tr/c7/k8/trc7k8xz2pvmmzac1pfbwxdlxqi.jpeg" alt="image" width="300"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Après avoir cliqué sur le bouton, l'utilisateur recevra bien sûr un avertissement que son contact sera désormais envoyé au bot:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/su/5t/rk/su5trkfoqcrvxad8wg82xegm3bg.png" alt="image" width="300"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce message parle assez clairement du risque de désanonymisation et avertit l'utilisateur réfléchi des actions dangereuses pour lui. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En parcourant les mises à jour de l'API, je me suis souvenu qu'à un moment donné, Telegram avait donné aux utilisateurs la possibilité de faire leur propre localisation du messager. Il y avait des exemples où la localisation était utilisée pour des modifications comiques de l'interface. À ce moment-là, la même pensée m'est venue que vous pourriez maintenant: </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mais que faire si vous essayez de "traduire comiquement" une boîte de dialogue avertissant l'utilisateur de transférer le numéro de téléphone au bot, en remplaçant son texte?</font></font></i><br>
<br>
<img src="https://habrastorage.org/webt/s_/gj/ed/s_gjeddr_shl8q4ghctcrur4g4s.png" alt="image" width="300"> <img src="https://habrastorage.org/webt/xt/cm/il/xtcmilq-vxhoyslwjpn8uolmhrs.png" alt="image" width="300"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Au début, je pensais qu'obtenir un utilisateur pour installer une localisation de fichier xml étrangère dans l'application serait beaucoup plus difficile que de simplement convaincre de cliquer sur Partager le contact. En effet, tout comme cela, à l'aide d'un fichier xml, Telegram a proposé de répartir ses localisations entre interlocuteurs. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai donc pensé, jusqu'à ce que je tombe sur le </font><font style="vertical-align: inherit;">gestionnaire de liens setlanguage dans le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">code source de l'application Android</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qs/nm/xv/qsnmxvjbble2rnvl-ufuadej46w.png" alt="image" width="600"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Exactement ce qui est nécessaire! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il s'est avéré que Telegram avait depuis longtemps créé une plate-forme de traduction, translations.telegram.org, accessible à tous les utilisateurs de Telegram, et maintenant vous n'avez plus besoin de transférer de fichiers xml. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ws/rs/ov/wsrsovq81u4lsjh10u2dxoj3kjk.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cliquez simplement sur le lien </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t.me/setlanguage/%lang%</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, après quoi l'utilisateur verra une boîte de dialogue vous demandant d'installer une nouvelle langue. </font><font style="vertical-align: inherit;">Et cette fenêtre est beaucoup moins intimidante qu'un message sur une demande de numéro de téléphone:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/uo/yu/mp/uoyumprj8sk-0mil-xflt1lqjre.png" alt="image" width="300"><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comment ça fonctionne?</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Inscrivez-vous sur </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">translations.telegram.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ajoutez votre langue, traduisez les </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">éléments d'interface</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nécessaires </font><font style="vertical-align: inherit;">et </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">quelques autres</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans la localisation, vous pouvez écrire tout ce que vous voulez. Nous écrirons un texte inoffensif au lieu d'un avertissement terrible sur le partage de la géolocalisation et du numéro de téléphone. Nous faisons de même pour les autres plateformes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Notre langage empoisonné est prêt. Reste à le glisser à l'utilisateur. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/-w/aq/38/-waq38nqpnrd9a07kthuuuybsmk.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je ne pouvais toujours pas trouver un moyen de savoir si l'utilisateur avait installé la localisation qui lui était proposée. Il n'y avait pas de statistiques linguistiques sur translations.telegram.org, ni de changements dans le profil utilisateur. L'API Bot vous permet de découvrir la langue de l'utilisateur via </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">le paramètre language_code</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, mais sa valeur est tirée des paramètres système. </font><font style="vertical-align: inherit;">La modification de la langue dans l'application n'affecte pas le paramètre. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eh bien, ajoutez simplement un peu de retard après le message avec un lien vers la langue. </font><font style="vertical-align: inherit;">Après avoir choisi une langue, nous suggérons à l'utilisateur de se familiariser avec le menu du bot. </font><font style="vertical-align: inherit;">Lorsque vous cliquez sur OK dans cette boîte de dialogue, le nombre fuit vers le bot avec un message et le bot supprime ce message immédiatement. </font><font style="vertical-align: inherit;">Si le bot utilise le webhook pour recevoir des mises à jour, le message est supprimé plus rapidement et l'utilisateur peut ne pas comprendre qu'il vient d'envoyer son contact. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Soit dit en passant, de la même manière qu'une demande de contact, un bot peut demander à un utilisateur de partager sa géolocalisation. </font><font style="vertical-align: inherit;">Oui, et cette boîte de dialogue peut également être «traduite».</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comment réparer</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De toute évidence, vous ne devez pas permettre aux utilisateurs de traduire absolument l'intégralité de l'interface sans modération. Par ailleurs, la modération de la traduction est activée, par exemple, pour cette boîte de dialogue </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">translations.telegram.org/rutech/ios/unsorted/AuthCode.Alert</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Le besoin de modération nous est signalé par le label Critique. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ek/mq/1v/ekmq1vbreb7dxbm005uvbkx7rua.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il s'avère qu'une aussi petite omission que l'absence d'étiquette critique pour les dialogues sur le partage des numéros et la géolocalisation conduit à une fuite. Une fuite de données très sensibles, comme pour un messager construisant son marketing autour de la confidentialité / sécurité. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un messager lié à votre numéro de téléphone personnel, par définition, ne peut pas être privé. Cela ne peut qu'augmenter le coût de la révélation de votre identité. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cette vulnérabilité est tombée dans le programme de télégramme bug bounty et a été évaluée à 100 €.</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Venez nous voir au Telegram chat </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@secinfosec</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Nous y partageons notre expérience et discutons de tout ce qui concerne la sécurité de l'information: un bug de prime, des pentests, une sécurité papier et pratique, de nouvelles menaces et de nouvelles méthodes pour y faire face.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr495978/index.html">Trois niveaux d'analyse d'audience: à la recherche d'informations</a></li>
<li><a href="../fr495980/index.html">Comment démonter le Tesla Model 3, le modifier avec un fichier et fabriquer un ventilateur</a></li>
<li><a href="../fr495982/index.html">Nous étudions le moteur VoIP Mediastreamer2. Partie 4</a></li>
<li><a href="../fr495984/index.html">React, performance et -500 millisecondes au lancement - l'historique de nos optimisations en chiffres</a></li>
<li><a href="../fr495986/index.html">Analyse de documents internationaux sur la gestion des risques de sécurité de l'information. Partie 2</a></li>
<li><a href="../fr495994/index.html">Début du trimestre académique ou comment je suis devenu coordinateur de l'enseignement à distance</a></li>
<li><a href="../fr495996/index.html">Raspberry Pi, Python et arrosage des plantes d'intérieur</a></li>
<li><a href="../fr495998/index.html">Création d'un thème sombre pour le débordement de pile</a></li>
<li><a href="../fr496004/index.html">Nouveaux modèles de recherche et d'analyse de données. WSDM 2020 à travers les yeux de l'équipe Yandex.Tolki</a></li>
<li><a href="../fr496006/index.html">Proxy inverse dépassé - technologie pour la protection à distance et l'optimisation du site sans modifier les enregistrements DNS A</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>