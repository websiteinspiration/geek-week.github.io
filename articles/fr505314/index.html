<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ÅâÔ∏è üèûÔ∏è üé± Synchronisation de l'heure Linux: NTP, Chrony et systemd-timesyncd üë®‚Äçüî¨ üêπ üï∫üèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="La plupart des gens suivent le temps. Nous nous levons √† l'heure pour effectuer nos rituels du matin et allons au travail, prenons une pause pour le d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Synchronisation de l'heure Linux: NTP, Chrony et systemd-timesyncd</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/vdsina/blog/505314/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/m-/ts/k3/m-tsk33gxcmkrlh4yuqdaxl4ytk.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La plupart des gens suivent le temps. </font><font style="vertical-align: inherit;">Nous nous levons √† l'heure pour effectuer nos rituels du matin et allons au travail, prenons une pause pour le d√©jeuner, respectons les d√©lais du projet, c√©l√©brons les anniversaires et les vacances, montons √† bord d'un avion, etc. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De plus: certains d'entre nous sont obs√©d√©s par le temps. </font><font style="vertical-align: inherit;">Ma montre est aliment√©e par l'√©nergie solaire et re√ßoit l'heure exacte de l'Institut national des normes et de la technologie ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NIST</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) √† Fort Collins, Colorado, via </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">la</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> radio √† longue longueur d'onde </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">de WWVB</font></a><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Les signaux horaires sont synchronis√©s avec l'horloge atomique, √©galement situ√©e √† Fort Collins. </font><font style="vertical-align: inherit;">Mon Fitbit se synchronise avec mon t√©l√©phone, qui se synchronise avec le serveur </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NTP</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , qui se synchronise finalement avec l'horloge atomique.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les appareils suivent √©galement le temps</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il existe de nombreuses raisons pour lesquelles nos appareils et ordinateurs ont besoin d'une heure pr√©cise. Par exemple, dans les banques, les march√©s boursiers et d'autres entreprises financi√®res, les transactions doivent √™tre effectu√©es dans le bon ordre et des s√©quences temporelles pr√©cises sont essentielles √† cet effet. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nos t√©l√©phones, tablettes, voitures, syst√®mes GPS et ordinateurs n√©cessitent des r√©glages pr√©cis de l'heure et de la date. Je veux que l'horloge sur le bureau de mon ordinateur affiche l'heure correcte. Je veux que mon calendrier local re√ßoive des rappels au bon moment. Le bon moment garantit √©galement que les t√¢ches cron et systemd sont d√©marr√©es au bon moment.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La date et l'heure sont √©galement importantes pour la journalisation, il est donc un peu plus facile de trouver certains journaux en fonction de la date et de l'heure. </font><font style="vertical-align: inherit;">Par exemple, j‚Äôai travaill√© une fois chez DevOps (ils ne l‚Äôappelaient pas ainsi √† cette √©poque) et mis en place un syst√®me de messagerie en Caroline du Nord. </font><font style="vertical-align: inherit;">Nous avions l'habitude de traiter plus de 20 millions d'e-mails par jour. </font><font style="vertical-align: inherit;">Le suivi des e-mails via une s√©rie de serveurs ou la d√©termination de la s√©quence exacte des √©v√©nements √† l'aide de fichiers journaux sur des h√¥tes g√©ographiquement distribu√©s peut √™tre beaucoup plus facile si les ordinateurs sont synchronis√©s dans le temps.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Une fois - plusieurs heures</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les h√¥tes Linux doivent savoir qu'il existe une heure syst√®me et une heure RTC. RTC (Real Time Clock) est un nom un peu √©trange et peu pr√©cis pour une horloge mat√©rielle. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'horloge mat√©rielle fonctionne en continu, m√™me lorsque l'ordinateur est √©teint √† l'aide de la batterie de la carte m√®re du syst√®me. La fonction principale de RTC est de stocker l'heure lorsque la connexion au serveur de temps n'est pas disponible. √Ä l'√©poque o√π il √©tait impossible de se connecter au serveur de temps via Internet, chaque ordinateur devait avoir une horloge interne pr√©cise. Les syst√®mes d'exploitation devaient acc√©der √† RTC au d√©marrage et l'utilisateur devait r√©gler manuellement l'heure du syst√®me √† l'aide de l'interface de configuration du BIOS mat√©riel pour s'assurer qu'elle √©tait correcte.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les montres mat√©rielles ne comprennent pas le concept de fuseaux horaires; </font><font style="vertical-align: inherit;">Le RTC ne stocke que l'heure, pas le fuseau horaire ou le d√©calage par rapport √† l'UTC (temps universel coordonn√©, √©galement connu sous le nom de GMT ou Greenwich Mean Time). </font><font style="vertical-align: inherit;">Vous pouvez installer RTC √† l'aide de l'outil, dont je parlerai plus loin dans cet article. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'heure syst√®me est l'heure que le syst√®me d'exploitation affiche sur l'horloge de l'interface graphique de votre bureau, dans la sortie de la commande date, dans les horodatages des journaux. </font><font style="vertical-align: inherit;">Cela s'applique √©galement √† l'heure √† laquelle les fichiers ont √©t√© cr√©√©s, modifi√©s et ouverts. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La page de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">manuel de rtc</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> contient une description compl√®te de RTC et de l'horloge syst√®me.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Qu'est-ce que NTP a?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les ordinateurs du monde entier utilisent NTP (Network Time Protocol) pour synchroniser leur heure avec les horloges de r√©f√©rence standard sur Internet √† l'aide d'une hi√©rarchie de serveurs NTP. Les principaux serveurs horaires sont situ√©s au niveau 1, et ils sont directement connect√©s √† divers services horaires nationaux au niveau 0 via satellite, radio ou m√™me modems via des lignes t√©l√©phoniques. Les services horaires au niveau 0 peuvent √™tre une horloge atomique, un r√©cepteur radio r√©gl√© sur les signaux transmis par l'horloge atomique ou un r√©cepteur GPS utilisant des signaux d'horloge de haute pr√©cision transmis par des satellites GPS.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sur la grande majorit√© des serveurs de r√©f√©rence, plusieurs milliers de serveurs publics NTP stratum 2 sont ouverts, accessibles √† tous. </font><font style="vertical-align: inherit;">De nombreuses organisations et utilisateurs (dont moi) avec un grand nombre d'h√¥tes qui n√©cessitent un serveur NTP pr√©f√®rent installer leurs propres serveurs de temps, donc un seul h√¥te local adresse la strate 2 ou 3. Ensuite, ils configurent les n≈ìuds restants sur le r√©seau pour utiliser le serveur de temps local . </font><font style="vertical-align: inherit;">Dans le cas de mon r√©seau domestique, il s'agit d'un serveur de niveau 3.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Diverses impl√©mentations NTP </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'impl√©mentation initiale de NTP est ntpd. Puis deux plus r√©cents l'ont rejoint, chronyd et systemd-timesyncd. Les trois synchronisent l'heure de l'h√¥te local avec le serveur de temps NTP. Le service systemd-timesyncd n'est pas aussi fiable que chronyd, mais cela suffit dans la plupart des cas. Si RTC n'est pas synchronis√©, il peut progressivement ajuster l'heure syst√®me pour se synchroniser avec le serveur NTP lorsque l'heure syst√®me locale est l√©g√®rement d√©cal√©e. Le service systemd-timesync ne peut pas √™tre utilis√© comme serveur de temps. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chrony</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est une impl√©mentation NTP qui contient deux programmes: le d√©mon chronyd et une interface de ligne de commande appel√©e chronyc. Chrony poss√®de certaines fonctionnalit√©s qui, dans de nombreux cas, sont tout simplement irrempla√ßables:</font></font><br>
<br>
<ul>
<li>Chrony       ,    ntpd.       ,    .</li>
<li>     , ,           ,      -   ,       .</li>
<li>    ,        .</li>
<li>    .</li>
<li>    Chrony    .             .</li>
<li>Chrony       .          .</li>
<li>Chrony     NTP-.</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Encore une fois: NTP est un protocole qui peut √™tre impl√©ment√© sur un h√¥te Linux en utilisant Chrony ou systemd-timesyncd. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les packages RPM NTP, Chrony et systemd-timesyncd sont disponibles dans les r√©f√©rentiels Fedora standard. </font><font style="vertical-align: inherit;">RPM systemd-udev est un gestionnaire d'√©v√©nements du noyau qui est install√© par d√©faut dans Fedora mais n'est pas requis. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez installer les trois et basculer entre eux, mais cela cr√©era un mal de t√™te suppl√©mentaire. </font><font style="vertical-align: inherit;">Il vaut donc mieux ne pas le faire. </font><font style="vertical-align: inherit;">Les versions actuelles de Fedora, CentOS et RHEL ont migr√© vers Chrony en tant qu'impl√©mentation standard, et elles ont √©galement systemd-timesyncd. </font><font style="vertical-align: inherit;">Je crois que Chrony fonctionne bien, offre une meilleure interface que le service NTP, fournit beaucoup plus d'informations et augmente le contr√¥le, ce dont les administrateurs syst√®me appr√©cieront certainement.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D√©sactivation des services NTP </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Votre h√¥te peut d√©j√† avoir le service NTP en cours d'ex√©cution. </font><font style="vertical-align: inherit;">Si c'est le cas, vous devez le d√©sactiver avant de passer √† autre chose. </font><font style="vertical-align: inherit;">J'ai fait fonctionner Chronyd, j'ai donc utilis√© les commandes suivantes pour l'arr√™ter et le d√©sactiver. </font><font style="vertical-align: inherit;">Ex√©cutez les commandes appropri√©es pour tout d√©mon NTP que vous utilisez sur votre h√¥te:</font></font><br>
<br>
<pre><code class="bash hljs">[root@testvm1 ~]<span class="hljs-comment"># systemctl disable chronyd ; systemctl stop chronyd</span><font></font>
Removed /etc/systemd/system/multi-user.target.wants/chronyd.service.<font></font>
[root@testvm1 ~]<span class="hljs-comment">#</span></code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
V√©rifiez que le service est arr√™t√© et d√©sactiv√©:</font></font><br>
<br>
<pre><code class="bash hljs">[root@testvm1 ~]<span class="hljs-comment"># systemctl status chronyd</span><font></font>
‚óè chronyd.service - NTP client/server<font></font>
     Loaded: loaded (/usr/lib/systemd/system/chronyd.service; disabled; vendor preset: enabled)<font></font>
     Active: inactive (dead)<font></font>
       Docs: man:chronyd(8)<font></font>
             man:chrony.conf(5)<font></font>
[root@testvm1 ~]<span class="hljs-comment">#</span></code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V√©rifier l'√©tat avant le lancement</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'√©tat de synchronisation de l'horloge syst√®me vous permet de d√©terminer si le service NTP est en cours d'ex√©cution. </font><font style="vertical-align: inherit;">Comme vous n'avez pas encore d√©marr√© NTP, la commande timesync-status fera allusion √† ceci:</font></font><br>
<br>
<pre><code class="bash hljs">[root@testvm1 ~]<span class="hljs-comment"># timedatectl timesync-status</span>
Failed to query server: Could not activate remote peer.</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une demande d'√©tat directe fournit des informations importantes. </font><font style="vertical-align: inherit;">Par exemple, la commande timedatectl sans argument ni param√®tre ex√©cute la sous-commande d'√©tat par d√©faut:</font></font><br>
<br>
<pre><code class="bash hljs">[root@testvm1 ~]<span class="hljs-comment"># timedatectl status</span><font></font>
           Local time: Fri 2020-05-15 08:43:10 EDT  <font></font>
           Universal time: Fri 2020-05-15 12:43:10 UTC  <font></font>
                 RTC time: Fri 2020-05-15 08:43:08      <font></font>
                Time zone: America/New_York (EDT, -0400)<font></font>
System clock synchronized: no                          <font></font>
              NTP service: inactive                    <font></font>
          RTC <span class="hljs-keyword">in</span> <span class="hljs-built_in">local</span> TZ: yes                    <font></font>
<font></font>
Warning: The system is configured to <span class="hljs-built_in">read</span> the RTC time <span class="hljs-keyword">in</span> the <span class="hljs-built_in">local</span> time zone.<font></font>
         This mode cannot be fully supported. It will create various problems<font></font>
         with time zone changes and daylight saving time adjustments. The RTC<font></font>
         time is never updated, it relies on external facilities to maintain it.<font></font>
         If at all possible, use RTC <span class="hljs-keyword">in</span> UTC by calling
         <span class="hljs-string">'timedatectl set-local-rtc 0'</span>.<font></font>
[root@testvm1 ~]<span class="hljs-comment">#</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainsi, vous obtenez l'heure locale de votre h√¥te, l'heure UTC et l'heure RTC. Dans ce cas, l'heure syst√®me est d√©finie sur le fuseau horaire America / New_York (TZ), RTC est d√©fini sur l'heure du fuseau horaire local et le service NTP n'est pas actif. L'heure RTC a commenc√© √† s'√©carter l√©g√®rement de l'heure syst√®me. Ceci est normal pour les syst√®mes dont les horloges n'ont pas √©t√© synchronis√©es. La quantit√© de d√©calage sur l'h√¥te d√©pend du temps √©coul√© depuis la derni√®re synchronisation du syst√®me.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons √©galement re√ßu un avertissement concernant l'utilisation de l'heure locale pour RTC - cela s'applique aux modifications du fuseau horaire et des param√®tres d'heure d'√©t√©. </font><font style="vertical-align: inherit;">Si l'ordinateur est √©teint au moment o√π vous devez apporter des modifications, l'heure RTC ne changera pas. </font><font style="vertical-align: inherit;">Mais pour les serveurs ou autres h√¥tes fonctionnant 24h / 24, ce n'est pas du tout un probl√®me. </font><font style="vertical-align: inherit;">De plus, tout service qui fournit la synchronisation de l'heure NTP ajustera l'heure de l'h√¥te √† la phase de d√©marrage initiale, donc une fois le d√©marrage termin√©, l'heure redeviendra correcte.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R√©glage du fuseau horaire</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Habituellement, vous sp√©cifiez le fuseau horaire au cours de la proc√©dure d'installation et vous n'avez aucune t√¢che pour le modifier √† l'avenir. Cependant, il y a des moments o√π vous devez changer le fuseau horaire. Il existe plusieurs outils qui peuvent vous aider. Linux utilise des fichiers de fuseau horaire pour d√©terminer le fuseau horaire local de l'h√¥te. Ces fichiers se trouvent dans le </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r√©pertoire / usr / share / zoneinfo</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Par d√©faut, pour mon fuseau horaire, le syst√®me √©crit ceci: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ etc / localtime -&gt; ../usr/share/zoneinfo/America/New_York</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Mais vous n'avez pas besoin de conna√Ætre ces subtilit√©s pour modifier le fuseau horaire. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'essentiel est de conna√Ætre le nom officiel du fuseau horaire de votre emplacement et l'√©quipe correspondante. Supposons que vous souhaitiez changer le fuseau horaire pour Los Angeles:</font></font><br>
<br>
<pre><code class="bash hljs">
[root@testvm2 ~]<span class="hljs-comment"># timedatectl list-timezones | column</span><font></font>
&lt;SNIP&gt;<font></font>
America/La_Paz                  Europe/Budapest<font></font>
America/Lima                    Europe/Chisinau<font></font>
America/Los_Angeles             Europe/Copenhagen<font></font>
America/Maceio                  Europe/Dublin<font></font>
America/Managua                 Europe/Gibraltar<font></font>
America/Manaus                  Europe/Helsinki<font></font>
&lt;SNIP&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez maintenant d√©finir le fuseau horaire. </font><font style="vertical-align: inherit;">J'ai utilis√© la commande date pour v√©rifier les changements, mais vous pouvez √©galement utiliser timedatectl:</font></font><br>
<br>
<pre><code class="bash hljs">[root@testvm2 ~]<span class="hljs-comment"># date</span><font></font>
Tue 19 May 2020 04:47:49 PM EDT<font></font>
[root@testvm2 ~]<span class="hljs-comment"># timedatectl set-timezone America/Los_Angeles</span>
[root@testvm2 ~]<span class="hljs-comment"># date</span><font></font>
Tue 19 May 2020 01:48:23 PM PDT<font></font>
[root@testvm2 ~]<span class="hljs-comment">#</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, vous pouvez √† nouveau changer le fuseau horaire de votre h√¥te en heure locale.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systemd-timesyncd</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le d√©mon timesync systemd fournit une impl√©mentation NTP facile √† g√©rer dans le contexte de systemd. </font><font style="vertical-align: inherit;">Il est install√© par d√©faut dans Fedora et Ubuntu. </font><font style="vertical-align: inherit;">Cependant, il d√©marre par d√©faut uniquement dans Ubuntu. </font><font style="vertical-align: inherit;">Je ne suis pas s√ªr des autres distributions. </font><font style="vertical-align: inherit;">Vous pouvez v√©rifier par vous-m√™me:</font></font><br>
<br>
<pre><code class="bash hljs">[root@testvm1 ~]<span class="hljs-comment"># systemctl status systemd-timesyncd</span></code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configuration de systemd-timesyncd</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le fichier de configuration de systemd-timesyncd est </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/systemd/timesyncd.conf</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Il s'agit d'un fichier simple avec moins d'options incluses que dans les anciens services NTP et chronyd. </font><font style="vertical-align: inherit;">Voici le contenu de ce fichier (sans autres modifications) sur ma machine virtuelle Fedora:</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-comment">#  This file is part of systemd.</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">#  systemd is free software; you can redistribute it and/or modify it</span>
<span class="hljs-comment">#  under the terms of the GNU Lesser General Public License as published by</span>
<span class="hljs-comment">#  the Free Software Foundation; either version 2.1 of the License, or</span>
<span class="hljs-comment">#  (at your option) any later version.</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># Entries in this file show the compile time defaults.</span>
<span class="hljs-comment"># You can change settings by editing this file.</span>
<span class="hljs-comment"># Defaults can be restored by simply deleting this file.</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># See timesyncd.conf(5) for details.</span><font></font>
<font></font>
[Time]<font></font>
<span class="hljs-comment">#NTP=</span>
<span class="hljs-comment">#FallbackNTP=0.fedora.pool.ntp.org 1.fedora.pool.ntp.org 2.fedora.pool.ntp.org 3.fedora.pool.ntp.org</span>
<span class="hljs-comment">#RootDistanceMaxSec=5</span>
<span class="hljs-comment">#PollIntervalMinSec=32</span>
<span class="hljs-comment">#PollIntervalMaxSec=2048</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La seule section qu'il contient, √† part les commentaires, est [Time]. </font><font style="vertical-align: inherit;">Toutes les autres lignes sont comment√©es. </font><font style="vertical-align: inherit;">Ce sont les valeurs par d√©faut, elles n'ont pas besoin d'√™tre modifi√©es (sauf si vous avez une raison √† cela). </font><font style="vertical-align: inherit;">Si vous n'avez pas le serveur de temps NTP d√©fini dans la ligne NTP =, Fedora utilise le serveur de temps de sauvegarde Fedora par d√©faut. </font><font style="vertical-align: inherit;">J'ajoute g√©n√©ralement mon serveur de temps:</font></font><br>
<br>
<pre><code class="bash hljs">NTP=myntpserver</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lancer la synchronisation horaire</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez d√©marrer et activer systemd-timesyncd comme ceci:</font></font><br>
<br>
<pre><code class="bash hljs">[root@testvm2 ~]<span class="hljs-comment"># systemctl enable systemd-timesyncd.service</span><font></font>
Created symlink /etc/systemd/system/dbus-org.freedesktop.timesync1.service ‚Üí /usr/lib/systemd/system/systemd-timesyncd.service.<font></font>
Created symlink /etc/systemd/system/sysinit.target.wants/systemd-timesyncd.service ‚Üí /usr/lib/systemd/system/systemd-timesyncd.service.<font></font>
[root@testvm2 ~]<span class="hljs-comment"># systemctl start systemd-timesyncd.service</span>
[root@testvm2 ~]<span class="hljs-comment">#</span></code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Installation de l'horloge mat√©rielle</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici √† quoi ressemble la situation apr√®s l'ex√©cution de timesyncd:</font></font><br>
<br>
<pre><code class="bash hljs">[root@testvm2 systemd]<span class="hljs-comment"># timedatectl</span><font></font>
               Local time: Sat 2020-05-16 14:34:54 EDT  <font></font>
           Universal time: Sat 2020-05-16 18:34:54 UTC  <font></font>
                 RTC time: Sat 2020-05-16 14:34:53      <font></font>
                Time zone: America/New_York (EDT, -0400)<font></font>
System clock synchronized: yes                          <font></font>
              NTP service: active                      <font></font>
          RTC <span class="hljs-keyword">in</span> <span class="hljs-built_in">local</span> TZ: no    </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Initialement, la diff√©rence entre RTC et l'heure locale (EDT) ne d√©passe pas une seconde, et l'√©cart augmente de quelques secondes au cours des prochains jours. Puisqu'il n'y a aucun concept de fuseaux horaires dans RTC, la commande timedatectl doit effectuer une comparaison pour d√©terminer le fuseau horaire souhait√©. Si le RTC ne correspond pas exactement √† l'heure locale, il ne correspond pas au fuseau horaire local. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√Ä la recherche de plus d'informations, j'ai v√©rifi√© l'√©tat de systemd-timesync et j'ai trouv√© ceci:</font></font><br>
<br>
<pre><code class="bash hljs">[root@testvm2 systemd]<span class="hljs-comment"># systemctl status systemd-timesyncd.service</span><font></font>
‚óè systemd-timesyncd.service - Network Time Synchronization<font></font>
     Loaded: loaded (/usr/lib/systemd/system/systemd-timesyncd.service; enabled; vendor preset: disabled)<font></font>
     Active: active (running) since Sat 2020-05-16 13:56:53 EDT; 18h ago<font></font>
       Docs: man:systemd-timesyncd.service(8)<font></font>
   Main PID: 822 (systemd-timesyn)<font></font>
     Status: <span class="hljs-string">"Initial synchronization to time server 163.237.218.19:123 (2.fedora.pool.ntp.org)."</span>
      Tasks: 2 (<span class="hljs-built_in">limit</span>: 10365)<font></font>
     Memory: 2.8M<font></font>
        CPU: 476ms<font></font>
     CGroup: /system.slice/systemd-timesyncd.service<font></font>
             ‚îî‚îÄ822 /usr/lib/systemd/systemd-timesyncd<font></font>
<font></font>
May 16 09:57:24 testvm2.both.org systemd[1]: Starting Network Time Synchronization...<font></font>
May 16 09:57:24 testvm2.both.org systemd-timesyncd[822]: System clock time <span class="hljs-built_in">unset</span> or jumped backwards, restoring from recorded timestamp: Sat 2020-05-16 13:56:53 EDT<font></font>
May 16 13:56:53 testvm2.both.org systemd[1]: Started Network Time Synchronization.<font></font>
May 16 13:57:56 testvm2.both.org systemd-timesyncd[822]: Initial synchronization to time server 163.237.218.19:123 (2.fedora.pool.ntp.org).<font></font>
[root@testvm2 systemd]<span class="hljs-comment">#</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Faites attention au message du journal, qui indique que l'heure syst√®me n'est pas d√©finie ou r√©initialis√©e. </font><font style="vertical-align: inherit;">Le service Timesync d√©finit l'heure syst√®me en fonction d'un horodatage. </font><font style="vertical-align: inherit;">Les horodatages sont conserv√©s par le d√©mon timesync et sont cr√©√©s √† chaque synchronisation r√©ussie. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La commande timedatectl n'est pas en mesure de prendre la valeur de l'horloge mat√©rielle de l'horloge syst√®me. </font><font style="vertical-align: inherit;">Elle ne peut r√©gler l'heure et la date qu'√† partir de la valeur entr√©e sur la ligne de commande. </font><font style="vertical-align: inherit;">Vous pouvez d√©finir RTC sur la m√™me valeur que l'heure syst√®me √† l'aide de la commande hwclock:</font></font><br>
<br>
<pre><code class="bash hljs">[root@testvm2 ~]<span class="hljs-comment"># /sbin/hwclock --systohc --localtime</span>
[root@testvm2 ~]<span class="hljs-comment"># timedatectl</span><font></font>
               Local time: Mon 2020-05-18 13:56:46 EDT  <font></font>
           Universal time: Mon 2020-05-18 17:56:46 UTC  <font></font>
                 RTC time: Mon 2020-05-18 13:56:46      <font></font>
                Time zone: America/New_York (EDT, -0400)<font></font>
System clock synchronized: yes                          <font></font>
              NTP service: active                      <font></font>
          RTC <span class="hljs-keyword">in</span> <span class="hljs-built_in">local</span> TZ: yes</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'option --localtime indique que l'horloge mat√©rielle affiche l'heure locale, pas UTC.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pourquoi avez-vous besoin de RTC?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Toute impl√©mentation NTP d√©finira l'horloge syst√®me au d√©marrage. </font><font style="vertical-align: inherit;">Et puis pourquoi RTC? </font><font style="vertical-align: inherit;">Ce n'est pas tout √† fait vrai: cela ne se produira que si vous avez une connexion r√©seau √† un serveur de temps. </font><font style="vertical-align: inherit;">Cependant, de nombreux syst√®mes n'ont pas un acc√®s constant √† la connexion r√©seau, donc l'horloge mat√©rielle est utile pour Linux pour d√©finir l'heure syst√®me en fonction d'eux. </font><font style="vertical-align: inherit;">C'est mieux que de r√©gler l'heure manuellement, m√™me si elle peut s'√©carter du temps r√©el.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cet article pr√©sente certains outils de gestion de la date, de l'heure et des fuseaux horaires. L'outil systemd-timesyncd fournit un client NTP qui peut synchroniser l'heure sur un h√¥te local avec un serveur NTP. Cependant, systemd-timesyncd ne fournit pas de service de serveur, donc si vous avez besoin d'un serveur NTP sur votre r√©seau, vous devez utiliser autre chose - par exemple, Chrony, pour fonctionner comme serveur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je pr√©f√®re avoir une seule impl√©mentation pour tous les services sur mon r√©seau, donc j'utilise Chrony. Si vous n'avez pas besoin d'un serveur NTP local ou si cela ne vous d√©range pas d'utiliser Chrony comme serveur et systemd-timesyncd comme client SNTP. Apr√®s tout, il n'est pas n√©cessaire d'utiliser les fonctionnalit√©s suppl√©mentaires de Chrony en tant que client, si vous √™tes satisfait des fonctionnalit√©s de systemd-timesyncd.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une derni√®re remarque: vous n'√™tes pas oblig√© d'utiliser les outils systemd pour impl√©menter NTP. </font><font style="vertical-align: inherit;">Vous pouvez utiliser l'ancienne version de ntpd, Chrony ou une autre impl√©mentation NTP. </font><font style="vertical-align: inherit;">Apr√®s tout, systemd comprend un grand nombre de services; </font><font style="vertical-align: inherit;">beaucoup d'entre eux sont facultatifs, vous pouvez donc les d√©sactiver et utiliser autre chose √† la place. </font><font style="vertical-align: inherit;">Ce n'est pas un √©norme monstre monolithique. </font><font style="vertical-align: inherit;">Vous n'aimerez peut-√™tre pas systemd ou des parties de celui-ci, mais vous devez prendre une d√©cision √©clair√©e. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'aime l'impl√©mentation NTP dans systemd, mais je pr√©f√®re Chrony car elle convient mieux √† mes besoins. </font><font style="vertical-align: inherit;">C'est Linux, b√©b√© -)</font></font><br>
<br>
<hr><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comme une publicit√©</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
VDSina propose des </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">serveurs pour toutes les t√¢ches</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , une vaste s√©lection de syst√®mes d'exploitation pour une installation automatique, il est possible d'installer n'importe quel syst√®me d'exploitation √† partir de sa propre </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ISO</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , un </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">panneau de commande</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pratique </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">de</font></a><font style="vertical-align: inherit;"> sa propre conception et un paiement quotidien. </font><font style="vertical-align: inherit;">Rappelons que nous avons des serveurs √©ternels qui sont d√©finitivement intemporels;)</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/9fa/cf4/a34/9facf4a348ef01048b4eb5e16ae66daa.png"></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr505298/index.html">Flight of Crew Dragon en photos et vid√©o</a></li>
<li><a href="../fr505300/index.html">L'industrie p√©troli√®re pour les ing√©nieurs, les programmeurs, les math√©maticiens et les masses de travailleurs, partie 1</a></li>
<li><a href="../fr505302/index.html">10 conseils de conception de circuits</a></li>
<li><a href="../fr505306/index.html">Des jeux aux projets de commerce √©lectronique. Modification du programme biennal du Technopark</a></li>
<li><a href="../fr505310/index.html">Ce qui distingue les entreprises technologiquement avanc√©es et comment techlide peut aider votre √©quipe √† se d√©velopper</a></li>
<li><a href="../fr505322/index.html">R√©partiteur du futur: comment va √©voluer son r√¥le dans l'entreprise de services?</a></li>
<li><a href="../fr505330/index.html">Comment ne pas cr√©er une crypto-monnaie √† partir de z√©ro en 3 ans</a></li>
<li><a href="../fr505336/index.html">Comment: Manet ou Monet? Le r√©seau neuronal r√©pond</a></li>
<li><a href="../fr505340/index.html">Les employ√©s de Walmart tentent de prouver que l'IA antivol ne fonctionne pas</a></li>
<li><a href="../fr505342/index.html">L'injection de d√©pendance et le principe d'inversion de d√©pendance NE SONT PAS UN ET M√äME</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>