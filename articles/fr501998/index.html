<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🏮 👩‍🔬 ⛳️ Prix ​​cher des styles. Rapport Yandex 🏞️ 🤨 👨‍✈️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Le chargement de CSS sur une page est une opération de blocage. Si le chargement asynchrone de JavaScript peut ne pas être visible pour l'utilisateur,...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Prix ​​cher des styles. Rapport Yandex</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yandex/blog/501998/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le chargement de CSS sur une page est une opération de blocage. </font><font style="vertical-align: inherit;">Si le chargement asynchrone de JavaScript peut ne pas être visible pour l'utilisateur, alors la lenteur de l'apparition des styles peut pousser un invité impatient à quitter le site. </font><font style="vertical-align: inherit;">Comment charger CSS de manière aussi efficace et transparente que possible pour les utilisateurs? </font><font style="vertical-align: inherit;">Nikita Dubko essaie de comprendre</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DarkMeFoDy</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> du groupe d'interface de recherche Yandex à Minsk.</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/kATRlMrtaaY" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- Bonjour à tous. </font><font style="vertical-align: inherit;">Je vais vous parler des styles. </font><font style="vertical-align: inherit;">Tout le monde parle de TypeScript et TypeScript aujourd'hui. </font><font style="vertical-align: inherit;">Et je vais parler du script de style Cascade.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Peu de temps sur moi. </font><font style="vertical-align: inherit;">Je suis un développeur biélorusse - après le film Dudya, je le dirai partout. </font><font style="vertical-align: inherit;">Vous avez peut-être entendu ma voix dans le podcast Web Standards, et si vous voyez des fautes de frappe dans le fil d'actualités Web Standards, c'est probablement moi aussi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Petit avertissement. </font><font style="vertical-align: inherit;">Il y aura plusieurs folies dans le rapport - traitez tout ce que je dis avec beaucoup de critiques. </font><font style="vertical-align: inherit;">Réfléchissez à la raison pour laquelle vous pouvez utiliser ces techniques et pourquoi vous n'en avez pas besoin. </font><font style="vertical-align: inherit;">Certaines choses seront vraiment folles. </font><font style="vertical-align: inherit;">Aller.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pourquoi?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour commencer - pourquoi parler d'optimisation CSS? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous commencez à chercher dans les moteurs de recherche des téléchargements JS rapides, il y a beaucoup de résultats. Si vous recherchez un chargement CSS rapide, le haut n'affiche même pas le CSS dont vous avez besoin. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/fd/fy/mh/fdfymhsjiglvpavgqbzxrczyqo8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous regardez Google, il y a 111 millions de résultats sur JS et environ CSS sur 26 millions. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alors peut-être que cela n'a pas d'importance? Pourquoi en parler? Si vous recherchez des rapports de performance JS, vous en trouverez beaucoup. Il y a à propos de React, de toutes sortes d'autres frameworks, de Vanilla, etc. Mais à propos de CSS, je n'ai trouvé qu'un seul rapport. Harry Roberts en 2018 a lu un </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rapport</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sympa </font><font style="vertical-align: inherit;">sur les performances CSS. Je pensais avoir trouvé un deuxième </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rapport</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">par Roma Dvornova, «Parsim CSS: conseils et astuces de performance». Mais il s'est avéré être un rapport JS qui analyse CSS. Pas exactement ce dont nous avons besoin. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il s'avère qu'ils ne pensent pas beaucoup au CSS. C'est dommage. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais quand je vais sur le Web, je vois généralement du HTML. Et je vois aussi du CSS qui stylise la page. Mais je ne vois pas JS. JS est une chose qui déplace CSS et HTML sur une page pour que tout soit beau. Ceci est un script. Et si JS ne se charge pas, ce n'est pas aussi mauvais que si CSS ne se charge pas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les erreurs dans JS tombent silencieusement dans la console. Et il est peu probable que l'utilisateur moyen entre dans DevTools pour regarder: "Oh, vous l'avez là, une erreur dans la console." Mais si CSS ne se charge pas, vous ne verrez peut-être pas du tout tout ce dont vous avez besoin. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Soit dit en passant, il existe des études sur le fait que l'essentiel est de faire une première impression.</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">38% des</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> utilisateurs peuvent aller sur le site, et s'ils voient que c'est directement dégoûtant, ils partiront immédiatement. Et </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">88%</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> toléreront, l'utiliseront une fois, puis ils ne reviendront jamais et sont peu susceptibles de conseiller votre site. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant que nous sommes tous assis à la maison, le trafic Internet a particulièrement augmenté. Et nous devons réfléchir à la manière de fournir efficacement des ressources aux utilisateurs. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Essayons de compter du point de vue de Yandex. Si nous pouvons optimiser chaque livraison Yandex pendant 100 ms et donner, disons, 200 millions de pages par jour (je ne connais pas le nombre exact), alors ce jour nous économiserons 0,1 s * 200 millions = 232 personnes-jours. Juste en optimisant la sortie pour 100 millisecondes. Et CSS le fait aussi.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jouons un peu aux détectives et découvrons comment tirer le meilleur parti des styles de chargement.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mesure!</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le tout premier conseil est de toujours tout mesurer. Il est inutile de faire des optimisations théoriquement. Vous pouvez supposer que l'optimisation fonctionne dans votre cas, mais des mesures réelles ne montreront rien de tel. Il s'agit de la règle la plus importante de toute optimisation. </font><font style="vertical-align: inherit;">Andrei Prokopyuk de l'équipe SERP Velocity sur HolyJS </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> très bien </font><font style="vertical-align: inherit;">expliqué </font><font style="vertical-align: inherit;">comment nous procédons </font><font style="vertical-align: inherit;">, je ne vais pas me répéter. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quels outils de mesure existe-t-il? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- Si vous voulez mesurer sur des appareils plus ou moins réels, lents, pas aussi cool que les vôtres, utilisez </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WebPageTest</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . J'y prends habituellement des mesures. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- Vous avez Lighthouse si vous utilisez des navigateurs basés sur Chromium. Lui, comme les mesures locales, montre de très bonnes choses.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- Si vous êtes sûr de pouvoir tout faire vous-même, accédez à DevTools, dans l'onglet Performances. Il a beaucoup de détails, vous pouvez démarrer vos propres métriques et les analyser. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vx/xl/jl/vxxljlbogdfjvd0v2kyqedewfxy.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Naturellement, dans Performance, il est nécessaire de définir des conditions réelles. Vous êtes assis sur votre ordinateur portable cool avec Internet cool dans le bureau, tout est incroyable ici, mais ils viennent à vous et disent: "Je suis lent." Et vous dites: "Tout fonctionne pour moi." Ne fais pas ça. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Essayez toujours de vérifier comment l'utilisateur dans les conditions du métro ou ailleurs utilisera votre site. Pour ce faire, vous devez configurer un Internet très lent. Il est également conseillé de ralentir le CPU, car quelqu'un peut venir chez vous depuis un Nokia 3110. Il a également besoin de montrer le site.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le plus important: mesurer sur de vrais utilisateurs. Il existe une telle métrique, plus précisément, tout un ensemble de métriques - RUM, Real User Monitoring. C'est lorsque vous mesurez non pas ce qui se passe synthétiquement dans votre code, mais des mesures sur de vrais utilisateurs en production. Par exemple, du chargement d'une page à une action. Une action est, par exemple, quelque chose qui fonctionne dans le navigateur ou même un clic sur un élément important. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N'oubliez pas que vous ne développez pas pour les robots. Sotka in Lighthouse - c'est super, c'est vraiment bon. Ainsi, vous remplissez au moins les exigences fixées par le phare. Mais il y a de vrais utilisateurs, et si l'utilisateur n'est pas en mesure de voir la page lorsqu'il se soulève dans Lighthouse, alors vous faites quelque chose de mal.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/z-/fy/cn/z-fycndvddxfylx_s_ahdxjolpc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il y a des paramètres sur lesquels il est important de se concentrer. </font><font style="vertical-align: inherit;">Il s'agit de First Contentful Paint, lorsque le premier contenu apparaît sur votre page avec lequel vous pouvez faire quelque chose, lisez. </font><font style="vertical-align: inherit;">Cette métrique est envoyée dans les navigateurs Chromium, vous pouvez l'obtenir. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/mt/xi/mi/mtximitp8tflgksudiaaporikko.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Récemment, vous pouvez toujours consulter la plus grande peinture riche en contenu. </font><font style="vertical-align: inherit;">Il arrive souvent que vous ayez une page média, et il est important, par exemple, de regarder une photo dessus. </font><font style="vertical-align: inherit;">Ensuite, vous avez besoin de cette métrique particulière.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chargement CSS</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Passons enfin au CSS, comment le CSS est chargé. </font><font style="vertical-align: inherit;">Les réceptions sont connues depuis longtemps. </font><font style="vertical-align: inherit;">Il existe un chemin de rendu critique, un chemin de rendu critique. </font><font style="vertical-align: inherit;">Il s'agit de ce que fait le navigateur depuis le moment de l'envoi de la demande de ressource jusqu'au moment où les pixels sont affichés sur l'écran de l'utilisateur. </font><font style="vertical-align: inherit;">À ce sujet aussi, il y a un tas d'articles et de rapports. </font><font style="vertical-align: inherit;">Mais jetons un coup d'œil à la façon dont ce navigateur le fait.</font></font><br>
<br>
<pre><code class="html hljs xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"ru"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>CSS —  <span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/main.ac74gsac.css"</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il commence à télécharger du HTML, voit des balises. </font><font style="vertical-align: inherit;">Il les analyse progressivement, comprend ce qu'il faut en faire. </font><font style="vertical-align: inherit;">Charges. </font><font style="vertical-align: inherit;">Entré à travers le lien. </font><font style="vertical-align: inherit;">Il doit être utilisé. </font><font style="vertical-align: inherit;">Mais comment? </font><font style="vertical-align: inherit;">Vous devez d'abord le télécharger. </font><font style="vertical-align: inherit;">Le téléchargement est lent. </font><font style="vertical-align: inherit;">Lorsqu'il se charge, il commence à analyser la page davantage.</font></font><br>
<br>
<pre><code class="html hljs xml"> <span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"ru"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>CSS —  <span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/main.ac74gsac.css"</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>-!<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
S'il tombe sur un autre lien, il est à nouveau bloqué et ne permet pas son exécution. </font><font style="vertical-align: inherit;">Bloque JS, bloque l'analyse. </font><font style="vertical-align: inherit;">Et jusqu'à ce qu'il démarre, il ne fait rien. </font><font style="vertical-align: inherit;">Mais ensuite, cela commence à fonctionner davantage.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;link&gt;</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Allons plus loin - que se passe-t-il lorsque vous accédez au lien? </font></font><br>
<br>
<img src="https://habrastorage.org/webt/3w/eb/cs/3webcs2yte1_pqw5nzwvmj_epy4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'enregistrement où nous allons est standard. </font><font style="vertical-align: inherit;">Il y a un style CSS qui se trouve quelque part. </font><font style="vertical-align: inherit;">Maintenant, il est à la mode de mettre toutes les statistiques sur le CDN.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Où aller?</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout d'abord, le navigateur doit comprendre où aller. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/u8/me/ix/u8meixyugzfctlaocm2xzo862po.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il voit l'URL et il doit comprendre cette URL - de quoi s'agit-il? Nous sommes habitués au fait que l'URL est un identifiant de site. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/26/2m/6b/262m6bmfjupam-ega9z7tmpibzk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais physiquement, nous devons obtenir l'adresse IP de cette URL et accéder à la véritable machine physique à l'adresse IP. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ys/nq/ah/ysnqah21cz075zefg6khjupdm-w.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour votre CDN, il recevra un enregistrement DNS et ira directement à l'adresse IP. Comment accélérer dans ce cas? </font></font><br>
<br>
<img src="https://habrastorage.org/webt/lz/cl/sn/lzclsnosywf5yaqi0fihvdefism.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une idée folle est de réduire la distance entre l'utilisateur et le serveur DNS. Prenez et transplantez l'utilisateur. Par exemple, pour afficher le message: «Asseyez-vous plus près» ou «Rapprochez-vous». </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez immédiatement spécifier l'adresse IP dans le lien. Pourquoi devons-nous rechercher le DNS, résoudre les domaines, si vous pouvez donner immédiatement le résultat par adresse IP? C'est une façon folle, mais dans le cas des serveurs DNS mondiaux DDoS, cela peut même vous sauver.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et nous pouvons nous débarrasser de l'obtention d'une adresse IP. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/s4/i0/1v/s4i01v9rasbbahddidnteghzu8a.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En vous tournant vers votre index.html ou vers un autre fichier, vous connaissez déjà l'adresse de domaine où vous allez. Voici juste le cas où, au lieu de stocker des statistiques sur un domaine ou sous-domaine séparé, vous pouvez rapprocher les statistiques de votre domaine, à savoir ce domaine lui-même. Le DNS n'a alors pas besoin d'être résolu, il l'est déjà. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/zn/l1/gg/znl1ggztpsl37dgk1cmfo0ob8c8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons trouvé où aller. Mais nous pouvons faire de telles choses à l'avance pour le navigateur. Si, par exemple, votre feuille de style est chargée beaucoup plus tard via l'arborescence DOM, vous pouvez dire au navigateur en utilisant &lt;link rel = "dns-prefetch"&gt; que "je n'y vais pas encore, mais vous réchaufferez les ressources, j'en aurai certainement besoin plus tard ".</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Avec cette entrée, vous dites au navigateur de descendre et d'obtenir ce DNS. </font><font style="vertical-align: inherit;">Lorsque le lien apparaît dans le code, le navigateur connaît déjà l'adresse IP de ce domaine. </font><font style="vertical-align: inherit;">Vous pouvez faire de telles choses préliminaires. </font><font style="vertical-align: inherit;">La même chose, par exemple, avant d'entrer dans la page suivante, où vous irez certainement. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ok, le navigateur sait où aller. </font><font style="vertical-align: inherit;">Il doit comprendre comment s'y prendre.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comment y aller</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous observons le protocole. Maintenant, bien sûr, https est une exigence directe. L'inclusion de moteurs de recherche marquera vos sites ne figurant pas sur https avec des formulaires comme n'étant pas entièrement sûrs. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai trouvé une incroyable </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://howhttps.works/why-do-we-need-"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">série de</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> bandes dessinées sur le fonctionnement de la carte https. Mais nous sommes des informaticiens, nous adorons les diagrammes complexes et les bandes dessinées amusantes sont trop faciles. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/jq/hh/p1/jqhhp1dzstopvkbbsf70gnkxwpw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ici, j'ai formulé dans mes propres mots comment fonctionne https. Vous obtenez d'abord un certificat SSL de votre serveur. Ensuite, vous devez vérifier le certificat auprès d'une autorité de certification. Ce sont des serveurs spéciaux qui savent ce qui est valide et ce qui ne l'est pas, et peuvent inviter les navigateurs: «oui, tout va bien ici, utilisez ce certificat».</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vient ensuite la génération de clés de communication entre le serveur et le client, le chiffrement, le déchiffrement à l'aide de clés différentes. Le processus est intéressant si vous le regardez en termes de cryptographie. Mais nous voulons accélérer. Comment? </font></font><br>
<br>
<img src="https://habrastorage.org/webt/pq/g1/ue/pqg1ueqmruwadkjjb7ff5sstwu0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous pouvons à nouveau transférer l'utilisateur plus près des serveurs. Nous avons déjà un DNS, maintenant nous pouvons le rapprocher de l'autorité de certification. Et mettre entre ces serveurs sera parfait. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez désactiver https, pourquoi en avons-nous besoin? Nous passons du temps à obtenir un certificat, à chiffrer, à déchiffrer. Pas vraiment. C'est le conseil le plus nuisible du rapport, ne le faites pas. https est la protection des données utilisateur, et http / 2 ne fonctionnera pas sans https, et http / 2 est un autre moyen d'accélérer.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/jq/hh/p1/jqhhp1dzstopvkbbsf70gnkxwpw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il existe également la technologie d'agrafage OCSP. Vous pouvez vérifier un certificat sans autorité de certification. C'est probablement plus proche de DevOps. Vous devez configurer votre serveur d'une certaine manière afin qu'il puisse mettre en cache la réponse de l'autorité de certification et émettre à l'utilisateur: "Croyez-moi, mon certificat est vraiment réel." Ainsi, nous pouvons enregistrer au moins l'étape à laquelle nous nous adressons à l'autorité de certification. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais il y a une nuance - dans Chrome, cela ne fonctionne pas, et pendant longtemps. Mais pour l'utilisateur d'autres navigateurs, vous pouvez accélérer ce processus.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai déjà dit deux fois qu'il était nécessaire de transplanter l'utilisateur, et l'idée monte en flèche - pour rapprocher le serveur de l'utilisateur. Je n'ai rien découvert de nouveau pour toi. Il s'agit d'un CDN, un réseau de distribution de contenu distribué. L'idée est que vous pouvez utiliser sidienki prêt à l'emploi, créer indépendamment votre propre infrastructure et mettre un tas de serveurs à travers le monde, dans la mesure où l'argent et les opportunités vous le permettent. Mais vous devez organiser le serveur afin qu'un utilisateur australien accède aux serveurs australiens. Ici, la vitesse de la lumière joue sur vous, plus la distance est petite, plus les électrons la traversent rapidement. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Creusons plus profondément. Que se passe-t-il d'autre dans la demande? En fait, https n'est qu'un wrapper sur http. Pas seulement un emballage sympa. Et encore plus profond, http est une telle demande de la famille TCP / IP.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/wl/be/sf/wlbesfr8mnsmulrqrlgazdwxa_4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comment les paquets et les octets sont-ils envoyés sur le réseau afin que tous les navigateurs, clients et serveurs communiquent entre eux? </font><font style="vertical-align: inherit;">La première chose qu'un client / serveur fait sur une connexion TCP / IP est une poignée de main. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais en 2020, l'OMS recommande d'éviter les poignées de main. </font><font style="vertical-align: inherit;">Il existe une telle technologie TCP Fast Open. </font><font style="vertical-align: inherit;">Vous pouvez, au moment de la poignée de main, éviter toute la chaîne «Bonjour, je suis un client» - «Bonjour, je suis un serveur» - «Je vous crois» - «Et je vous crois. </font><font style="vertical-align: inherit;">Aller". </font><font style="vertical-align: inherit;">Vous pouvez déjà envoyer des données utiles en ce moment. </font><font style="vertical-align: inherit;">Et si la poignée de main a réussi, une partie des données utiles est passée. </font><font style="vertical-align: inherit;">Il s'agit de TCP Fast Open.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Que ramasser?</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voyons ce que le client doit retirer du serveur. </font><font style="vertical-align: inherit;">L'essentiel n'est pas que le client prenne quelque chose du serveur, mais le serveur donne les données au client. </font><font style="vertical-align: inherit;">Alors vous pourriez penser: User-Agent. </font><font style="vertical-align: inherit;">Je peux obtenir l'agent utilisateur du client, savoir à quel navigateur l'utilisateur s'est connecté. </font><font style="vertical-align: inherit;">Découvrez approximativement s'il ne me trompe pas, ce navigateur.</font></font><br>
<br>
<pre><code class="css hljs"><span class="hljs-selector-class">.example</span> {
    <span class="hljs-attribute">display</span>: -ms-grid;
    <span class="hljs-attribute">display</span>: grid;
    <span class="hljs-attribute">-webkit-transition</span>: all .<span class="hljs-number">5s</span>;
    <span class="hljs-attribute">-o-transition</span>: all .<span class="hljs-number">5s</span>;
    <span class="hljs-attribute">transition</span>: all .<span class="hljs-number">5s</span>;
    <span class="hljs-attribute">-webkit-user-select</span>: none;
       <span class="hljs-attribute">-moz-user-select</span>: none;
        <span class="hljs-attribute">-ms-user-select</span>: none;
            <span class="hljs-attribute">user-select</span>: none;
    <span class="hljs-attribute">background</span>: <span class="hljs-built_in">-webkit-gradient</span>(linear, left top, left bottom, from(white), <span class="hljs-built_in">to</span>(black));
    <span class="hljs-attribute">background</span>: <span class="hljs-built_in">-o-linear-gradient</span>(top, white, black);
    <span class="hljs-attribute">background</span>: <span class="hljs-built_in">linear-gradient</span>(to bottom, white, black);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Disons qu'il s'est connecté depuis Firefox. </font><font style="vertical-align: inherit;">Comme d'habitude, j'ai un assemblage dans lequel l'autoprefixeur est ringard, il a généré un tas de code pour moi. </font><font style="vertical-align: inherit;">Oui, c'est une approche cool que tout fonctionnera partout. </font><font style="vertical-align: inherit;">Mais je sais déjà que l'utilisateur s'est connecté depuis Firefox. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pourquoi ne pas désactiver tous les excès? </font><font style="vertical-align: inherit;">D'accord, il y a beaucoup moins de lignes, nous envoyons moins d'octets, c'est cool. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons une version allégée de SERP, Granny. </font><font style="vertical-align: inherit;">Vitaly Kharisov a parlé d'elle</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vithar</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rapport de</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> classe </font><font style="vertical-align: inherit;">sur les Web Standards Days. Il utilise exactement cette approche. Nous pouvons générer plusieurs bundles et les donner à différents clients de différentes manières. Ils pèsent beaucoup moins, car Firefox obtient le sien, WebKit obtient le sien, et cela fonctionne, c'est vérifié. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/av/3l/rj/av3lrjwxk0h7r1uvu2soqygili8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Plus loin. Nous traitons très probablement les demandes des utilisateurs, nous savons que la personne est autorisée et utilisons certaines informations personnelles pour elle. Il est logique que nous obtenions quelque chose de la base de données. Mais pas tout! Il y a des choses statiques qui ne diffèrent pour aucun des utilisateurs, elles sont exactement les mêmes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
James Akvuh a lu un </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">rapport</font></a><font style="vertical-align: inherit;"> sympa à ce sujet</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">«Rendu côté serveur. </font><font style="vertical-align: inherit;">Fais le toi-même". </font><font style="vertical-align: inherit;">Dans quel but? </font><font style="vertical-align: inherit;">Vous savez déjà que vous avez du HTML et une sorte de CSS identique pour tous les utilisateurs. </font><font style="vertical-align: inherit;">Avant d'aller chercher des données, vous pouvez générer la sortie de ces données statiques, envoyer immédiatement les plus utiles dans un flux depuis le serveur. </font><font style="vertical-align: inherit;">Et après cela - optez pour les données, recevez-les rapidement, convertissez-les en modèles et donnez-les au client. </font><font style="vertical-align: inherit;">Et l'utilisateur verra déjà quelque chose d'utile.</font></font><br>
<br>
<div class="oembed"><div><div style="left: 0; width: 100%; height: 0; position: relative; padding-bottom: 56.25%;"><video controls="" style="top: 0; left: 0; width: 100%; height: 100%; position: absolute;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Votre navigateur ne prend pas en charge la vidéo HTML5.</font></font><source src="https://mefody.dev/talks/css-cost/images/screencast-yandex-prerender.mp4" type="video/mp4"></video></div></div></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous l'avons mis en œuvre il y a longtemps. Nous avons sur SERP, sur la page de recherche principale, deux phases - pré-recherche et post-recherche. La recherche préalable consiste à envoyer toutes les pièces qui n'ont pas besoin de savoir quel utilisateur s'est connecté. On peut déjà lui donner, par exemple, un chapeau. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Autrement dit, nous avons une barre de recherche que l'utilisateur peut commencer à utiliser avant que tout le reste ne se charge. Ceci est utile sur une connexion lente. Nous le faisons, cela fonctionne. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et j'ai aussi parlé de http / 2. Ceci est entièrement pris en charge par les navigateurs modernes, donc si vous ne l'avez pas encore configuré sur votre serveur, essayez au moins de savoir comment le configurer.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Server Push est une technologie géniale qui dit: «Navigateur, je ne vous ai pas encore donné la connaissance que vous avez besoin d'une sorte de CSS. Mais je sais exactement ce qui est nécessaire. Alors tenez-le, préchargez-le. " </font></font><br>
<br>
<img src="https://habrastorage.org/webt/6b/hr/do/6bhrdomeghpruxrhggwss8lpe4a.png"><br>
<br>
<img src="https://habrastorage.org/webt/0_/h-/eo/0_h-eognhuhs4pp55sj0rzltkly.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est pas difficile. Vous devez configurer quelques en-têtes sur le serveur et tout commencera à fonctionner. Si le navigateur ne connaît pas ce titre, rien ne se cassera, c'est le plus beau. Creusons encore plus loin. TCP Nous en avons déjà parlé: une poignée de main, des octets sont envoyés. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ht/f4/gy/htf4gytrvdio_te6zyz5wsevhn8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lavez-vous les mains après une poignée de main. Mais en termes de TCP, nous commençons à transmettre des octets, et les algorithmes sont suffisamment optimisés pour que le serveur client ne reste pas inactif.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par conséquent, un certain segment de données est envoyé en premier. Par défaut, (cela vous pouvez changer dans les paramètres), il est de 1460 octets. Le serveur n'envoie pas d'informations sur un segment. Il envoie des fenêtres. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La première fenêtre est de 14 600 octets, dix segments. Ensuite, si la connexion est bonne, il commence à agrandir les fenêtres. Si la connexion est mauvaise, cela peut réduire la fenêtre. Qu'est-ce qu'il est important de comprendre? Il y a la première fenêtre de dix segments, dans laquelle vous devez adapter l'intégralité du site, si vous le souhaitez. Et puis il y aura une vitesse maximale d'apparition du contenu. </font><font style="vertical-align: inherit;">Vitaliy Kharisov a </font><font style="vertical-align: inherit;">également lu un </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rapport</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> à ce sujet </font><font style="vertical-align: inherit;">. Et oui, il est possible de regrouper un site avec tout ce dont vous avez besoin dans une seule fenêtre si vous désactivez, par exemple, JS.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une nuance importante. </font><font style="vertical-align: inherit;">Lorsque vous remplissez un segment entier, il s'agit d'un seul segment. </font><font style="vertical-align: inherit;">Mais si vous n'envoyez qu'un octet supplémentaire, le serveur enverra tout de même un segment supplémentaire. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/h4/8v/ut/h48vut1nv1yldqqdo2ubbe3miai.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez faire une optimisation intéressante, réduire la sortie d'un kilo-octet entier, mais vous ne verrez rien sur vos mesures - peut-être à cause de cela. </font><font style="vertical-align: inherit;">Essayez de faire l'optimisation normalement sur plusieurs segments. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Étrange: je suis typographe, et je raconte des choses de serveur si complexes. </font><font style="vertical-align: inherit;">Rapprochez-vous encore du vrai CSS.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Expédier moins</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Donc, nous envoyons moins à l'utilisateur, moins de segments, vient plus vite, l'utilisateur est content. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/76/hb/6l/76hb6lkb_giyi6iwvnfvaui4yuk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Minification. Elle était toute installée sur ses projets. Il y a un tas d'outils sympas, de plugins webpack, de paramètres gulp - en général, vous le découvrirez par vous-même. Vous pouvez le personnaliser à la main, mais il ne semble que lorsque vous êtes sûr de pouvoir compresser votre refroidisseur CSS que n'importe quel CSSO. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N'oubliez pas d'activer la compression. Si au moins gzip n'est pas activé en 2020, vous faites certainement quelque chose de mal, car il s'agit d'une ancienne technique de compression. En général, en 2020, il est temps d'utiliser brotli. C'est un bon moyen de réduire légèrement la sortie dans les navigateurs Chromium. Ou, si vous ne souhaitez pas prendre en charge brotli, vous pouvez au moins essayer zopfli.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il s'agit d'un algorithme de compression assez lent pour gzip, qui donne simplement les meilleurs résultats de compression et décompresse aussi rapidement que gzip normal. Par conséquent, zopfli doit être configuré judicieusement et utilisé uniquement lorsque vous n'avez pas besoin de sortir des données à la volée. Vous pouvez configurer les archiveurs gzip pour qu'ils soient collectés lors de l'assemblage à l'aide de l'algorithme zopfli, et envoyés de manière statique déjà, en fait, ne vont pas à la volée. Cela peut vous aider. Mais mesurez également les résultats.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/pu/f6/sm/puf6smovgfumpzw6cdrj4nxvjzo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tous ces algorithmes utilisent une sorte de dictionnaires: un dictionnaire est construit sur la base de fragments de code répétitifs. Mais parfois ils disent: il faut inline, si on inline, alors on se débarrasse de la demande. Lier tous les CSS en HTML sera très rapide. L'astuce est que gzip fonctionne un peu plus efficacement lorsque vous décomposez les styles et le HTML, car les dictionnaires sont différents, plus efficaces. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans mon cas, je viens de prendre la page de bootstrap, d'y relier le bootstrap et de comparer les deux versions. Gzip sur les ressources individuelles est de 150 octets de moins. Oui, le gain est très faible. Ici aussi, vous devez tout mesurer. Mais dans votre cas, cela peut, par exemple, réduire le nombre de segments d'un.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comment optimiser le code? Je ne parle pas de minification. Retirez ce que vous n'utilisez pas dans le projet. Vous avez probablement du code qui ne s'exécutera jamais sur le client. Pourquoi? </font></font><br>
<br>
<img src="https://habrastorage.org/webt/oc/qy/i3/ocqyi32nsmaifhfwjtobuhbfyt0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour que vous puissiez automatiser cela, des onglets spéciaux sont intégrés dans le navigateur, par exemple, dans Chrome DevTools, c'est Coverage, qui vous dit: "Je n'ai pas utilisé ce CSS ou ce JS, vous pouvez le couper." </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais vous pouvez avoir un survol, une concentration, une activité, quelque chose installé à l'aide de JS. Vous devez simuler toutes les actions possibles sur le site, alors seulement vous serez sûr que ce CSS peut être coupé. Chris Coyer a un bon </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">article</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de synthèse sur les outils automatiques qui essaient de tout faire avec le survol et la concentration. Mais il est arrivé à la conclusion qu'il était impossible d'automatiser cela. Cela ne fonctionne pas encore.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il y a un bon </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rapport d'</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Anton Kholkin de Booking.com, où ils ont également essayé de supprimer des tas de code hérité. </font><font style="vertical-align: inherit;">Mais ils avaient une particularité: un code hérité qui provenait de projets externes. </font><font style="vertical-align: inherit;">Il fallait le retirer. </font><font style="vertical-align: inherit;">Découvrez les solutions intéressantes rencontrées. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez vous-même essayer de jouer avec le même Puppeteer, qui est comme Chrome. </font><font style="vertical-align: inherit;">Vous pouvez faire des tests qui passent automatiquement par tout, essayez de faire du survol, de vous concentrer. </font><font style="vertical-align: inherit;">Et utilisez cette même couverture. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mon collègue Vitya Khomyakov</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">victor-homyakov</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fait mon propre </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">script</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , comme trouver des doublons et des styles sur une page. Prenez, copiez et collez. Il vous écrira dans la console: "ce sélecteur, semble-t-il, vous n'en avez pas besoin." Jusqu'au point qui vient d'entrer dans DevTools. C’est génial. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/5q/4i/4g/5q4i4gjomb59s7ry5xcukiqi0zc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une fonctionnalité que j'aime beaucoup dans les outils des développeurs Firefox: une opportunité de voir les styles qui semblent être utilisés, mais en fait le navigateur ne les applique pas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par exemple, vous pouvez définir display: inline, et il semble que cet affichage: inline n'a pas de sens pour définir des tailles. Ou l'alignement vertical, cela ne fonctionne que pour les cellules en ligne ou de tableau. Jusqu'à présent, je n'ai vu que dans Firefox qu'il peut mettre en évidence: "vous n'avez pas besoin de cette ligne."</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ici aussi, vous devez être prudent: vous utiliserez peut-être ce style pour coller plus tard la classe. Mais à mon avis, une fonctionnalité intéressante. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Posez-vous la question dès maintenant: avez-vous besoin de l'ensemble du Bootstrap sur le projet? Placez n'importe quel framework CSS que vous utilisez au lieu de Bootstrap. Très probablement, vous utilisez Bootstrap pour les grilles et les éléments plus ou moins courants, et la moitié de Bootstrap dont vous n'avez pas besoin. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Essayez d'utiliser correctement l'assemblage. Presque tous les frameworks CSS modernes vous permettent d'utiliser le code source pour l'assemblage et de sélectionner uniquement ce dont vous avez besoin. Cela peut réduire considérablement la taille du bundle CSS. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ne donnez pas inutilisé. Au lieu de chercher mon héritage, vous pouvez utiliser la compréhension de niveau de construction que cette page n'utilisera pas ce CSS.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par exemple, une pile BEM complète vous permet de créer l'assemblage de sorte que vous, déjà en donnant la page, puissiez construire une arborescence de tous les composants des blocs BEM qui seront sur la page. BEM vous permet de déterminer que si ce bloc n'est pas sur la page, il n'est pas nécessaire de charger ce CSS. Expédiez uniquement le nécessaire. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Même les gars de Google </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">disent</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : utilisez BEM, cela peut vraiment vous aider pour l'optimisation. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je ne pense pas que je le dis à voix haute, mais dans ce cas, CSS-in-JS semble être une bonne approche. Lorsque vous écrivez des composants indépendants indépendants et configurez soigneusement l'assembly ou déterminez en cours d'exécution quels blocs sont utilisés et lesquels ne le sont pas, vous pouvez vous débarrasser du problème de trouver un code hérité en n'envoyant simplement pas ce code au client. Cela semble facile, mais la discipline est nécessaire. Pensez-y à l'avance au début du projet.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/zr/he/na/zrhenay2u6hrppvi4jx-ams_njo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quelle autre option existe-t-il? Un peu fou. Dans ce code, il semble que le style ne soit pas nécessaire, car nous utilisons un div - la valeur par défaut est déjà display: block. Et supprimons tous les paramètres par défaut? Si dans votre projet, vous savez avec certitude que le balisage HTML ne changera plus jamais - parcourez les valeurs par défaut que le navigateur fournit déjà et supprimez-les. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Moins de styles - super! Mais c'est encore une idée folle. CSS n'a pas besoin de connaître HTML, car c'est un style. Il est assez indépendant, vous devez le connecter à un autre projet, il devrait y fonctionner. Et oui, c'est difficile à maintenir. Changez le tag - tout se casse. Idée folle comme promis. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Utilisez des variables. CSS a de très anciennes variables comme currentColor.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/vh/eg/om/vhegomyxszcuft3mc8rloetjmio.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il y a souvent un motif: vous voulez, par exemple, créer un bouton dont le texte et la bordure sont de la même couleur. Et en survolant nous les changeons tous les deux. Pourquoi? </font></font><br>
<br>
<img src="https://habrastorage.org/webt/-v/-5/jl/-v-5jle8hdyn94asbckxmh0ev_i.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il existe une variable currentColor qui prend une valeur de couleur, et vous la placez, par exemple, à la frontière, proxy cette propriété et modifiez une seule ligne par survol, par focus, par active, tout ce que vous voulez. Cela semble être pratique et le code est devenu une ligne de moins. Vous pouvez optimiser. Par ailleurs, dans cet exemple, vous ne pouvez pas du tout utiliser la tâche border-color, car par défaut, elle prend déjà une valeur dans la propriété color. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il est parfois très triste de voir comment la base64 est utilisée. En CSS, il était activement recommandé avant: utiliser base64 pour injecter de petites icônes. S'il tient dans un segment sur TCP, c'est bon pour vous. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/95/uu/rb/95uurb_rsvp6_xjhnolso-ftl-o.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais Harry Roberts aussi</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Réalisation d'une</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> étude approfondie sur la façon dont base64 affecte le chargement des pages. Oui, il y a moins de demandes, mais ces styles sont analysés parfois plus lentement. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
D'accord, l'analyse est une opération très rapide, l'utilisateur ne le remarquera probablement pas. Mais nous avons une métrique importante - le premier rendu, afin que l'utilisateur voit quelque chose sur la page. Sur les téléphones portables, le premier rendu, selon une étude de Harry Roberts, se produit dix fois plus tard. Réfléchissez si vous avez besoin de base64? Oui, il y a moins de demandes, mais cela a-t-il eu un effet? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et veuillez ne pas utiliser base64 pour SVG. Parce que SVG est idéal pour utiliser l'encodeur URL. Julia Bukhvalova a un </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">outil</font></a><font style="vertical-align: inherit;"> sympa</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: Entrez, collez votre SVG et il distribuera CSS sous une forme prête à coller. Vous remarquerez peut-être qu'il n'y a pas de base64, mais certaines choses sont échappées qui en CSS peuvent ne pas être perçues correctement. C'est beaucoup plus efficace. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En moyenne, base64 donne un avantage de 30% à la taille de ce que vous compressez. Pourquoi? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Utilisez une technologie moderne. Nous devrons peut-être prendre en charge Internet Explorer - les arguments habituels lorsque nous parlons de grilles. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/pe/mg/xu/pemgxutjaqos0iq67ch7qdzudnc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais pensez-y: si vous ne disposez pas de la prise en charge d'IE et que vous composez toujours sur des flottants ou des tableaux, vous pouvez utiliser des grilles pour créer une disposition en trois colonnes avec un espace de 20 pixels - c'est la distance entre les colonnes. Trois lignes. Eh bien, cinq, compte tenu de l'annonce elle-même.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Essayez ceci sur un flotteur. Et je veux dire que nous changeons trois lignes, y compris le nom des classes, si vous touchez HTML. Je n'ai pas trouvé le moyen de faire le même cool sur un flotteur. Jetez vos décisions. Mais utilisez la technologie moderne. Ils vous permettent d'indiquer de manière plus compacte le balisage. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ji/vb/ze/jivbzezcoj7ou78zj5ylexaxd8i.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez essayer Atomic CSS. Qu'Est-ce que c'est? Vous écrivez ces noms de classe un peu fous. Et après un certain temps, vous commencez à comprendre que c'est vous qui définissez la couleur de fond ou simplement la couleur. Ce sont les «fonctionnalités» pour CSS. Mais vous avez un ensemble CSS fixe que vous utilisez ensuite en HTML comme indication de style. Et CSS devient soudainement plus petit. Pour les grands projets, il deviendra vraiment plus petit, car il y a moins de styles uniques. Mais vous développez du HTML.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/gy/77/fl/gy77flr72xq4fuxlgz0jq3etfcu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez regarder dans la direction de Tailwind CSS, qui gagne maintenant en popularité. Ce n'est pas Atomic CSS, il s'agit de classes utilitaires, similaires à Bootstrap, mais plus utilitaires. Vous pouvez utiliser un ensemble spécifique. Assez vous semble suffisant. Un ensemble de classes qui remplissent leurs fonctions. Vous pouvez également essayer, mais n'en faites pas trop. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/kn/ir/8j/knir8jsxsmezohd8gouoba98pk4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une autre idée folle - pourquoi avons-nous besoin de noms de classe entiers sur le client? Oui, c'est pratique pour le développement et le débogage, mais prenons tous les noms de classe et faisons-les en une seule lettre. Ce sera moins. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">un article</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sur la façon de procéder. Vous pouvez configurer le webpack ou un autre plugin lors de la construction. Mais cela ne nous a pas décollé. Nous avons essayé.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il s'est avéré que gzip est si cool que tout était assez bien optimisé pour nous, et BEM et gzip sont incroyablement sympathiques. </font><font style="vertical-align: inherit;">Parce que les constructions de texte sont répétées pour décrire les blocs et les éléments dans le code. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En général, cela ne nous a apporté pratiquement aucun profit. </font><font style="vertical-align: inherit;">Mais si, par exemple, vous n'avez pas de BEM et un tas de classes différentes, vous pouvez essayer. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Important: mesure. </font><font style="vertical-align: inherit;">Mesurer toutes ces pièces expérimentales. </font><font style="vertical-align: inherit;">Peut-être que maintenant ça marche pour vous, et puis vous avez légèrement changé l'architecture du projet, ça a commencé à se monter différemment et tout a ralenti.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Télécharge le!</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jusqu'à présent, je n'ai parlé que de la façon de télécharger un fichier. Nous l'avons téléchargé. Qu'est-ce que l'utilisateur a vu pendant tout ce temps? </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hv/0l/8e/hv0l8e1uk89lmfqategu9yux-je.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il a vu un écran tellement incroyable. Pendant le téléchargement, l'écran était vide. Nous avons téléchargé et le navigateur commence six autres étapes. Soyez patient un peu, je vais en parler un peu plus vite que du téléchargement. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/4c/zj/yy/4czjyy-8-jl4c4qdm9dzgczmfes.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Commençons par l'analyse. L'analyse est lorsqu'un navigateur a téléchargé un flux d'octets et commence à le diviser en entités qu'il comprend.</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/709/df0/50d/709df050daf8e241e96c31e73c720fad.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par exemple, il est tombé sur l'importation. Celui-ci doit à nouveau être téléchargé. Relisez la première partie du rapport? l'importation est une opération de blocage. Mais les navigateurs sont intelligents. Ils ont un scanner de précharge. J'ai dit que tout y est bloqué, ce n'est pas vrai. Les navigateurs savent que, par exemple, s'il y a trois balises de lien dans une rangée qui suivent le style, alors lorsque je télécharge la première, vous pouvez commencer à télécharger les deuxième et troisième. Il ne peut pas analyser, car toute la structure de l'analyse se brise. Mais téléchargez à l'avance - c'est possible. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ab/yw/qw/abywqwqotl2uyae8y67kpx_-6ky.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'importation est donc une mauvaise chose. Si les styles sont cohérents en HTML, le navigateur verra que nous irons plus loin pour un autre fichier.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/xf/zb/-k/xfzb-kzu_zycogs1kilkjp73rsy.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et si vous l'insérez directement dans l'importation, il doit d'abord télécharger votre style.css, puis voir l'importer dedans. Il commence à analyser ce CSS ... Ouais, on bloque tout d'une nouvelle façon et c'est parti pour le fichier! Vous pouvez donc faire une cascade fraîche avec désoptimisation sur le site. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Oubliez l'importation ou configurez de sorte qu'il n'y ait pas d'importation après la génération. Pour l'environnement de développement, ok, mais pas pour l'utilisateur. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/le/2g/lx/le2glxus3towgrovquopecvq1nu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, nous passons par les étapes de la construction d'arbres, en utilisant Cascade. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qo/g-/q8/qog-q84eqwq9dszmfw3zlo7f__0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout cela est également décrit depuis longtemps. Le modèle d'objet CSS est construit - un arbre spécial de la façon dont le navigateur mappe les balises, les classes aux styles. Il relie tout cela au DOM et établit ces connexions très rapidement. Lorsque vous changez quelque chose, il lui suffit de le changer à l'intérieur de l'arbre.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/cp/kv/b1/cpkvb1obn0v0kwyr1ijpgmc3vmc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Plus le sélecteur est grand, plus il est difficile pour le navigateur de dessiner un arbre. Il doit analyser le sélecteur, le convertir en arborescences. Et si vous avez inséré! Important là-bas, alors il devrait en tenir compte. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ab/z_/ld/abz_ldlw6yhtfzvfiak5pjnnjem.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il semble qu'il est temps de reparler de BEM. Mais BEM n'est pas nécessaire si vous savez utiliser des classes utilitaires, si une classe est responsable d'une fonctionnalité et qu'elles n'interfèrent pas entre elles. Construire un arbre est alors très simple. Vous avez une structure assez plate et le navigateur doit alors le lier correctement au DOM.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/w3/tt/fd/w3ttfdtaor_cd7m8e4gikrch4po.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous faites cela, ils disent que ces sélecteurs ralentissent l'analyse CSS. Mais ce sont des légendes il y a longtemps, la différence est si petite pour le navigateur que dans le projet moyen, vous ne le remarquerez pas si vous optimisez les sélecteurs avec des astérisques. Mais aimeriez-vous développer et maintenir un tel code? </font></font><br>
<br>
<img src="https://habrastorage.org/webt/po/83/1d/po831d3idqqnykaw8ieprtg5eoo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'entendais des conseils: essayez de tout mettre dans un raccourci. l'arrière-plan est un raccourci pour de nombreuses autres propriétés. Nous mettons tout dans une seule propriété, et cela devient optimal.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par octets, oui, il diminue. Mais si vous souhaitez optimiser la composition de CSS OM, le navigateur fera toujours toutes ces propriétés en arrière-plan. Les navigateurs pour chaque élément DOM créent une table de toutes les propriétés qu'il peut avoir. Lorsque vous regardez les valeurs calculées par DevTools, elles ne sont pas là car le navigateur les a calculées en fonction de vos besoins. Il le stocke en mémoire, car il est beaucoup plus facile de réécrire une propriété et tout fonctionne. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est également un conseil très étrange, mais si vous voulez rendre CSS OM plus rapide, vous pouvez immédiatement définir toutes les propriétés une par une. Ça pourrait marcher. Mais la taille du paquet augmentera considérablement. Vous devez mesurer. Je doute que ça rapporte, mais tout d'un coup!</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsque CSS OM est créé, JS est également verrouillé à ce stade. Si la création de OM CSS prend deux secondes, JS échoue. Bien que je ne puisse pas imaginer comment vous avez réussi à écrire autant en CSS que l’arbre est construit pendant deux secondes. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/25/0e/un/250eunwpu4yepgffhza-6g1u2dg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De plus, le navigateur fait la mise en page. C'est l'emplacement de tous les éléments DOM, l'utilisation des positions. Il comprend où l'élément doit être situé et avec quelles dimensions. Il semble qu'à ce stade, l'utilisateur devrait déjà voir une sorte d'image. Mais il voit tout dans la fenêtre, peut regarder à travers une fenêtre limitée. Si quelque chose ne va pas d'en bas, il ne le verra tout simplement pas.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/hg/af/_r/hgaf_racfuoqjcan8wci-i94miu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'idée s'appelle Critical CSS, et elle est également assez ancienne. Vous insérez des éléments importants pour le premier écran au tout début du téléchargement. Par exemple, en ligne dans votre code HTML, supprimez toutes les demandes supplémentaires. L'utilisateur voit d'abord cet écran, puis le télécharge comme vous le souhaitez. Très probablement, il commencera à défiler lorsque vous aurez le temps de le charger. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hb/nk/0u/hbnk0uuz7vgkbubstjoqnfwgsus.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cela se fait simplement. Il existe des outils qui automatisent tout cela, y compris des plugins pour webpack et React. Recherchez et configurez correctement. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github.com/addyosmani/critical</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
- </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github.com/pocketjoso/penthouse</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
- </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github.com/anthonygore/html-critical-webpack-plugin</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
- </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github.com/GoogleChromeLabs/critters</font></font></a><br>
<br>
<img src="https://habrastorage.org/webt/1p/pi/qp/1ppiqpkakke_gsbhxo1cybumlgo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Ayez une bonne </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">approche</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de Filament Group - comment charger de manière asynchrone sans bloquer CSS. Tout est assez simple. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsque vous mettez &lt;link rel = preload&gt;, dites au navigateur: «J'aurai besoin de ce style, mais maintenant nous ne bloquons rien. Vous le téléchargez maintenant, le cachez et quand je me tourne vers lui, commencez à construire CSS OM. » Et vous avez juste besoin de mettre onload et de traiter cela "ok, depuis que je l'ai téléchargé, faites-le rel = feuille de style, activez l'analyse." </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une approche assez simple, mais utilisez-la judicieusement aussi. Si vous avez trop de précharge, vous pouvez faire pire. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/j1/ny/ri/j1nyrizteczgvkx5dwd78_fy1yy.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez également jouer avec des expressions multimédias. Collez-les et dites au navigateur: "ce style n'est plus nécessaire maintenant, mais lorsque cette expression multimédia fonctionnera, il sera nécessaire." Le navigateur téléchargera également de manière proactive, mais avec une priorité inférieure et sans blocage.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ie/m3/go/iem3golzhy8qq3fulda1iwn8d0u.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une autre approche folle, mais pas si folle - quand vous avez une poussée http / 2. Vous pouvez intégrer CSS juste devant le bloc. Sans CSS, votre bloc ne sera pas très beau. Alors pourquoi ne pas intégrer le CSS dont vous avez besoin pour le bloc suivant avant ce bloc? C'est logique, et http / 2 push vous permettra de l'optimiser. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une approche simple. Si vous le développez, utilisez le chargement paresseux. Pourquoi un utilisateur devrait-il télécharger quelque chose qu'il n'utilisera pas? Vous pouvez configurer les composants React de sorte que s'il n'a jamais atteint la zone de visibilité de la page, pourquoi devrait-il télécharger des styles pour lui-même? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Explorez l'API Intersection Observer et vous pourrez peut-être accélérer considérablement votre page. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/-v/ag/dz/-vagdzf0qqu3mmpabixf1rw9_ss.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La dernière étape consiste à dessiner et à appliquer des couches composites, à les coller, etc.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/be/1v/bc/be1vbcsui3hmenm-0ryzhadzrjs.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le navigateur crée des couches composites dans un grand nombre de cas. </font><font style="vertical-align: inherit;">À mon avis, seul un quart du </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">code source de</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Chrome </font><font style="vertical-align: inherit;">convient ici </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Vous pouvez voir par vous-même quand il crée des couches composites dans le code du navigateur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La mémoire vidéo est limitée, en particulier sur les téléphones portables. </font><font style="vertical-align: inherit;">Si vous apportez tout à de nouveaux calques pour optimiser les animations en utilisant Will-Change: Transformer ou autre chose, alors vous pourriez faire pire. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Créez moins de couches - exactement autant que nécessaire pour l'optimisation actuelle. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Génial, nous avons tous analysé.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Et si je reviens?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et si je reviens à la page? Ce n'est que la première fois que j'y vais. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En revenant à la page, il me semble que je peux tout télécharger instantanément. J'ai déjà téléchargé toutes les ressources, pourquoi ne pas les utiliser une deuxième fois? </font></font><br>
<br>
<img src="https://habrastorage.org/webt/8v/di/1l/8vdi1lapv3i9ka0lb-swsysnhms.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si le serveur ne donne pas l'en-tête Cache-Control, le navigateur tentera de mettre en cache votre fichier afin de le réutiliser. Vous pouvez configurer votre serveur par défaut, par exemple: "mettre ce fichier en cache pendant une année entière". Ne changera pas. Mais si c'est le cas, vous devez traiter le problème d'invalidation du cache global. Mais c'est le sujet d'un rapport séparé. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Utilisez des travailleurs de service! 2020, c'est le moment, Progressive Web Applications! Kirill Chugainov avait un bon </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rapport</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sur la façon dont les travailleurs des services peuvent être utilisés pour différentes occasions. Dans ce cas, vous interceptez la demande CSS, l'enregistrez et si le navigateur suit ce style pour la deuxième fois, donnez-la loin du cache. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais le navigateur ne vous promet rien. Vous pouvez toujours faire face au fait que le navigateur est à court de mémoire. Il va essayer de mettre en cache, mais il n'y a pas de mémoire. La mise en cache n'est pas à cent pour cent. Gérez toujours de telles situations. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez essayer d'utiliser le stockage local. Mais il est extrêmement lent. Le téléchargement d'un fichier est parfois plus rapide que l'accès à l'API de stockage local. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez essayer la base de données du navigateur intégrée. Mais mesurez-le. Peut-être qu'un voyage vers JS vous prendra plus de temps en raison d'un processeur faible. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez également informer le navigateur à l'avance que vous allez télécharger quelque chose.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/7a/_f/oq/7a_foqb9hzh_ycjaddhrkarqhia.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
&lt;link rel&gt; - découvrez comment fonctionne cet attribut. Il y a preconnect, prefetch, prerender - je veux en parler séparément. Il dit: «Je suis sur cette page maintenant, puis je passerai à la suivante. Téléchargez tout pour cette page dans l'onglet arrière-plan et dessinez. » Truc cool. Ne fonctionne nulle part. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/iy/ca/ql/iycaqlaidexf0urgnjv05zpjskg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans un sens, il est pris en charge dans IE et Edge. Dans Chrome, il ne fait pas vraiment ça, il ne rend pas. Cela fonctionne comme la prélecture: télécharge ces fichiers et caches. Malheureusement, un prérendeur à part entière ne fonctionne nulle part. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais vous pouvez développer cette idée. Par exemple, dans l'application Yandex - naturellement, sans utiliser CSS - une pré-rendu est faite. Lorsque vous cherchez quelque chose, il est probable que vous puissiez obtenir vos résultats instantanément. Nous </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pouvons</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> prédire où vous irez, et à l'avance par nos propres méthodes aller chercher toutes les ressources nécessaires.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et après? </font><font style="vertical-align: inherit;">Il y avait beaucoup de liens. </font><font style="vertical-align: inherit;">Je vous conseille également de regarder une incroyable </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">collection d'</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> optimisation de tout de Vanya Akulov</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iamakulov</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Découvrez comment optimiser HTML, JS et l'assemblage. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et n'oubliez pas de ranger. </font><font style="vertical-align: inherit;">Maintenant, mes conseils fonctionnent vraiment, suggérant comment le faire rapidement, mais très probablement, après cinq ans, ils seront même nocifs. </font><font style="vertical-align: inherit;">Il y aura une sorte de technologie qui leur sera incompatible. </font><font style="vertical-align: inherit;">Gardez une trace de cela et essayez de garder votre code optimal, y compris après un certain temps. </font><font style="vertical-align: inherit;">Merci pour l'attention.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr501988/index.html">Comment s'affiche l'écran de message VK?</a></li>
<li><a href="../fr501990/index.html">Poste utile: 4 événements pour résoudre les problèmes de la deuxième journée dans OpenShift et créer des opérateurs</a></li>
<li><a href="../fr501992/index.html">Comment organiser les tests afin d'accélérer et de stabiliser les versions des produits. Partie 1</a></li>
<li><a href="../fr501994/index.html">Orchestrator pour MySQL: pourquoi un projet à sécurité intégrée ne peut pas être construit sans lui</a></li>
<li><a href="../fr501996/index.html">Zen Go (Pocket Version)</a></li>
<li><a href="../fr502000/index.html">12 cours en ligne d'ingénierie des données</a></li>
<li><a href="../fr502004/index.html">Méthode Kanban: comprendre votre processus en tant que processus de renforcement des connaissances collectives - Partie 1 (recettes)</a></li>
<li><a href="../fr502008/index.html">Programmation aux masses</a></li>
<li><a href="../fr502028/index.html">Vanya va à grand-mère ou adaptative JavaScript dynamique</a></li>
<li><a href="../fr502030/index.html">Services Web dans Oracle</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>