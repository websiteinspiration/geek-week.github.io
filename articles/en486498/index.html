<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèø‚Äçüîß ü•™ ‚úäüèæ Face-driven game masks on Instagram, or double-click eyes üë®‚Äç‚öïÔ∏è üí¥ üé´</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="What nonsense, you think. What kind of meaningless set of words? But, alas or cheers - someone like that, today this is not nonsense, but reality. The...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Face-driven game masks on Instagram, or double-click eyes</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/486498/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/qr/9p/o1/qr9po1b7d633kt3pmdsf2esb9io.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
What nonsense, you think. What kind of meaningless set of words? But, alas or cheers - someone like that, today this is not nonsense, but reality. The article will be about a game I wrote for Instagram in which your face is used as a controller, or rather, not only it, but sometimes the whole head. Moving around the playing field is carried out by turning and tilting the head, and the choice of action is by opening the mouth or double ‚Äúclicking‚Äù (blinking) eyes. Double blink would probably be worth calling it ...</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Oh brave new world! Probably, hipsters of the future will develop scripts to generate beautiful colorful smoke behind their lightweight space capsules or write shaders to give interesting visual effects to the black gates of a personal teleport, such as falling snowflakes (Web 100.0) or fractal fog (WebGL 100.0) or ... No, perhaps I don‚Äôt have enough imagination to imagine what kind of nonsense we could deal with in the future: I try to think too logically. But about 30 years ago, we certainly, in no dream, under any circumstances, could even have thought that today we will create masks for a social network called Instagram. And what's more, that inside these masks full-fledged games will appear. I became scared and interesting. All in all, scary interesting. And, as you already understood, I could not resist and also wrote such a game.Of course, in order to play it, you must have a smartphone on Android or iOS with a front camera and the installed Instagram application.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This game is Tic Tac Toe. </font><font style="vertical-align: inherit;">In general, this is one of the first games that I created in my life, and maybe even the very first one - I just won‚Äôt remember it now. </font><font style="vertical-align: inherit;">But I wrote it back in Pascal, then I dragged that old algorithm into Delphi. </font><font style="vertical-align: inherit;">After that, the game, of course, also appeared on the web, on my website: well, where on your personal page without your own personal tic-tac-toe ... And now it's time to put this epic game on Instagram. </font><font style="vertical-align: inherit;">In general, if I were a dagger or a tac toe in this game (rather, probably a toe), I could tell a lot about my long, interesting life ...</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What kind of masks are these?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For a start - a brief historical digression. Masks on Instagram appeared thanks to the Belarusian team that developed the MSQRD selfie application. After this application was bought by Facebook, the team within the corporation continued to integrate its technology into Facebook products. So there was a platform offering augmented reality features, Spark AR. In August 2019, the platform left beta status and became available to all users who can now create augmented reality content for Facebook and Instagram.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Masks were conceived as filters for giving funny effects to their physiognomy with the subsequent placement of a selfie on a social network. As for the masked games, I did not find so many of them. There is a Flying Face, an analog of Flappy Bird, where a bird flies across the screen, and you need to prevent it from crashing into obstacles, blinking at the right moments. I also saw a game where you need to catch mouth falling food from top to bottom. A shooter like Invaders. And a 3D runner where a character runs along a city street and jumps over obstacles. Perhaps there are some more. In general, the topic is quite new.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The content creation process takes place in the Spark AR Studio development environment, which can be downloaded for Windows for free. Also, it is worth downloading the Spark AR Player application for testing the effects you create on Andrioid or iOS mobile devices, for which these effects are, in fact, intended. The connection to the computer is via a USB cable, at least in my case with an Android smartphone. After downloading the mask through the Facebook / sparkarhub component and passing the moderation, your mask (or game) will be available to all Instagram users from the Internet. The mask can be obtained by direct link or from the page of its creator on Instagram.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Understanding how to work in Spark AR Studio is not at all difficult. </font><font style="vertical-align: inherit;">I will not dwell on this in detail, especially since the Internet is full of lessons on this topic. </font><font style="vertical-align: inherit;">I will only note that there are two ways to develop a more or less interactive application that involves something more than just applying some kind of static sprite to your face: creating the so-called patches and writing scripts. </font><font style="vertical-align: inherit;">The first method visually resembles working with materials in a 3D editor, and the second is just programming in Javascript using a specialized api. </font><font style="vertical-align: inherit;">I chose the second option. </font><font style="vertical-align: inherit;">However, no one forbids combining both methods: from scripts there is the possibility of access to everything that is happening in the patches.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Graphic arts</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So, for starters, it would be nice to create some graphic elements that will be used in the game. </font><font style="vertical-align: inherit;">Open your favorite 3D modeling program and create. </font><font style="vertical-align: inherit;">I am using Blender. </font><font style="vertical-align: inherit;">In principle, you can create just separate sprites, and then ask them some logic of behavior using Spark AR and not use the 3D editor at all. </font><font style="vertical-align: inherit;">But I decided to make voluminous figures of crosses and toe, so I could not do without such an editor. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The first thing to do is create a 2D texture. </font><font style="vertical-align: inherit;">Combine all the textures in one atlas.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/9y/ii/n8/9yiin8wu1jf3emkzbnyjn88jmgq.jpeg"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Texture satin</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now about 3D models. As a game 3D space, a plane of two triangles is used, on which the field marking is stretched (here is that large mesh fragment from the texture atlas). The atlas itself is with a transparent alpha channel. 9 blue squares, also consisting of two triangles each, will be inserted into the field. Also, in addition to the nine blue ones, the 3D model will contain in the same coordinates 9 green and red squares that will be hidden at the start of the game. The meaning is that in the normal state the color of all the squares of the field is blue, and green and red are used as the cursor to select the position in which you want to set a cross or a zero, respectively. In addition, green and red are used to highlight the winning row of three cells at the end of each round. It would be enough, of course,use 9 blue and only 3 green and red squares, but then you would have to, in addition to showing / hiding, set them some kind of logic of movement. It seemed to me that just hiding and displaying them without any manipulation of the coordinates in space would be easier, and the 3D model would load it insignificantly.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/vy/fk/bs/vyfkbs_c_hezcstqfoebd2xyjoy.jpeg"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The playing field</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
In the game, the positions of the three squares in each of the nine groups, of course, coincide. Here, I just scattered them vertically in one of the cells to clearly demonstrate what the 3D model as a whole consists of. Note that the boxes are given names (in the figure on the right) in a certain way: from b11 to b33, from g11 to g33 and from r11 to r33, where each digit changes in the range from 1 to 3. In other words, the letter denotes a color, and the numbers are the row and column. This is necessary to access the boxes (meshes, in 3D terminology) by the names from the script, so that it is convenient to hide and display them.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Then I modeled the figures of crosses and toe themselves, placing them also in pairs in each cell. </font><font style="vertical-align: inherit;">(For clarity, he raised one of the zeroes.) Do not look at the fact that their texture is so ‚Äúcheerful" so far. </font><font style="vertical-align: inherit;">I did this for the convenience of applying an UV scan. </font><font style="vertical-align: inherit;">Then, in the texture atlas, I replaced the textures of the figures with calmer ones, which you can see in the game itself.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/qq/qc/cp/qqqccp5siugamnwegcpegomgank.jpeg"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Game pieces</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Finally, I modeled 4 flat arrows that will indicate the direction the cursor moves in the game. </font><font style="vertical-align: inherit;">I applied one texture to their geometry: in the sprite sheet, this is a white triangular arrow in a stroke. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We export all 3D models (all three, that is, the field, shapes and arrows) to the FBX format, which requires Spark AR Studio.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Import to Spark AR Studio</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
First, launch Spark AR Studio and import 3D models there. They will appear in the Assets list at the bottom left. At the same time, we will create for ourselves a thematic mask with war paint in the form of ‚Äútattoos‚Äù of a cross and a toe on the face. About how to create a textured mask, you can learn from thousands of lessons on the global network or from the official documentation on the platform, I will not focus on this. In short: download the ‚Äúblank‚Äù, open it in your favorite graphics editor, draw something on top of it, save it, import the image into Spark AR Studio, adjust the material and texture parameters.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/pv/-d/aw/pv-dawxo7-dqxkgd2rxga-umd7w.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Drag our models from Assets to the Scene list above. Moreover, we need them to be rendered in a certain order: first the field (field.fbx), then the model of the figures (fieldxo.fbx) and, finally, the arrows (arrows.fbx). In addition, on the bottom layer there will also be faceTracker with faceMesh - this is a mask for your face. You can probably throw models onto the stage in any order, however, I intend to turn off Depth Testing and Depth Test and Write to Depth Buffer (in the material properties) for all materials (except figures), so let them render in the order I manually set: mask - field - figures - arrows.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the materials of each layer, set Blend Mode = Alpha so that the objects become transparent in those parts where this is specified in the texture. </font><font style="vertical-align: inherit;">And we will set the textures Filtering = Medium for smoothing. </font><font style="vertical-align: inherit;">(If you select a material or texture from the list on the left, all the properties available for them will be displayed on the right side of the window.) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Finally, add the Script element to the Assets (by clicking the bottom left + Add Asset) element. </font><font style="vertical-align: inherit;">And besides 3D models, script.js will appear in the list, by clicking on which your external text editor of scripts will open. </font><font style="vertical-align: inherit;">When you save in the editor, your program restarts in Spark AR Studio.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Programming</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
At the beginning of the script, connect the modules that we need in this project. </font><font style="vertical-align: inherit;">This is a scene, face tracking, modules for working with time, sound and animation.</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> Scene = <span class="hljs-built_in">require</span>(<span class="hljs-string">'Scene'</span>);
<span class="hljs-keyword">const</span> FaceTracking = <span class="hljs-built_in">require</span>(<span class="hljs-string">'FaceTracking'</span>);
<span class="hljs-keyword">const</span> Time = <span class="hljs-built_in">require</span>(<span class="hljs-string">'Time'</span>);
<span class="hljs-keyword">const</span> Audio = <span class="hljs-built_in">require</span>(<span class="hljs-string">'Audio'</span>);
<span class="hljs-keyword">const</span> Animation = <span class="hljs-built_in">require</span>(<span class="hljs-string">'Animation'</span>);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There are many ways to implement tic-tac-toe in Javascript. </font><font style="vertical-align: inherit;">This article is not about implementing this game in a given programming language, but about managing with the help of a person. </font><font style="vertical-align: inherit;">I will describe key points specific to interaction with the Spark AR system so that the principle is understood. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Access to the named fragment of the 3D model (mesh), for example, to the blue square in the first row, second column of the playing field:</font></font><br>
<br>
<pre><code class="javascript hljs">Scene.root.find(<span class="hljs-string">'b12'</span>);</code></pre><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Recall b12 - this is how we called this mesh in the 3D editor.)</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Access to the cross at this position:</font></font><br>
<br>
<pre><code class="javascript hljs">Scene.root.find(<span class="hljs-string">'x12'</span>);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hiding a toe (o), setting a cross (x) and coloring in green (g) the cells of the field '32' (third row, second column):</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">// figure</span>
Scene.root.find(<span class="hljs-string">'o32'</span>).hidden = <span class="hljs-literal">true</span>;<font></font>
Scene.root.find(<span class="hljs-string">'x32'</span>).hidden = <span class="hljs-literal">false</span>;
<span class="hljs-comment">// background</span>
Scene.root.find(<span class="hljs-string">'b32'</span>).hidden = <span class="hljs-literal">true</span>;<font></font>
Scene.root.find(<span class="hljs-string">'g32'</span>).hidden = <span class="hljs-literal">false</span>;<font></font>
Scene.root.find(<span class="hljs-string">'r32'</span>).hidden = <span class="hljs-literal">true</span>;</code></pre><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/tk/xg/bz/tkxgbzthiw7ubagtismtw7pmedk.jpeg"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Green cross with green backlight in the '32' field.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Subscribe to the events of head turning and tilting to move around the field.</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">//vert: fov+ back-</span>
FaceTracking.face(<span class="hljs-number">0</span>).cameraTransform.rotationX.monitor().subscribe(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) </span>{
	<span class="hljs-keyword">var</span> v = event.newValue;<font></font>
	...<font></font>
});<font></font>
<font></font>
<span class="hljs-comment">//hor: rt+ dn-</span>
FaceTracking.face(<span class="hljs-number">0</span>).cameraTransform.rotationY.monitor().subscribe(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) </span>{
	<span class="hljs-keyword">var</span> v = event.newValue;<font></font>
	...<font></font>
});</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Everything is very simple here. </font><font style="vertical-align: inherit;">We take from the event the values ‚Äã‚Äãof the head rotation or tilt (event.newValue) and check whether they are out of a certain range. </font><font style="vertical-align: inherit;">If yes, then move the cursor (green box) visually in the desired direction. </font><font style="vertical-align: inherit;">A negative value of the head rotation corresponds to its rotation to the left, positive - to the right. </font><font style="vertical-align: inherit;">Similarly - to tilt the head back and forth to move along the lines. </font><font style="vertical-align: inherit;">The entire range is from -1 to +1. </font><font style="vertical-align: inherit;">Thus, you can implement the cursor movement and ...</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And then it dawned on me</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I suddenly realized that controlling the cursor on the field in the way that I chose was inconvenient: you need to turn your head to move one cell, then return your head to its original position, then turn it again for the next step and so on. And why not just use the fractional values ‚Äã‚Äãof turning the head to the sides and tilting back and forth in order to immediately focus on the desired cell in the field? That is, how to indicate to the cursor his position with a look, or rather, with the direction of the head. And then the first method is a too hard workout for the neck. Physical education is, of course, good, but not to the same extent. Naturally, we will remember the current position somewhere in ap.cur = {x: 1, y: 1} in order to erase the cursor at the previous position and save the coordinates of the new position, which is subsequently needed for the ‚Äúclick‚Äù. By the wayvisual arrows to indicate the direction of cursor movement are no longer needed: we throw one 3D model (arrows.fbx) from the project. You can also erase the arrow image from the texture.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Double Blink?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And now we got to the most interesting. </font><font style="vertical-align: inherit;">Double click eyes. </font><font style="vertical-align: inherit;">Admit it, you wanted to do this from the moment you learned about it at the beginning of the article? </font><font style="vertical-align: inherit;">Now you will tell your friends that the mouse is already outdated and that double blinking is used for a click today! </font><font style="vertical-align: inherit;">Double blink. </font><font style="vertical-align: inherit;">Why double? </font><font style="vertical-align: inherit;">Everything is simple: a single person does involuntarily periodically, so to hang any events on a single blink would be sadism.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/qb/ke/8j/qbke8jqkze91tmgkb2xrhxhjrbm.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In Spark AR, there are events leftEye.openness and rightEye.openness, by subscribing to which, you can get the opening value of each eye in event.newValue in the range from 0 to 1. We will consider the eye closed with a value of less than 0.1. </font><font style="vertical-align: inherit;">And we will call the blink processing function ap.blink1 () (ap is a namespace, it‚Äôs just more convenient for me).</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">//leftEye</span>
FaceTracking.face(<span class="hljs-number">0</span>).leftEye.openness.monitor().subscribe(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) </span>{
	<span class="hljs-keyword">if</span>  (event.newValue &lt; <span class="hljs-number">0.1</span>) {<font></font>
		ap.blink1();<font></font>
	};<font></font>
});<font></font>
<font></font>
<span class="hljs-comment">//leftEye</span>
FaceTracking.face(<span class="hljs-number">0</span>).rightEye.openness.monitor().subscribe(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) </span>{
	<span class="hljs-keyword">if</span>  (event.newValue &lt; <span class="hljs-number">0.1</span>) {<font></font>
		ap.blink1();<font></font>
	};<font></font>
});</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the blink processing function itself, we define the minimum interval between blinks of 200 milliseconds so that this function does not work immediately twice when blinking with both eyes, since its call is hung on each eye. </font><font style="vertical-align: inherit;">I think it‚Äôs clear. </font><font style="vertical-align: inherit;">Also, we define the maximum double blink time - 1 sec. </font><font style="vertical-align: inherit;">If we fit into this range, the action () function will work, which displays the cross at the current position. </font><font style="vertical-align: inherit;">At the same time, we will hang action () on the mouth.openness event - so that the player has a choice whether to put a cross on double blinking or on opening the mouth.</font></font><br>
<br>
<pre><code class="javascript hljs">blink1:<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
	<span class="hljs-keyword">var</span> tmNew = <span class="hljs-built_in">Date</span>.now();
	<span class="hljs-keyword">if</span>  (tmNew - ap.blinkStart &gt; <span class="hljs-number">200</span>) {<font></font>
		ap.blinkCount++;<font></font>
		<span class="hljs-keyword">if</span>  (ap.blinkCount &gt; <span class="hljs-number">1</span>) {
			<span class="hljs-comment">//action</span>
			<span class="hljs-keyword">if</span> (tmNew - ap.blinkStart &lt; <span class="hljs-number">1000</span>) {<font></font>
				ap.action();<font></font>
			};<font></font>
			ap.blinkCount = <span class="hljs-number">0</span>;<font></font>
			ap.blinkStart = <span class="hljs-number">0</span>;<font></font>
		} <span class="hljs-keyword">else</span> {<font></font>
			ap.blinkStart = tmNew;<font></font>
		};<font></font>
	};<font></font>
},<font></font>
<font></font>
<span class="hljs-attr">action</span>:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
	<span class="hljs-keyword">if</span>  (ap.fProc == <span class="hljs-literal">false</span>) {<font></font>
		ap.fProc = <span class="hljs-literal">true</span>;<font></font>
		xo.putx();<font></font>
	};<font></font>
},<font></font>
<font></font>
<span class="hljs-comment">//mouth</span>
FaceTracking.face(<span class="hljs-number">0</span>).mouth.openness.monitor().subscribe(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) </span>{
	<span class="hljs-keyword">if</span>  (event.newValue &gt; <span class="hljs-number">0.2</span>) {<font></font>
		ap.action();<font></font>
	};<font></font>
});</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sounds</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I found them in the royalty-free sections of various sound effect sites. Important detail: Spark AR requires sound files of a certain format, namely, M4A, mono, 44.1 kHz, 16 bit. Online converters from wav and mp3 to m4a are in stock in the global network. I added sound to four events: move, win daggers, win tac toe and draw. The total volume of all sounds after conversion was 105 Kb. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To use sounds in a script, you need to connect an audio module in the script, add the desired number of speakers to the scene by the number of sounds (I got Speaker0, Speaker1, Speaker2, Speaker3), add the Playback Controllers module to Assets, create the necessary number of audioPlaybackController sub-items in it according to the number of sounds and attach a sound to each speaker.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/zz/ib/s8/zzibs8wwtsk_0dzinsuzxu4klb4.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After that, you can play the sound from the script as follows (for example, the sound of a click):</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">var</span> audioClick = Audio.getPlaybackController(<span class="hljs-string">'audioPlaybackControllerClick'</span>);<font></font>
audioClick.reset();<font></font>
audioClick.setPlaying(<span class="hljs-literal">true</span>);</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Final build</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To create builds for all supported mobile devices (Android, iOs), just click File -&gt; Export. The volume of the game for each mobile platform with all 3D models and textures in my case was about 1 Mb. Then you need to go through the browser to the Spark AR Hub on Facebook / sparkarhub and upload the exported file there. You also need to fill out a description, search keywords and download a demo video. Moreover, it must be shot on the phone through the Instagram camera. To do this, in the hub there is a section "Preview Camera" containing a link. This link can be opened on a mobile device. The Instagram application will start and your mask (game) will open in it. The link can also be sent for testing to all your friends, who, of course, must have a smartphone with the Instagram application installed.Until the end of the moderation process, the mask will not be visible to all users and they will not be able to add it to their effects list until it is visible only by this link.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The moderation process usually takes a couple of days (it can take up to 10 business days). As I understand it, at first the effect is subjected to machine testing, at least a demo video - for sure, because a second after sending I received a message that the moderation did not pass. Reason - the video contains text. In general, for some reason, masked text is fundamentally not welcome, as the rules say. I had to redesign the game interface so that the score did not hang constantly above the player‚Äôs head, as I had done before, but only appeared at the end of each round. And re-shoot the video. After making all the changes, I resubmitted my game for moderation.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Three days later, the game was approved, after moving it to the ‚ÄúCamera Styles‚Äù section. </font><font style="vertical-align: inherit;">Honestly, I don‚Äôt remember which section I put it in initially (and the section, or, in other words, the category, needed to be selected). </font><font style="vertical-align: inherit;">This is not obvious, since there is no games section for Instagram. </font><font style="vertical-align: inherit;">But, okay, now we will know where to put new games. </font><font style="vertical-align: inherit;">If the games will appear in the future, then, probably, Instagram should add a new section.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Total</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You can try on a mask by going to the profile of its creator on Instagram and clicking on the icon of its masks below (emoticon with two pluses). </font><font style="vertical-align: inherit;">The same applies, of course, to masked games. </font><font style="vertical-align: inherit;">Previously, during the beta testing of masks, it was also necessary to subscribe to the author. </font><font style="vertical-align: inherit;">But now this rule has been canceled.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
They do not pay money for creating masks and there is no paid masks shop where they can be sold, like applications in well-known stores. Also, you do not need to pay for the placement of the mask you created in your profile. It is only necessary to wait for the passage of moderation. However, many bloggers and companies order the development of branded masks for themselves. Well, of course, you can ask your subscribers to try on the masks that you created, and play your games, broadcasting all this to Instagram story. Such actions can produce a so-called viral effect, especially if the game is interesting. This can help promote your account. However, now everyone is not too lazy to do masks. But the idea of ‚Äã‚ÄãInstagram masked games is still quite new. In addition, there is a higher entry threshold and less competition,since not every mask maker is a programmer to write a full-fledged game.</font></font></div>
      
    </div><p class="reference-to-source js-reference-to-source">Source: https://habr.com/ru/post/undefined/</p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en486480/index.html">Waymo Robocars (Google) start delivering packages in Phoenix, USA</a></li>
<li><a href="../en486482/index.html">Unique faces: counting visitors, searching for outsiders, identification in recognition systems</a></li>
<li><a href="../en486484/index.html">Novel Coronavirus nCOV / 2019-nCoV / NCP / COVID19: Forecasts, Statistics, Protection, News [4th reprint, rev.07.03]</a></li>
<li><a href="../en486488/index.html">Sivelkiriya Operating System: Introductory Description</a></li>
<li><a href="../en486492/index.html">Icloud phishers and where do they live</a></li>
<li><a href="../en486500/index.html">Web Components and Open Standards</a></li>
<li><a href="../en486506/index.html">Issue # 30: IT training - current issues and challenges from leading companies</a></li>
<li><a href="../en486510/index.html">Displaying Exception Information Before Emergency Exit</a></li>
<li><a href="../en486512/index.html">Briefly on how to teach Brother MFPs to scan in Windows Server</a></li>
<li><a href="../en486514/index.html">Weekend Reading: 10 materials about replicas of sound cards, open sound libraries and audio software</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>