<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧝🏽 📥 👨🏽‍🤝‍👨🏼 操り人形師を介して負荷のある地域公共サービスのポータルを確認する 🙅🏼 🤟🏽 ✋🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="こんにちは、ハブル！あなたも不思議なことに「土地区画の分布に関するアメリカの野生の西部の叙事詩-最初に行き、賭けに旗を張りなさい」あるいはおそらくそれにさえ参加しているのを見ています。より正確には、最新バージョン-子供のためのお金を受け取るため、または家を出るためのパスを取得するために、公共サービス...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>操り人形師を介して負荷のある地域公共サービスのポータルを確認する</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/502084/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">こんにちは、ハブル！あなたも不思議なことに「土地区画の分布に関するアメリカの野生の西部の叙事詩-最初に行き、賭けに旗を張りなさい」あるいはおそらくそれにさえ参加しているのを見ています。より正確には、最新バージョン-子供のためのお金を受け取るため、または家を出るためのパスを取得するために、公共サービスに最初に申し込む。これらすべてを見て</font><font style="vertical-align: inherit;">、「ファーストクラスの記録」サービスの提供のためのサービスの地域ポータルの準備のテストおよび参加における</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私たちのチーム</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の経験を共有したいと思い</font><font style="vertical-align: inherit;">ます。これはハブラ効果と非常に似ており、連邦ポータルgosuslugi.ruで数日前に起こったものに近いと思いますが、地域的な規模です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちは今年1月にハバロフスクでこの挑戦に合格し、最近、別の地域で狩猟許可証を発行するための同様のサービスの準備に参加しました。以下は、ピーク時に地域の公共サービスポータルの作業を準備する際の問題を別の視点から検討する機会を与える小さな経験です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして最初に-学校で24時間体制で勤務していた黒いバスの写真。これらの路線の作者は、3年前に両親の間で自分の順番を確認しました。少なくとも私たちの両親は集まった。 -30度のハバロフスクで冬に見ることはまだ喜びです。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/o8/vh/rb/o8vhrboqvtrufnftfwxsxb1rgm4.png" alt="画像"><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1年生のピーク録音の準備の過程で、いくつかのチームが働いた </font><font style="vertical-align: inherit;">データセンターのオペレーター、地域ポータル情報システムのオペレーターと開発者、統合教育情報システムのオペレーターと開発者、地域ポータルのユーザー向けのテクニカルサポート。</font><font style="vertical-align: inherit;">私たちは</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iondv</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で最後のタスクを実行し、ポータルの健全性を監視し、ユーザーをサポートします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
準備における私たちの役割は、nginxでのキャッシュ構成に関するテストと推奨事項を整理することです。推奨される「動作」を備えたユーザー向けの手順も用意しました。</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1年生で書くことの問題を知らない人のために</font></font></b>
                        <div class="spoiler_text">         ,    .  .          ,     ,   -     (      ,   —      ),    ,  -     ,   ,            .  ,       ,      ,     –    ,        .           .<br>
<br>
     1-          ,    .           0:00 ,        10:00 26 . ,    –       .        10:00 ,       —    ,      - .<br>
<br>
            .  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"></a>    .   2017 .     .         ,    ,    .          .<br>
</div>
                    </div><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">技術的なタスクとしての要求されたリソースのサービス</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
「デルタ関数」（δ関数、ディラック関数）の傾向がある負荷（またはクエリの確率）の積分インジケーターの「1年生への書き込み」などのサービスの問題は、ピークの形でグラフにはっきりと表示されます。現時点では、短期間に複数のコールが増加しています。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/0l/uc/c6/0lucc67w9pr4uh2ig1swg5tgtq0.png" alt="δ関数とピーククエリ統計"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちの経験によると、トレーニングの主なタスクはリソースを増やすことではありません。タスクは、1秒あたりの潜在的なリクエスト数を最小限に抑え、一定期間ストレッチして、システムに残りの負荷を準備することです。この場合、ボトルネックを見つけて加速する必要があります。これにより、有界システムの理論の原理（ゴールドラットの原理）に従って最大の効果が得られます。そうでなければ、失敗するのはボトルネックです。システム全体が彼から機能するはずです。「ドラムバッファロープ」の原則。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1分で砂時計の10分でボリューム全体をこぼすことは物理的に不可能です。それらが崩壊することは明らかです。</font><font style="vertical-align: inherit;">サービスの提供についても同様です。</font><font style="vertical-align: inherit;">MFCとスキャンダルがサービスを提供する番になると、誰もが驚かないわけではありませんが、ポータルがダウンした理由は誰もが驚かされることになります。</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">待ち行列理論と</font></a></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
は異なる負荷処理動作のパターンがあります</font><font style="vertical-align: inherit;">。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ユーザーを保留にすることができます。</font><font style="vertical-align: inherit;">キューを増やします。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> たとえば、前のものが処理されるまで、後で来た人へのサービスを拒否することができます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 生産性を際限なく向上させることができます。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
便宜はその中間です。実際、地域や州によって提供されるリソースが限られているサービスの場合、速度だけでなく、まず第一に社会正義の維持が重要です。すべてに等しい条件。同時に、ユーザーが必要なものを受け取っていない場合は、新しいリクエストを開始します。この場合、リクエストは雪崩で成長し、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">攻撃のモデル「</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ドッグパイルエフェクト</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">」</font></a><font style="vertical-align: inherit;">（ドッグパイルエフェクト、キャッシュスタンピード、ヒットミスストーム）を形成します。ユーザーはすでにリクエストをキャンセルし、新しいリクエストを開始しましたが、前のリクエストはまだ処理待ちのキューにあります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このプロセスは、家族全員が提出に参加するという事実を強化します-お父さんとお母さんが同時に申請書に記入し、信頼性のために申請書を数回提出することがよくあります。</font><font style="vertical-align: inherit;">さらに、多くの場合、いくつかのタブといくつかのブラウザにもあります。</font><font style="vertical-align: inherit;">したがって、通常、予想されるピーク負荷は、実際にそのようなサービスを申し込んでいる人の数から2〜3倍にするのが妥当です。</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正義の退却</font></font></b>
                        <div class="spoiler_text">,   «»,            .   ?  «»    ,    .   .     —        ,     .        « ».        .          .<br>
</div>
                    </div><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サービス提供の組織</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
昨年の応募総数とその他の地域の1分あたりのデータの組み合わせに基づいて、予想応募者数を計算しました。</font><font style="vertical-align: inherit;">通常、アプリケーションのピークは5〜10分です。これには、最初の3〜5分間はポータルがほとんど反応せず、後でユーザーが1〜5分でフォームに記入するためです（このような「緊張」状態の電話から多くの人が記入しても驚かないでください）。 。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1時間あたりの条件付き1000アプリケーションの概算計算モデルは次のとおりです。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 開始から5〜10分でピークに達し、80％の申請がParettoルールに基づいて提出されます</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 従来は、1分あたり160アプリケーション、または1秒あたり3アプリケーションを計画しています。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実際、最初の提出は1分45秒後に行われ、申し込みのピークは4分からでした。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ESIAおよびシステムでの認証セッションの生成による負荷を軽減するために、ユーザーが事前にログインしてセッションの存続期間を長くすることを説明しています。</font><font style="vertical-align: inherit;">実際、50％が1時間で、90％が30分で承認されました。</font><font style="vertical-align: inherit;">ユーザーがサービスの開始10分前にポータルへのログインを開始し、認証が不安定に機能するようになったことが以前にありました。</font><font style="vertical-align: inherit;">その理由を言うのは難しい。</font><font style="vertical-align: inherit;">おそらくその理由は、技術的な作業がモスクワで夜に行われるとき、ハバロフスクでは作業日の始まりにすぎないためです。</font></font><br>
 <br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指導と組織の取り決めについて撤退する</font></font></b>
                        <div class="spoiler_text">            <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"></a>.<br>
<br>
         ,    « »     . ..      .       ,   -   .. <br>
<br>
    ,        ,         ,    .        -        .      ,       ,      .<br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
フォームが00:00に再ロードされた場合、「デルタ機能」を削除することはできません。この手順の要点は、サービスが特定の時間に表示されることです。しかし、予想されるすべてのユーザールートでブラウザリクエストの数を減らして、フォーム、動的ディレクトリ、送信アプリケーションなど、必要なものだけからシステムに負荷をかけることができます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
nginxの設定自体はかなり標準的です。ここでは、システムが耐えられる制限を選択することがより重要です。それらを拾う-つまりサーバーがその機能の限界に達すると予想されるときに、要求のキューイングを開始します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さて、そして最も重要なこととして、キャッシング（proxy_cache）を強制し、すべての静的パスと、可能な場合はセッションがない動的ページについて、nginxの「expires」データの存続時間を増やしました。ちなみに、これはキャッシュ時のよくある間違いです。他の誰かのセッションが保存されているキャッシュデータ（場合によっては静的データ）に書き込むと、通常、サーバーがデータ型を分離できない場合、出力はヘッダーからこれらのCookieを削除します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ユーザーのブラウザでは、ディスクまたはメモリからダウンロードされたファイルからページを更新しているように見えます。ただし、ユーザーがサーバーから取得した場合でも、nginxキャッシュから取得されます。もちろん、ディレクトリ自体はシステム自体にキャッシュされます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/qi/oq/nv/qioqnv0ofdjd5e0ygculnetdta4.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これにより、89リクエストから14に潜在的なリクエスト数が減少し、ボリュームが2.1 MB（ページを更新した1000ユーザーの場合、これは4-8 Gbit / sの潜在的なピークです）から38 Kbに減少しました（私たちは皆webpackを覚えていますが、エンタープライズプラットフォームではこれは常に簡単です）。パッセージの結果によると、システムだけでなくnginxでも、フォームの一部のディレクトリと、ピーク時に使用されなかった動的分類子をキャッシュし、それらのライフタイムを強制する必要がありました。また、負荷の増加に伴い、ユーザーを目的のサービスにルーティングするメインの完全に静的なページを表示するか、サービス用に個別のリソースを作成することは一般的に理にかなっています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
送信の負荷を軽減するために、下書きと子のデータの自動入力が無効になりました。すべてのユーザーのデータ入力速度は異なります。これにより、送信の準備が完全に整ったフォームの外観がなくなり、アプリケーションを送信するためのデルタ機能が回避されます（1分間ですべて1000）。同時に、社会的正義は維持されますが、もちろん不満は出ます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
システム自体の最適化については説明しません。主にDBMSクエリで負荷テスト中にボトルネックが特定され、インデックスとクエリ自体が最適化されました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
おそらく最も重要な最適化は、フォームを単純化することです。フォームに実装したときに速度に最も影響するものは何ですか？</font></font><br>
<br>
<ul>
<li>   —   ,        ,      .    —       5-10 (   iPhone         )   5-       375 /  (1       10 ,     <code>application/x-www-form-urlencoded </code>–  20 ),  100      625 /.           100/      —        .   ,      «  ».    —     ?     ,     .    ,      ?</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">洗練されたガイド。</font><font style="vertical-align: inherit;">通常、負荷はFIASまたはCLADRアドレスディレクトリを使用して増加します。</font><font style="vertical-align: inherit;">ここでの問題はサイズが原因です-FIASはデ​​ータベースで最大40GBを使用し、検索に時間がかかります。</font><font style="vertical-align: inherit;">1/10秒ですが、1000の同時リクエストを掛けると、任意のシステムにロードされます。</font><font style="vertical-align: inherit;">特別な準備がなければ、おそらく別のWebサービスの形式で別のリソース上にあるため、負荷に耐えることは困難です。そのため、アドレスにプレーンテキストフィールドを使用することがよくあります。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さて、テストに移りましょう。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">準備中の負荷テスト</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
テストは操り人形師を通じて行われました-Crominiumブラウザーでユーザーアクションをエミュレートすることにより。</font><font style="vertical-align: inherit;">Yanedeks.tankとJMeterは、同じタイプのリクエストの多くを生成するため、攻撃に対する保護を打ち破っています。</font><font style="vertical-align: inherit;">さらに、これらのテストは、負荷がかかった状態でシステムの動作を変更するときに、実際のクエリのプロファイルと弱く一致します。</font><font style="vertical-align: inherit;">さらに、サーバーは要求をキャッシュするため、サーバー内のプロセスの一部（承認など）を再現することは困難です。</font><font style="vertical-align: inherit;">ちなみに、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">devDV</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">セミナーの1つから</font><font style="vertical-align: inherit;">、人形劇のテストへの使用に関するプレゼンテーションを含むプレゼンテーションがあります。</font><font style="vertical-align: inherit;">読み込み、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">動画へのリンク</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まず、ユーザーの行動プロファイルをまとめ、手順を主要な段階に分けました。</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ESIAでの一括承認</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> サービスフォームの1回限りの更新</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> マスフィード </font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ステージごとに個別のテストを行いました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
昨年、ESIAの承認段階で問題が発生しましたが、本格的なテストは困難です。システムは外部にあり、攻撃に対する保護と許可の禁止がトリガーされます。それでも、テスト対象のシステムのボトルネックを正確にテストするためのテストプロファイルを作成することは可能です。通常、これは1分間に同時に承認されたセッション数と計画された承認値であり、推奨事項によって規制できます。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
テストでは、ラッパーはいくつかのスレッドを整理するために重要です。「puppeteer-cluster」を使用します。ただし、通常は、例外を処理し、負荷がかかった状態でポータルの動作を変更する方が複雑です。レイアウト要素が2回表示されることがよくあります。または、一部のデータが期待どおりに読み込まれなかった場合、要素は表示されません。これらはすべて、ユーザーが表示してページを再読み込みするエラーです。つまり、ユーザーは追加の読み込みを作成します。 2つの方法があります。テストで例外処理を実装します。または、ポータルを変更します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
テスト自体は簡単です。以下は、サービスポータルの[ログイン]ボタンをクリックしてからESIAにデータを入力するまでの断片です。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">await</span> page.waitForSelector(AUTH_AVAIL,{<span class="hljs-attr">timeout</span>:OPT_ELEM_WAIT_TIME});
<span class="hljs-keyword">const</span> needAuth = <span class="hljs-keyword">await</span> page.$(ELEM_AUTH_IN);
<span class="hljs-keyword">if</span> (!needAuth) <span class="hljs-keyword">throw</span> (<span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">`  `</span>));<font></font>
        <font></font>
<span class="hljs-keyword">await</span> page.waitForSelector(AUTH_BUT, OPT_ELEMENT_VISIBLE);
<span class="hljs-keyword">await</span> page.click(AUTH_BUT);
<span class="hljs-keyword">await</span> waitNewUrl(page, <span class="hljs-string">'https://esia.gosuslugi.ru/idp/rlogin?cc=bp'</span>, OPT_PAGE_WAIT_TIME);
<span class="hljs-keyword">await</span> page.waitForSelector(<span class="hljs-string">'#mobileOrEmail'</span>, OPT_ELEMENT_VISIBLE);
<span class="hljs-keyword">let</span> text = <span class="hljs-keyword">await</span> elemGetText(page, <span class="hljs-string">'#authnFrm &gt; div.login-slils-box &gt; div &gt; div.detected &gt; div.left &gt; div.this-user'</span>);
<span class="hljs-keyword">if</span> (text) <font></font>
   text = text.replace(<span class="hljs-regexp">/ -\(\)/g</span>, <span class="hljs-string">''</span>);        
<span class="hljs-keyword">if</span> (text &amp;&amp; text.indexOf(user) === <span class="hljs-number">-1</span>) {
  <span class="hljs-keyword">await</span> page.click(<span class="hljs-string">'div.click-to-another &gt; a'</span>);
  <span class="hljs-keyword">await</span> page.waitForSelector(<span class="hljs-string">'#authnFrm &gt; div.login-slils-box &gt; div &gt;'</span> +
                <span class="hljs-string">' div.detected &gt; div.left &gt; div.this-user'</span>, OPT_ELEMENT_INVISIBLE);<font></font>
}<font></font>
<span class="hljs-keyword">await</span> page.waitForSelector(<span class="hljs-string">'#password'</span>, OPT_ELEMENT_VISIBLE);
<span class="hljs-keyword">await</span> page.type(<span class="hljs-string">'#mobileOrEmail'</span>, user);
<span class="hljs-keyword">await</span> page.type(<span class="hljs-string">'#password'</span>, pwd);
<span class="hljs-keyword">await</span> page.click(<span class="hljs-string">'#loginByPwdButton'</span>);
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
保留中のユーザーが「レコードを開く」という申請フォームの更新の検証。再起動テストは基本的に1ステップですが、返されるエラーのタイプを確認することが重要です-ネットワークに問題がある、nginxエラー、サーバーエラー、フォームが基準を満たしているかどうか。そして困難なのは、最小限の時間で最大量のリクエストを生成し、保護制限に該当しないことです（ただし、テスト中は変更できますが、一方で、ネットワークとサーバーのインフラストラクチャ設定とWAFのチェックでもあります）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そのような操り人形師のテストは、機能するために多くのリソースを必要とします。実際には、フロントエンドサブシステムの1番目のコアに対して少なくとも2つのコアと非常に広いチャネルが必要であることが判明しました。しかし、それらをクラウドでレンタルする場合、これはかなり手頃な価格です。 Yandex.cloudを使用しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
テストでは、最初に承認が各ストリームのESIAに個別に実装されます。</font><font style="vertical-align: inherit;">その後、スレッドごとに個別のブラウザーが起動され、1つのインスタンスのフレームワーク内で、指定された数の更新が実行されます。</font><font style="vertical-align: inherit;">その後、インスタンスが再起動します。</font><font style="vertical-align: inherit;">チェック自体には、メインページ、サービスの形式などの一般的なパスが含まれる場合があります。</font><font style="vertical-align: inherit;">しかし、多くの場合、サービスを完全に更新し、サービスを送信できる必要なディレクトリを確認するだけで十分です-すべてユーザー向けの説明と同様です。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/oe/8w/vk/oe8wvknrrkkw1hn3vb4ke0oh8sw.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
メインを開いてページを更新するためのテストのフラグメント。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">try</span> {
  <span class="hljs-keyword">await</span> page.setViewport(PUP_OPT);
  <span class="hljs-keyword">await</span> page.goto(BASE_URL);
  <span class="hljs-keyword">await</span> page.setCookie(...cookies[worker.id]);
  <span class="hljs-keyword">await</span> page.goto(<span class="hljs-string">`<span class="hljs-subst">${BASE_URL}</span>/nd/lk/form/dnv.htm`</span>);<font></font>
  rdyRefresh++;<font></font>
} <span class="hljs-keyword">catch</span> (err) {
  <span class="hljs-built_in">console</span>.error(<span class="hljs-string">`#       <span class="hljs-subst">${data}</span>: <span class="hljs-subst">${err.message}</span>`</span>);<font></font>
  getErr++;<font></font>
  <span class="hljs-keyword">await</span> page.screenshot({<span class="hljs-attr">path</span>: filename});<font></font>
}<font></font>
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; AMOUNT_REFRESH - <span class="hljs-number">1</span>; i++) {
  <span class="hljs-keyword">const</span> filenameIter = path.join(BASE_DIR, PIC_DIR, <span class="hljs-string">`<span class="hljs-subst">${data}</span>-<span class="hljs-subst">${i}</span>.png`</span>);
   <span class="hljs-keyword">try</span> {
       <span class="hljs-keyword">await</span> page.reload({<span class="hljs-attr">waitUntil</span>: [<span class="hljs-string">"networkidle0"</span>, <span class="hljs-string">"domcontentloaded"</span>]});<font></font>
        rdyRefresh++;<font></font>
    } <span class="hljs-keyword">catch</span> (err) {
        <span class="hljs-keyword">if</span> (!err.message.includes(<span class="hljs-string">'Navigation failed because browser'</span>)) {
           <span class="hljs-built_in">console</span>.error(<span class="hljs-string">`#     <span class="hljs-subst">${data}</span>-<span class="hljs-subst">${i}</span>: <span class="hljs-subst">${err.message}</span>`</span>);<font></font>
           getErr++;<font></font>
           <span class="hljs-keyword">await</span> page.screenshot({<span class="hljs-attr">path</span>: filenameIter});<font></font>
        }<font></font>
   }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
送信アプリケーションによるロードの場合、フォームのリロードとすべてのデータの入力の検証を使用して、検証サイクル全体が実装されました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
断片。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; AMOUNT_RESEND; i++) {
   <span class="hljs-keyword">const</span> filename = path.join(BASE_DIR, PIC_DIR, <span class="hljs-string">`<span class="hljs-subst">${data}</span>-<span class="hljs-subst">${i}</span>.png`</span>);
  <span class="hljs-keyword">try</span> {
     <span class="hljs-keyword">await</span> page.goto(<span class="hljs-string">'https://uslugi27.ru/nd/lk/form/dnv.htm'</span>);<font></font>
  } <span class="hljs-keyword">catch</span> (err) {
      <span class="hljs-built_in">console</span>.error(<span class="hljs-string">`#      1  <span class="hljs-subst">${data}</span>-<span class="hljs-subst">${i}</span>: <span class="hljs-subst">${err.message}</span>`</span>);
      <span class="hljs-keyword">await</span> page.screenshot({<span class="hljs-attr">path</span>: filename});<font></font>
      getErr++;<font></font>
      <span class="hljs-keyword">continue</span>;<font></font>
 }<font></font>
 <span class="hljs-keyword">try</span> {
     <span class="hljs-keyword">const</span> FORM_PREF = <span class="hljs-string">'#createForm &gt; div:nth-child(4) &gt; '</span>;
     <span class="hljs-keyword">await</span> clickDelayed(page,<span class="hljs-string">`<span class="hljs-subst">${FORM_PREF}</span>fieldset.petgroup.ungroupped-attrs &gt; div &gt; div:nth-child(4) &gt; div.col-md-9.attr-data`</span>);
<span class="hljs-comment">// &lt;…&gt;</span>
     <span class="hljs-keyword">await</span> page.type(<span class="hljs-string">`<span class="hljs-subst">${FORM_PREF}</span>fieldset:nth-child(2) &gt; div &gt; div:nth-child(1) &gt; div.col-md-9.attr-data &gt; input`</span>, <span class="hljs-string">''</span>);
<span class="hljs-comment">// &lt;…&gt;</span>
  } <span class="hljs-keyword">catch</span> (err) {
      <span class="hljs-built_in">console</span>.error(<span class="hljs-string">`#      <span class="hljs-subst">${data}</span>-<span class="hljs-subst">${i}</span>: <span class="hljs-subst">${err.message}</span>`</span>);
      <span class="hljs-keyword">await</span> page.screenshot({<span class="hljs-attr">path</span>: filename});
     <span class="hljs-keyword">continue</span>;<font></font>
  }<font></font>
  <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">await</span> page.click(<span class="hljs-string">'#createForm &gt; div.col_100.controls &gt; button.btn.btn-primary.pull-right.next'</span>);
      <span class="hljs-keyword">await</span> clickDelayed(page,<span class="hljs-string">`#createForm &gt; div:nth-child(5) &gt; fieldset &gt; div &gt; div:nth-child(1) &gt; div &gt; div`</span>);
       <span class="hljs-keyword">await</span> page.click(<span class="hljs-string">'#createForm &gt; div:nth-child(5) &gt; fieldset &gt; div &gt; div:nth-child(2) &gt; div &gt; div'</span>);
       <span class="hljs-keyword">await</span> page.click(<span class="hljs-string">'#createForm &gt; div.col_100.controls &gt; button.btn.btn-success.pull-right.submit'</span>);<font></font>
  } <span class="hljs-keyword">catch</span> (err) {
    <span class="hljs-built_in">console</span>.error(<span class="hljs-string">`#     <span class="hljs-subst">${data}</span>-<span class="hljs-subst">${i}</span>: <span class="hljs-subst">${err.message}</span>`</span>);
    <span class="hljs-keyword">await</span> page.screenshot({<span class="hljs-attr">path</span>: filename});<font></font>
    sendErr++;<font></font>
    <span class="hljs-keyword">continue</span>;<font></font>
  }<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ちなみに、await page.typeコンストラクトでパペットからではなくすべてのデータを入力し、このロジックをブラウザー自体に転送すると、テストを加速できます。しかし、エラーをキャッチすることの複雑さが増します。そのようです</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-built_in">document</span>.querySelector(<span class="hljs-string">'#createForm &gt; div:nth-child(4) &gt; fieldset.petgroup.ungroupped-attrs &gt; div &gt; div:nth-child(4) &gt; div.col-md-9.attr-data'</span>).click();
 <span class="hljs-built_in">document</span>.querySelector(<span class="hljs-string">'#createForm &gt; div:nth-child(4) &gt; fieldset:nth-child(2) &gt; div &gt; div:nth-child(1) &gt; div.col-md-9.attr-data &gt; input'</span>).value = <span class="hljs-string">''</span>;
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
テスト中に、数千のESIA承認と約16千のアプリケーションが送信されました。このような多数の発言の後、生産的な教育情報システムがどのように回復したか-質問さえしないでください。これはまったく別の話です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このプロセスの主な目に見える結果は、地元のメディアが1年生の入学の日に今退屈していることでした。サービスはメディア領域を去った。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
同時に、Grafanaに基づいてフォームのパフォーマンスを監視するためのダッシュボードを作成しました。アプリケーションの数、呼び出しの数、Yandexメトリックなどです。ただし、このトピックは次回のために残しておきます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まあ、私は電子形式での国家および地方自治体のサービスの提供の質を改善するトピックに関連しているすべての人を祝福したいと思います。</font><font style="vertical-align: inherit;">この無限の準備作業は無駄ではありませんでした-結局、4月と5月に提出された申請の数は大幅に増加しました。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja502068/index.html">コンピューターに110ボルト</a></li>
<li><a href="../ja502070/index.html">ペンタックスの歴史（記事とビデオ）</a></li>
<li><a href="../ja502072/index.html">JavaScriptとコンパスを使用したISSのドッキング</a></li>
<li><a href="../ja502076/index.html">トロリーロボット2.0。パート1. ROSに基づくホームロボットの自律ナビゲーション</a></li>
<li><a href="../ja502080/index.html">かんばん方式：例PNZ No. 1、新興企業での測定研究プロセス</a></li>
<li><a href="../ja502086/index.html">ユーザーがバケットでのみ作業できるようにMinioを設定する</a></li>
<li><a href="../ja502088/index.html">過剰な時間と失われた時間の物語。py3によると</a></li>
<li><a href="../ja502092/index.html">ロシア連邦におけるデジタル信託サービスの技術的および規制上のサポート</a></li>
<li><a href="../ja502098/index.html">B2Bの構築方法</a></li>
<li><a href="../ja502102/index.html">AutoMLは非常に強力です</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>