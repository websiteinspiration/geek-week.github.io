<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🔴 👩🏽‍🤝‍👨🏼 😒 私たちはイケアをポンプします：軽い音楽をビッグブラザーに変える方法 👩🏽‍🎨 🧘🏼 🔎</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="前書き
 イケアは好奇心旺盛な店です。特定の商品を1つ購入するつもりで、残りのすべてのジャンクに気を取られないようにしたとしても、必要以上に3回購入することで終了します。私たちのハッカーにとって、この影響は電源ケーブルまたはバッテリーを備えたIkea部門で特に顕著です。
 
 私にとって、そのような...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>私たちはイケアをポンプします：軽い音楽をビッグブラザーに変える方法</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/495180/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/g-/1c/b3/g-1cb35ov13g0bc7demuvnxiqla.gif"></div><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前書き</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
イケアは好奇心旺盛な店です。特定の商品を1つ購入するつもりで、残りのすべてのジャンクに気を取られないようにしたとしても、必要以上に3回購入することで終了します。私たちのハッカーにとって、この影響は電源ケーブルまたはバッテリーを備えたIkea部門で特に顕著です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私にとって、そのような狂気の最後のケースはオランダで起こりました。私は予定されていた旅行にいて、国で数週間だけ過ごすことを計画していました。しかし、これは2020年の初めであり、COVID-19による災害でした...私は自分の研究室からずっと遠くにいる必要がありました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、Ikea </font><font style="vertical-align: inherit;">で</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Frekevensの</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">電子製品ラインを見たとき</font><font style="vertical-align: inherit;">、私はそれを助けることができず、それをすべて購入しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
知らない人のために：Ikea Frekvensラインは、昔ながらのHiFiセットと六角形のライトミュージックセットの現代的なアナログになり、90代の10代の半分の家にあるようです。この場合、相互に接続されたデバイスのラインは、サウンド出力用のBluetoothスピーカーと、音楽のビートに合わせて点滅するLEDプロジェクター（さまざまなノズルで補完）、および音楽にも移動するアニメーションを表示できるLEDキューブディスプレイで構成されます。 Ikeaは、このラインが、ポータブル「おもちゃ」シンセサイザーのPocket Operatorシリーズで知られている、Teenage Engineeringと共同で開発されたことを誇りに思っています。</font></font><br>
<a name="habracut"></a><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f4d/8b4/e60/f4d8b4e60e7812b5b979850a18d3926c.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ikea </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロモーションビデオに</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
示されて</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">いる</font></a><font style="vertical-align: inherit;">ように</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">、</font></a><font style="vertical-align: inherit;">数十台のデバイスの購入完了は耐えられないほどちらつくカーニバルのように見えるはずです。私の15歳のティーンエイジャーは自分の部屋に配置してもかまわないでしょう。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私は特にLEDキューブディスプレイに興味がありました。メインで動作する高品質の統合デバイスです。フロントパネルには、16行と16列の非常に明るい白色LEDのマトリックス、つまり合計256個のLEDがあります。デバイスに組み込まれたアニメーションはかなりシンプルでしたが、アイアンが実際に各LEDを個別に制御できるという考えに私を導きました。しかし、そのため、小さな箱はかなり高価でした。私のポケットには約40ユーロの空きがありました。この金額の場合、LEDと電源ケーブルが付いた箱が手に入ります。この製品は他のFrekvens製品と一緒に購入する必要があると想定されているため、追加の接続要素も受け取ります。主電源から他のボックスにエンドツーエンドで電力を供給するための延長電源ケーブル、また、ハウジングを互いに機械的に固定するためのネジとプラスチックパッドのセット。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
家に着くとすぐにデバイスを接続しました。正直なところ、彼らがアイロンで何をしたかには少しがっかりしました。</font><font style="vertical-align: inherit;">デバイスには、ケースの背面にあるボタンを押すことで選択できるいくつかのアニメーションがありました。</font><font style="vertical-align: inherit;">ケースには小さなマイクが取り付けられています。ノイズを認識するたびに、アニメーションのフレームが変化します。</font><font style="vertical-align: inherit;">アニメーションはそれほど興味深いものではありません。4つから5つのフレームのみで構成され、フレーム自体は白黒のみで、グレーの陰影はありません。</font><font style="vertical-align: inherit;">興味があれば</font><font style="vertical-align: inherit;">、すべてのアニメーションを</font><font style="vertical-align: inherit;">含む短い</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ビデオ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を録画しました</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
明らかに、これは私には合いませんでした。</font><font style="vertical-align: inherit;">デバイスをハックしましょう-何が機能するのかを見てみましょう。その動作をもう少し面白くすることは可能でしょうか。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">剖検</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Frekvensを分解するには、十字型のスロット用のドライバーと、場合によってはナイフで十分です。</font><font style="vertical-align: inherit;">また、デバイスを分解するのは簡単ではないため、忍耐力を確実に共有する必要があります。設計が複雑で、一部の要素がシリコーンで満たされているため、おそらく振動がなくなり、製造が簡単になります。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/71d/6e9/925/71d6e9925d31cbce7d1da4cf492948de.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
フレクベンス事件の解体は後ろから始まります。</font><font style="vertical-align: inherit;">筐体の前面を除いて、すべての側面にネジ穴があります。</font><font style="vertical-align: inherit;">デバイスのキットのネジとカバーのセットのおかげで、他のFrekvensガジェットに接続できます。</font><font style="vertical-align: inherit;">ただし、ネジの後部の穴は少し深く、その下にはケースを固定するネジがあります。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ebf/2c5/8e2/ebf2c58e270c942b8e360a744f0ff6ea.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
背面カバーを取り外すと、すべてのネジ穴にネジが差し込まれる金属製のインサートが付いていることがわかります。</font><font style="vertical-align: inherit;">うわー！</font><font style="vertical-align: inherit;">これにより、穴に十分な安全マージンが確保されます。</font><font style="vertical-align: inherit;">これが製造や分解を非常に複雑にする可能性があります。</font><font style="vertical-align: inherit;">後者は、硬化したシリコーン化合物の滴を最初にカットする必要があるという事実によって複雑になります。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4ca/78c/bf2/4ca78cbf2e1f533658a361fd998a933a.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
インサートは実際には他のプラスチック製インサートで固定されています。</font><font style="vertical-align: inherit;">最初に削除する必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
分解プロセスの他の写真はありませんが、この段階の後、ねじを外す必要がある4つのねじが表示され、その後、プロセスは以前と同様に続行されます。</font><font style="vertical-align: inherit;">他のすべてを一緒に保持しているプラ​​スチック片を理解し、シリコーン化合物をカットし、プラスチックファスナーを取り外します。</font><font style="vertical-align: inherit;">回路基板を引き出すことができるまで続けます。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e40/8c0/346/e408c0346ddbea872aa6100a7c37c303.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
回路基板の裏側です。結局のところ、それは2つのプリント回路基板から組み立てられています。白いものには2つの側面があります。背面にはすべてのLEDドライバーがあり（別の基板が取り付けられています）、前面にはLED自体があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
白い回路基板はかなりうまく設計されています：LEDのマトリックスの代わりに、16 </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">個のSCT2024</font></a><font style="vertical-align: inherit;"> LEDドライバーがあります</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">直流からの作業。これらのLEDドライバーには16チャンネルがあります。つまり、各LEDは直接制御されます。 LEDドライバーが完全にオンまたはオフにできるのはLEDだけです。ドライバ自体には、ネイティブのグレースケールサポートはありません。実際、これらは電流制御出力を使用してレジスタシフトを実行し、すべて順番に切り替わります。緑のPCB接続インターフェースは、同期バスとデータ、スナップイネーブルライン、出力、グランド、および電源イネーブルラインで構成されています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このグリーンボード上にあるのは、デバイスの小さな頭脳です。Googleには記事が掲載されていないマイクロコントローラーと、マイク用のオペアンプです。</font><font style="vertical-align: inherit;">興味深いことに、デバイスにもっと多くの機能が必要であるというヒントがあります。おそらく、I2C EEPROM 24Cxxの場所があり、元のプロジェクトではフロントパネルにIRレシーバーがあったというヒントがあります。</font><font style="vertical-align: inherit;">多分それはあなたがあなた自身のパターンを作成することを可能にするリモコンが装置に付いていると思われましたか？</font><font style="vertical-align: inherit;">これは、既存のアニメーションが非常に鈍く見えることを説明している可能性があります。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/40f/a7a/1d9/40fa7a1d95a60af223eb12a5f5db7ba6.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ホワイトボードの前面には、すべてのLEDがあります。</font><font style="vertical-align: inherit;">小さな平らなマイクもそれにはんだ付けされています。</font><font style="vertical-align: inherit;">最初はグリーンボードにはんだ付けされてホワイトボードの穴からはみ出していると思いましたが、実はただフラットです。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2bb/613/620/2bb6136207e5ce1cf78895a6827a8dfd.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
他のすべての電子機器はボードの背面にあります。</font><font style="vertical-align: inherit;">それだけでは不十分です。4Vを発行するIkeaブランドの電源のみです。電源の下には、ケースの背面にあるボタン用の2つの触覚スイッチがある小さなプリント基板があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、設計を「最適化」したい場合、明らかな弱点があります。小さなグリーンカードを、より強力なプロセッサを備えたプロセッサと交換することをお勧めします。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">鉄を改造する</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
機器をESP-Camに置き換えることは可能かもしれないと思いました。これは、ESP32 WiFi / BTチップ、数メガバイトのPSRAM、およびカメラモジュールを備えた非常に安価な（10ユーロ程度）ボードです。私は軽い音楽にはあまり興味がありません。デバイスが視覚的なものに反応することを望んでいました。フロントエンドにはすでにレシーバー用の穴が開いていたので、カメラの下でも使えると思いました。また、マイクが配置されているホワイトボードに穴を開ける必要があります。幸いなことに、これらの役に立たないマイクトラックに加えて、これはLEDの1つのトラックのみを破壊します。私は穴をあけてトラックを復元しました。一時的にボードを元の位置に戻し、キューブをオンにしたところ、すべてのLEDがまだ機能していることを確認しました。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ed1/c45/456/ed1c454569bc1fa6734a8c16bdfed1ae.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これで、ドリル穴のあるボードができました。ESP-Camを接続して機械的に接続することしかできませんでした。緑のボードのシルクスクリーン上のすべてのパッドの目的をデザイナーが親切に示してくれたので、ほとんど何も推測する必要はありませんでした。電源は4 Vしか供給しないので、ESP-CAMチップの3.3 V入力に直接接続しました。 Vin 5Vピンに接続したときに、チップが起動したくなかったため、これを行わなければなりませんでした。おそらく、LDOレギュレータの電圧降下がわずかに大きいためです。振り返ってみると、ダイオードを4 Vソースと直列に接続して3.3〜3.4 Vを取得することは価値があると思いますが、私の解決策は機能しました。 ESP32はかなり気取らないです。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/021/93d/abe/02193dabe8880ceeea91807ec0a16d2f.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべてのコネクタをはんだ付けしたので、とにかくメカニックに対処する必要がありました。</font><font style="vertical-align: inherit;">これは「迅速で汚れた」プロジェクトで、以前にESP-Camコネクタをはんだ付けしていたため、カメラを穴に合わせるには、いくつかのガスケットと大量のエポキシを使用しました。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e62/f14/364/e62f143645504bfd1636cab8fdb3cdf8.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この操作の後、最後の問題が残りました。カメラの隣のLEDがフレームウィンドウで輝き、あらゆる種類の奇妙なアーティファクトを引き起こしました。</font><font style="vertical-align: inherit;">まず、それらを排除するために、アルミテープから小さなベゼルを切り取り、カメラを直接光から保護しました。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fa7/1a8/1bb/fa71a81bb0a3131132885840f8186e85.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
第二段階はアクリル絵の具の塗布でした。</font><font style="vertical-align: inherit;">これは、すべてのディフューザーが配置されているプラ​​スチック製のインサートで、LEDが光ります。</font><font style="vertical-align: inherit;">マイク用の穴を拡大してカメラのフレームウィンドウを広げましたが、これにより別の問題が発生しました。穴が目立ちすぎて、拡散した光がカメラに当たりすぎました。</font><font style="vertical-align: inherit;">黒のアクリル絵の具の汚れはどちらの問題でもかなりうまくいきました。</font><font style="vertical-align: inherit;">カメラはまだLEDからかなりの量の光を受け取っていましたが、今では完全にフラッディングすることはありませんでした。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これで、脳移植が完了し、身体を組み立てる準備が整いました。</font><font style="vertical-align: inherit;">ソフトウェアを起動できます。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ソフトウェア</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ソフトウェアに移りましょう。まず、LEDドライバーを制御する必要があります。これは難しくありません。ドライバ信号は、ESP32チップのSPI周辺インターフェイスとほぼ直接一致しています。ボード上のCLKパッドはSPI周辺CLKインターフェイスに接続し、ボード上のDAパッドはSPI信号のMOSIに接続します。これにより、256ビットをLEDドライバーのチェーンと同期させることができます。同期された各ビットは、対応するLEDのオンまたはオフを制御します。さらに、LAKエントランスがあります。信号が低い場合、シフトレジスタに何が転送されたかに関係なく、LEDは以前の値を保持します。信号が高い場合、それらのすべてが同時にシフトレジスタに現在ある値に同時に切り替わります。最後に、すべてのLEDをオンまたはオフにするEN入力があります。GPIOに接続せず、常にプログラムでLEDをオンにしました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このようにして、個々のLEDをオン/オフして、白黒のディスプレイを表示できるようになりました。しかし、私は何か他のものが必要です。十分な計算能力があれば、ディスプレイは灰色の濃淡も表示できるはずです。そのためには、目に見えるよりも速くLEDをオン/オフにする必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これを単一のLEDで実装するには、通常PWMを使用しますが、256個のLEDの場合、これはESP32プロセッサの電力のかなりの部分を占めます。そこで、代わりに、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バイナリコード変調</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（ビットアングル変調とも呼ば</font><font style="vertical-align: inherit;">れます）を使用することにしました</font><font style="vertical-align: inherit;">。これは、より少ないCPU能力で灰色の階調を得ることができるテクニックです。私はすでに</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">他のプロジェクト</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">でそれを</font><font style="vertical-align: inherit;">うまく使用して</font><font style="vertical-align: inherit;">いるので、それがうまくいくと確信していました。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e99/009/265/e990092656bfd3db2032718f55e7e086.jpg"></div></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そしてそれはうまくいった。また、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CIE明度をPWM</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">変換する</font></a><font style="vertical-align: inherit;">ルックアップテーブルも追加しました</font><font style="vertical-align: inherit;">。これは、目が本質的にLEDの明度に非線形に応答するためです。ルックアップテーブルはこの問題を修正します。結局、自分で設定したピクセル値に従って、十分な量のグレーシェードと光学輝度の線形スケーリングを実現することができました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
カメラプロジェクトを実装することは難しくありませんでした。プロジェクトに追加できるESP-IDFコンポーネントがあります。カメラの設定とデータの交換は彼が担当します。必要なパラメーターを指定して、カメラが認識するビットマップを要求するだけです。標準設定で使用できなかった唯一のことは、自動整列と自動露出がデフォルトでオンになっていて、LEDを制御する方法にかなり干渉していたことです。バイナリコード変調シーケンスのどの部分にイメージが作成されたかによって、カメラは、位置合わせと露出をかなりランダムに増減しました。カメラを手動調整とシャッター速度に切り替えることで問題を修正しました。コード自体が画像を調べ、これらのパラメーターに補正が必要かどうかを判断します。このような手動処理のおかげで、LEDを直接見たピクセルを除外して、方程式から完全に取り除くこともできました。これはまた、安定した画像を取得するのに大きく役立ちました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これで、カメラとグレーの色調の16x16キャンバスができました。どうすればいいですか？私はアイデアを得ました。非常に最初のMacintoshコンピュータの当時、人気のある拡張機能があり、メニューバーにいくつかの漫画の目を追加するだけでした。これらの目は単にカーソルを追った。 （「xeyes」と呼ばれるLinux / Unixのこのテーマのバリエーションはまだ存在します。）現実の世界でそれを繰り返そうとするとどうなりますか？</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6d1/c9e/0a1/6d1c9e0a114c84f246c051c4358cdcc7.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
手始めに、私はいくつかの目の画像が必要でした。自分に価値のあるものを描くことができるとは思っていなかったので、代わりに自分の目を基本的な絵として使うことにしました。私が見て、すべての方向に点滅する短いビデオを見てください。現在の状況のた​​め、専門的なツールはほとんどありませんでした。天井の蛍光灯から落ちる照明を最大化し、見やすい画像を得るために床に横になります。ビデオはすべて、私が手に持っているスマートフォンで撮影されました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初のデータはかなりずさんだったので、後処理に一生懸命取り組む必要がありました。まず、右目の周りの断片を切り取りました。次に、ビデオの各フレームを画像に変換し、すべての冗長な画像を削除しました。結局、私はさまざまな方向を向いている自分の画像の適切な選択と、瞬きのあるいくつかのフレームを手に入れました。しかし、携帯電話を使って録音したので、映像が少し揺れて動画が飛んでしまった。これを修正するために、</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">Hugin</font></a><font style="vertical-align: inherit;">画像</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">接着剤</font></a><font style="vertical-align: inherit;">プログラムに一連の画像を渡しました</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">これは通常、パノラマとHDR画像に使用されます。出口では、理想的には顔のこの部分を中心に写真を撮りました。今、私は自分が見ている方向と、まばたきしたかどうかだけをマークすることができました。まず、すべての画像を灰色の濃淡に変換し、次に</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gimpに</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アップロードしました</font><font style="vertical-align: inherit;">。それぞれの画像で、瞳孔の中心の位置を示すために赤い点を使用し、まばたきしている場合、またはまばたきしている場合、目が半分開いているか閉じているかを示すために、左または右隅の赤い点を使用しました。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bb6/112/a73/bb6112a73c7b9fbdb619afaff1b971c9.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このように各画像にマークを付けた後、まばたきの状態だけでなく、瞳孔の場所を取得するスクリプトを書くのが非常に簡単になりました。スクリプトはまた、画像を16x16にスケーリングし、ESP-CAMモジュールファームウェアに書き込む準備ができた生のバイナリデータとして保存しました。最後に、一連の画像と、瞳孔の位置とまばたきの状態のインデックスを取得しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ESP-Camには、ESP-IDF用のかなり使いやすいカメラライブラリコンポーネントがあるため、画像の取得は簡単でした。 120x160の画像をグレーシェードで取得するように設定しました。これらの画像は処理が最も簡単であり、最終的な結果は16x16の画面に表示する必要があるため、あまり解像度を必要としませんでした。ただし、まだハードウェアの問題がありました。カメラがまだLEDに近すぎます。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cb1/d78/621/cb1d786213e7450791968f0e7da4d6c3.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初、私はキャリブレーションによってそれを解決しようとしました：デバイスが起動すると、2つの写真を撮ります：1つはカメラのレンズに近いLEDで、もう1つはカメラから遠くにあるLEDだけで。別の画像から1つの画像を差し引くと、LEDの影響を受けるピクセルを理解できます。これらのピクセルはマスクに格納されます。マスクでマークされたピクセルはその後無視されます。上の画像は、2つのショットと1つのマスクを示しています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
よりきれいな画像で、私はモーション認識に移ることができました。カメラからフレームを取得し、前のフレームを差し引いて実装しました。次に、結果として得られたすべてのピクセルを合計することで、動きの量を計算することができました。さらに、このピクセルのフレームの違いによって重み付けされたすべてのピクセルの座標の平均をとることによって、動きの集中の位置を計算することができました。結局、ADHDを搭載したジャックラッセルテリアのようにデバイスがぎくしゃくしないように、フィルタリングマジックが実行されます。彼の注意を引くには、オブジェクトがより均一に動くか、十分に動く必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
問題は1つだけでした。非常に暗いときに、モーション認識アルゴリズムが部屋の光沢のあるオブジェクトのLEDの反射に時々機能しました。目が点滅した場合は、その反射に注意してください。</font><font style="vertical-align: inherit;">これは私が望んでいたものとはまったく異なります。そのため、LEDの画像を変更するときにモーション認識アルゴリズムを「ブラインド」にすることで、この問題を回避しました。</font><font style="vertical-align: inherit;">だから私はこの行動を止めた。</font><font style="vertical-align: inherit;">さらに、少し現実的です。まばたきすると、見えなくなります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ファームウェアには、プロセス全体を示すいくつかのデバッグモードがあります。</font><font style="vertical-align: inherit;">これはこれを説明する短いビデオです：</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/bR-CpMdz02I" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結論</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
だから今私は私をフォローしているデバイスを持っています...本当に役に立たない、私は同意します。</font><font style="vertical-align: inherit;">しかし、それを作成することは私にとって興味深いものであり、16x16 LEDスクリーンに実装できるもっと便利なものを見つけた場合は、すでに制御コードを持っているので、それを実行できます。</font><font style="vertical-align: inherit;">コードと言えば、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ここから</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">生の結果を自由にダウンロードでき</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">ます</font></a><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">あなたがそれを楽しんだり、気をつけてくれればいいのに</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/UCPUPO21Cwk" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja495168/index.html">Pythonの三項演算子の代替形式</a></li>
<li><a href="../ja495170/index.html">一時的に私たちの生活から消えた音、そして待つことの価値がないその音-議論</a></li>
<li><a href="../ja495174/index.html">プロのフリーランス</a></li>
<li><a href="../ja495176/index.html">Kotlinでのオブジェクトのシリアル化の修正</a></li>
<li><a href="../ja495178/index.html">無料サイトの時間です</a></li>
<li><a href="../ja495184/index.html">輸入代替の困難：国営企業向けのツールが国内ソフトウェアのレジストリから削除されました</a></li>
<li><a href="../ja495188/index.html">外国語教育の難しさ（学生にもお勧めします）</a></li>
<li><a href="../ja495192/index.html">完璧なMinecraftサーバー起動スクリプト</a></li>
<li><a href="../ja495194/index.html">STM-32最小オーディオボード</a></li>
<li><a href="../ja495196/index.html">IBが「ダーウィン賞」、または愚かさ、ゴミ、騙しやすさ、およびそれらの結果についての7つのストーリーを持っている場合</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>