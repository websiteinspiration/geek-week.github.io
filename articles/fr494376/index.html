<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤞🏾 🔖 ❣️ Tampon de profondeur hiérarchique 🕦 🤶🏽 ➿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bref avis
 Un tampon de profondeur hiérarchique est un tampon de profondeur à plusieurs niveaux (Z-buffer) utilisé comme structure d'accélération pour...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Tampon de profondeur hiérarchique</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/494376/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/fr/kx/e8/frkxe8hnnru9xzoo2g9k8qec2sq.png"></div><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bref avis</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un tampon de profondeur hiérarchique est un tampon de profondeur à plusieurs niveaux (Z-buffer) utilisé comme structure d'accélération pour les requêtes de profondeur. Comme dans le cas des chaînes de mip de texture, les tailles de chaque niveau sont généralement le résultat de la division par le degré de deux des tailles du tampon pleine résolution. Dans cet article, je vais parler de deux façons de générer un tampon de profondeur hiérarchique à partir d'un tampon pleine résolution. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout d'abord, je vais vous montrer comment générer une chaîne de mip complète pour un tampon de profondeur, qui préserve la précision des requêtes de profondeur dans l'espace de coordonnées de texture (ou NDC) même pour des tailles de tampon de profondeur non égales à des puissances de deux. (Sur Internet, j'ai rencontré des exemples de code qui ne garantissent pas cette précision, ce qui complique l'exécution de requêtes précises à des niveaux de mip élevés.)</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, pour les cas où un seul niveau de sous-échantillonnage est requis, je montrerai comment générer ce niveau avec un seul appel à un shader de calcul à l'aide d'opérations atomiques dans la mémoire partagée du groupe de travail. </font><font style="vertical-align: inherit;">Pour mon application, où seule une résolution de 1/16 x 1/16 est requise (niveau de mip 4), la méthode avec un shader de calcul est </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2-3 fois plus rapide</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> que l'approche habituelle avec sous-échantillonnage de la chaîne de mip en plusieurs passes.</font></font><br>
<a name="habracut"></a><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">introduction</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les profondeurs hiérarchiques (également appelées Hi-Z) est une technique souvent utilisée dans les graphiques 3D. Il est utilisé pour accélérer le découpage de la géométrie invisible (élimination des occlusions) (dans le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CPU</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ainsi que</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dans le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GPU</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), le calcul des </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">réflexions dans l'espace de l'écran</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">le brouillard volumétrique</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et bien plus encore. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De plus, les GPU </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hi-Z sont souvent implémentés</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dans le cadre d'un pipeline de rastérisation. Les opérations de recherche rapide Hi-Z dans les caches sur la puce vous permettent d'ignorer complètement les fragments de fragments s'ils sont complètement couverts par des primitives précédemment rendues.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'idée de base de Hi-Z est d'accélérer les opérations de requête en profondeur en lisant à partir de tampons de résolution inférieure. </font><font style="vertical-align: inherit;">Ceci est plus rapide que la lecture des profondeurs en pleine résolution à partir du tampon, pour deux raisons:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un texel (ou seulement quelques texels) d'un tampon à résolution inférieure peut être utilisé comme valeur approximative d'une pluralité de texels d'un tampon à haute résolution.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un tampon de résolution inférieure peut être suffisamment petit et mis en cache, ce qui accélère considérablement l'exécution des opérations de recherche (en particulier avec un accès aléatoire).</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le contenu des niveaux de tampon Hi-Z sous-échantillonnés dépend de la façon dont ils sont utilisés (si le tampon de profondeur sera </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">«inversé»</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , quels types de requêtes doivent être utilisés). En général, un texel au niveau du tampon Hi-Z stocke </font></font><code>min</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou </font></font><code>max</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tous les texels qui lui correspondent au niveau précédent. Parfois, les valeurs de </font></font><code>min</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font><font style="vertical-align: inherit;">sont stockées en même temps </font></font><code>max</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Les valeurs moyennes simples (qui sont souvent utilisées dans les niveaux de mip des textures régulières) sont rarement utilisées car elles sont rarement utiles pour de tels types de requêtes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les tampons Hi-Z sont le plus souvent demandés presque immédiatement à la sortie pour éviter un traitement ultérieur et des opérations de recherche plus précises dans le tampon pleine résolution. Par exemple, si nous stockons des valeurs</font></font><code>max</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour un tampon de profondeur non inversé (dans lequel plus la valeur de profondeur est élevée, plus l'objet est éloigné), nous pouvons rapidement déterminer exactement si une position particulière dans l'espace d'écran est couverte par un tampon de profondeur (si sa coordonnée Z&gt; est la valeur (max) stockée dans certains niveau supérieur (c.-à-d., résolution inférieure) du tampon Hi-Z). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Veuillez noter que j'ai utilisé l'expression «exactement»: si la coordonnée Z &lt;= la valeur reçue (max), alors on ne sait pas si son tampon se chevauche. </font><font style="vertical-align: inherit;">Dans certaines applications, en cas d'incertitude, il peut être nécessaire de rechercher dans le tampon des profondeurs de pleine résolution; </font><font style="vertical-align: inherit;">dans d'autres cas, cela n'est pas nécessaire (par exemple, si seuls des calculs inutiles sont en jeu, et non le rendu correct).</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mon application: rendre des particules dans un shader de calcul</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'étais confronté à la nécessité d'utiliser Hi-Z lors de l'implémentation du </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rendu de particules dans un shader de calcul</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dans le moteur de mon application </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PARTICULATE</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> VR </font><font style="vertical-align: inherit;">. Étant donné que cette technique de rendu n'utilise pas la pixellisation avec des fonctions fixes, elle doit utiliser sa propre vérification de profondeur pour chaque particule d'une taille d'un pixel. Et comme les particules ne sont en aucun cas triées, l'accès au tampon de profondeur est (dans le pire des cas) presque aléatoire. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les opérations de recherche sur une texture à accès aléatoire en plein écran sont le moyen de mauvaises performances. Pour réduire la charge, je cherche d'abord les profondeurs dans le tampon de profondeur réduite avec une résolution de 1/16 x 1/16 par rapport à l'original. Ce tampon contient des valeurs de profondeur.</font></font><code>min</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, qui permet au shader de rendu de calcul pour la grande majorité des particules visibles de sauter le test de profondeur en pleine résolution. (Si la profondeur des particules est &lt;la profondeur minimale stockée dans le tampon de résolution inférieure, alors nous savons qu'elle est absolument visible. Si elle&gt; = min, alors nous devons vérifier le tampon de profondeur pleine résolution.) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Grâce à cela, le test de profondeur pour les particules visibles dans le cas général devient une opération à faible coût. (Pour les particules superposées par la géométrie, c'est plus cher, mais cela nous convient car cela n'entraîne pas de coûts de rendu, donc les particules nécessitent encore peu de calcul.) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Du fait que la recherche est d'abord effectuée dans le tampon de profondeurs de résolution inférieure (comme mentionné ci-dessus) , le </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">temps de rendu des particules est réduit de 35% maximum</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">par rapport au cas où la recherche est effectuée uniquement dans le tampon pleine résolution. </font><font style="vertical-align: inherit;">Par conséquent, pour mon application, Hi-Z est très bénéfique. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous allons maintenant examiner deux techniques pour générer un tampon de profondeur hiérarchique.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Technique 1: génération d'une chaîne Mip complète</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans de nombreuses applications Hi-Z, la création d'une chaîne complète de mip de tampon de profondeur est requise. Par exemple, lorsque vous effectuez une élimination d'occlusion à l'aide de Hi-Z, le volume de délimitation est projeté dans l'espace d'écran et la taille projetée est utilisée pour sélectionner le niveau de mip approprié (de sorte qu'un nombre fixe de texels est impliqué dans chaque test de chevauchement). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La génération d'une chaîne mip à partir du tampon de profondeur pleine résolution est généralement une tâche simple - pour chaque texel au niveau N, nous prenons </font></font><code>max</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font><code>min</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou les deux) les 4 texels correspondants dans le niveau N-1 précédemment généré. Nous effectuons des passes séquentielles (chaque fois en réduisant la taille de moitié) jusqu'à ce que nous obtenions le dernier niveau de mip 1x1.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cependant, dans le cas des tampons de profondeur, dont les tailles ne correspondent pas aux puissances de deux, tout est plus compliqué. Étant donné que Hi-Z pour les tampons de profondeur est souvent construit à partir de résolutions d'écran standard (qui sont rarement des puissances de deux), nous devons trouver une solution fiable à ce problème. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Décidons d'abord ce que signifiera la valeur de chaque tampon de profondeur de niveau mip texel. Dans cet article, nous supposerons que la chaîne mip stocke des valeurs </font></font><code>min</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Les opérations de recherche de profondeur doivent utiliser le filtrage des voisins les plus proches, car l'interpolation des valeurs est </font></font><code>min</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">inutile pour nous et nuira à la nature hiérarchique de la chaîne mip de profondeurs créée. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alors, que signifiera exactement la valeur du texel individuel au niveau mip N obtenu par nous? Cela devrait être la valeur minimale (</font></font><code>min</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) de tous les texels du tampon de profondeur plein écran qui occupe le même espace dans l'espace de coordonnées de texture (normalisé). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En d'autres termes, si une coordonnée distincte de la texture (dans l'intervalle</font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) est mappé (en filtrant les voisins les plus proches) sur un texel individuel du tampon pleine résolution, alors ce texel de pleine résolution doit être considéré comme un candidat pour la valeur</font><font style="vertical-align: inherit;">calculée pour le texel à chaque niveau de mip supérieur suivant avec lequel la même coordonnée est mappée textures.</font><font style="vertical-align: inherit;">
Si cette correspondance est garantie, alors nous serons sûrs que l'opération de recherche à des niveaux de mip élevés ne renverra jamais la valeur de profondeur&gt; valeur de texel dans la même coordonnée de texture correspondant au tampon pleine résolution (niveau 0). Dans le cas d'un N séparé, cette garantie est maintenue pour tous les niveaux inférieurs (&lt;N).</font></font><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>[</mo><mn>0</mn><mo>,</mo><mn>1</mn><msup><mo stretchy=&quot;false&quot;>]</mo><mn>2</mn></msup></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.707ex" height="2.884ex" viewBox="0 -916.9 2457.1 1241.8" role="img" focusable="false" style="vertical-align: -0.755ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAIN-5B" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAIN-30" x="278" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAIN-2C" x="779" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAIN-31" x="1224" y="0"></use><g transform="translate(1724,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAIN-5D" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAIN-32" x="393" y="513"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">[</mo><mn>0</mn><mo>,</mo><mn>1</mn><msup><mo stretchy="false">]</mo><mn>2</mn></msup></math></span></span><script type="math/tex" id="MathJax-Element-1">[0, 1]^2</script><font style="vertical-align: inherit;"></font><code>min</code><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour les dimensions paires (et dans le cas de tampons pleine résolution, qui sont des puissances de deux, les dimensions paires à chaque niveau jusqu'au dernier, où les dimensions deviennent égales à 1) seront faciles à faire. </font><font style="vertical-align: inherit;">Dans le cas unidimensionnel, pour le texel avec un indice</font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>i</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="0.802ex" height="2.009ex" viewBox="0 -755.5 345.5 865.1" role="img" focusable="false" style="vertical-align: -0.255ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMATHI-69" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>i</mi></math></span></span><script type="math/tex" id="MathJax-Element-2">i</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> au niveau N, nous devons prendre des texels au niveau N-1 avec des indices</font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mn>2</mn></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.162ex" height="2.009ex" viewBox="0 -755.5 500.5 865.1" role="img" focusable="false" style="vertical-align: -0.255ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAIN-32" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>2</mn></math></span></span><script type="math/tex" id="MathJax-Element-3">2</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et</font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-4-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mn>2</mn><mi>i</mi><mo>+</mo><mn>1</mn></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.968ex" height="2.134ex" viewBox="0 -755.5 2569.4 918.9" role="img" focusable="false" style="vertical-align: -0.38ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAIN-32" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMATHI-69" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAIN-2B" x="1068" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAIN-31" x="2068" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>2</mn><mi>i</mi><mo>+</mo><mn>1</mn></math></span></span><script type="math/tex" id="MathJax-Element-4">2i + 1</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et trouvez leur valeur</font></font><code>min</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">C'est à dire</font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-5-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>D</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>N</mi></mrow></msub><mo stretchy=&quot;false&quot;>[</mo><mi>i</mi><mo stretchy=&quot;false&quot;>]</mo><mo>=</mo><mtext>min</mtext><mo stretchy=&quot;false&quot;>(</mo><msub><mi>D</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>N</mi><mo>&amp;#x2212;</mo><mn>1</mn></mrow></msub><mo stretchy=&quot;false&quot;>[</mo><mn>2</mn><mi>i</mi><mo stretchy=&quot;false&quot;>]</mo><mo>,</mo><msub><mi>D</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>N</mi><mo>&amp;#x2212;</mo><mn>1</mn></mrow></msub><mo stretchy=&quot;false&quot;>[</mo><mn>2</mn><mi>i</mi><mo>+</mo><mn>1</mn><mo stretchy=&quot;false&quot;>]</mo><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="37.481ex" height="2.634ex" viewBox="0 -809.3 16137.7 1134.2" role="img" focusable="false" style="vertical-align: -0.755ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMATHI-44" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMATHI-4E" x="1171" y="-213"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAIN-5B" x="1556" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMATHI-69" x="1835" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAIN-5D" x="2180" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAIN-3D" x="2737" y="0"></use><g transform="translate(3793,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAIN-6D"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAIN-69" x="833" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAIN-6E" x="1112" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAIN-28" x="5461" y="0"></use><g transform="translate(5851,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMATHI-44" x="0" y="0"></use><g transform="translate(828,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMATHI-4E" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAIN-2212" x="888" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAIN-31" x="1667" y="0"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAIN-5B" x="8312" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAIN-32" x="8590" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMATHI-69" x="9091" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAIN-5D" x="9436" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAIN-2C" x="9715" y="0"></use><g transform="translate(10160,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMATHI-44" x="0" y="0"></use><g transform="translate(828,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMATHI-4E" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAIN-2212" x="888" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAIN-31" x="1667" y="0"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAIN-5B" x="12621" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAIN-32" x="12900" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMATHI-69" x="13400" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAIN-2B" x="13968" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAIN-31" x="14969" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAIN-5D" x="15469" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAIN-29" x="15748" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>D</mi><mrow class="MJX-TeXAtom-ORD"><mi>N</mi></mrow></msub><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo>=</mo><mtext>min</mtext><mo stretchy="false">(</mo><msub><mi>D</mi><mrow class="MJX-TeXAtom-ORD"><mi>N</mi><mo>−</mo><mn>1</mn></mrow></msub><mo stretchy="false">[</mo><mn>2</mn><mi>i</mi><mo stretchy="false">]</mo><mo>,</mo><msub><mi>D</mi><mrow class="MJX-TeXAtom-ORD"><mi>N</mi><mo>−</mo><mn>1</mn></mrow></msub><mo stretchy="false">[</mo><mn>2</mn><mi>i</mi><mo>+</mo><mn>1</mn><mo stretchy="false">]</mo><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-5">D_{N}[i] = \text{min}(D_{N-1}[2i], D_{N-1}[2i + 1])</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Nous pouvons comparer directement les texels dans le rapport «2 pour 1» (et donc la taille des coordonnées de texture), car la taille de chaque niveau est exactement deux fois plus petite que la précédente.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/11f/ca7/b43/11fca7b43dd706d72f35590f69422e2c.svg"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un exemple de tailles de niveau égales: 6 texels à ce niveau sont réduits à 3 à un niveau supérieur. </font><font style="vertical-align: inherit;">Les tailles de coordonnées de texture de chacun des trois texels de haut niveau sont précisément superposées à tous les deux texels de niveau inférieur. </font><font style="vertical-align: inherit;">(Les points sont les centres des texels, et les carrés sont les dimensions des coordonnées de texture lors du filtrage des voisins les plus proches.)</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Dans le cas de tailles de niveau impair (et les tampons de pleine résolution qui ne sont pas une puissance de deux auront au moins un niveau avec une taille impaire) Devient plus dur. </font><font style="vertical-align: inherit;">Pour le niveau N-1 de taille impaire</font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> taille du niveau suivant (N) sera égale</font></font><span class="MathJax_SVG" id="MathJax-Element-6-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;>d</mi><mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;>i</mi><mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;>m</mi></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>N</mi><mo>&amp;#x2212;</mo><mn>1</mn></mrow></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="7.595ex" height="2.384ex" viewBox="0 -755.5 3270.2 1026.6" role="img" focusable="false" style="vertical-align: -0.63ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAINI-64" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAINI-69" x="511" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAINI-6D" x="819" y="0"></use><g transform="translate(1637,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMATHI-4E" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAIN-2212" x="888" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAIN-31" x="1667" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mrow class="MJX-TeXAtom-ORD"><mi class="MJX-tex-mathit" mathvariant="italic">d</mi><mi class="MJX-tex-mathit" mathvariant="italic">i</mi><mi class="MJX-tex-mathit" mathvariant="italic">m</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mi>N</mi><mo>−</mo><mn>1</mn></mrow></msub></math></span></span><script type="math/tex" id="MathJax-Element-6">\mathit{dim}_{N-1}</script><font style="vertical-align: inherit;"></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-7-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;>d</mi><mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;>i</mi><mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;>m</mi></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>N</mi></mrow></msub><mo>=</mo><mo fence=&quot;false&quot; stretchy=&quot;false&quot;>&amp;#x230A;</mo><mfrac><msub><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;>d</mi><mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;>i</mi><mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;>m</mi></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>N</mi><mo>&amp;#x2212;</mo><mn>1</mn></mrow></msub><mn>2</mn></mfrac><mo fence=&quot;false&quot; stretchy=&quot;false&quot;>&amp;#x230B;</mo></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="16.865ex" height="3.759ex" viewBox="0 -1132.2 7261.2 1618.6" role="img" focusable="false" style="vertical-align: -1.13ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAINI-64" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAINI-69" x="511" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAINI-6D" x="819" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMATHI-4E" x="2315" y="-213"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAIN-3D" x="2643" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAIN-230A" x="3699" y="0"></use><g transform="translate(4144,0)"><g transform="translate(120,0)"><rect stroke="none" width="2432" height="60" x="0" y="220"></rect><g transform="translate(60,558)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAINI-64" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAINI-69" x="511" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAINI-6D" x="819" y="0"></use><g transform="translate(1157,-107)"><use transform="scale(0.5)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMATHI-4E" x="0" y="0"></use><use transform="scale(0.5)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAIN-2212" x="888" y="0"></use><use transform="scale(0.5)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAIN-31" x="1667" y="0"></use></g></g><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAIN-32" x="1469" y="-542"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAIN-230B" x="6816" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mrow class="MJX-TeXAtom-ORD"><mi class="MJX-tex-mathit" mathvariant="italic">d</mi><mi class="MJX-tex-mathit" mathvariant="italic">i</mi><mi class="MJX-tex-mathit" mathvariant="italic">m</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mi>N</mi></mrow></msub><mo>=</mo><mo fence="false" stretchy="false">⌊</mo><mfrac><msub><mrow class="MJX-TeXAtom-ORD"><mi class="MJX-tex-mathit" mathvariant="italic">d</mi><mi class="MJX-tex-mathit" mathvariant="italic">i</mi><mi class="MJX-tex-mathit" mathvariant="italic">m</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mi>N</mi><mo>−</mo><mn>1</mn></mrow></msub><mn>2</mn></mfrac><mo fence="false" stretchy="false">⌋</mo></math></span></span><script type="math/tex" id="MathJax-Element-7">\mathit{dim}_{N} = \lfloor \frac{\mathit{dim}_{N-1}}{2} \rfloor</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, c'est-à-dire</font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-8-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo>&amp;#x2260;</mo><mfrac><msub><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;>d</mi><mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;>i</mi><mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;>m</mi></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>N</mi><mo>&amp;#x2212;</mo><mn>1</mn></mrow></msub><mn>2</mn></mfrac></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="8.66ex" height="3.759ex" viewBox="0 -1132.2 3728.6 1618.6" role="img" focusable="false" style="vertical-align: -1.13ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAIN-2260" x="0" y="0"></use><g transform="translate(778,0)"><g transform="translate(397,0)"><rect stroke="none" width="2432" height="60" x="0" y="220"></rect><g transform="translate(60,558)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAINI-64" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAINI-69" x="511" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAINI-6D" x="819" y="0"></use><g transform="translate(1157,-107)"><use transform="scale(0.5)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMATHI-4E" x="0" y="0"></use><use transform="scale(0.5)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAIN-2212" x="888" y="0"></use><use transform="scale(0.5)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAIN-31" x="1667" y="0"></use></g></g><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAIN-32" x="1469" y="-542"></use></g></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>≠</mo><mfrac><msub><mrow class="MJX-TeXAtom-ORD"><mi class="MJX-tex-mathit" mathvariant="italic">d</mi><mi class="MJX-tex-mathit" mathvariant="italic">i</mi><mi class="MJX-tex-mathit" mathvariant="italic">m</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mi>N</mi><mo>−</mo><mn>1</mn></mrow></msub><mn>2</mn></mfrac></math></span></span><script type="math/tex" id="MathJax-Element-8">\neq \frac{\mathit{dim}_{N-1}}{2}</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cela signifie que maintenant nous n'avons pas de mappage clair de 2 à 1 des texels de niveau N-1 aux texels de niveau N. Maintenant, la taille de la coordonnée de texture de chaque texel au niveau N est superposée à la taille de</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">texels au niveau N-1.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/48d/9d6/6e1/48d9d66e16424a3781e695a3340d2cb4.svg"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un exemple de taille de niveau impair: 7 texels de ce niveau sont réduits à 3 texels au niveau suivant. </font><font style="vertical-align: inherit;">Les dimensions des coordonnées de texture des trois texels de haut niveau se superposent aux tailles des trois texels du niveau inférieur. </font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par conséquent</font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-9-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>D</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>N</mi></mrow></msub><mo stretchy=&quot;false&quot;>[</mo><mi>i</mi><mo stretchy=&quot;false&quot;>]</mo><mo>=</mo><mtext>min</mtext><mo stretchy=&quot;false&quot;>(</mo><msub><mi>D</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>N</mi><mo>&amp;#x2212;</mo><mn>1</mn></mrow></msub><mo stretchy=&quot;false&quot;>[</mo><mn>2</mn><mi>i</mi><mo stretchy=&quot;false&quot;>]</mo><mo>,</mo><msub><mi>D</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>N</mi><mo>&amp;#x2212;</mo><mn>1</mn></mrow></msub><mo stretchy=&quot;false&quot;>[</mo><mn>2</mn><mi>i</mi><mo>+</mo><mn>1</mn><mo stretchy=&quot;false&quot;>]</mo><mo>,</mo><msub><mi>D</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>N</mi><mo>&amp;#x2212;</mo><mn>1</mn></mrow></msub><mo stretchy=&quot;false&quot;>[</mo><mn>2</mn><mi>i</mi><mo>+</mo><mn>2</mn><mo stretchy=&quot;false&quot;>]</mo><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="51.493ex" height="2.634ex" viewBox="0 -809.3 22170.5 1134.2" role="img" focusable="false" style="vertical-align: -0.755ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMATHI-44" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMATHI-4E" x="1171" y="-213"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAIN-5B" x="1556" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMATHI-69" x="1835" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAIN-5D" x="2180" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAIN-3D" x="2737" y="0"></use><g transform="translate(3793,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAIN-6D"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAIN-69" x="833" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAIN-6E" x="1112" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAIN-28" x="5461" y="0"></use><g transform="translate(5851,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMATHI-44" x="0" y="0"></use><g transform="translate(828,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMATHI-4E" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAIN-2212" x="888" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAIN-31" x="1667" y="0"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAIN-5B" x="8312" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAIN-32" x="8590" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMATHI-69" x="9091" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAIN-5D" x="9436" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAIN-2C" x="9715" y="0"></use><g transform="translate(10160,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMATHI-44" x="0" y="0"></use><g transform="translate(828,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMATHI-4E" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAIN-2212" x="888" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAIN-31" x="1667" y="0"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAIN-5B" x="12621" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAIN-32" x="12900" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMATHI-69" x="13400" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAIN-2B" x="13968" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAIN-31" x="14969" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAIN-5D" x="15469" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAIN-2C" x="15748" y="0"></use><g transform="translate(16193,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMATHI-44" x="0" y="0"></use><g transform="translate(828,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMATHI-4E" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAIN-2212" x="888" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAIN-31" x="1667" y="0"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAIN-5B" x="18654" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAIN-32" x="18933" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMATHI-69" x="19433" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAIN-2B" x="20001" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAIN-32" x="21002" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAIN-5D" x="21502" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAIN-29" x="21781" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>D</mi><mrow class="MJX-TeXAtom-ORD"><mi>N</mi></mrow></msub><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo>=</mo><mtext>min</mtext><mo stretchy="false">(</mo><msub><mi>D</mi><mrow class="MJX-TeXAtom-ORD"><mi>N</mi><mo>−</mo><mn>1</mn></mrow></msub><mo stretchy="false">[</mo><mn>2</mn><mi>i</mi><mo stretchy="false">]</mo><mo>,</mo><msub><mi>D</mi><mrow class="MJX-TeXAtom-ORD"><mi>N</mi><mo>−</mo><mn>1</mn></mrow></msub><mo stretchy="false">[</mo><mn>2</mn><mi>i</mi><mo>+</mo><mn>1</mn><mo stretchy="false">]</mo><mo>,</mo><msub><mi>D</mi><mrow class="MJX-TeXAtom-ORD"><mi>N</mi><mo>−</mo><mn>1</mn></mrow></msub><mo stretchy="false">[</mo><mn>2</mn><mi>i</mi><mo>+</mo><mn>2</mn><mo stretchy="false">]</mo><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-9">D_{N}[i] = \text{min}(D_{N-1}[2i], D_{N-1}[2i + 1], D_{N-1}[2i + 2])</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Cela signifie qu'un texel au niveau de N-1 affecte parfois la valeur</font></font><code>min</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">calculée pour</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">texels au niveau de N. Ceci est nécessaire pour maintenir la comparaison décrite ci-dessus.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La description ci-dessus a été présentée dans une seule dimension pour plus de simplicité. </font><font style="vertical-align: inherit;">En deux dimensions, si les deux dimensions du niveau N-1 sont paires, alors la région de texel 2x2 au niveau N-1 est mappée à un texel au niveau N. Si l'une des dimensions est impaire, la région 2x3 ou 3x2 au niveau N-1 est mappée à une texel au niveau N. Si les </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">deux</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dimensions sont </font><font style="vertical-align: inherit;">impaires </font><font style="vertical-align: inherit;">, alors le texel «angulaire» doit également être pris en compte, c'est-à-dire que la région 3x3 au niveau N-1 est comparée à un texel au niveau N.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exemple de code</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le code de shader GLSL illustré ci-dessous implémente l'algorithme que nous avons décrit. </font><font style="vertical-align: inherit;">Il doit être exécuté pour chaque mip suivant, à partir du niveau 1 (le niveau 0 est le niveau de pleine résolution).</font></font><br>
<br>
<pre><code class="cpp hljs">uniform sampler2D u_depthBuffer;<font></font>
uniform <span class="hljs-keyword">int</span> u_previousLevel;<font></font>
uniform ivec2 u_previousLevelDimensions;<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{<font></font>
	ivec2 thisLevelTexelCoord = ivec2(gl_FragCoord);<font></font>
	ivec2 previousLevelBaseTexelCoord = <span class="hljs-number">2</span> * thisLevelTexelCoord;<font></font>
<font></font>
	vec4 depthTexelValues;<font></font>
	depthTexelValues.x = texelFetch(u_depthBuffer,<font></font>
                                    previousLevelBaseTexelCoord,<font></font>
                                    u_previousLevel).r;<font></font>
	depthTexelValues.y = texelFetch(u_depthBuffer,<font></font>
                                    previousLevelBaseTexelCoord + ivec2(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>),<font></font>
                                    u_previousLevel).r;<font></font>
	depthTexelValues.z = texelFetch(u_depthBuffer,<font></font>
                                    previousLevelBaseTexelCoord + ivec2(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>),<font></font>
                                    u_previousLevel).r;<font></font>
	depthTexelValues.w = texelFetch(u_depthBuffer,<font></font>
                                    previousLevelBaseTexelCoord + ivec2(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>),<font></font>
                                    u_previousLevel).r;<font></font>
<font></font>
	<span class="hljs-keyword">float</span> minDepth = min(min(depthTexelValues.x, depthTexelValues.y),<font></font>
                         min(depthTexelValues.z, depthTexelValues.w));<font></font>
<font></font>
    <span class="hljs-comment">// Incorporate additional texels if the previous level's width or height (or both) </span>
    <span class="hljs-comment">// are odd. </span>
	<span class="hljs-keyword">bool</span> shouldIncludeExtraColumnFromPreviousLevel = ((u_previousLevelDimensions.x &amp; <span class="hljs-number">1</span>) != <span class="hljs-number">0</span>);
	<span class="hljs-keyword">bool</span> shouldIncludeExtraRowFromPreviousLevel = ((u_previousLevelDimensions.y &amp; <span class="hljs-number">1</span>) != <span class="hljs-number">0</span>);
	<span class="hljs-keyword">if</span> (shouldIncludeExtraColumnFromPreviousLevel) {<font></font>
		vec2 extraColumnTexelValues;<font></font>
		extraColumnTexelValues.x = texelFetch(u_depthBuffer,<font></font>
                                              previousLevelBaseTexelCoord + ivec2(<span class="hljs-number">2</span>, <span class="hljs-number">0</span>),<font></font>
                                              u_previousLevel).r;<font></font>
		extraColumnTexelValues.y = texelFetch(u_depthBuffer,<font></font>
                                              previousLevelBaseTexelCoord + ivec2(<span class="hljs-number">2</span>, <span class="hljs-number">1</span>),<font></font>
                                              u_previousLevel).r;<font></font>
<font></font>
		<span class="hljs-comment">// In the case where the width and height are both odd, need to include the </span>
        <span class="hljs-comment">// 'corner' value as well. </span>
		<span class="hljs-keyword">if</span> (shouldIncludeExtraRowFromPreviousLevel) {
			<span class="hljs-keyword">float</span> cornerTexelValue = texelFetch(u_depthBuffer,<font></font>
                                                previousLevelBaseTexelCoord + ivec2(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>),<font></font>
                                                u_previousLevel).r;<font></font>
			minDepth = min(minDepth, cornerTexelValue);<font></font>
		}<font></font>
		minDepth = min(minDepth, min(extraColumnTexelValues.x, extraColumnTexelValues.y));<font></font>
	}<font></font>
	<span class="hljs-keyword">if</span> (shouldIncludeExtraRowFromPreviousLevel) {<font></font>
		vec2 extraRowTexelValues;<font></font>
		extraRowTexelValues.x = texelFetch(u_depthBuffer,<font></font>
                                           previousLevelBaseTexelCoord + ivec2(<span class="hljs-number">0</span>, <span class="hljs-number">2</span>),<font></font>
                                           u_previousLevel).r;<font></font>
		extraRowTexelValues.y = texelFetch(u_depthBuffer,<font></font>
                                           previousLevelBaseTexelCoord + ivec2(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>),<font></font>
                                           u_previousLevel).r;<font></font>
		minDepth = min(minDepth, min(extraRowTexelValues.x, extraRowTexelValues.y));<font></font>
	}<font></font>
<font></font>
	gl_FragDepth = minDepth;<font></font>
}</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Failles dans ce code</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Premièrement, dans le cas de tampons de profondeur pleine résolution pour lesquels une dimension est plus de deux fois la taille d'une autre dimension, les indices d'appel </font></font><code>texelFetch</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">peuvent aller au-delà </font></font><code>u_depthBuffer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. (Dans de tels cas, la plus petite dimension se transforme en 1 avant l'autre.) Je voulais utiliser dans cet exemple </font></font><code>texelFetch</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(en utilisant des coordonnées entières), afin que ce qui se passait soit aussi clair que possible et ne rencontre pas personnellement de tels tampons particulièrement larges / profonds. Si vous rencontrez de tels problèmes, vous pouvez limiter ( </font></font><code>clamp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) les </font></font><code>texelFetch</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">coordonnées </font><font style="vertical-align: inherit;">transmises </font><font style="vertical-align: inherit;">ou utiliser les </font></font><code>texture</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">coordonnées normalisées de la texture (dans l'échantillonneur, définissez une limite sur le bord). Lors du calcul </font></font><code>min</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou </font></font><code>max</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">doit toujours considérer un texel plusieurs fois pour la présence de cas limites.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Deuxièmement, malgré le fait que les quatre premiers appels </font></font><code>texelFetch</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">puissent être remplacés par un </font></font><code>textureGather</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, cela complique les choses (puisque le </font></font><code>textureGather</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">niveau de mip ne peut pas être indiqué); </font><font style="vertical-align: inherit;">De plus, je n'ai pas remarqué d'augmentation de vitesse lors de l'utilisation </font></font><code>textureGather</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Performance</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai utilisé le fragment shader ci-dessus pour générer deux chaînes de mip complètes pour deux (un pour chaque œil) tampons de profondeur dans mon moteur VR. </font><font style="vertical-align: inherit;">Dans le test, la résolution de chaque œil était de 1648x1776, ce qui a conduit à la création de 10 niveaux de mip réduits supplémentaires (ce qui signifie 10 passes). </font><font style="vertical-align: inherit;">Il a fallu 0,25 ms sur la NVIDIA GTX 980 et 0,30 ms sur l'AMD R9 290 pour générer une chaîne complète pour les deux yeux.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/805/461/815/8054618153533c29d1de1000fcee2878.jpg"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a8f/2b6/950/a8f2b6950b278655f3deff3ca456874c.png"></div><br>
<i>Mip- 4, 5  6,    ,     . ( ,     ,  ,     .) Mip- 4 — ,    (103x111)     2.</i><br>
<br>
<h2>   mip-</h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La tâche de l'algorithme décrit ci-dessus est de maintenir la précision des requêtes de profondeur dans l'espace de coordonnées de texture (ou NDC). Pour être complet (et parce que j'ai refusé cette garantie dans la technique ci-dessous 2), je voudrais démontrer une autre méthode que j'ai rencontrée (par exemple, dans </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cet article</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Notez que, comme la précédente, cette méthode alternative est conçue pour fonctionner avec des tampons pleine résolution dont les tailles ne sont pas des puissances de deux (mais, bien sûr, elles fonctionnent avec des tailles égales à des puissances de deux).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans cette méthode alternative, lors du sous-échantillonnage d'un niveau avec une largeur (ou une hauteur) impaire au lieu d'ajouter une colonne (ou une ligne) supplémentaire de texels du niveau précédent (inférieur) pour chaque texel de sortie, nous effectuons cette opération uniquement pour les texels de sortie avec des indices maximum (texels «extrêmes» ) La seule chose qui change dans le fragment shader présenté ci-dessus est la définition de valeurs </font></font><code>shouldIncludeExtraColumnFromPreviousLevel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code>shouldIncludeExtraRowFromPreviousLevel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">// If the previous level's width is odd and this is the highest-indexed "edge" texel for </span>
<span class="hljs-comment">// this level, incorporate the rightmost edge texels from the previous level. The same goes </span>
<span class="hljs-comment">// for the height. </span>
<span class="hljs-keyword">bool</span> shouldIncludeExtraColumnFromPreviousLevel =<font></font>
    (previousMipLevelBaseTexelCoords.x == u_previousLevelDimensions.x - <span class="hljs-number">3</span>);
<span class="hljs-keyword">bool</span> shouldIncludeExtraRowFromPreviousLevel =<font></font>
    (previousMipLevelBaseTexelCoords.y == u_previousLevelDimensions.y - <span class="hljs-number">3</span>);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De ce fait, les texels extrêmes avec l'indice le plus élevé deviennent très «épais», car chaque division par 2 dimensions impaires conduit au fait qu'ils occupent un intervalle proportionnellement plus grand de l'espace de coordonnées de texture normalisé. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'inconvénient de cette approche est qu'il devient plus difficile d'effectuer des requêtes de profondeur de niveaux de mip élevés. Au lieu d'utiliser simplement les coordonnées de texture normalisées, nous devons d'abord déterminer le texel de pleine résolution correspondant à ces coordonnées, puis transférer les coordonnées de ce texel aux coordonnées du niveau de mip correspondant, dont la demande est en cours d'exécution. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'extrait de code ci-dessous migre de l'espace NDC</font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-10-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>[</mo><mo>&amp;#x2212;</mo><mn>1</mn><mo>,</mo><mn>1</mn><msup><mo stretchy=&quot;false&quot;>]</mo><mn>2</mn></msup></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="7.515ex" height="2.884ex" viewBox="0 -916.9 3235.6 1241.8" role="img" focusable="false" style="vertical-align: -0.755ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAIN-5B" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAIN-2212" x="278" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAIN-31" x="1057" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAIN-2C" x="1557" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAIN-31" x="2002" y="0"></use><g transform="translate(2503,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAIN-5D" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAIN-32" x="393" y="513"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">[</mo><mo>−</mo><mn>1</mn><mo>,</mo><mn>1</mn><msup><mo stretchy="false">]</mo><mn>2</mn></msup></math></span></span><script type="math/tex" id="MathJax-Element-10">[-1, 1]^2</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> aux coordonnées texel au niveau du mip</font></font><code>higherMipLevel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="cpp hljs">vec2 windowCoords = (<span class="hljs-number">0.5</span> * ndc.xy + vec2(<span class="hljs-number">0.5</span>)) * textureSize(u_depthBuffer, <span class="hljs-number">0</span>);
<span class="hljs-comment">// Account for texel centers being halfway between integers. </span>
ivec2 texelCoords = ivec2(round(windowCoords.xy - vec2(<span class="hljs-number">0.5</span>)));<font></font>
ivec2 higherMipLevelTexelCoords =<font></font>
    min(texelCoords / (<span class="hljs-number">1</span> &lt;&lt; higherMipLevel),<font></font>
        textureSize(u_depthBuffer, higherMipLevel).xy - ivec2(<span class="hljs-number">1</span>));</code></pre><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Technique 2: générer un niveau Hi-Z unique à l'aide d'un nuanceur informatique</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La génération d'une chaîne de mip complète est assez rapide, mais cela m'a un peu dérangé que mon application génère tous ces niveaux et n'utilise qu'un seul d'entre eux (niveau 4). </font><font style="vertical-align: inherit;">En plus d'éliminer cette légère inefficacité, je voulais aussi voir à quel point tout pourrait être accéléré si je n'utilisais qu'un seul appel de shader de calcul pour générer le niveau dont j'avais besoin. </font><font style="vertical-align: inherit;">(Il convient de noter que mon application peut s'arrêter au niveau 4 lors de l'utilisation d'une solution avec un shader de fragment à passages multiples, donc à la fin de cette section, je l'ai utilisée comme base pour comparer les temps d'exécution.)</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans la plupart des applications Hi-Z, un seul niveau de profondeur est requis, donc je trouve cette situation courante. J'ai écrit un shader de calcul pour mes propres besoins spécifiques (génération de niveau 4, qui a une résolution de 1/16 x 1/16 par rapport à l'original). Un code similaire peut être utilisé pour générer différents niveaux. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le shader de calcul est bien adapté à cette tâche, car il peut utiliser la mémoire de groupe de travail partagée pour échanger des données entre les threads. Chaque groupe de travail est responsable d'un texel de sortie (réduit par le sous-échantillonnage du tampon), et les threads du groupe de travail partagent le travail de calcul des </font></font><code>min</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">texels correspondants de pleine résolution, partageant les résultats via la mémoire partagée.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai essayé deux solutions principales basées sur des shaders informatiques. Dans le premier, chaque thread a appelé </font></font><code>atomicMin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">une variable de mémoire partagée. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Veuillez noter que puisque les programmeurs ne peuvent pas (sans extensions pour le matériel d'un fabricant particulier) effectuer des opérations atomiques sur des valeurs non entières (et mes profondeurs sont stockées comme </font></font><code>float</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), une astuce est nécessaire ici. Étant donné que les valeurs à virgule flottante non négatives de la norme IEEE 754 conservent leur ordre lorsque leurs bits sont traités comme des valeurs entières non signées, nous pouvons utiliser </font></font><code>floatBitsToUint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour apporter (à l'aide de la fonte de réinterprétation) les valeurs de profondeur </font></font><code>float</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">à </font></font><code>uint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, puis appeler </font></font><code>atomicMin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(pour ensuite exécuter </font></font><code>uintBitsToFloat</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour la valeur minimale finie </font></font><code>uint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) .</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La solution la plus évidente </font></font><code>atomicMin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">serait de créer des groupes de threads 16x16 dans lesquels chaque thread reçoit un texel puis l'exécute </font></font><code>atomicMin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">avec une valeur dans la mémoire partagée. J'ai comparé cette approche en utilisant des blocs de flux plus petits (8x8, 4x8, 4x4, 2x4, 2x2), dans lesquels chaque flux reçoit une région de texels et calcule son propre minimum local, puis appelle </font></font><code>atomicMin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La plus rapide de toutes ces solutions testées avec</font></font><code>atomicMin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NVIDIA et AMD se sont avérés avoir une solution avec des blocs de flux 4x4 (dans lesquels chaque flux lui-même reçoit une zone de texel 4x4). </font><font style="vertical-align: inherit;">Je ne comprends pas très bien pourquoi cette option s'est avérée la plus rapide, mais elle reflète peut-être un compromis entre la concurrence des opérations atomiques et les calculs en flux indépendants. </font><font style="vertical-align: inherit;">Il convient également de noter que la taille du groupe de travail 4x4 n'utilise que 16 threads par chaîne / onde (et il est possible d'utiliser également 32 ou 64), ce qui est intéressant. </font><font style="vertical-align: inherit;">L'exemple ci-dessous met en œuvre cette approche. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme alternative à l'utilisation, </font></font><code>atomicMin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">j'ai essayé d'effectuer une réduction parallèle en utilisant les techniques utilisées dans </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cette présentation NVIDIA activement citée.</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">(L'idée de base est d'utiliser un tableau de mémoire partagée de la même taille que le nombre de threads dans le groupe de travail, ainsi que</font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-11-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>log</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mn>2</mn></mrow></msub><mo>&amp;#x2061;</mo><mo stretchy=&quot;false&quot;>(</mo><mi>n</mi><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="7.23ex" height="2.634ex" viewBox="0 -809.3 3112.9 1134.2" role="img" focusable="false" style="vertical-align: -0.755ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAIN-6C"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAIN-6F" x="278" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAIN-67" x="779" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAIN-32" x="1809" y="-343"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAIN-28" x="1733" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMATHI-6E" x="2122" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhjTzdkkJ6auC0rLl0vaXTnGWX-YqA#MJMAIN-29" x="2723" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>log</mi><mrow class="MJX-TeXAtom-ORD"><mn>2</mn></mrow></msub><mo>⁡</mo><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-11">\log_{2} (n)</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> passe pour le calcul conjoint séquentiel des</font></font><code>min</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">creux de chaque fil jusqu'à ce que le minimum final de tout le groupe de travail soit obtenu.)</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai essayé cette solution avec toutes les mêmes tailles de groupe de travail que dans la solution c</font></font><code>atomicMin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Même avec toutes les optimisations décrites dans la présentation NVIDIA, la solution de réduction parallèle est légèrement plus lente (dans les dix GPU sur les deux GPU) que la solution à laquelle</font></font><code>atomicMin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">je suis arrivé. </font><font style="vertical-align: inherit;">De plus, la solution avec est</font></font><code>atomicMin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">beaucoup plus simple en termes de code.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exemple de code</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Avec cette méthode, le moyen le plus simple est de ne pas essayer de maintenir la correspondance dans l'espace normalisé des coordonnées de texture entre les texels de tampons réduits et la pleine résolution. </font><font style="vertical-align: inherit;">Vous pouvez simplement effectuer des conversions de coordonnées texel de pleine résolution en coordonnées texel de résolution réduite:</font></font><br>
<br>
<pre><code class="cpp hljs">ivec2 reducedResTexelCoords = texelCoords / ivec2(downscalingFactor);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans mon cas (générer l'équivalent de mip-niveau 4) </font></font><code>downscalingFactor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">est 16. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme mentionné ci-dessus, ce shader de calcul GLSL implémente une solution avec </font></font><code>atomicMin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">des tailles de groupe de travail 4x4, où chaque thread reçoit une zone de texel 4x4 du tampon pleine résolution. </font><font style="vertical-align: inherit;">Le tampon de profondeur de valeur réduite résultant </font></font><code>min</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">est 1/16 x 1/16 de la taille du tampon pleine résolution (arrondi lorsque les tailles pleine résolution ne sont pas divisibles par 16 complètement).</font></font><br>
<br>
<pre><code class="cpp hljs">uniform sampler2D u_inputDepthBuffer;<font></font>
uniform <span class="hljs-keyword">restrict</span> writeonly image2DArray u_outputDownsampledMinDepthBufferImage;
<span class="hljs-comment">// The dimension in normalized texture coordinate space of a single texel in </span>
<span class="hljs-comment">// u_inputDepthBuffer. </span><font></font>
uniform vec2 u_texelDimensions;<font></font>
<font></font>
<span class="hljs-comment">// Resulting image is 1/16th x 1/16th resolution, but we fetch 4x4 texels per thread, hence </span>
<span class="hljs-comment">// the divisions by 4 here. </span>
layout(local_size_x = <span class="hljs-number">16</span>/<span class="hljs-number">4</span>, local_size_y = <span class="hljs-number">16</span>/<span class="hljs-number">4</span>, local_size_z = <span class="hljs-number">1</span>) in;<font></font>
<font></font>
<span class="hljs-comment">// This is stored as uint because atomicMin only works on integer types. Luckily </span>
<span class="hljs-comment">// (non-negative) floats maintain their order when their bits are interpreted as uint (using </span>
<span class="hljs-comment">// floatBitsToUint). </span><font></font>
shared uint s_workgroupMinDepthEncodedAsUint;<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
	<span class="hljs-keyword">if</span> (gl_LocalInvocationIndex == <span class="hljs-number">0</span>) {
        <span class="hljs-comment">// Initialize to 1.0 (max depth) before performing atomicMin's. </span>
		s_workgroupMinDepthEncodedAsUint = floatBitsToUint(<span class="hljs-number">1.0</span>);<font></font>
	}<font></font>
<font></font>
	memoryBarrierShared();<font></font>
	barrier();<font></font>
<font></font>
	<span class="hljs-comment">// Fetch a 4x4 texel region per thread with 4 calls to textureGather. 'gatherCoords' </span>
    <span class="hljs-comment">// are set up to be equidistant from the centers of the 4 texels being gathered (which </span>
    <span class="hljs-comment">// puts them on integer values). In my tests textureGather was not faster than </span>
    <span class="hljs-comment">// individually fetching each texel - I use it here only for conciseness. </span>
    <span class="hljs-comment">// </span>
    <span class="hljs-comment">// Note that in the case of the full-res depth buffer's dimensions not being evenly </span>
    <span class="hljs-comment">// divisible by the downscaling factor (16), these textureGather's may try to fetch </span>
    <span class="hljs-comment">// out-of-bounds coordinates - that's fine as long as the texture sampler is set to </span>
    <span class="hljs-comment">// clamp-to-edge, as redundant values don't affect the resulting min. </span><font></font>
<font></font>
	uvec2 baseTexelCoords = <span class="hljs-number">4</span> * gl_GlobalInvocationID.xy;<font></font>
	vec2 gatherCoords1 = (baseTexelCoords + uvec2(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>)) * u_texelDimensions;<font></font>
	vec2 gatherCoords2 = (baseTexelCoords + uvec2(<span class="hljs-number">3</span>, <span class="hljs-number">1</span>)) * u_texelDimensions;<font></font>
	vec2 gatherCoords3 = (baseTexelCoords + uvec2(<span class="hljs-number">1</span>, <span class="hljs-number">3</span>)) * u_texelDimensions;<font></font>
	vec2 gatherCoords4 = (baseTexelCoords + uvec2(<span class="hljs-number">3</span>, <span class="hljs-number">3</span>)) * u_texelDimensions;<font></font>
<font></font>
	vec4 gatheredTexelValues1 = textureGather(u_inputDepthBuffer, gatherCoords1);<font></font>
	vec4 gatheredTexelValues2 = textureGather(u_inputDepthBuffer, gatherCoords2);<font></font>
	vec4 gatheredTexelValues3 = textureGather(u_inputDepthBuffer, gatherCoords3);<font></font>
	vec4 gatheredTexelValues4 = textureGather(u_inputDepthBuffer, gatherCoords4);<font></font>
<font></font>
	<span class="hljs-comment">// Now find the min across the 4x4 region fetched, and apply that to the workgroup min </span>
    <span class="hljs-comment">// using atomicMin. </span><font></font>
	vec4 gatheredTexelMins = min(min(gatheredTexelValues1, gatheredTexelValues2),<font></font>
                                 min(gatheredTexelValues3, gatheredTexelValues4));<font></font>
	<span class="hljs-keyword">float</span> finalMin = min(min(gatheredTexelMins.x, gatheredTexelMins.y),<font></font>
                         min(gatheredTexelMins.z, gatheredTexelMins.w));<font></font>
	atomicMin(s_workgroupMinDepthEncodedAsUint, floatBitsToUint(finalMin));<font></font>
<font></font>
	memoryBarrierShared();<font></font>
	barrier();<font></font>
<font></font>
    <span class="hljs-comment">// Thread 0 writes workgroup-wide min to image. </span>
	<span class="hljs-keyword">if</span> (gl_LocalInvocationIndex == <span class="hljs-number">0</span>) {
		<span class="hljs-keyword">float</span> workgroupMinDepth = uintBitsToFloat(s_workgroupMinDepthEncodedAsUint);<font></font>
<font></font>
		imageStore(u_outputDownsampledMinDepthBufferImage,<font></font>
		           ivec2(gl_WorkGroupID.xy),<font></font>
                   <span class="hljs-comment">// imageStore can only be passed vec4, but only a float is stored. </span><font></font>
				   vec4(workgroupMinDepth));<font></font>
	}<font></font>
}</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Performance</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai utilisé le nuanceur de calcul ci-dessus pour traiter le tampon de profondeur pleine résolution avec les mêmes dimensions que celles utilisées pour générer la chaîne de mip complète (tampons 1648x1776 pour chaque œil). </font><font style="vertical-align: inherit;">Il s'exécute en 0,12 ms sur le NVIDIA GTX 980 et 0,08 ms sur l'AMD R9 290. Si nous comparons avec le temps de génération des niveaux de mip uniquement 1 à 4 (0,22 ms sur NVIDIA, 0,25 ms AMD), alors La solution avec un shader de calcul s'est avérée </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">87% plus rapide avec les GPU NVIDIA</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">197% plus rapide que les GPU AMD</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En termes absolus, l'accélération n'est pas si grande, mais toutes les 0,1 ms sont importantes, surtout en VR :)</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr494364/index.html">GDPR: Consentement au traitement des données personnelles</a></li>
<li><a href="../fr494366/index.html">Mitaps en ligne pour toute la semaine, à partir du 27 mars (pour le dos, mobile, QA, PM et tout)</a></li>
<li><a href="../fr494370/index.html">Une architecture propre vue par un développeur Python</a></li>
<li><a href="../fr494372/index.html">Logiciel de vérification panrusse - une vue intérieure</a></li>
<li><a href="../fr494374/index.html">Bus électriques et leurs batteries: qu'est-ce que le titanate de lithium? (Partie 1)</a></li>
<li><a href="../fr494380/index.html">Introduction à la gestion stratégique des produits</a></li>
<li><a href="../fr494384/index.html">Enquête fonctionnelle</a></li>
<li><a href="../fr494390/index.html">L'impression 3D réduit de moitié les coûts de réglage automatique</a></li>
<li><a href="../fr494398/index.html">Playstation Doom Polygons</a></li>
<li><a href="../fr494400/index.html">Coronavirus et Internet</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>