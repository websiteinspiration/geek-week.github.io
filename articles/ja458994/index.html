<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏽‍🎨 🧜🏾 😿 Raspberry Pi + CentOS = Wi-Fi Hotspot（またはRed HatのRaspberry Router） 🍥 👩🏻‍🚀 🚖</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="UPD 03/14/2020：
 Raspberry Pi + Fedora（aarch64）= Wi-Fi Hotspot（または青い帽子のraspberry-blueルーター）
 
 シングルボードのRaspberry PCをベースにしたWi-Fiアクセスポイントの作成については、インターネット...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Raspberry Pi + CentOS = Wi-Fi Hotspot（またはRed HatのRaspberry Router）</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/458994/"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UPD</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 03/14/2020：</font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Raspberry Pi + Fedora（aarch64）= Wi-Fi Hotspot（または青い帽子のraspberry-blueルーター）</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
シングルボードのRaspberry PCをベースにしたWi-Fiアクセスポイントの作成については、インターネット上に膨大な情報があります。原則として、Raspberry-Raspbianのネイティブオペレーティングシステムの使用を意味します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
RPMベースのシステムを愛用している私は、この小さな奇跡を乗り越えて、お気に入りのCentOSを試すことができませんでした。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この記事では、CentOSオペレーティングシステムに基づいて、Raspberry Pi 3モデルB +から5GHz / AC Wi-Fiルーターを製造する方法について説明します。いくつかの標準的ですがあまり知られていないトリックがあり、おまけとして、追加のWi-Fi機器「ラズベリー」に接続して、複数のモード（2.4 + 5GHz）で同時に動作できるようにする図があります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/mp/yb/fz/mpybfz6gzojqkaftnuljhpzx5da.png" alt="画像"><br>
<sub><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（無料アクセスの画像の組み合わせ）</font></font></i></sub><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一部の宇宙速度は機能しないことにすぐに注意します。</font><font style="vertical-align: inherit;">私は無線で「ラズベリー」から最大100 Mbitを搾り取り、これは私のインターネットプロバイダーの速度をカバーしています。</font><font style="vertical-align: inherit;">理論上、Nでさえ、半分のギガバイトを取得できるのに、なぜこのような緩慢なACが必要なのでしょうか。</font><font style="vertical-align: inherit;">この質問をした場合は、店に行って、8つの外部アンテナを備えた実際のルーターを探してください。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.必要なもの</font></font></h1><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">実際には、口径自体の「ラズベリー製品」：Pi 3モデルB +（切望された5GHzの速度とチャネルを実現するため）。</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">固体microSD&gt; = 4GB;</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">microSDリーダー/ライターを備えたLinuxワークステーション。</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Linuxにおける十分なスキルの存在、記事は準備されたオタクのためのものです。</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RaspberryとLinux間の有線ネットワーク（eth0）接続、ローカルネットワーク上で動作するDHCPサーバー、および両方のデバイスからのインターネットアクセス。</font></font><br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最後のポイントについての短いコメント。</font><font style="vertical-align: inherit;">「何が最初に来たのか、卵か...」インターネットアクセス機器がない場合にWi-Fiルーターを作成する方法は？</font><font style="vertical-align: inherit;">この面白い演習は記事の範囲外にして、Raspberryが有線でローカルネットワークに接続され、インターネットにアクセスできると仮定します。</font><font style="vertical-align: inherit;">この場合、ラズベリーをセットアップするための追加のテレビとマニピュレータは必要ありません。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. CentOSをインストールする</font></font></h1><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロジェクトのホームページ</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
この記事の執筆時点では、デバイスで動作するCentOSのバージョンは32ビットです。</font><font style="vertical-align: inherit;">ワールドワイドウェブの広大などこかで、64ビットARMアーキテクチャ上でのそのようなOSのパフォーマンスの低下は20％程度であるという意見に出くわしました。</font><font style="vertical-align: inherit;">この点はコメントせずにおきます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Linuxでは、「- </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RaspberryPI-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">」</font><font style="vertical-align: inherit;">カーネル</font><font style="vertical-align: inherit;">を</font><b><font style="vertical-align: inherit;">使用</font></b><font style="vertical-align: inherit;">して最小限のイメージをダウンロードし、</font><font style="vertical-align: inherit;">microSDに書き込み</font><font style="vertical-align: inherit;">ます</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="plaintext hljs"># xzcat CentOS-Userland-7-armv7hl-RaspberryPI-Minimal-1810-sda.raw.xz | \<font></font>
  dd of=/dev/mmcblk0 bs=4M<font></font>
# sync<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
イメージを使用する前に、イメージからSWAPパーティションを削除し、ルートを利用可能なボリューム全体に拡張して、SELinuxを削除します。</font><font style="vertical-align: inherit;">アルゴリズムは単純です。Linuxでルートのコピーを作成し、最初の（/ブート）以外のすべてのパーティションをmicroSDから削除し、新しいルートを作成して、その内容をコピーから返します。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必要なアクションの例（重大なコンソール出力）</font></font></b><div class="spoiler_text"><pre><code class="plaintext hljs"># mount /dev/mmcblk0p3 /mnt<font></font>
# cd /mnt<font></font>
# tar cfz ~/pi.tgz . --no-selinux<font></font>
# cd<font></font>
# umount /mnt<font></font>
</code></pre><br>
<pre><code class="plaintext hljs"># parted /dev/mmcblk0<font></font>
<font></font>
(parted) unit s<font></font>
(parted) print free<font></font>
Model: SD SC16G (sd/mmc)<font></font>
Disk /dev/mmcblk0: 31116288s<font></font>
Sector size (logical/physical): 512B/512B<font></font>
Partition Table: msdos<font></font>
Disk Flags:<font></font>
<font></font>
Number  Start     End        Size       Type     File system     Flags<font></font>
        63s       2047s      1985s               Free Space<font></font>
 1      2048s     1370111s   1368064s   primary  fat32           boot, lba<font></font>
 2      1370112s  2369535s   999424s    primary  linux-swap(v1)<font></font>
 3      2369536s  5298175s   2928640s   primary  ext4<font></font>
        5298176s  31116287s  25818112s           Free Space<font></font>
<font></font>
(parted) rm 3<font></font>
(parted) rm 2<font></font>
<font></font>
(parted) print free<font></font>
Model: SD SC16G (sd/mmc)<font></font>
Disk /dev/mmcblk0: 31116288s<font></font>
Sector size (logical/physical): 512B/512B<font></font>
Partition Table: msdos<font></font>
Disk Flags:<font></font>
<font></font>
Number  Start     End        Size       Type     File system  Flags<font></font>
        63s       2047s      1985s               Free Space<font></font>
 1      2048s     1370111s   1368064s   primary  fat32        boot, lba<font></font>
        1370112s  31116287s  29746176s           Free Space<font></font>
<font></font>
(parted) mkpart<font></font>
Partition type?  primary/extended? primary<font></font>
File system type?  [ext2]? ext4<font></font>
Start? 1370112s<font></font>
End? 31116287s<font></font>
<font></font>
(parted) set<font></font>
Partition number? 2<font></font>
Flag to Invert? lba<font></font>
New state?  on/[off]? off<font></font>
<font></font>
(parted) print free<font></font>
Model: SD SC16G (sd/mmc)<font></font>
Disk /dev/mmcblk0: 31116288s<font></font>
Sector size (logical/physical): 512B/512B<font></font>
Partition Table: msdos<font></font>
Disk Flags:<font></font>
<font></font>
Number  Start     End        Size       Type     File system  Flags<font></font>
        63s       2047s      1985s               Free Space<font></font>
 1      2048s     1370111s   1368064s   primary  fat32        boot, lba<font></font>
 2      1370112s  31116287s  29746176s  primary  ext4<font></font>
<font></font>
(parted) quit<font></font>
</code></pre><br>
<pre><code class="plaintext hljs"># mkfs.ext4 /dev/mmcblk0p2 <font></font>
mke2fs 1.44.6 (5-Mar-2019)<font></font>
/dev/mmcblk0p2 contains a swap file system labelled '_swap'<font></font>
Proceed anyway? (y,N) y<font></font>
Discarding device blocks: done                            <font></font>
Creating filesystem with 3718272 4k blocks and 930240 inodes<font></font>
Filesystem UUID: 6a1a0694-8196-4724-a58d-edde1f189b31<font></font>
Superblock backups stored on blocks: <font></font>
	32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208<font></font>
<font></font>
Allocating group tables: done                            <font></font>
Writing inode tables: done                            <font></font>
Creating journal (16384 blocks): done<font></font>
Writing superblocks and filesystem accounting information: done   <font></font>
<font></font>
# mount /dev/mmcblk0p2 /mnt<font></font>
# tar xfz ~/pi.tgz -C /mnt --no-selinux<font></font>
</code></pre><br>
           .<br>
<br>
 SELinux  <b>/mnt/etc/selinux/config</b>:<br>
<br>
<pre><code class="plaintext hljs">SELINUX=disabled
</code></pre><br>
 <b>/mnt/etc/fstab</b>,        :  (/boot,  )   (  UUID,   ,    blkid  Linux-):<br>
<br>
<pre><code class="plaintext hljs">UUID=6a1a0694-8196-4724-a58d-edde1f189b31  /     ext4    defaults,noatime 0 0<font></font>
UUID=6938-F4F2                             /boot vfat    defaults,noatime 0 0<font></font>
</code></pre><br>
,    :     ,      ()    IPv6    :<br>
<br>
<pre><code class="plaintext hljs"># cd<font></font>
# umount /mnt<font></font>
# mount /dev/mmcblk0p1 /mnt<font></font>
</code></pre><br>
  <b>/mnt/cmdline.txt</b>    (   ):<br>
<br>
<pre><code class="plaintext hljs">root=/dev/mmcblk0p2 rootfstype=ext4 elevator=deadline rootwait quiet ipv6.disable_ipv6=1
</code></pre><br>
:<br>
<br>
<pre><code class="plaintext hljs"># cd<font></font>
# umount /mnt<font></font>
# sync<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
「Malinka」でmicroSDを再配置し、実行して、ssh（root / centos）経由でネットワークにアクセスします。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. CentOSの構成</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初の3つの揺るぎない動き：</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">passwd</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">yum -y update</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">reboot</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><b><font style="vertical-align: inherit;">networkdに</font></b></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ネットワーク管理を提供します</font><font style="vertical-align: inherit;">。</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="plaintext hljs"># yum install systemd-networkd<font></font>
# systemctl enable systemd-networkd<font></font>
# systemctl disable NetworkManager<font></font>
# chkconfig network off<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ファイルとディレクトリを作成します</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/systemd/network/eth0.network</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="plaintext hljs">[Match]<font></font>
Name=eth0<font></font>
<font></font>
[Network]<font></font>
DHCP=ipv4<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
「ラズベリー」を再起動すると、再びsshを介してネットワークにアクセスできます（IPアドレスは変更可能です）。</font><font style="vertical-align: inherit;">以前にNetwork Managerによって作成された</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/resolv.conf</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が使用される</font><font style="vertical-align: inherit;">ことに注意してください</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">したがって、解決に問題がある場合は、その内容を編集してください。</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systemd-resolved</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は</font><font style="vertical-align: inherit;">使用</font><b><font style="vertical-align: inherit;">し</font></b><font style="vertical-align: inherit;">ません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
「余分な」を削除し、OSのロードを修復および高速化します。</font></font><br>
<br>
<pre><code class="plaintext hljs"># systemctl set-default multi-user.target<font></font>
# yum remove GeoIP Network* aic* alsa* cloud-utils-growpart \<font></font>
  cronie* dhc* firewal* initscripts iwl* kexec* logrotate \<font></font>
  postfix rsyslog selinux-pol* teamd wpa_supplicant<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
誰が</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cron</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を必要</font><font style="vertical-align: inherit;">としていて、</font><font style="vertical-align: inherit;">誰が</font><font style="vertical-align: inherit;">組み込みの</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systemdタイマーを</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">消化しなくても</font><font style="vertical-align: inherit;">、不足しているものをインストールでき</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">ます</font></a><font style="vertical-align: inherit;">。</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ var / </font></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">log-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">そして、</font><b><font style="vertical-align: inherit;">journalctl</font></b><font style="vertical-align: inherit;">を</font><b><font style="vertical-align: inherit;">調べ</font></b><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">ログ履歴が必要な場合（デフォルトでは、情報はシステムの起動時からのみ保存されます）：</font></font><br>
<br>
<pre><code class="plaintext hljs"># mkdir /var/log/journal<font></font>
# systemd-tmpfiles --create --prefix /var/log/journal<font></font>
# systemctl restart systemd-journald<font></font>
# vi /etc/systemd/journald.conf<font></font>
</code></pre><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コアサービスによるIPv6の使用を無効にする（必要な場合）</font></font></b><div class="spoiler_text"><b>/etc/ssh/sshd_config</b>:<br>
<br>
<pre><code class="plaintext hljs">AddressFamily inet
</code></pre><br>
<b>/etc/sysconfig/chronyd</b>:<br>
<pre><code class="plaintext hljs">OPTIONS="-4"
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
「ラズベリー」の時間の関連性は重要なことです。</font><font style="vertical-align: inherit;">「すぐに使える」ので、再起動時に時計の現在の状態を保存するハードウェア機能がないため、同期が必要です。</font><font style="vertical-align: inherit;">このための非常に優れた高速デーモン</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-chrony-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">がすでにインストールされており、自動的に起動します。</font><font style="vertical-align: inherit;">NTPサーバーを次のサーバーに変更できます。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/chrony.conf</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="plaintext hljs">server 0.ru.pool.ntp.org iburst<font></font>
server 1.ru.pool.ntp.org iburst<font></font>
server 2.ru.pool.ntp.org iburst<font></font>
server 3.ru.pool.ntp.org iburst<font></font>
</code></pre><br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">トリック</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
を使用してタイムゾーンを設定します</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">私たちの目標は5GHz周波数で動作するWi-Fiルーターを作成することなので、事前に</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">レギュレーターの</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">驚きに備え</font><font style="vertical-align: inherit;">ます。</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">＃yum info crda </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
要約：802.11ワイヤレスネットワークの規制準拠デーモン</font></font><br>
</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この悪意のある設計は、とりわけタイムゾーンに重点を置いており、5 GHzの周波数と「大きな」番号のチャネルの使用（ロシアで）を「禁止」します。</font><font style="vertical-align: inherit;">トリックは、本土/都市の名前を使用せずに、つまり次の代わりにタイムゾーンを設定することです：</font></font><br>
<br>
<pre><code class="plaintext hljs"># timedatectl set-timezone Europe/Moscow
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プレス：</font></font><br>
<br>
<pre><code class="plaintext hljs"># timedatectl set-timezone Etc/GMT-3
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、システムのヘアスタイルの最後の仕上げ：</font></font><br>
<br>
<pre><code class="plaintext hljs"># hostnamectl set-hostname router
</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/root/.bash_profile</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="plaintext hljs">. . .<font></font>
<font></font>
# User specific environment and startup programs<font></font>
<font></font>
export PROMPT_COMMAND="echo -n $(($(&lt;/sys/class/thermal/thermal_zone0/temp) / 1000))\'C\ "<font></font>
export LANG=en_US.UTF-8<font></font>
export PATH=$PATH:$HOME/bin<font></font>
</code></pre><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. CentOSアドオン</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
上記のすべては、Raspberry Piに「バニラ」CentOSをインストールするための完全な手順と見なすことができます。</font><font style="vertical-align: inherit;">10秒未満で（再）起動し、15メガバイト未満のRAMと1.5ギガバイトのmicroSDを使用するPCを取得する必要があります（実際には、不完全な/ブートのために1ギガバイト未満ですが、最後まで正直になります）：</font></font><br>
<img src="https://habrastorage.org/webt/mu/0g/cf/mu0gcfyiokq0x_2dysrb1ieh0ke.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/xx/l3/_g/xxl3_gukovfw0zawwvvy8ua0dtw.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/wt/yc/-9/wtyc-9erdcdx-rvqnnjite7c9ru.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
インストールするにはこのシステムのWi-Fiアクセスポイントは、標準のCentOSディストリビューションの機能を少し拡張する必要があります。</font><font style="vertical-align: inherit;">まず、内蔵Wi-Fiアダプターのドライバー（ファームウェア）を「ポンプ」します。</font><font style="vertical-align: inherit;">プロジェクトのホームページは言う：</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Raspberry 3Bおよび3B + </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
の</font><font style="vertical-align: inherit;">Wifi + </font><font style="vertical-align: inherit;">Raspberry PI 3B / 3B +ファームウェアファイルは、CentOSプロジェクトによって配布することはできません。</font><font style="vertical-align: inherit;">次の記事を使用して問題を理解し、ファームウェアを入手してWi-Fiをセットアップできます。</font></font><br>
</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CentOSプロジェクトでできないことは、個人的な使用を禁じられていません。</font><font style="vertical-align: inherit;">CentOSのディストリビューションWi-Fiファームウェアを、Broadcom開発者の対応するファームウェア（同じ嫌いなバイナリBLOBなど）に置き換えます。</font><font style="vertical-align: inherit;">これにより、特に、ACをアクセスポイントモードで使用できるようになります。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wi-Fiファームウェアのアップグレード</font></font></b><div class="spoiler_text">      :<br>
<br>
<pre><code class="plaintext hljs"># journalctl | grep $(basename $(readlink /sys/class/net/wlan0/device/driver))<font></font>
Jan 01 04:00:03 router kernel: brcmfmac: F1 signature read @0x18000000=0x15264345<font></font>
Jan 01 04:00:03 router kernel: brcmfmac: brcmf_fw_map_chip_to_name: using brcm/brcmfmac43455-sdio.bin for chip 0x004345(17221) rev 0x000006<font></font>
Jan 01 04:00:03 router kernel: usbcore: registered new interface driver brcmfmac<font></font>
Jan 01 04:00:03 router kernel: brcmfmac: brcmf_c_preinit_dcmds: Firmware version = wl0: Mar  1 2015 07:29:38 version 7.45.18 (r538002) FWID 01-6a2c8ad4<font></font>
Jan 01 04:00:03 router kernel: brcmfmac: brcmf_c_preinit_dcmds: CLM version = API: 12.2 Data: 7.14.8 Compiler: 1.24.9 ClmImport: 1.24.9 Creation: 2014-09-02 03:05:33 Inc Data: 7.17.1 Inc Compiler: 1.26.11 Inc ClmImport: 1.26.11 Creation: 2015-03-01 07:22:34 <font></font>
</code></pre><br>
,    7.45.18  01.03.2015,     : <b>43455</b> (brcmfmac43455-sdio.bin).<br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">   Raspbian</a>.      microSD      .        Linux    :<br>
<br>
<pre><code class="plaintext hljs"># wget https://downloads.raspberrypi.org/raspbian_lite_latest<font></font>
# unzip -p raspbian_lite_latest &gt; raspbian.img<font></font>
# fdisk -l raspbian.img<font></font>
Disk raspbian.img: 2 GiB, 2197815296 bytes, 4292608 sectors<font></font>
Units: sectors of 1 * 512 = 512 bytes<font></font>
Sector size (logical/physical): 512 bytes / 512 bytes<font></font>
I/O size (minimum/optimal): 512 bytes / 512 bytes<font></font>
Disklabel type: dos<font></font>
Disk identifier: 0x17869b7d<font></font>
<font></font>
Device        Boot  Start     End Sectors  Size Id Type<font></font>
raspbian.img1        8192  532480  524289  256M  c W95 FAT32 (LBA)<font></font>
raspbian.img2      540672 4292607 3751936  1.8G 83 Linux<font></font>
<font></font>
# mount -t ext4 -o loop,offset=$((540672 * 512)) raspbian.img /mnt<font></font>
# cp -fv /mnt/lib/firmware/brcm/*43455* ...<font></font>
'/mnt/lib/firmware/brcm/brcmfmac43455-sdio.bin' -&gt; ...<font></font>
'/mnt/lib/firmware/brcm/brcmfmac43455-sdio.clm_blob' -&gt; ...<font></font>
'/mnt/lib/firmware/brcm/brcmfmac43455-sdio.txt' -&gt; ...<font></font>
# umount /mnt<font></font>
</code></pre><br>
   Wi-Fi       «»   <b>/usr/lib/firmware/brcm/</b><br>
<br>
     :<br>
<br>
<pre><code class="plaintext hljs"># journalctl | grep $(basename $(readlink /sys/class/net/wlan0/device/driver))<font></font>
Jan 01 04:00:03 router kernel: brcmfmac: F1 signature read @0x18000000=0x15264345<font></font>
Jan 01 04:00:03 router kernel: brcmfmac: brcmf_fw_map_chip_to_name: using brcm/brcmfmac43455-sdio.bin for chip 0x004345(17221) rev 0x000006<font></font>
Jan 01 04:00:03 router kernel: usbcore: registered new interface driver brcmfmac<font></font>
Jan 01 04:00:03 router kernel: brcmfmac: brcmf_c_preinit_dcmds: Firmware version = wl0: Feb 27 2018 03:15:32 version 7.45.154 (r684107 CY) FWID 01-4fbe0b04<font></font>
Jan 01 04:00:03 router kernel: brcmfmac: brcmf_c_preinit_dcmds: CLM version = API: 12.2 Data: 9.10.105 Compiler: 1.29.4 ClmImport: 1.36.3 Creation: 2018-03-09 18:56:28 <font></font>
</code></pre><br>
: 7.45.154  27.02.2018.<br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そしてもちろんEPEL：</font></font><br>
<br>
<pre><code class="plaintext hljs"># cat &gt; /etc/yum.repos.d/epel.repo &lt;&lt; EOF<font></font>
[epel]<font></font>
name=Epel rebuild for armhfp<font></font>
baseurl=https://armv7.dev.centos.org/repodir/epel-pass-1/<font></font>
enabled=1<font></font>
gpgcheck=0<font></font>
EOF<font></font>
<font></font>
# yum clean all<font></font>
# rm -rfv /var/cache/yum<font></font>
# yum update<font></font>
</code></pre><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.ネットワーク構成と今後の課題</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
上記で合意したように、「Malinka」は「ワイヤー」によってローカルネットワークに接続されています。プロバイダーがまったく同じ方法でインターネットアクセスを提供するとします。パブリックネットワーク上のアドレスは、DHCPサーバーによって動的に発行されます（MACにリンクできます）。この場合、「ラズベリー」の最終セットアップ後、プロバイダーケーブルを「プラグイン」するだけで十分で、すべての準備が整います。</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systemd-networkd</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を使用</font><b><font style="vertical-align: inherit;">した</font></b><font style="vertical-align: inherit;">承認</font><font style="vertical-align: inherit;">は別の記事のトピックであり、ここでは考慮しません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
RaspberryのWi-Fiインターフェイスはローカルネットワークであり、組み込みのイーサネットアダプター（eth0）は外部にあります。ローカルネットワークには静的に番号を付けます（例：192.168.0.0/24）。 Malinkaのアドレス：192.168.0.1。外部ネットワーク（インターネット）はDHCPサーバーを操作します。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">均一な命名の問題</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有名なグアテマラのプログラマー</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -systemdディストリビューションでネットワークインターフェースとサービスの設定に関わるすべての人を待つ2つのトラブル。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">並列カオス（叙情的な余談）</font></font></b><div class="spoiler_text">     <b>systemd</b>  .  <b>systemd</b>     ,  ,      <strike></strike> ,            .<br>
<br>
   ,        systemd-   « »    LSB-.  ,     « »  ,     .<br>
</div></div><br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lan</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wanという</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
定数名の2つの仮想ブリッジインターフェイスを作成します</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">最初にWi-Fiアダプターを「接続」し、2番目に「ラズベリー」のeth0を接続します。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/systemd/network/lan.netdev</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="plaintext hljs">[NetDev]<font></font>
Name=lan<font></font>
Kind=bridge<font></font>
</code></pre> <br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/systemd/network/lan.network</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="plaintext hljs">[Match]<font></font>
Name=lan<font></font>
<font></font>
[Network]<font></font>
Address=192.168.0.1/24<font></font>
IPForward=yes<font></font>
</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/systemd/network/wan.netdev</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="plaintext hljs">[NetDev]<font></font>
Name=wan<font></font>
Kind=bridge<font></font>
#MACAddress=xx:xx:xx:xx:xx:xx<font></font>
</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/systemd/network/wan.network</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="plaintext hljs">[Match]<font></font>
Name=wan<font></font>
<font></font>
[Network]<font></font>
DHCP=ipv4<font></font>
IPForward=yes<font></font>
</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IPForward = yes</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の場合、sysctlを介したルーティングを有効にするためにカーネルにヒントを与える必要がなくなります。</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MACAddress =</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コメントを</font><b><font style="vertical-align: inherit;">外し</font></b><font style="vertical-align: inherit;">、必要に応じて変更します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まず、eth0を接続します。</font><font style="vertical-align: inherit;">「均一性の問題」を覚えて、このインターフェースのMACアドレスのみを使用してください。たとえば、次のようにして確認できます。</font></font><br>
<br>
<pre><code class="plaintext hljs"># cat /sys/class/net/eth0/address 
</code></pre> <br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/systemd/network/eth.networkを</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
作成します</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="plaintext hljs">[Match]<font></font>
MACAddress=b8:27:eb:xx:xx:xx<font></font>
<font></font>
[Network]<font></font>
Bridge=wan<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以前のeth0構成ファイルを削除し、「raspberry」を再起動して、ネットワークアクセスを取得します（IPアドレスはおそらく変更されます）。</font></font><br>
<br>
<pre><code class="plaintext hljs"># rm -fv /etc/systemd/network/eth0.network<font></font>
# reboot<font></font>
</code></pre> <br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5. DNSMASQ</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wi-Fiアクセスポイントの製造については、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dnsmasq</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> + </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hostapdの</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スイートカップルに勝るもの</font><font style="vertical-align: inherit;">はまだありません。</font><font style="vertical-align: inherit;">私の考えでは。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">誰もが忘れたら...</font></font></b><div class="spoiler_text"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">hostapd</a> —  ,   Wi-Fi  ( ,          <b>lan</b> «»),     .<br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">dnsmasq</a> —    :  IP-, DNS-,       .<br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
dnsmasqから始めます。</font></font><br>
<br>
<pre><code class="plaintext hljs"># yum install dnsmasq
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
テンプレート</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/resolv.conf</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="plaintext hljs">nameserver 1.1.1.1<font></font>
nameserver 1.0.0.1<font></font>
nameserver 8.8.8.8<font></font>
nameserver 8.8.4.4<font></font>
nameserver 77.88.8.8<font></font>
nameserver 77.88.8.1<font></font>
domain router.local<font></font>
search router.local<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
お好みに合わせて編集してください。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最小限の</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/dnsmasq.conf</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="plaintext hljs">domain-needed<font></font>
bogus-priv<font></font>
interface=lan<font></font>
bind-dynamic<font></font>
expand-hosts<font></font>
domain=#<font></font>
dhcp-range=192.168.0.100,192.168.0.199,255.255.255.0,24h<font></font>
conf-dir=/etc/dnsmasq.d<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここでの「魔法」は</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bind-dynamic</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パラメータです</font><font style="vertical-align: inherit;">。これは、dnsmasqデーモンに、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">interface = lanが</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">システム</font><b><font style="vertical-align: inherit;">に</font></b><font style="vertical-align: inherit;">表示されるのを待機し</font><font style="vertical-align: inherit;">、起動後の誇りある孤独の攻撃から気絶しないように</font><font style="vertical-align: inherit;">指示します</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="plaintext hljs"># systemctl enable dnsmasq<font></font>
# systemctl start dnsmasq; journalctl -f<font></font>
</code></pre><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6. HOSTAPD</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最後に、魔法のhostapd構成。</font><font style="vertical-align: inherit;">誰かがこの記事を正確に探してこの記事を読んでいることは間違いありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
hostapdをインストールする前に、「均一性の問題」に対処する必要があります。</font><font style="vertical-align: inherit;">組み込みのwlan0 Wi-Fiアダプターは、追加のUSB Wi-Fi機器を接続するときに、名前をwlan1に簡単に変更できます。</font><font style="vertical-align: inherit;">したがって、インターフェースの名前を次のように修正します。（ワイヤレス）アダプターに一意の名前を付け、MACアドレスにバインドします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
組み込みのWi-Fiアダプターの場合、これはまだwlan0です。</font></font><br>
<br>
<pre><code class="plaintext hljs"># cat /sys/class/net/wlan0/address <font></font>
b8:27:eb:xx:xx:xx<font></font>
</code></pre><br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/systemd/network/wl0.linkを</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
作成します</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="plaintext hljs">[Match]<font></font>
MACAddress=b8:27:eb:xx:xx:xx<font></font>
<font></font>
[Link]<font></font>
Name=wl0<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これで、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wl0</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が組み込みWi-Fiで</font><font style="vertical-align: inherit;">あることを確認できます</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">これを見るために「ラズベリー」を再起動します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
インストール：</font></font><br>
<br>
<pre><code class="plaintext hljs"># yum install hostapd wireless-tools
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
設定ファイル</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/hostapd/hostapd.conf</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="plaintext hljs">ssid=rpi<font></font>
wpa_passphrase=1234567890<font></font>
<font></font>
channel=36<font></font>
<font></font>
country_code=US<font></font>
<font></font>
interface=wl0<font></font>
bridge=lan<font></font>
<font></font>
driver=nl80211<font></font>
<font></font>
auth_algs=1<font></font>
wpa=2<font></font>
wpa_key_mgmt=WPA-PSK<font></font>
rsn_pairwise=CCMP<font></font>
<font></font>
macaddr_acl=0<font></font>
<font></font>
hw_mode=a<font></font>
wmm_enabled=1<font></font>
<font></font>
# N<font></font>
ieee80211n=1<font></font>
require_ht=1<font></font>
ht_capab=[MAX-AMSDU-3839][HT40+][SHORT-GI-20][SHORT-GI-40][DSSS_CCK-40]<font></font>
<font></font>
# AC<font></font>
ieee80211ac=1<font></font>
require_vht=1<font></font>
ieee80211d=0<font></font>
ieee80211h=0<font></font>
vht_capab=[MAX-AMSDU-3839][SHORT-GI-80]<font></font>
vht_oper_chwidth=1<font></font>
vht_oper_centr_freq_seg0_idx=42<font></font>
</code></pre><br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GKChP</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
を1分間忘れずに、</font><font style="vertical-align: inherit;">必要なパラメーターを変更し、操作性を手動で確認します。</font></font><br>
<br>
<pre><code class="plaintext hljs"># hostapd /etc/hostapd/hostapd.conf
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
hostapdはインタラクティブに起動し、その状態をコンソールに変換します。</font><font style="vertical-align: inherit;">エラーがない場合、ACモードをサポートするクライアントはすでにアクセスポイントに接続されている可能性があります。</font><font style="vertical-align: inherit;">hostapdを停止するには-Ctrl-C。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
システムの起動時にhostapdが含まれています。</font><font style="vertical-align: inherit;">標準で動作している場合（systemctl enable hostapd）、次の再起動後に、「</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wl0 interface not found</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">」の診断でデーモンの「血中デーモン」を取得できます</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">「並列カオス」の結果として、hostapdはカーネルがワイヤレスアダプターを見つけるよりも早く終了しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
インターネットは麻薬でいっぱいです：デーモンが開始する前の強制タイムアウト（数分間）から、インターフェースの外観を監視し、ホストパッドを（再）開始する別のデーモンまで。</font><font style="vertical-align: inherit;">ソリューションはかなり機能していますが、ひどく醜いです。</font><font style="vertical-align: inherit;">私たち</font><font style="vertical-align: inherit;">は、「目標」と「</font><s><font style="vertical-align: inherit;">タスク</font></s><font style="vertical-align: inherit;">」、「依存関係」を</font><font style="vertical-align: inherit;">備え</font><font style="vertical-align: inherit;">た素晴らしい</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systemdの</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">助けを求めています</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">
配布サービスファイルを</font><b><font style="vertical-align: inherit;">/etc/systemd/system/hostapd.serviceに</font></b><font style="vertical-align: inherit;">コピーします</font><font style="vertical-align: inherit;">。</font></font><s><font style="vertical-align: inherit;"></font></s><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="plaintext hljs"># cp -fv /usr/lib/systemd/system/hostapd.service /etc/systemd/system
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、その内容を次の形式にします：</font></font><br>
<br>
<pre><code class="plaintext hljs">[Unit]<font></font>
Description=Hostapd IEEE 802.11 AP, IEEE 802.1X/WPA/WPA2/EAP/RADIUS Authenticator<font></font>
After=sys-subsystem-net-devices-wl0.device<font></font>
BindsTo=sys-subsystem-net-devices-wl0.device<font></font>
<font></font>
[Service]<font></font>
Type=forking<font></font>
PIDFile=/run/hostapd.pid<font></font>
ExecStart=/usr/sbin/hostapd /etc/hostapd/hostapd.conf -P /run/hostapd.pid -B<font></font>
<font></font>
[Install]<font></font>
WantedBy=sys-subsystem-net-devices-wl0.device<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
更新されたサービスファイルの魔法は、hostapdを動的に新しいターゲット-wl0インターフェイスにバインドすることです。</font><font style="vertical-align: inherit;">インターフェイスが表示されるとデーモンが起動し、表示されなくなると停止します。</font><font style="vertical-align: inherit;">そして、それはすべてオンラインです-システムを再起動することなく。</font><font style="vertical-align: inherit;">特にこの手法は、「ラズベリー」USB Wi-Fiアダプターに接続するときに役立ちます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
今することができます：</font></font><br>
<br>
<pre><code class="plaintext hljs"># systemctl enable hostapd<font></font>
# reboot<font></font>
</code></pre><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7. IPTABLES</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
「Shta ???」</font><font style="vertical-align: inherit;">©はい、はい！</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systemdは</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ありません</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">newfangledの組み合わせ（</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">firewalld</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の形式）はありません。これらは</font><font style="vertical-align: inherit;">最終的に同じことを行います。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちは古き良き</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iptables</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を使用し</font><font style="vertical-align: inherit;">ます。そのサービスは、起動後にネットワークルールをカーネルにアップロードし、常駐したりリソースを消費したりすることなく静かにシャットダウンします。</font><font style="vertical-align: inherit;">Systemdにはエレガントな</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IPMasquerade =が</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ありますが、アドレス変換（NAT）とファイアウォールにiptablesを割り当てます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
インストール：</font></font><br>
<br>
<pre><code class="plaintext hljs"># yum install iptables-services<font></font>
# systemctl enable iptables ip6tables<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私はスクリプトとしてiptables設定を保存することを好みます（例）：</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-meta">#!/bin/bash
</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># Disable IPv6</span>
<span class="hljs-comment">#</span><font></font>
ip6tables --flush<font></font>
ip6tables --delete-chain<font></font>
<font></font>
ip6tables --policy INPUT   DROP<font></font>
ip6tables --policy FORWARD DROP<font></font>
ip6tables --policy OUTPUT  DROP<font></font>
<font></font>
ip6tables-save &gt; /etc/sysconfig/ip6tables<font></font>
systemctl restart ip6tables<font></font>
<font></font>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># Cleaning</span>
<span class="hljs-comment">#</span><font></font>
iptables -F<font></font>
iptables -X<font></font>
iptables -t nat -F<font></font>
iptables -t nat -X<font></font>
iptables -t mangle -F<font></font>
iptables -t mangle -X<font></font>
iptables -P INPUT DROP<font></font>
iptables -P OUTPUT ACCEPT<font></font>
iptables -P FORWARD ACCEPT<font></font>
<font></font>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># Loopback, lan</span>
<span class="hljs-comment">#</span><font></font>
iptables -A INPUT -i lo  -j ACCEPT<font></font>
iptables -A INPUT -i lan -j ACCEPT<font></font>
<font></font>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># Ping, Established</span>
<span class="hljs-comment">#</span>
iptables -A INPUT -p icmp  --icmp-type <span class="hljs-built_in">echo</span>-request    -j ACCEPT<font></font>
iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT<font></font>
<font></font>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># NAT</span>
<span class="hljs-comment">#</span><font></font>
iptables -t nat -A POSTROUTING -o wan -j MASQUERADE<font></font>
<font></font>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># Saving</span>
<span class="hljs-comment">#</span><font></font>
iptables-save &gt; /etc/sysconfig/iptables<font></font>
systemctl restart iptables<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
上記のスクリプトを実行すると、「Malinka」との新しい有線ssh接続を確立できなくなります。</font><font style="vertical-align: inherit;">そうです、私たちはWi-Fiルーターを作成しました。デフォルトでは「インターネット経由」でのアクセスが禁止されています。現在は「無線経由」のみです。</font><font style="vertical-align: inherit;">プロバイダーのケーブルをイーサネットに接続してサーフィンを始めます！</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.ボーナス：+ 2.4 GHz</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
上記の図面から最初のラズベリールーターを組み立てたとき、私のファームで、設計上の制限のために、Wi-Fiが「ラズベリー」をまったく認識できない多数のガジェットを発見しました。 802.11b / g / nで動作するようにルーターを再構成することはスポーツマンらしいものではありませんでした。なぜなら、この場合の「無線」の最大速度は40 Mbpsを超えておらず、私のお気に入りのインターネットプロバイダーは（ケーブル経由で）100を提供しています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実際、この問題の解決策はすでに考案されています。2.4GHzで動作する2つ目のWi-Fiインターフェイスと2つ目のアクセスポイントです。最寄りの屋台で、私は最初のものではなく2番目のUSB Wi-Fiの「口笛」を購入しました。売り手は、チップセット、Linux ARMコアとの互換性、およびAPモードで動作する可能性についての質問に悩まされました（彼は最初に始めました）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
内蔵のWi-Fiアダプターと同様に、「口笛」を構成します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まず、名前を</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wl1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に変更し</font><b><font style="vertical-align: inherit;">ます</font></b><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="plaintext hljs"># cat /sys/class/net/wlan0/address <font></font>
b0:6e:bf:xx:xx:xx<font></font>
</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/systemd/network/wl1.link</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="plaintext hljs">[Match]<font></font>
MACAddress=b0:6e:bf:xx:xx:xx<font></font>
<font></font>
[Link]<font></font>
Name=wl1<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
新しいWi-Fiインターフェースの管理は別のhostapdデーモンに委託します。このデーモンは、システム内に厳密に定義された「口笛」の存在に応じて開始および停止します：wl1。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
設定ファイル</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/hostapd/hostapd2.conf</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="plaintext hljs">ssid=rpi2<font></font>
wpa_passphrase=1234567890<font></font>
<font></font>
#channel=1<font></font>
#channel=6<font></font>
channel=11<font></font>
<font></font>
interface=wl1<font></font>
bridge=lan<font></font>
<font></font>
driver=nl80211<font></font>
<font></font>
auth_algs=1<font></font>
wpa=2<font></font>
wpa_key_mgmt=WPA-PSK<font></font>
rsn_pairwise=CCMP<font></font>
<font></font>
macaddr_acl=0<font></font>
<font></font>
hw_mode=g<font></font>
wmm_enabled=1<font></font>
<font></font>
# N<font></font>
ieee80211n=1<font></font>
require_ht=1<font></font>
ht_capab=[HT40][SHORT-GI-20][SHORT-GI-40][DSSS_CCK-40]<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このファイルの内容は、USB Wi-Fiアダプターのモデルに直接依存しているため、簡単なコピー/貼り付けで気が付くことがあります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
配布サービスファイルを</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/systemd/system/hostapd2.serviceに</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コピーします</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="plaintext hljs"># cp -fv /usr/lib/systemd/system/hostapd.service /etc/systemd/system/hostapd2.service
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、その内容を次の形式にします：</font></font><br>
<br>
<pre><code class="plaintext hljs">[Unit]<font></font>
Description=Hostapd IEEE 802.11 AP, IEEE 802.1X/WPA/WPA2/EAP/RADIUS Authenticator<font></font>
After=sys-subsystem-net-devices-wl1.device<font></font>
BindsTo=sys-subsystem-net-devices-wl1.device<font></font>
<font></font>
[Service]<font></font>
Type=forking<font></font>
PIDFile=/run/hostapd2.pid<font></font>
ExecStart=/usr/sbin/hostapd /etc/hostapd/hostapd2.conf -P /run/hostapd2.pid -B<font></font>
<font></font>
[Install]<font></font>
WantedBy=sys-subsystem-net-devices-wl1.device<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
新しいhostapdインスタンスが含まれています。</font></font><br>
<br>
<pre><code class="plaintext hljs"># systemctl enable hostapd2
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それで全部です！</font><font style="vertical-align: inherit;">「ささやき」と「ラズベリー」自体を揺さぶって、周りの無線ネットワークを見てください。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最後に、USB Wi-FiアダプターとRaspberry電源の品質について警告します。</font><font style="vertical-align: inherit;">「ホットホイッスルに」接続すると、短時間の電気的トラブルが原因で「ラズベリーがハング」することがあります。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja458984/index.html">取引所で取引するための最初のアプリケーションを作成する方法：3つの初期ステップ</a></li>
<li><a href="../ja458986/index.html">PostgreSQLレシピ：HTMLおよびURLからPDFおよびPSへの変換</a></li>
<li><a href="../ja458988/index.html">テクスチャリング、またはSurfaceアーティストになるために知っておくべきこと。パート4.モデル、法線、スイープ</a></li>
<li><a href="../ja458990/index.html">コード内のコメントで熱心に停止する</a></li>
<li><a href="../ja458992/index.html">Kerasでのダミーと実装への注意</a></li>
<li><a href="../ja458996/index.html">ユーザーインターフェース-ユーザーを苦しめない方法</a></li>
<li><a href="../ja459000/index.html">Halo 2を改善しようとしたが、ほとんど台無しにされた方法</a></li>
<li><a href="../ja459002/index.html">HTTPSの構成方法-SSL構成ジェネレーターが役立ちます</a></li>
<li><a href="../ja459004/index.html">グラスホッパー暗号アルゴリズム：ほぼ複雑</a></li>
<li><a href="../ja459012/index.html">最初からBitrix24のアプリケーションを作成する</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>