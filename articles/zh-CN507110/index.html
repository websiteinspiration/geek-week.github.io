<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏾‍🤝‍👨🏻 ➡️ 🕛 如何在Linux和macOS下工作的C＃项目中发现错误 😇 👨‍🏭 🍡</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="PVS-Studio是著名的静态代码分析器，可让您发现源中隐藏的许多棘手错误。新版本的beta测试最近已经完成，可以在其中分析Linux和macOS的C＃项目。此外，分析仪现在可以与JetBrains跨平台IDE-Rider集成。本文将使您在检查开源项目RavenDB的示例上熟悉这些功能。
 
 介...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>如何在Linux和macOS下工作的C＃项目中发现错误</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/507110/"><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6a2/607/d60/6a2607d60720993d5834a2c2e83a6bb1.png" alt="图片8"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio是著名的静态代码分析器，可让您发现源中隐藏的许多棘手错误。</font><font style="vertical-align: inherit;">新版本的beta测试最近已经完成，可以在其中分析Linux和macOS的C＃项目。</font><font style="vertical-align: inherit;">此外，分析仪现在可以与JetBrains跨平台IDE-Rider集成。</font><font style="vertical-align: inherit;">本文将使您在检查开源项目RavenDB的示例上熟悉这些功能。</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
不久前，我的同事</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sergey Vasiliev</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">撰写了</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一份说明</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，说明我们正在开发的新版PVS-Studio静态分析仪的Beta版测试已经开始。</font><font style="vertical-align: inherit;">现在Beta测试已经完成，可以通过单击</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">链接</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下载新版本</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在同一篇文章中，我们将研究如何使用控制台界面和</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rider</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在Linux / macOS下分析C＃项目</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">之后，我们将对一些有趣的分析仪操作进行传统分析。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ravendb</font></font></h2><br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5ec/dca/148/5ecdca148f1673576dcd824058b19e63.png" alt="图片5"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
为了进行验证，选择了一个开放的RavenDB项目，该项目的</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储库</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">共有近</font><font style="vertical-align: inherit;">5000 </font><font style="vertical-align: inherit;">个源代码文件。</font><font style="vertical-align: inherit;">这是一个相当流行的NoSQL数据库。</font><font style="vertical-align: inherit;">详细信息可以在</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">网站</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">找到</font></a><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">很容易猜到我被它的规模所吸引，因为在如此庞大且毫无疑问的严肃项目中，可能会有一些有趣的事情。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行界面</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
首先，考虑如何通过控制台进行分析。</font><font style="vertical-align: inherit;">我认为，这一部分对于那些想要将分析仪集成到CI系统中的人来说尤其有趣。</font><font style="vertical-align: inherit;">启动分析的团队有很多有趣的选择，但是在一般情况下，一切都很琐碎。</font><font style="vertical-align: inherit;">要分析RavenDB，我转到项目文件夹，然后在控制台中输入以下内容：</font></font><br>
<br>
<pre><code class="cs hljs">pvs-studio-dotnet -t ./RavenDB.sln </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
-t标志（target的缩写）用于指定用于验证的解决方案或项目文件。</font><font style="vertical-align: inherit;">上面显示的行开始分析，并且作为工作的结果，形成了一个包含发现的错误的文件。</font><font style="vertical-align: inherit;">很简单，不是吗？</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">骑士</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在Rider中使用分析器与在Visual Studio中使用相同。</font><font style="vertical-align: inherit;">插件简单直观的界面使您只需单击几下即可检查项目。</font><font style="vertical-align: inherit;">这并不夸张-进行RavenDB分析，我只需要单击“工具”顶部菜单，指向“ PVS-Studio”，然后单击“检查当前解决方案/项目”。</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a2c/105/bd4/a2c105bd4e20693c064b6c1a4f0dc9f5.png" alt="图片2"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
分析结果将显示在PVS-Studio选项卡的窗口底部（嗯，还有哪一个？）。</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7a4/8d2/477/7a48d2477e60a0038e89c97dbd991406.png" alt="图片3"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
与Visual Studio插件一样，双击警告将显示其关联的位置。一切都方便且易于理解。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
更重要的是，PVS-Studio工具不仅可以指示错误，而且具有即使在大型旧项目中也可以轻松实施静态分析方法的基础架构。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
总体思路如下。用户启动了分析仪并收到许多警告。由于已经开发了多年的项目已经存在，可以发展并且可以带来收益，因此报告中很可能不会出现很多警告，表明存在严重缺陷。换句话说，关键错误已经以一种或另一种更昂贵的方式得到了修复，或者归功于客户的反馈。因此，分析仪现在发现的所有东西都可以视为技术债务，试图立即消除这种债务是不切实际的。现在暂时忽略这些警告是合理的，但是要编写已经执行常规分析的新代码。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
您可以告诉PVS-Studio将这些警告视为无关紧要的（将技术债务推迟到以后），然后不再显示。分析器创建一个特殊的文件，在该文件中存储有关到目前为止不重要的错误的信息。现在，PVS-Studio将仅在新的或更改的代码上发出警告。而且，所有这一切都巧妙地实现了。例如，如果将空行添加到文件的开头，则分析器将理解为实际上没有任何更改，并且将保持沉默。该标记文件可以嵌入版本控制系统中。该文件很大，但并不吓人，因为通常放置它没有任何意义。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在，所有程序员都将看到仅与新代码或更改代码有关的警告。因此，分析仪可以开始使用第二天的功能。以后可以再次归还技术债，逐步纠正错误并配置分析仪。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
要取消对Rider中现有代码的警告，只需转到“工具”-&gt;“ PVS-Studio”中的顶部菜单，然后单击“禁止所有消息”。</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1d3/860/1eb/1d38601ebc120fa0c03d91df2237a8df.png" alt="图片1"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在出现的窗口中，警告所有当前操作都将进入抑制列表，单击“确定”。</font><font style="vertical-align: inherit;">结果，将在项目文件夹中创建一个抑制文件，分析器在以后的工作中将考虑该文件。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
应该注意的是，Rider已经拥有可以成功突出显示某些错误的分析器。</font><font style="vertical-align: inherit;">因此，PVS-Studio发出的一系列警告指向从编辑器的角度看似可疑的代码。</font><font style="vertical-align: inherit;">然而，PVS-Studio经常会发现可能会从JetBrains摆脱分析仪敏感的眼睛的错误。</font><font style="vertical-align: inherit;">这就是为什么最有效的解决方案是允许他们团队合作的原因。</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/401/c23/d47/401c23d47c7f813c25acd347e7517482.png" alt="图片10"></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">还有甜点</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在，如所承诺的，我们将根据验证结果考虑分析仪显示哪些有趣的警告。该项目包含大量的源代码文件，因此在其中找到许多可疑的时刻并不奇怪。没有什么可做的-每个人都会犯错，但是尽一切努力及时发现并纠正它们很重要。静态分析可以大大简化此任务。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
检查的结果显示了大约一千个警告：</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2a6/3d4/124/2a63d41242fd337aaff1753454f8a79c.png" alt="图片11"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
您可以通过单击</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">链接</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">阅读有关警告级别的更多信息</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
当然，并非所有触发因素都表明超级可怕的错误。</font><font style="vertical-align: inherit;">如果是这样的话，那么至少有可能在项目中没有起作用:)。</font><font style="vertical-align: inherit;">但是重要的是要了解，如果分析仪“发誓”，那么代码看起来很奇怪，应该仔细研究。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
总的来说，该项目发现了许多有趣的优点。</font><font style="vertical-align: inherit;">但是，我不希望这篇文章太大，所以我们只考虑其中的一些。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">只是额外的检查？</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">EnsurePathExists</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> file</span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">var</span> dirpath = Path.GetDirectoryName(file);<font></font>
  List&lt;<span class="hljs-keyword">string</span>&gt; dirsToCreate = <span class="hljs-keyword">new</span> List&lt;<span class="hljs-keyword">string</span>&gt;();
  <span class="hljs-keyword">while</span> (Directory.Exists(dirpath) == <span class="hljs-literal">false</span>)<font></font>
  {<font></font>
    dirsToCreate.Add(dirpath);<font></font>
    dirpath = Directory.GetParent(dirpath).ToString();<font></font>
    <span class="hljs-keyword">if</span> (dirpath == <span class="hljs-literal">null</span>)                                  <span class="hljs-comment">// &lt;=</span>
      <span class="hljs-keyword">break</span>;<font></font>
  }<font></font>
  dirsToCreate.ForEach(x =&gt; Directory.CreateDirectory(x));<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分析器警告</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3022</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表达式'dirpath == null'始终为false。 PosixHelper.cs（124）Voron </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
可以用不同的方式考虑此操作。一方面，额外检查当然不是很好，但它本身并不是错误。另一方面，值得考虑：此代码是否真的按照程序员的意图工作？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
也许开发人员确实不知道</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">永远不会返回</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。如果不是这样，那么我们可以对他想要实现的目标做出假设。</font><font style="vertical-align: inherit;">当无法为该目录获取父目录时，</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
也许</font><font style="vertical-align: inherit;">应该调用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">break</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。如果是这样，则检查是否为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">空</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">说得通。</font><font style="vertical-align: inherit;">但是，我们无需考虑</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的结果</font><font style="vertical-align: inherit;">，而</font><font style="vertical-align: inherit;">应考虑</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetParent</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法返回的值</font><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="cs hljs">dirsToCreate.Add(dirpath);
<span class="hljs-keyword">var</span> dir = Directory.GetParent(dirpath);    
<span class="hljs-keyword">if</span> (dir == <span class="hljs-literal">null</span>)
  <span class="hljs-keyword">break</span>;<font></font>
<font></font>
dirpath = dir.ToString();</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
否则，</font><font style="vertical-align: inherit;">使用</font><i><font style="vertical-align: inherit;">GetParent</font></i><font style="vertical-align: inherit;">方法</font><font style="vertical-align: inherit;">返回</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null </font></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在调用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时</font><i><font style="vertical-align: inherit;">引发</font></i><font style="vertical-align: inherit;">异常</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">典型值null</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">long</span> <span class="hljs-title">ScanOldest</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; copy.Length; i++)<font></font>
  {<font></font>
    <span class="hljs-keyword">var</span> item = copy[i].Value;
    <span class="hljs-keyword">if</span> (item != <span class="hljs-literal">null</span> || item == InvalidLowLevelTransaction) <span class="hljs-comment">// &lt;=</span><font></font>
    {<font></font>
      <span class="hljs-keyword">if</span> (val &gt; item.Id)                                    <span class="hljs-comment">// &lt;=</span><font></font>
        val = item.Id;<font></font>
    }<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分析器警告</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3125</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在对null进行验证之后，使用了“ item”对象。检查行：249，247。ActiveTransactions.cs（249），ActiveTransactions.cs（247）Voron </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
由于该</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">项目</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实际上为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，所以代码看起来很奇怪</font><font style="vertical-align: inherit;">。实际上，如果</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InvalidLowLevelTransaction</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">也为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则条件为true，并且尝试获取</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">item.Id</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将引发异常。如果</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InvalidLowLevelTransaction</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不能为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则条件“ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">item == InvalidLowLevelTransaction</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“这只是多余的。这是因为仅当</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">item == null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时才进行检查</font><font style="vertical-align: inherit;">。好吧，如果突然之间</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">item</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不能为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则整个条件将失去其意义，而只会添加不必要的嵌套。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我认为在这里，也许错误的逻辑运算符中选择。如果您要更换“||”和‘&amp;&amp;’的情况下，该代码立即开始寻找符合逻辑的。那么，在这种情况下不会出现问题。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这样一个计划的发展是在理论上非常危险的错误的典型代表检测到分析仪公平地讲，应该指出，Rider内置的分析仪也将此片段标记为潜在危险。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">再次检查？</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">WriteObjectEnd</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> (_continuationState.Count &gt; <span class="hljs-number">1</span>)<font></font>
  {<font></font>
    <span class="hljs-keyword">var</span> outerState = <font></font>
      _continuationState.Count &gt; <span class="hljs-number">0</span> ? _continuationState.Pop() : currentState<font></font>
    ;<font></font>
    <span class="hljs-keyword">if</span> (outerState.FirstWrite == <span class="hljs-number">-1</span>)<font></font>
      outerState.FirstWrite = start;<font></font>
    _continuationState.Push(outerState);<font></font>
  }  <font></font>
   ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分析器警告</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3022</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表达式'_continuationState.Count&gt; 0'始终为true。</font><font style="vertical-align: inherit;">ManualBlittableJsonDocumentBuilder.cs（152）麻雀</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
首先，在外部条件下，检查集合中元素的数量是否大于1，然后在下一行中，三元运算符检查其数量是否大于0。似乎其中一项检查看起来应该有所不同。</font><font style="vertical-align: inherit;">无论哪种方式，此代码看起来都非常可疑，应在必要时仔细研究和处理。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可能的NRE</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">override</span> Expression <span class="hljs-title">VisitIndex</span>(<span class="hljs-params">IndexExpression node</span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">if</span> (node.Object != <span class="hljs-literal">null</span>)<font></font>
  {<font></font>
    Visit(node.Object);<font></font>
  }<font></font>
  <span class="hljs-keyword">else</span><font></font>
  {<font></font>
    Out(node.Indexer.DeclaringType.Name); <span class="hljs-comment">// &lt;=</span><font></font>
  }<font></font>
  <span class="hljs-keyword">if</span> (node.Indexer != <span class="hljs-literal">null</span>)               <span class="hljs-comment">// &lt;=</span><font></font>
  {<font></font>
    Out(<span class="hljs-string">"."</span>);<font></font>
    Out(node.Indexer.Name);<font></font>
  }<font></font>
  VisitExpressions(<span class="hljs-string">'['</span>, node.Arguments, <span class="hljs-string">']'</span>);
  <span class="hljs-keyword">return</span> node;<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分析器警告</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3095</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在对null进行验证之前，已使用'node.Indexer'对象。检查行：1180，1182。ExpressionStringBuilder.cs（1180），ExpressionStringBuilder.cs（1182）Raven.Client </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
实际上，这是PVS-Studio和Rider认为可疑的另一个地方。没错，措辞有些不同：JetBrains的分析器仅突出显示</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">node.Indexer.DeclaringType</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并带有注释“ Possible NullReferenceException”。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
两位审稿人都声称确实可以在此片段中引发异常。我必须说，PVS-Studio发出的警告不仅说明这里可能有错误，而且还解释了他为何有这样的观点。看起来有点琐事，但很好。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
实际上，并不是真的有错误。</font><font style="vertical-align: inherit;">如果</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">node.Object == null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可能</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">精确指定了</font><i><font style="vertical-align: inherit;">node.Indexer</font></i><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在这种情况下，当</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">node.Object</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">node.Indexer</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">都不为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时，情况是允许的</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">只有在这种情况下，才能将两个分析仪的给定操作视为错误。</font><font style="vertical-align: inherit;">因此，值得仔细分析所有可能的选择。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果您深入研究？</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">LoadStartingWithInternal</span>(<span class="hljs-params">....</span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">var</span> command = operation.CreateRequest();
  <span class="hljs-keyword">if</span> (command != <span class="hljs-literal">null</span>)                       <span class="hljs-comment">// &lt;=</span><font></font>
  {<font></font>
    <span class="hljs-keyword">await</span> RequestExecutor<font></font>
      .ExecuteAsync(command, Context, SessionInfo, token)<font></font>
      .ConfigureAwait(<span class="hljs-literal">false</span>)<font></font>
    ;<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (stream != <span class="hljs-literal">null</span>)<font></font>
      Context.Write(stream, command.Result.Results.Parent);<font></font>
    <span class="hljs-keyword">else</span><font></font>
      operation.SetResult(command.Result);<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分析器警告</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3022</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表达式'command！= Null'始终为true。 AsyncDocumentSession.Load.cs（175）Raven.Client </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
发出警告，因为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CreateRequest方法</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从不返回</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。实际上，只需查看其代码即可：</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> GetDocumentsCommand <span class="hljs-title">CreateRequest</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  _session.IncrementRequestCount();<font></font>
  <span class="hljs-keyword">if</span> (Logger.IsInfoEnabled)<font></font>
    Logger.Info(....);<font></font>
<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> GetDocumentsCommand(....);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
通常，此检查不是问题，尽管在某些情况下该方法可能用于返回null，但现在它引发了异常。</font><font style="vertical-align: inherit;">谁知道呢，现在可能</font><font style="vertical-align: inherit;">应该有一个try-catch </font><font style="vertical-align: inherit;">，而不是检查</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
您可能有一个非常合理的问题：在这里抛出异常吗？</font><font style="vertical-align: inherit;">如果不是，那么我们仍然需要额外检查，并且这里没有错误。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
但是，a，执行该方法时，确实可以引发两次异常。</font><font style="vertical-align: inherit;">首先在</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IncrementRequestCount</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法中</font><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">IncrementRequestCount</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">if</span> (++NumberOfRequests &gt; MaxNumberOfRequestsPerSession)
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> InvalidOperationException(....);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
然后，在</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetDocumentsCommand</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的构造函数中</font><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">GetDocumentsCommand</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> startWith, ....</span>)</span><font></font>
{<font></font>
  _startWith = startWith ?? <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentNullException(<span class="hljs-keyword">nameof</span>(startWith));<font></font>
  ....<font></font>
}</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">传统复制粘贴</font></font></h3><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">WriteTo</span>(<span class="hljs-params">StringBuilder writer</span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> (SqlConnectionStringsUpdated)<font></font>
    json[<span class="hljs-keyword">nameof</span>(SqlConnectionStringsUpdated)] = SqlConnectionStringsUpdated;<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (ClientConfigurationUpdated)<font></font>
    json[<span class="hljs-keyword">nameof</span>(ClientConfigurationUpdated)] = ClientConfigurationUpdated;<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (ConflictSolverConfigUpdated)<font></font>
    json[<span class="hljs-keyword">nameof</span>(ConflictSolverConfigUpdated)] = ClientConfigurationUpdated;<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (PeriodicBackupsUpdated)<font></font>
    json[<span class="hljs-keyword">nameof</span>(PeriodicBackupsUpdated)] = PeriodicBackupsUpdated;<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (ExternalReplicationsUpdated)<font></font>
    json[<span class="hljs-keyword">nameof</span>(ExternalReplicationsUpdated)] = ExternalReplicationsUpdated;<font></font>
  ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分析器警告</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3127找到</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">两个相似的代码片段。也许，这是一个错字。 SmugglerResult.cs（256），SmugglerResult.cs（253）Raven.Client我</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
非常怀疑至少有人通过查看代码会在这里看到怪异。该函数由14个类似条件组成，所有变量均以Updated结尾。即使此处只给出一小部分，该错误也不会立即可见。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
人脑实际上拒绝在这种代码中寻找任何东西。同时，PVS-Studio很容易发现它已被分配，很可能是完全错误的，它应该：</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">if</span> (ClientConfigurationUpdated)<font></font>
    json[<span class="hljs-keyword">nameof</span>(ClientConfigurationUpdated)] = ClientConfigurationUpdated;<font></font>
<font></font>
<span class="hljs-keyword">if</span> (ConflictSolverConfigUpdated)<font></font>
    json[<span class="hljs-keyword">nameof</span>(ConflictSolverConfigUpdated)] = ClientConfigurationUpdated;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
逻辑上，赋值运算符右边的底线应该是</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ConflictSolverConfigUpdated</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">我敢肯定，如果没有静态分析，只有当某种严重的问题因此而被破坏时，这种奇怪的现象才会被发现。</font><font style="vertical-align: inherit;">编程人员将能够注意到该功能中隐藏了一个问题，除非他事先知道该问题。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">哦这个 ”？？”</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> Count =&gt; <font></font>
  _documentsByEntity.Count + _onBeforeStoreDocumentsByEntity?.Count ?? <span class="hljs-number">0</span>;</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分析仪警告</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3123</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">也许是“ ??”操作员的工作方式与预期不同。它的优先级低于其左侧的其他运营商的优先级。 InMemoryDocumentSessionOperations.cs（1952）Raven.Client </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
当然，这仍然有可能根本不是一个错误，这正是它的</font><font style="vertical-align: inherit;">初衷</font><font style="vertical-align: inherit;">。但是这个地方看起来非常可疑。毕竟，逻辑上假设该函数的想法不是使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_onBeforeStoreDocumentsByEntity == null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回0 </font><i><font style="vertical-align: inherit;">。</font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
我认为确实存在与运营商优先级相关的错误。在这种情况下，必须将方括号括起来：</font></font><br>
<br>
<pre><code class="cs hljs">_documentsByEntity.Count + (_onBeforeStoreDocumentsByEntity?.Count ?? <span class="hljs-number">0</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
好吧，如果突然之间所有事情都已真正计划好了，那么也许您应该明确指出-读取代码的分析器和程序员将不会有问题：</font></font><br>
<br>
<pre><code class="cs hljs">(_documentsByEntity.Count + _onBeforeStoreDocumentsByEntity?.Count) ?? <span class="hljs-number">0</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
但这当然是一个品味问题。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">传递参数</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">UpdateEnvironmentVariableLicenseString</span>(<span class="hljs-params">....</span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> (ValidateLicense(newLicense, rsaParameters, oldLicense) == <span class="hljs-literal">false</span>)
    <span class="hljs-keyword">return</span>;<font></font>
  ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分析器警告</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3066</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">传递给“ ValidateLicense”方法的参数的可能错误顺序：“ newLicense”和“ oldLicense”。</font><font style="vertical-align: inherit;">LicenseHelper.cs（177）</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以可疑的顺序传递给该方法的</font><font style="vertical-align: inherit;">Raven.Server </font><font style="vertical-align: inherit;">参数。</font><font style="vertical-align: inherit;">实际上，请看一下广告：</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">ValidateLicense</span>(<span class="hljs-params">
  License oldLicense, 
  RSAParameters rsaParameters, 
  License newLicense
</span>)</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio甚至能够发现此类错误也非常令人高兴。</font><font style="vertical-align: inherit;">这是静态分析优于动态分析的一个很好的例子。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
尽管有上述规定，我最初还是建议这些参数以什么顺序传递可能无关紧要。</font><font style="vertical-align: inherit;">当然，在这种情况下，名称选择不正确，但是您可以怎么做。</font><font style="vertical-align: inherit;">但是，</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ValidateLicense</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的内部结构</font><font style="vertical-align: inherit;">表明这些参数仍然具有不同的含义。</font><font style="vertical-align: inherit;">通过单击</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">链接</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以查看此功能的代码</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">永不继续</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> List&lt;CounterOperation&gt; <span class="hljs-title">GetCounterOperationsFor</span>(<span class="hljs-params">RavenEtlItem item</span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; counters.Count; i++)<font></font>
  {<font></font>
    counters.GetPropertyByIndex(i, <span class="hljs-keyword">ref</span> prop);<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (<font></font>
      GetCounterValueAndCheckIfShouldSkip(<font></font>
        item.DocumentId, <font></font>
        <span class="hljs-literal">null</span>, <font></font>
        prop, <font></font>
        <span class="hljs-keyword">out</span> <span class="hljs-keyword">long</span> <span class="hljs-keyword">value</span>, 
        <span class="hljs-keyword">out</span> <span class="hljs-keyword">bool</span> delete<font></font>
      )<font></font>
    ) <span class="hljs-keyword">continue</span>;<font></font>
    ....<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分析器警告</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3022</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表达式“ GetCounterValueAndCheckIfShouldSkip（item.DocumentId，null，prop，输出长值，输出布尔删除）”始终为false。 RavenEtlDocumentTransformer.cs（362）Raven.Server </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
通过单击</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">链接</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以完全考虑此方法</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
警告表明</font><font style="vertical-align: inherit;">此循环</font><font style="vertical-align: inherit;">中的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">继续</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调用</font><font style="vertical-align: inherit;">无法到达。如果是这样，那么该片段确实很奇怪。但这也许只是假阳性？骑士对此并不发誓。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
看一下</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetCounterValueAndCheckIfShouldSkip</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法</font><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">GetCounterValueAndCheckIfShouldSkip</span>(<span class="hljs-params">
  LazyStringValue docId, 
  <span class="hljs-keyword">string</span> function, 
  BlittableJsonReaderObject.PropertyDetails prop, 
  <span class="hljs-keyword">out</span> <span class="hljs-keyword">long</span> <span class="hljs-keyword">value</span>, 
  <span class="hljs-keyword">out</span> <span class="hljs-keyword">bool</span> delete
</span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">value</span> = <span class="hljs-number">0</span>;<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (prop.Value <span class="hljs-keyword">is</span> LazyStringValue)<font></font>
  {<font></font>
    delete = <span class="hljs-literal">true</span>;<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">else</span><font></font>
  {<font></font>
    delete = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">value</span> = CountersStorage.InternalGetCounterValue(<font></font>
      prop.Value <span class="hljs-keyword">as</span> BlittableJsonReaderObject.RawBlob, <font></font>
      docId, <font></font>
      prop.Name<font></font>
    );<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (function != <span class="hljs-literal">null</span>)<font></font>
    {<font></font>
      <span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> result = BehaviorsScript.Run(<font></font>
        Context, <font></font>
        Context, <font></font>
        function, <font></font>
        <span class="hljs-keyword">new</span> <span class="hljs-keyword">object</span>[] { docId, prop.Name }<font></font>
      ))<font></font>
      {<font></font>
        <span class="hljs-keyword">if</span> (result.BooleanValue != <span class="hljs-literal">true</span>)
          <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
      }<font></font>
    }<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
显然，</font><font style="vertical-align: inherit;">只有</font><i><font style="vertical-align: inherit;">函数</font></i><font style="vertical-align: inherit;">！= </font><i><font style="vertical-align: inherit;">Null时</font></i><font style="vertical-align: inherit;">，此方法才能返回</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">true</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在前面考虑的代码中，空指针正好传递到此参数的位置。</font><font style="vertical-align: inherit;">因此，</font><i><font style="vertical-align: inherit;">continue</font></i><font style="vertical-align: inherit;">呼叫</font><font style="vertical-align: inherit;">确实无法接通。</font><font style="vertical-align: inherit;">
此刻既可能是无害的遗漏，也可能是与条件错误相关的问题。</font><font style="vertical-align: inherit;">一种或另一种方式，您应该注意它。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">信任但要验证</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> LicenseType Type<font></font>
{<font></font>
  <span class="hljs-keyword">get</span><font></font>
  {<font></font>
    <span class="hljs-keyword">if</span> (ErrorMessage != <span class="hljs-literal">null</span>)
      <span class="hljs-keyword">return</span> LicenseType.Invalid;<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (Attributes == <span class="hljs-literal">null</span>)
      <span class="hljs-keyword">return</span> LicenseType.None;<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (Attributes != <span class="hljs-literal">null</span> &amp;&amp;                             <span class="hljs-comment">// &lt;=</span>
        Attributes.TryGetValue(<span class="hljs-string">"type"</span>, <span class="hljs-keyword">out</span> <span class="hljs-keyword">object</span> type) &amp;&amp;<font></font>
        type <span class="hljs-keyword">is</span> <span class="hljs-keyword">int</span><font></font>
    )<font></font>
    {<font></font>
      <span class="hljs-keyword">var</span> typeAsInt = (<span class="hljs-keyword">int</span>)type;
      <span class="hljs-keyword">if</span> (Enum.IsDefined(<span class="hljs-keyword">typeof</span>(LicenseType), typeAsInt))
        <span class="hljs-keyword">return</span> (LicenseType)typeAsInt;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">return</span> LicenseType.Community;<font></font>
  }<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分析器警告</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3063</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果条件表达式的一部分被求值，则它始终为true：属性！=空。</font><font style="vertical-align: inherit;">LicenseStatus.cs（28）Raven.Server </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一个极其奇怪的片段。</font><font style="vertical-align: inherit;">通常，多余的检查至少会以某种方式分开-在这里，直接在下一行中检查变量与null指针的对应关系。</font><font style="vertical-align: inherit;">看起来该代码很可能根本没有程序员想要的。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可为空，永不为空</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> Task <span class="hljs-title">SuspendObserver</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">if</span> (ServerStore.IsLeader())<font></font>
  {<font></font>
    <span class="hljs-keyword">var</span> suspend = GetBoolValueQueryString(<span class="hljs-string">"value"</span>);
    <span class="hljs-keyword">if</span> (suspend.HasValue)                                  <span class="hljs-comment">// &lt;=</span><font></font>
    {<font></font>
      Server.ServerStore.Observer.Suspended = suspend.Value;<font></font>
    }<font></font>
<font></font>
    NoContentStatus();<font></font>
    <span class="hljs-keyword">return</span> Task.CompletedTask;<font></font>
  }<font></font>
<font></font>
  RedirectToLeader();<font></font>
<font></font>
  <span class="hljs-keyword">return</span> Task.CompletedTask;<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分析器警告</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3022</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表达式'suspend.HasValue'始终为true。</font><font style="vertical-align: inherit;">RachisAdminHandler.cs（116）Raven.Server </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
另一个看似无害的“额外”检查。</font><font style="vertical-align: inherit;">尽管尚不清楚为什么分析仪认为是这样。</font><i><font style="vertical-align: inherit;">打开</font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
到</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetBoolValueQueryString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">bool</span>? GetBoolValueQueryString(<span class="hljs-keyword">string</span> name, <span class="hljs-keyword">bool</span> required = <span class="hljs-literal">true</span>)<font></font>
{<font></font>
  <span class="hljs-keyword">var</span> boolAsString = GetStringQueryString(name, required);
  <span class="hljs-keyword">if</span> (boolAsString == <span class="hljs-literal">null</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">bool</span>.TryParse(boolAsString, <span class="hljs-keyword">out</span> <span class="hljs-keyword">bool</span> result) == <span class="hljs-literal">false</span>)<font></font>
    ThrowInvalidBoolean(name, boolAsString);<font></font>
<font></font>
  <span class="hljs-keyword">return</span> result;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
确实，有时此函数返回</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">是的，Rider认为该检查没有必要。</font><font style="vertical-align: inherit;">独角兽失败了吗？</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/349/99d/ab6/34999dab64459aebc38561a25b2bad72.png" alt="图片15"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
但是，如果您查看</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetStringQueryString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法</font><font style="vertical-align: inherit;">呢？</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">string</span> <span class="hljs-title">GetStringQueryString</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> name, <span class="hljs-keyword">bool</span> required = <span class="hljs-literal">true</span></span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">var</span> val = HttpContext.Request.Query[name];
  <span class="hljs-keyword">if</span> (val.Count == <span class="hljs-number">0</span> || <span class="hljs-keyword">string</span>.IsNullOrWhiteSpace(val[<span class="hljs-number">0</span>]))<font></font>
  {<font></font>
    <span class="hljs-keyword">if</span> (required)<font></font>
      ThrowRequiredMember(name);<font></font>
<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">return</span> val[<span class="hljs-number">0</span>];<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
嗯，如果参数</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">required</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> == </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">true</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，那么将调用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ThrowRequiredMember</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">我不知道他做什么？</font><font style="vertical-align: inherit;">:)好吧，所以毫无疑问，这是毫无疑问的：</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ThrowRequiredMember</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> name</span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentException(
    <span class="hljs-string">$"Query string <span class="hljs-subst">{name}</span> is mandatory, but wasn't specified."</span><font></font>
  );<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
因此，我们总结一下。开发人员调用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetBoolValueQueryString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法</font><font style="vertical-align: inherit;">。他可能认为该方法可能无法获得必要的价值。好吧，结果它返回</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。在内部，</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">称为GetStringQueryString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。如果出现问题，它将返回null或引发异常。如果</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必需</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数</font><font style="vertical-align: inherit;">设置为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">true，</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">则会发生第二次</font><font style="vertical-align: inherit;">。此外，这是其默认值。同时，在调用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetBoolValueQueryString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时，如果您查看上面的代码，则不会传输它。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
让我们再次看一下</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SuspendObserver</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法的代码，</font><font style="vertical-align: inherit;">分析器发誓</font><font style="vertical-align: inherit;">的代码</font><font style="vertical-align: inherit;">片段：</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> Task <span class="hljs-title">SuspendObserver</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">if</span> (ServerStore.IsLeader())<font></font>
  {<font></font>
    <span class="hljs-keyword">var</span> suspend = GetBoolValueQueryString(<span class="hljs-string">"value"</span>);
    <span class="hljs-keyword">if</span> (suspend.HasValue)<font></font>
    {<font></font>
      Server.ServerStore.Observer.Suspended = suspend.Value;<font></font>
    }<font></font>
<font></font>
    NoContentStatus();<font></font>
    <span class="hljs-keyword">return</span> Task.CompletedTask;<font></font>
  }<font></font>
<font></font>
  RedirectToLeader();<font></font>
<font></font>
  <span class="hljs-keyword">return</span> Task.CompletedTask;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
似乎，从设计</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上讲</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，如果</font><i><font style="vertical-align: inherit;">GetBoolValueQueryString</font></i><font style="vertical-align: inherit;">无法获取该值</font><font style="vertical-align: inherit;">，则不应在此处中断线程</font><font style="vertical-align: inherit;">。实际上，在检查</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的块之后</font><font style="vertical-align: inherit;">，将执行各种操作并返回一个值。我相信，根据设计，</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无论</font></font></b><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetBoolValueQueryString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法</font><b><font style="vertical-align: inherit;">是否</font></b><font style="vertical-align: inherit;">成功，</font><font style="vertical-align: inherit;">都将执行这些操作</font><font style="vertical-align: inherit;">。实际会发生什么？执行线程将被异常中断。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这一点是正确的，你需要一个电话</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetBoolValueQueryString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通的第二个参数</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所需的</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置为false</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。这样，一切都会按预期进行。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
就像我之前说的，有时候分析仪似乎是错误的（隐瞒着什么罪过，有时会发生）。</font><font style="vertical-align: inherit;">同样，警告看起来也很少。</font><font style="vertical-align: inherit;">似乎这里需要额外检查，好吧。</font><font style="vertical-align: inherit;">好吧，甚至更好-我们将其删除，没有问题-警告将消失！</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
即使在操作看起来很奇怪和难以理解的情况下，也不要匆忙将其标记为“ false”。</font><font style="vertical-align: inherit;">您需要尝试了解分析仪为何认为该位置有问题，然后做出决定。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">奇数</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> Task&lt;<span class="hljs-keyword">int</span>&gt; <span class="hljs-title">WriteDocumentsJsonAsync</span>(<span class="hljs-params">...., <span class="hljs-keyword">int</span> numberOfResults</span>) <span class="hljs-comment">// &lt;=</span></span><font></font>
{<font></font>
  <span class="hljs-keyword">using</span> (
    <span class="hljs-keyword">var</span> writer = <span class="hljs-keyword">new</span> AsyncBlittableJsonTextWriter(<font></font>
      context, <font></font>
      ResponseBodyStream(), <font></font>
      Database.DatabaseShutdown<font></font>
    )<font></font>
  )<font></font>
  {<font></font>
    writer.WriteStartObject();<font></font>
    writer.WritePropertyName(<span class="hljs-keyword">nameof</span>(GetDocumentsResult.Results));<font></font>
    numberOfResults = <span class="hljs-keyword">await</span> writer.WriteDocumentsAsync(                    <span class="hljs-comment">// &lt;=</span><font></font>
      context, <font></font>
      documentsToWrite, <font></font>
      metadataOnly<font></font>
    );<font></font>
<font></font>
    ....<font></font>
  }<font></font>
  <span class="hljs-keyword">return</span> numberOfResults;<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分析器警告</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3061</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数'numberOfResults'始终在使用前在方法主体中重写。</font><font style="vertical-align: inherit;">DocumentHandler.cs（273），DocumentHandler.cs（267）Raven.Server </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
传递给该函数的参数未使用，但会立即被覆盖。</font><font style="vertical-align: inherit;">为什么在这里需要它？</font><font style="vertical-align: inherit;">他们想通过裁判？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我很好奇如何在现有代码中使用此方法。</font><font style="vertical-align: inherit;">我希望由于它是私有的，所以不应有太多。</font><font style="vertical-align: inherit;">多亏了Rider，我很容易找到了拨打电话的地方。</font><font style="vertical-align: inherit;">这是唯一的地方：</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">GetDocumentsByIdAsync</span>(<span class="hljs-params">....</span>)</span><font></font>
{<font></font>
  ....            <font></font>
  <span class="hljs-keyword">int</span> numberOfResults = <span class="hljs-number">0</span>;<font></font>
<font></font>
  numberOfResults = <span class="hljs-keyword">await</span> WriteDocumentsJsonAsync(<font></font>
    context, <font></font>
    metadataOnly, <font></font>
    documents, <font></font>
    includes, <font></font>
    includeCounters?.Results, <font></font>
    numberOfResults<font></font>
  );<font></font>
<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
变量被分配为0，然后将其传递给方法，并为其分配结果。</font><font style="vertical-align: inherit;">在方法内部，该参数没有任何使用。</font><font style="vertical-align: inherit;">Em。</font><font style="vertical-align: inherit;">为什么要这样？</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/74a/e29/1cf/74ae291cf3c642aafc84c5bfce7ed18e.png" alt="图片6"></div><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">逻辑运算符错误</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> OrderByField <span class="hljs-title">ExtractOrderByFromMethod</span>(<span class="hljs-params">....</span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> (me.Arguments.Count &lt; <span class="hljs-number">2</span> &amp;&amp; me.Arguments.Count &gt; <span class="hljs-number">3</span>)
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> InvalidQueryException(....);<font></font>
  ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分析器警告</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3022</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表达式'me.Arguments.Count &lt;2 &amp;&amp; me.Arguments.Count&gt; 3'始终为false。</font><font style="vertical-align: inherit;">可能是“ ||” </font><font style="vertical-align: inherit;">这里应该使用运算符。</font><font style="vertical-align: inherit;">QueryMetadata.cs（861）Raven.Server </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
可以在</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此处</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查看完整方法</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这次我们有一个明显的错误，那就是使用错误的逻辑运算符。</font><font style="vertical-align: inherit;">在当前形式下，检查参数的数量根本不起作用，因为没有一个值既小于2又大于3。通过传递给异常构造函数的第一个参数，很容易揭示开发人员的真实意图：</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-string">"Invalid ORDER BY 'spatial.distance(from, to, roundFactor)' call, 
expected 2-3 arguments, got "</span> + me.Arguments.Count<font></font>
   ,    <span class="hljs-string">"&amp;&amp;"</span>  <span class="hljs-string">"||"</span>.</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">奇怪的尝试方法</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">Operator</span>(<span class="hljs-params">OperatorField fieldOption, <span class="hljs-keyword">out</span> QueryExpression op</span>)</span><font></font>
{ <font></font>
  ....<font></font>
  <span class="hljs-keyword">switch</span> (match)<font></font>
  {<font></font>
    ....<font></font>
    <span class="hljs-keyword">case</span> <span class="hljs-string">"("</span>:
      <span class="hljs-keyword">var</span> isMethod = Method(field, <span class="hljs-keyword">out</span> <span class="hljs-keyword">var</span> method); <span class="hljs-comment">// &lt;=</span><font></font>
      op = method;<font></font>
<font></font>
      <span class="hljs-keyword">if</span> (isMethod &amp;&amp; Operator(OperatorField.Optional, <span class="hljs-keyword">out</span> <span class="hljs-keyword">var</span> methodOperator))<font></font>
      {<font></font>
        ....<font></font>
      }<font></font>
<font></font>
      <span class="hljs-keyword">return</span> isMethod;<font></font>
    ....<font></font>
  }<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分析器警告</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3063</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果对条件表达式进行评估，则条件表达式的一部分始终为true：isMethod。 QueryParser.cs（1797）Raven.Server </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
可以在</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此处查看</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">完整方法</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
构造</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">var isMethod = Method（字段，out var方法）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使我想起了</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Int.TryParse</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">之类的标准方法</font><font style="vertical-align: inherit;">。此类方法尝试获取结果并将其写入out变量，并且操作成功的标志是返回值。使用此类函数的代码通常检查返回值，然后在其基础上执行某些操作。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我认为</font><i><font style="vertical-align: inherit;">Method</font></i><font style="vertical-align: inherit;">函数</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以这种方式在这里使用。</font><font style="vertical-align: inherit;">此外，</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Method</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的结果</font><font style="vertical-align: inherit;">是</font><font style="vertical-align: inherit;">调用它</font><font style="vertical-align: inherit;">的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Operator</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法的返回值</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
分析器指示</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">isMethod</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量</font><i><font style="vertical-align: inherit;">将</font></i><font style="vertical-align: inherit;">始终为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">true，</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并且在条件下对其进行的验证是没有意义的。这意味着</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Method</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数</font><font style="vertical-align: inherit;">从不返回</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">false</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。那么这种结构的用途是什么？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
首先，请确保分析仪没有弄错：</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">Method</span>(<span class="hljs-params">FieldExpression field, <span class="hljs-keyword">out</span> MethodExpression op</span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">var</span> args = ReadMethodArguments();<font></font>
<font></font>
  op = <span class="hljs-keyword">new</span> MethodExpression(field.FieldValue, args);
  <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
实际上，此方法的返回值始终为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">true</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。如果一切都按原计划进行，那么……这很奇怪，但原则上并不重要。但是，如果没有呢？</font><font style="vertical-align: inherit;">在某些情况下，</font><i><font style="vertical-align: inherit;">ReadMethodArguments</font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
函数</font><font style="vertical-align: inherit;">（可在</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">此处</font></a><font style="vertical-align: inherit;">查看其代码）会</font><font style="vertical-align: inherit;">引发异常。当方法无法正确执行其任务时，就会发生这种情况。</font><font style="vertical-align: inherit;">
看来，调用</font><i><font style="vertical-align: inherit;">Method</font></i><font style="vertical-align: inherit;">函数的代码</font><font style="vertical-align: inherit;">并非旨在引发异常。最有可能的假设是，当不可能正确获取out变量的值时，</font><i><font style="vertical-align: inherit;">Method</font></i><font style="vertical-align: inherit;">函数</font><font style="vertical-align: inherit;">将返回</font><i><font style="vertical-align: inherit;">false</font></i><font style="vertical-align: inherit;">。但是，对于当前的实现，将抛出异常。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
尽管如此，值得关注此片段。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">空值=空值？</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> Address <span class="hljs-title">GetNextEdge</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">if</span> (m_curEdgeBlock == <span class="hljs-literal">null</span> || m_curEdgeBlock.Count &lt;= m_curEdgeIdx)<font></font>
  {<font></font>
    m_curEdgeBlock = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">if</span> (m_edgeBlocks.Count == <span class="hljs-number">0</span>)<font></font>
    {<font></font>
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ApplicationException(
        <span class="hljs-string">"Error not enough edge data.  Giving up on heap dump."</span><font></font>
      );<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">var</span> nextEdgeBlock = m_edgeBlocks.Dequeue();
    <span class="hljs-keyword">if</span> (<font></font>
      m_curEdgeBlock != <span class="hljs-literal">null</span> &amp;&amp;                       <span class="hljs-comment">// &lt;=</span>
      nextEdgeBlock.Index != m_curEdgeBlock.Index + <span class="hljs-number">1</span><font></font>
    )<font></font>
    {<font></font>
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ApplicationException(
        <span class="hljs-string">"Error expected Node Index "</span> + (m_curEdgeBlock.Index + <span class="hljs-number">1</span>) + 
        <span class="hljs-string">" Got "</span> + nextEdgeBlock.Index + <span class="hljs-string">" Giving up on heap dump."</span><font></font>
      );<font></font>
    }<font></font>
<font></font>
    m_curEdgeBlock = nextEdgeBlock;<font></font>
    m_curEdgeIdx = <span class="hljs-number">0</span>;<font></font>
  }<font></font>
  <span class="hljs-keyword">return</span> m_curEdgeBlock.Values(m_curEdgeIdx++).Target;<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分析器警告</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3063</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果条件表达式的一部分被求值，则始终为false：m_curEdgeBlock！= Null。</font><font style="vertical-align: inherit;">DotNetHeapDumpGraphReader.cs（803）Raven.Debug为</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
变量分配了一个空指针，然后在几行之后检查其</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">空</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不等式</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在这种情况下，检查</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nextEdgeBlock.Index！= M_curEdgeBlock.Index +1</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的代码变得毫无意义</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">此外，永远不会引发异常。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
逻辑上可以假设某事没有按其应有的方式工作，因为该片段看起来很奇怪。</font><font style="vertical-align: inherit;">在这里根本不需要检查，或者以某种方式实施不正确。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
您可以考虑触发，另一方面，则相反。</font><font style="vertical-align: inherit;">让我们尝试想象这种响应为假的情况。</font><font style="vertical-align: inherit;">我认为只有通过调用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Deque</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以更改变量的值，才有可能</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">但是，</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_curEdgeBlock</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是一个私有字段，而</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_edgeBlocks</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是在同一类中初始化的标准队列。</font><font style="vertical-align: inherit;">因此，对</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dequeue</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的调用是否</font><font style="vertical-align: inherit;">可能以某种方式影响</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_curEdgeBlock</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的值</font><font style="vertical-align: inherit;">是非常令人怀疑的</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">因此，触发器很可能不是假的。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第一个或空</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> HashSet&lt;<span class="hljs-keyword">string</span>&gt; <span class="hljs-title">FindSpecialColumns</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> tableSchema, <span class="hljs-keyword">string</span> tableName</span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">var</span> mainSchema = GetTable(tableSchema, tableName);<font></font>
<font></font>
  <span class="hljs-keyword">var</span> result = <span class="hljs-keyword">new</span> HashSet&lt;<span class="hljs-keyword">string</span>&gt;();<font></font>
  mainSchema.PrimaryKeyColumns.ForEach(x =&gt; result.Add(x)); <span class="hljs-comment">// &lt;=</span><font></font>
<font></font>
  <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> fkCandidate <span class="hljs-keyword">in</span> Tables)
    <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> tableReference <span class="hljs-keyword">in</span> fkCandidate.References.Where(<font></font>
        x =&gt; x.Table == tableName &amp;&amp; x.Schema == tableSchema<font></font>
      )<font></font>
    )<font></font>
    {<font></font>
      tableReference.Columns.ForEach(x =&gt; result.Add(x));<font></font>
    }<font></font>
<font></font>
  <span class="hljs-keyword">return</span> result;<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分析器警告</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3146</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可能对'mainSchema'的null取消引用。 “ Tables.FirstOrDefault”可以返回默认的空值。 DatabaseSchema.cs（31）Raven.Server </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
乍一看，该</font><font style="vertical-align: inherit;">操作</font><font style="vertical-align: inherit;">似乎难以理解。确实，</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FirstOrDefault</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与</font><i><font style="vertical-align: inherit;">它</font></i><font style="vertical-align: inherit;">有什么关系</font><font style="vertical-align: inherit;">？为了弄清楚分析仪发誓的原因，您需要查看</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetTable</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数</font><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> TableSchema <span class="hljs-title">GetTable</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> schema, <span class="hljs-keyword">string</span> tableName</span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">return</span> Tables.FirstOrDefault(<font></font>
    x =&gt; x.Schema == schema &amp;&amp; x.TableName == tableName<font></font>
  );<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
调用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FirstOrDefault</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法</font><font style="vertical-align: inherit;">而不是</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">First的原因</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可能是由于该集合可能不包含与指定条件匹配的元素。在这种情况下，</font><font style="vertical-align: inherit;">由于</font><i><font style="vertical-align: inherit;">TableSchema</font></i><font style="vertical-align: inherit;">是引用类型</font><font style="vertical-align: inherit;">，因此</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FirstOrDefault</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetTable</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将返回</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。因此，PVS-Studio说在此代码中可能会尝试取消引用空指针。</font><font style="vertical-align: inherit;">
仍然值得检查这种情况，以使执行不会因</font><i><font style="vertical-align: inherit;">NullReferenceException</font></i><font style="vertical-align: inherit;">而中断</font><font style="vertical-align: inherit;">。如果</font><font style="vertical-align: inherit;">无法使用</font><i><font style="vertical-align: inherit;">Tables.FirstOrDefault</font></i><font style="vertical-align: inherit;">返回</font><i><font style="vertical-align: inherit;">null</font></i><font style="vertical-align: inherit;">的选项</font><font style="vertical-align: inherit;">，则使用时没有意义</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FirstOrDefault</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">而不是</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">First</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">始终为真</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">VerifyCanExecuteCommand</span>(<span class="hljs-params">
  ServerStore store, TransactionOperationContext context, <span class="hljs-keyword">bool</span> isClusterAdmin
</span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">using</span> (context.OpenReadTransaction())<font></font>
  {<font></font>
    <span class="hljs-keyword">var</span> read = store.Cluster.GetCertificateByThumbprint(context, Name);
    <span class="hljs-keyword">if</span> (read == <span class="hljs-literal">null</span>)
      <span class="hljs-keyword">return</span>;<font></font>
<font></font>
    <span class="hljs-keyword">var</span> definition = JsonDeserializationServer.CertificateDefinition(read);
    <span class="hljs-keyword">if</span> (<font></font>
      definition.SecurityClearance != SecurityClearance.ClusterAdmin || <span class="hljs-comment">// &lt;=</span>
      definition.SecurityClearance != SecurityClearance.ClusterNode     <span class="hljs-comment">// &lt;=</span><font></font>
    )<font></font>
      <span class="hljs-keyword">return</span>;<font></font>
  }<font></font>
<font></font>
  AssertClusterAdmin(isClusterAdmin);<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分析器警告</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3022</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表达式始终为true。</font><font style="vertical-align: inherit;">可能应在此处使用“ &amp;&amp;”运算符。</font><font style="vertical-align: inherit;">DeleteCertificateFromClusterCommand.cs（21）Raven.Server极</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
有可能选择了错误的逻辑运算符的情况的另一个示例。</font><font style="vertical-align: inherit;">在这种情况下，条件始终为true，因为变量绝对不等于至少一个与其进行比较的值之一。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我相信“ ||” </font><font style="vertical-align: inherit;">应该用“ &amp;&amp;”代替。</font><font style="vertical-align: inherit;">然后，书面内容将变得有意义。</font><font style="vertical-align: inherit;">如果仍然正确选择了逻辑运算符，则条件之一很可能应该是其他变量的比较。</font><font style="vertical-align: inherit;">无论如何，该片段看起来非常可疑，必须进行分析。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结论</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
首先，我要感谢到达这个地方的每个人。这篇文章很长，但是我希望您有兴趣与我一起了解PVS-Studio分析仪的新版本并研究发现的错误。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
重要的是要记住，开发人员应以不减少操作数量为主要目标。并非为了获得空的错误日志，您需要使用PVS-Studio。对抗积极分子就像对抗源代码所遭受的疾病的症状。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查看分析器消息时，应始终尝试理解为什么发出此警告。</font><font style="vertical-align: inherit;">只有通过实现分析仪发出警告的逻辑，我们才能得出结论，它表明是否存在错误。</font><font style="vertical-align: inherit;">在这种情况下，您不会与症状战斗，而是与疾病战斗。</font><font style="vertical-align: inherit;">这就是您的代码将变得更加干净和健康的方式。</font><font style="vertical-align: inherit;">当然，如此庞大的资源将会减少很多问题。</font><font style="vertical-align: inherit;">虽然更好，但我还是希望您不要使用它们：)</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/843/ca9/91e/843ca991e0e2688c6dc6a299fe3af231.png" alt="图片16"></div><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="></a></p><div style="text-align:center;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/eb2/f9c/3bb/eb2f9c3bb5f32f39239298d36431961c.png"></a></div><p></p><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果您想与说英语的人分享这篇文章，请使用以下链接：Nikita Lipilin。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如何在Linux和macOS下工作的C＃项目中发现错误</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN507086/index.html">将Bash脚本转换为C＃代码以通过USB调制解调器HUAWEI E3372发送短信</a></li>
<li><a href="../zh-CN507090/index.html">技术团队如何建立自己的创业公司，或者从功能监控到AIOps平台的道路</a></li>
<li><a href="../zh-CN507092/index.html">我们邀请您参加第二个在线mitap Zabbix</a></li>
<li><a href="../zh-CN507104/index.html">导入方面的巨大分歧：用Typescript澄清导入中的不确定性</a></li>
<li><a href="../zh-CN507106/index.html">如何通过HTTPS实施DNS</a></li>
<li><a href="../zh-CN507112/index.html">PayOnline | 互联网业务收购</a></li>
<li><a href="../zh-CN507114/index.html">Ode Excel：34年的魔法</a></li>
<li><a href="../zh-CN507116/index.html">“ Udalenka”。昨天办公室开发人员的笔记。第2部分</a></li>
<li><a href="../zh-CN507124/index.html">PDB不仅是宝贵的皮草</a></li>
<li><a href="../zh-CN507132/index.html">弗拉基米尔·基托夫（Vladimir Kitov）：“无法理解开创性科学家如何预见1950年代的通用计算机化！”</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>