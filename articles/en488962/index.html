<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚õëÔ∏è ‚ô•Ô∏è üë®üèª‚Äçüöí Can I write scripts in C ++? üêê üßìüèª ü•ñ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently I had to plunge again / again into the wonderful world of Linux script programming. In principle, the matter is not very tricky, but since I ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Can I write scripts in C ++?</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/488962/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/-7/xg/my/-7xgmyrtvd5lv6l5kws9xiaulvg.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Recently I had to plunge again / again into the wonderful world of Linux script programming. In principle, the matter is not very tricky, but since I come across such tasks not often, I study it again every time. I know for sure that tomorrow I will forget a lot and in a month I will google again how to do this or that. The problem still turns out that often you don‚Äôt write the script again, but you modify the existing one already written by someone. And it may not be bash, but sh or something else ... There are differences in the syntax, what works in sh should work in bash, but not always the other way around. And if there is dash or ash? I don‚Äôt know ... There are still differences in these scripting languages, and they are confusing. And of course, for me personally, the cherry on the cake when the script calls some sed or awk and there are such parameters on the command line that you look at them and wonder.It is clear that this all depends on the qualifications of the programmer, but not everything fits in my head. And now my patience is gone and I thought that from now on I want to try writing scripts in c ++ ...</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I understand that for true system administrator, my thought may seem seditious. </font><font style="vertical-align: inherit;">But why not?</font></font><a name="habracut"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So the idea is very simple. </font><font style="vertical-align: inherit;">I want to write c ++ scripts in the same way as regular scripts are written, that is, the first line of the script should contain shebang and an indication of the path to the "interpreter":</font></font><br>
<br>
<pre><code class="plaintext hljs">#!/bin/c++</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The subsequent lines of the script will be just a regular c ++ program. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I have to prepare the "interpreter" of the c ++ script. </font><font style="vertical-align: inherit;">You can write it on anything, at least on bash (this is the last time, although not exactly). </font><font style="vertical-align: inherit;">Of course, it will not be an interpreter, but a compiler. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
That's what I did:</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-meta">#!/bin/bash
</span><font></font>
msg_file=/dev/null<font></font>
<span class="hljs-comment">#msg_file=/dev/stdout</span><font></font>
<font></font>
tmp_path=<span class="hljs-variable">$HOME</span><span class="hljs-string">"/.cache/c++/"</span>
mkdir -p <span class="hljs-variable">$tmp_path</span>
tmp_file=<span class="hljs-variable">$1</span><span class="hljs-string">".c++"</span>
exe_file=<span class="hljs-variable">$1</span><span class="hljs-string">".bin"</span>
<span class="hljs-keyword">if</span> <span class="hljs-built_in">test</span> <span class="hljs-variable">$1</span> -nt  <span class="hljs-variable">$tmp_path</span><span class="hljs-variable">$exe_file</span>; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Need to recompile.."</span> &gt; <span class="hljs-variable">$msg_file</span>
    tail -n +2 <span class="hljs-variable">$1</span> &gt; <span class="hljs-variable">$tmp_path</span><span class="hljs-variable">$tmp_file</span>
    <span class="hljs-built_in">eval</span> <span class="hljs-string">"g++ -o <span class="hljs-variable">$tmp_path</span><span class="hljs-variable">$exe_file</span> <span class="hljs-variable">$tmp_path</span><span class="hljs-variable">$tmp_file</span> &gt; /dev/null 2&gt;&amp;1"</span>
    <span class="hljs-keyword">if</span> [ $? -eq 0 ]
    <span class="hljs-keyword">then</span>
	<span class="hljs-built_in">echo</span> <span class="hljs-string">"Compiled ok"</span> &gt; <span class="hljs-variable">$msg_file</span>
    <span class="hljs-keyword">else</span>
	<span class="hljs-built_in">echo</span> <span class="hljs-string">"Compile error"</span> &gt; <span class="hljs-variable">$msg_file</span>
	<span class="hljs-built_in">exit</span> 255
    <span class="hljs-keyword">fi</span>
<span class="hljs-keyword">fi</span>
<span class="hljs-built_in">eval</span> <span class="hljs-string">"<span class="hljs-variable">$tmp_path</span><span class="hljs-variable">$exe_file</span> <span class="hljs-variable">$@1</span>"</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This script does everything you need. As the temporary folder, I chose the ~ / .cache / c ++ folder. The original script will be copied to this folder, but without the first line with shebang. This is done by the tail command. The name of the new file will be like the original script, but with the extension c ++. The binary with the extension .bin will be collected in the same folder. But first, of course, an ‚Äúif test‚Äù check is done at the time the binary is created. Compilation occurs only if the existing binary is outdated in time with respect to the original ‚Äúscript‚Äù. The binary is launched with the eval command and all initial parameters are passed to it. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This c ++ file needs to be copied to the / bin folder and made it executable (chmod a + x). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I‚Äôll try to write my first ‚Äúc ++ script‚Äù:</font></font><br>
<br>
<pre><code class="cpp hljs">#!/bin/c++<font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span><font></font>
<font></font>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">( <span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> *argv[] )</span>
</span>{
    <span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"hello world!\n"</span>;
    <span class="hljs-keyword">for</span>( <span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>; i&lt;argc; i++)<font></font>
    {<font></font>
	<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"Param"</span> &lt;&lt; i &lt;&lt;  <span class="hljs-string">" is "</span> &lt;&lt; argv[i] &lt;&lt; <span class="hljs-string">"\n"</span>;<font></font>
    }<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-number">60</span>+argc;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This program simply prints a list of input parameters and returns their number + 60. I </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
run my "script": </font></font><br>
<br>
<img src="https://habrastorage.org/webt/1y/0c/ks/1y0cksrwf2niluhqf-adbf2cfwy.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It works !!! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you make an error in c ++ code, the program will not start, since it will not compile, but echo $? will return 255. But that was what was intended. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Using c ++ provides tremendous opportunities. First, the familiar syntax. Secondly, standard classes like std :: vector, std :: map or std :: string and others are irreplaceable things. The same line - whatever you want to do with it, look in the line, break it into substrings, disconnect and conquer, get arrays. And I do not need either sed or awk. Thirdly, the debugger - God! what a blessing! I have a gdb debugger for the script! Further, you can use std :: filesystem (if the compiler allows). You can go on ...</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unfortunately, it often happens with me that I will do it first, and then I will think: ‚Äúwhat if someone has already done this?‚Äù </font><font style="vertical-align: inherit;">And in fact, I am not the first to come up with the idea to do the same. </font><font style="vertical-align: inherit;">Here is an example: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://github.com/dimgel/cpp-linux-scripts the</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> idea is the same, the implementation is different. </font><font style="vertical-align: inherit;">Then it turned out that there are </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">other implementations</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In general, I experienced a slight disappointment in my own non-exclusivity. </font><font style="vertical-align: inherit;">However, I looked for Habr - I did not find a similar one. </font><font style="vertical-align: inherit;">Maybe someone seems at least curious?</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en488952/index.html">Phrase sentiment analysis using neural networks</a></li>
<li><a href="../en488954/index.html">How to explain your point of view to the robot</a></li>
<li><a href="../en488956/index.html">Organization of documentation and translation, for example, iondv. framework</a></li>
<li><a href="../en488958/index.html">Transcript of my interview with Ruby author</a></li>
<li><a href="../en488960/index.html">Programming, Immunity and the Army</a></li>
<li><a href="../en488964/index.html">Urgent tasks. May the Savior come</a></li>
<li><a href="../en488966/index.html">Ansible playbooks is a code: we check, test, continuously integrate. Ivan Ponomarev</a></li>
<li><a href="../en488968/index.html">Simple detection of performance problems in PostgreSQL</a></li>
<li><a href="../en488982/index.html">S905X processor (secured boot) software security overview</a></li>
<li><a href="../en488984/index.html">‚ÄúIf sites work better, it will be perfect‚Äù: interview with Playwright developer Andrey Lushnikov</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>