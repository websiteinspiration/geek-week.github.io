<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë§ üë©üèæ‚Äçüç≥ üÖøÔ∏è Creating roguelike in Unity from scratch ü¶ì üê≠ üò≤</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="There are not many tutorials on creating roguelike in Unity, so I decided to write it. Not to boast, but to share knowledge with those who are at the ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Creating roguelike in Unity from scratch</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/490828/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ad4/093/6ab/ad40936ab0dff25fd3214571faf9aa61.png" alt="image"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There are not many tutorials on creating roguelike in Unity, so I decided to write it. Not to boast, but to share knowledge with those who are at the stage at which I was already quite a while. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Note: I am not saying that this is the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">only</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> way to create a roguelike in Unity. He is just </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">one of</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Probably not the best and most effective, I learned through trial and error. And I will learn some things right in the process of creating a tutorial. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Let's assume that you </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">know at least the basics of Unity</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, for example, how to create a prefab or script, and the like. </font><font style="vertical-align: inherit;">Do not expect me to teach you how to create sprite sheets, there are many great tutorials about this. </font><font style="vertical-align: inherit;">I will focus not on studying the engine, but on how to implement the game that we will create together. </font><font style="vertical-align: inherit;">If you run into difficulties, head over to one of Discord's awesome communities and ask for help: </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unity Developer Community </font></font></a><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Roguelikes</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
So, let's get started!</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Stage 0 - planning</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Yes that's right. The first thing to create is a plan. It will be good for you to plan the game, and for me - to plan the tutorial so that after a while we will not be distracted from the topic. It‚Äôs easy to get confused in the game‚Äôs functions, just like in the roguelike dungeons. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We will write roguelike. We will mainly follow the wise advice of Cogmind developer Josh Ge </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Follow the link, read the post or watch the video, and then come back.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
What is the purpose of this tutorial? Get a solid simple basic roguelike, with which you can then experiment. It should have dungeon generation, a player moving on the map, visibility fog, enemies and objects. Only the most necessary. So, the player should be able to go down the stairs several floors. let's say, by five, increase your level, improve, and at the end fight with the boss and defeat him. Or die. That, in fact, is all.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Following the advice of Josh Ge, we will build the functions of the game so that they lead us to the goal. </font><font style="vertical-align: inherit;">So we get the roguelike framework, which can be further expanded, add your own chips, creating uniqueness. </font><font style="vertical-align: inherit;">Or throw everything in the basket, take advantage of the experience gained and start over from scratch. </font><font style="vertical-align: inherit;">It will be awesome anyway. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I will not give you any graphic resources. </font><font style="vertical-align: inherit;">Draw them yourself or use the free tilesets, which can be downloaded </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> or by searching in Google. </font><font style="vertical-align: inherit;">Just do not forget to mention the authors of the graphics in the game. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now let's list all the functions that will be in our roguelike in the order of their implementation:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dungeon Map Generation</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Player character and his movement</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Area of ‚Äã‚Äãvisibility</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Enemies</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Search for a way</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fight, Health, and Death</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Player Level Up</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Items (weapons and potions)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Console cheats (for testing)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dungeon floors</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Saving and loading</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Final boss</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After implementing all this, we will have a strong roguelike, and you will greatly boost your game development skills. </font><font style="vertical-align: inherit;">Actually, it was </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">my</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> way to improve </font><em><font style="vertical-align: inherit;">my</font></em><font style="vertical-align: inherit;"> skills: creating code and implementing functions. </font><font style="vertical-align: inherit;">Therefore, I am sure that you can handle this as well.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Stage 1 - MapManager Class</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This is the first script we will create and it will become the backbone of our game. </font><font style="vertical-align: inherit;">It is simple, but contains the bulk of the important information for the game. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So, create a .cs script called MapManager and open it. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Delete ": MonoBehaviour" because it will not inherit from it and will not be attached to any GameObject. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Remove the Start () and Update () functions. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
At the end of the MapManager class, create a new public class called Tile.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/431/54e/4c2/43154e4c2708a580bc3838b1fbee573b.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The Tile class will contain all the information of a single tile. </font><font style="vertical-align: inherit;">So far, we do not need much, only x and y positions, as well as a game object located in this position of the map.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/405/21e/cd9/40521ecd9e1292e813391181e523b6dc.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So, we have basic tile information. </font><font style="vertical-align: inherit;">Let's create a map from this tile. </font><font style="vertical-align: inherit;">It's simple, we only need a two-dimensional array of Tile objects. </font><font style="vertical-align: inherit;">It sounds complicated, but there is nothing special about it. </font><font style="vertical-align: inherit;">Simply add the Tile [,] variable to the MapManager class:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f44/2e8/806/f442e88061e77cbbb4c1aa904c73bdfd.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voila! </font><font style="vertical-align: inherit;">We have a map! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Yes, it is empty. </font><font style="vertical-align: inherit;">But this is a map. </font><font style="vertical-align: inherit;">Each time something moves or changes state on the map, the information on this map will be updated. </font><font style="vertical-align: inherit;">That is, if, for example, a player tries to switch to a new tile, the class will check the destination tile address on the map, the presence of the enemy and its patency. </font><font style="vertical-align: inherit;">Thanks to this, we don‚Äôt have to check thousands of collisions at each turn, and we don‚Äôt need colliders for each game object, which will facilitate and simplify the work with the game. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The resulting code looks like this:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">using</span> System.Collections;
<span class="hljs-keyword">using</span> System.Collections.Generic;
<span class="hljs-keyword">using</span> UnityEngine;<font></font>
<font></font>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">MapManager</span> <font></font>
{<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Tile[,] map; <span class="hljs-comment">// the 2-dimensional map with the information for all the tiles</span><font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Tile</span> { <span class="hljs-comment">//Holds all the information for each tile on the map</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> xPosition; <span class="hljs-comment">// the position on the x axis</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> yPosition; <span class="hljs-comment">// the position on the y axis</span>
    <span class="hljs-keyword">public</span> GameObject baseObject; <span class="hljs-comment">// the map game object attached to that position: a floor, a wall, etc.</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The first stage is completed, let's move on to filling out the card. </font><font style="vertical-align: inherit;">Now we will begin to create a dungeon generator.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Stage 2 - a couple of words about the data structure</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But before you begin, let me share the tips that have arisen thanks to the feedback received after the publication of the first part. When creating a data structure, you need to think from the very beginning how you will maintain the state of the game. Otherwise, later it will be much more chaotic. The user of Discord st33d, the developer of Star Shaped Bagel (you can play this game for free </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), said that at first he created the game, thinking that it would not save states at all. Gradually, the game began to get bigger, and her fan asked for support for the saved map. But because of the chosen method of creating the data structure, it was very difficult to save the data, so he was not able to do this.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/82c/b02/858/82cb02858af686ef409ad8a6c0496135.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We really learn from our mistakes. Despite the fact that I put the save / load part at the end of the tutorial, I think through them from the very beginning, and just haven‚Äôt explained them yet. In this part I will talk a little about them, but so as not to overload inexperienced developers. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We will save such things as an array of variables of the Tile class in which the map is stored. We will save all this data, except for the variables of the GameObject class, which are inside the Tile class. Why? Just because GameObjects cannot be serialized with Unity to stored data.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Therefore, in fact, we do not need to save the data stored inside GameObjects. All data will be stored in classes such as Tile, and later also Player, Enemy, etc. Then we will have GameObjects to simplify the calculation of such things as visibility and movement, as well as drawing sprites on the screen. Therefore, within the classes there will be GameObject variables, but the value of these variables will not be saved and loaded. When loading, we will force to generate GameObject again from the saved data (position, sprite, etc.). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Then what do we need to do right now? Well, just add two lines to the existing Tile class and one to the top of the script. First we add ‚Äúusing System;‚Äù to the script title, and then [Serializable] in front of the whole class and [NonSerialized] right in front of the GameObject variable. Like this:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bfd/931/aa3/bfd931aa3a4a1b2b7792650cc25cba07.png"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a2e/178/9d3/a2e1789d3663b1530d64d3d900c7f047.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I‚Äôll tell you more about this when we get to the part of the tutorial on saving / loading. </font><font style="vertical-align: inherit;">For now, let‚Äôs leave it all and move on.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Stage 3 - a little more about the data structure</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I got another review on the data structure that I want to share here.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In fact, there are many ways to implement data in a game. The first one I use and which will be implemented in this tutorial: all the tile data is in the Tile class, and all of them are stored in an array. This approach has many advantages: it is easier to read, everything you need is in one place, data is easier to manipulate and export to a save file. But from the point of view of memory, it is not so effective. You will have to allocate a lot of memory for variables that will never be used in the game. For example, later we will put the Enemy GameObject variable in the Tile class so that we can point directly from the map to the GameObject of the enemy standing on this tile to simplify all calculations related to the battle. But this will mean that each tile in the game will have allocated space in memory for the GameObject variable,even if there is no enemy on this tile. If there are 10 enemies on a map of 2500 tiles, then there will be 2490 empty, but allocated GameObject variables - you can see how much memory is wasted.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
An alternative method would be to use structures to store the basic data of tiles (for example, position and type), and all other data would be stored in hashmap-s, which would be generated only if necessary. </font><font style="vertical-align: inherit;">This would save a lot of memory, but the payback would be a slightly more complicated implementation. </font><font style="vertical-align: inherit;">Actually it would be a little more advanced than I would like in this tutorial, but if you want, then in the future I can write a more detailed post about it. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In addition, if you want to read a discussion of this topic, then this can be done </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">on Reddit</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Stage 4 - Dungeon Generation Algorithm</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Yes, this is another section in which I will talk and we will not begin to program anything. But this is important, careful planning of algorithms will save us a lot of working time in the future. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There are several ways to create a dungeon generator. The one that we will implement together is not the best and not the most effective ... it's just an easy, initial way. It is very simple, but the results will be quite good. The main problem will be many dead end corridors. Later, if you want, I can publish another tutorial on better algorithms.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In general, the algorithm we use works as follows: let's say we have a whole map filled with zero values ‚Äã‚Äã- a level consisting of a stone. </font><font style="vertical-align: inherit;">At the beginning we cut out a room in the center. </font><font style="vertical-align: inherit;">From this room we break through the corridor in one direction, and then add other corridors and rooms, always starting randomly from an existing room or corridor, until we reach the maximum number of corridors / rooms given at the very beginning. </font><font style="vertical-align: inherit;">Or until the algorithm can find a new place to add a new room / corridor, whichever comes first. </font><font style="vertical-align: inherit;">And so we get a dungeon.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So, let's describe this in a more algorithm-like way, step by step. </font><font style="vertical-align: inherit;">For convenience, I will call each detail of the map (corridor or room) an element so that I do not have to say ‚Äúroom / corridor‚Äù every time.</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cut the room in the center of the map</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Randomly select one of the walls</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We break through the corridor in this wall</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Randomly select one of the existing elements.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Randomly select one of the walls of this element</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If the last selected item is a room, then we generate a corridor. </font><font style="vertical-align: inherit;">If the corridor, then randomly choose whether the next element will be a room or another corridor</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Check if there is enough space in the selected direction to create the desired item</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If there is a place, create an element, if not, return to step 4</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Repeat from step 4</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
That's all. </font><font style="vertical-align: inherit;">We will get a simple map of the dungeon, in which there are only rooms and corridors, without doors and special elements, but this will be our beginning. </font><font style="vertical-align: inherit;">Later we will fill it with chests, enemies and traps. </font><font style="vertical-align: inherit;">And you can even customize it: we will learn how to add interesting elements you need.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Stage 5 - cut out the room</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Finally proceed to the coding! </font><font style="vertical-align: inherit;">Let's cut our first room. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
First, create a new script and call it DungeonGenerator. </font><font style="vertical-align: inherit;">It will inherit from Monobehaviour, so you will need to attach it to GameObject later. </font><font style="vertical-align: inherit;">Then we will need to declare several public variables in the class so that we can set the parameters of the dungeon from the inspector. </font><font style="vertical-align: inherit;">These variables will be the width and height of the map, the minimum and maximum height and width of the rooms, the maximum length of the corridors and the number of elements that should be on the map.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/120/331/04d/12033104d1f3fcf270fdc5fd64ffb6bb.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Next we need to initialize the dungeon generator. We do this to initialize the variables that will be populated by the generation. For now, this will be just a map. And, and also delete the Start () and Update () functions that Unity generates for the new script, we will not need them.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f92/a8f/e5d/f92a8fe5dc2ea241284fe95b8758c289.png"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ad7/841/44b/ad784144b6aeea6aee3967caedaa37eb.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Here we initialized the map variable of the MapManager class (which we created in the previous step), passing the width and height of the map, defined by the variables above as parameters of the two dimensions of the array. Thanks to this, we will have a map of horizontal x size (width) and vertical y size (height), and we can access any cell in the map by entering MapManager.map [x, y]. This will be very useful when manipulating the position of objects. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now we will create a function to render the first room. We will call it FirstRoom (). We made InitializeDungeon () a public function, because it will be launched by another script (Game Manager, which we will create shortly; it will centralize the management of the entire game launch process). We do not need any external scripts to have access to FirstRoom (), so we do not make it public.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now, to continue, we will create three new classes in the MapManager script so that you can create a room. These are the Feature, Wall, and Position classes. The Position class will contain the x and y positions so that we can track where everything is. The wall will have a list of positions, the direction in which it ‚Äúlooks‚Äù relative to the center of the room (north, south, east or west), length, and the presence of a new element created from it. The element will have a list of all the positions that it consists of, the type of the element (room or corridor), an array of Wall variables, and its width and height.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3b7/abe/924/3b7abe9241bb1442f3224048384263ff.png"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/938/8bc/8d7/9388bc8d7dd523b45013fa80d918d8a2.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now let's get to the FirstRoom () function. </font><font style="vertical-align: inherit;">Let's go back to the DungeonGenerator script and create a function right below InitializeDungeon. </font><font style="vertical-align: inherit;">She will not need to receive any parameters, so we will leave it simple (). </font><font style="vertical-align: inherit;">Next, inside the function, we first need to create and initialize the Room variable and its list of Position variables. </font><font style="vertical-align: inherit;">We do it like this:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/164/b81/b5d/164b81b5dde06f8e996e22a75bf0b947.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now let's set the size of the room. </font><font style="vertical-align: inherit;">It will receive a random value between the minimum and maximum height and width declared at the beginning of the script. </font><font style="vertical-align: inherit;">While they are empty, because we did not set a value for them in the inspector, but do not worry, we will do it soon. </font><font style="vertical-align: inherit;">We set random values ‚Äã‚Äãlike this:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d77/bbd/389/d77bbd3896dc4c60d93a9e6b1c006729.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Next, we need to declare where the starting point of the room will be located, that is, where the point of room 0.0 will be located in the map grid. We want to make it start in the center of the map (half width and half height), but maybe not </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exactly</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in the center. It might be worth adding a small randomizer so that it moves slightly left and down. Therefore, we set xStartingPoint as half the width of the map, and yStartingPoint as half the height of the map, and then take the just given roomWidth and roomHeight, we get a random value from 0 to this width / height, and subtract it from the initial x and y. Like this:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/50f/3f2/f0e/50f3f2f0ecb267d5283dcd4684019708.png"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8eb/0e7/f2b/8eb0e7f2bff7d3d08b1b0691885e89cd.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Next, in the same function we will add walls. We need to initialize the array of walls that are in the newly created room variable, and then initialize each wall variable inside this array. And then initialize each list of positions, set the length of the wall to 0 and enter the direction in which each wall will ‚Äúlook‚Äù. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After the array is initialized, we loop around each element of the array in the for () loop, initialize the variables of each wall, and then use the switch, which names the direction of each wall. It is chosen arbitrarily, we only need to remember what they will mean.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d3a/f8f/9da/d3af8f9da1ee8f317452d52f9f905536.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now we will execute two nested for loops immediately after placing the walls. </font><font style="vertical-align: inherit;">In the outer loop, we go around all the y values ‚Äã‚Äãin the room, and in the nested loop, all the x values. </font><font style="vertical-align: inherit;">This way we will check each cell x in row y so that we can implement it.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3ee/cb3/695/3eecb3695c59d199fb32064501ce1009.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Then the first thing to do is to find the real value of the cell position on the map scale from the room position. </font><font style="vertical-align: inherit;">This is pretty simple: we have the starting points x and y. </font><font style="vertical-align: inherit;">They will be position 0,0 in the grid of the room. </font><font style="vertical-align: inherit;">Then if we need to get the real value of x, y from any local x, y, then we add the local x and y with the initial positions x and y. </font><font style="vertical-align: inherit;">Then we save these real x, y values ‚Äã‚Äãto the Position variable (from a previously created class), and then add them to the List &lt;&gt; of the room‚Äôs positions.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0b2/cc4/4a0/0b2cc44a0ae9953a3d49ac0b3c01a6c9.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The next step is to add this information to the map. </font><font style="vertical-align: inherit;">Before changing the values, remember to initialize the Tile variable.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1aa/fe5/a43/1aafe5a43a8c30f2c343472ad7f157ca.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now we will make a change to the Tile class. </font><font style="vertical-align: inherit;">Let's go to the MapManager script and add one line to the definition of the Tile class: ‚Äúpublic string type;‚Äù. </font><font style="vertical-align: inherit;">This will allow us to add a tile class by declaring that the tile in x, y is a wall, floor, or something else. </font><font style="vertical-align: inherit;">Next, let's go back to the cycle in which we did the work and add a big if-else construct, which will allow us not only to determine each wall, its length and all positions in this wall, but also to specify on the global map what a specific tile is - a wall or gender.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7c3/276/28c/7c327628cea73dafe9319a01ac10b72b.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And we have already done something. If the variable y (control of the variable in the outer loop) is 0, then the tile belongs to the lowest row of cells in the room, that is, it is the south wall. If x (control of the inner loop variable) is 0, then the tile belongs to the leftmost column of cells, that is, it is the western wall. And if it is on the very top line, then it belongs to the north wall, and in the very right - the east wall. We subtract 1 from the variables roomWidth and roomHeight, because these values ‚Äã‚Äãwere calculated starting from 1, and the x and y variables of the cycle started from 0, so this difference must be taken into account. And all cells that do not meet the conditions are not walls, that is, they are the floor.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/258/4a6/2c9/2584a62c91fc46205f903cb4283bd1ce.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Great, we are almost done with the first room. </font><font style="vertical-align: inherit;">It is almost ready, we only need to put the last values ‚Äã‚Äãin the variable Feature we created. </font><font style="vertical-align: inherit;">We exit the loop and end the function like this:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2bd/aaf/a47/2bdaafa47adb2694f360eea850341920.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fine! </font><font style="vertical-align: inherit;">We have a room! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But how do we understand that everything works? </font><font style="vertical-align: inherit;">Need to test. </font><font style="vertical-align: inherit;">But how to test? </font><font style="vertical-align: inherit;">We can spend time and add assets for this, but it will be a waste of time and too distract us from completing the algorithm. </font><font style="vertical-align: inherit;">Hmm, but this can be done using ASCII! </font><font style="vertical-align: inherit;">Yes, great idea! </font><font style="vertical-align: inherit;">ASCII is a simple and low-cost way to draw a map so that it can be tested. </font><font style="vertical-align: inherit;">Also, if you wish, you can skip the part with sprites and visual effects, which we will study later, and create your entire game in ASCII. </font><font style="vertical-align: inherit;">So let's see how this is done.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Stage 6 - drawing the first room</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The first thing to think about when implementing an ASCII card is which font to choose. The main factor to consider when choosing a font for ASCII is whether it is proportional (variable width) or monospaced (fixed width). We need a monospace font so that the cards look as needed (see example below). By default, any new Unity project uses the Arial font, and it is not monospaced, so we need to find another. Windows 10 typically has monospaced fonts Courier New, Consolas, and Lucida Console. Choose one of these three or download any other in the place you need and place it in the Fonts folder inside the Assets folder of the project.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ff4/beb/f23/ff4bebf23a4523f4dd348524ac6b0a9f.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Let's prepare the scene for ASCII output. For starters, make the background color of the main camera of the scene black. Then we add the Canvas object to the scene, and add the Text object to it. Set the transform of the Text rectangle to middle center and to the position 0,0,0. Set the Text object so that it uses the font you selected and the white color, we select Overflow for horizontal and vertical overflow (horizontal / vertical overflow), and center the vertical and horizontal alignment. Then rename the Text object to ‚ÄúASCIITest‚Äù or something similar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now back to the code. In the DungeonGenerator script, create a new function called DrawMap. We want her to get a parameter telling which card to generate - ASCII or sprite, so create a boolean parameter and call it isASCII.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/387/67a/957/38767a9575270115821d6be36ce97293.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Then we will check if the rendered map is ASCII. </font><font style="vertical-align: inherit;">If yes (for now, we will consider only this case), then we will search for a text object in the scene, pass the name given to it as a parameter, and get its Text component. </font><font style="vertical-align: inherit;">But first, we need to tell Unity that we want to work with the UI. </font><font style="vertical-align: inherit;">Add the line using UnityEngine.UI to the script header:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/17c/e18/c24/17ce18c24ec7c286b4390159dc98dab1.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fine. </font><font style="vertical-align: inherit;">Now we can get the Text component of the object. </font><font style="vertical-align: inherit;">The map will be a huge line, which is reflected on the screen as text. </font><font style="vertical-align: inherit;">That is why it is so easy to set up. </font><font style="vertical-align: inherit;">So let's create a string and initialize it with the value "".</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6d2/7f2/92c/6d27f292c1f519a7b351d7b8d80a8f84.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fine. So, each time DrawMap is called, we will need to inform whether the card is an ASCII. If this is so (and we will always have it this way, we will work with else later), then the function will search the scene hierarchy in search of a gameobject called ‚ÄúASCIITest‚Äù. If it is, then it will receive its Text component and save it to the screen variable, into which we can then easily write the map. Then it creates a string whose value is initially empty. We will fill this line with our map marked with symbols.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Usually we go around the map in a loop, starting at 0 and going to the end of its length. </font><font style="vertical-align: inherit;">But to fill the line, we start with the first line of text, that is, the topmost line. </font><font style="vertical-align: inherit;">Therefore, on the y axis, we need to move in a loop in the opposite direction, going from the end to the beginning of the array. </font><font style="vertical-align: inherit;">But the x-axis of the array goes from left to right, just like the text, so this suits us.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/536/019/f47/536019f479ea1af260d551f342ed46aa.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In this cycle, we check each cell of the map to find out what is in it. </font><font style="vertical-align: inherit;">So far, we have only initialized the cells as a new Tile (), which we cut out for the room, so everyone else will return an error when trying to access. </font><font style="vertical-align: inherit;">So first we need to check </font><font style="vertical-align: inherit;">if </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">there</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> is anything in this cell, and we do this by checking the cell for null. </font><font style="vertical-align: inherit;">If it is not null, then we continue to work, but if it is null, then there is nothing inside, so we can add empty space to the map.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3f3/f56/5d9/3f3f565d9e9f7886c3baa600cd1ab99f.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So, for each non-empty cell, we check its type, and then add the corresponding symbol. </font><font style="vertical-align: inherit;">We want the walls to be indicated by the symbol "#" and the floors to be indicated by the ".". </font><font style="vertical-align: inherit;">And while we have only these two types. </font><font style="vertical-align: inherit;">Later, when we add the player, monsters and traps, everything will be a little more complicated.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f9f/a24/ef0/f9fa24ef002860f5331479f9ac07a6e8.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In addition, we need to perform line breaks when reaching the end of the array row, so that cells with the same x position are directly under each other. </font><font style="vertical-align: inherit;">We will check at each iteration of the loop whether the cell is the last in the row, and then add a line break with the special character "\ n".</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c14/7b8/1eb/c147b81eb1f4efa01bafdfa8a4aa092d.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
That's all. </font><font style="vertical-align: inherit;">Then we exit the loop so that we can add this line after completion to the text object in the scene.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/20f/8bb/f4d/20f8bbf4d1c8e5b59afc3163a97d57bb.png"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fcb/83f/a7f/fcb83fa7f923ec53e33696bb8962a1d9.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Congratulations! You have completed the script that creates the room and displays it on the screen. Now we just need to put these lines into action. We do not use Start () in the DungeonGenerator script, because we want to have a separate script to control everything that is performed at the beginning of the game, including generating the map, but also setting up the player, enemies, etc. Therefore, this other script will contain the Start () function, and, if necessary, will call the functions of our script. The DungeonGenerator script has an Initialize function, which is public, and FirstRoom and DrawMap are not public. Initialize simply initializes the variables to configure the dungeon generation process, so we need another function that calls the generation process, which must be public so that it can be called from other scripts.For now, she will only call the FirstRoom () function, and then the DrawMap () function, passing it a true value so that she draws an ASCII map. Oh, or not, it's even better - let's create a public variable isASCII, which can be included in the inspector, and just pass this variable as a parameter to the function. Fine.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c58/288/502/c58288502f107440def4f803d602662b.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So, now let's create a GameManager script. </font><font style="vertical-align: inherit;">It will be the very script that controls all the high-level elements of the game, for example, creating a map and the course of moves. </font><font style="vertical-align: inherit;">Let's remove the Update () function in it, add a variable of the DungeonGenerator type called dungeonGenerator, and create an instance of this variable in the Start () function.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e5b/8da/424/e5b8da4243c91f887c08213b9ec14953.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After that, we simply call the InitializeDungeon () and GenerateDungeon () functions from the dungeonGenerator, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in that order</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">This is important - first you need to initialize the variables, and only after that start building on their basis.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/158/7e6/781/1587e6781595d0ee6661aea7898aa6e4.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
On this part with the code is completed. </font><font style="vertical-align: inherit;">We need to create an empty game object in the hierarchy panel, rename it to GameManager and attach the GameManager and DungeonGenerator scripts to it. </font><font style="vertical-align: inherit;">And then set the values ‚Äã‚Äãof the dungeon generator in the inspector. </font><font style="vertical-align: inherit;">You can try different schemes for the generator, and I settled on this:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a11/41f/495/a1141f4953a6fdeac32cc978ac4a0b05.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now just click on play and watch the magic! </font><font style="vertical-align: inherit;">You should see something similar on the game screen:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ad4/093/6ab/ad40936ab0dff25fd3214571faf9aa61.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Congratulations, we now have a room! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I wanted us to put the player‚Äôs character there and make him move, but the post was already quite long. </font><font style="vertical-align: inherit;">Therefore, in the next part, we can proceed directly to the implementation of the rest of the dungeon algorithm, or we can place the player in it and teach it how to move. </font><font style="vertical-align: inherit;">Vote what you like best in the comments to the original article. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MapManager.cs:</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">using</span> System.Collections;
<span class="hljs-keyword">using</span> System; <span class="hljs-comment">// So the script can use the serialization commands</span>
<span class="hljs-keyword">using</span> System.Collections.Generic;
<span class="hljs-keyword">using</span> UnityEngine;<font></font>
<font></font>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">MapManager</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Tile[,] map; <span class="hljs-comment">// the 2-dimensional map with the information for all the tiles</span><font></font>
}<font></font>
<font></font>
[<span class="hljs-meta">Serializable</span>] <span class="hljs-comment">// Makes the class serializable so it can be saved out to a file</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Tile</span> { <span class="hljs-comment">// Holds all the information for each tile on the map</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> xPosition; <span class="hljs-comment">// the position on the x axis</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> yPosition; <span class="hljs-comment">// the position on the y axis</span>
    [<span class="hljs-meta">NonSerialized</span>]
    <span class="hljs-keyword">public</span> GameObject baseObject; <span class="hljs-comment">// the map game object attached to that position: a floor, a wall, etc.</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> type; <span class="hljs-comment">// The type of the tile, if it is wall, floor, etc</span><font></font>
}<font></font>
<font></font>
[<span class="hljs-meta">Serializable</span>]
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Position</span> { <span class="hljs-comment">//A class that saves the position of any cell</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> x;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> y;<font></font>
}<font></font>
<font></font>
[<span class="hljs-meta">Serializable</span>]
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Wall</span> { <span class="hljs-comment">// A class for saving the wall information, for the dungeon generation algorithm</span>
    <span class="hljs-keyword">public</span> List&lt;Position&gt; positions;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> direction;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> length;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">bool</span> hasFeature = <span class="hljs-literal">false</span>;<font></font>
}<font></font>
<font></font>
[<span class="hljs-meta">Serializable</span>]
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Feature</span> { <span class="hljs-comment">// A class for saving the feature (corridor or room) information, for the dungeon generation algorithm</span>
    <span class="hljs-keyword">public</span> List&lt;Position&gt; positions;
    <span class="hljs-keyword">public</span> Wall[] walls;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> type;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> width;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> height;<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DungeonGenerator.cs:</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">using</span> System.Collections;
<span class="hljs-keyword">using</span> System.Collections.Generic;
<span class="hljs-keyword">using</span> UnityEngine;
<span class="hljs-keyword">using</span> UnityEngine.UI;<font></font>
<font></font>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">DungeonGenerator</span> : <span class="hljs-title">MonoBehaviour</span><font></font>
{<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> mapWidth;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> mapHeight;<font></font>
<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> widthMinRoom;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> widthMaxRoom;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> heightMinRoom;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> heightMaxRoom;<font></font>
<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> maxCorridorLength;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> maxFeatures;<font></font>
<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">bool</span> isASCII;<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">InitializeDungeon</span>(<span class="hljs-params"></span>)</span> {<font></font>
        MapManager.map = <span class="hljs-keyword">new</span> Tile[mapWidth, mapHeight];<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">GenerateDungeon</span>(<span class="hljs-params"></span>)</span> {<font></font>
        FirstRoom();<font></font>
        DrawMap(isASCII);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">FirstRoom</span>(<span class="hljs-params"></span>)</span> {<font></font>
        Feature room = <span class="hljs-keyword">new</span> Feature();<font></font>
        room.positions = <span class="hljs-keyword">new</span> List&lt;Position&gt;();<font></font>
<font></font>
        <span class="hljs-keyword">int</span> roomWidth = Random.Range(widthMinRoom, widthMaxRoom);
        <span class="hljs-keyword">int</span> roomHeight = Random.Range(heightMinRoom, heightMaxRoom);<font></font>
<font></font>
        <span class="hljs-keyword">int</span> xStartingPoint = mapWidth / <span class="hljs-number">2</span>;
        <span class="hljs-keyword">int</span> yStartingPoint = mapHeight / <span class="hljs-number">2</span>;<font></font>
<font></font>
        xStartingPoint -= Random.Range(<span class="hljs-number">0</span>, roomWidth);<font></font>
        yStartingPoint -= Random.Range(<span class="hljs-number">0</span>, roomHeight);<font></font>
<font></font>
        room.walls = <span class="hljs-keyword">new</span> Wall[<span class="hljs-number">4</span>];<font></font>
<font></font>
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; room.walls.Length; i++) {<font></font>
            room.walls[i] = <span class="hljs-keyword">new</span> Wall();<font></font>
            room.walls[i].positions = <span class="hljs-keyword">new</span> List&lt;Position&gt;();<font></font>
            room.walls[i].length = <span class="hljs-number">0</span>;<font></font>
<font></font>
            <span class="hljs-keyword">switch</span> (i) {
                <span class="hljs-keyword">case</span> <span class="hljs-number">0</span>:<font></font>
                    room.walls[i].direction = <span class="hljs-string">"South"</span>;
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:<font></font>
                    room.walls[i].direction = <span class="hljs-string">"North"</span>;
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:<font></font>
                    room.walls[i].direction = <span class="hljs-string">"West"</span>;
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:<font></font>
                    room.walls[i].direction = <span class="hljs-string">"East"</span>;
                    <span class="hljs-keyword">break</span>;<font></font>
            }<font></font>
        }<font></font>
<font></font>
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> y = <span class="hljs-number">0</span>; y &lt; roomHeight; y++) {
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> x = <span class="hljs-number">0</span>; x &lt; roomWidth; x++) {<font></font>
                Position position = <span class="hljs-keyword">new</span> Position();<font></font>
                position.x = xStartingPoint + x;<font></font>
                position.y = yStartingPoint + y;<font></font>
<font></font>
                room.positions.Add(position);<font></font>
<font></font>
                MapManager.map[position.x, position.y] = <span class="hljs-keyword">new</span> Tile();<font></font>
                MapManager.map[position.x, position.y].xPosition = position.x;<font></font>
                MapManager.map[position.x, position.y].yPosition = position.y;<font></font>
<font></font>
                <span class="hljs-keyword">if</span> (y == <span class="hljs-number">0</span>) {<font></font>
                    room.walls[<span class="hljs-number">0</span>].positions.Add(position);<font></font>
                    room.walls[<span class="hljs-number">0</span>].length++;<font></font>
                    MapManager.map[position.x, position.y].type = <span class="hljs-string">"Wall"</span>;<font></font>
                }<font></font>
                <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (y == (roomHeight - <span class="hljs-number">1</span>)) {<font></font>
                    room.walls[<span class="hljs-number">1</span>].positions.Add(position);<font></font>
                    room.walls[<span class="hljs-number">1</span>].length++;<font></font>
                    MapManager.map[position.x, position.y].type = <span class="hljs-string">"Wall"</span>;<font></font>
                }<font></font>
                <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (x == <span class="hljs-number">0</span>) {<font></font>
                    room.walls[<span class="hljs-number">2</span>].positions.Add(position);<font></font>
                    room.walls[<span class="hljs-number">2</span>].length++;<font></font>
                    MapManager.map[position.x, position.y].type = <span class="hljs-string">"Wall"</span>;<font></font>
                }<font></font>
                <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (x == (roomWidth - <span class="hljs-number">1</span>)) {<font></font>
                    room.walls[<span class="hljs-number">3</span>].positions.Add(position);<font></font>
                    room.walls[<span class="hljs-number">3</span>].length++;<font></font>
                    MapManager.map[position.x, position.y].type = <span class="hljs-string">"Wall"</span>;<font></font>
                }<font></font>
                <span class="hljs-keyword">else</span> {<font></font>
                    MapManager.map[position.x, position.y].type = <span class="hljs-string">"Floor"</span>;<font></font>
                }<font></font>
            }<font></font>
        }<font></font>
<font></font>
        room.width = roomWidth;<font></font>
        room.height = roomHeight;<font></font>
        room.type = <span class="hljs-string">"Room"</span>;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">DrawMap</span>(<span class="hljs-params"><span class="hljs-keyword">bool</span> isASCII</span>)</span> {
        <span class="hljs-keyword">if</span> (isASCII) {<font></font>
            Text screen = GameObject.Find(<span class="hljs-string">"ASCIITest"</span>).GetComponent&lt;Text&gt;();<font></font>
<font></font>
            <span class="hljs-keyword">string</span> asciiMap = <span class="hljs-string">""</span>;<font></font>
<font></font>
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> y = (mapHeight - <span class="hljs-number">1</span>); y &gt;= <span class="hljs-number">0</span>; y--) {
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> x = <span class="hljs-number">0</span>; x &lt; mapWidth; x++) {
                    <span class="hljs-keyword">if</span> (MapManager.map[x,y] != <span class="hljs-literal">null</span>) {
                        <span class="hljs-keyword">switch</span> (MapManager.map[x, y].type) {
                            <span class="hljs-keyword">case</span> <span class="hljs-string">"Wall"</span>:<font></font>
                                asciiMap += <span class="hljs-string">"#"</span>;
                                <span class="hljs-keyword">break</span>;
                            <span class="hljs-keyword">case</span> <span class="hljs-string">"Floor"</span>:<font></font>
                                asciiMap += <span class="hljs-string">"."</span>;
                                <span class="hljs-keyword">break</span>;<font></font>
                        }<font></font>
                    } <span class="hljs-keyword">else</span> {<font></font>
                        asciiMap += <span class="hljs-string">" "</span>;<font></font>
                    }<font></font>
<font></font>
                    <span class="hljs-keyword">if</span> (x == (mapWidth - <span class="hljs-number">1</span>)) {<font></font>
                        asciiMap += <span class="hljs-string">"\n"</span>;<font></font>
                    }<font></font>
                }<font></font>
            }<font></font>
<font></font>
            screen.text = asciiMap;<font></font>
        }<font></font>
    }<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GameManager.cs:</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">using</span> System.Collections;
<span class="hljs-keyword">using</span> System.Collections.Generic;
<span class="hljs-keyword">using</span> UnityEngine;<font></font>
<font></font>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">GameManager</span> : <span class="hljs-title">MonoBehaviour</span><font></font>
{<font></font>
    DungeonGenerator dungeonGenerator;<font></font>
    <font></font>
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Start</span>(<span class="hljs-params"></span>)</span> {<font></font>
        dungeonGenerator = GetComponent&lt;DungeonGenerator&gt;();<font></font>
<font></font>
        dungeonGenerator.InitializeDungeon();<font></font>
        dungeonGenerator.GenerateDungeon();<font></font>
    }<font></font>
}</code></pre></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en490816/index.html">How do E-commerce sites resist the AuthBots botnets?</a></li>
<li><a href="../en490820/index.html">All Habr in one base</a></li>
<li><a href="../en490822/index.html">The best materials for hacking cars with DEF CON 2019-2020</a></li>
<li><a href="../en490824/index.html">PostgreSQL index health through the eyes of a Java developer</a></li>
<li><a href="../en490826/index.html">The source of production efficiency</a></li>
<li><a href="../en490830/index.html">Password Management in Zimbra Collaboration Suite Open-Source Edition</a></li>
<li><a href="../en490832/index.html">Shoe marking: as we put into circulation 2 million marking codes ‚Äú1C‚Äù + ‚ÄúHonest Sign‚Äù</a></li>
<li><a href="../en490836/index.html">How to open comments and not drown in spam</a></li>
<li><a href="../en490838/index.html">WiFi 6 is here: what the market offers and why do we need this technology</a></li>
<li><a href="../en490840/index.html">Resource Planning. Part 4.1. Before you make a resource plan</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>