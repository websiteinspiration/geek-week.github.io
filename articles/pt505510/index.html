<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßë üë©üèª‚Äçü§ù‚Äçüë®üèæ üëáüèø Simplificando a API do Check Point com o Python SDK üê™ ‚Ü™Ô∏è üî≠</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Todo o poder de interagir com a API √© revelado quando usado em conjunto com o c√≥digo do programa, quando √© poss√≠vel gerar dinamicamente solicita√ß√µes e...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Simplificando a API do Check Point com o Python SDK</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/505510/"><img src="https://habrastorage.org/webt/xf/kx/d6/xfkxd68ynnabb65k6ygvksmoyzw.png" alt="imagem"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Todo o poder de interagir com a API √© revelado quando usado em conjunto com o c√≥digo do programa, quando √© poss√≠vel gerar dinamicamente solicita√ß√µes e ferramentas da API para analisar respostas da API. No entanto, o </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Python Software Development Kit</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (doravante referido como Python SDK) para a </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API de gerenciamento de ponto de verifica√ß√£o</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , mas em v√£o </font><font style="vertical-align: inherit;">, permanece invis√≠vel </font><font style="vertical-align: inherit;">. Simplifica significativamente a vida dos desenvolvedores e amantes da automa√ß√£o. Ultimamente, o Python ganhou imensa popularidade e eu decidi preencher a lacuna e fornecer uma vis√£o geral dos principais recursos do </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kit de Desenvolvimento Python</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> da </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">Check Point API</font></a><font style="vertical-align: inherit;"> . Este artigo √© um excelente complemento para outro artigo sobre a </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">API</font></a><font style="vertical-align: inherit;"> Habr√© </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Check Point R80.10. Gerenciamento atrav√©s de CLI, scripts e muito mais</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Consideraremos como escrever scripts usando o Python SDK e detalharemos mais sobre a nova funcionalidade da API de gerenciamento na vers√£o 1.6 (suportada desde R80.40). </font><font style="vertical-align: inherit;">Para entender o artigo, voc√™ precisar√° de conhecimentos b√°sicos sobre como trabalhar com APIs e Python.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A Check Point est√° desenvolvendo ativamente a API e, no momento, existem:</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API de gerenciamento de ponto de verifica√ß√£o (vers√£o atual 1.6)</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - trabalhe com o servidor de gerenciamento por meio da API (e a capacidade de executar scripts em gateways sob o controle do servidor de gerenciamento)</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API GAIA do Check Point (vers√£o atual 1.4)</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - trabalhe com gateways de seguran√ßa</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API de preven√ß√£o de amea√ßas 1.0</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Sandboxing na nuvem de ponto de verifica√ß√£o</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API do Identity Awareness</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - trabalhando com o blade Identity Awareness em gateways</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API do Security Management Portal</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - trabalhando com o portal de gerenciamento de gateway SMB ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Saiba mais sobre gateways SMB</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API IoT</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - intera√ß√£o com controladores IoT</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API do CloudGuard Connect</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - trabalhando com o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CloudGuard Connect</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (solu√ß√£o de seguran√ßa SD-WAN)</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API do Dome9</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - trabalhando com o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dome9</font></font></a> </li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Atualmente, o SDK do Python suporta apenas a intera√ß√£o com a API de gerenciamento e a </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> do </font><b><font style="vertical-align: inherit;">Gaia</font></b><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Abordaremos as classes, m√©todos e vari√°veis ‚Äã‚Äãmais importantes deste m√≥dulo.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/7v/vt/1x/7vvt1xvikrzesgwntw5mrx8tqlu.jpeg" alt="imagem"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Instala√ß√£o do m√≥dulo</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O m√≥dulo </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cpapi √©</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> instalado de maneira r√°pida e f√°cil a partir do </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">reposit√≥rio oficial do Check Point no github</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> usando </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pip</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Instru√ß√µes detalhadas de instala√ß√£o est√£o em </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">README.md</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Este m√≥dulo est√° adaptado para trabalhar com vers√µes do Python 2.7 e 3.7. </font><font style="vertical-align: inherit;">Neste artigo, exemplos ser√£o fornecidos usando o Python 3.7. </font><font style="vertical-align: inherit;">No entanto, o SDK do Python pode ser executado diretamente do servidor de gerenciamento Check Point (Smart Management), mas eles suportam apenas o Python 2.7, portanto, a √∫ltima se√ß√£o fornecer√° o c√≥digo para a vers√£o 2.7. </font><font style="vertical-align: inherit;">Imediatamente ap√≥s a instala√ß√£o do m√≥dulo, eu recomendo a olhar para os exemplos nas </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">examples_python2</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">examples_python3</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> diret√≥rios </font><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In√≠cio do trabalho</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para podermos trabalhar com os componentes do m√≥dulo cpapi </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pelo menos duas classes necess√°rias </font><font style="vertical-align: inherit;">devem ser importadas do m√≥dulo </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cpapi</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font><b><font style="vertical-align: inherit;">APIClient</font></b><font style="vertical-align: inherit;"> e </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">APIClientArgs</font></font></b><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">from</span> cpapi <span class="hljs-keyword">import</span> APIClient, APIClientArgs
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A classe </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">APIClientArgs √©</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> respons√°vel por conectar-se ao servidor da API e a classe </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">APIClient √©</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> respons√°vel por interagir com a API.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Determinamos os par√¢metros de conex√£o</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para definir v√°rios par√¢metros para conectar-se √† API, voc√™ precisa criar uma inst√¢ncia da classe </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">APIClientArgs</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Em princ√≠pio, seus par√¢metros s√£o predefinidos e voc√™ pode omiti-los ao executar o script no servidor de gerenciamento.</font></font><br>
<br>
<pre><code class="python hljs">client_args = APIClientArgs()</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por√©m, ao iniciar em um host de terceiros, voc√™ deve especificar pelo menos o endere√ßo IP ou o nome do host do servidor da API (tamb√©m √© um servidor de gerenciamento). </font><font style="vertical-align: inherit;">No exemplo abaixo, definimos o par√¢metro de conex√£o do servidor e atribu√≠mos a ele o endere√ßo IP do servidor de gerenciamento como uma sequ√™ncia.</font></font><br>
<br>
<pre><code class="python hljs">client_args = APIClientArgs(server=<span class="hljs-string">'192.168.47.241'</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vejamos todos os par√¢metros e seus valores padr√£o que podem ser usados ‚Äã‚Äãao se conectar ao servidor da API:</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Argumentos para o m√©todo __init__ da classe APIClientArgs</font></font></b>
                        <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">APIClientArgs</span>:</span>
    <span class="hljs-string">"""
    This class provides arguments for APIClient configuration.
    All the arguments are configured with their default values.
    """</span><font></font>
<font></font>
    <span class="hljs-comment"># port is set to None by default, but it gets replaced with 443 if not specified</span>
    <span class="hljs-comment"># context possible values - web_api (default) or gaia_api</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, port=None, fingerprint=None, sid=None, server=<span class="hljs-string">"127.0.0.1"</span>, http_debug_level=<span class="hljs-number">0</span>,
                 api_calls=None, debug_file=<span class="hljs-string">""</span>, proxy_host=None, proxy_port=<span class="hljs-number">8080</span>,
                 api_version=None, unsafe=False, unsafe_auto_accept=False, context=<span class="hljs-string">"web_api"</span></span>):</span><font></font>
        self.port = port<font></font>
        <span class="hljs-comment"># management server fingerprint</span><font></font>
        self.fingerprint = fingerprint<font></font>
        <span class="hljs-comment"># session-id.</span><font></font>
        self.sid = sid<font></font>
        <span class="hljs-comment"># management server name or IP-address</span><font></font>
        self.server = server<font></font>
        <span class="hljs-comment"># debug level</span><font></font>
        self.http_debug_level = http_debug_level<font></font>
        <span class="hljs-comment"># an array with all the api calls (for debug purposes)</span>
        self.api_calls = api_calls <span class="hljs-keyword">if</span> api_calls <span class="hljs-keyword">else</span> []
        <span class="hljs-comment"># name of debug file. If left empty, debug data will not be saved to disk.</span><font></font>
        self.debug_file = debug_file<font></font>
        <span class="hljs-comment"># HTTP proxy server address (without "http://")</span><font></font>
        self.proxy_host = proxy_host<font></font>
        <span class="hljs-comment"># HTTP proxy port</span><font></font>
        self.proxy_port = proxy_port<font></font>
        <span class="hljs-comment"># Management server's API version</span><font></font>
        self.api_version = api_version<font></font>
        <span class="hljs-comment"># Indicates that the client should not check the server's certificate</span><font></font>
        self.unsafe = unsafe<font></font>
        <span class="hljs-comment"># Indicates that the client should automatically accept and save the server's certificate</span><font></font>
        self.unsafe_auto_accept = unsafe_auto_accept<font></font>
        <span class="hljs-comment"># The context of using the client - defaults to web_api</span>
        self.context = context</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Acredito que os argumentos que podem ser usados ‚Äã‚Äãnas inst√¢ncias da classe APIClientArgs sejam intuitivos para os administradores do Check Point e n√£o precisem de coment√°rios adicionais.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conecte-se via APIClient e gerenciador de contexto</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A classe </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">APIClient</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √© </font><b><font style="vertical-align: inherit;">mais</font></b><font style="vertical-align: inherit;"> convenientemente usada atrav√©s do gerenciador de contexto. </font><font style="vertical-align: inherit;">Tudo o que voc√™ precisa passar para uma inst√¢ncia da classe APIClient s√£o os par√¢metros de conex√£o que foram definidos na √∫ltima etapa.</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">with</span> APIClient(client_args) <span class="hljs-keyword">as</span> client:
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O gerenciador de contexto n√£o far√° automaticamente uma chamada de login para o servidor da API, mas far√° uma chamada de logout quando sair. </font><font style="vertical-align: inherit;">Se, por algum motivo, um logout n√£o for necess√°rio no final do trabalho com as chamadas da API, voc√™ precisar√° iniciar o trabalho sem usar o gerenciador de contexto:</font></font><br>
<br>
<pre><code class="python hljs">client = APIClient(clieng_args)</code></pre><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Verifica√ß√£o de conex√£o</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A maneira mais f√°cil de verificar se uma conex√£o passa pelos par√¢metros fornecidos √© usando o m√©todo </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">check_fingerprint</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Se a verifica√ß√£o do hash sha1 para impress√£o digital do certificado da API do servidor n√£o passou (o m√©todo retornou </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">False</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), isso geralmente √© causado por problemas de conex√£o e podemos parar o programa (ou permitir que o usu√°rio corrija os dados da conex√£o):</font></font><br>
<br>
<pre><code class="python hljs">    <span class="hljs-keyword">if</span> client.check_fingerprint() <span class="hljs-keyword">is</span> <span class="hljs-literal">False</span>:<font></font>
        print(<span class="hljs-string">"Could not get the server's fingerprint - Check connectivity with the server."</span>)<font></font>
        exit(<span class="hljs-number">1</span>)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Note-se que no futuro, o </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">APIClient</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> classe </font><font style="vertical-align: inherit;">ir√° verificar com cada chamada API ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">api_call</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">api_query m√©todos</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , vamos falar sobre eles um pouco mais) certificado SHA1 impress√£o digital no servidor de API. </font><font style="vertical-align: inherit;">Mas se um erro for detectado ao verificar a impress√£o digital sha1 do certificado da API do servidor (o certificado √© desconhecido ou foi alterado), o m√©todo </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">check_fingerprint</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fornecer√° a capacidade de adicionar / alterar informa√ß√µes sobre ele na m√°quina local no modo autom√°tico. </font><font style="vertical-align: inherit;">Essa verifica√ß√£o pode ser desativada completamente (mas isso s√≥ pode ser recomendada se os scripts forem executados no pr√≥prio servidor da API, quando conectado ao 127.0.0.1) usando o argumento </font><b><font style="vertical-align: inherit;">APIClientArgs</font></b><font style="vertical-align: inherit;"> - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unsafe_auto_accept</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (veja detalhes sobre APIClientArgs anteriormente em "Definindo par√¢metros de conex√£o").</font></font><br>
<br>
<pre><code class="python hljs">client_args = APIClientArgs(unsafe_auto_accept=<span class="hljs-literal">True</span>)</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Efetue login no servidor da API</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">APIClient,</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> existem at√© 3 m√©todos de login no servidor da API e cada um deles valor zaponimaet </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sid</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (o ID da sess√£o), usado automaticamente em cada chamada subsequente da API no cabe√ßalho (o nome do t√≠tulo nessa configura√ß√£o - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o X-CHKP-sid</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), portanto que voc√™ n√£o precisa processar mais esse par√¢metro.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M√©todo de login</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A op√ß√£o usando o nome de usu√°rio e a senha (no exemplo, o nome de usu√°rio admin e a senha 1q2w3e s√£o passados ‚Äã‚Äãcomo argumentos posicionais):</font></font><br>
<br>
<pre><code class="python hljs">     login = client.login(<span class="hljs-string">'admin'</span>, <span class="hljs-string">'1q2w3e'</span>)  </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os par√¢metros opcionais opcionais tamb√©m est√£o dispon√≠veis no m√©todo de logon.Listo seus nomes e valores padr√£o: </font></font><br>
<br>
<pre><code class="python hljs">continue_last_session=<span class="hljs-literal">False</span>, domain=<span class="hljs-literal">None</span>, read_only=<span class="hljs-literal">False</span>, payload=<span class="hljs-literal">None</span></code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M√©todo Login_with_api_key</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Uma variante que usa a chave api (suportada desde a vers√£o de gerenciamento R80.40 / Management API v1.6, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"3TsbPJ8ZKjaJGvFyoFqHFA =="</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √© o valor da chave API para um dos usu√°rios no servidor de gerenciamento com o m√©todo de autoriza√ß√£o de chave API):</font></font><br>
<br>
<pre><code class="python hljs">     login = client.login_with_api_key(<span class="hljs-string">'3TsbPJ8ZKjaJGvFyoFqHFA=='</span>) </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No m√©todo </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">login_with_api_key</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , os mesmos par√¢metros opcionais est√£o dispon√≠veis como no m√©todo de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">login</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M√©todo Login_as_root</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A op√ß√£o de login na m√°quina local com o servidor da API:</font></font><br>
<br>
<pre><code class="python hljs">     login = client.login_as_root()</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apenas dois par√¢metros opcionais est√£o dispon√≠veis para este m√©todo:</font></font><br>
<br>
<pre><code class="python hljs">domain=<span class="hljs-literal">None</span>, payload=<span class="hljs-literal">None</span></code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por fim, a API se autodenomina</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Temos duas op√ß√µes para fazer chamadas de API atrav√©s das </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">api_call</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m√©todos api_query</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Vamos descobrir qual √© a diferen√ßa entre eles.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">api_call</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este m√©todo √© aplic√°vel a todas as chamadas. </font><font style="vertical-align: inherit;">Precisamos passar a √∫ltima parte da chamada e carga √∫til da API no corpo da solicita√ß√£o, se necess√°rio. </font><font style="vertical-align: inherit;">Se a carga √∫til estiver vazia, voc√™ n√£o poder√° transferi-la:</font></font><br>
<br>
<pre><code class="python hljs">api_versions = client.api_call(<span class="hljs-string">'show-api-versions'</span>) </code></pre><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A sa√≠da para esta solicita√ß√£o em cat:</font></font></b>
                        <div class="spoiler_text"><pre><code class="python hljs">In [<span class="hljs-number">23</span>]: api_versions                                                           <font></font>
Out[<span class="hljs-number">23</span>]: <font></font>
APIResponse({<font></font>
    <span class="hljs-string">"data"</span>: {
        <span class="hljs-string">"current-version"</span>: <span class="hljs-string">"1.6"</span>,
        <span class="hljs-string">"supported-versions"</span>: [
            <span class="hljs-string">"1"</span>,
            <span class="hljs-string">"1.1"</span>,
            <span class="hljs-string">"1.2"</span>,
            <span class="hljs-string">"1.3"</span>,
            <span class="hljs-string">"1.4"</span>,
            <span class="hljs-string">"1.5"</span>,
            <span class="hljs-string">"1.6"</span><font></font>
        ]<font></font>
    },<font></font>
    <span class="hljs-string">"res_obj"</span>: {
        <span class="hljs-string">"data"</span>: {
            <span class="hljs-string">"current-version"</span>: <span class="hljs-string">"1.6"</span>,
            <span class="hljs-string">"supported-versions"</span>: [
                <span class="hljs-string">"1"</span>,
                <span class="hljs-string">"1.1"</span>,
                <span class="hljs-string">"1.2"</span>,
                <span class="hljs-string">"1.3"</span>,
                <span class="hljs-string">"1.4"</span>,
                <span class="hljs-string">"1.5"</span>,
                <span class="hljs-string">"1.6"</span><font></font>
            ]<font></font>
        },<font></font>
        <span class="hljs-string">"status_code"</span>: <span class="hljs-number">200</span><font></font>
    },<font></font>
    <span class="hljs-string">"status_code"</span>: <span class="hljs-number">200</span>,
    <span class="hljs-string">"success"</span>: true<font></font>
})<font></font>
</code></pre><br>
</div>
                    </div><br>
<pre><code class="python hljs">show_host = client.api_call(<span class="hljs-string">'show-host'</span>, {<span class="hljs-string">'name'</span> : <span class="hljs-string">'h_8.8.8.8'</span>})</code></pre><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A sa√≠da para esta solicita√ß√£o em cat:</font></font></b>
                        <div class="spoiler_text"><pre><code class="python hljs">In [<span class="hljs-number">25</span>]: show_host                                                              <font></font>
Out[<span class="hljs-number">25</span>]: <font></font>
APIResponse({<font></font>
    <span class="hljs-string">"data"</span>: {
        <span class="hljs-string">"color"</span>: <span class="hljs-string">"black"</span>,
        <span class="hljs-string">"comments"</span>: <span class="hljs-string">""</span>,
        <span class="hljs-string">"domain"</span>: {
            <span class="hljs-string">"domain-type"</span>: <span class="hljs-string">"domain"</span>,
            <span class="hljs-string">"name"</span>: <span class="hljs-string">"SMC User"</span>,
            <span class="hljs-string">"uid"</span>: <span class="hljs-string">"41e821a0-3720-11e3-aa6e-0800200c9fde"</span><font></font>
        },<font></font>
        <span class="hljs-string">"groups"</span>: [],
        <span class="hljs-string">"icon"</span>: <span class="hljs-string">"Objects/host"</span>,
        <span class="hljs-string">"interfaces"</span>: [],
        <span class="hljs-string">"ipv4-address"</span>: <span class="hljs-string">"8.8.8.8"</span>,
        <span class="hljs-string">"meta-info"</span>: {
            <span class="hljs-string">"creation-time"</span>: {
                <span class="hljs-string">"iso-8601"</span>: <span class="hljs-string">"2020-05-01T21:49+0300"</span>,
                <span class="hljs-string">"posix"</span>: <span class="hljs-number">1588358973517</span><font></font>
            },<font></font>
            <span class="hljs-string">"creator"</span>: <span class="hljs-string">"admin"</span>,
            <span class="hljs-string">"last-modifier"</span>: <span class="hljs-string">"admin"</span>,
            <span class="hljs-string">"last-modify-time"</span>: {
                <span class="hljs-string">"iso-8601"</span>: <span class="hljs-string">"2020-05-01T21:49+0300"</span>,
                <span class="hljs-string">"posix"</span>: <span class="hljs-number">1588358973517</span><font></font>
            },<font></font>
            <span class="hljs-string">"lock"</span>: <span class="hljs-string">"unlocked"</span>,
            <span class="hljs-string">"validation-state"</span>: <span class="hljs-string">"ok"</span><font></font>
        },<font></font>
        <span class="hljs-string">"name"</span>: <span class="hljs-string">"h_8.8.8.8"</span>,
        <span class="hljs-string">"nat-settings"</span>: {
            <span class="hljs-string">"auto-rule"</span>: false<font></font>
        },<font></font>
        <span class="hljs-string">"read-only"</span>: false,
        <span class="hljs-string">"tags"</span>: [],
        <span class="hljs-string">"type"</span>: <span class="hljs-string">"host"</span>,
        <span class="hljs-string">"uid"</span>: <span class="hljs-string">"c210af07-1939-49d3-a351-953a9c471d9e"</span><font></font>
    },<font></font>
    <span class="hljs-string">"res_obj"</span>: {
        <span class="hljs-string">"data"</span>: {
            <span class="hljs-string">"color"</span>: <span class="hljs-string">"black"</span>,
            <span class="hljs-string">"comments"</span>: <span class="hljs-string">""</span>,
            <span class="hljs-string">"domain"</span>: {
                <span class="hljs-string">"domain-type"</span>: <span class="hljs-string">"domain"</span>,
                <span class="hljs-string">"name"</span>: <span class="hljs-string">"SMC User"</span>,
                <span class="hljs-string">"uid"</span>: <span class="hljs-string">"41e821a0-3720-11e3-aa6e-0800200c9fde"</span><font></font>
            },<font></font>
            <span class="hljs-string">"groups"</span>: [],
            <span class="hljs-string">"icon"</span>: <span class="hljs-string">"Objects/host"</span>,
            <span class="hljs-string">"interfaces"</span>: [],
            <span class="hljs-string">"ipv4-address"</span>: <span class="hljs-string">"8.8.8.8"</span>,
            <span class="hljs-string">"meta-info"</span>: {
                <span class="hljs-string">"creation-time"</span>: {
                    <span class="hljs-string">"iso-8601"</span>: <span class="hljs-string">"2020-05-01T21:49+0300"</span>,
                    <span class="hljs-string">"posix"</span>: <span class="hljs-number">1588358973517</span><font></font>
                },<font></font>
                <span class="hljs-string">"creator"</span>: <span class="hljs-string">"admin"</span>,
                <span class="hljs-string">"last-modifier"</span>: <span class="hljs-string">"admin"</span>,
                <span class="hljs-string">"last-modify-time"</span>: {
                    <span class="hljs-string">"iso-8601"</span>: <span class="hljs-string">"2020-05-01T21:49+0300"</span>,
                    <span class="hljs-string">"posix"</span>: <span class="hljs-number">1588358973517</span><font></font>
                },<font></font>
                <span class="hljs-string">"lock"</span>: <span class="hljs-string">"unlocked"</span>,
                <span class="hljs-string">"validation-state"</span>: <span class="hljs-string">"ok"</span><font></font>
            },<font></font>
            <span class="hljs-string">"name"</span>: <span class="hljs-string">"h_8.8.8.8"</span>,
            <span class="hljs-string">"nat-settings"</span>: {
                <span class="hljs-string">"auto-rule"</span>: false<font></font>
            },<font></font>
            <span class="hljs-string">"read-only"</span>: false,
            <span class="hljs-string">"tags"</span>: [],
            <span class="hljs-string">"type"</span>: <span class="hljs-string">"host"</span>,
            <span class="hljs-string">"uid"</span>: <span class="hljs-string">"c210af07-1939-49d3-a351-953a9c471d9e"</span><font></font>
        },<font></font>
        <span class="hljs-string">"status_code"</span>: <span class="hljs-number">200</span><font></font>
    },<font></font>
    <span class="hljs-string">"status_code"</span>: <span class="hljs-number">200</span>,
    <span class="hljs-string">"success"</span>: true<font></font>
})<font></font>
</code></pre><br>
</div>
                    </div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">api_query</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Imediatamente, fa√ßa uma reserva de que esse m√©todo √© aplic√°vel apenas a chamadas cuja sa√≠da envolve deslocamento (shift). Essa conclus√£o ocorre quando cont√©m ou pode conter uma grande quantidade de informa√ß√µes. Por exemplo, isso pode ser uma solicita√ß√£o de uma lista de todos os objetos criados do tipo host no servidor de gerenciamento. Para essas solicita√ß√µes, a API retorna uma lista de 50 objetos por padr√£o (voc√™ pode aumentar o limite para 500 objetos na resposta). E, para n√£o extrair as informa√ß√µes v√°rias vezes, alterando o par√¢metro offset na solicita√ß√£o da API, existe um m√©todo api_query que faz isso funcionar automaticamente. Exemplos de chamadas em que esse m√©todo √© necess√°rio: </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">show-sessions, show-hosts, show-networks, show-wildcards, show-groups, show-address-range, show-simple-gateways, show-simple-clusters, show-access- fun√ß√µes, show-trust-clients, show-packages</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">De fato, no nome dessas chamadas de API, vemos palavras plurais, portanto, essas chamadas ser√£o mais f√°ceis de manipular atrav√©s de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">api_query</font></font></b><br>
<br>
<pre><code class="python hljs">show_hosts = client.api_query(<span class="hljs-string">'show-hosts'</span>) </code></pre><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A sa√≠da para esta solicita√ß√£o em cat:</font></font></b>
                        <div class="spoiler_text"><pre><code class="python hljs">In [<span class="hljs-number">21</span>]: show_hosts                                                             <font></font>
Out[<span class="hljs-number">21</span>]: <font></font>
APIResponse({<font></font>
    <span class="hljs-string">"data"</span>: [<font></font>
        {<font></font>
            <span class="hljs-string">"domain"</span>: {
                <span class="hljs-string">"domain-type"</span>: <span class="hljs-string">"domain"</span>,
                <span class="hljs-string">"name"</span>: <span class="hljs-string">"SMC User"</span>,
                <span class="hljs-string">"uid"</span>: <span class="hljs-string">"41e821a0-3720-11e3-aa6e-0800200c9fde"</span><font></font>
            },<font></font>
            <span class="hljs-string">"ipv4-address"</span>: <span class="hljs-string">"192.168.47.1"</span>,
            <span class="hljs-string">"name"</span>: <span class="hljs-string">"h_192.168.47.1"</span>,
            <span class="hljs-string">"type"</span>: <span class="hljs-string">"host"</span>,
            <span class="hljs-string">"uid"</span>: <span class="hljs-string">"5d7d7086-d70b-4995-971a-0583b15a2bfc"</span><font></font>
        },<font></font>
        {<font></font>
            <span class="hljs-string">"domain"</span>: {
                <span class="hljs-string">"domain-type"</span>: <span class="hljs-string">"domain"</span>,
                <span class="hljs-string">"name"</span>: <span class="hljs-string">"SMC User"</span>,
                <span class="hljs-string">"uid"</span>: <span class="hljs-string">"41e821a0-3720-11e3-aa6e-0800200c9fde"</span><font></font>
            },<font></font>
            <span class="hljs-string">"ipv4-address"</span>: <span class="hljs-string">"8.8.8.8"</span>,
            <span class="hljs-string">"name"</span>: <span class="hljs-string">"h_8.8.8.8"</span>,
            <span class="hljs-string">"type"</span>: <span class="hljs-string">"host"</span>,
            <span class="hljs-string">"uid"</span>: <span class="hljs-string">"c210af07-1939-49d3-a351-953a9c471d9e"</span><font></font>
        }<font></font>
    ],<font></font>
    <span class="hljs-string">"res_obj"</span>: {
        <span class="hljs-string">"data"</span>: {
            <span class="hljs-string">"from"</span>: <span class="hljs-number">1</span>,
            <span class="hljs-string">"objects"</span>: [<font></font>
                {<font></font>
                    <span class="hljs-string">"domain"</span>: {
                        <span class="hljs-string">"domain-type"</span>: <span class="hljs-string">"domain"</span>,
                        <span class="hljs-string">"name"</span>: <span class="hljs-string">"SMC User"</span>,
                        <span class="hljs-string">"uid"</span>: <span class="hljs-string">"41e821a0-3720-11e3-aa6e-0800200c9fde"</span><font></font>
                    },<font></font>
                    <span class="hljs-string">"ipv4-address"</span>: <span class="hljs-string">"192.168.47.1"</span>,
                    <span class="hljs-string">"name"</span>: <span class="hljs-string">"h_192.168.47.1"</span>,
                    <span class="hljs-string">"type"</span>: <span class="hljs-string">"host"</span>,
                    <span class="hljs-string">"uid"</span>: <span class="hljs-string">"5d7d7086-d70b-4995-971a-0583b15a2bfc"</span><font></font>
                },<font></font>
                {<font></font>
                    <span class="hljs-string">"domain"</span>: {
                        <span class="hljs-string">"domain-type"</span>: <span class="hljs-string">"domain"</span>,
                        <span class="hljs-string">"name"</span>: <span class="hljs-string">"SMC User"</span>,
                        <span class="hljs-string">"uid"</span>: <span class="hljs-string">"41e821a0-3720-11e3-aa6e-0800200c9fde"</span><font></font>
                    },<font></font>
                    <span class="hljs-string">"ipv4-address"</span>: <span class="hljs-string">"8.8.8.8"</span>,
                    <span class="hljs-string">"name"</span>: <span class="hljs-string">"h_8.8.8.8"</span>,
                    <span class="hljs-string">"type"</span>: <span class="hljs-string">"host"</span>,
                    <span class="hljs-string">"uid"</span>: <span class="hljs-string">"c210af07-1939-49d3-a351-953a9c471d9e"</span><font></font>
                }<font></font>
            ],<font></font>
            <span class="hljs-string">"to"</span>: <span class="hljs-number">2</span>,
            <span class="hljs-string">"total"</span>: <span class="hljs-number">2</span><font></font>
        },<font></font>
        <span class="hljs-string">"status_code"</span>: <span class="hljs-number">200</span><font></font>
    },<font></font>
    <span class="hljs-string">"status_code"</span>: <span class="hljs-number">200</span>,
    <span class="hljs-string">"success"</span>: true<font></font>
})<font></font>
</code></pre><br>
</div>
                    </div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Processando resultados de chamadas da API</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Depois disso, voc√™ pode usar as vari√°veis ‚Äã‚Äãe os m√©todos da classe </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">APIResponse</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (dentro e fora do gerenciador de contexto). </font><font style="vertical-align: inherit;">A classe </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">APIResponse possui</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 4 m√©todos e 5 vari√°veis ‚Äã‚Äãpredefinidas; abordaremos os mais importantes com mais detalhes.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/yb/1q/av/yb1qavksjibe6qizmrjxsaprdp4.jpeg" alt="imagem"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sucesso</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para come√ßar, seria bom verificar se a chamada da API foi bem-sucedida e retornou o resultado. </font><font style="vertical-align: inherit;">Existe um m√©todo de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sucesso</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para isso </font><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="python hljs">In [<span class="hljs-number">49</span>]: api_versions.success                                                   <font></font>
Out[<span class="hljs-number">49</span>]: <span class="hljs-literal">True</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Retorna True se a chamada da API foi bem-sucedida (o c√≥digo de resposta √© 200) e False se n√£o for bem-sucedida (qualquer outro c√≥digo de resposta). </font><font style="vertical-align: inherit;">√â conveniente usar imediatamente ap√≥s a chamada da API, para que, dependendo do c√≥digo de resposta, voc√™ possa exibir informa√ß√µes diferentes.</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">if</span> api_ver.success: <font></font>
    print(api_versions.data) <font></font>
<span class="hljs-keyword">else</span>: <font></font>
    print(api_versions.err_message) </code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">statuscode</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Retorna o c√≥digo de resposta ap√≥s fazer uma chamada de API.</font></font><br>
<br>
<pre><code class="python hljs">In [<span class="hljs-number">62</span>]: api_versions.status_code                                               <font></font>
Out[<span class="hljs-number">62</span>]: <span class="hljs-number">400</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C√≥digos de resposta poss√≠veis: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">200.400.401.403.404.409.500.501</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">set_success_status</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pode ser necess√°rio alterar o valor do status de sucesso. </font><font style="vertical-align: inherit;">Tecnicamente, voc√™ pode colocar qualquer coisa l√°, mesmo uma string comum. </font><font style="vertical-align: inherit;">Mas um exemplo real seria redefinir esse par√¢metro para False sob certas condi√ß√µes concomitantes. </font><font style="vertical-align: inherit;">Abaixo, preste aten√ß√£o a um exemplo quando houver tarefas executadas no servidor de gerenciamento, mas consideraremos esta solicita√ß√£o sem √™xito (defina a vari√°vel success como </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">False</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , apesar do fato de a chamada da API ter sido bem-sucedida e ter retornado o c√≥digo 200).</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">for</span> task <span class="hljs-keyword">in</span> task_result.data[<span class="hljs-string">"tasks"</span>]:
    <span class="hljs-keyword">if</span> task[<span class="hljs-string">"status"</span>] == <span class="hljs-string">"failed"</span> <span class="hljs-keyword">or</span> task[<span class="hljs-string">"status"</span>] == <span class="hljs-string">"partially succeeded"</span>:<font></font>
        task_result.set_success_status(<span class="hljs-literal">False</span>)
        <span class="hljs-keyword">break</span></code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">resposta ()</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O m√©todo de resposta permite visualizar o dicion√°rio com o c√≥digo de resposta (status_code) e com o corpo da resposta (corpo).</font></font><br>
<br>
<pre><code class="python hljs">In [<span class="hljs-number">94</span>]: api_versions.response()                                                <font></font>
Out[<span class="hljs-number">94</span>]: <font></font>
{<span class="hljs-string">'status_code'</span>: <span class="hljs-number">200</span>,
 <span class="hljs-string">'data'</span>: {<span class="hljs-string">'current-version'</span>: <span class="hljs-string">'1.6'</span>,
  <span class="hljs-string">'supported-versions'</span>: [<span class="hljs-string">'1'</span>, <span class="hljs-string">'1.1'</span>, <span class="hljs-string">'1.2'</span>, <span class="hljs-string">'1.3'</span>, <span class="hljs-string">'1.4'</span>, <span class="hljs-string">'1.5'</span>, <span class="hljs-string">'1.6'</span>]}}
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dados</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Permite ver apenas o corpo da resposta (corpo) sem informa√ß√µes desnecess√°rias.</font></font><br>
<br>
<pre><code class="python hljs">In [<span class="hljs-number">93</span>]: api_versions.data                                                      <font></font>
Out[<span class="hljs-number">93</span>]: <font></font>
{<span class="hljs-string">'current-version'</span>: <span class="hljs-string">'1.6'</span>,
 <span class="hljs-string">'supported-versions'</span>: [<span class="hljs-string">'1'</span>, <span class="hljs-string">'1.1'</span>, <span class="hljs-string">'1.2'</span>, <span class="hljs-string">'1.3'</span>, <span class="hljs-string">'1.4'</span>, <span class="hljs-string">'1.5'</span>, <span class="hljs-string">'1.6'</span>]}
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mensagem de erro</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esta informa√ß√£o est√° dispon√≠vel apenas quando ocorreu um erro ao processar a API de solicita√ß√£o (o c√≥digo de resposta </font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n√£o</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √© </font><font style="vertical-align: inherit;">200). </font><font style="vertical-align: inherit;">Exemplo de sa√≠da</font></font><br>
<pre><code class="python hljs">In [<span class="hljs-number">107</span>]: api_versions.error_message                                            <font></font>
Out[<span class="hljs-number">107</span>]: <span class="hljs-string">'code: generic_err_invalid_parameter_name\nmessage: Unrecognized parameter [1]\n'</span>
</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exemplos √∫teis</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A seguir, exemplos que usam chamadas de API que foram adicionadas √† Management API 1.6. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para come√ßar, considere a opera√ß√£o de chamadas </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">add-host</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">add-address-range</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Suponha que precisamos criar todos os endere√ßos IP da sub-rede 192.168.0.0/24 como objetos do tipo host, cujo √∫ltimo octeto seja 5, e gravar todos os outros endere√ßos IP como objetos do intervalo de endere√ßos. Nesse caso, o endere√ßo de sub-rede e o endere√ßo de broadcast devem ser exclu√≠dos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Portanto, abaixo est√° um script que resolve esse problema e cria 50 objetos do tipo host e 51 objetos do tipo de endere√ßos. Para resolver o problema, s√£o necess√°rias 101 chamadas de API (sem contar a chamada de publica√ß√£o final). Al√©m disso, usando o m√≥dulo timeit, calculamos o tempo necess√°rio para executar o script at√© que as altera√ß√µes sejam postadas.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Script usando add-host e add-address-range</font></font></b>
                        <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword">import</span> timeit
<span class="hljs-keyword">from</span> cpapi <span class="hljs-keyword">import</span> APIClient, APIClientArgs<font></font>
<font></font>
start = timeit.default_timer()<font></font>
<font></font>
first_ip = <span class="hljs-number">1</span>
last_ip = <span class="hljs-number">4</span><font></font>
<font></font>
client_args = APIClientArgs(server=<span class="hljs-string">"192.168.47.240"</span>)<font></font>
<font></font>
<span class="hljs-keyword">with</span> APIClient(client_args) <span class="hljs-keyword">as</span> client: <font></font>
     login = client.login_with_api_key(<span class="hljs-string">'3TsbPJ8ZKjaJGvFyoFqHFA=='</span>)
     <span class="hljs-keyword">for</span> ip <span class="hljs-keyword">in</span> range(<span class="hljs-number">5</span>,<span class="hljs-number">255</span>,<span class="hljs-number">5</span>):<font></font>
         add_host = client.api_call(<span class="hljs-string">"add-host"</span>, {<span class="hljs-string">"name"</span> : <span class="hljs-string">f"h_192.168.0.<span class="hljs-subst">{ip}</span>"</span>, <span class="hljs-string">"ip-address"</span>: <span class="hljs-string">f'192.168.0.<span class="hljs-subst">{ip}</span>'</span>})
     <span class="hljs-keyword">while</span> last_ip &lt; <span class="hljs-number">255</span>:<font></font>
         add_range = client.api_call(<span class="hljs-string">"add-address-range"</span>, {<span class="hljs-string">"name"</span>: <span class="hljs-string">f"r_192.168.0.<span class="hljs-subst">{first_ip}</span>-<span class="hljs-subst">{last_ip}</span>"</span>, <span class="hljs-string">"ip-address-first"</span>: <span class="hljs-string">f"192.168.0.<span class="hljs-subst">{first_ip}</span>"</span>, <span class="hljs-string">"ip-address-last"</span>: <span class="hljs-string">f"192.168.0.<span class="hljs-subst">{last_ip}</span>"</span>})<font></font>
         first_ip+=<span class="hljs-number">5</span>
         last_ip+=<span class="hljs-number">5</span><font></font>
     stop = timeit.default_timer() <font></font>
     publish = client.api_call(<span class="hljs-string">"publish"</span>)<font></font>
     <font></font>
print(<span class="hljs-string">f'Time to execute batch request: <span class="hljs-subst">{stop - start}</span> seconds'</span>)<font></font>
<font></font>
</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No meu ambiente de laborat√≥rio, leva 30 a 50 segundos para executar esse script, dependendo da carga no servidor de gerenciamento. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora vamos ver como resolver o mesmo problema usando a API de chamada </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">add-objects-batch</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , cujo suporte foi adicionado √† API vers√£o 1.6. </font><font style="vertical-align: inherit;">Essa chamada permite criar muitos objetos ao mesmo tempo em uma solicita√ß√£o de API. </font><font style="vertical-align: inherit;">Al√©m disso, eles podem ser objetos de diferentes tipos (por exemplo, hosts, sub-redes e intervalos de endere√ßos). </font><font style="vertical-align: inherit;">Assim, nossa tarefa pode ser resolvida na estrutura de uma √∫nica chamada de API.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Script usando add-objects-batch</font></font></b>
                        <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword">import</span> timeit
<span class="hljs-keyword">from</span> cpapi <span class="hljs-keyword">import</span> APIClient, APIClientArgs<font></font>
<font></font>
start = timeit.default_timer()<font></font>
<font></font>
client_args = APIClientArgs(server=<span class="hljs-string">"192.168.47.240"</span>)<font></font>
<font></font>
objects_list_ip = []<font></font>
objects_list_range = []<font></font>
<font></font>
<span class="hljs-keyword">for</span> ip <span class="hljs-keyword">in</span> range(<span class="hljs-number">5</span>,<span class="hljs-number">255</span>,<span class="hljs-number">5</span>):<font></font>
    data = {<span class="hljs-string">"name"</span>: <span class="hljs-string">f'h_192.168.0.<span class="hljs-subst">{ip}</span>'</span>, <span class="hljs-string">"ip-address"</span>: <span class="hljs-string">f'192.168.0.<span class="hljs-subst">{ip}</span>'</span>}<font></font>
    objects_list_ip.append(data)<font></font>
    <font></font>
first_ip = <span class="hljs-number">1</span>
last_ip = <span class="hljs-number">4</span><font></font>
<font></font>
<font></font>
<span class="hljs-keyword">while</span> last_ip &lt; <span class="hljs-number">255</span>:<font></font>
    data = {<span class="hljs-string">"name"</span>: <span class="hljs-string">f"r_192.168.0.<span class="hljs-subst">{first_ip}</span>-<span class="hljs-subst">{last_ip}</span>"</span>, <span class="hljs-string">"ip-address-first"</span>: <span class="hljs-string">f"192.168.0.<span class="hljs-subst">{first_ip}</span>"</span>, <span class="hljs-string">"ip-address-last"</span>: <span class="hljs-string">f"192.168.0.<span class="hljs-subst">{last_ip}</span>"</span>}<font></font>
    objects_list_range.append(data)<font></font>
    first_ip+=<span class="hljs-number">5</span>
    last_ip+=<span class="hljs-number">5</span><font></font>
<font></font>
data_for_batch = {<font></font>
  <span class="hljs-string">"objects"</span> : [ {
    <span class="hljs-string">"type"</span> : <span class="hljs-string">"host"</span>,
    <span class="hljs-string">"list"</span> : objects_list_ip<font></font>
}, {<font></font>
    <span class="hljs-string">"type"</span> : <span class="hljs-string">"address-range"</span>,
    <span class="hljs-string">"list"</span> : objects_list_range<font></font>
  }]<font></font>
}<font></font>
<font></font>
<font></font>
<span class="hljs-keyword">with</span> APIClient(client_args) <span class="hljs-keyword">as</span> client: <font></font>
     login = client.login_with_api_key(<span class="hljs-string">'3TsbPJ8ZKjaJGvFyoFqHFA=='</span>)<font></font>
     add_objects_batch = client.api_call(<span class="hljs-string">"add-objects-batch"</span>, data_for_batch)<font></font>
     stop = timeit.default_timer() <font></font>
     publish = client.api_call(<span class="hljs-string">"publish"</span>)<font></font>
     <font></font>
print(<span class="hljs-string">f'Time to execute batch request: <span class="hljs-subst">{stop - start}</span> seconds'</span>)
</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E leva de 3 a 7 segundos para executar esse script no meu ambiente de laborat√≥rio, dependendo da carga no servidor de gerenciamento. </font><font style="vertical-align: inherit;">Ou seja, em m√©dia, em um objeto 101 API, uma chamada de tipo de lote √© 10 vezes mais r√°pida. </font><font style="vertical-align: inherit;">Em mais objetos, a diferen√ßa ser√° ainda mais impressionante. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora vamos ver como trabalhar com </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">set-objects-batch</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Usando esta chamada de API, podemos alterar massivamente qualquer par√¢metro. </font><font style="vertical-align: inherit;">Vamos definir a primeira metade dos endere√ßos do exemplo anterior (para 0,124 hosts e intervalos tamb√©m) a cor sienna e a segunda metade dos endere√ßos que atribuiremos √† cor khaki.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alterar a cor dos objetos criados no exemplo anterior</font></font></b>
                        <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword">from</span> cpapi <span class="hljs-keyword">import</span> APIClient, APIClientArgs<font></font>
<font></font>
client_args = APIClientArgs(server=<span class="hljs-string">"192.168.47.240"</span>)<font></font>
<font></font>
objects_list_ip_first = []<font></font>
objects_list_range_first = []<font></font>
objects_list_ip_second = []<font></font>
objects_list_range_second = []<font></font>
<font></font>
<span class="hljs-keyword">for</span> ip <span class="hljs-keyword">in</span> range(<span class="hljs-number">5</span>,<span class="hljs-number">125</span>,<span class="hljs-number">5</span>):<font></font>
    data = {<span class="hljs-string">"name"</span>: <span class="hljs-string">f'h_192.168.0.<span class="hljs-subst">{ip}</span>'</span>, <span class="hljs-string">"color"</span>: <span class="hljs-string">"sienna"</span>}<font></font>
    objects_list_ip_first.append(data)<font></font>
    <font></font>
<span class="hljs-keyword">for</span> ip <span class="hljs-keyword">in</span> range(<span class="hljs-number">125</span>,<span class="hljs-number">255</span>,<span class="hljs-number">5</span>):<font></font>
    data = {<span class="hljs-string">"name"</span>: <span class="hljs-string">f'h_192.168.0.<span class="hljs-subst">{ip}</span>'</span>, <span class="hljs-string">"color"</span>: <span class="hljs-string">"khaki"</span>}<font></font>
    objects_list_ip_second.append(data)<font></font>
    <font></font>
first_ip = <span class="hljs-number">1</span>
last_ip = <span class="hljs-number">4</span>
<span class="hljs-keyword">while</span> last_ip &lt; <span class="hljs-number">125</span>:<font></font>
    data = {<span class="hljs-string">"name"</span>: <span class="hljs-string">f"r_192.168.0.<span class="hljs-subst">{first_ip}</span>-<span class="hljs-subst">{last_ip}</span>"</span>, <span class="hljs-string">"color"</span>: <span class="hljs-string">"sienna"</span>}<font></font>
    objects_list_range_first.append(data)<font></font>
    first_ip+=<span class="hljs-number">5</span>
    last_ip+=<span class="hljs-number">5</span><font></font>
    <font></font>
<span class="hljs-keyword">while</span> last_ip &lt; <span class="hljs-number">255</span>:<font></font>
    data = {<span class="hljs-string">"name"</span>: <span class="hljs-string">f"r_192.168.0.<span class="hljs-subst">{first_ip}</span>-<span class="hljs-subst">{last_ip}</span>"</span>, <span class="hljs-string">"color"</span>: <span class="hljs-string">"khaki"</span>}<font></font>
    objects_list_range_second.append(data)<font></font>
    first_ip+=<span class="hljs-number">5</span>
    last_ip+=<span class="hljs-number">5</span><font></font>
<font></font>
data_for_batch_first  = {<font></font>
  <span class="hljs-string">"objects"</span> : [ {
    <span class="hljs-string">"type"</span> : <span class="hljs-string">"host"</span>,
    <span class="hljs-string">"list"</span> : objects_list_ip_first<font></font>
}, {<font></font>
    <span class="hljs-string">"type"</span> : <span class="hljs-string">"address-range"</span>,
    <span class="hljs-string">"list"</span> : objects_list_range_first<font></font>
  }]<font></font>
}<font></font>
<font></font>
data_for_batch_second  = {<font></font>
  <span class="hljs-string">"objects"</span> : [ {
    <span class="hljs-string">"type"</span> : <span class="hljs-string">"host"</span>,
    <span class="hljs-string">"list"</span> : objects_list_ip_second<font></font>
}, {<font></font>
    <span class="hljs-string">"type"</span> : <span class="hljs-string">"address-range"</span>,
    <span class="hljs-string">"list"</span> : objects_list_range_second<font></font>
  }]<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">with</span> APIClient(client_args) <span class="hljs-keyword">as</span> client: <font></font>
     login = client.login_with_api_key(<span class="hljs-string">'3TsbPJ8ZKjaJGvFyoFqHFA=='</span>) <font></font>
     set_objects_batch_first = client.api_call(<span class="hljs-string">"set-objects-batch"</span>, data_for_batch_first)<font></font>
     set_objects_batch_second = client.api_call(<span class="hljs-string">"set-objects-batch"</span>, data_for_batch_second)<font></font>
     publish = client.api_call(<span class="hljs-string">"publish"</span>)
</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voc√™ pode excluir muitos objetos em uma chamada de API usando </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">delete-objects-batch</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Agora, vejamos um exemplo de c√≥digo que exclui todos os hosts criados anteriormente por meio do </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">add-objects-batch</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Excluindo objetos usando delete-objects-batch</font></font></b>
                        <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword">from</span> cpapi <span class="hljs-keyword">import</span> APIClient, APIClientArgs<font></font>
<font></font>
client_args = APIClientArgs(server=<span class="hljs-string">"192.168.47.240"</span>)<font></font>
<font></font>
objects_list_ip = []<font></font>
objects_list_range = []<font></font>
<font></font>
<span class="hljs-keyword">for</span> ip <span class="hljs-keyword">in</span> range(<span class="hljs-number">5</span>,<span class="hljs-number">255</span>,<span class="hljs-number">5</span>):<font></font>
    data = {<span class="hljs-string">"name"</span>: <span class="hljs-string">f'h_192.168.0.<span class="hljs-subst">{ip}</span>'</span>}<font></font>
    objects_list_ip.append(data)<font></font>
<font></font>
first_ip = <span class="hljs-number">1</span>
last_ip = <span class="hljs-number">4</span>
<span class="hljs-keyword">while</span> last_ip &lt; <span class="hljs-number">255</span>:<font></font>
    data = {<span class="hljs-string">"name"</span>: <span class="hljs-string">f"r_192.168.0.<span class="hljs-subst">{first_ip}</span>-<span class="hljs-subst">{last_ip}</span>"</span>}<font></font>
    objects_list_range.append(data)<font></font>
    first_ip+=<span class="hljs-number">5</span>
    last_ip+=<span class="hljs-number">5</span><font></font>
<font></font>
data_for_batch = {<font></font>
  <span class="hljs-string">"objects"</span> : [ {
    <span class="hljs-string">"type"</span> : <span class="hljs-string">"host"</span>,
    <span class="hljs-string">"list"</span> : objects_list_ip<font></font>
}, {<font></font>
    <span class="hljs-string">"type"</span> : <span class="hljs-string">"address-range"</span>,
    <span class="hljs-string">"list"</span> : objects_list_range<font></font>
  }]<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">with</span> APIClient(client_args) <span class="hljs-keyword">as</span> client: <font></font>
     login = client.login_with_api_key(<span class="hljs-string">'3TsbPJ8ZKjaJGvFyoFqHFA=='</span>)<font></font>
     delete_objects_batch = client.api_call(<span class="hljs-string">"delete-objects-batch"</span>, data_for_batch)<font></font>
     publish = client.api_call(<span class="hljs-string">"publish"</span>)<font></font>
<font></font>
print(delete_objects_batch.data)<font></font>
</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todos os recursos que aparecem nas novas vers√µes do software Check Point recebem imediatamente chamadas de API. </font><font style="vertical-align: inherit;">Assim, no R80.40 apareceram "recursos" como Reverter para revis√£o e Tarefa inteligente, e para eles prepararam imediatamente as chamadas de API apropriadas. </font><font style="vertical-align: inherit;">Al√©m disso, toda a funcionalidade ao alternar dos consoles herdados para o modo de Pol√≠tica Unificada tamb√©m adquire suporte √† API. </font><font style="vertical-align: inherit;">Por exemplo, a t√£o esperada atualiza√ß√£o na vers√£o do software R80.40 foi a transfer√™ncia da pol√≠tica de Inspe√ß√£o HTTPS do modo Legado para o modo Pol√≠tica Unificada, e essa funcionalidade recebeu imediatamente chamadas de API. </font><font style="vertical-align: inherit;">Aqui est√° um exemplo de c√≥digo que adiciona √† posi√ß√£o superior da pol√≠tica de inspe√ß√£o HTTPS uma regra que exclui das 3 categorias de inspe√ß√£o (Sa√∫de, Finan√ßas, Servi√ßos P√∫blicos) que s√£o proibidas de serem inspecionadas de acordo com a lei em v√°rios pa√≠ses.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Adicionar regra √† pol√≠tica de inspe√ß√£o HTTPS</font></font></b>
                        <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword">from</span> cpapi <span class="hljs-keyword">import</span> APIClient, APIClientArgs<font></font>
<font></font>
client_args = APIClientArgs(server=<span class="hljs-string">"192.168.47.240"</span>)<font></font>
<font></font>
data = {<font></font>
  <span class="hljs-string">"layer"</span> : <span class="hljs-string">"Default Layer"</span>,
  <span class="hljs-string">"position"</span> : <span class="hljs-string">"top"</span>,
  <span class="hljs-string">"name"</span> : <span class="hljs-string">"Legal Requirements"</span>,
  <span class="hljs-string">"action"</span>: <span class="hljs-string">"bypass"</span>,
  <span class="hljs-string">"site-category"</span>: [<span class="hljs-string">"Health"</span>, <span class="hljs-string">"Government / Military"</span>, <span class="hljs-string">"Financial Services"</span>]<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">with</span> APIClient(client_args) <span class="hljs-keyword">as</span> client: <font></font>
     login = client.login_with_api_key(<span class="hljs-string">'3TsbPJ8ZKjaJGvFyoFqHFA=='</span>)<font></font>
     add_https_rule = client.api_call(<span class="hljs-string">"add-https-rule"</span>, data)<font></font>
     publish = client.api_call(<span class="hljs-string">"publish"</span>)
</code></pre><br>
</div>
                    </div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Executando scripts Python em um servidor de gerenciamento Check Point</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tudo no mesmo </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">README.md</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cont√©m informa√ß√µes sobre como executar scripts Python diretamente do servidor de gerenciamento. </font><font style="vertical-align: inherit;">Isso pode ser conveniente quando voc√™ n√£o pode se conectar ao servidor API a partir de outra m√°quina. </font><font style="vertical-align: inherit;">Gravei um v√≠deo de seis minutos no qual considero instalar o m√≥dulo </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cpapi</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e os recursos da execu√ß√£o de scripts Python no servidor de gerenciamento. </font><font style="vertical-align: inherit;">Como exemplo, √© executado um script que automatiza a configura√ß√£o de um novo gateway para uma tarefa como auditar a rede do </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Security CheckUp</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Entre os recursos que eu tive que enfrentar: no Python 2.7, a fun√ß√£o de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">entrada</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ainda n√£o apareceu </font><font style="vertical-align: inherit;">, ent√£o a fun√ß√£o </font><b><font style="vertical-align: inherit;">raw_input</font></b><font style="vertical-align: inherit;"> √© usada para processar as informa√ß√µes que o usu√°rio </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">digita</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Caso contr√°rio, o c√≥digo √© o mesmo que para iniciar em outras m√°quinas, mas √© mais conveniente usar a fun√ß√£o </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">login_as_root</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para n√£o especificar seu pr√≥prio nome de usu√°rio, senha e endere√ßo IP do servidor de gerenciamento.</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/8B6pgCLT8Pg" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Script para configura√ß√£o r√°pida Security CheckUp</font></font></b>
                        <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword">from</span> __future__ <span class="hljs-keyword">import</span> print_function
<span class="hljs-keyword">import</span> getpass
<span class="hljs-keyword">import</span> sys, os<font></font>
sys.path.append(os.path.abspath(os.path.join(os.path.dirname(__file__), <span class="hljs-string">'..'</span>)))
<span class="hljs-keyword">from</span> cpapi <span class="hljs-keyword">import</span> APIClient, APIClientArgs<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span>
    <span class="hljs-keyword">with</span> APIClient() <span class="hljs-keyword">as</span> client:
       <span class="hljs-comment"># if client.check_fingerprint() is False:</span>
       <span class="hljs-comment">#     print("Could not get the server's fingerprint - Check connectivity with the server.")</span>
       <span class="hljs-comment">#     exit(1)</span><font></font>
        login_res = client.login_as_root()<font></font>
<font></font>
        <span class="hljs-keyword">if</span> login_res.success <span class="hljs-keyword">is</span> <span class="hljs-literal">False</span>:<font></font>
            print(<span class="hljs-string">"Login failed:\n{}"</span>.format(login_res.error_message))<font></font>
            exit(<span class="hljs-number">1</span>)<font></font>
<font></font>
        gw_name = raw_input(<span class="hljs-string">"Enter the gateway name:"</span>)<font></font>
        gw_ip = raw_input(<span class="hljs-string">"Enter the gateway IP address:"</span>)
        <span class="hljs-keyword">if</span> sys.stdin.isatty():<font></font>
            sic = getpass.getpass(<span class="hljs-string">"Enter one-time password for the gateway(SIC): "</span>)
        <span class="hljs-keyword">else</span>:<font></font>
            print(<span class="hljs-string">"Attention! Your password will be shown on the screen!"</span>)<font></font>
            sic = raw_input(<span class="hljs-string">"Enter one-time password for the gateway(SIC): "</span>)<font></font>
        version = raw_input(<span class="hljs-string">"Enter the gateway version(like RXX.YY):"</span>)<font></font>
        add_gw = client.api_call(<span class="hljs-string">"add-simple-gateway"</span>, {<span class="hljs-string">'name'</span> : gw_name, <span class="hljs-string">'ipv4-address'</span> : gw_ip, <span class="hljs-string">'one-time-password'</span> : sic, <span class="hljs-string">'version'</span>: version.capitalize(), <span class="hljs-string">'application-control'</span> : <span class="hljs-string">'true'</span>, <span class="hljs-string">'url-filtering'</span> : <span class="hljs-string">'true'</span>, <span class="hljs-string">'ips'</span> : <span class="hljs-string">'true'</span>, <span class="hljs-string">'anti-bot'</span> : <span class="hljs-string">'true'</span>, <span class="hljs-string">'anti-virus'</span> : <span class="hljs-string">'true'</span>, <span class="hljs-string">'threat-emulation'</span> : <span class="hljs-string">'true'</span>})
        <span class="hljs-keyword">if</span> add_gw.success <span class="hljs-keyword">and</span> add_gw.data[<span class="hljs-string">'sic-state'</span>] != <span class="hljs-string">"communicating"</span>:<font></font>
            print(<span class="hljs-string">"Secure connection with the gateway hasn't established!"</span>)<font></font>
            exit(<span class="hljs-number">1</span>)
        <span class="hljs-keyword">elif</span> add_gw.success:<font></font>
            print(<span class="hljs-string">"The gateway was added successfully."</span>)<font></font>
            gw_uid = add_gw.data[<span class="hljs-string">'uid'</span>]<font></font>
            gw_name = add_gw.data[<span class="hljs-string">'name'</span>]
        <span class="hljs-keyword">else</span>:<font></font>
            print(<span class="hljs-string">"Failed to add the gateway - {}"</span>.format(add_gw.error_message))<font></font>
            exit(<span class="hljs-number">1</span>)<font></font>
<font></font>
        change_policy = client.api_call(<span class="hljs-string">"set-access-layer"</span>, {<span class="hljs-string">"name"</span> : <span class="hljs-string">"Network"</span>, <span class="hljs-string">"applications-and-url-filtering"</span>: <span class="hljs-string">"true"</span>, <span class="hljs-string">"content-awareness"</span>: <span class="hljs-string">"true"</span>})
        <span class="hljs-keyword">if</span> change_policy.success:<font></font>
            print(<span class="hljs-string">"The policy has been changed successfully"</span>)
        <span class="hljs-keyword">else</span>:<font></font>
            print(<span class="hljs-string">"Failed to change the policy- {}"</span>.format(change_policy.error_message))<font></font>
        change_rule = client.api_call(<span class="hljs-string">"set-access-rule"</span>, {<span class="hljs-string">"name"</span> : <span class="hljs-string">"Cleanup rule"</span>, <span class="hljs-string">"layer"</span> : <span class="hljs-string">"Network"</span>, <span class="hljs-string">"action"</span>: <span class="hljs-string">"Accept"</span>, <span class="hljs-string">"track"</span>: {<span class="hljs-string">"type"</span>: <span class="hljs-string">"Detailed Log"</span>, <span class="hljs-string">"accounting"</span>: <span class="hljs-string">"true"</span>}})
        <span class="hljs-keyword">if</span> change_rule.success:<font></font>
            print(<span class="hljs-string">"The cleanup rule has been changed successfully"</span>)
        <span class="hljs-keyword">else</span>:<font></font>
            print(<span class="hljs-string">"Failed to change the cleanup rule- {}"</span>.format(change_rule.error_message))<font></font>
<font></font>
        <span class="hljs-comment"># publish the result</span>
        publish_res = client.api_call(<span class="hljs-string">"publish"</span>, {})
        <span class="hljs-keyword">if</span> publish_res.success:<font></font>
            print(<span class="hljs-string">"The changes were published successfully."</span>)
        <span class="hljs-keyword">else</span>:<font></font>
                print(<span class="hljs-string">"Failed to publish the changes - {}"</span>.format(install_tp_policy.error_message))<font></font>
<font></font>
        install_access_policy = client.api_call(<span class="hljs-string">"install-policy"</span>, {<span class="hljs-string">"policy-package"</span> : <span class="hljs-string">"Standard"</span>, <span class="hljs-string">"access"</span> : <span class="hljs-string">'true'</span>,  <span class="hljs-string">"threat-prevention"</span> : <span class="hljs-string">'false'</span>, <span class="hljs-string">"targets"</span> : gw_uid})
        <span class="hljs-keyword">if</span> install_access_policy.success:<font></font>
            print(<span class="hljs-string">"The access policy has been installed"</span>)
        <span class="hljs-keyword">else</span>:<font></font>
                print(<span class="hljs-string">"Failed to install access policy - {}"</span>.format(install_tp_policy.error_message))<font></font>
<font></font>
        install_tp_policy = client.api_call(<span class="hljs-string">"install-policy"</span>, {<span class="hljs-string">"policy-package"</span> : <span class="hljs-string">"Standard"</span>, <span class="hljs-string">"access"</span> : <span class="hljs-string">'false'</span>,  <span class="hljs-string">"threat-prevention"</span> : <span class="hljs-string">'true'</span>, <span class="hljs-string">"targets"</span> : gw_uid})
        <span class="hljs-keyword">if</span> install_tp_policy.success:<font></font>
            print(<span class="hljs-string">"The threat prevention policy has been installed"</span>)
        <span class="hljs-keyword">else</span>:<font></font>
            print(<span class="hljs-string">"Failed to install threat prevention policy - {}"</span>.format(install_tp_policy.error_message))<font></font>
        <font></font>
        <span class="hljs-comment"># add passwords and passphrases to dictionary</span>
        <span class="hljs-keyword">with</span> open(<span class="hljs-string">'additional_pass.conf'</span>) <span class="hljs-keyword">as</span> f:<font></font>
            line_num = <span class="hljs-number">0</span>
            <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> f:<font></font>
                line_num += <span class="hljs-number">1</span>
                add_password_dictionary = client.api_call(<span class="hljs-string">"run-script"</span>, {<span class="hljs-string">"script-name"</span> : <span class="hljs-string">"Add passwords and passphrases"</span>, <span class="hljs-string">"script"</span> : <span class="hljs-string">"printf \"{}\" &gt;&gt; $FWDIR/conf/additional_pass.conf"</span>.format(line), <span class="hljs-string">"targets"</span> : gw_name})
                <span class="hljs-keyword">if</span> add_password_dictionary.success:<font></font>
                    print(<span class="hljs-string">"The password dictionary line {} was added successfully"</span>.format(line_num))
                <span class="hljs-keyword">else</span>:<font></font>
                    print(<span class="hljs-string">"Failed to add the dictionary - {}"</span>.format(add_password_dictionary.error_message))<font></font>
<font></font>
main()</code></pre><br>
</div>
                    </div><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exemplo de arquivo de dicion√°rio de senha additional_pass.conf</font></font></b>
                        <div class="spoiler_text"><code>{<br>
"passwords" : ["malware","malicious","infected","Infected"],<br>
"phrases" : ["password","Password","Pass","pass","codigo","key","pwd","","","","","",""]<br>
}</code><br>
</div>
                    </div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclus√£o</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este artigo considera apenas os recursos b√°sicos do </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Python SDK</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e do m√≥dulo </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cpapi</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (como voc√™ deve ter adivinhado, na verdade s√£o sin√¥nimos) e, ao estudar o c√≥digo neste m√≥dulo, voc√™ descobrir√° ainda mais possibilidades de trabalhar com ele. </font><font style="vertical-align: inherit;">√â poss√≠vel que voc√™ queira complement√°-lo com suas classes, fun√ß√µes, m√©todos e vari√°veis. </font><font style="vertical-align: inherit;">Voc√™ sempre pode compartilhar sua experi√™ncia e visualizar outros scripts para a se√ß√£o Check Point, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CodeHub</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Community </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CheckMates</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , que combina desenvolvedores e usu√°rios de produtos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aproveite a codifica√ß√£o e obrigado pela leitura at√© o fim!</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt505496/index.html">Flutter Dev Podcast com o CTO Meduza Boris Goryachev: o principal sobre o aplicativo Meduz e o desenvolvimento de m√≠dia</a></li>
<li><a href="../pt505498/index.html">Como resolvemos o problema de mem√≥ria de pilha n√£o inicializada no Windows</a></li>
<li><a href="../pt505502/index.html">Omnichannel no atendimento ao cliente: o que procurar e como fazer tudo certo?</a></li>
<li><a href="../pt505506/index.html">Ele n√£o morde: como tornar os rob√¥s industriais seguros para os trabalhadores</a></li>
<li><a href="../pt505508/index.html">N√£o apenas tecnologia n√£o tripulada: o futuro da ind√∫stria automotiva</a></li>
<li><a href="../pt505516/index.html">Aprendizado de m√°quina: por onde come√ßar ou como construir o primeiro modelo</a></li>
<li><a href="../pt505522/index.html">Monetiza√ß√£o em jogos online: como usar a experi√™ncia de outra pessoa para suas pr√≥prias necessidades</a></li>
<li><a href="../pt505528/index.html">A coisa mais importante no Wi-Fi 6. N√£o, s√©rio</a></li>
<li><a href="../pt505530/index.html">Google faz seu processador e AMD est√° se preparando para destruir a Qualcomm</a></li>
<li><a href="../pt505532/index.html">Canais de telegrama sobre desenvolvimento de jogos: parte 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>