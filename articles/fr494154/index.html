<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üò∫ üë®‚Äçüé§ üßìüèΩ Comment nous avons acc√©l√©r√© l'encodage vid√©o huit fois üó∫Ô∏è üåì ü¶Ö</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Chaque jour, des millions de t√©l√©spectateurs regardent des vid√©os sur Internet. Mais pour que la vid√©o soit disponible, elle doit non seulement √™tre t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Comment nous avons acc√©l√©r√© l'encodage vid√©o huit fois</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yandex/blog/494154/"><img src="https://habrastorage.org/webt/mu/t5/ov/mut5ovwkds2o3dn2vnxmxvnelwo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Chaque jour, des millions de t√©l√©spectateurs regardent des vid√©os sur Internet. Mais pour que la vid√©o soit disponible, elle doit non seulement √™tre t√©l√©charg√©e sur le serveur, mais √©galement trait√©e. Plus cela se produit rapidement, meilleurs sont le service et ses utilisateurs. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je m'appelle Askar Kamalov, il y a un an, j'ai rejoint l'√©quipe de technologie vid√©o Yandex. Aujourd'hui, je vais expliquer bri√®vement aux lecteurs de Habr comment, en utilisant la parall√©lisation du processus de codage, nous avons r√©ussi √† acc√©l√©rer la livraison de vid√©os √† l'utilisateur √† plusieurs reprises. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce message int√©ressera principalement ceux qui n'ont pas pens√© √† ce qui se passe sous le capot des services vid√©o. Dans les commentaires, vous pouvez poser des questions et sugg√©rer des sujets pour de futurs articles.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quelques mots sur la t√¢che elle-m√™me. </font><font style="vertical-align: inherit;">Yandex aide non seulement √† rechercher des vid√©os sur d'autres sites, mais stocke √©galement des vid√©os pour ses propres services. </font><font style="vertical-align: inherit;">Qu'il s'agisse d'un programme d'auteur ou d'un match de sport dans Ether, d'un film sur KinoPoisk ou de vid√©os dans Zen et News - tout cela est t√©l√©charg√© sur nos serveurs. </font><font style="vertical-align: inherit;">Pour que les utilisateurs regardent une vid√©o, elle doit √™tre pr√©par√©e: la convertir au format requis, cr√©er un aper√ßu ou m√™me la piloter via la technologie </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DeepHD</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Un fichier non pr√©par√© prend juste de la place. </font><font style="vertical-align: inherit;">Et nous parlons non seulement de l'utilisation optimale du fer, mais aussi de la vitesse de livraison du contenu aux utilisateurs. </font><font style="vertical-align: inherit;">Exemple: un record avec le moment d√©cisif d'un match de hockey peut √™tre recherch√© dans la recherche dans la minute qui suit l'√©v√©nement lui-m√™me.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Codage s√©quentiel</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainsi, le bonheur de l'utilisateur d√©pend en grande partie de la rapidit√© avec laquelle la vid√©o devient disponible. </font><font style="vertical-align: inherit;">Et cela est principalement d√©termin√© par la vitesse de transcodage. </font><font style="vertical-align: inherit;">Lorsqu'il n'y a pas d'exigences strictes pour la vitesse de t√©l√©chargement vid√©o, il n'y a pas de probl√®me. </font><font style="vertical-align: inherit;">Prenez un fichier unique et indivisible, convertissez-le, t√©l√©chargez. </font><font style="vertical-align: inherit;">Au d√©but de notre voyage, nous avons travaill√© comme ceci: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/lh/rv/ix/lhrvixp8ipl0f8yfbtxrm9uh174.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le client t√©l√©charge la vid√©o dans le r√©f√©rentiel, le composant Analyzer collecte des m√©ta-informations et transf√®re la vid√©o pour la conversion vers le composant Worker. </font><font style="vertical-align: inherit;">Toutes les √©tapes sont ex√©cut√©es s√©quentiellement. </font><font style="vertical-align: inherit;">Dans le m√™me temps, il peut y avoir de nombreux serveurs pour l'encodage, mais un seul est occup√© √† traiter une vid√©o sp√©cifique. </font><font style="vertical-align: inherit;">Disposition simple et transparente. </font><font style="vertical-align: inherit;">C'est l√† que ses m√©rites s'arr√™tent. </font><font style="vertical-align: inherit;">Un tel sch√©ma √©volue uniquement verticalement (en raison de l'achat de serveurs plus puissants).</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Codage s√©quentiel avec r√©sultat interm√©diaire</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Afin d'att√©nuer en quelque sorte les attentes douloureuses, l'industrie a propos√© une option de codage rapide. C'est un nom trompeur, car en fait, le codage √† part enti√®re a lieu s√©quentiellement et aussi longtemps. Mais avec un r√©sultat interm√©diaire. L'id√©e est la suivante: pr√©parer et t√©l√©charger la version basse r√©solution de la vid√©o d√®s que possible, et seulement plus tard - des versions haute r√©solution. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
D'une part, la vid√©o devient plus rapide. Et il est utile pour les √©v√©nements importants. Mais de l'autre - l'image est floue, et cela agace le public.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il s'av√®re que vous devez non seulement traiter rapidement la vid√©o, mais √©galement pr√©server sa qualit√©. </font><font style="vertical-align: inherit;">C'est ce que les utilisateurs attendent d√©sormais d'un service vid√©o. </font><font style="vertical-align: inherit;">Il peut sembler suffisant d'acheter les serveurs les plus productifs (et de les mettre √† niveau r√©guli√®rement tous en m√™me temps). </font><font style="vertical-align: inherit;">Mais c'est une voie vers une impasse, car il y a toujours une vid√©o qui ralentira m√™me le mat√©riel le plus puissant.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Codage parall√®le</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il est beaucoup plus efficace de diviser une t√¢che difficile en plusieurs t√¢ches moins complexes et de les r√©soudre simultan√©ment sur diff√©rents serveurs. Tel est MapReduce pour la vid√©o. Dans ce cas, nous ne nous reposons pas sur les performances d'un seul serveur et pouvons √©voluer horizontalement (en ajoutant de nouvelles machines). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Soit dit en passant, l'id√©e de diviser une vid√©o en petits morceaux, de les traiter et de les coller simultan√©ment n'est pas un secret. Vous pouvez trouver de nombreuses r√©f√©rences √† cette approche (par exemple, sur Habr√© je recommande un article sur le projet </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DistVIDc</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). Mais cela ne facilite g√©n√©ralement pas la t√¢che, car vous ne pouvez pas simplement prendre une solution toute faite et l'int√©grer √† vous-m√™me. Nous devons nous adapter √† notre infrastructure, √† notre vid√©o et m√™me √† notre charge de travail. En g√©n√©ral, il est plus facile d'√©crire le v√¥tre.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainsi, dans la nouvelle architecture, nous avons divis√© le bloc Worker monolithique avec codage s√©quentiel en microservices Segmenter, Tcoder, Combiner.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/zq/xo/db/zqxodbzp7qwxo22evvnn1ftyk8o.png"><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Segmenter divise la vid√©o en fragments en environ 10 secondes. </font><font style="vertical-align: inherit;">Les fragments sont constitu√©s d'un ou plusieurs GOP ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">groupe d'images</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">Chaque GOP est ind√©pendant et cod√© s√©par√©ment, de sorte qu'il peut √™tre d√©cod√© sans r√©f√©rence aux trames des autres GOP. </font><font style="vertical-align: inherit;">Autrement dit, les fragments peuvent √™tre reproduits ind√©pendamment les uns des autres. </font><font style="vertical-align: inherit;">Cette segmentation r√©duit la latence, vous permettant de commencer le traitement plus t√¥t.</font></font></li>
<li>Tcoder   .     ,    ,     (,     ,    ),             .   , Tcoder        .</li>
<li>ombiner   :   ,  Tcoder,     .</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quelques mots sur le son. </font><font style="vertical-align: inherit;">Le codec audio AAC le plus populaire a une fonction d√©sagr√©able. </font><font style="vertical-align: inherit;">Si vous codez les fragments s√©par√©ment, les coller ensemble de mani√®re transparente ne fonctionnera tout simplement pas. </font><font style="vertical-align: inherit;">Les transitions seront perceptibles. </font><font style="vertical-align: inherit;">Les codecs vid√©o n'ont pas un tel probl√®me. </font><font style="vertical-align: inherit;">Th√©oriquement, vous pouvez rechercher une solution technique difficile, mais ce jeu ne vaut tout simplement pas la chandelle (l'audio p√®se beaucoup moins que la vid√©o). </font><font style="vertical-align: inherit;">Par cons√©quent, seule la vid√©o est cod√©e en parall√®le avec nous et la piste audio est trait√©e dans son ensemble.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r√©sultats</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gr√¢ce au traitement vid√©o parall√®le, nous avons consid√©rablement r√©duit le d√©lai entre le t√©l√©chargement d'une vid√©o pour nous et sa disponibilit√© pour les utilisateurs. Par exemple, auparavant, il pouvait prendre deux heures pour cr√©er plusieurs versions compl√®tes de qualit√© diff√©rente pour un film FullHD d'une dur√©e d'une heure et demie. Maintenant, tout cela prend 15 minutes. De plus, en traitement parall√®le, nous cr√©ons une version haute r√©solution encore plus rapide qu'une version basse r√©solution avec l'ancienne approche avec un r√©sultat interm√©diaire. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et quelque chose d'autre. Avec l'ancienne approche, les serveurs pouvaient √™tre manquants ou ils √©taient inactifs sans t√¢ches. Le codage parall√®le peut augmenter la part d'utilisation du fer. Maintenant, notre cluster de plus d'un millier de serveurs est toujours occup√© par quelque chose.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En fait, il y a encore place √† am√©lioration. </font><font style="vertical-align: inherit;">Par exemple, nous pouvons gagner beaucoup de temps si nous commen√ßons √† traiter des fragments d'une vid√©o avant m√™me qu'elle ne soit arriv√©e en entier. </font><font style="vertical-align: inherit;">Comme ils disent, plus loin - plus. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√âcrivez dans les commentaires sur les t√¢ches dans le domaine du travail avec la vid√©o que vous souhaitez lire.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Liens utiles avec les pairs de l'industrie</font></font></h3><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SVE: traitement vid√©o distribu√© √† l'√©chelle Facebook</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Simplifier l'innovation m√©dia chez Netflix avec Archer. </font><font style="vertical-align: inherit;">Blog sur la technologie Netflix</font></font></a></li>
</ul></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr494136/index.html">Quoi √©goutter dans les yeux, pour ne pas d√©manger</a></li>
<li><a href="../fr494138/index.html">Droits de l'homme et algorithmes: la force brute du droit d'auteur ne fonctionnera pas aux √âtats-Unis, en Australie, en Russie et dans l'UE</a></li>
<li><a href="../fr494140/index.html">√âtude d'une campagne DNSpionage √† l'aide de Cisco Threat Response, y compris le travail √† distance</a></li>
<li><a href="../fr494150/index.html">ClickHouse √† Avito: rencontres en direct avec Alexey Milovidov</a></li>
<li><a href="../fr494152/index.html">HoughNet: recherche de points de fuite fusionn√©s avec un algorithme classique</a></li>
<li><a href="../fr494156/index.html">Comment travailler √† domicile - l'exp√©rience des d√©m√©nageurs Plesk</a></li>
<li><a href="../fr494158/index.html">Comment maintenir la qualit√© du travail en quarantaine</a></li>
<li><a href="../fr494162/index.html">D√©pannage de Postgres avec pgCenter. Alexey Lesovsky</a></li>
<li><a href="../fr494164/index.html">Comment am√©liorer les performances des √©quipes agiles gr√¢ce aux tests</a></li>
<li><a href="../fr494170/index.html">Top 3 des fonctionnalit√©s Python que vous ne connaissiez pas (probablement)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>